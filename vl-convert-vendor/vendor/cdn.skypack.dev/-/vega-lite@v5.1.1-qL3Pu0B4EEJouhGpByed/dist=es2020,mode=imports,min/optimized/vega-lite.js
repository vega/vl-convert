import{hasOwnProperty as en,isNumber as X,isString as F,writeConfig as gf,splitAccessPath as tn,stringValue as R,toSet as It,isObject as W,isBoolean as Tn,isArray as S,array as V,logger as pf,Warn as hf,isFunction as mf,mergeConfig as Xo,identity as bf}from"/-/vega-util@v1.16.1-QtdV0YLGVmjtkzFiPbzm/dist=es2020,mode=imports,min/optimized/vega-util.js";import"/-/array-flat-polyfill@v1.0.1-l3YUpM9vpzkxx3sm0lhL/dist=es2020,mode=imports,min/optimized/array-flat-polyfill.js";import yf from"/-/clone@v2.1.2-inH2VLNzDGiYU9HUWyZM/dist=es2020,mode=imports,min/optimized/clone.js";import vf from"/-/fast-deep-equal@v3.1.3-ysejKs1WDEDPxUJhgGoP/dist=es2020,mode=imports,min/optimized/fast-deep-equal.js";import kr from"/-/fast-json-stable-stringify@v2.1.0-HLgsuOtxPikt0pw16nth/dist=es2020,mode=imports,min/optimized/fast-json-stable-stringify.js";import{isObject as Yo,writeConfig as Of,isArray as Ko,isString as bi}from"/-/vega@v5.21.0-p1iA2nFhhypDthI1mAci/dist=es2020,mode=imports,min/optimized/vega.js";import{selector as nn}from"/-/vega-event-selector@v2.0.6-fTsDie9ajW0bqk8q646l/dist=es2020,mode=imports,min/optimized/vega-event-selector.js";import{parse as xf}from"/-/vega-expression@v4.0.1-L6nuo9Nkz3BnDTZBigv3/dist=es2020,mode=imports,min/optimized/vega-expression.js";const _f="vega-lite",jf='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',Sf="5.1.1",wf=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],$f="https://vega.github.io/vega-lite/",Ef="Vega-Lite is a concise high-level language for interactive visualization.",kf="build/vega-lite.js",Cf="build/vega-lite.min.js",Nf="build/vega-lite.min.js",Ff="build/src/index",Pf="build/src/index.d.ts",Af={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},Tf={test:"test"},If=["bin","build","src","vega-lite*","tsconfig.json"],Rf={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",jest:"NODE_OPTIONS=--experimental-vm-modules npx jest",test:"yarn jest test/ && yarn lint && yarn schema && yarn jest examples/ && yarn test:runtime","test:cover":"yarn jest --collectCoverage test/","test:inspect":"node --inspect-brk --experimental-vm-modules ./node_modules/.bin/jest --runInBand test","test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"yarn jest --watch test/"},zf={type:"git",url:"https://github.com/vega/vega-lite.git"},Lf="BSD-3-Clause",Df={url:"https://github.com/vega/vega-lite/issues"},Mf={"@babel/core":"^7.15.0","@babel/preset-env":"^7.15.0","@babel/preset-typescript":"^7.15.0","@rollup/plugin-babel":"^5.3.0","@rollup/plugin-commonjs":"^20.0.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^13.0.4","@types/chai":"^4.2.21","@types/d3":"^7.0.0","@types/jest":"^27.0.1","@types/mkdirp":"^1.0.2","@types/pako":"^1.0.2","@typescript-eslint/eslint-plugin":"^4.29.2","@typescript-eslint/parser":"^4.29.2",ajv:"^8.6.2","ajv-formats":"^2.1.1",chai:"^4.3.4",cheerio:"^1.0.0-rc.10","conventional-changelog-cli":"^2.1.1",d3:"^7.0.1","del-cli":"^4.0.1",eslint:"^7.32.0","eslint-config-prettier":"^8.3.0","eslint-plugin-jest":"^24.4.0","eslint-plugin-prettier":"^4.0.0","gh-pages":"^3.2.3","highlight.js":"^11.2.0",jest:"^27.0.6","jest-dev-server":"^5.0.3",mkdirp:"^1.0.4",pako:"^2.0.4",prettier:"^2.3.2",puppeteer:"^10.2.0",rollup:"^2.56.3","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3","rollup-plugin-terser":"^7.0.2",serve:"^12.0.0",terser:"^5.7.1","ts-jest":"^27.0.5","ts-json-schema-generator":"^0.95.0",typescript:"~4.4.2","vega-cli":"^5.20.2","vega-datasets":"~2.2.0","vega-embed":"^6.18.2","vega-tooltip":"^0.27.0","yaml-front-matter":"^4.1.1"},Uf={"@types/clone":"~2.1.1","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.3.1","vega-event-selector":"~2.0.6","vega-expression":"~4.0.1","vega-util":"~1.16.1",yargs:"~17.1.1"},Bf={vega:"^5.20.2"},Wf={node:">=12"};var Hf={name:_f,author:jf,version:Sf,collaborators:wf,homepage:$f,description:Ef,main:kf,unpkg:Cf,jsdelivr:Nf,module:Ff,types:Pf,bin:Af,directories:Tf,files:If,scripts:Rf,repository:zf,license:Lf,bugs:Df,devDependencies:Mf,dependencies:Uf,peerDependencies:Bf,engines:Wf};function Cr(e){return!!e.or}function Nr(e){return!!e.and}function Fr(e){return!!e.not}function yi(e,t){if(Fr(e))yi(e.not,t);else if(Nr(e))for(const n of e.and)yi(n,t);else if(Cr(e))for(const n of e.or)yi(n,t);else t(e)}function rn(e,t){return Fr(e)?{not:rn(e.not,t)}:Nr(e)?{and:e.and.map(n=>rn(n,t))}:Cr(e)?{or:e.or.map(n=>rn(n,t))}:t(e)}const Ae=vf,C=yf;function sn(e,t){const n={};for(const i of t)en(e,i)&&(n[i]=e[i]);return n}function pe(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>kr(e)).join(",")})`};const M=kr;function I(e){if(X(e))return e;const t=F(e)?e:kr(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function Pr(e){return e===!1||e===null}function P(e,t){return e.includes(t)}function on(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function Ar(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function Qo(e,...t){for(const n of t)qf(e,n??{});return e}function qf(e,t){for(const n of y(t))gf(e,n,t[n],!0)}function Te(e,t){const n=[],i={};let r;for(const s of e){if(r=t(s),r in i)continue;i[r]=1,n.push(s)}return n}function Gf(e,t){const n=y(e),i=y(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function Zo(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Tr(e,t){for(const n of e)if(t.has(n))return!0;return!1}function Ir(e){const t=new Set;for(const n of e){const i=tn(n),r=i.map((o,a)=>a===0?o:`[${o}]`),s=r.map((o,a)=>r.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function Rr(e,t){return e===void 0||t===void 0?!0:Tr(Ir(e),Ir(t))}function L(e){return y(e).length===0}const y=Object.keys,ne=Object.values,gt=Object.entries;function In(e){return e===!0||e===!1}function H(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Rn(e,t){return Fr(e)?`!(${Rn(e.not,t)})`:Nr(e)?`(${e.and.map(n=>Rn(n,t)).join(") && (")})`:Cr(e)?`(${e.or.map(n=>Rn(n,t)).join(") || (")})`:t(e)}function vi(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&vi(e[n],t)&&delete e[n],L(e)}function zn(e){return e.charAt(0).toUpperCase()+e.substr(1)}function zr(e,t="datum"){const n=tn(e),i=[];for(let r=1;r<=n.length;r++){const s=`[${n.slice(0,r).map(R).join("][")}]`;i.push(`${t}${s}`)}return i.join(" && ")}function Jo(e,t="datum"){return`${t}[${R(tn(e).join("."))}]`}function Vf(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function ye(e){return`${tn(e).map(Vf).join("\\.")}`}function Rt(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Lr(e){return`${tn(e).join(".")}`}function an(e){return e?tn(e).length:0}function Y(...e){for(const t of e)if(t!==void 0)return t;return}let ea=42;function ta(e){const t=++ea;return e?String(e)+t:t}function Xf(){ea=42}function na(e){return ia(e)?e:`__${e}`}function ia(e){return e.startsWith("__")}function Ln(e){return e===void 0?void 0:(e%360+360)%360}function Oi(e){return X(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}var Dn=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ze="row",Je="column",xi="facet",G="x",Q="y",Se="x2",Ie="y2",Re="radius",et="radius2",we="theta",tt="theta2",ze="latitude",Le="longitude",$e="latitude2",ve="longitude2",ue="color",De="fill",Me="stroke",fe="shape",nt="size",zt="angle",it="opacity",pt="fillOpacity",ht="strokeOpacity",mt="strokeWidth",bt="strokeDash",Mn="text",Un="order",Bn="detail",_i="key",Lt="tooltip",ji="href",Si="url",wi="description",Yf={x:1,y:1,x2:1,y2:1},ra={theta:1,theta2:1,radius:1,radius2:1};function sa(e){return e in ra}const Dr={longitude:1,longitude2:1,latitude:1,latitude2:1};function Kf(e){switch(e){case ze:return"y";case $e:return"y2";case Le:return"x";case ve:return"x2"}}function Qf(e){return e in Dr}const Zf=y(Dr),oa=Object.assign(Object.assign(Object.assign(Object.assign({},Yf),ra),Dr),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function cn(e){return e===ue||e===De||e===Me}const aa={row:1,column:1,facet:1},Oe=y(aa),Mr=Object.assign(Object.assign({},oa),aa),Jf=y(Mr),ed=Dn(Mr,["order","detail","tooltip"]),td=Dn(ed,["row","column","facet"]);function nd(e){return!!td[e]}function ca(e){return!!Mr[e]}const id=[Se,Ie,$e,ve,tt,et];function la(e){const t=Dt(e);return t!==e}function Dt(e){switch(e){case Se:return G;case Ie:return Q;case $e:return ze;case ve:return Le;case tt:return we;case et:return Re}return e}function yt(e){if(sa(e))switch(e){case we:return"startAngle";case tt:return"endAngle";case Re:return"outerRadius";case et:return"innerRadius"}return e}function rt(e){switch(e){case G:return Se;case Q:return Ie;case ze:return $e;case Le:return ve;case we:return tt;case Re:return et}return}function xe(e){switch(e){case G:case Se:return"width";case Q:case Ie:return"height"}return}function rd(e){switch(e){case G:return"xOffset";case Q:return"yOffset";case Se:return"x2Offset";case Ie:return"y2Offset";case we:return"thetaOffset";case Re:return"radiusOffset";case tt:return"theta2Offset";case et:return"radius2Offset"}return}const Ur=Dn(oa,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),sd=y(Ur),vt={x:1,y:1},Ue=y(vt);function Be(e){return e in vt}const Br={theta:1,radius:1},od=y(Br);function $i(e){return e==="width"?G:Q}const ua=Dn(Ur,["text","tooltip","href","url","description","detail","key","order"]),ad=y(ua);function cd(e){return!!Ur[e]}function ld(e){switch(e){case ue:case De:case Me:case nt:case fe:case it:case mt:case bt:return!0;case pt:case ht:case zt:return!1}}const fa=Object.assign(Object.assign(Object.assign({},vt),Br),ua),Ei=y(fa);function Ot(e){return!!fa[e]}function ud(e,t){return dd(e)[t]}const da={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},fd=Dn(da,["geoshape"]);function dd(e){switch(e){case ue:case De:case Me:case wi:case Bn:case _i:case Lt:case ji:case Un:case it:case pt:case ht:case mt:case xi:case Ze:case Je:return da;case G:case Q:case ze:case Le:return fd;case Se:case Ie:case $e:case ve:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case nt:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case bt:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case fe:return{point:"always",geoshape:"always"};case Mn:return{text:"always"};case zt:return{point:"always",square:"always",text:"always"};case Si:return{image:"always"};case we:return{text:"always",arc:"always"};case Re:return{text:"always",arc:"always"};case tt:case et:return{arc:"always"}}}function Wr(e){switch(e){case G:case Q:case we:case Re:case nt:case zt:case mt:case it:case pt:case ht:case Se:case Ie:case tt:case et:return;case xi:case Ze:case Je:case fe:case bt:case Mn:case Lt:case ji:case Si:case wi:return"discrete";case ue:case De:case Me:return"flexible";case ze:case Le:case $e:case ve:case Bn:case _i:case Un:return}}const gd={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},pd={count:1,min:1,max:1};function st(e){return!!e&&!!e.argmin}function xt(e){return!!e&&!!e.argmax}function Hr(e){return F(e)&&!!gd[e]}const hd=["count","valid","missing","distinct"];function ga(e){return F(e)&&P(hd,e)}function md(e){return F(e)&&P(["min","max"],e)}const bd=["count","sum","distinct","valid","missing"],yd=["mean","average","median","q1","q3","min","max"],vd=It(yd);function pa(e){return Tn(e)&&(e=Vi(e,void 0)),"bin"+y(e).map(t=>ki(e[t])?H(`_${t}_${gt(e[t])}`):H(`_${t}_${e[t]}`)).join("")}function U(e){return e===!0||Mt(e)&&!e.binned}function oe(e){return e==="binned"||Mt(e)&&e.binned===!0}function Mt(e){return W(e)}function ki(e){return e==null?void 0:e.param}function ha(e){switch(e){case Ze:case Je:case nt:case ue:case De:case Me:case mt:case it:case pt:case ht:case fe:return 6;case bt:return 4;default:return 10}}function Wn(e){return e&&!!e.expr}function de(e){const t=y(e||{}),n={};for(const i of t)n[i]=he(e[i]);return n}var Od=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ma(e){const{anchor:t,frame:n,offset:i,orient:r,angle:s,limit:o,color:a,subtitleColor:c,subtitleFont:l,subtitleFontSize:u,subtitleFontStyle:f,subtitleFontWeight:d,subtitleLineHeight:g,subtitlePadding:p}=e,m=Od(e,["anchor","frame","offset","orient","angle","limit","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),h=Object.assign(Object.assign({},m),a?{fill:a}:{}),x=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),s!==void 0?{angle:s}:{}),o!==void 0?{limit:o}:{}),b=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},c?{subtitleColor:c}:{}),l?{subtitleFont:l}:{}),u?{subtitleFontSize:u}:{}),f?{subtitleFontStyle:f}:{}),d?{subtitleFontWeight:d}:{}),g?{subtitleLineHeight:g}:{}),p?{subtitlePadding:p}:{}),O=sn(e,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:h,subtitleMarkConfig:O,nonMarkTitleProperties:x,subtitle:b}}function _t(e){return F(e)||S(e)&&F(e[0])}function w(e){return e&&!!e.signal}function jt(e){return!!e.step}function xd(e){return S(e)?!1:"fields"in e&&!("data"in e)}function _d(e){return S(e)?!1:"fields"in e&&"data"in e}function ot(e){return S(e)?!1:"field"in e&&"data"in e}const jd={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},Sd=y(jd),wd={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},qr=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];var Gr=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ba(e){const t=S(e.condition)?e.condition.map(ya):ya(e.condition);return Object.assign(Object.assign({},he(e)),{condition:t})}function he(e){if(Wn(e)){const{expr:t}=e,n=Gr(e,["expr"]);return Object.assign({signal:t},n)}return e}function ya(e){if(Wn(e)){const{expr:t}=e,n=Gr(e,["expr"]);return Object.assign({signal:t},n)}return e}function q(e){if(Wn(e)){const{expr:t}=e,n=Gr(e,["expr"]);return Object.assign({signal:t},n)}return w(e)?e:e!==void 0?{value:e}:void 0}function va(e){return w(e)?e.signal:R(e.value)}function at(e){return w(e)?e.signal:e==null?null:R(e)}function $d(e,t,n){for(const i of n){const r=Ut(i,t.markDef,t.config);r!==void 0&&(e[i]=q(r))}return e}function Oa(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function z(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:s&&(!r||r===e)?void 0:Ut(e,t,n,i)}function Ut(e,t,n,{vgChannel:i}={}){return Y(i?Ci(e,t,n.style):void 0,Ci(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function Ci(e,t,n){return xa(e,Oa(t),n)}function xa(e,t,n){t=V(t);let i;for(const r of t){const s=n[r];s&&s[e]!==void 0&&(i=s[e])}return i}function _a(e,t){return V(e).reduce((n,i)=>{var r;return n.field.push(_(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function ja(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Ae(r,i))return;n.push(i)}),n}function Sa(e,t){return Ae(e,t)||!t?e:e?[...V(e),...V(t)].join(", "):t}function wa(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((_t(n)||w(n))&&(_t(i)||w(i)))return{explicit:e.explicit,value:Sa(n,i)};if(_t(n)||w(n))return{explicit:e.explicit,value:n};if(_t(i)||w(i))return{explicit:e.explicit,value:i};if(!_t(n)&&!w(n)&&!_t(i)&&!w(i))return{explicit:e.explicit,value:ja(n,i)};throw new Error("It should never reach here")}function Vr(e){return`Invalid specification ${M(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Ed='Autosize "fit" only works for single views and layered views.';function $a(e){const t=e=="width"?"Width":"Height";return`${t} "container" only works for single views and layered views.`}function Ea(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function ka(e){return e?`Dropping "fit-${e}" because spec has discrete ${xe(e)}.`:'Dropping "fit" because spec has discrete size.'}function Xr(e){return`Unknown field for ${e}. Cannot calculate view size.`}function Ca(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function kd(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Cd(e){return`The "nearest" transform is not supported for ${e} marks.`}function Na(e){return`Selection not supported for ${e} yet.`}function Nd(e){return`Cannot find a selection named "${e}".`}const Fd="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Pd="Legend bindings are only supported for selections over an individual field or encoding channel.";function Ad(e){return`Lookups can only be performed on selection parameters. "${e}" is a variable parameter.`}function Td(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const Id="The same selection must be used to override scale domains in a layered view.",Rd='Interval selections should be initialized using "x" and/or "y" keys.';function zd(e){return`Unknown repeated value "${e}".`}function Fa(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const Ld="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Dd(e){return`Unrecognized parse "${e}".`}function Pa(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const Md="Attempt to add the same child twice.";function Ud(e){return`Ignoring an invalid transform: ${M(e)}.`}const Bd='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function Aa(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function Wd(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${M(t)} is overridden by a child projection ${M(n)}.`}const Hd="Arc marks uses theta channel rather than angle, replacing angle with theta.";function qd(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${M(n)}}.`}function Ta(e){return`Invalid field type "${e}".`}function Gd(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function Vd(e){return`Invalid aggregation operator "${e}".`}function Ia(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function Xd(e){return`Position range does not support relative band size for ${e}.`}function Yr(e,t){return`Dropping ${M(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const Yd="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Ni(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function Kd(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function Qd(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function Zd(e){return`${e} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function Jd(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function Kr(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function eg(e){return`The ${e} for range marks cannot be an expression`}function tg(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function ng(e,t){return`Specified orient "${e}" overridden with "${t}".`}function ig(e){return`Cannot use the scale property "${e}" with non-color channel.`}function rg(e){return`Cannot use the relative band size with ${e} scale.`}function sg(e){return`Using unaggregated domain with raw field has no effect (${M(e)}).`}function og(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function ag(e){return`Unaggregated domain is currently unsupported for log scale (${M(e)}).`}function cg(e){return`Cannot apply size to non-oriented mark "${e}".`}function lg(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function ug(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function Ra(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function za(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function fg(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${M(n)} and ${M(i)}). Using ${M(n)}.`}function dg(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${M(n)} and ${M(i)}). Using the union of the two domains.`}function gg(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function pg(e){return`Dropping sort property ${M(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const La="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",hg="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",mg="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",bg="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function yg(e){return`Cannot stack "${e}" if there is already "${e}2".`}function vg(e){return`Cannot stack non-linear scale (${e}).`}function Og(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Fi(e,t){return`Invalid ${e}: ${M(t)}.`}function xg(e){return`Dropping day from datetime ${M(e)} as day cannot be combined with other units.`}function _g(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function jg(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Sg(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Da(e){return`1D error band does not support ${e}.`}function Ma(e){return`Channel ${e} is required for "binned" bin.`}function wg(e){return`Channel ${e} should not be used with "binned" bin.`}function $g(e){return`Domain for ${e} is required for threshold scale.`}var MO=function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},UO=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)};const Ua=pf(hf);let ln=Ua;function Eg(e){return ln=e,ln}function kg(){return ln=Ua,ln}function v(...e){ln.warn(...e)}function Cg(...e){ln.debug(...e)}function Bt(e){if(e&&W(e)){for(const t of Zr)if(t in e)return!0}return!1}const Ba=["january","february","march","april","may","june","july","august","september","october","november","december"],Ng=Ba.map(e=>e.substr(0,3)),Wa=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Fg=Wa.map(e=>e.substr(0,3));function Pg(e){if(Oi(e)&&(e=+e),X(e))return e>4&&v(Fi("quarter",e)),e-1;throw new Error(Fi("quarter",e))}function Ag(e){if(Oi(e)&&(e=+e),X(e))return e-1;{const t=e.toLowerCase(),n=Ba.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Ng.indexOf(i);if(r!==-1)return r;throw new Error(Fi("month",e))}}function Tg(e){if(Oi(e)&&(e=+e),X(e))return e%7;{const t=e.toLowerCase(),n=Wa.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Fg.indexOf(i);if(r!==-1)return r;throw new Error(Fi("day",e))}}function Qr(e,t){const n=[];if(t&&e.day!==void 0&&(y(e).length>1&&(v(xg(e)),e=C(e),delete e.day)),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Ag(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Pg(e.quarter):e.quarter;n.push(X(i)?i*3:`${i}*3`)}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Tg(e.day):e.day;n.push(X(i)?i+1:`${i}+1`)}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function Hn(e){const t=Qr(e,!0),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Ig(e){const t=Qr(e,!1),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Rg(e){const t=Qr(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}var zg=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ha={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Zr=y(Ha);function Lg(e){return!!Ha[e]}function Jr(e){return e.startsWith("utc")}function Dg(e){return e.substr(3)}const Mg={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function es(e){return Zr.filter(t=>qa(e,t))}function qa(e,t){const n=e.indexOf(t);return n<0||(n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")?!1:!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function Ug(e,t,{end:n}={end:!1}){const i=zr(t),r=Jr(e)?"utc":"";function s(c){return c==="quarter"?`(${r}quarter(${i})-1)`:`${r}${c}(${i})`}let o;const a={};for(const c of Zr)qa(e,c)&&(a[c]=s(c),o=c);return n&&(a[o]+="+1"),Ig(a)}function Ga(e){if(!e)return;const t=es(e);return`timeUnitSpecifier(${M(t)}, ${M(Mg)})`}function Bg(e,t,n){if(!e)return;const i=Ga(e),r=n||Jr(e);return`${r?"utc":"time"}Format(${t}, ${i})`}function ae(e){if(!e)return;let t;return F(e)?t={unit:e}:W(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),Jr(t.unit)&&(t.utc=!0,t.unit=Dg(t.unit)),t}function Wg(e){const t=ae(e),{utc:n}=t,i=zg(t,["utc"]);return i.unit?(n?"utc":"")+y(i).map(r=>H(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+y(i).map(r=>H(`_${r}_${i[r]}`)).join("")}function Hg(e){return e==null?void 0:e.param}function ts(e){return e&&!!e.field&&e.equal!==void 0}function ns(e){return e&&!!e.field&&e.lt!==void 0}function is(e){return e&&!!e.field&&e.lte!==void 0}function rs(e){return e&&!!e.field&&e.gt!==void 0}function ss(e){return e&&!!e.field&&e.gte!==void 0}function os(e){if(e==null?void 0:e.field){if(S(e.range)&&e.range.length===2)return!0;if(w(e.range))return!0}return!1}function as(e){return e&&!!e.field&&(S(e.oneOf)||S(e.in))}function qg(e){return e&&!!e.field&&e.valid!==void 0}function Va(e){return as(e)||ts(e)||os(e)||ns(e)||rs(e)||is(e)||ss(e)}function We(e,t){return Xi(e,{timeUnit:t,wrapTime:!0})}function Gg(e,t){return e.map(n=>We(n,t))}function Xa(e,t=!0){var n;const{field:i}=e,r=(n=ae(e.timeUnit))===null||n===void 0?void 0:n.unit,s=r?`time(${Ug(r,i)})`:_(e,{expr:"datum"});if(ts(e))return`${s}===${We(e.equal,r)}`;if(ns(e)){const o=e.lt;return`${s}<${We(o,r)}`}else if(rs(e)){const o=e.gt;return`${s}>${We(o,r)}`}else if(is(e)){const o=e.lte;return`${s}<=${We(o,r)}`}else if(ss(e)){const o=e.gte;return`${s}>=${We(o,r)}`}else{if(as(e))return`indexof([${Gg(e.oneOf,r).join(",")}], ${s}) !== -1`;if(qg(e))return cs(s,e.valid);if(os(e)){const{range:o}=e,a=w(o)?{signal:`${o.signal}[0]`}:o[0],c=w(o)?{signal:`${o.signal}[1]`}:o[1];if(a!==null&&c!==null&&t)return"inrange("+s+", ["+We(a,r)+", "+We(c,r)+"])";const l=[];return a!==null&&l.push(`${s} >= ${We(a,r)}`),c!==null&&l.push(`${s} <= ${We(c,r)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${M(e)}`)}function cs(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function Vg(e){var t;return Va(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=ae(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const qn={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Wt=qn.quantitative,ls=qn.ordinal,un=qn.temporal,us=qn.nominal,fn=qn.geojson;function Xg(e){if(e){e=e.toLowerCase();switch(e){case"q":case Wt:return"quantitative";case"t":case un:return"temporal";case"o":case ls:return"ordinal";case"n":case us:return"nominal";case fn:return"geojson"}}return}var Yg=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Z={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},fs={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function Kg(e,t){const n=fs[e],i=fs[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const Qg={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Ya(e){return Qg[e]}const Ka=["linear","log","pow","sqrt","symlog","time","utc"],Zg=It(Ka),Jg=["linear","log","pow","sqrt","symlog"],ep=It(Jg);function tp(e){return e in ep}const np=["quantile","quantize","threshold"],ip=It(np),rp=Ka.concat(["quantile","quantize","threshold","sequential","identity"]),sp=It(rp),op=["ordinal","bin-ordinal","point","band"],ap=It(op);function ie(e){return e in ap}function me(e){return e in sp}function Ee(e){return e in Zg}function Gn(e){return e in ip}const cp={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function lp(e){return!F(e)&&!!e.name}function Qa(e){return e==null?void 0:e.param}function up(e){return e&&e.unionWith}function fp(e){return Yo(e)&&"field"in e}const dp={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},gp=Yg(dp,["type","domain","range","rangeMax","rangeMin","scheme"]),pp=y(gp);function ds(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return Ee(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return Ee(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return Ee(e);case"nice":return Ee(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return me(e)&&!P(["log","time","utc","threshold","quantile"],e)}}function Za(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return cn(e)?void 0:ig(e);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function hp(e,t){return P([ls,us],t)?e===void 0||ie(e):t===un?P([Z.TIME,Z.UTC,void 0],e):t===Wt?P([Z.LOG,Z.POW,Z.SQRT,Z.SYMLOG,Z.QUANTILE,Z.QUANTIZE,Z.THRESHOLD,Z.LINEAR,void 0],e):!0}function mp(e,t){if(!Ot(e))return!1;switch(e){case G:case Q:case we:case Re:return Ee(t)||P(["band","point"],t);case nt:case mt:case it:case pt:case ht:case zt:return Ee(t)||Gn(t)||P(["band","point","ordinal"],t);case ue:case De:case Me:return t!=="band";case bt:case fe:return t==="ordinal"||Gn(t)}}const ce={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},Ja=ce.arc,Pi=ce.area,Ai=ce.bar,bp=ce.image,Ti=ce.line,Ii=ce.point,yp=ce.rect,Ri=ce.rule,ec=ce.text,gs=ce.tick,vp=ce.trail,ps=ce.circle,hs=ce.square,tc=ce.geoshape;function St(e){return["line","area","trail"].includes(e)}function nc(e){return["rect","bar","image","arc"].includes(e)}const ic=y(ce);function He(e){return e.type}const BO=It(ic),Op=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],xp=["fill","fillOpacity"],_p=[...Op,...xp],jp={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},rc=y(jp),Sp={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},wp={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},$p={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},sc=y($p);function dn(e){return e&&e.band!=null}const Ep={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},oc=5,kp={binSpacing:1,continuousBandSize:oc,timeUnitBandPosition:.5},Cp={binSpacing:0,continuousBandSize:oc,timeUnitBandPosition:.5},Np={thickness:1};function Fp(e){return He(e)?e.type:e}function ms(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:s}=e,o=cc(e);return j(n)&&!ga(n.aggregate)&&r&&Ee(r.get("type"))&&r.get("zero")===!1?ac({fieldDef:n,channel:t,markDef:i,ref:o,config:s}):o}function ac({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){if(St(n.type))return i;const s=z("invalid",n,r);return s===null?i:[Pp(e,t),i]}function Pp(e,t){const n=bs(e,!0),i=Dt(t),r=i==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function bs(e,t=!0){return cs(F(e)?e:_(e,{expr:"datum"}),!t)}function Ap(e){const{datum:t}=e;return Bt(t)?Hn(t):`${M(t)}`}function Ht(e,t,n,i){const r={};if(t&&(r.scale=t),wt(e)){const{datum:s}=e;Bt(s)?r.signal=Hn(s):w(s)?r.signal=s.signal:Wn(s)?r.signal=s.expr:r.value=s}else r.field=_(e,n);if(i){const{offset:s,band:o}=i;s&&(r.offset=s),o&&(r.band=o)}return r}function zi({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,bandPosition:s=.5}){const o=0<s&&s<1?"datum":void 0,a=_(t,{expr:o,suffix:r}),c=n!==void 0?_(n,{expr:o}):_(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const u=s===0?a:c;l.field=u}else{const u=w(s)?`${s.signal} * ${a} + (1-${s.signal}) * ${c}`:`${s} * ${a} + ${1-s} * ${c}`;l.signal=`scale("${e}", ${u})`}return i&&(l.offset=i),l}function cc({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l,bandPosition:u}){var f;if(t){if(E(t)){if(_e(t)){u??(u=Oc({fieldDef:t,fieldDef2:n,markDef:i,config:r}));const{bin:g,timeUnit:p,type:m}=t;if(U(g)||u&&p&&m===un)return(a==null?void 0:a.impute)?Ht(t,s,{binSuffix:"mid"},{offset:c}):u?zi({scaleName:s,fieldOrDatumDef:t,bandPosition:u,offset:c}):Ht(t,s,Yn(t,e)?{binSuffix:"range"}:{},{offset:c});if(oe(g)){if(j(n))return zi({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:u,offset:c});{const h=e===G?Se:Ie;v(Ma(h))}}}const d=o==null?void 0:o.get("type");return Ht(t,s,ie(d)?{binSuffix:"range"}:{},{offset:c,band:d==="band"?(f=u??t.bandPosition)!==null&&f!==void 0?f:.5:void 0})}else if(ke(t)){const d=t.value,g=c?{offset:c}:{};return Object.assign(Object.assign({},Vn(e,d)),g)}}return mf(l)&&(l=l()),l&&Object.assign(Object.assign({},l),c?{offset:c}:{})}function Vn(e,t){return P(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:P(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:q(t)}function qt(e){return e&&e!=="number"&&e!=="time"}function lc(e,t,n){return`${e}(${t}${n?`, ${M(n)}`:""})`}const Tp=" \u2013 ";function ys({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){var o,a;if(qt(n))return vs({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const c=uc(e,i,r);if(hn(e)){const l=Rp(c,j(e)?(o=ae(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,s.timeFormat,Gt(e)&&((a=e.scale)===null||a===void 0?void 0:a.type)===Z.UTC);return l?{signal:l}:void 0}if(t=gc(js(e),t,s),j(e)&&U(e.bin)){const l=_(e,{expr:i,binSuffix:"end"});return{signal:Li(c,l,t,n,s)}}else return t||js(e)==="quantitative"?{signal:`${pc(c,t)}`}:{signal:`isValid(${c}) ? ${c} : ""+${c}`}}function uc(e,t,n){return j(e)?n?`${_(e,{expr:t,suffix:"end"})}-${_(e,{expr:t,suffix:"start"})}`:_(e,{expr:t}):Ap(e)}function vs({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){if(o??(o=uc(e,i,r)),j(e)&&U(e.bin)){const a=_(e,{expr:i,binSuffix:"end"});return{signal:Li(o,a,t,n,s)}}return{signal:lc(n,o,t)}}function fc(e,t,n,i,r,s){var o;if(qt(i))return;if(hn(e)){const a=j(e)?(o=ae(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return Ip(n,a,r,s)}return gc(t,n,r)}function dc(e,t,n){return e&&(w(e)||e==="number"||e==="time")?e:hn(t)&&n!=="time"&&n!=="utc"?"time":void 0}function gc(e,t,n){return F(t)?t:e===Wt?n.numberFormat:void 0}function Ip(e,t,n,i){return e||(t?{signal:Ga(t)}:i?void 0:n.timeFormat)}function pc(e,t){return`format(${e}, "${t||""}")`}function hc(e,t,n,i){var r;return qt(n)?lc(n,e,t):pc(e,(r=F(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function Li(e,t,n,i,r){const s=hc(e,n,i,r),o=hc(t,n,i,r);return`${cs(e,!1)} ? "null" : ${s} + "${Tp}" + ${o}`}function Rp(e,t,n,i,r){return!t||n?(n=F(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):Bg(t,e,r)}const Di="min",zp={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function mc(e){return e in zp}function bc(e){return!!e&&!!e.encoding}function qe(e){return!!e&&(e.op==="count"||!!e.field)}function yc(e){return!!e&&S(e)}function Xn(e){return"row"in e||"column"in e}function Os(e){return!!e&&"header"in e}function Mi(e){return"facet"in e}var xs=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Lp(e){return e.param}function Dp(e){return e&&!F(e)&&"repeat"in e}function vc(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function _s(e){return"sort"in e}function Oc({fieldDef:e,fieldDef2:t,markDef:n,config:i}){if(E(e)&&e.bandPosition!==void 0)return e.bandPosition;if(j(e)){const{timeUnit:r,bin:s}=e;if(r&&!t)return nc(n.type)?0:Ut("timeUnitBandPosition",n,i);if(U(s))return .5}return}function xc({channel:e,fieldDef:t,fieldDef2:n,markDef:i,config:r,scaleType:s,useVlSizeChannel:o}){var a,c,l;const u=xe(e),f=z(o?"size":u,i,r,{vgChannel:u});if(f!==void 0)return f;if(j(t)){const{timeUnit:d,bin:g}=t;if(d&&!n)return{band:Ut("timeUnitBandSize",i,r)};if(U(g)&&!ie(s))return{band:1}}return nc(i.type)?s?ie(s)?((a=r[i.type])===null||a===void 0?void 0:a.discreteBandSize)||{band:1}:(c=r[i.type])===null||c===void 0?void 0:c.continuousBandSize:(l=r[i.type])===null||l===void 0?void 0:l.discreteBandSize:void 0}function _c(e,t,n,i){return U(e.bin)||e.timeUnit&&_e(e)&&e.type==="temporal"?Oc({fieldDef:e,fieldDef2:t,markDef:n,config:i})!==void 0:!1}function Ui(e){return e&&"condition"in e}function Bi(e){const t=e&&e.condition;return!!t&&!S(t)&&j(t)}function Wi(e){const t=e&&e.condition;return!!t&&!S(t)&&E(t)}function Mp(e){const t=e&&e.condition;return!!t&&(S(t)||ke(t))}function j(e){return e&&(!!e.field||e.aggregate==="count")}function js(e){return e&&e.type}function wt(e){return e&&"datum"in e}function Ge(e){return _e(e)&&!Hi(e)||Ss(e)}function Ss(e){return wt(e)&&X(e.datum)}function E(e){return j(e)||wt(e)}function _e(e){return e&&("field"in e||e.aggregate==="count")&&"type"in e}function ke(e){return e&&"value"in e&&"value"in e}function Gt(e){return e&&("scale"in e||"sort"in e)}function ws(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function jc(e){return e&&"legend"in e}function Sc(e){return e&&("format"in e||"formatType"in e)}function Up(e){return pe(e,["legend","axis","header","scale"])}function Bp(e){return"op"in e}function _(e,t={}){var n,i,r;let s=e.field;const o=t.prefix;let a=t.suffix,c="";if(Hp(e))s=na("count");else{let l;if(!t.nofn)if(Bp(e))l=e.op;else{const{bin:u,aggregate:f,timeUnit:d}=e;U(u)?(l=pa(u),a=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?xt(f)?(c=`["${s}"]`,s=`argmax_${f.argmax}`):st(f)?(c=`["${s}"]`,s=`argmin_${f.argmin}`):l=String(f):d&&(l=Wg(d),a=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}l&&(s=s?`${l}_${s}`:l)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),t.forAs?Lr(s):t.expr?Jo(s,t.expr)+c:ye(s)+c}function Hi(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return j(e)&&!!e.bin;case"temporal":return!1}throw new Error(Ta(e.type))}function Wp(e){var t;return Gt(e)&&Gn((t=e.scale)===null||t===void 0?void 0:t.type)}function Hp(e){return e.aggregate==="count"}function qp(e,t){var n;const{field:i,bin:r,timeUnit:s,aggregate:o}=e;if(o==="count")return t.countTitle;if(U(r))return`${i} (binned)`;if(s){const a=(n=ae(s))===null||n===void 0?void 0:n.unit;if(a)return`${i} (${es(a).join("-")})`}else if(o)return xt(o)?`${i} for max ${o.argmax}`:st(o)?`${i} for min ${o.argmin}`:`${zn(o)} of ${i}`;return i}function Gp(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(xt(t))return`${r} for argmax(${t.argmax})`;if(st(t))return`${r} for argmin(${t.argmin})`;const s=ae(i),o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||U(n)&&"bin";return o?`${o.toUpperCase()}(${r})`:r}const wc=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Gp(e);default:return qp(e,t)}};let $c=wc;function Ec(e){$c=e}function Vp(){Ec(wc)}function gn(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,s;const o=(r=$s(e))===null||r===void 0?void 0:r.title;if(!j(e))return o;const a=e,c=i?Es(a,t):void 0;return n?Y(o,a.title,c):(s=o??a.title)!==null&&s!==void 0?s:c}function $s(e){return ws(e)&&e.axis?e.axis:jc(e)&&e.legend?e.legend:Os(e)&&e.header?e.header:void 0}function Es(e,t){return $c(e,t)}function qi(e){var t;if(Sc(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=$s(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function Xp(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(_s(e)&&S(e.sort))return"ordinal";const{aggregate:i,bin:r,timeUnit:s}=e;if(s)return"temporal";if(r||i&&!xt(i)&&!st(i))return"quantitative";if(Gt(e)&&((n=e.scale)===null||n===void 0?void 0:n.type))switch(fs[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Ve(e){return j(e)?e:Bi(e)?e.condition:void 0}function J(e){return E(e)?e:Wi(e)?e.condition:void 0}function kc(e,t,n,i={}){if(F(e)||X(e)||Tn(e)){const r=F(e)?"string":X(e)?"number":"boolean";return v(qd(t,r,e)),{value:e}}return E(e)?Gi(e,t,n,i):Wi(e)?Object.assign(Object.assign({},e),{condition:Gi(e.condition,t,n,i)}):e}function Gi(e,t,n,i){if(Sc(e)){const{format:r,formatType:s}=e,o=xs(e,["format","formatType"]);if(qt(s)&&!n.customFormatTypes)return v(Aa(t)),Gi(o,t,n,i)}else{const r=ws(e)?"axis":jc(e)?"legend":Os(e)?"header":null;if(r&&e[r]){const s=e[r],{format:o,formatType:a}=s,c=xs(s,["format","formatType"]);if(qt(a)&&!n.customFormatTypes)return v(Aa(t)),Gi(Object.assign(Object.assign({},e),{[r]:c}),t,n,i)}}return j(e)?ks(e,t,i):Yp(e)}function Yp(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=X(n)?"quantitative":F(n)?"nominal":Bt(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function ks(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:o}=e,a=Object.assign({},e);if(!n&&i&&!Hr(i)&&!xt(i)&&!st(i)&&(v(Vd(i)),delete a.aggregate),r&&(a.timeUnit=ae(r)),o&&(a.field=`${o}`),U(s)&&(a.bin=Vi(s,t)),oe(s)&&!Be(t)&&v(wg(t)),_e(a)){const{type:c}=a,l=Xg(c);c!==l&&(a.type=l),c!=="quantitative"&&(ga(i)&&(v(Gd(c,i)),a.type="quantitative"))}else if(!la(t)){const c=Xp(a,t);a.type=c}if(_e(a)){const{compatible:c,warning:l}=Kp(a,t)||{};c===!1&&v(l)}if(_s(a)&&F(a.sort)){const{sort:c}=a;if(mc(c))return Object.assign(Object.assign({},a),{sort:{encoding:c}});const l=c.substr(1);if(c.charAt(0)==="-"&&mc(l))return Object.assign(Object.assign({},a),{sort:{encoding:l,order:"descending"}})}if(Os(a)){const{header:c}=a;if(c){const{orient:l}=c,u=xs(c,["orient"]);if(l)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},u),{labelOrient:c.labelOrient||l,titleOrient:c.titleOrient||l})})}}return a}function Vi(e,t){return Tn(e)?{maxbins:ha(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:ha(t)}):e}const pn={compatible:!0};function Kp(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Ze:case Je:case xi:return Hi(e)?pn:{compatible:!1,warning:Qd(t)};case G:case Q:case ue:case De:case Me:case Mn:case Bn:case _i:case Lt:case ji:case Si:case zt:case we:case Re:case wi:return pn;case Le:case ve:case ze:case $e:return n!==Wt?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:pn;case it:case pt:case ht:case mt:case nt:case tt:case et:case Se:case Ie:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:pn;case fe:case bt:return!Hi(e)&&!Wp(e)?{compatible:!1,warning:Zd(t)}:pn;case Un:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:pn}}function hn(e){const{formatType:t}=qi(e);return t==="time"||!t&&Qp(e)}function Qp(e){return e&&(e.type==="temporal"||j(e)&&!!e.timeUnit)}function Xi(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var s;const o=t&&((s=ae(t))===null||s===void 0?void 0:s.unit);let a=o||n==="temporal",c;return Wn(e)?c=e.expr:w(e)?c=e.signal:Bt(e)?(a=!0,c=Hn(e)):(F(e)||X(e))&&(a&&(c=`datetime(${M(e)})`,Lg(o)&&((X(e)&&e<1e4||F(e)&&isNaN(Date.parse(e)))&&(c=Hn({[o]:e}))))),c?i&&a?`time(${c})`:c:r?void 0:M(e)}function Cc(e,t){const{type:n}=e;return t.map(i=>{const r=Xi(i,{timeUnit:j(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function Yn(e,t){return U(e.bin)?Ot(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const Nc={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function Kn(e){return e&&e.condition}const Fc=["domain","grid","labels","ticks","title"],Zp={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Pc={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},Jp=Object.assign(Object.assign({},Pc),{style:1,labelExpr:1,encoding:1});function Ac(e){return!!Jp[e]}const eh={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},Tc=y(eh);function ct(e){return"mark"in e}class Yi{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return ct(t)?Fp(t.mark)===this.name:!1}}var th=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Vt(e,t){const n=e&&e[t];return n?S(n)?on(n,i=>!!i.field):j(n)||Bi(n):!1}function Cs(e){return on(Jf,t=>{if(Vt(e,t)){const n=e[t];if(S(n))return on(n,i=>!!i.aggregate);{const i=Ve(n);return i&&!!i.aggregate}}return!1})}function Ic(e,t){const n=[],i=[],r=[],s=[],o={};return Ns(e,(a,c)=>{if(j(a)){const{field:l,aggregate:u,bin:f,timeUnit:d}=a,g=th(a,["field","aggregate","bin","timeUnit"]);if(u||d||f){const p=$s(a),m=p==null?void 0:p.title;let h=_(a,{forAs:!0});const x=Object.assign(Object.assign(Object.assign({},m?[]:{title:gn(a,t,{allowDisabling:!0})}),g),{field:h});if(u){let b;if(xt(u)?(b="argmax",h=_({op:"argmax",field:u.argmax},{forAs:!0}),x.field=`${h}.${l}`):st(u)?(b="argmin",h=_({op:"argmin",field:u.argmin},{forAs:!0}),x.field=`${h}.${l}`):u!=="boxplot"&&u!=="errorbar"&&u!=="errorband"&&(b=u),b){const O={op:b,as:h};l&&(O.field=l),s.push(O)}}else if(n.push(h),_e(a)&&U(f)){if(i.push({bin:f,field:l,as:h}),n.push(_(a,{binSuffix:"end"})),Yn(a,c)&&n.push(_(a,{binSuffix:"range"})),Be(c)){const b={field:`${h}_end`};o[`${c}2`]=b}x.bin="binned",la(c)||(x.type=Wt)}else if(d){r.push({timeUnit:d,field:l,as:h});const b=_e(a)&&a.type!==un&&"time";b&&(c===Mn||c===Lt?x.formatType=b:cd(c)?x.legend=Object.assign({formatType:b},x.legend):Be(c)&&(x.axis=Object.assign({formatType:b},x.axis)))}o[c]=x}else n.push(l),o[c]=e[c]}else o[c]=e[c]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function nh(e,t,n){const i=ud(t,n);if(i){if(i==="binned"){const r=e[t===Se?G:Q];return!!(j(r)&&j(e[t])&&oe(r.bin))}}else return!1;return!0}function ih(e,t,n,i){return y(e).reduce((r,s)=>{if(!ca(s))return v(Kd(s)),r;const o=e[s];if(s==="angle"&&t==="arc"&&!e.theta&&(v(Hd),s=we),!nh(e,s,t))return v(Ni(s,t)),r;if(s===nt&&t==="line"){const a=Ve(e[s]);if(a==null?void 0:a.aggregate)return v(Yd),r}if(s===ue&&(n?"fill"in e:"stroke"in e))return v(Ia("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if(s===Bn||s===Un&&!S(o)&&!ke(o)||s===Lt&&S(o))o&&(r[s]=V(o).reduce((a,c)=>(j(c)?a.push(ks(c,s)):v(Yr(c,s)),a),[]));else{if(s===Lt&&o===null)r[s]=null;else if(!j(o)&&!wt(o)&&!ke(o)&&!Ui(o)&&!w(o))return v(Yr(o,s)),r;r[s]=kc(o,s,i)}return r},{})}function Ki(e,t){const n={};for(const i of y(e)){const r=kc(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function rh(e){const t=[];for(const n of y(e))if(Vt(e,n)){const i=e[n],r=V(i);for(const s of r)j(s)?t.push(s):Bi(s)&&t.push(s.condition)}return t}function Ns(e,t,n){if(!e)return;for(const i of y(e)){const r=e[i];if(S(r))for(const s of r)t.call(n,s,i);else t.call(n,r,i)}}function sh(e,t,n,i){return e?y(e).reduce((r,s)=>{const o=e[s];return S(o)?o.reduce((a,c)=>t.call(i,a,c,s),r):t.call(i,r,o,s)},n):n}function Rc(e,t){return y(t).reduce((n,i)=>{switch(i){case G:case Q:case ji:case wi:case Si:case Se:case Ie:case we:case tt:case Re:case et:case ze:case Le:case $e:case ve:case Mn:case fe:case zt:case Lt:return n;case Un:if(e==="line"||e==="trail")return n;case Bn:case _i:{const r=t[i];if(S(r)||j(r))for(const s of V(r))s.aggregate||n.push(_(s,{}));return n}case nt:if(e==="trail")return n;case ue:case De:case Me:case it:case pt:case ht:case bt:case mt:{const r=Ve(t[i]);return r&&!r.aggregate&&n.push(_(r,{})),n}}},[])}var zc=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function oh(e){const{tooltip:t}=e,n=zc(e,["tooltip"]);if(!t)return{filteredEncoding:n};let i,r;if(S(t)){for(const s of t)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return S(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function Fs(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:o,titlePrefix:a})=>{const c=i?` of ${Ps(t)}`:"";return{field:o+t.field,type:t.type,title:w(a)?{signal:`${a}"${escape(c)}"`}:a+c}}),s=rh(n).map(Up);return{tooltip:[...r,...Te(s,I)]}}function Ps(e){const{title:t,field:n}=e;return Y(t,n)}function As(e,t,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:c,positionPrefix:l,endPositionPrefix:u=void 0,extraEncoding:f={}})=>{const d=Ps(n);return Lc(e,a,r,{mark:c,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:`${l}_${n.field}`,type:n.type},d!==void 0?{title:d}:{}),s!==void 0?{scale:s}:{}),o!==void 0?{axis:o}:{})},F(u)?{[`${t}2`]:{field:`${u}_${n.field}`}}:{}),i),f)})}}function Lc(e,t,n,i){const{clip:r,color:s,opacity:o}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),r?{clip:r}:{}),s?{color:s}:{}),o?{opacity:o}:{}),He(i.mark)?i.mark:{type:i.mark}),{style:`${a}-${t}`}),Tn(e[t])?{}:e[t])})]:[]}function Dc(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",s=i[r],o=i[`${r}2`],a=i[`${r}Error`],c=i[`${r}Error2`];return{continuousAxisChannelDef:Qi(s,n),continuousAxisChannelDef2:Qi(o,n),continuousAxisChannelDefError:Qi(a,n),continuousAxisChannelDefError2:Qi(c,n),continuousAxis:r}}function Qi(e,t){if(e==null?void 0:e.aggregate){const{aggregate:n}=e,i=zc(e,["aggregate"]);return n!==t&&v(Sg(n,t)),i}else return e}function Mc(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(He(n)&&n.orient)return n.orient;if(Ge(r)){if(Ge(s)){const o=j(r)&&r.aggregate,a=j(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return hn(s)&&!hn(r)?"horizontal":"vertical"}return"horizontal"}else{if(Ge(s))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}var Zi=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ji="boxplot",ah=["box","median","outliers","rule","ticks"],ch=new Yi(Ji,Bc);function Uc(e){return X(e)?"tukey":e}function Bc(e,{config:t}){var n,i;e=Object.assign(Object.assign({},e),{encoding:Ki(e.encoding,t)});const{mark:r,encoding:s,params:o,projection:a}=e,c=Zi(e,["mark","encoding","params","projection"]),l=He(r)?r:{type:r};o&&v(Na("boxplot"));const u=(n=l.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=z("size",l,t),d=Uc(u),{bins:g,timeUnits:p,transform:m,continuousAxisChannelDef:h,continuousAxis:x,groupby:b,aggregate:O,encodingWithoutContinuousAxis:$,ticksOrient:N,boxOrient:A,customTooltipWithoutAggregatedField:k}=lh(e,u,t),{color:T,size:ee}=$,Pe=Zi($,["color","size"]),fi=df=>As(l,x,h,df,t.boxplot),Qe=fi(Pe),Do=fi($),Er=fi(Object.assign(Object.assign({},Pe),ee?{size:ee}:{})),Nn=Fs([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],h,$),di={type:"tick",color:"black",opacity:1,orient:N,invalid:null,aria:!1},Jt=d==="min-max"?Nn:Fs([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],h,$),gi=[...Qe({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:Jt}),...Qe({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:Jt}),...Qe({partName:"ticks",mark:di,positionPrefix:"lower_whisker",extraEncoding:Jt}),...Qe({partName:"ticks",mark:di,positionPrefix:"upper_whisker",extraEncoding:Jt})],Fn=[...d!=="tukey"?gi:[],...Do({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:A,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:Nn}),...Er({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},W(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:N,aria:!1}),positionPrefix:"mid_box",extraEncoding:Nn})];if(d==="min-max")return Object.assign(Object.assign({},c),{transform:((i=c.transform)!==null&&i!==void 0?i:[]).concat(m),layer:Fn});const Pn=`datum["lower_box_${h.field}"]`,An=`datum["upper_box_${h.field}"]`,pi=`(${An} - ${Pn})`,Mo=`${Pn} - ${u} * ${pi}`,Uo=`${An} + ${u} * ${pi}`,hi=`datum["${h.field}"]`,lf={joinaggregate:Wc(h.field),groupby:b},Bo={transform:[{filter:`(${Mo} <= ${hi}) && (${hi} <= ${Uo})`},{aggregate:[{op:"min",field:h.field,as:`lower_whisker_${h.field}`},{op:"max",field:h.field,as:`upper_whisker_${h.field}`},{op:"min",field:`lower_box_${h.field}`,as:`lower_box_${h.field}`},{op:"max",field:`upper_box_${h.field}`,as:`upper_box_${h.field}`},...O],groupby:b}],layer:gi},uf=Zi(Pe,["tooltip"]),{scale:Wo,axis:ff}=h,Ho=Ps(h),qo=pe(ff,["title"]),Go=Lc(l,"outliers",t.boxplot,{transform:[{filter:`(${hi} < ${Mo}) || (${hi} > ${Uo})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[x]:Object.assign(Object.assign(Object.assign({field:h.field,type:h.type},Ho!==void 0?{title:Ho}:{}),Wo!==void 0?{scale:Wo}:{}),L(qo)?{}:{axis:qo})},uf),T?{color:T}:{}),k?{tooltip:k}:{})})[0];let mi;const Vo=[...g,...p,lf];return Go?mi={transform:Vo,layer:[Go,Bo]}:(mi=Bo,mi.transform.unshift(...Vo)),Object.assign(Object.assign({},c),{layer:[mi,{transform:m,layer:Fn}]})}function Wc(e){return[{op:"q1",field:e,as:`lower_box_${e}`},{op:"q3",field:e,as:`upper_box_${e}`}]}function lh(e,t,n){const i=Mc(e,Ji),{continuousAxisChannelDef:r,continuousAxis:s}=Dc(e,i,Ji),o=r.field,a=Uc(t),c=[...Wc(o),{op:"median",field:o,as:`mid_box_${o}`},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:`iqr_${o}`},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:`upper_whisker_${o}`},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:`lower_whisker_${o}`}],u=e.encoding,f=s,d=u[f],g=Zi(u,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:m}=oh(g),{bins:h,timeUnits:x,aggregate:b,groupby:O,encoding:$}=Ic(m,n),N=i==="vertical"?"horizontal":"vertical",A=i,k=[...h,...x,{aggregate:[...b,...c],groupby:O},...l];return{bins:h,timeUnits:x,transform:k,groupby:O,aggregate:b,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:$,ticksOrient:N,boxOrient:A,customTooltipWithoutAggregatedField:p}}var Hc=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ts="errorbar",uh=["ticks","rule"],fh=new Yi(Ts,qc);function qc(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Ki(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:c,tooltipEncoding:l}=Gc(e,Ts,t);delete s.size;const u=As(a,r,i,s,t.errorbar),f=a.thickness,d=a.size,g=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},f!==void 0?{thickness:f}:{}),d!==void 0?{size:d}:{}),p=[...u({partName:"ticks",mark:g,positionPrefix:"lower",extraEncoding:l}),...u({partName:"ticks",mark:g,positionPrefix:"upper",extraEncoding:l}),...u({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},f!==void 0?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},c),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function dh(e,t){const{encoding:n}=e;if(gh(n))return{orient:Mc(e,t),inputType:"raw"};const i=ph(n),r=hh(n),s=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,c=n.y2;if(E(a)&&E(c))throw new Error(`${t} cannot have both x2 and y2`);if(E(a)){if(Ge(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(E(c)){if(Ge(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,c=n.xError2,l=n.yError,u=n.yError2;if(E(c)&&!E(a))throw new Error(`${t} cannot have xError2 without xError`);if(E(u)&&!E(l))throw new Error(`${t} cannot have yError2 without yError`);if(E(a)&&E(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(E(a)){if(Ge(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(E(l)){if(Ge(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function gh(e){return(E(e.x)||E(e.y))&&!E(e.x2)&&!E(e.y2)&&!E(e.xError)&&!E(e.xError2)&&!E(e.yError)&&!E(e.yError2)}function ph(e){return E(e.x2)||E(e.y2)}function hh(e){return E(e.xError)||E(e.xError2)||E(e.yError)||E(e.yError2)}function Gc(e,t,n){var i;const{mark:r,encoding:s,params:o,projection:a}=e,c=Hc(e,["mark","encoding","params","projection"]),l=He(r)?r:{type:r};o&&v(Na(t));const{orient:u,inputType:f}=dh(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:g,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:h}=Dc(e,u,t),{errorBarSpecificAggregate:x,postAggregateCalculates:b,tooltipSummary:O,tooltipTitleWithFieldName:$}=mh(l,d,g,p,m,f,t,n),N=s,A=h,k=N[A],T=h==="x"?"x2":"y2",ee=N[T],Pe=h==="x"?"xError":"yError",fi=N[Pe],Qe=h==="x"?"xError2":"yError2",Do=N[Qe],Er=Hc(N,[typeof A=="symbol"?A:A+"",typeof T=="symbol"?T:T+"",typeof Pe=="symbol"?Pe:Pe+"",typeof Qe=="symbol"?Qe:Qe+""]),{bins:Nn,timeUnits:di,aggregate:Jt,groupby:gi,encoding:Fn}=Ic(Er,n),Pn=[...Jt,...x],An=f!=="raw"?[]:gi,pi=Fs(O,d,Fn,$);return{transform:[...(i=c.transform)!==null&&i!==void 0?i:[],...Nn,...di,...Pn.length===0?[]:[{aggregate:Pn,groupby:An}],...b],groupby:An,continuousAxisChannelDef:d,continuousAxis:h,encodingWithoutContinuousAxis:Fn,ticksOrient:u==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:c,tooltipEncoding:pi}}function mh(e,t,n,i,r,s,o,a){let c=[],l=[];const u=t.field;let f,d=!1;if(s==="raw"){const g=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,p=e.extent?e.extent:g==="mean"?"stderr":"iqr";if(g==="median"!==(p==="iqr")&&v(jg(g,p,o)),p==="stderr"||p==="stdev")c=[{op:p,field:u,as:`extent_${u}`},{op:g,field:u,as:`center_${u}`}],l=[{calculate:`datum["center_${u}"] + datum["extent_${u}"]`,as:`upper_${u}`},{calculate:`datum["center_${u}"] - datum["extent_${u}"]`,as:`lower_${u}`}],f=[{fieldPrefix:"center_",titlePrefix:zn(g)},{fieldPrefix:"upper_",titlePrefix:Vc(g,p,"+")},{fieldPrefix:"lower_",titlePrefix:Vc(g,p,"-")}],d=!0;else{let m,h,x;p==="ci"?(m="mean",h="ci0",x="ci1"):(m="median",h="q1",x="q3"),c=[{op:h,field:u,as:`lower_${u}`},{op:x,field:u,as:`upper_${u}`},{op:m,field:u,as:`center_${u}`}],f=[{fieldPrefix:"upper_",titlePrefix:gn({field:u,aggregate:x,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:gn({field:u,aggregate:h,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:gn({field:u,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&v(_g(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:`upper_${u}`},{calculate:`datum["${u}"]`,as:`lower_${u}`}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:u}],l=[{calculate:`datum["${u}"] + datum["${i.field}"]`,as:`upper_${u}`}],r?l.push({calculate:`datum["${u}"] + datum["${r.field}"]`,as:`lower_${u}`}):l.push({calculate:`datum["${u}"] - datum["${i.field}"]`,as:`lower_${u}`}));for(const g of l)f.push({fieldPrefix:g.as.substring(0,6),titlePrefix:Rt(Rt(g.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:c,tooltipSummary:f,tooltipTitleWithFieldName:d}}function Vc(e,t,n){return`${zn(e)} ${n} ${t}`}const Is="errorband",bh=["band","borders"],yh=new Yi(Is,Xc);function Xc(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Ki(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:c}=Gc(e,Is,t),l=o,u=As(l,r,i,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},g={type:f?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),g=Object.assign(Object.assign(Object.assign({},g),p),{aria:!1})):l.interpolate?v(Da("interpolate")):l.tension&&v(Da("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...u({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c}),...u({partName:"borders",mark:g,positionPrefix:"lower",extraEncoding:c}),...u({partName:"borders",mark:g,positionPrefix:"upper",extraEncoding:c})]})}const Yc={};function Rs(e,t,n){const i=new Yi(e,t);Yc[e]={normalizer:i,parts:n}}function vh(){return y(Yc)}Rs(Ji,Bc,ah),Rs(Ts,qc,uh),Rs(Is,Xc,bh);const Oh=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],Kc={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},Qc={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},xh=y(Kc),_h=y(Qc),jh={header:1,headerRow:1,headerColumn:1,headerFacet:1},Zc=y(jh),Jc=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Sh={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},wh={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Qn="_vgsid_",$h={point:{on:"click",fields:[Qn],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function zs(e){return!!e&&(e==="legend"||!!e.legend)}function Ls(e){return zs(e)&&W(e)}function Ds(e){return!!e.select}var Eh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function el(e){const t=[];for(const n of e||[]){if(Ds(n))continue;const{expr:i,bind:r}=n,s=Eh(n,["expr","bind"]);if(r&&i){const o=Object.assign(Object.assign({},s),{bind:r,init:i});t.push(o)}else{const o=Object.assign(Object.assign(Object.assign({},s),i?{update:i}:{}),r?{bind:r}:{});t.push(o)}}return t}function kh(e){return er(e)||Us(e)||Ms(e)}function Ms(e){return"concat"in e}function er(e){return"vconcat"in e}function Us(e){return"hconcat"in e}function Xe(e){return W(e)&&e.step!==void 0}function tl(e){return e.view||e.width||e.height}const nl=20,Ch={align:1,bounds:1,center:1,columns:1,spacing:1},Nh=y(Ch);function Fh(e,t,n){var i,r;const s=n[t],o={},{spacing:a,columns:c}=s;a!==void 0&&(o.spacing=a),c!==void 0&&((Mi(e)&&!Xn(e.facet)||Ms(e))&&(o.columns=c)),er(e)&&(o.columns=1);for(const l of Nh)if(e[l]!==void 0)if(l==="spacing"){const u=e[l];o[l]=X(u)?u:{row:(i=u.row)!==null&&i!==void 0?i:a,column:(r=u.column)!==null&&r!==void 0?r:a}}else o[l]=e[l];return o}var Ph=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Bs(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function tr(e,t){const n=Zn(e,t);return Xe(n)?n.step:il}function Zn(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return Y(i,{step:e.step})}const il=20,Ah={continuousWidth:200,continuousHeight:200,step:il},Th={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:Ah,mark:wp,arc:{},area:{},bar:kp,circle:{},geoshape:{},image:{},line:{},point:{},rect:Cp,rule:{color:"black"},square:{},text:{color:"black"},tick:Np,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:cp,projection:{},legend:Sh,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:$h,style:{},title:{},facet:{spacing:nl},concat:{spacing:nl}},lt=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],rl={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},sl={blue:lt[0],orange:lt[1],red:lt[2],teal:lt[3],green:lt[4],yellow:lt[5],purple:lt[6],pink:lt[7],brown:lt[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Ih(e={}){return{signals:[{name:"color",value:W(e)?Object.assign(Object.assign({},sl),e):sl}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Rh(e){return{signals:[{name:"fontSize",value:W(e)?Object.assign(Object.assign({},rl),e):rl}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function zh(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function ol(e){const t=y(e||{}),n={};for(const i of t){const r=e[i];n[i]=Kn(r)?ba(r):he(r)}return n}function Lh(e){const t=y(e),n={};for(const i of t)n[i]=ol(e[i]);return n}const Dh=[...sc,...Tc,...Zc,"background","padding","legend","lineBreak","scale","style","title","view"];function al(e={}){const{color:t,font:n,fontSize:i,selection:r}=e,s=Ph(e,["color","font","fontSize","selection"]),o=Xo({},C(Th),n?zh(n):{},t?Ih(t):{},i?Rh(i):{},s||{});r&&Of(o,"selection",r,!0);const a=pe(o,Dh);for(const c of["background","lineBreak","padding"])o[c]&&(a[c]=he(o[c]));for(const c of sc)o[c]&&(a[c]=de(o[c]));for(const c of Tc)o[c]&&(a[c]=ol(o[c]));for(const c of Zc)o[c]&&(a[c]=de(o[c]));return o.legend&&(a.legend=de(o.legend)),o.scale&&(a.scale=de(o.scale)),o.style&&(a.style=Lh(o.style)),o.title&&(a.title=de(o.title)),o.view&&(a.view=de(o.view)),a}const Mh=["view",...ic],Uh=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Bh=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},Sp);function Wh(e){e=C(e);for(const t of Uh)delete e[t];if(e.axis)for(const t in e.axis)Kn(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Oh)delete e.legend[t];if(e.mark){for(const t of rc)delete e.mark[t];e.mark.tooltip&&W(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(el(e.params)),delete e.params);for(const t of Mh){for(const i of rc)delete e[t][i];const n=Bh[t];if(n)for(const i of n)delete e[t][i];qh(e,t)}for(const t of vh())delete e[t];Hh(e);for(const t in e)W(e[t])&&L(e[t])&&delete e[t];return L(e)?void 0:e}function Hh(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=ma(e.title);L(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),L(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),L(i)?delete e.title:e.title=i}function qh(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},r),e.style[n??t]);L(s)||(e.style[n??t]=s),i||delete e[t]}function nr(e){return"layer"in e}function Gh(e){return"repeat"in e}function Vh(e){return!S(e.repeat)&&e.repeat.layer}var Xh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Ws{map(t,n){return Mi(t)?this.mapFacet(t,n):Gh(t)?this.mapRepeat(t,n):Us(t)?this.mapHConcat(t,n):er(t)?this.mapVConcat(t,n):Ms(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(nr(t))return this.mapLayer(t,n);if(ct(t))return this.mapUnit(t,n);throw new Error(Vr(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(i=>this.map(i,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(i=>this.map(i,n))})}mapConcat(t,n){const{concat:i}=t,r=Xh(t,["concat"]);return Object.assign(Object.assign({},r),{concat:i.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const Yh={zero:1,center:1,normalize:1};function Kh(e){return e in Yh}const Qh=new Set([Ja,Ai,Pi,Ri,Ii,ps,hs,Ti,ec,gs]),Zh=new Set([Ai,Pi,Ja]);function mn(e){return j(e)&&js(e)==="quantitative"&&!e.bin}function cl(e,t){var n,i;const r=t==="x"?"y":"radius",s=e[t],o=e[r];if(j(s)&&j(o))if(mn(s)&&mn(o)){if(s.stack)return t;if(o.stack)return r;const a=j(s)&&!!s.aggregate,c=j(o)&&!!o.aggregate;if(a!==c)return a?t:r;{const l=(n=s.scale)===null||n===void 0?void 0:n.type,u=(i=o.scale)===null||i===void 0?void 0:i.type;if(l&&l!=="linear")return r;if(u&&u!=="linear")return t}}else{if(mn(s))return t;if(mn(o))return r}else{if(mn(s))return t;if(mn(o))return r}return}function Jh(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function ll(e,t,n={}){var i,r;const s=He(e)?e.type:e;if(!Qh.has(s))return null;const o=cl(t,"x")||cl(t,"theta");if(!o)return null;const a=t[o],c=j(a)?_(a,{}):void 0;let l=Jh(o),u=t[l],f=j(u)?_(u,{}):void 0;f===c&&(f=void 0,u=void 0,l=void 0);const d=sd.reduce((p,m)=>{if(m!=="tooltip"&&Vt(t,m)){const h=t[m];for(const x of V(h)){const b=Ve(x);if(b.aggregate)continue;const O=_(b,{});(!O||O!==f)&&p.push({channel:m,fieldDef:b})}}return p},[]);let g;if(a.stack!==void 0?Tn(a.stack)?g=a.stack?"zero":null:g=a.stack:Zh.has(s)&&(g="zero"),!g||!Kh(g))return null;if(Cs(t)&&d.length===0)return null;if(((i=a==null?void 0:a.scale)===null||i===void 0?void 0:i.type)&&((r=a==null?void 0:a.scale)===null||r===void 0?void 0:r.type)!==Z.LINEAR){if(n.disallowNonLinearStack)return null;v(vg(a.scale.type))}return E(t[rt(o)])?(a.stack!==void 0&&v(yg(o)),null):(j(a)&&a.aggregate&&!P(bd,a.aggregate)&&v(Og(a.aggregate)),{groupbyChannel:u?l:void 0,groupbyField:f,fieldChannel:o,impute:a.impute===null?!1:St(s),stackBy:d,offset:g})}var ul=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function em(e){const t=ul(e,["point","line"]);return y(t).length>1?t:t.type}function tm(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:pe(e[t],["point","line"])}));return e}function Hs(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?W(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?W(t.point)?t.point:{}:void 0}function fl(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class nm{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(ct(t)){const{mark:i,encoding:r}=t,s=He(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!Hs(s,n[s.type],r);case"area":return!!Hs(s,n[s.type],r)||!!fl(s,n[s.type])}}return!1}run(t,n,i){const{config:r}=n,{params:s,projection:o,mark:a,encoding:c}=t,l=ul(t,["params","projection","mark","encoding"]),u=Ki(c,r),f=He(a)?a:{type:a},d=Hs(f,r[f.type],u),g=f.type==="area"&&fl(f,r[f.type]),p=[Object.assign(Object.assign({},s?{params:s}:{}),{mark:em(Object.assign(Object.assign({},f.type==="area"&&f.opacity===void 0&&f.fillOpacity===void 0?{opacity:.7}:{}),f)),encoding:pe(u,["shape"])})],m=ll(f,u);let h=u;if(m){const{fieldChannel:x,offset:b}=m;h=Object.assign(Object.assign({},u),{[x]:Object.assign(Object.assign({},u[x]),b?{stack:b}:{})})}return g&&p.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},sn(f,["clip","interpolate","tension","tooltip"])),g),encoding:h})),d&&p.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},sn(f,["clip","tooltip"])),d),encoding:h})),i(Object.assign(Object.assign({},l),{layer:p}),Object.assign(Object.assign({},n),{config:tm(r)}))}}var im=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function rm(e,t){return t?Xn(e)?hl(e,t):dl(e,t):e}function qs(e,t){return t?hl(e,t):e}function Gs(e,t,n){const i=t[e];if(Dp(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});v(zd(i.repeat));return}return t}function dl(e,t){if(e=Gs("field",e,t),e===void 0)return;if(e===null)return null;if(_s(e)&&qe(e.sort)){const n=Gs("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}function gl(e,t){if(j(e))return dl(e,t);{const n=Gs("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function pl(e,t){if(E(e)){const n=gl(e,t);if(n)return n;if(Ui(e))return{condition:e.condition}}else{if(Wi(e)){const n=gl(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const i=im(e,["condition"]);return i}}return e}return}function hl(e,t){const n={};for(const i in e)if(en(e,i)){const r=e[i];if(S(r))n[i]=r.map(s=>pl(s,t)).filter(s=>s);else{const s=pl(r,t);s!==void 0&&(n[i]=s)}}return n}class sm{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(ct(t)){const{encoding:n,mark:i}=t;if(i==="line"||He(i)&&i.type==="line")for(const r of id){const s=Dt(r),o=n[s];if(n[r]&&(j(o)&&!oe(o.bin)||wt(o)))return!0}}return!1}run(t,n,i){const{encoding:r,mark:s}=t;return v(tg(!!r.x2,!!r.y2)),i(Object.assign(Object.assign({},t),{mark:W(s)?Object.assign(Object.assign({},s),{type:"rule"}):"rule"}),n)}}var $t=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class om extends Ws{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[ch,fh,yh,new nm,new sm]}map(t,n){if(ct(t)){const i=Vt(t.encoding,Ze),r=Vt(t.encoding,Je),s=Vt(t.encoding,xi);if(i||r||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,s=qs(t.encoding,n.repeater),o=Object.assign(Object.assign({},t),s?{encoding:s}:{});if(i||r)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const c of this.nonFacetUnitNormalizers)if(c.hasMatchingType(o,n.config))return c.run(o,n,a);return o}mapRepeat(t,n){return Vh(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r}=t,s=$t(t,["repeat","spec"]),{row:o,column:a,layer:c}=i,{repeater:l={},repeaterPrefix:u=""}=n;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:c},spec:r}}),n):Object.assign(Object.assign({},s),{layer:c.map(f=>{const d=Object.assign(Object.assign({},l),{layer:f}),g=`${(r.name||"")+u}child__layer_${H(f)}`,p=this.mapLayerOrUnit(r,Object.assign(Object.assign({},n),{repeater:d,repeaterPrefix:g}));return p.name=g,p})})}mapNonLayerRepeat(t,n){var i;const{repeat:r,spec:s,data:o}=t,a=$t(t,["repeat","spec","data"]);!S(r)&&t.columns&&(t=pe(t,["columns"]),v(Fa("repeat")));const c=[],{repeater:l={},repeaterPrefix:u=""}=n,f=!S(r)&&r.row||[l?l.row:null],d=!S(r)&&r.column||[l?l.column:null],g=S(r)&&r||[l?l.repeat:null];for(const m of g)for(const h of f)for(const x of d){const b={repeat:m,row:h,column:x,layer:l.layer},O=(s.name||"")+u+"child__"+(S(r)?`${H(m)}`:(r.row?`row_${H(h)}`:"")+(r.column?`column_${H(x)}`:"")),$=this.map(s,Object.assign(Object.assign({},n),{repeater:b,repeaterPrefix:O}));$.name=O,c.push(pe($,["data"]))}const p=S(r)?t.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(i=s.data)!==null&&i!==void 0?i:o,align:"all"},a),{columns:p,concat:c})}mapFacet(t,n){const{facet:i}=t;return Xn(i)&&t.columns&&(t=pe(t,["columns"]),v(Fa("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:s,parentProjection:o,config:a}=n,c=bl({parentProjection:o,projection:r}),l=ml({parentEncoding:s,encoding:qs(i,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),c?{projection:c}:{}),l?{encoding:l}:{}),{config:a})}mapFacetedUnit(t,n){const i=t.encoding,{row:r,column:s,facet:o}=i,a=$t(i,["row","column","facet"]),{mark:c,width:l,projection:u,height:f,view:d,params:g,encoding:p}=t,m=$t(t,["mark","width","projection","height","view","params","encoding"]),{facetMapping:h,layout:x}=this.getFacetMappingAndLayout({row:r,column:s,facet:o},n),b=qs(a,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},m),x),{facet:h,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),f?{height:f}:{}),d?{view:d}:{}),u?{projection:u}:{}),{mark:c,encoding:b}),g?{params:g}:{})}),n)}getFacetMappingAndLayout(t,n){var i;const{row:r,column:s,facet:o}=t;if(r||s){o&&v(Jd([...r?[Ze]:[],...s?[Je]:[]]));const a={},c={};for(const l of[Ze,Je]){const u=t[l];if(u){const f=$t(u,["align","center","spacing","columns"]);a[l]=f;for(const d of["align","center","spacing"])u[d]!==void 0&&((i=c[d])!==null&&i!==void 0||(c[d]={}),c[d][l]=u[d])}}return{facetMapping:a,layout:c}}else{const{align:a,center:c,spacing:l,columns:u}=o,f=$t(o,["align","center","spacing","columns"]);return{facetMapping:rm(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),c?{center:c}:{}),l?{spacing:l}:{}),u?{columns:u}:{})}}}mapLayer(t,n){var{parentEncoding:i,parentProjection:r}=n,s=$t(n,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,c=$t(t,["encoding","projection"]),l=Object.assign(Object.assign({},s),{parentEncoding:ml({parentEncoding:i,encoding:o,layer:!0}),parentProjection:bl({parentProjection:r,projection:a})});return super.mapLayer(c,l)}}function ml({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...y(e),...y(t)]);for(const s of r){const o=t[s],a=e[s];if(E(o)){const c=Object.assign(Object.assign({},a),o);i[s]=c}else Wi(o)?i[s]=Object.assign(Object.assign({},o),{condition:Object.assign(Object.assign({},a),o.condition)}):o||o===null?i[s]=o:(n||ke(a)||w(a)||E(a)||S(a))&&(i[s]=a)}}else i=t;return!i||L(i)?void 0:i}function bl(e){const{parentProjection:t,projection:n}=e;return t&&n&&v(Wd({parentProjection:t,projection:n})),n??t}function Vs(e){return"filter"in e}function am(e){return(e==null?void 0:e.stop)!==void 0}function yl(e){return"lookup"in e}function cm(e){return"data"in e}function lm(e){return"param"in e}function um(e){return"pivot"in e}function fm(e){return"density"in e}function dm(e){return"quantile"in e}function gm(e){return"regression"in e}function pm(e){return"loess"in e}function hm(e){return"sample"in e}function mm(e){return"window"in e}function bm(e){return"joinaggregate"in e}function ym(e){return"flatten"in e}function vm(e){return"calculate"in e}function vl(e){return"bin"in e}function Om(e){return"impute"in e}function xm(e){return"timeUnit"in e}function _m(e){return"aggregate"in e}function jm(e){return"stack"in e}function Sm(e){return"fold"in e}function wm(e){return e.map(t=>Vs(t)?{filter:rn(t.filter,Vg)}:t)}var Et=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class $m extends Ws{map(t,n){var i,r;return(i=n.emptySelections)!==null&&i!==void 0||(n.emptySelections={}),(r=n.selectionPredicates)!==null&&r!==void 0||(n.selectionPredicates={}),t=Ol(t,n),super.map(t,n)}mapLayerOrUnit(t,n){if(t=Ol(t,n),t.encoding){const i={};for(const[r,s]of gt(t.encoding))i[r]=xl(s,n);t=Object.assign(Object.assign({},t),{encoding:i})}return super.mapLayerOrUnit(t,n)}mapUnit(t,n){const i=t,{selection:r}=i,s=Et(i,["selection"]);return r?Object.assign(Object.assign({},s),{params:gt(r).map(([o,a])=>{var c;const l=a,{init:u,bind:f,empty:d}=l,g=Et(l,["init","bind","empty"]);g.type==="single"?(g.type="point",g.toggle=!1):g.type==="multi"&&(g.type="point"),n.emptySelections[o]=d!=="none";for(const p of ne((c=n.selectionPredicates[o])!==null&&c!==void 0?c:{}))p.empty=d!=="none";return{name:o,value:u,select:g,bind:f}})}):t}}function Ol(e,t){const{transform:n}=e,i=Et(e,["transform"]);if(n){const r=n.map(s=>{if(Vs(s))return{filter:Xs(s,t)};if(vl(s)&&Mt(s.bin))return Object.assign(Object.assign({},s),{bin:_l(s.bin)});if(yl(s)){const o=s.from,{selection:a}=o,c=Et(o,["selection"]);return a?Object.assign(Object.assign({},s),{from:Object.assign({param:a},c)}):s}return s});return Object.assign(Object.assign({},i),{transform:r})}return e}function xl(e,t){var n,i;const r=C(e);if(j(r)&&Mt(r.bin)&&(r.bin=_l(r.bin)),Gt(r)&&((i=(n=r.scale)===null||n===void 0?void 0:n.domain)===null||i===void 0?void 0:i.selection)){const s=r.scale.domain,{selection:o}=s,a=Et(s,["selection"]);r.scale.domain=Object.assign(Object.assign({},a),o?{param:o}:{})}if(Ui(r))if(Ko(r.condition))r.condition=r.condition.map(s=>{const{selection:o,param:a,test:c}=s,l=Et(s,["selection","param","test"]);return a?s:Object.assign(Object.assign({},l),{test:Xs(s,t)})});else{const s=xl(r.condition,t),{selection:o,param:a,test:c}=s,l=Et(s,["selection","param","test"]);r.condition=a?r.condition:Object.assign(Object.assign({},l),{test:Xs(r.condition,t)})}return r}function _l(e){const t=e.extent;if(t==null?void 0:t.selection){const{selection:n}=t,i=Et(t,["selection"]);return Object.assign(Object.assign({},e),{extent:Object.assign(Object.assign({},i),{param:n})})}return e}function Xs(e,t){const n=i=>rn(i,r=>{var s,o,a;const c=(s=t.emptySelections[r])!==null&&s!==void 0?s:!0,l={param:r,empty:c};return(o=(a=t.selectionPredicates)[r])!==null&&o!==void 0||(a[r]=[]),t.selectionPredicates[r].push(l),l});return e.selection?n(e.selection):rn(e.test||e.filter,i=>i.selection?n(i.selection):i)}class Ys extends Ws{map(t,n){var i;const r=(i=n.selections)!==null&&i!==void 0?i:[];if(t.params&&!ct(t)){const s=[];for(const o of t.params)Ds(o)?r.push(o):s.push(o);t.params=s}return n.selections=r,super.map(t,jl(t,n))}mapUnit(t,n){var i;const r=n.selections;if(!r||!r.length)return t;const s=((i=n.path)!==null&&i!==void 0?i:[]).concat(t.name),o=[];for(const a of r)if(!a.views||!a.views.length)o.push(a);else for(const c of a.views)(bi(c)&&(c===t.name||s.indexOf(c)>=0)||Ko(c)&&c.map(l=>s.indexOf(l)).every((l,u,f)=>l!==-1&&(u===0||l>f[u-1])))&&o.push(a);return o.length&&(t.params=o),t}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=Ys.prototype[e];Ys.prototype[e]=function(n,i){return t.call(this,n,jl(n,i))}}function jl(e,t){var n;return e.name?Object.assign(Object.assign({},t),{path:((n=t.path)!==null&&n!==void 0?n:[]).concat(e.name)}):t}function Sl(e,t){t===void 0&&(t=al(e.config));const n=Nm(e,t),{width:i,height:r}=e,s=Fm(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const Em=new om,km=new $m,Cm=new Ys;function Nm(e,t={}){const n={config:t};return Cm.map(Em.map(km.map(e,n),n),n)}function wl(e){return F(e)?{type:e}:e??{}}function Fm(e,t,n){let{width:i,height:r}=t;const s=ct(e)||nr(e),o={};s?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(v($a("width")),i=void 0),r=="container"&&(v($a("height")),r=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?wl(n.autosize):{}),wl(e.autosize));return a.type==="fit"&&!s&&(v(Ed),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&v(Ea("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&v(Ea("height")),Ae(a,{type:"pad"})?void 0:a}function Pm(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function Am(e){return e?`fit-${$i(e)}`:"fit"}const Tm=["background","padding"];function $l(e,t){const n={};for(const i of Tm)e&&e[i]!==void 0&&(n[i]=he(e[i]));return t&&(n.params=e.params),n}class ut{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new ut(C(this.explicit),C(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return Y(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,{value:n,explicit:i}){n!==void 0&&this.set(t,n,i)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,{explicit:n,implicit:i}){n[t]!==void 0?this.set(t,n[t],!0):i[t]!==void 0&&this.set(t,i[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of y(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function ft(e){return{explicit:!0,value:e}}function be(e){return{explicit:!1,value:e}}function El(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:ir(t,n,i,r)}}function ir(e,t,n,i){return e.explicit&&t.explicit&&v(fg(n,i,e.value,t.value)),e}function kt(e,t,n,i,r=ir){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Ae(e.value,t.value)?e:r(e,t,n,i)}class Im extends ut{constructor(t={},n={},i=!1){super(t,n);this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function bn(e){return"url"in e}function Jn(e){return"values"in e}function kl(e){return"name"in e&&!bn(e)&&!Jn(e)&&!Ct(e)}function Ct(e){return e&&(Cl(e)||Nl(e)||Ks(e))}function Cl(e){return"sequence"in e}function Nl(e){return"sphere"in e}function Ks(e){return"graticule"in e}var B;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(B||(B={}));var Rm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function yn(e,t=!0,n=bf){if(S(e)){const i=e.map(r=>yn(r,t,n));return t?`[${i.join(", ")}]`:i}else if(Bt(e))return n(t?Hn(e):Rg(e));return t?n(M(e)):e}function zm(e,t){var n;for(const i of ne((n=e.component.selection)!==null&&n!==void 0?n:{})){const r=i.name;let s=`${r}${Pt}, ${i.resolve==="global"?"true":`{unit: ${xn(e)}}`}`;for(const o of cr){if(!o.defined(i))continue;o.signals&&(t=o.signals(e,i,t)),o.modifyExpr&&(s=o.modifyExpr(e,i,s))}t.push({name:r+mb,on:[{events:{signal:i.name+Pt},update:`modify(${R(i.name+Xt)}, ${s})`}]})}return Qs(t)}function Lm(e,t){if(e.component.selection&&y(e.component.selection).length){const n=R(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:nn("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return Qs(t)}function Dm(e,t){var n;let i=!1;for(const r of ne((n=e.component.selection)!==null&&n!==void 0?n:{})){const s=r.name,o=R(s+Xt),a=t.filter(c=>c.name===s);if(a.length===0){const c=r.resolve==="global"?"union":r.resolve,l=r.type==="point"?", true, true)":")";t.push({name:r.name,update:`${Jl}(${o}, ${R(c)}${l}`})}i=!0;for(const c of cr)c.defined(r)&&c.topLevelSignals&&(t=c.topLevelSignals(e,r,t))}if(i){const r=t.filter(s=>s.name==="unit");r.length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return Qs(t)}function Mm(e,t){var n;const i=[...t];for(const r of ne((n=e.component.selection)!==null&&n!==void 0?n:{})){const s={name:r.name+Xt};if(r.init){const a=r.project.items.map(c=>{const l=Rm(c,["signals"]);return l});s.values=r.init.map(c=>({unit:xn(e,{escape:!1}),fields:a,values:yn(c,!1)}))}const o=i.filter(a=>a.name===r.name+Xt);o.length||i.push(s)}return i}function Fl(e,t){var n;for(const i of ne((n=e.component.selection)!==null&&n!==void 0?n:{}))for(const r of cr)r.defined(i)&&r.marks&&(t=r.marks(e,i,t));return t}function Um(e,t){for(const n of e.children)K(n)&&(t=Fl(n,t));return t}function Bm(e,t,n,i){const r=ru(e,t.param,t);return{signal:me(n.get("type"))&&S(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function Qs(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}class D{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.includes(t)){v(Md);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const i of this._children)i.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class le extends D{constructor(t,n,i,r){super(t,n);this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName=`clone_${this.debugName}`,t._source=this._source,t._name=`clone_${this._name}`,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${ta()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}var Pl=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Ye extends D{constructor(t,n){super(t);this.formula=n}clone(){return new Ye(null,C(this.formula))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s)=>{const{field:o,timeUnit:a}=s;if(a){const c=_(s,{forAs:!0});r[I({as:c,field:o,timeUnit:a})]={as:c,field:o,timeUnit:a}}return r},{});return L(i)?null:new Ye(t,i)}static makeFromTransform(t,n){const i=Object.assign({},n),{timeUnit:r}=i,s=Pl(i,["timeUnit"]),o=ae(r),a=Object.assign(Object.assign({},s),{timeUnit:o});return new Ye(t,{[I(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)this.formula[n]||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of gt(this.formula))t.has(r.as)||(n[i]=r);this.formula=n}producedFields(){return new Set(ne(this.formula).map(t=>t.as))}dependentFields(){return new Set(ne(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${I(this.formula)}`}assemble(){const t=[];for(const n of ne(this.formula)){const{field:i,as:r,timeUnit:s}=n,o=ae(s),{unit:a,utc:c}=o,l=Pl(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:ye(i),type:"timeunit"},a?{units:es(a)}:{}),c?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return t}}var Wm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const ei="_tuple_fields";class Hm{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const qm={defined:()=>!0,parse:(e,t,n)=>{var i;const r=t.name,s=(i=t.project)!==null&&i!==void 0?i:t.project=new Hm,o={},a={},c=new Set,l=(m,h)=>{const x=h==="visual"?m.channel:m.field;let b=H(`${r}_${x}`);for(let O=1;c.has(b);O++)b=H(`${r}_${x}_${O}`);return c.add(b),{[h]:b}},u=t.type,f=e.config.selection[u],d=n.value!==void 0?V(n.value):null;let{fields:g,encodings:p}=W(n.select)?n.select:{};if(!g&&!p&&d)for(const m of d){if(!W(m))continue;for(const h of y(m))nd(h)?(p||(p=[])).push(h):u==="interval"?(v(Rd),p=f.encodings):(g||(g=[])).push(h)}!g&&!p&&(p=f.encodings,"fields"in f&&(g=f.fields));for(const m of p??[]){const h=e.fieldDef(m);if(h){let x=h.field;if(h.aggregate){v(kd(m,h.aggregate));continue}else if(!x){v(Ca(m));continue}if(h.timeUnit){x=e.vgField(m);const b={timeUnit:h.timeUnit,as:x,field:h.field};a[I(b)]=b}if(!o[x]){let b="E";if(u==="interval"){const $=e.getScaleComponent(m).get("type");me($)&&(b="R")}else h.bin&&(b="R-RE");const O={field:x,channel:m,type:b};O.signals=Object.assign(Object.assign({},l(O,"data")),l(O,"visual")),s.items.push(o[x]=O),s.hasField[x]=s.hasChannel[m]=o[x]}}else v(Ca(m))}for(const m of g??[]){if(s.hasField[m])continue;const h={type:"E",field:m};h.signals=Object.assign({},l(h,"data")),s.items.push(h),s.hasField[m]=h}d&&(t.init=d.map(m=>s.items.map(h=>W(m)?m[h.channel]!==void 0?m[h.channel]:m[h.field]:m))),L(a)||(s.timeUnit=new Ye(null,a))},signals:(e,t,n)=>{const i=t.name+ei,r=n.filter(s=>s.name===i);return r.length>0?n:n.concat({name:i,value:t.project.items.map(s=>{const o=Wm(s,["signals","hasLegend"]);return o.field=ye(o.field),o})})}},Nt={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!Ot(r))continue;const s=e.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!me(o)){v(Fd);continue}s.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||Js(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let s=r.update;if(s.indexOf(Jl)>=0)r.update=`{${i.map(o=>`${R(ye(o.field))}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const a=`${R(ye(o.field))}: ${o.signals.data}`;s.includes(a)||(s=`${s.substring(0,s.length-1)}, ${a}}`)}r.update=s}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!Js(e))for(const i of t.scales){const r=n.filter(s=>s.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function Zs(e,t){const n=R(e.scaleName(t));return`domain(${n})`}function Js(e){var t;return e.parent&&kn(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:Js(e.parent.parent))}var Gm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const vn="_brush",eo="_scale_trigger",Vm={defined:e=>e.type==="interval",signals:(e,t,n)=>{const i=t.name,r=i+ei,s=Nt.defined(t),o=t.init?t.init[0]:null,a=[],c=[];if(t.translate&&!s){const u=`!event.item || event.item.mark.name !== ${R(i+vn)}`;Al(t,(f,d)=>{var g,p;const m=V((g=(p=d.between[0]).filter)!==null&&g!==void 0?g:p.filter=[]);return m.includes(u)||m.push(u),f})}t.project.items.forEach((u,f)=>{const d=u.channel;if(d!==G&&d!==Q){v("Interval selections only support x and y encoding channels.");return}const g=o?o[f]:null,p=Xm(e,t,u,g),m=u.signals.data,h=u.signals.visual,x=R(e.scaleName(d)),b=e.getScaleComponent(d).get("type"),O=me(b)?"+":"";n.push(...p),a.push(m),c.push({scaleName:e.scaleName(d),expr:`(!isArray(${m}) || (${O}invert(${x}, ${h})[0] === ${O}${m}[0] && ${O}invert(${x}, ${h})[1] === ${O}${m}[1]))`})}),!s&&c.length&&n.push({name:i+eo,value:{},on:[{events:c.map(u=>({scale:u.scaleName})),update:`${c.map(u=>u.expr).join(" && ")} ? ${i+eo} : {}`}]});const l=`unit: ${xn(e)}, fields: ${r}, values`;return n.concat(Object.assign(Object.assign({name:i+Pt},o?{init:`{${l}: ${yn(o)}}`}:{}),a.length?{on:[{events:[{signal:a.join(" || ")}],update:`${a.join(" && ")} ? {${l}: [${a}]} : null`}]}:{}))},marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,o=r&&r.signals.visual,a=s&&s.signals.visual,c=`data(${R(t.name+Xt)})`;if(Nt.defined(t)||!r&&!s)return n;const l={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const h of y(l))l[h]=[Object.assign({test:`${c}.length && ${c}[0].unit === ${xn(e)}`},l[h]),{value:0}];const u=t.mark,{fill:f,fillOpacity:d,cursor:g}=u,p=Gm(u,["fill","fillOpacity","cursor"]),m=y(p).reduce((h,x)=>(h[x]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(b=>b).join(" && "),value:p[x]},{value:null}],h),{});return[{name:`${i+vn}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:l}},...n,{name:i+vn,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},g?{cursor:{value:g}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),m)}}]}};function Xm(e,t,n,i){const r=n.channel,s=n.signals.visual,o=n.signals.data,a=Nt.defined(t),c=R(e.scaleName(r)),l=e.getScaleComponent(r),u=l?l.get("type"):void 0,f=m=>`scale(${c}, ${m})`,d=e.getSizeSignalRef(r===G?"width":"height").signal,g=`${r}(unit)`,p=Al(t,(m,h)=>[...m,{events:h.between[0],update:`[${g}, ${g}]`},{events:h,update:`[${s}[0], clamp(${g}, 0, ${d})]`}]);return p.push({events:{signal:t.name+eo},update:me(u)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},i?{init:yn(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:yn(i)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${c}, ${s})`}]})]}function Al(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(v(`${i} is not an ordered event stream for interval selections.`),n),[])}const Ym={defined:e=>e.type==="point",signals:(e,t,n)=>{var i;const r=t.name,s=r+ei,o=t.project,a="(item().isVoronoi ? datum.datum : datum)",c=o.items.map(g=>{const p=e.fieldDef(g.channel);return(p==null?void 0:p.bin)?`[${a}[${R(e.vgField(g.channel,{}))}], ${a}[${R(e.vgField(g.channel,{binSuffix:"end"}))}]]`:`${a}[${R(g.field)}]`}).join(", "),l=`unit: ${xn(e)}, fields: ${s}, values`,u=t.events,f=ne((i=e.component.selection)!==null&&i!==void 0?i:{}).reduce((g,p)=>p.type==="interval"?g.concat(p.name+vn):g,[]).map(g=>`indexof(item().mark.name, '${g}') < 0`).join(" && "),d="datum && item().mark.marktype !== 'group'"+(f?` && ${f}`:"");return n.concat([{name:r+Pt,on:u?[{events:u,update:`${d} ? {${l}: [${c}]} : null`,force:!0}]:[]}])}};function On(e,t,n,i){const r=Ui(t)&&t.condition,s=i(t);if(r){const o=V(r),a=o.map(c=>{const l=i(c);if(Lp(c)){const{param:u,empty:f}=c,d=iu(e,{param:u,empty:f});return Object.assign({test:d},l)}else{const u=lr(e,c.test);return Object.assign({test:u},l)}});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function to(e,t="text"){const n=e.encoding[t];return On(e,n,t,i=>rr(i,e.config))}function rr(e,t,n="datum"){if(e){if(ke(e))return q(e.value);if(E(e)){const{format:i,formatType:r}=qi(e);return ys({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}return}function Tl(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,o=n.tooltip;if(S(o))return{tooltip:Rl({tooltip:o},s,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return On(e,o,"tooltip",c=>{const l=rr(c,r,a);if(l)return l;if(c===null)return;let u=z("tooltip",i,r);return u===!0&&(u={content:"encoding"}),F(u)?{value:u}:W(u)?w(u)?u:u.content==="encoding"?Rl(n,s,r,t):{signal:a}:void 0})}}function Il(e,t,n,{reactiveGeom:i}={}){const r={},s=i?"datum.datum":"datum",o=[];function a(l,u){const f=Dt(u),d=_e(l)?l:Object.assign(Object.assign({},l),{type:e[f].type}),g=d.title||Es(d,n),p=V(g).join(", ");let m;if(Be(u)){const h=u==="x"?"x2":"y2",x=Ve(e[h]);if(oe(d.bin)&&x){const b=_(d,{expr:s}),O=_(x,{expr:s}),{format:$,formatType:N}=qi(d);m=Li(b,O,$,N,n),r[h]=!0}else if(t&&t.fieldChannel===u&&t.offset==="normalize"){const{format:b,formatType:O}=qi(d);m=ys({fieldOrDatumDef:d,format:b,formatType:O,expr:s,config:n,normalizeStack:!0}).signal}}m??(m=rr(d,n,s).signal),o.push({channel:u,key:p,value:m})}Ns(e,(l,u)=>{j(l)?a(l,u):Bi(l)&&a(l.condition,u)});const c={};for(const{channel:l,key:u,value:f}of o)!r[l]&&!c[u]&&(c[u]=f);return c}function Rl(e,t,n,{reactiveGeom:i}={}){const r=Il(e,t,n,{reactiveGeom:i}),s=gt(r).map(([o,a])=>`"${o}": ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function Km(e){const{markDef:t,config:n}=e,i=z("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),Qm(e)),Zm(e))}function Qm(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=z("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in wd?{}:{ariaRoleDescription:{value:t}}}function Zm(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return On(e,s,"description",c=>rr(c,e.config));const o=z("description",n,i);if(o!=null)return{description:q(o)};if(i.aria===!1)return{};const a=Il(t,r,i);return L(a)?void 0:{description:{signal:gt(a).map(([c,l],u)=>`"${u>0?"; ":""}${c}: " + (${l})`).join(" + ")}}}function te(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:c}=n;a===void 0&&(c??(c=z(e,i,s,{vgChannel:o,ignoreVgConfig:!0})),c!==void 0&&(a=q(c)));const l=r[e];return On(t,l,o??e,u=>cc({channel:e,channelDef:u,markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function zl(e,t={filled:void 0}){var n,i,r,s;const{markDef:o,encoding:a,config:c}=e,{type:l}=o,u=(n=t.filled)!==null&&n!==void 0?n:z("filled",o,c),f=P(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,d=(r=(i=z(u===!0?"color":void 0,o,c,{vgChannel:"fill"}))!==null&&i!==void 0?i:c.mark[u===!0&&"color"])!==null&&r!==void 0?r:f,g=(s=z(u===!1?"color":void 0,o,c,{vgChannel:"stroke"}))!==null&&s!==void 0?s:c.mark[u===!1&&"color"],p=u?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:q(d)}:{}),g?{stroke:q(g)}:{});return o.color&&(u?o.fill:o.stroke)&&v(Ia("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),te("color",e,{vgChannel:p,defaultValue:u?d:g})),te("fill",e,{defaultValue:a.fill?d:void 0})),te("stroke",e,{defaultValue:a.stroke?g:void 0}))}function Jm(e){const{encoding:t,mark:n}=e,i=t.order;return!St(n)&&ke(i)?On(e,i,"zindex",r=>q(r.value)):{}}function ti(e,t){const n=rd(e),i=t[n];return i||void 0}function re(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:s,config:o,stack:a}=t,c=r[e],l=r[rt(e)],u=t.scaleName(e),f=t.getScaleComponent(e),d=ti(e,s),g=no({model:t,defaultPos:n,channel:e,scaleName:u,scale:f}),p=!c&&Be(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:eb({channel:e,channelDef:c,channel2Def:l,markDef:s,config:o,scaleName:u,scale:f,stack:a,offset:d,defaultRef:g});return p?{[i||e]:p}:void 0}function eb(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:s,markDef:o}=e;if(E(n)&&r&&t===r.fieldChannel){if(j(n)){let a=n.bandPosition;if(a===void 0&&o.type==="text"&&(t==="radius"||t==="theta")&&(a=.5),a!==void 0)return zi({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:a,offset:s})}return Ht(n,i,{suffix:"end"},{offset:s})}return ms(e)}function no({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=e;return()=>{const a=Dt(n),c=yt(n),l=z(n,s,o,{vgChannel:c});if(l!==void 0)return Vn(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const u=r.get("type");if(!P([Z.LOG,Z.TIME,Z.UTC],u)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const u=e[xe(n)];return Object.assign(Object.assign({},u),{mult:.5})}}return}}const tb={left:"x",center:"xc",right:"x2"},nb={top:"y",middle:"yc",bottom:"y2"};function Ll(e,t,n,i="middle"){if(e==="radius"||e==="theta")return yt(e);const r=e==="x"?"align":"baseline",s=z(r,t,n);let o;return w(s)?(v(eg(r)),o=void 0):o=s,e==="x"?tb[o||(i==="top"?"left":"center")]:nb[o||i]}function sr(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?Dl(e,t,{defaultPos:n,defaultPos2:i}):re(e,t,{defaultPos:n})}function Dl(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,o=rt(e),a=xe(e),c=ib(t,i,o),l=c[a]?Ll(e,r,s):yt(e);return Object.assign(Object.assign({},re(e,t,{defaultPos:n,vgChannel:l})),c)}function ib(e,t,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=e,c=Dt(n),l=xe(n),u=yt(n),f=i[c],d=e.scaleName(c),g=e.getScaleComponent(c),p=n in i||n in s?ti(n,e.markDef):ti(c,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const h=xe(n),x=e.markDef[h];return x!=null?{[h]:{value:x}}:{[u]:{field:e.getName(n)}}}const m=rb({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:a,scaleName:d,scale:g,stack:o,offset:p,defaultRef:void 0});return m!==void 0?{[u]:m}:or(n,s)||or(n,{[n]:Ci(n,s,a.style),[l]:Ci(l,s,a.style)})||or(n,a[r])||or(n,a.mark)||{[u]:no({model:e,defaultPos:t,channel:n,scaleName:d,scale:g})()}}function rb({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l}){return E(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?Ht(t,s,{suffix:"start"},{offset:c}):ms({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:c,defaultRef:l})}function or(e,t){const n=xe(e),i=yt(e);if(t[i]!==void 0)return{[i]:Vn(e,t[i])};if(t[e]!==void 0)return{[i]:Vn(e,t[e])};if(t[n]){const r=t[n];if(dn(r))v(Xd(n));else return{[n]:Vn(e,r)}}return}function Ft(e,t,n){var i,r,s,o;const{config:a,encoding:c,markDef:l}=e,u=rt(t),f=xe(t),d=c[t],g=c[u],p=e.getScaleComponent(t),m=p?p.get("type"):void 0,h=e.scaleName(t),x=l.orient,b=(r=(i=c[f])!==null&&i!==void 0?i:c.size)!==null&&r!==void 0?r:z("size",l,a,{vgChannel:f}),O=n==="bar"&&(t==="x"?x==="vertical":x==="horizontal");if(j(d)&&(U(d.bin)||oe(d.bin)||d.timeUnit&&!g)&&!(b&&!dn(b))&&!ie(m)){const $=xc({channel:t,fieldDef:d,markDef:l,config:a,scaleType:m}),N=(s=e.component.axes[t])===null||s===void 0?void 0:s[0],A=(o=N==null?void 0:N.get("translate"))!==null&&o!==void 0?o:.5;return ab({fieldDef:d,fieldDef2:g,channel:t,markDef:l,scaleName:h,bandSize:$,axisTranslate:A,spacing:Be(t)?z("binSpacing",l,a):void 0,reverse:p.get("reverse"),config:a})}else return(E(d)&&ie(m)||O)&&!g?ob(d,t,e):Dl(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function sb(e,t,n,i,r){if(dn(r))if(n){const o=n.get("type");if(o==="band")return{scale:t,band:r.band};r.band!==1&&(v(rg(o)),r=void 0)}else return{mult:r.band,field:{group:e}};else{if(w(r))return r;if(r)return{value:r}}if(n){const o=n.get("range");if(jt(o)&&X(o.step))return{value:o.step-2}}const s=tr(i.view,e);return{value:s-2}}function ob(e,t,n){const{markDef:i,encoding:r,config:s,stack:o}=n,a=i.orient,c=n.scaleName(t),l=n.getScaleComponent(t),u=xe(t),f=rt(t),d=a==="horizontal"&&t==="y"||a==="vertical"&&t==="x";let g;(r.size||i.size)&&(d?g=te("size",n,{vgChannel:u,defaultRef:q(i.size)}):v(cg(i.type)));const p=xc({channel:t,fieldDef:e,markDef:i,config:s,scaleType:l==null?void 0:l.get("type"),useVlSizeChannel:d});g=g||{[u]:sb(u,c,l,s,p)};const m=(l==null?void 0:l.get("type"))!=="band"||!("band"in g[u])?"middle":"top",h=Ll(t,i,s,m),x=h==="xc"||h==="yc",b=ti(t,i),O=ms({channel:t,channelDef:e,markDef:i,config:s,scaleName:c,scale:l,stack:o,offset:b,defaultRef:no({model:n,defaultPos:"mid",channel:t,scaleName:c,scale:l}),bandPosition:x?.5:w(p)?{signal:`(1-${p})/2`}:dn(p)?(1-p.band)/2:0});if(u)return Object.assign({[h]:O},g);{const $=yt(f),N=g[u],A=b?Object.assign(Object.assign({},N),{offset:b}):N;return{[h]:O,[$]:S(O)?[O[0],Object.assign(Object.assign({},O[1]),{offset:A})]:Object.assign(Object.assign({},O),{offset:A})}}}function ni(e,t,n,i,r){if(sa(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(w(n)||w(r)||w(i)){const o=at(n),a=at(r),c=at(i),l=c?`${c} + `:"",u=o?`(${o} ? -1 : 1) * `:"",f=a?`(${a} + ${s})`:s;return{signal:l+u+f}}else return r=r||0,i+(n?-r-s:+r+s)}function ab({fieldDef:e,fieldDef2:t,channel:n,bandSize:i,scaleName:r,markDef:s,spacing:o=0,axisTranslate:a,reverse:c,config:l}){const u=rt(n),f=yt(n),d=yt(u),g=ti(n,s),p=w(i)?{signal:`(1-${i.signal})/2`}:dn(i)?(1-i.band)/2:.5;if(U(e.bin)||e.timeUnit)return{[d]:Ml({channel:n,fieldDef:e,scaleName:r,markDef:s,bandPosition:p,offset:ni(u,o,c,a,g),config:l}),[f]:Ml({channel:n,fieldDef:e,scaleName:r,markDef:s,bandPosition:w(p)?{signal:`1-${p.signal}`}:1-p,offset:ni(n,o,c,a,g),config:l})};if(oe(e.bin)){const m=Ht(e,r,{},{offset:ni(u,o,c,a,g)});if(j(t))return{[d]:m,[f]:Ht(t,r,{},{offset:ni(n,o,c,a,g)})};if(Mt(e.bin)&&e.bin.step)return{[d]:m,[f]:{signal:`scale("${r}", ${_(e,{expr:"datum"})} + ${e.bin.step})`,offset:ni(n,o,c,a,g)}}}v(Ma(u));return}function Ml({channel:e,fieldDef:t,scaleName:n,markDef:i,bandPosition:r,offset:s,config:o}){const a=zi({scaleName:n,fieldOrDatumDef:t,bandPosition:r,offset:s});return ac({fieldDef:t,channel:e,markDef:i,ref:a,config:o})}const cb=new Set(["aria","width","height"]);function je(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?zl(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},lb(e.markDef,t)),Ul(e,"fill",n)),Ul(e,"stroke",i)),te("opacity",e)),te("fillOpacity",e)),te("strokeOpacity",e)),te("strokeWidth",e)),te("strokeDash",e)),Jm(e)),Tl(e)),to(e,"href")),Km(e))}function Ul(e,t,n){const{config:i,mark:r,markDef:s}=e,o=z("invalid",s,i);if(o==="hide"&&n&&!St(r)){const a=ub(e,{invalid:!0,channels:Ei});if(a)return{[t]:[{test:a,value:null},...V(n)]}}return n?{[t]:n}:{}}function lb(e,t){return Sd.reduce((n,i)=>(!cb.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=q(e[i])),n),{})}function ub(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const c=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&me(c)&&(s[l]=!0)}return s},{}),r=y(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>bs(o,t)).join(` ${s} `)}return}function io(e){const{config:t,markDef:n}=e,i=z("invalid",n,t);if(i){const r=fb(e,{channels:Ue});if(r)return{defined:{signal:r}}}return{}}function fb(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const c=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&me(c)&&(s[l]=!0)}return s},{}),r=y(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>bs(o,t)).join(` ${s} `)}return}function Bl(e,t){return t!==void 0?{[e]:q(t)}:void 0}const ro="voronoi",Wl={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(ro)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if(St(s))return v(Cd(s)),n;const o={name:e.getName(ro),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},Tl(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,c=!1;return n.forEach((l,u)=>{var f;const d=(f=l.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?a=u:d.indexOf(ro)>=0&&(c=!0)}),c||n.splice(a+1,0,o),n}},Hl={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!zs(e.bind),parse:(e,t,n)=>eu(t,n),topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,o=t.init&&t.init[0],a=Wl.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((c,l)=>{var u,f;const d=H(`${i}_${c.field}`),g=n.filter(p=>p.name===d);g.length||n.unshift(Object.assign(Object.assign({name:d},o?{init:yn(o[l])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${R(c.field)}] : null`}]:[],bind:(f=(u=s[c.field])!==null&&u!==void 0?u:s[c.channel])!==null&&f!==void 0?f:s}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.filter(l=>l.name===i+Pt)[0],o=i+ei,a=r.items.map(l=>H(`${i}_${l.field}`)),c=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(s.update=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},ar="_toggle",ql={defined:e=>e.type==="point"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+ar,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Pt,i=t.name+ar;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${xn(e)}}, `)+`${i} ? ${n} : null`}},db={defined:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t)=>{t.clear&&(t.clear=F(t.clear)?nn(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if(Hl.defined(t))for(const i of t.project.items){const r=n.findIndex(s=>s.name===H(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const r of t.project.items){const s=n.findIndex(o=>o.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(s=>s.name===t.name+Pt);i(r,"null"),ql.defined(t)&&(r=n.findIndex(s=>s.name===t.name+ar),i(r,"false"))}return n}},Gl={defined:e=>{const t=e.resolve==="global"&&e.bind&&zs(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Qn;return t&&!n&&v(Pd),t&&n},parse:(e,t,n)=>{var i;const r=C(n);if(r.select=F(r.select)?{type:r.select,toggle:t.toggle}:Object.assign(Object.assign({},r.select),{toggle:t.toggle}),eu(t,r),Yo(n.select)&&(n.select.on||n.select.clear)){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const c of t.events)c.filter=V((i=c.filter)!==null&&i!==void 0?i:[]),c.filter.includes(a)||c.filter.push(a)}const s=Ls(t.bind)?t.bind.legend:"click",o=F(s)?nn(s,"view"):V(s);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=Ls(t.bind)&&t.bind.legend,s=o=>a=>{const c=C(a);return c.markname=o,c};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${H(o.field)}_legend`,c=`${i}_${a}`,l=n.filter(u=>u.name===c);if(l.length===0){const u=r.merge.map(s(`${a}_symbols`)).concat(r.merge.map(s(`${a}_labels`))).concat(r.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:c},t.init?{}:{value:null}),{on:[{events:u,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${c}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(d=>d.name===i+Pt),o=i+ei,a=r.items.filter(d=>d.hasLegend).map(d=>H(`${i}_${H(d.field)}_legend`)),c=a.map(d=>`${d} !== null`).join(" && "),l=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const u=n.find(d=>d.name===i+ar),f=Ls(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:f})):u.on[0].events=f),n}};function gb(e,t,n){var i,r,s,o;const a=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;for(const c of ne((r=e.component.selection)!==null&&r!==void 0?r:{})){const l=(s=c.project.hasField[a])!==null&&s!==void 0?s:c.project.hasChannel[t];if(l&&Gl.defined(c)){const u=(o=n.get("selections"))!==null&&o!==void 0?o:[];u.push(c.name),n.set("selections",u,!1),l.hasLegend=!0}}}const Vl="_translate_anchor",Xl="_translate_delta",pb={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Nt.defined(t),s=i+Vl,{x:o,y:a}=t.project.hasChannel;let c=nn(t.translate,"scope");return r||(c=c.map(l=>(l.between[0].markname=i+vn,l))),n.push({name:s,value:{},on:[{events:c.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?`, extent_x: ${r?Zs(e,G):`slice(${o.signals.visual})`}`:"")+(a!==void 0?`, extent_y: ${r?Zs(e,Q):`slice(${a.signals.visual})`}`:"")+"}"}]},{name:i+Xl,value:{},on:[{events:c,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&Yl(e,t,o,"width",n),a!==void 0&&Yl(e,t,a,"height",n),n}};function Yl(e,t,n,i,r){var s,o;const a=t.name,c=a+Vl,l=a+Xl,u=n.channel,f=Nt.defined(t),d=r.filter(k=>k.name===n.signals[f?"data":"visual"])[0],g=e.getSizeSignalRef(i).signal,p=e.getScaleComponent(u),m=p.get("type"),h=p.get("reverse"),x=f?u===G?h?"":"-":h?"-":"":"",b=`${c}.extent_${u}`,O=`${x}${l}.${u} / ${f?`${g}`:`span(${b})`}`,$=f?m==="log"?"panLog":m==="symlog"?"panSymlog":m==="pow"?"panPow":"panLinear":"panLinear",N=f?m==="pow"?`, ${(s=p.get("exponent"))!==null&&s!==void 0?s:1}`:m==="symlog"?`, ${(o=p.get("constant"))!==null&&o!==void 0?o:1}`:"":"",A=`${$}(${b}, ${O}${N})`;d.on.push({events:{signal:l},update:f?A:`clampRange(${A}, 0, ${g})`})}const Kl="_zoom_anchor",Ql="_zoom_delta",hb={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Nt.defined(t),s=i+Ql,{x:o,y:a}=t.project.hasChannel,c=R(e.scaleName(G)),l=R(e.scaleName(Q));let u=nn(t.zoom,"scope");return r||(u=u.map(f=>(f.markname=i+vn,f))),n.push({name:i+Kl,on:[{events:u,update:r?"{"+[c?`x: invert(${c}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:u,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&Zl(e,t,o,"width",n),a!==void 0&&Zl(e,t,a,"height",n),n}};function Zl(e,t,n,i,r){var s,o;const a=t.name,c=n.channel,l=Nt.defined(t),u=r.filter($=>$.name===n.signals[l?"data":"visual"])[0],f=e.getSizeSignalRef(i).signal,d=e.getScaleComponent(c),g=d.get("type"),p=l?Zs(e,c):u.name,m=a+Ql,h=`${a}${Kl}.${c}`,x=l?g==="log"?"zoomLog":g==="symlog"?"zoomSymlog":g==="pow"?"zoomPow":"zoomLinear":"zoomLinear",b=l?g==="pow"?`, ${(s=d.get("exponent"))!==null&&s!==void 0?s:1}`:g==="symlog"?`, ${(o=d.get("constant"))!==null&&o!==void 0?o:1}`:"":"",O=`${x}(${p}, ${h}, ${m}${b})`;u.on.push({events:{signal:m},update:l?O:`clampRange(${O}, 0, ${f})`})}const Xt="_store",Pt="_tuple",mb="_modify",Jl="vlSelectionResolve",cr=[Ym,Vm,qm,ql,Hl,Nt,Gl,db,pb,hb,Wl];function bb(e){let t=e.parent;for(;t&&!Fe(t);)t=t.parent;return t}function xn(e,{escape:t}={escape:!0}){let n=t?R(e.name):e.name;const i=bb(e);if(i){const{facet:r}=i;for(const s of Oe)r[s]&&(n+=` + '__facet_${s}_' + (facet[${R(i.vgField(s))}])`)}return n}function so(e){var t;return ne((t=e.component.selection)!==null&&t!==void 0?t:{}).reduce((n,i)=>n||i.project.items.some(r=>r.field===Qn),!1)}function eu(e,t){(bi(t.select)||!t.select.on)&&delete e.events,(bi(t.select)||!t.select.clear)&&delete e.clear,(bi(t.select)||!t.select.toggle)&&delete e.toggle}function oo(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...oo(e.object)),t.push(...oo(e.property))),t)}function tu(e){return e.object.type==="MemberExpression"?tu(e.object):e.object.name==="datum"}function nu(e){const t=xf(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&tu(i)&&n.add(oo(i).slice(1).join("."))}),n}class _n extends D{constructor(t,n,i){super(t);this.model=n,this.filter=i,this.expr=lr(this.model,this.filter,this),this._dependentFields=nu(this.expr)}clone(){return new _n(null,this.model,C(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function yb(e,t){var n;const i={},r=e.config.selection;if(!t||!t.length)return i;for(const s of t){const o=H(s.name),a=s.select,c=F(a)?a:a.type,l=W(a)?C(a):{type:c},u=r[c];for(const d in u){if(d==="fields"||d==="encodings")continue;d==="mark"&&(l[d]=Object.assign(Object.assign({},u[d]),l[d])),(l[d]===void 0||l[d]===!0)&&(l[d]=(n=u[d])!==null&&n!==void 0?n:l[d])}const f=i[o]=Object.assign(Object.assign({},l),{name:o,type:c,init:s.value,bind:s.bind,events:F(l.on)?nn(l.on,"scope"):V(C(l.on))});for(const d of cr)d.defined(f)&&d.parse&&d.parse(e,f,s)}return i}function iu(e,t,n,i="datum"){const r=F(t)?t:t.param,s=H(r),o=R(s+Xt);let a;try{a=e.getSelectionComponent(s,r)}catch(u){return`!!${s}`}if(a.project.timeUnit){const u=n??e.component.data.raw,f=a.project.timeUnit.clone();u.parent?f.insertAsParentOf(u):u.parent=f}const c=`vlSelectionTest(${o}, ${i}${a.resolve==="global"?")":`, ${R(a.resolve)})`}`,l=`length(data(${o}))`;return t.empty===!1?`${l} && ${c}`:`!${l} || ${c}`}function ru(e,t,n){const i=H(t),r=n.encoding;let s=n.field,o;try{o=e.getSelectionComponent(i,t)}catch(a){return i}if(!r&&!s)s=o.project.items[0].field,o.project.items.length>1&&v(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${R(s)}.`);else if(r&&!s){const a=o.project.items.filter(c=>c.channel===r);!a.length||a.length>1?(s=o.project.items[0].field,v((a.length?"Multiple ":"No ")+`matching ${R(r)} encoding found for selection ${R(n.param)}. Using "field": ${R(s)}.`)):s=a[0].field}return`${o.name}[${R(ye(s))}]`}function vb(e,t){var n;for(const[i,r]of gt((n=e.component.selection)!==null&&n!==void 0?n:{})){const s=e.getName(`lookup_${i}`);e.component.data.outputNodes[s]=r.materialized=new le(new _n(t,e,{param:i}),s,B.Lookup,e.component.data.outputNodeRefCounts)}}function lr(e,t,n){return Rn(t,i=>F(i)?i:Hg(i)?iu(e,i,n):Xa(i))}var ur=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Ob(e,t){return e?S(e)&&!_t(e)?e.map(n=>Es(n,t)).join(", "):e:void 0}function ao(e,t,n,i){var r,s,o,a,c;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(s=(a=e.encode)[t])!==null&&s!==void 0||(a[t]={}),(o=(c=e.encode[t]).update)!==null&&o!==void 0||(c.update={}),e.encode[t].update[n]=i}function ii(e,t,n,i={header:!1}){var r,s;const o=e.combine(),{disable:a,orient:c,scale:l,labelExpr:u,title:f,zindex:d}=o,g=ur(o,["disable","orient","scale","labelExpr","title","zindex"]);if(a)return;for(const p in g){const m=Zp[p],h=g[p];if(m&&m!==t&&m!=="both")delete g[p];else if(Kn(h)){const{condition:x}=h,b=ur(h,["condition"]),O=V(x),$=Nc[p];if($){const{vgProp:N,part:A}=$,k=[...O.map(T=>{const{test:ee}=T,Pe=ur(T,["test"]);return Object.assign({test:lr(null,ee)},Pe)}),b];ao(g,A,N,k),delete g[p]}else if($===null){const N={signal:O.map(A=>{const{test:k}=A,T=ur(A,["test"]);return`${lr(null,k)} ? ${va(T)} : `}).join("")+va(b)};g[p]=N}}else if(w(h)){const x=Nc[p];if(x){const{vgProp:b,part:O}=x;ao(g,O,b,h),delete g[p]}}P(["labelAlign","labelBaseline"],p)&&g[p]===null&&delete g[p]}if(t==="grid"){if(!g.grid)return;if(g.encode){const{grid:p}=g.encode;g.encode=Object.assign({},p?{grid:p}:{}),L(g.encode)&&delete g.encode}return Object.assign(Object.assign({scale:l,orient:c},g),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:Y(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(u!==void 0){let m=u;((s=(r=g.encode)===null||r===void 0?void 0:r.labels)===null||s===void 0?void 0:s.update)&&w(g.encode.labels.update.text)&&(m=Rt(u,"datum.label",g.encode.labels.update.text.signal)),ao(g,"labels","text",{signal:m})}if(g.labelAlign===null&&delete g.labelAlign,g.encode){for(const m of Fc)e.hasAxisPart(m)||delete g.encode[m];L(g.encode)&&delete g.encode}const p=Ob(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:c,grid:!1},p?{title:p}:{}),g),n.aria===!1?{aria:!1}:{}),{zindex:Y(d,0)})}}function su(e){const{axes:t}=e.component,n=[];for(const i of Ue)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function xb(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>ii(r,"grid",t)),...i.map(r=>ii(r,"grid",t)),...n.map(r=>ii(r,"main",t)),...i.map(r=>ii(r,"main",t))].filter(r=>r)}function ou(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},c=new Set([...y(o),...y(a)]),l={};for(const u of c.values())l[u]={signal:`${i.signal} === "${s}" ? ${at(o[u])} : ${at(a[u])}`};return l}return t[r]})])}function _b(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:tp(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=w(n)?"axisOrient":`axis${zn(n)}`,a=[...r,...r.map(l=>s+l.substr(4))],c=["axis",o,s];return{vlOnlyAxisConfig:ou(a,i,e,n),vgAxisConfig:ou(c,i,e,n),axisConfigStyle:jb([...c,...a],i)}}function jb(e,t){var n;const i=[{}];for(const r of e){let s=(n=t[r])===null||n===void 0?void 0:n.style;if(s){s=V(s);for(const o of s)i.push(t.style[o])}}return Object.assign.apply(null,i)}function co(e,t,n,i={}){var r;const s=xa(e,n,t);if(s!==void 0)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const au={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return fc(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return dc(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return(i=t.grid)!==null&&i!==void 0?i:Sb(n,e)},gridScale:({model:e,channel:t})=>wb(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||lu(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||cu(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:Eb(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:kb(t.type,n,j(t)&&!!t.timeUnit,j(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var s;const o=e==="x"?"width":e==="y"?"height":void 0,a=o?t.getSizeSignalRef(o):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:Nb({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=uu(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return ja(r?[vc(r)]:[],j(o)?[vc(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Fb(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:Pb(n,t)}};function Sb(e,t){return!ie(e)&&j(t)&&!U(t==null?void 0:t.bin)&&!oe(t==null?void 0:t.bin)}function wb(e,t){const n=t==="x"?"y":"x";return e.getScaleComponent(n)?e.scaleName(n):void 0}function $b(e,t,n,i,r){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return w(s)?s:Ln(s);{const{configValue:o}=co("labelAngle",i,t==null?void 0:t.style,r);return o!==void 0?Ln(o):n===G&&P([us,ls],e.type)&&!(j(e)&&e.timeUnit)?270:void 0}}function lo(e){return`(((${e.signal} % 360) + 360) % 360)`}function cu(e,t,n,i){if(e!==void 0)if(n==="x"){if(w(e)){const r=lo(e),s=w(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(w(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(w(e)){const r=lo(e),s=w(t)?`(${t.signal} === "left")`:t==="left",o=i?'"middle"':"null";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${o} : (45 <= ${r} && ${r} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(w(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}return}function lu(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(w(e)){const o=lo(e),a=w(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${r?`(${o} + 90)`:o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${a} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(w(t)){const o=r<e&&e<180+r?"===":"!==",a=`${t.signal} ${o} "${s}"`;return{signal:`${a} ? "left" : "right"`}}return(r<e&&e<180+r)===(t===s)?"left":"right"}function Eb(e,t){return t==="x"&&P(["quantitative","temporal"],e)?!0:void 0}function kb(e,t,n,i){return n&&!W(i)||e!=="nominal"&&e!=="ordinal"?t==="log"||t==="symlog"?"greedy":!0:void 0}function Cb(e){return e==="x"?"bottom":"left"}function Nb({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!ie(t)&&t!=="log"){if(j(e)){if(U(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&P(["month","hours","day","quarter"],(r=ae(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}function uu(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;return s&&o?Sa(s,o):s||(o||(s!==void 0?s:o!==void 0?o:void 0))}function Fb(e,t){const n=e.values;return S(n)?Cc(t,n):w(n)?n:void 0}function Pb(e,t){return e==="rect"&&Hi(t)?1:0}class jn extends D{constructor(t,n){super(t);this.transform=n,this._dependentFields=nu(this.transform.calculate)}clone(){return new jn(null,C(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(!Gt(i))return;if(yc(i.sort)){const{field:s,timeUnit:o}=i,a=i.sort,c=a.map((l,u)=>`${Xa({field:s,timeUnit:o,equal:l})} ? ${u} : `).join("")+a.length;t=new jn(t,{calculate:c,as:Sn(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${I(this.transform)}`}}function Sn(e,t,n){return _(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function fr(e,t){return P(["top","bottom"],t)?"column":P(["left","right"],t)||e==="row"?"row":"column"}function wn(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return Y((t||{})[e],r[e],n.header[e])}function dr(e,t,n,i){const r={};for(const s of e){const o=wn(s,t||{},n,i);o!==void 0&&(r[s]=o)}return r}const uo=["row","column"],fo=["header","footer"];function Ab(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=dr(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),c=fr(t,a),l=Ln(o);return{name:`${t}-title`,type:"group",role:`${c}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),du(l,c)),fu(c,l,s)),gu(i,r,t,xh,Kc))}}function fu(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=lu(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function du(e,t){const n=cu(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Tb(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of fo)if(n[r])for(const s of n[r]){const o=Rb(e,t,r,n,s);o!=null&&i.push(o)}return i}function Ib(e,t){var n;const{sort:i}=e;return qe(i)?{field:_(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:S(i)?{field:Sn(e,t,{expr:"datum"}),order:"ascending"}:{field:_(e,{expr:"datum"}),order:i??"ascending"}}function go(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:c}=dr(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=ys({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,u=fr(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:c?Rt(Rt(c,"datum.label",l),"datum.value",_(e,{expr:"parent"})):l}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),du(s,u)),fu(u,s,o)),gu(n,e,t,_h,Qc))}function Rb(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=dr(["labelOrient"],o.header,a,t);(t==="row"&&!P(["top","bottom"],f)||t==="column"&&!P(["left","right"],f))&&(s=go(o,t,a))}const c=Fe(e)&&!Xn(e.facet),l=r.axes,u=(l==null?void 0:l.length)>0;if(s||u){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(`${t}_domain`)},sort:Ib(o,t)}:{}),u&&c?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),u?{axes:l}:{})}}return null}const zb={column:{start:0,end:1},row:{start:1,end:0}};function Lb(e,t){return zb[t][e]}function Db(e,t){const n={};for(const i of Oe){const r=e[i];if(r==null?void 0:r.facetFieldDef){const{titleAnchor:s,titleOrient:o}=dr(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=fr(i,o),c=Lb(s,a);c!==void 0&&(n[a]=c)}}return L(n)?void 0:n}function gu(e,t,n,i,r){const s={};for(const o of i){if(!r[o])continue;const a=wn(o,t==null?void 0:t.header,e,n);a!==void 0&&(s[r[o]]=a)}return s}function po(e){return[...gr(e,"width"),...gr(e,"height"),...gr(e,"childWidth"),...gr(e,"childHeight")]}function gr(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(ie(o)&&jt(a)){const c=e.scaleName(n);if(Fe(e.parent)){const l=e.parent.component.resolve;if(l.scale[n]==="independent")return[pu(c,a)]}return[pu(c,a),{name:r,update:hu(c,s,`domain('${c}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=Bs(e.config.view,s?"width":"height"),c=`isFinite(${o}) ? ${o} : ${a}`;return[{name:r,init:c,on:[{update:c,events:"window:resize"}]}]}else return[{name:r,value:i}]}function pu(e,t){return{name:`${e}_step`,value:t.step}}function hu(e,t,n){const i=t.get("type"),r=t.get("padding"),s=Y(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${at(o)}, ${at(s)}) * ${e}_step`}function mu(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function bu(e,t){return y(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),On(t,r,i,s=>q(s.value)))},{})}function yu(e,t){if(Fe(t))return e==="theta"?"independent":"shared";if(kn(t))return"shared";if(No(t))return Be(e)||e==="theta"||e==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function ho(e,t){const n=e.scale[t],i=Be(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&v(gg(t)),"independent"):e[i][t]||"shared"}const Mb=Object.assign(Object.assign({},wh),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),vu=y(Mb);class Ub extends ut{}const Ou={symbols:Bb,gradient:Wb,labels:Hb,entries:qb};function Bb(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){var o,a,c,l,u,f,d,g;if(s!=="symbol")return;const{markDef:p,encoding:m,config:h,mark:x}=n,b=p.filled&&x!=="trail";let O=Object.assign(Object.assign({},$d({},n,_p)),zl(n,{filled:b}));const $=(o=r.get("symbolOpacity"))!==null&&o!==void 0?o:h.legend.symbolOpacity,N=(a=r.get("symbolFillColor"))!==null&&a!==void 0?a:h.legend.symbolFillColor,A=(c=r.get("symbolStrokeColor"))!==null&&c!==void 0?c:h.legend.symbolStrokeColor,k=$===void 0?(l=xu(m.opacity))!==null&&l!==void 0?l:p.opacity:void 0;if(O.fill){if(i==="fill"||b&&i===ue)delete O.fill;else if(O.fill.field)N?delete O.fill:(O.fill=q((u=h.legend.symbolBaseFillColor)!==null&&u!==void 0?u:"black"),O.fillOpacity=q(k??1));else if(S(O.fill)){const T=(g=(d=mo((f=m.fill)!==null&&f!==void 0?f:m.color))!==null&&d!==void 0?d:p.fill)!==null&&g!==void 0?g:b&&p.color;T&&(O.fill=q(T))}}if(O.stroke){if(i==="stroke"||!b&&i===ue)delete O.stroke;else if(O.stroke.field||A)delete O.stroke;else if(S(O.stroke)){const T=Y(mo(m.stroke||m.color),p.stroke,b?p.color:void 0);T&&(O.stroke={value:T})}}if(i!==it){const T=j(t)&&ju(n,r,t);T?O.opacity=[Object.assign({test:T},q(k??1)),q(h.legend.unselectedOpacity)]:k&&(O.opacity=q(k))}return O=Object.assign(Object.assign({},O),e),L(O)?void 0:O}function Wb(e,{model:t,legendType:n,legendCmpt:i}){var r;if(n!=="gradient")return;const{config:s,markDef:o,encoding:a}=t;let c={};const l=(r=i.get("gradientOpacity"))!==null&&r!==void 0?r:s.legend.gradientOpacity,u=l===void 0?xu(a.opacity)||o.opacity:void 0;return u&&(c.opacity=q(u)),c=Object.assign(Object.assign({},c),e),L(c)?void 0:c}function Hb(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=j(t)?ju(n,r,t):void 0,c=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:u}=s,f=qt(u)?vs({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:u,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},c?{opacity:c}:{}),f?{text:f}:{}),e);return L(d)?void 0:d}function qb(e,{legendCmpt:t}){const n=t.get("selections");return(n==null?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function xu(e){return _u(e,(t,n)=>Math.max(t,n.value))}function mo(e){return _u(e,(t,n)=>Y(t,n.value))}function _u(e,t){return Mp(e)?V(e.condition).reduce(t,e.value):ke(e)?e.value:void 0}function ju(e,t,n){const i=t.get("selections");if(!(i==null?void 0:i.length))return;const r=R(n.field);return i.map(s=>{const o=R(H(s)+Xt);return`(!length(data(${o})) || (${s}[${r}] && indexof(${s}[${r}], datum.value) >= 0))`}).join(" || ")}const Su={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return fc(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return dc(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:Zb(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:Jb(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:Vb(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>gn(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(cn(n)&&Ee(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>Gb(t,e)};function Gb(e,t){const n=e.values;return S(n)?Cc(t,n):w(n)?n:void 0}function Vb(e,t,n,i){var r;if(t!=="shape"){const s=(r=mo(n))!==null&&r!==void 0?r:i;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function Xb(e){const{legend:t}=e;return Y(t.type,Yb(e))}function Yb({channel:e,timeUnit:t,scaleType:n}){if(cn(e)){if(P(["quarter","month","day"],t))return"symbol";if(Ee(n))return"gradient"}return"symbol"}function Kb({legendConfig:e,legendType:t,orient:n,legend:i}){var r,s;return(s=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:Qb(n,t)}function Qb(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function Zb({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:c}=e;return Ee(r)?n==="horizontal"?i==="top"||i==="bottom"?wu(t,"width",o,s):o:wu(t,"height",c,a):void 0}function wu(e,t,n,i){const r=e.getSizeSignalRef(t).signal;return{signal:`clamp(${r}, ${n}, ${i})`}}function Jb(e){return P(["quantile","threshold","log","symlog"],e)?"greedy":void 0}function $u(e){const t=K(e)?ey(e):ry(e);return e.component.legends=t,t}function ey(e){const{encoding:t}=e,n={};for(const i of[ue,...Jc]){const r=J(t[i]);if(!r||!e.getScaleComponent(i))continue;if(i===fe&&j(r)&&r.type===fn)continue;n[i]=iy(e,i)}return n}function ty(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function ny(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n==null?void 0:n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function iy(e,t){var n,i,r;let s=e.legend(t);const{markDef:o,encoding:a,config:c}=e,l=c.legend,u=new Ub({},ty(e,t));gb(e,t,u);const f=s!==void 0?!s:l.disable;if(u.set("disable",f,s!==void 0),f)return u;s=s||{};const d=e.getScaleComponent(t).get("type"),g=J(a[t]),p=j(g)?(n=ae(g.timeUnit))===null||n===void 0?void 0:n.unit:void 0,m=s.orient||c.legend.orient||"right",h=Xb({legend:s,channel:t,timeUnit:p,scaleType:d}),x=Kb({legend:s,legendType:h,orient:m,legendConfig:l}),b={legend:s,channel:t,model:e,markDef:o,encoding:a,fieldOrDatumDef:g,legendConfig:l,config:c,scaleType:d,orient:m,legendType:h,direction:x};for(const k of vu){if(h==="gradient"&&k.startsWith("symbol")||h==="symbol"&&k.startsWith("gradient"))continue;const T=k in Su?Su[k](b):s[k];if(T!==void 0){const ee=ny(T,k,s,e.fieldDef(t));(ee||c.legend[k]===void 0)&&u.set(k,T,ee)}}const O=(i=s==null?void 0:s.encoding)!==null&&i!==void 0?i:{},$=u.get("selections"),N={},A={fieldOrDatumDef:g,model:e,channel:t,legendCmpt:u,legendType:h};for(const k of["labels","legend","title","symbols","gradient","entries"]){const T=bu((r=O[k])!==null&&r!==void 0?r:{},e),ee=k in Ou?Ou[k](T,A):T;ee!==void 0&&!L(ee)&&(N[k]=Object.assign(Object.assign(Object.assign({},($==null?void 0:$.length)&&j(g)?{name:`${H(g.field)}_legend_${k}`}:{}),($==null?void 0:$.length)?{interactive:!!$}:{}),{update:ee}))}return L(N)||u.set("encode",N,!!(s==null?void 0:s.encoding)),u}function ry(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){$u(i);for(const r of y(i.component.legends))n.legend[r]=ho(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=Eu(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of y(t))for(const r of e.children){if(!r.component.legends[i])continue;n.legend[i]==="shared"&&delete r.component.legends[i]}return t}function Eu(e,t){var n,i,r,s;if(!e)return t.clone();const o=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let c=!1;for(const l of vu){const u=kt(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,d)=>{switch(l){case"symbolType":return sy(f,d);case"title":return wa(f,d);case"type":return c=!0,be("symbol")}return ir(f,d,l,"legend")});e.setWithExplicit(l,u)}return c&&(((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient)&&vi(e.implicit,["encode","gradient"]),((s=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||s===void 0?void 0:s.gradient)&&vi(e.explicit,["encode","gradient"])),e}function sy(e,t){return t.value==="circle"?t:e}var oy=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ay(e,t,n,i){var r,s,o,a,c;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(s=(a=e.encode)[t])!==null&&s!==void 0||(a[t]={}),(o=(c=e.encode[t]).update)!==null&&o!==void 0||(c.update={}),e.encode[t].update[n]=i}function ku(e){const t=e.component.legends,n={};for(const r of y(t)){const s=e.getScaleComponent(r),o=M(s.get("domains"));if(n[o])for(const a of n[o]){const c=Eu(a,t[r]);c||n[o].push(t[r])}else n[o]=[t[r].clone()]}const i=ne(n).flat().map(r=>cy(r,e.config)).filter(r=>r!==void 0);return i}function cy(e,t){var n,i,r;const s=e.combine(),{disable:o,labelExpr:a,selections:c}=s,l=oy(s,["disable","labelExpr","selections"]);if(o)return;if(t.aria===!1&&l.aria==null&&(l.aria=!1),(n=l.encode)===null||n===void 0?void 0:n.symbols){const u=l.encode.symbols.update;u.fill&&u.fill.value!=="transparent"&&!u.stroke&&!l.stroke&&(u.stroke={value:"transparent"});for(const f of Jc)l[f]&&delete u[f]}if(l.title||delete l.title,a!==void 0){let u=a;((r=(i=l.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&w(l.encode.labels.update.text)&&(u=Rt(a,"datum.label",l.encode.labels.update.text.signal)),ay(l,"labels","text",{signal:u})}return l}function ly(e){return kn(e)||No(e)?uy(e):Cu(e)}function uy(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),Cu(e))}function Cu(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const c=w(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return P(o,c)||o.push(c),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const fy=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Nu extends ut{constructor(t,n,i,r){super(Object.assign({},n),{name:t});this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function Fu(e){e.component.projection=K(e)?dy(e):hy(e)}function dy(e){var t;if(e.hasProjection){const n=de(e.specifiedProjection),i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=i?gy(e):void 0,o=new Nu(e.projectionName(!0),Object.assign(Object.assign({},(t=de(e.config.projection))!==null&&t!==void 0?t:{}),n??{}),r,s);return o.get("type")||o.set("type","equalEarth",!1),o}return}function gy(e){const t=[],{encoding:n}=e;for(const i of[[Le,ze],[ve,$e]])(J(n[i[0]])||J(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(fe)&&e.typedFieldDef(fe).type===fn&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(B.Main)),t}function py(e,t){const n=Ar(fy,r=>!en(e.explicit,r)&&!en(t.explicit,r)?!0:!!(en(e.explicit,r)&&en(t.explicit,r)&&Ae(e.get(r),t.get(r)))),i=Ae(e.size,t.size);if(i){if(n)return e;if(Ae(e.explicit,{}))return t;if(Ae(t.explicit,{}))return e}return null}function hy(e){if(e.children.length===0)return;let t;for(const i of e.children)Fu(i);const n=Ar(e.children,i=>{const r=i.component.projection;if(r)if(t){const s=py(t,r);return s&&(t=s),!!s}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new Nu(i,t.specifiedProjection,t.size,C(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),i),o.merged=!0)}return r}return}var my=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function by(e,t,n,i){var r,s;if(Yn(t,n)){const o=K(e)?(s=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&s!==void 0?s:{}:{},a=_(t,{expr:"datum"}),c=_(t,{expr:"datum",binSuffix:"end"});return{formulaAs:_(t,{binSuffix:"range",forAs:!0}),formula:Li(a,c,o.format,o.formatType,i)}}return{}}function Pu(e,t){return`${pa(e)}_${t}`}function yy(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function bo(e,t,n){var i;const r=(i=Vi(n,void 0))!==null&&i!==void 0?i:{},s=Pu(r,t);return e.getName(`${s}_bins`)}function vy(e){return"as"in e}function Au(e,t,n){let i,r;vy(e)?i=F(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[_(e,{forAs:!0}),_(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},Vi(t,void 0)),o=Pu(s,e.field),{signal:a,extentSignal:c}=yy(n,o);if(ki(s.extent)){const u=s.extent;r=ru(n,u.param,u),delete s.extent}const l=Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[i]},a?{signal:a}:{}),c?{extentSignal:c}:{}),r?{span:r}:{});return{key:o,binComponent:l}}class Ke extends D{constructor(t,n){super(t);this.bins=n}clone(){return new Ke(null,C(this.bins))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{if(_e(s)&&U(s.bin)){const{key:a,binComponent:c}=Au(s,s.bin,n);r[a]=Object.assign(Object.assign(Object.assign({},c),r[a]),by(n,s,o,n.config))}return r},{});return L(i)?null:new Ke(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:s}=Au(n,n.bin,i);return new Ke(t,{[r]:s})}merge(t,n){for(const i of y(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=Te([...this.bins[i].as,...t.bins[i].as],I)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(ne(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(ne(this.bins).map(t=>t.field))}hash(){return`Bin ${I(this.bins)}`}assemble(){return ne(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,s=t.bin,{extent:o}=s,a=my(s,["extent"]),c=Object.assign(Object.assign(Object.assign({type:"bin",field:ye(t.field),as:i,signal:t.signal},ki(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(n.push({type:"extent",field:ye(t.field),signal:t.extentSignal}),c.extent={signal:t.extentSignal}),n.push(c);for(const l of r)for(let u=0;u<2;u++)n.push({type:"formula",expr:_({field:i[u]},{expr:"datum"}),as:l[u]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function Oy(e,t,n,i){var r;const s=K(i)?i.encoding[rt(t)]:void 0;if(_e(n)&&K(i)&&_c(n,s,i.markDef,i.config))e.add(_(n,{})),e.add(_(n,{suffix:"end"})),n.bin&&Yn(n,t)&&e.add(_(n,{binSuffix:"range"}));else if(Qf(t)){const o=Kf(t);e.add(i.getName(o))}else e.add(_(n));return Gt(n)&&fp((r=n.scale)===null||r===void 0?void 0:r.range)&&e.add(n.scale.range.field),e}function xy(e,t){var n;for(const i of y(t)){const r=t[i];for(const s of y(r))i in e?e[i][s]=new Set([...(n=e[i][s])!==null&&n!==void 0?n:[],...r[s]]):e[i]={[s]:r[s]}}}class Ce extends D{constructor(t,n,i){super(t);this.dimensions=n,this.measures=i}clone(){return new Ce(null,new Set(this.dimensions),C(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(o=>{o.aggregate&&(i=!0)});const r={},s=new Set;return i?(n.forEachFieldDef((o,a)=>{var c,l,u,f;const{aggregate:d,field:g}=o;if(d)if(d==="count")(c=r["*"])!==null&&c!==void 0||(r["*"]={}),r["*"].count=new Set([_(o,{forAs:!0})]);else{if(st(d)||xt(d)){const p=st(d)?"argmin":"argmax",m=d[p];(l=r[m])!==null&&l!==void 0||(r[m]={}),r[m][p]=new Set([_({op:p,field:m},{forAs:!0})])}else(u=r[g])!==null&&u!==void 0||(r[g]={}),r[g][d]=new Set([_(o,{forAs:!0})]);Ot(a)&&n.scaleDomain(a)==="unaggregated"&&((f=r[g])!==null&&f!==void 0||(r[g]={}),r[g].min=new Set([_({field:g,aggregate:"min"},{forAs:!0})]),r[g].max=new Set([_({field:g,aggregate:"max"},{forAs:!0})]))}else Oy(s,a,o,n)}),s.size+y(r).length===0?null:new Ce(t,s,r)):null}static makeFromTransform(t,n){var i,r,s;const o=new Set,a={};for(const c of n.aggregate){const{op:l,field:u,as:f}=c;l&&(l==="count"?((i=a["*"])!==null&&i!==void 0||(a["*"]={}),a["*"].count=new Set([f||_(c,{forAs:!0})])):((r=a[u])!==null&&r!==void 0||(a[u]={}),a[u][l]=new Set([f||_(c,{forAs:!0})])))}for(const c of(s=n.groupby)!==null&&s!==void 0?s:[])o.add(c);return o.size+y(a).length===0?null:new Ce(t,o,a)}merge(t){return Zo(this.dimensions,t.dimensions)?(xy(this.measures,t.measures),!0):(Cg("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...y(this.measures)])}producedFields(){const t=new Set;for(const n of y(this.measures))for(const i of y(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${I({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const s of y(this.measures))for(const o of y(this.measures[s]))for(const a of this.measures[s][o])i.push(a),t.push(o),n.push(s==="*"?null:ye(s));const r={type:"aggregate",groupby:[...this.dimensions].map(ye),ops:t,fields:n,as:i};return r}}class $n extends D{constructor(t,n,i,r){super(t);this.model=n,this.name=i,this.data=r;for(const s of Oe){const o=n.facet[s];if(o){const{bin:a,sort:c}=o;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[_(o),...U(a)?[_(o,{binSuffix:"end"})]:[]]},qe(c)?{sortField:c}:S(c)?{sortIndexField:Sn(o,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of Oe)this[n]&&(t+=` ${n.charAt(0)}:${I(this[n])}`);return t}get fields(){var t;const n=[];for(const i of Oe)((t=this[i])===null||t===void 0?void 0:t.fields)&&n.push(...this[i].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of Oe)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of Ue){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(ie(r)&&jt(s)){const o=hr(this.childModel,n),a=Eo(o);a?t[n]=a:v(Xr(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x",facet:void 0}[t],s=[],o=[],a=[];r&&i&&i[r]&&(n?(s.push(`distinct_${i[r]}`),o.push("max")):(s.push(i[r]),o.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:c,sortIndexField:l}=this[t];if(c){const{op:u=Di,field:f}=c;s.push(f),o.push(u),a.push(_(c,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var n,i;const{columns:r}=this.model.layout,{layoutHeaders:s}=this.model.component,o=[],a={};for(const u of uo){for(const f of fo){const d=(n=s[u]&&s[u][f])!==null&&n!==void 0?n:[];for(const g of d)if(((i=g.axes)===null||i===void 0?void 0:i.length)>0){a[u]=!0;break}}if(a[u]){const f=`length(data("${this.facet.name}"))`,d=u==="row"?r?{signal:`ceil(${f} / ${r})`}:1:r?{signal:`min(${f}, ${r})`}:{signal:f};o.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:d}]})}}const{row:c,column:l}=a;return(c||l)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,n;const i=[];let r=null;const s=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:c}=this;if(o&&a&&(s.x||s.y)){r=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),u=l.map(()=>"distinct");i.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:u}]})}for(const l of[Je,Ze])this[l]&&i.push(this.assembleRowColumnHeaderData(l,r,s));if(c){const l=this.assembleFacetHeaderData(s);l&&i.push(...l)}return i}}function Tu(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function _y(e,t){const n=zr(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.startsWith("date:")){const i=Tu(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.startsWith("utc:")){const i=Tu(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return v(Dd(t)),null}function jy(e){const t={};return yi(e.filter,n=>{var i;if(Va(n)){let r=null;ts(n)?r=he(n.equal):is(n)?r=he(n.lte):ns(n)?r=he(n.lt):rs(n)?r=he(n.gt):ss(n)?r=he(n.gte):os(n)?r=n.range[0]:as(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(Bt(r)?t[n.field]="date":X(r)?t[n.field]="number":F(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function Sy(e){const t={};function n(i){hn(i)?t[i.field]="date":i.type==="quantitative"&&md(i.aggregate)?t[i.field]="number":an(i.field)>1?i.field in t||(t[i.field]="flatten"):Gt(i)&&qe(i.sort)&&an(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((K(e)||Fe(e))&&e.forEachFieldDef((i,r)=>{if(_e(i))n(i);else{const s=Dt(r),o=e.fieldDef(s);n(Object.assign(Object.assign({},i),{type:o.type}))}}),K(e)){const{mark:i,markDef:r,encoding:s}=e;if(St(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",a=s[o];j(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function wy(e){const t={};if(K(e)&&e.component.selection)for(const n of y(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&an(r.field)>1&&(t[r.field]="flatten")}return t}class se extends D{constructor(t,n){super(t);this._parse=n}clone(){return new se(null,C(this._parse))}hash(){return`Parse ${I(this._parse)}`}static makeExplicit(t,n,i){var r;let s={};const o=n.data;return!Ct(o)&&((r=o==null?void 0:o.format)===null||r===void 0?void 0:r.parse)&&(s=o.format.parse),this.makeWithAncestors(t,s,{},i)}static makeWithAncestors(t,n,i,r){for(const a of y(i)){const c=r.getWithExplicit(a);c.value!==void 0&&(c.explicit||c.value===i[a]||c.value==="derived"||i[a]==="flatten"?delete i[a]:v(Pa(a,i[a],c.value)))}for(const a of y(n)){const c=r.get(a);c!==void 0&&(c===n[a]?delete n[a]:v(Pa(a,n[a],c)))}const s=new ut(n,i);r.copyAll(s);const o={};for(const a of y(s.combine())){const c=s.get(a);c!==null&&(o[a]=c)}return y(o).length===0||r.parseNothing?null:new se(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of y(this._parse)){const i=this._parse[n];an(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(y(this._parse))}dependentFields(){return new Set(y(this._parse))}assembleTransforms(t=!1){return y(this._parse).filter(n=>t?an(n)>1:!0).map(n=>{const i=_y(n,this._parse[n]);if(!i)return null;const r={type:"formula",expr:i,as:Lr(n)};return r}).filter(n=>n!==null)}}class At extends D{clone(){return new At(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([Qn])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Qn}}}class ri extends D{constructor(t,n){super(t);this.params=n}clone(){return new ri(null,this.params)}dependentFields(){return new Set}producedFields(){return}hash(){return`Graticule ${I(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class si extends D{constructor(t,n){super(t);this.params=n}clone(){return new si(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${I(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class Yt extends D{constructor(t){super(null);t??(t={name:"source"});let n;if(Ct(t)||(n=t.format?Object.assign({},pe(t.format,["parse"])):{}),Jn(t))this._data={values:t.values};else if(bn(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];P(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else Nl(t)?this._data={values:[{type:"Sphere"}]}:(kl(t)||Ct(t))&&(this._data={});this._generator=Ct(t),t.name&&(this._name=t.name),n&&!L(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){return}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var Iu=function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},$y=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},oi;function yo(e){return e instanceof Yt||e instanceof ri||e instanceof si}class vo{constructor(){oi.set(this,void 0),Iu(this,oi,!1,"f")}setModified(){Iu(this,oi,!0,"f")}get modifiedFlag(){return $y(this,oi,"f")}}oi=new WeakMap;class Kt extends vo{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const n=this.getNodeDepths(t,0,new Map),i=[...n.entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class Oo extends vo{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class Ey extends Oo{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of y(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class ky extends Oo{constructor(t){super();this.requiresSelectionId=t&&so(t)}run(t){t instanceof At&&(this.requiresSelectionId&&(yo(t.parent)||t.parent instanceof Ce||t.parent instanceof se)||(this.setModified(),t.remove()))}}class Cy extends vo{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof Ye&&(i=t.producedFields(),Tr(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class Ny extends Oo{constructor(){super()}run(t){t instanceof le&&!t.isRequired()&&(this.setModified(),t.remove())}}class Fy extends Kt{run(t){if(yo(t))return;if(t.numChildren()>1)return;for(const n of t.children)if(n instanceof se)if(t instanceof se)this.setModified(),t.merge(n);else{if(Rr(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}return}}class Py extends Kt{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof se);if(t.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const o of i){const a=o.parse;for(const c of y(a))c in r?r[c]!==a[c]&&s.add(c):r[c]=a[c]}for(const o of s)delete r[o];if(!L(r)){this.setModified();const o=new se(t,r);for(const a of n){if(a instanceof se)for(const c of y(r))delete a.parse[c];t.removeChild(a),a.parent=o,a instanceof se&&y(a.parse).length===0&&a.remove()}}}}}class Ay extends Kt{run(t){t instanceof le||t.numChildren()>0||t instanceof $n||(t instanceof Yt||(this.setModified(),t.remove()))}}class Ty extends Kt{run(t){const n=t.children.filter(r=>r instanceof Ye),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class Iy extends Kt{run(t){const n=t.children.filter(r=>r instanceof Ce),i={};for(const r of n){const s=I(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of y(i)){const s=i[r];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(t.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class Ry extends Kt{constructor(t){super();this.model=t}run(t){const n=!(yo(t)||t instanceof _n||t instanceof se||t instanceof At),i=[],r=[];for(const s of t.children)s instanceof Ke&&(n&&!Rr(t.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof Ke?t.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class zy extends Kt{run(t){const n=[...t.children],i=on(n,o=>o instanceof le);if(!i||t.numChildren()<=1)return;const r=[];let s;for(const o of n)if(o instanceof le){let a=o;for(;a.numChildren()===1;){const[c]=a.children;if(c instanceof le)a=c;else break}r.push(...a.children),s?(t.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else r.push(o);if(r.length){this.setModified();for(const o of r)o.parent.removeChild(o),o.parent=s}}}class Qt extends D{constructor(t,n){super(t);this.transform=n}clone(){return new Qt(null,C(this.transform))}addDimensions(t){this.transform.groupby=Te(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:_(t)}hash(){return`JoinAggregateTransform ${I(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},r!==void 0?{groupby:r}:{})}}function Ly(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=_(i);return r&&t.push(r),t},[])}function Dy(e){return S(e)&&e.every(t=>F(t))&&e.length>1}class dt extends D{constructor(t,n){super(t);this._stack=n}clone(){return new dt(null,C(this._stack))}static makeFromTransform(t,n){const{stack:i,groupby:r,as:s,offset:o="zero"}=n,a=[],c=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),c.push(Y(f.order,"ascending"));const l={field:a,order:c};let u;return Dy(s)?u=s:F(s)?u=[s,`${s}_end`]:u=[`${n.stack}_start`,`${n.stack}_end`],new dt(t,{stackField:i,groupby:r,offset:o,sort:l,facetby:[],as:u})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannel:s,fieldChannel:o,offset:a,impute:c}=i;let l;if(s){const g=r[s];l=Ve(g)}const u=Ly(n),f=n.encoding.order;let d;return S(f)||j(f)?d=_a(f):d=u.reduce((g,p)=>(g.field.push(p),g.order.push(o==="y"?"descending":"ascending"),g),{field:[],order:[]}),new dt(t,{dimensionFieldDef:l,stackField:n.vgField(o),facetby:[],stackby:u,sort:d,offset:a,impute:c,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${I(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:i}=this._stack;return t?t.bin?n?[_(t,{binSuffix:"mid"})]:[_(t,{}),_(t,{binSuffix:"end"})]:[_(t)]:i??[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:i,stackField:r,stackby:s,sort:o,offset:a,impute:c,as:l}=this._stack;if(c&&i){const{bandPosition:u=.5,bin:f}=i;f&&t.push({type:"formula",expr:`${u}*`+_(i,{expr:"datum"})+`+${1-u}*`+_(i,{expr:"datum",binSuffix:"end"}),as:_(i,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:r,groupby:[...s,...n],key:_(i,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:o,as:l,offset:a}),t}}class En extends D{constructor(t,n){super(t);this.transform=n}clone(){return new En(null,C(this.transform))}addDimensions(t){this.transform.groupby=Te(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const i=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(i.add,i),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(r=>i.add(r.field)),this.transform.window.map(r=>r.field).filter(r=>r!==void 0).forEach(i.add,i),i}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:_(t)}hash(){return`WindowTransform ${I(this.transform)}`}assemble(){var t;const n=[],i=[],r=[],s=[];for(const d of this.transform.window)i.push(d.op),r.push(this.getDefaultName(d)),s.push(d.param===void 0?null:d.param),n.push(d.field===void 0?null:d.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&i.every(d=>Hr(d)))return Object.assign({type:"joinaggregate",as:r,ops:i,fields:n},a!==void 0?{groupby:a}:{});const c=[],l=[];if(this.transform.sort!==void 0)for(const d of this.transform.sort)c.push(d.field),l.push((t=d.order)!==null&&t!==void 0?t:"ascending");const u={field:c,order:l},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:r,ops:i,fields:n,sort:u},f!==void 0?{ignorePeers:f}:{}),a!==void 0?{groupby:a}:{}),o!==void 0?{frame:o}:{})}}function My(e){function t(n){if(!(n instanceof $n)){const i=n.clone();if(i instanceof le){const r=_o+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof Ce||i instanceof dt||i instanceof En||i instanceof Qt)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function xo(e){if(e instanceof $n)if(e.numChildren()===1&&!(e.children[0]instanceof le)){const t=e.children[0];(t instanceof Ce||t instanceof dt||t instanceof En||t instanceof Qt)&&t.addDimensions(e.fields),t.swapWithParent(),xo(e)}else{const t=e.model.component.data.main;Ru(t);const n=My(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(xo)}function Ru(e){if(e instanceof le&&e.type===B.Main&&e.numChildren()===1){const t=e.children[0];t instanceof $n||(t.swapWithParent(),Ru(e))}}const _o="scale_",pr=5;function jo(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!jo(t.children))return!1}return!0}function Ne(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function zu(e,t,n){let i=e.sources,r=!1;return r=Ne(new Ny,i)||r,r=Ne(new ky(t),i)||r,i=i.filter(s=>s.numChildren()>0),r=Ne(new Ay,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=Ne(new Fy,i)||r,r=Ne(new Ry(t),i)||r,r=Ne(new Cy,i)||r,r=Ne(new Py,i)||r,r=Ne(new Iy,i)||r,r=Ne(new Ty,i)||r,r=Ne(new Ey,i)||r,r=Ne(new zy,i)||r),e.sources=i,r}function Uy(e,t){jo(e.sources);let n=0,i=0;for(let r=0;r<pr&&zu(e,t,!0);r++)n++;e.sources.map(xo);for(let r=0;r<pr&&zu(e,t,!1);r++)i++;jo(e.sources),Math.max(n,i)===pr&&v(`Maximum optimization runs(${pr}) reached.`)}class ge{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new ge(()=>t(n))}}var By=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Lu(e){K(e)?Wy(e):Hy(e)}function Wy(e){const t=e.component.scales;for(const n of y(t)){const i=Gy(e,n),r=t[n];if(r.setWithExplicit("domains",i),Xy(e,n),e.component.data.isFaceted){let s=e;for(;!Fe(s)&&s.parent;)s=s.parent;const o=s.component.resolve.scale[n];if(o==="shared")for(const a of i.value)ot(a)&&(a.data=_o+a.data.replace(_o,""))}}}function Hy(e){for(const n of e.children)Lu(n);const t=e.component.scales;for(const n of y(t)){let i,r=null;for(const s of e.children){const o=s.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=kt(i,o.getWithExplicit("domains"),"domains","scale",$o);const a=o.get("selectionExtent");r&&a&&r.param!==a.param&&v(Id),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function qy(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:s}=Du(t,n);if(!r){v(s);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=Du(t,n);if(r)return"unaggregated"}return e}function Gy(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=qy(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&J(i.x2)?J(i.x)?kt(Tt(n,r,e,"x"),Tt(n,r,e,"x2"),"domain","scale",$o):Tt(n,r,e,"x2"):t==="y"&&J(i.y2)?J(i.y)?kt(Tt(n,r,e,"y"),Tt(n,r,e,"y2"),"domain","scale",$o):Tt(n,r,e,"y2"):Tt(n,r,e,t)}function Vy(e,t,n){return e.map(i=>{const r=Xi(i,{timeUnit:n,type:t});return{signal:`{data: ${r}}`}})}function So(e,t,n){var i;const r=(i=ae(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?Vy(e,t,r):[e]}function Tt(e,t,n,i){const{encoding:r}=n,s=J(r[i]),{type:o}=s,a=s.timeUnit;if(up(t)){const f=Tt(e,void 0,n,i),d=So(t.unionWith,o,a);return ft([...f.value,...d])}else{if(w(t))return ft([t]);if(t&&t!=="unaggregated"&&!Qa(t))return ft(So(t,o,a))}const c=n.stack;if(c&&i===c.fieldChannel){if(c.offset==="normalize")return be([[0,1]]);const f=n.requestDataName(B.Main);return be([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const l=Ot(i)&&j(s)?Yy(n,i,e):void 0;if(wt(s)){const f=So([s.datum],o,a);return be(f)}const u=s;if(t==="unaggregated"){const f=n.requestDataName(B.Main),{field:d}=s;return be([{data:f,field:_({field:d,aggregate:"min"})},{data:f,field:_({field:d,aggregate:"max"})}])}else if(U(u.bin)){if(ie(e))return e==="bin-ordinal"?be([]):be([{data:In(l)?n.requestDataName(B.Main):n.requestDataName(B.Raw),field:n.vgField(i,Yn(u,i)?{binSuffix:"range"}:{}),sort:l===!0||!W(l)?{field:n.vgField(i,{}),op:"min"}:l}]);{const{bin:f}=u;if(U(f)){const d=bo(n,u.field,f);return be([new ge(()=>{const g=n.getSignalName(d);return`[${g}.start, ${g}.stop]`})])}else return be([{data:n.requestDataName(B.Main),field:n.vgField(i,{})}])}}else if(u.timeUnit&&P(["time","utc"],e)&&_c(u,K(n)?n.encoding[rt(i)]:void 0,n.markDef,n.config)){const f=n.requestDataName(B.Main);return be([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return be(l?[{data:In(l)?n.requestDataName(B.Main):n.requestDataName(B.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(B.Main),field:n.vgField(i)}])}function wo(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n??(t?"sum":Di)},i?{field:ye(i)}:{}),r?{order:r}:{})}function Xy(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=Qa(r)&&r,a=Mt(s)&&ki(s.extent)&&s.extent;(o||a)&&i.set("selectionExtent",o??a,!0)}function Yy(e,t,n){if(!ie(n))return;const i=e.fieldDef(t),r=i.sort;if(yc(r))return{op:"min",field:Sn(i,t),order:"ascending"};const{stack:s}=e,o=s?[...s.groupbyField?[s.groupbyField]:[],...s.stackBy.map(a=>a.fieldDef.field)]:void 0;if(qe(r)){const a=s&&!P(o,r.field);return wo(r,a)}else if(bc(r)){const{encoding:a,order:c}=r,l=e.fieldDef(a),{aggregate:u,field:f}=l,d=s&&!P(o,f);if(st(u)||xt(u))return wo({field:_(l),order:c},d);if(Hr(u)||!u)return wo({op:u,field:f,order:c},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(P(["ascending",void 0],r))return!0}return}function Du(e,t){const{aggregate:n,type:i}=e;return n?F(n)&&!vd[n]?{valid:!1,reason:og(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:ag(e)}:{valid:!0}:{valid:!1,reason:sg(e)}}function $o(e,t,n,i){return e.explicit&&t.explicit&&v(dg(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function Ky(e){const t=Te(e.map(o=>{if(ot(o)){const a=By(o,["sort"]);return a}return o}),I),n=Te(e.map(o=>{if(ot(o)){const a=o.sort;return a!==void 0&&!In(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}return}).filter(o=>o!==void 0),I);if(t.length===0)return;if(t.length===1){const o=e[0];if(ot(o)&&n.length>0){let a=n[0];if(n.length>1)v(La),a=!0;else if(W(a)&&"field"in a){const c=a.field;o.field===c&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},o),{sort:a})}return o}const i=Te(n.map(o=>In(o)||!("op"in o)||F(o.op)&&o.op in pd?o:(v(pg(o)),!0)),I);let r;i.length===1?r=i[0]:i.length>1&&(v(La),r=!0);const s=Te(e.map(o=>ot(o)?o.data:null),o=>o);if(s.length===1&&s[0]!==null){const o=Object.assign({data:s[0],fields:t.map(a=>a.field)},r?{sort:r}:{});return o}return Object.assign({fields:t},r?{sort:r}:{})}function Eo(e){if(ot(e)&&F(e.field))return e.field;if(xd(e)){let t;for(const n of e.fields)if(ot(n)&&F(n.field)){if(!t)t=n.field;else if(t!==n.field)return v(hg),t}return v(mg),t}else if(_d(e)){v(bg);const t=e.fields[0];return F(t)?t:void 0}return}function hr(e,t){const n=e.component.scales[t],i=n.get("domains").map(r=>(ot(r)&&(r.data=e.lookupDataSource(r.data)),r));return Ky(i)}var Qy=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Mu(e){return kn(e)||No(e)?e.children.reduce((t,n)=>t.concat(Mu(n)),Uu(e)):Uu(e)}function Uu(e){return y(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:c,range:l,reverse:u}=r,f=Qy(r,["name","type","selectionExtent","domains","range","reverse"]),d=Zy(r.range,s,n,e),g=hr(e,n),p=a?Bm(e,a,i,g):null;return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},g?{domain:g}:{}),p?{domainRaw:p}:{}),{range:d}),u!==void 0?{reverse:u}:{}),f)),t},[])}function Zy(e,t,n,i){if(Be(n)){if(jt(e))return{step:{signal:`${t}_step`}}}else if(W(e)&&ot(e))return Object.assign(Object.assign({},e),{data:i.lookupDataSource(e.data)});return e}class Bu extends ut{constructor(t,n){super({},{name:t});this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:on(this.get("domains"),t=>S(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const Jy=["range","scheme"];function Wu(e){return e==="x"?"width":e==="y"?"height":void 0}function ev(e){const t=e.component.scales;for(const n of Ei){const i=t[n];if(!i)continue;const r=tv(n,e);i.setWithExplicit("range",r)}}function Hu(e,t){const n=e.fieldDef(t);if(n==null?void 0:n.bin){const{bin:i,field:r}=n,s=Wu(t),o=e.getName(s);if(W(i)&&i.binned&&i.step!==void 0)return new ge(()=>{const a=e.scaleName(t),c=`(domain("${a}")[1] - domain("${a}")[0]) / ${i.step}`;return`${e.getSignalName(o)} / (${c})`});if(U(i)){const a=bo(e,r,i);return new ge(()=>{const c=e.getSignalName(a),l=`(${c}.stop - ${c}.start) / ${c}.step`;return`${e.getSignalName(o)} / (${l})`})}}return}function tv(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e),s=r.get("type");for(const l of Jy)if(n[l]!==void 0){const u=ds(s,l),f=Za(e,l);if(!u)v(Ra(s,l,e));else if(f)v(f);else switch(l){case"range":{const d=n.range;if(S(d)){if(Be(e))return ft(d.map(g=>{if(g==="width"||g==="height"){const p=t.getName(g),m=t.getSignalName.bind(t);return ge.fromName(m,p)}return g}))}else if(W(d))return ft({data:t.requestDataName(B.Main),field:d.field,sort:{op:"min",field:t.vgField(e)}});return ft(d)}case"scheme":return ft(nv(n[l]))}}if(e===G||e===Q){const l=e===G?"width":"height",u=i[l];if(Xe(u)){if(ie(s))return ft({step:u.step});v(za(l))}}const{rangeMin:o,rangeMax:a}=n,c=iv(e,t);return(o!==void 0||a!==void 0)&&ds(s,"rangeMin")&&S(c)&&c.length===2?ft([o??c[0],a??c[1]]):be(c)}function nv(e){return lp(e)?Object.assign({scheme:e.name},pe(e,["name"])):{scheme:e}}function iv(e,t){const{size:n,config:i,mark:r,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=J(s[e]),c=t.getScaleComponent(e),l=c.get("type"),{domain:u,domainMid:f}=t.specifiedScales[e];switch(e){case G:case Q:{if(P(["point","band"],l)){if(e===G&&!n.width){const p=Zn(i.view,"width");if(Xe(p))return p}else if(e===Q&&!n.height){const p=Zn(i.view,"height");if(Xe(p))return p}}const d=Wu(e),g=t.getName(d);return e===Q&&me(l)?[ge.fromName(o,g),0]:[0,ge.fromName(o,g)]}case nt:{const d=t.component.scales[e].get("zero"),g=qu(r,d,i),p=ov(r,n,t,i);return Gn(l)?sv(g,p,rv(l,i,u,e)):[g,p]}case we:return[0,Math.PI*2];case zt:return[0,360];case Re:return[0,new ge(()=>{const d=t.getSignalName("width"),g=t.getSignalName("height");return`min(${d},${g})/2`})];case mt:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case bt:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case fe:return"symbol";case ue:case De:case Me:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case it:case pt:case ht:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function rv(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&S(n)?n.length+1:(v($g(i)),3)}}function sv(e,t,n){const i=()=>{const r=at(t),s=at(e),o=`(${r} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${r} + ${o}, ${o})`};return w(t)?new ge(i):{signal:i()}}function qu(e,t,n){if(t)return w(t)?{signal:`${t.signal} ? 0 : ${qu(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Ni("size",e))}const Gu=.95;function ov(e,t,n,i){const r={x:Hu(n,"x"),y:Hu(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=Vu(t,r,i.view);return X(s)?s-1:new ge(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=Vu(t,r,i.view);return X(s)?Math.pow(Gu*s,2):new ge(()=>`pow(${Gu} * ${s.signal}, 2)`)}}throw new Error(Ni("size",e))}function Vu(e,t,n){const i=Xe(e.width)?e.width.step:tr(n,"width"),r=Xe(e.height)?e.height.step:tr(n,"height");return t.x||t.y?new ge(()=>{const s=[t.x?t.x.signal:i,t.y?t.y.signal:r];return`min(${s.join(", ")})`}):Math.min(i,r)}function Xu(e,t){K(e)?av(e,t):Qu(e,t)}function av(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=e;for(const a of y(n)){const c=o[a],l=n[a],u=e.getScaleComponent(a),f=J(r[a]),d=c[t],g=u.get("type"),p=u.get("padding"),m=u.get("paddingInner"),h=ds(g,t),x=Za(a,t);if(d!==void 0&&(h?x&&v(x):v(Ra(g,t,a))),h&&x===void 0)if(d!==void 0){const b=f.timeUnit,O=f.type;switch(t){case"domainMax":case"domainMin":Bt(c[t])||O==="temporal"||b?l.set(t,{signal:Xi(c[t],{type:O,timeUnit:b})},!0):l.set(t,c[t],!0);break;default:l.copyKeyFromObject(t,c)}}else{const b=t in Yu?Yu[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:g,scalePadding:p,scalePaddingInner:m,domain:c.domain,markDef:s,config:i}):i.scale[t];b!==void 0&&l.set(t,b,!1)}}}const Yu={bins:({model:e,fieldOrDatumDef:t})=>j(t)?cv(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>lv(e,t.type),nice:({scaleType:e,channel:t,domain:n,fieldOrDatumDef:i})=>uv(e,t,n,i),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>fv(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>dv(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:s})=>gv(e,t,n,i.type,r,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=j(e)?e.sort:void 0;return pv(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>hv(e,t,n,i,r)};function Ku(e){K(e)?ev(e):Qu(e,"range")}function Qu(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?Ku(i):Xu(i,t);for(const i of y(n)){let r;for(const s of e.children){const o=s.component.scales[i];if(o){const a=o.getWithExplicit(t);r=kt(r,a,t,"scale",El((c,l)=>{switch(t){case"range":return c.step&&l.step?c.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function cv(e,t){const n=t.bin;if(U(n)){const i=bo(e,t.field,n);return new ge(()=>e.getSignalName(i))}else if(oe(n)&&Mt(n)&&n.step!==void 0)return{step:n.step};return}function lv(e,t){return P([ue,De,Me],e)&&t!=="nominal"?"hcl":void 0}function uv(e,t,n,i){var r;return((r=Ve(i))===null||r===void 0?void 0:r.bin)||S(n)||P([Z.TIME,Z.UTC],e)?void 0:t in vt?!0:void 0}function fv(e,t,n,i,r,s){if(e in vt){if(Ee(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=r;if(o==="bar"&&!(j(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===Z.POINT)return n.pointPadding}return}function dv(e,t,n,i){if(e!==void 0)return;if(t in vt){const{bandPaddingInner:r,barBandPaddingInner:s,rectBandPaddingInner:o}=i;return Y(r,n==="bar"?s:o)}return}function gv(e,t,n,i,r,s){if(e!==void 0)return;if(t in vt&&n===Z.BAND){const{bandPaddingOuter:o}=s;return Y(o,w(r)?{signal:`${r.signal}/2`}:r/2)}return}function pv(e,t,n,i){return n==="x"&&i.xReverse!==void 0?me(e)&&t==="descending"?w(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:me(e)&&t==="descending"?!0:void 0}function hv(e,t,n,i,r){const s=!!n&&n!=="unaggregated";if(s&&me(r)){if(S(n)){const o=n[0],a=n[n.length-1];if(o<=0&&a>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!Gn(r))return!0;if(!(j(t)&&t.bin)&&P([...Ue,...od],e)){const{orient:o,type:a}=i;return!(P(["bar","area","line","trail"],a)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function mv(e,t,n,i){const r=bv(t,n,i),{type:s}=e;return Ot(t)?s!==void 0?mp(t,s)?j(n)&&!hp(s,n.type)?(v(ug(s,r)),r):s:(v(lg(t,s,r)),r):r:null}function bv(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":{if(cn(e)||Wr(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&v(Kr(e,"ordinal")),"ordinal";if(e in vt){if(P(["rect","bar","image","rule"],n.type))return"band"}else if(n.type==="arc"&&e in Br)return"band";const r=n[xe(e)];return dn(r)||ws(t)&&((i=t.axis)===null||i===void 0?void 0:i.tickBand)?"band":"point"}case"temporal":return cn(e)?"time":Wr(e)==="discrete"?(v(Kr(e,"temporal")),"ordinal"):j(t)&&t.timeUnit&&ae(t.timeUnit).utc?"utc":"time";case"quantitative":return cn(e)?j(t)&&U(t.bin)?"bin-ordinal":"linear":Wr(e)==="discrete"?(v(Kr(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(Ta(t.type))}function yv(e,{ignoreRange:t}={}){Zu(e),Lu(e);for(const n of pp)Xu(e,n);t||Ku(e)}function Zu(e){K(e)?e.component.scales=vv(e):e.component.scales=xv(e)}function vv(e){const{encoding:t,mark:n,markDef:i}=e;return Ei.reduce((r,s)=>{const o=J(t[s]);if(o&&n===tc&&s===fe&&o.type===fn)return r;let a=o&&o.scale;if(o&&a!==null&&a!==!1){a??(a={});const c=mv(a,s,o,i);r[s]=new Bu(e.scaleName(`${s}`,!0),{value:c,explicit:a.type===c})}return r},{})}const Ov=El((e,t)=>Ya(e)-Ya(t));function xv(e){var t,n;const i=e.component.scales={},r={},s=e.component.resolve;for(const o of e.children){Zu(o);for(const a of y(o.component.scales))if((t=(n=s.scale)[a])!==null&&t!==void 0||(n[a]=yu(a,e)),s.scale[a]==="shared"){const c=r[a],l=o.component.scales[a].getWithExplicit("type");c?Kg(c.value,l.value)?r[a]=kt(c,l,"type","scale",Ov):(s.scale[a]="independent",delete r[a]):r[a]=l}}for(const o of y(r)){const a=e.scaleName(o,!0),c=r[o];i[o]=new Bu(a,c);for(const l of e.children){const u=l.component.scales[o];u&&(l.renameScale(u.get("name"),a),u.merged=!0)}}return i}var ko=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Co{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function K(e){return(e==null?void 0:e.type)==="unit"}function Fe(e){return(e==null?void 0:e.type)==="facet"}function No(e){return(e==null?void 0:e.type)==="concat"}function kn(e){return(e==null?void 0:e.type)==="layer"}class Fo{constructor(t,n,i,r,s,o,a){var c,l;this.type=n,this.parent=i,this.config=s,this.correctDataNames=u=>{var f,d,g;return((f=u.from)===null||f===void 0?void 0:f.data)&&(u.from.data=this.lookupDataSource(u.from.data)),((g=(d=u.from)===null||d===void 0?void 0:d.facet)===null||g===void 0?void 0:g.data)&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u},this.parent=i,this.config=s,this.view=de(a),this.name=(c=t.name)!==null&&c!==void 0?c:r,this.title=_t(t.title)?{text:t.title}:t.title?de(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new Co,this.projectionNameMap=i?i.projectionNameMap:new Co,this.signalNameMap=i?i.signalNameMap:new Co,this.data=t.data,this.description=t.description,this.transforms=wm((l=t.transform)!==null&&l!==void 0?l:[]),this.layout=n==="layer"||n==="unit"?{}:Fh(t,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:Mi(t)||i&&i.component.data.isFaceted&&t.data===void 0},layoutSize:new ut,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?C(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){yv(this)}parseProjection(){Fu(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){$u(this)}assembleEncodeFromView(t){const n=ko(t,["style"]),i={};for(const r of y(n)){const s=n[r];s!==void 0&&(i[r]=q(s))}return i}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=q(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{}):L(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,i=ko(t,["spacing"]),{component:r,config:s}=this,o=Db(r.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),i),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of Oe)t[i].title&&n.push(Ab(this,i));for(const i of uo)n=n.concat(Tb(this,i));return n}assembleAxes(){return xb(this.component.axes,this.config)}assembleLegends(){return ku(this)}assembleProjections(){return ly(this)}assembleTitle(){var t,n,i;const r=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=r,o=ko(r,["encoding"]),a=Object.assign(Object.assign(Object.assign({},ma(this.config.title).nonMarkTitleProperties),o),s?{encode:{update:s}}:{});return a.text?(P(["unit","layer"],this.type)?P(["middle",void 0],a.anchor)&&((n=a.frame)!==null&&n!==void 0||(a.frame="group")):(i=a.anchor)!==null&&i!==void 0||(a.anchor="start"),L(a)?void 0:a):void 0}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||Fe(this.parent)?Mu(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return H((this.name?`${this.name}_`:"")+t)}getDataName(t){return this.getName(B[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(Fe(this.parent)){const n=mu(t),i=$i(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if(ie(s)&&jt(o)){const a=r.get("name"),c=hr(this,i),l=Eo(c);if(l){const u=_({aggregate:"distinct",field:l},{expr:"datum"});return{signal:hu(a,r,u)}}else return v(Xr(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){return n?this.getName(t):ca(t)&&Ot(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(Nd(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(i=>i.hasOrientSignalRef()))}}class Ju extends Fo{vgField(t,n={}){const i=this.fieldDef(t);return i?_(i,n):void 0}reduceFieldDef(t,n){return sh(this.getMapping(),(i,r,s)=>{const o=Ve(r);return o?t(i,o,s):i},n)}forEachFieldDef(t,n){Ns(this.getMapping(),(i,r)=>{const s=Ve(i);s&&t(s,r)},n)}}var _v=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class mr extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=C(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"value",(s=o[1])!==null&&s!==void 0?s:"density"]}clone(){return new mr(null,C(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${I(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,i=_v(t,["density"]),r=Object.assign({type:"kde",field:n},i);return r}}class ai extends D{constructor(t,n){super(t);this.filter=n}clone(){return new ai(null,Object.assign({},this.filter))}static make(t,n){const{config:i,mark:r,markDef:s}=n,o=z("invalid",s,i);if(o!=="filter")return null;const a=n.reduceFieldDef((c,l,u)=>{const f=Ot(u)&&n.getScaleComponent(u);if(f){const d=f.get("type");me(d)&&l.aggregate!=="count"&&!St(r)&&(c[l.field]=l)}return c},{});return y(a).length?new ai(t,a):null}dependentFields(){return new Set(y(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${I(this.filter)}`}assemble(){const t=y(this.filter).reduce((n,i)=>{const r=this.filter[i],s=_(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):r.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class br extends D{constructor(t,n){super(t);this.transform=n,this.transform=C(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,o)=>{var a;return(a=r[o])!==null&&a!==void 0?a:s})}clone(){return new br(this.parent,C(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${I(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform,i={type:"flatten",fields:t,as:n};return i}}class yr extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=C(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"key",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new yr(null,C(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${I(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform,i={type:"fold",fields:t,as:n};return i}}class Cn extends D{constructor(t,n,i,r){super(t);this.fields=n,this.geojson=i,this.signal=r}clone(){return new Cn(null,C(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[Le,ze],[ve,$e]]){const s=r.map(o=>{const a=J(n.encoding[o]);return j(a)?a.field:wt(a)?{expr:`${a.datum}`}:ke(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new Cn(t,s,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(fe)){const r=n.typedFieldDef(fe);r.type===fn&&(t=new Cn(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(F);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${I(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})]}}class ci extends D{constructor(t,n,i,r){super(t);this.projection=n,this.fields=i,this.as=r}clone(){return new ci(null,this.projection,C(this.fields),C(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[Le,ze],[ve,$e]]){const r=i.map(o=>{const a=J(n.encoding[o]);return j(a)?a.field:wt(a)?{expr:`${a.datum}`}:ke(a)?{expr:`${a.value}`}:void 0}),s=i[0]===ve?"2":"";(r[0]||r[1])&&(t=new ci(t,n.projectionName(),r,[n.getName(`x${s}`),n.getName(`y${s}`)]))}return t}dependentFields(){return new Set(this.fields.filter(F))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${I(this.fields)} ${I(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Zt extends D{constructor(t,n){super(t);this.transform=n}clone(){return new Zt(null,C(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t,s=[n,i,...r?[r]:[]].join(",");return{signal:`sequence(${s})`}}static makeFromTransform(t,n){return new Zt(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,s=i.y;if(j(r)&&j(s)){const o=r.impute?r:s.impute?s:void 0;if(o===void 0)return;const a=r.impute?s:s.impute?r:void 0,{method:c,value:l,frame:u,keyvals:f}=o.impute,d=Rc(n.mark,i);return new Zt(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},c?{method:c}:{}),l!==void 0?{value:l}:{}),u?{frame:u}:{}),f!==void 0?{keyvals:f}:{}),d.length?{groupby:d}:{}))}return null}hash(){return`Impute ${I(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:s,value:o,frame:a=[null,null]}=this.transform,c=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},i?{keyvals:am(i)?this.processSequence(i):i}:{}),{method:"value"}),s?{groupby:s}:{}),{value:!r||r==="value"?o:null});if(r&&r!=="value"){const l=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1},s?{groupby:s}:{}),u={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[c,l,u]}else return[c]}}var jv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class vr extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=C(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.loess]}clone(){return new vr(null,C(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${I(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:i}=t,r=jv(t,["loess","on"]),s=Object.assign({type:"loess",x:i,y:n},r);return s}}class li extends D{constructor(t,n,i){super(t);this.transform=n,this.secondary=i}clone(){return new li(null,C(this.transform),this.secondary)}static make(t,n,i,r){const s=n.component.data.sources,{from:o}=i;let a=null;if(cm(o)){let c=rf(o.data,s);c||(c=new Yt(o.data),s.push(c));const l=n.getName(`lookup_${r}`);a=new le(c,l,B.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(lm(o)){const c=o.param;i=Object.assign({as:c},i);let l;try{l=n.getSelectionComponent(H(c),c)}catch(u){throw new Error(Ad(c))}if(a=l.materialized,!a)throw new Error(Td(c))}return new li(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?V(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${I({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:V(this.transform.as)}:{});else{let n=this.transform.as;F(n)||(v(Bd),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}var Sv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Or extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=C(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"prob",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new Or(null,C(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${I(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,i=Sv(t,["quantile"]),r=Object.assign({type:"quantile",field:n},i);return r}}var wv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class xr extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=C(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.regression]}clone(){return new xr(null,C(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${I(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:i}=t,r=wv(t,["regression","on"]),s=Object.assign({type:"regression",x:i,y:n},r);return s}}class _r extends D{constructor(t,n){super(t);this.transform=n}clone(){return new _r(null,C(this.transform))}addDimensions(t){var n;this.transform.groupby=Te(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),i=>i)}producedFields(){return}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${I(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},r!==void 0?{limit:r}:{}),s!==void 0?{op:s}:{}),i!==void 0?{groupby:i}:{})}}class jr extends D{constructor(t,n){super(t);this.transform=n}clone(){return new jr(null,C(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${I(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function ef(e){let t=0;function n(i,r){var s;if(i instanceof Yt&&(!i.isGenerator&&!bn(i.data))){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}if(i instanceof se&&(i.parent instanceof Yt&&!r.source?(r.format=Object.assign(Object.assign({},(s=r.format)!==null&&s!==void 0?s:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof $n){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,e.push(...i.assemble());return}if((i instanceof ri||i instanceof si||i instanceof ai||i instanceof _n||i instanceof jn||i instanceof ci||i instanceof Ce||i instanceof li||i instanceof En||i instanceof Qt||i instanceof yr||i instanceof br||i instanceof mr||i instanceof vr||i instanceof Or||i instanceof xr||i instanceof At||i instanceof jr||i instanceof _r)&&r.transform.push(i.assemble()),(i instanceof Ke||i instanceof Ye||i instanceof Zt||i instanceof dt||i instanceof Cn)&&r.transform.push(...i.assemble()),i instanceof le){if(r.source&&r.transform.length===0)i.setSource(r.source);else if(i.parent instanceof le)i.setSource(r.name);else if(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}}switch(i.numChildren()){case 0:i instanceof le&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const a of i.children){const c={name:null,source:o,transform:[]};n(a,c)}break}}}return n}function $v(e){const t=[],n=ef(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function Ev(e,t){var n,i;const r=[],s=ef(r);let o=0;for(const c of e.sources){c.hasName()||(c.dataName=`source_${o++}`);const l=c.assemble();s(c,l)}for(const c of r)c.transform.length===0&&delete c.transform;let a=0;for(const[c,l]of r.entries())((n=l.transform)!==null&&n!==void 0?n:[]).length===0&&!l.source&&r.splice(a++,0,r.splice(c,1)[0]);for(const c of r)for(const l of(i=c.transform)!==null&&i!==void 0?i:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const c of r)c.name in t&&(c.values=t[c.name]);return r}function kv(e){return e==="top"||e==="left"||w(e)?"header":"footer"}function Cv(e){for(const t of Oe)Nv(e,t);nf(e,"x"),nf(e,"y")}function Nv(e,t){var n;const{facet:i,config:r,child:s,component:o}=e;if(e.channelHasField(t)){const a=i[t],c=wn("title",null,r,t);let l=gn(a,r,{allowDisabling:!0,includeDefault:c===void 0||!!c});s.component.layoutHeaders[t].title&&(l=S(l)?l.join(", "):l,l+=` / ${s.component.layoutHeaders[t].title}`,s.component.layoutHeaders[t].title=null);const u=wn("labelOrient",a.header,r,t),f=a.header!==null?Y((n=a.header)===null||n===void 0?void 0:n.labels,r.header.labels,!0):!1,d=P(["bottom","right"],u)?"footer":"header";o.layoutHeaders[t]={title:a.header!==null?l:null,facetFieldDef:a,[d]:t==="facet"?[]:[tf(e,t,f)]}}}function tf(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function nf(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:s}=e.component;if(s.axis[t]=ho(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=r[o];for(const c of i.component.axes[t]){const l=kv(c.get("orient"));(n=a[l])!==null&&n!==void 0||(a[l]=[tf(e,o,!1)]);const u=ii(c,"main",e.config,{header:!0});u&&a[l][0].axes.push(u),c.mainExtracted=!0}}}}function Fv(e){Po(e),Sr(e,"width"),Sr(e,"height")}function Pv(e){Po(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";Sr(e,t),Sr(e,n)}function Po(e){for(const t of e.children)t.parseLayoutSize()}function Sr(e,t){var n;const i=mu(t),r=$i(i),s=e.component.resolve,o=e.component.layoutSize;let a;for(const c of e.children){const l=c.component.layoutSize.getWithExplicit(i),u=(n=s.scale[r])!==null&&n!==void 0?n:yu(r,e);if(u==="independent"&&l.value==="step"){a=void 0;break}if(a){if(u==="independent"&&a.value!==l.value){a=void 0;break}a=kt(a,l,i,"")}else a=l}if(a){for(const c of e.children)e.renameSignal(c.getName(i),e.getName(t)),c.component.layoutSize.set(i,"merged",!1);o.setWithExplicit(t,a)}else o.setWithExplicit(t,{explicit:!1,value:void 0})}function Av(e){const{size:t,component:n}=e;for(const i of Ue){const r=xe(i);if(t[r]){const s=t[r];n.layoutSize.set(r,Xe(s)?"step":s,!0)}else{const s=Tv(e,r);n.layoutSize.set(r,s,!1)}}}function Tv(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const s=r.get("type"),o=r.get("range");if(ie(s)){const a=Zn(i.view,t);return jt(o)||Xe(a)?"step":a}else return Bs(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return Bs(i.view,t);{const s=Zn(i.view,t);return Xe(s)?s.step:s}}}function Ao(e,t,n){return _(t,Object.assign({suffix:`by_${_(e)}`},n??{}))}class ui extends Ju{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve);this.child=Lo(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!Xn(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=y(t),i={};for(const r of n){if(![Ze,Je].includes(r)){v(Ni(r,"facet"));break}const s=t[r];if(s.field===void 0){v(Yr(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(t,n){const i=ks(t,n);return i.header?i.header=de(i.header):i.header===null&&(i.header=null),i}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=wr(this),this.child.parseData()}parseLayoutSize(){Po(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),Cv(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,i;const r={};for(const s of Oe)for(const o of fo){const a=this.component.layoutHeaders[s],c=a[o],{facetFieldDef:l}=a;if(l){const u=wn("titleOrient",l.header,this.config,s);if(["right","bottom"].includes(u)){const f=fr(s,u);(t=r.titleAnchor)!==null&&t!==void 0||(r.titleAnchor={}),r.titleAnchor[f]="end"}}if(c==null?void 0:c[0]){const u=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(u)&&((n=r[f])!==null&&n!==void 0||(r[f]={}),r[f][s]=.5),a.title&&((i=r.offset)!==null&&i!==void 0||(r.offset={}),r.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),i?{columns:i}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof ui)return;{const t=this.getName("column_domain");return{signal:`length(data('${t}'))`}}}assembleGroupStyle(){return}assembleGroup(t){return this.parent&&this.parent instanceof ui?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:_(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof ui){if(this.child.channelHasField("column")){const r=_(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of Ue){const s=this.child.component.scales[r];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(ie(o)&&jt(a)){const c=hr(this.child,r),l=Eo(c);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):v(Xr(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),c=[];for(const u of Oe){const f=this.facet[u];if(f){c.push(_(f));const{bin:d,sort:g}=f;if(U(d)&&c.push(_(f,{binSuffix:"end"})),qe(g)){const{field:p,op:m=Di}=g,h=Ao(f,g);i&&r?(s.push(h),o.push("max"),a.push(h)):(s.push(p),o.push(m),a.push(h))}else if(S(g)){const p=Sn(f,u);s.push(p),o.push("max"),a.push(p)}}}const l=!!i&&!!r;return Object.assign({name:t,data:n,groupby:c},l||s.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),s.length?{fields:s,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:n}=this,i=n[t];return i?qe(i.sort)?[Ao(i,i.sort,{expr:"datum"})]:S(i.sort)?[Sn(i,t,{expr:"datum"})]:[_(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i,s=(qe(r)?r.order:!S(r)&&r)||"ascending";return[s]}return[]}assembleLabelTitle(){var t;const{facet:n,config:i}=this;if(n.facet)return go(n.facet,"facet",i);const r={row:["top","bottom"],column:["left","right"]};for(const s of uo)if(n[s]){const o=wn("labelOrient",(t=n[s])===null||t===void 0?void 0:t.header,i,s);if(r[s].includes(o))return go(n[s],s,i)}return}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=$v(n),r=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle(),a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},s?{title:s}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:Oe.map(c=>this.facetSortFields(c)).flat(),order:Oe.map(c=>this.facetSortOrder(c)).flat()}}),i.length>0?{data:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(Lm(this,[])));return[a]}getMapping(){return this.facet}}function Iv(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const s of[n,i])if(qe(s.sort)){const{field:o,op:a=Di}=s.sort;e=r=new Qt(e,{joinaggregate:[{op:a,field:o,as:Ao(s,s.sort,{forAs:!0})}],groupby:[_(s)]})}return r}return null}function rf(e,t){var n,i,r,s;for(const o of t){const a=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const c=(n=e.format)===null||n===void 0?void 0:n.mesh,l=(i=a.format)===null||i===void 0?void 0:i.feature;if(c&&l)continue;const u=(r=e.format)===null||r===void 0?void 0:r.feature;if((u||l)&&u!==l)continue;const f=(s=a.format)===null||s===void 0?void 0:s.mesh;if((c||f)&&c!==f)continue;if(Jn(e)&&Jn(a)){if(Ae(e.values,a.values))return o}else if(bn(e)&&bn(a)){if(e.url===a.url)return o}else if(kl(e)&&e.name===o.dataName)return o}return null}function Rv(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Yt({values:[]});return t.push(i),i}const n=rf(e.data,t);if(n)return Ct(e.data)||(n.data.format=Qo({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Yt(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function zv(e,t,n){var i,r;let s=0;for(const o of t.transforms){let a,c;if(vm(o))c=e=new jn(e,o),a="derived";else if(Vs(o)){const l=jy(o);c=e=(i=se.makeWithAncestors(e,{},l,n))!==null&&i!==void 0?i:e,e=new _n(e,t,o.filter)}else if(vl(o))c=e=Ke.makeFromTransform(e,o,t),a="number";else if(xm(o)){a="date";const l=n.getWithExplicit(o.field);l.value===void 0&&(e=new se(e,{[o.field]:a}),n.set(o.field,a,!1)),c=e=Ye.makeFromTransform(e,o)}else if(_m(o))c=e=Ce.makeFromTransform(e,o),a="number",so(t)&&(e=new At(e));else if(yl(o))c=e=li.make(e,t,o,s++),a="derived";else if(mm(o))c=e=new En(e,o),a="number";else if(bm(o))c=e=new Qt(e,o),a="number";else if(jm(o))c=e=dt.makeFromTransform(e,o),a="derived";else if(Sm(o))c=e=new yr(e,o),a="derived";else if(ym(o))c=e=new br(e,o),a="derived";else if(um(o))c=e=new _r(e,o),a="derived";else if(hm(o))e=new jr(e,o);else if(Om(o))c=e=Zt.makeFromTransform(e,o),a="derived";else if(fm(o))c=e=new mr(e,o),a="derived";else if(dm(o))c=e=new Or(e,o),a="derived";else if(gm(o))c=e=new xr(e,o),a="derived";else if(pm(o))c=e=new vr(e,o),a="derived";else{v(Ud(o));continue}if(c&&a!==void 0)for(const l of(r=c.producedFields())!==null&&r!==void 0?r:[])n.set(l,a,!1)}return e}function wr(e){var t,n,i,r,s,o,a,c,l,u;let f=Rv(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:g}=e.component.data,p=e.data,m=p&&(Ct(p)||bn(p)||Jn(p)),h=!m&&e.parent?e.parent.component.data.ancestorParse.clone():new Im;Ct(p)?(Cl(p)?f=new si(f,p.sequence):Ks(p)&&(f=new ri(f,p.graticule)),h.parseNothing=!0):((t=p==null?void 0:p.format)===null||t===void 0?void 0:t.parse)===null&&(h.parseNothing=!0),f=(n=se.makeExplicit(f,e,h))!==null&&n!==void 0?n:f,f=new At(f);const x=e.parent&&kn(e.parent);(K(e)||Fe(e))&&(x&&(f=(i=Ke.makeFromEncoding(f,e))!==null&&i!==void 0?i:f)),e.transforms.length>0&&(f=zv(f,e,h));const b=wy(e),O=Sy(e);f=(r=se.makeWithAncestors(f,{},Object.assign(Object.assign({},b),O),h))!==null&&r!==void 0?r:f,K(e)&&(f=Cn.parseAll(f,e),f=ci.parseAll(f,e)),(K(e)||Fe(e))&&(x||(f=(s=Ke.makeFromEncoding(f,e))!==null&&s!==void 0?s:f),f=(o=Ye.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=jn.parseAllForSortIndex(f,e));const $=e.getDataName(B.Raw),N=new le(f,$,B.Raw,g);if(d[$]=N,f=N,K(e)){const ee=Ce.makeFromEncoding(f,e);ee&&(f=ee,so(e)&&(f=new At(f))),f=(a=Zt.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=(c=dt.makeFromEncoding(f,e))!==null&&c!==void 0?c:f}K(e)&&(f=(l=ai.make(f,e))!==null&&l!==void 0?l:f);const A=e.getDataName(B.Main),k=new le(f,A,B.Main,g);d[A]=k,f=k,K(e)&&vb(e,k);let T=null;if(Fe(e)){const ee=e.getName("facet");f=(u=Iv(f,e.facet))!==null&&u!==void 0?u:f,T=new $n(f,e,ee,k.getSource()),d[ee]=T}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:g,raw:N,main:k,facetRoot:T,ancestorParse:h})}class Lv extends Fo{constructor(t,n,i,r){var s,o,a,c;super(t,"concat",n,i,r,t.resolve);(((o=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||o===void 0?void 0:o.x)==="shared"||((c=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||c===void 0?void 0:c.y)==="shared")&&v(Ld),this.children=this.getChildren(t).map((l,u)=>Lo(l,this,this.getName(`concat_${u}`),void 0,r))}parseData(){this.component.data=wr(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of y(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return er(t)?t.vconcat:Us(t)?t.hconcat:t.concat}parseLayoutSize(){Pv(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=po(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),i?{style:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup())})}assembleGroupStyle(){return}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function Dv(e){return e===!1||e===null}const Mv=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},Pc),{labelExpr:1,encode:1}),sf=y(Mv);class To extends ut{constructor(t={},n={},i=!1){super();this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new To(C(this.explicit),C(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!Dv(this.get(t))}hasOrientSignalRef(){return w(this.explicit.orient)}}function Uv(e,t,n){var i;const{encoding:r,config:s}=e,o=(i=J(r[t]))!==null&&i!==void 0?i:J(r[rt(t)]),a=e.axis(t)||{},{format:c,formatType:l}=a;return qt(l)?Object.assign({text:vs({fieldOrDatumDef:o,field:"datum.value",format:c,formatType:l,config:s})},n):n}function Bv(e){return Ue.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[Yv(n,e)]),t),{})}const Wv={bottom:"top",top:"bottom",left:"right",right:"left"};function Hv(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of y(s.component.axes))i.axis[o]=ho(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=qv(n[o],s.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const s of Ue){for(const o of e.children){if(!o.component.axes[s])continue;if(i.axis[s]==="independent"){n[s]=((t=n[s])!==null&&t!==void 0?t:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:c,explicit:l}=a.getWithExplicit("orient");if(w(c))continue;if(r[c]>0&&!l){const u=Wv[c];r[c]>r[u]&&a.set("orient",u,!1)}r[c]++}}delete o.component.axes[s]}if(i.axis[s]==="independent"&&n[s]&&n[s].length>1)for(const o of n[s])!!o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function qv(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t[i];if(!!r!==!!s)return;if(r&&s){const o=r.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[i]=Gv(r,s)}}}else return t.map(n=>n.clone());return e}function Gv(e,t){for(const n of sf){const i=kt(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return wa(r,s);case"gridScale":return{explicit:r.explicit,value:Y(r.value,s.value)}}return ir(r,s,n,"axis")});e.setWithExplicit(n,i)}return e}function Vv(e,t,n,i,r){if(t==="disable")return n!==void 0;n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(w(n.labelAngle)?n.labelAngle:Ln(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===uu(i,r))return!0}return e===n[t]}const Xv=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Yv(e,t){var n,i,r;let s=t.axis(e);const o=new To,a=J(t.encoding[e]),{mark:c,config:l}=t,u=(s==null?void 0:s.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=l.axis)===null||i===void 0?void 0:i.orient)||Cb(e),f=t.getScaleComponent(e).get("type"),d=_b(e,f,u,t.config),g=s!==void 0?!s:co("disable",l.style,s==null?void 0:s.style,d).configValue;if(o.set("disable",g,s!==void 0),g)return o;s=s||{};const p=$b(a,s,e,l.style,d),m={fieldOrDatumDef:a,axis:s,channel:e,model:t,scaleType:f,orient:u,labelAngle:p,mark:c,config:l};for(const b of sf){const O=b in au?au[b](m):Ac(b)?s[b]:void 0,$=O!==void 0,N=Vv(O,b,s,t,e);if($&&N)o.set(b,O,N);else{const{configValue:A=void 0,configFrom:k=void 0}=Ac(b)&&b!=="values"?co(b,l.style,s.style,d):{},T=A!==void 0;$&&!T?o.set(b,O,N):(!(k==="vgAxisConfig")||Xv.has(b)&&T||Kn(A)||w(A))&&o.set(b,A,!1)}}const h=(r=s.encoding)!==null&&r!==void 0?r:{},x=Fc.reduce((b,O)=>{var $;if(!o.hasAxisPart(O))return b;const N=bu(($=h[O])!==null&&$!==void 0?$:{},t),A=O==="labels"?Uv(t,e,N):N;return A!==void 0&&!L(A)&&(b[O]={update:A}),b},{});return L(x)||o.set("encode",x,!!s.encoding||s.labelAngle!==void 0),o}function Kv({encoding:e,size:t}){for(const n of Ue){const i=xe(n);Xe(t[i])&&(Ge(e[n])&&(delete t[i],v(za(i))))}return t}function Qv(e,t,n){const i=de(e),r=z("orient",i,n);if(i.orient=tO(i.type,t,r),r!==void 0&&r!==i.orient&&v(ng(i.orient,r)),i.type==="bar"&&i.orient){const a=z("cornerRadiusEnd",i,n);if(a!==void 0){const c=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:Ep[i.orient];for(const l of c)i[l]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}const s=z("opacity",i,n);s===void 0&&(i.opacity=Jv(i.type,t));const o=z("cursor",i,n);return o===void 0&&(i.cursor=Zv(i,t,n)),i}function Zv(e,t,n){return t.href||e.href||z("href",e,n)?"pointer":e.cursor}function Jv(e,t){return P([Ii,gs,ps,hs],e)&&!Cs(t)?.7:void 0}function eO(e,t,{graticule:n}){if(n)return!1;const i=Ut("filled",e,t),r=e.type;return Y(i,r!==Ii&&r!==Ti&&r!==Ri)}function tO(e,t,n){switch(e){case Ii:case ps:case hs:case ec:case yp:case bp:return}const{x:i,y:r,x2:s,y2:o}=t;switch(e){case Ai:if(j(i)&&(oe(i.bin)||j(r)&&r.aggregate&&!i.aggregate))return"vertical";if(j(r)&&(oe(r.bin)||j(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(j(i)&&i.type===Wt&&!U(i.bin)||Ss(i)))return"horizontal";if(!o&&(j(r)&&r.type===Wt&&!U(r.bin)||Ss(r)))return"vertical"}case Ri:if(s&&!(j(i)&&oe(i.bin))&&o&&!(j(r)&&oe(r.bin)))return;case Pi:if(o)return j(r)&&oe(r.bin)?"horizontal":"vertical";if(s)return j(i)&&oe(i.bin)?"vertical":"horizontal";if(e===Ri){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case Ti:case gs:{const a=Ge(i),c=Ge(r);if(n)return n;if(a&&!c)return e!=="tick"?"horizontal":"vertical";if(!a&&c)return e!=="tick"?"vertical":"horizontal";if(a&&c){const l=i,u=r,f=l.type===un,d=u.type===un;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!l.aggregate&&u.aggregate?e!=="tick"?"vertical":"horizontal":l.aggregate&&!u.aggregate&&e!=="tick"?"horizontal":"vertical"}else return}}return"vertical"}const nO={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),re("x",e,{defaultPos:"mid"})),re("y",e,{defaultPos:"mid"})),Ft(e,"radius","arc")),Ft(e,"theta","arc"))},iO={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),sr("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),sr("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),io(e))},rO={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ft(e,"x","bar")),Ft(e,"y","bar"))},sO={vgMark:"shape",encodeEntry:e=>Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape,i=Object.assign({type:"geoshape",projection:e.projectionName()},n&&j(n)&&n.type===fn?{field:_(n,{expr:"datum"})}:{});return[i]}},oO={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),Ft(e,"x","image")),Ft(e,"y","image")),to(e,"url"))},aO={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),re("x",e,{defaultPos:"mid"})),re("y",e,{defaultPos:"mid"})),te("size",e,{vgChannel:"strokeWidth"})),io(e))},cO={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),re("x",e,{defaultPos:"mid"})),re("y",e,{defaultPos:"mid"})),te("size",e)),io(e))};function Io(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),re("x",e,{defaultPos:"mid"})),re("y",e,{defaultPos:"mid"})),te("size",e)),te("angle",e)),lO(e,n,t))}function lO(e,t,n){return n?{shape:{value:n}}:te("shape",e)}const uO={vgMark:"symbol",encodeEntry:e=>Io(e)},fO={vgMark:"symbol",encodeEntry:e=>Io(e,"circle")},dO={vgMark:"symbol",encodeEntry:e=>Io(e,"square")},gO={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ft(e,"x","rect")),Ft(e,"y","rect"))},pO={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),sr("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),sr("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),te("size",e,{vgChannel:"strokeWidth"}))}},hO={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),re("x",e,{defaultPos:"mid"})),re("y",e,{defaultPos:"mid"})),to(e)),te("size",e,{vgChannel:"fontSize"})),te("angle",e)),Bl("align",mO(e.markDef,n,t))),Bl("baseline",bO(e.markDef,n,t))),re("radius",e,{defaultPos:null})),re("theta",e,{defaultPos:null}))}};function mO(e,t,n){const i=z("align",e,n);return i===void 0?"center":void 0}function bO(e,t,n){const i=z("baseline",e,n);return i===void 0?"middle":void 0}const yO={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",s=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),re("x",e,{defaultPos:"mid",vgChannel:"xc"})),re("y",e,{defaultPos:"mid",vgChannel:"yc"})),te("size",e,{defaultValue:vO(e),vgChannel:r})),{[s]:q(z("thickness",n,t))})}};function vO(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,s=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),a=(t=z("size",i,n,{vgChannel:s}))!==null&&t!==void 0?t:n.tick.bandSize;if(a!==void 0)return a;{const c=o?o.get("range"):void 0;if(c&&jt(c)&&X(c.step))return c.step*3/4;const l=tr(n.view,s);return l*3/4}}const $r={arc:nO,area:iO,bar:rO,circle:fO,geoshape:sO,image:oO,line:aO,point:uO,rect:gO,rule:pO,square:dO,text:hO,tick:yO,trail:cO};function OO(e){if(P([Ti,Pi,vp],e.mark)){const t=Rc(e.mark,e.encoding);if(t.length>0)return xO(e,t)}else if(e.mark===Ai){const t=qr.some(n=>z(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return _O(e)}return Ro(e)}const of="faceted_path_";function xO(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:of+e.requestDataName(B.Main),data:e.requestDataName(B.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:Ro(e,{fromPrefix:of})}]}const af="stack_group_";function _O(e){const[t]=Ro(e,{fromPrefix:af}),n=e.scaleName(e.stack.fieldChannel),i=(l={})=>e.vgField(e.stack.fieldChannel,l),r=(l,u)=>{const f=[i({prefix:"min",suffix:"start",expr:u}),i({prefix:"max",suffix:"start",expr:u}),i({prefix:"min",suffix:"end",expr:u}),i({prefix:"max",suffix:"end",expr:u})];return`${l}(${f.map(d=>`scale('${n}',${d})`).join(",")})`};let s,o;e.stack.fieldChannel==="x"?(s=Object.assign(Object.assign({},sn(t.encode.update,["y","yc","y2","height",...qr])),{x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},pe(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(s=Object.assign(Object.assign({},sn(t.encode.update,["x","xc","x2","width"])),{y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},pe(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const l of qr){const u=Ut(l,e.markDef,e.config);t.encode.update[l]?(s[l]=t.encode.update[l],delete t.encode.update[l]):u&&(s[l]=q(u)),u&&(t.encode.update[l]={value:0})}const a=[];if(e.stack.groupbyChannel){const l=e.fieldDef(e.stack.groupbyChannel),u=_(l);u&&a.push(u),((l==null?void 0:l.bin)||(l==null?void 0:l.timeUnit))&&a.push(_(l,{binSuffix:"end"}))}const c=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return s=c.reduce((l,u)=>{if(t.encode.update[u])return Object.assign(Object.assign({},l),{[u]:t.encode.update[u]});{const f=Ut(u,e.markDef,e.config);return f!==void 0?Object.assign(Object.assign({},l),{[u]:q(f)}):l}},s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(B.Main),name:af+e.requestDataName(B.Main),groupby:a,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}function jO(e){var t;const{encoding:n,stack:i,mark:r,markDef:s,config:o}=e,a=n.order;if(!S(a)&&ke(a)&&Pr(a.value)||!a&&Pr(z("order",s,o)))return;if((S(a)||j(a))&&!i)return _a(a,{expr:"datum"});if(St(r)){const c=s.orient==="horizontal"?"y":"x",l=n[c];if(j(l)){const u=l.sort;if(S(u))return{field:_(l,{prefix:c,suffix:"sort_index",expr:"datum"})};if(qe(u))return{field:_({aggregate:Cs(e.encoding)?u.op:void 0,field:u.field},{expr:"datum"})};if(bc(u)){const f=e.fieldDef(u.encoding);return{field:_(f,{expr:"datum"}),order:u.order}}else return u===null?void 0:{field:_(l,{binSuffix:((t=e.stack)===null||t===void 0?void 0:t.impute)?"mid":void 0,expr:"datum"})}}return}return}function Ro(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=e,o=Y(i.clip,SO(e),wO(e)),a=Oa(i),c=r.key,l=jO(e),u=$O(e),f=z("aria",i,s),d=$r[n].postEncodingTransform?$r[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:$r[n].vgMark},o?{clip:!0}:{}),a?{style:a}:{}),c?{key:c.field}:{}),l?{sort:l}:{}),u||{}),f===!1?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(B.Main)},encode:{update:$r[n].encodeEntry(e)}}),d?{transform:d}:{})]}function SO(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function wO(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function $O(e){if(!e.component.selection)return null;const t=y(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=y(i.component.selection).length,i=i.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}class cf extends Ju{constructor(t,n,i,r={},s){var o;super(t,"unit",n,i,s,void 0,tl(t)?t.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const a=He(t.mark)?Object.assign({},t.mark):{type:t.mark},c=a.type;a.filled===void 0&&(a.filled=eO(a,s,{graticule:t.data&&Ks(t.data)}));const l=this.encoding=ih(t.encoding||{},c,a.filled,s);this.markDef=Qv(a,l,s),this.size=Kv({encoding:l,size:tl(t)?Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):r}),this.stack=ll(c,l),this.specifiedScales=this.initScales(c,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegends(l),this.specifiedProjection=t.projection,this.selection=((o=t.params)!==null&&o!==void 0?o:[]).filter(u=>Ds(u))}get hasProjection(){const{encoding:t}=this,n=this.mark===tc,i=t&&Zf.some(r=>E(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return Ei.reduce((i,r)=>{var s;const o=J(n[r]);return o&&(i[r]=this.initScale((s=o.scale)!==null&&s!==void 0?s:{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=de(t);return S(n)&&(r.domain=n.map(he)),S(i)&&(r.range=i.map(he)),r}initAxes(t){return Ue.reduce((n,i)=>{const r=t[i];if(E(r)||i===G&&E(t.x2)||i===Q&&E(t.y2)){const s=E(r)?r.axis:void 0;n[i]=s&&this.initAxis(Object.assign({},s))}return n},{})}initAxis(t){const n=y(t),i={};for(const r of n){const s=t[r];i[r]=Kn(s)?ba(s):he(s)}return i}initLegends(t){return ad.reduce((n,i)=>{const r=J(t[i]);if(r&&ld(i)){const s=r.legend;n[i]=s&&de(s)}return n},{})}parseData(){this.component.data=wr(this)}parseLayoutSize(){Av(this)}parseSelections(){this.component.selection=yb(this,this.selection)}parseMarkGroup(){this.component.mark=OO(this)}parseAxesAndHeaders(){this.component.axes=Bv(this)}assembleSelectionTopLevelSignals(t){return Dm(this,t)}assembleSignals(){return[...su(this),...zm(this,[])]}assembleSelectionData(t){return Mm(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return po(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!kn(this.parent))&&(n=Fl(this,n)),n.map(this.correctDataNames)}assembleGroupStyle(){const{style:t}=this.view||{};return t!==void 0?t:this.encoding.x||this.encoding.y?"cell":void 0}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Vt(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return Ve(n)}typedFieldDef(t){const n=this.fieldDef(t);return _e(n)?n:null}}class zo extends Fo{constructor(t,n,i,r,s){super(t,"layer",n,i,s,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((a,c)=>{if(nr(a))return new zo(a,this,this.getName(`layer_${c}`),o,s);if(ct(a))return new cf(a,this,this.getName(`layer_${c}`),o,s);throw new Error(Vr(a))})}parseData(){this.component.data=wr(this);for(const t of this.children)t.parseData()}parseLayoutSize(){Fv(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of y(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){Hv(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),su(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),po(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleGroupStyle(){const t=new Set;for(const i of this.children)for(const r of V(i.assembleGroupStyle()))t.add(r);const n=Array.from(t);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t;return}assembleLayout(){return null}assembleMarks(){return Um(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),ku(this))}}function Lo(e,t,n,i,r){if(Mi(e))return new ui(e,t,n,r);if(nr(e))return new zo(e,t,n,i,r);if(ct(e))return new cf(e,t,n,i,r);if(kh(e))return new Lv(e,t,n,r);throw new Error(Vr(e))}var EO=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function kO(e,t={}){t.logger&&Eg(t.logger),t.fieldTitle&&Ec(t.fieldTitle);try{const n=al(Xo(t.config,e.config)),i=Sl(e,n),r=Lo(i,null,"",void 0,n);r.parse(),Uy(r.component.data,r);const s=NO(r,CO(e,i.autosize,n,r),e.datasets,e.usermeta);return{spec:s,normalized:i}}finally{t.logger&&kg(),t.fieldTitle&&Vp()}}function CO(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):F(t)&&(t={type:t}),r&&s&&Pm(t.type)){if(r==="step"&&s==="step")v(ka()),t.type="pad";else if(r==="step"||s==="step"){const o=r==="step"?"width":"height";v(ka($i(o)));const a=o==="width"?"height":"width";t.type=Am(a)}}return Object.assign(Object.assign(Object.assign({},y(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),$l(n,!1)),$l(e,!0))}function NO(e,t,n={},i){const r=e.config?Wh(e.config):void 0,s=[].concat(e.assembleSelectionData([]),Ev(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),c=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let u=e.assembleLayoutSignals();u=u.filter(g=>(g.name==="width"||g.name==="height")&&g.value!==void 0?(t[g.name]=+g.value,!1):!0);const{params:f}=t,d=EO(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),a?{title:a}:{}),c?{style:c}:{}),l?{encode:{update:l}}:{}),{data:s}),o.length>0?{projections:o}:{}),e.assembleGroup([...u,...e.assembleSelectionTopLevelSignals([]),...el(f)])),r?{config:r}:{}),i?{usermeta:i}:{})}const FO=Hf.version;export{an as accessPathDepth,zr as accessPathWithDatum,kO as compile,P as contains,Ae as deepEqual,vi as deleteNestedProperty,C as duplicate,gt as entries,Ar as every,Rr as fieldIntersection,Jo as flatAccessWithDatum,Y as getFirstDefined,Tr as hasIntersection,I as hash,na as internalField,In as isBoolean,L as isEmpty,Gf as isEqual,ia as isInternalField,Pr as isNullOrFalse,Oi as isNumeric,y as keys,Rn as logicalExpr,Qo as mergeDeep,Sl as normalize,Ln as normalizeAngle,pe as omit,sn as pick,Ir as prefixGenerator,Lr as removePathFromField,Rt as replaceAll,ye as replacePathInField,Xf as resetIdCounter,Zo as setEqual,on as some,M as stringify,zn as titleCase,Te as unique,ta as uniqueId,ne as vals,H as varName,FO as version};export default null;
