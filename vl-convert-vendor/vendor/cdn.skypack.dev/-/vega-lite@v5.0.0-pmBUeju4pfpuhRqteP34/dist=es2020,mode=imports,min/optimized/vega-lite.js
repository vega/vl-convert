import{hasOwnProperty as en,isNumber as X,isString as C,writeConfig as ff,splitAccessPath as tn,stringValue as R,toSet as It,isObject as W,isBoolean as Pn,isArray as S,array as V,logger as df,Warn as gf,isFunction as pf,mergeConfig as Vo,identity as hf}from"/-/vega-util@v1.16.1-QtdV0YLGVmjtkzFiPbzm/dist=es2020,mode=imports,min/optimized/vega-util.js";import mf from"/-/clone@v2.1.2-inH2VLNzDGiYU9HUWyZM/dist=es2020,mode=imports,min/optimized/clone.js";import bf from"/-/fast-deep-equal@v3.1.3-ysejKs1WDEDPxUJhgGoP/dist=es2020,mode=imports,min/optimized/fast-deep-equal.js";import kr from"/-/fast-json-stable-stringify@v2.1.0-HLgsuOtxPikt0pw16nth/dist=es2020,mode=imports,min/optimized/fast-json-stable-stringify.js";import{isArray as Xo,isString as mi,isObject as yf}from"/-/vega@v5.21.0-p1iA2nFhhypDthI1mAci/dist=es2020,mode=imports,min/optimized/vega.js";import{selector as nn}from"/-/vega-event-selector@v2.0.6-fTsDie9ajW0bqk8q646l/dist=es2020,mode=imports,min/optimized/vega-event-selector.js";import{parse as vf}from"/-/vega-expression@v4.0.1-L6nuo9Nkz3BnDTZBigv3/dist=es2020,mode=imports,min/optimized/vega-expression.js";const Of="vega-lite",xf='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',_f="5.0.0",jf=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],Sf="https://vega.github.io/vega-lite/",wf="Vega-Lite is a concise high-level language for interactive visualization.",$f="build/vega-lite.js",Ef="build/vega-lite.min.js",kf="build/vega-lite.min.js",Cf="build/src/index",Nf="build/src/index.d.ts",Ff={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},Pf={test:"test"},Af=["bin","build","src","vega-lite*","tsconfig.json"],Tf={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && rimraf site/data/* && rimraf examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"find build ! -name 'vega-lite-schema.json' -type f -delete && rimraf build/src","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:cover":"jest --collectCoverage test/","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && rimraf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"jest --watch test/"},If={type:"git",url:"https://github.com/vega/vega-lite.git"},Rf="BSD-3-Clause",zf={url:"https://github.com/vega/vega-lite/issues"},Lf={"@babel/core":"^7.13.1","@babel/preset-env":"^7.13.5","@babel/preset-typescript":"^7.13.0","@rollup/plugin-babel":"^5.3.0","@rollup/plugin-commonjs":"^17.1.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.0","@types/chai":"^4.2.15","@types/d3":"^6.3.0","@types/jest":"^26.0.20","@types/mkdirp":"^1.0.1","@types/pako":"^1.0.1","@typescript-eslint/eslint-plugin":"^4.15.2","@typescript-eslint/parser":"^4.15.2",ajv:"^7.1.1","ajv-formats":"^1.5.1",chai:"^4.3.0",cheerio:"^1.0.0-rc.5","conventional-changelog-cli":"^2.1.1",d3:"^6.5.0",eslint:"^7.20.0","eslint-config-prettier":"^8.0.0","eslint-plugin-jest":"^24.1.5","eslint-plugin-prettier":"^3.3.1","gh-pages":"^3.1.0","highlight.js":"^10.6.0",jest:"^26.6.3","jest-dev-server":"^4.4.0",mkdirp:"^1.0.4",pako:"^2.0.3",prettier:"^2.2.1",puppeteer:"^7.1.0",rollup:"^2.39.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3","rollup-plugin-terser":"^7.0.2",serve:"^11.3.2",terser:"^5.6.0","ts-json-schema-generator":"^0.86.1",typescript:"~4.2.2","vega-cli":"^5.19.1","vega-datasets":"~2.2.0","vega-embed":"^6.15.1","vega-tooltip":"^0.25.0","yaml-front-matter":"^4.1.1"},Df={"@types/clone":"~2.1.0","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.1.0","vega-event-selector":"~2.0.6","vega-expression":"~4.0.1","vega-util":"~1.16.0",yargs:"~16.2.0"},Mf={vega:"^5.19.1"},Uf={testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1,setupFiles:["./test/jest.overrides.ts"]};var Bf={name:Of,author:xf,version:_f,collaborators:jf,homepage:Sf,description:wf,main:$f,unpkg:Ef,jsdelivr:kf,module:Cf,types:Nf,bin:Ff,directories:Pf,files:Af,scripts:Tf,repository:If,license:Rf,bugs:zf,devDependencies:Lf,dependencies:Df,peerDependencies:Mf,jest:Uf};function Cr(e){return!!e.or}function Nr(e){return!!e.and}function Fr(e){return!!e.not}function bi(e,t){if(Fr(e))bi(e.not,t);else if(Nr(e))for(const n of e.and)bi(n,t);else if(Cr(e))for(const n of e.or)bi(n,t);else t(e)}function rn(e,t){return Fr(e)?{not:rn(e.not,t)}:Nr(e)?{and:e.and.map(n=>rn(n,t))}:Cr(e)?{or:e.or.map(n=>rn(n,t))}:t(e)}const Ae=bf,N=mf;function sn(e,t){const n={};for(const i of t)en(e,i)&&(n[i]=e[i]);return n}function ge(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>kr(e)).join(",")})`};const M=kr;function I(e){if(X(e))return e;const t=C(e)?e:kr(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function Pr(e){return e===!1||e===null}function F(e,t){return e.includes(t)}function on(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function Ar(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function Yo(e,...t){for(const n of t)Wf(e,n??{});return e}function Wf(e,t){for(const n of y(t))ff(e,n,t[n],!0)}function Te(e,t){const n=[],i={};let r;for(const s of e){if(r=t(s),r in i)continue;i[r]=1,n.push(s)}return n}function Hf(e,t){const n=y(e),i=y(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function Ko(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Tr(e,t){for(const n of e)if(t.has(n))return!0;return!1}function Ir(e){const t=new Set;for(const n of e){const i=tn(n),r=i.map((o,a)=>a===0?o:`[${o}]`),s=r.map((o,a)=>r.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function Rr(e,t){return e===void 0||t===void 0?!0:Tr(Ir(e),Ir(t))}function L(e){return y(e).length===0}const y=Object.keys,re=Object.values,gt=Object.entries;function An(e){return e===!0||e===!1}function H(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Tn(e,t){return Fr(e)?`!(${Tn(e.not,t)})`:Nr(e)?`(${e.and.map(n=>Tn(n,t)).join(") && (")})`:Cr(e)?`(${e.or.map(n=>Tn(n,t)).join(") || (")})`:t(e)}function yi(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&yi(e[n],t)&&delete e[n],L(e)}function In(e){return e.charAt(0).toUpperCase()+e.substr(1)}function zr(e,t="datum"){const n=tn(e),i=[];for(let r=1;r<=n.length;r++){const s=`[${n.slice(0,r).map(R).join("][")}]`;i.push(`${t}${s}`)}return i.join(" && ")}function Qo(e,t="datum"){return`${t}[${R(tn(e).join("."))}]`}function qf(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function ye(e){return`${tn(e).map(qf).join("\\.")}`}function Rt(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Lr(e){return`${tn(e).join(".")}`}function an(e){return e?tn(e).length:0}function Y(...e){for(const t of e)if(t!==void 0)return t;return}let Zo=42;function Jo(e){const t=++Zo;return e?String(e)+t:t}function Gf(){Zo=42}function ea(e){return ta(e)?e:`__${e}`}function ta(e){return e.startsWith("__")}function Rn(e){return e===void 0?void 0:(e%360+360)%360}function vi(e){return X(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}var zn=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ze="row",Je="column",Oi="facet",G="x",Q="y",je="x2",Ie="y2",Re="radius",et="radius2",Se="theta",tt="theta2",ze="latitude",Le="longitude",we="latitude2",ve="longitude2",le="color",De="fill",Me="stroke",ue="shape",nt="size",zt="angle",it="opacity",pt="fillOpacity",ht="strokeOpacity",mt="strokeWidth",bt="strokeDash",Ln="text",Dn="order",Mn="detail",xi="key",Lt="tooltip",_i="href",ji="url",Si="description",Vf={x:1,y:1,x2:1,y2:1},na={theta:1,theta2:1,radius:1,radius2:1};function ia(e){return e in na}const Dr={longitude:1,longitude2:1,latitude:1,latitude2:1};function Xf(e){switch(e){case ze:return"y";case we:return"y2";case Le:return"x";case ve:return"x2"}}function Yf(e){return e in Dr}const Kf=y(Dr),ra=Object.assign(Object.assign(Object.assign(Object.assign({},Vf),na),Dr),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function cn(e){return e===le||e===De||e===Me}const sa={row:1,column:1,facet:1},Oe=y(sa),Mr=Object.assign(Object.assign({},ra),sa),Qf=y(Mr),Zf=zn(Mr,["order","detail","tooltip"]),Jf=zn(Zf,["row","column","facet"]);function ed(e){return!!Jf[e]}function oa(e){return!!Mr[e]}const td=[je,Ie,we,ve,tt,et];function aa(e){const t=Dt(e);return t!==e}function Dt(e){switch(e){case je:return G;case Ie:return Q;case we:return ze;case ve:return Le;case tt:return Se;case et:return Re}return e}function yt(e){if(ia(e))switch(e){case Se:return"startAngle";case tt:return"endAngle";case Re:return"outerRadius";case et:return"innerRadius"}return e}function rt(e){switch(e){case G:return je;case Q:return Ie;case ze:return we;case Le:return ve;case Se:return tt;case Re:return et}return}function $e(e){switch(e){case G:case je:return"width";case Q:case Ie:return"height"}return}function nd(e){switch(e){case G:return"xOffset";case Q:return"yOffset";case je:return"x2Offset";case Ie:return"y2Offset";case Se:return"thetaOffset";case Re:return"radiusOffset";case tt:return"theta2Offset";case et:return"radius2Offset"}return}const Ur=zn(ra,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),id=y(Ur),vt={x:1,y:1},Ue=y(vt);function Be(e){return e in vt}const Br={theta:1,radius:1},rd=y(Br);function wi(e){return e==="width"?G:Q}const ca=zn(Ur,["text","tooltip","href","url","description","detail","key","order"]),sd=y(ca);function od(e){return!!Ur[e]}function ad(e){switch(e){case le:case De:case Me:case nt:case ue:case it:case mt:case bt:return!0;case pt:case ht:case zt:return!1}}const la=Object.assign(Object.assign(Object.assign({},vt),Br),ca),$i=y(la);function Ot(e){return!!la[e]}function cd(e,t){return ud(e)[t]}const ua={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},ld=zn(ua,["geoshape"]);function ud(e){switch(e){case le:case De:case Me:case Si:case Mn:case xi:case Lt:case _i:case Dn:case it:case pt:case ht:case mt:case Oi:case Ze:case Je:return ua;case G:case Q:case ze:case Le:return ld;case je:case Ie:case we:case ve:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case nt:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case bt:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case ue:return{point:"always",geoshape:"always"};case Ln:return{text:"always"};case zt:return{point:"always",square:"always",text:"always"};case ji:return{image:"always"};case Se:return{text:"always",arc:"always"};case Re:return{text:"always",arc:"always"};case tt:case et:return{arc:"always"}}}function Wr(e){switch(e){case G:case Q:case Se:case Re:case nt:case zt:case mt:case it:case pt:case ht:case je:case Ie:case tt:case et:return;case Oi:case Ze:case Je:case ue:case bt:case Ln:case Lt:case _i:case ji:case Si:return"discrete";case le:case De:case Me:return"flexible";case ze:case Le:case we:case ve:case Mn:case xi:case Dn:return}}const fd={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},dd={count:1,min:1,max:1};function st(e){return!!e&&!!e.argmin}function xt(e){return!!e&&!!e.argmax}function Hr(e){return C(e)&&!!fd[e]}const gd=["count","valid","missing","distinct"];function fa(e){return C(e)&&F(gd,e)}function pd(e){return C(e)&&F(["min","max"],e)}const hd=["count","sum","distinct","valid","missing"],md=["mean","average","median","q1","q3","min","max"],bd=It(md);function da(e){return Pn(e)&&(e=Gi(e,void 0)),"bin"+y(e).map(t=>Ei(e[t])?H(`_${t}_${gt(e[t])}`):H(`_${t}_${e[t]}`)).join("")}function U(e){return e===!0||Mt(e)&&!e.binned}function se(e){return e==="binned"||Mt(e)&&e.binned===!0}function Mt(e){return W(e)}function Ei(e){return e==null?void 0:e.param}function ga(e){switch(e){case Ze:case Je:case nt:case le:case De:case Me:case mt:case it:case pt:case ht:case ue:return 6;case bt:return 4;default:return 10}}function Un(e){return e&&!!e.expr}function fe(e){const t=y(e||{}),n={};for(const i of t)n[i]=pe(e[i]);return n}var yd=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function pa(e){const{anchor:t,frame:n,offset:i,orient:r,color:s,subtitleColor:o,subtitleFont:a,subtitleFontSize:c,subtitleFontStyle:l,subtitleFontWeight:u,subtitleLineHeight:f,subtitlePadding:d}=e,g=yd(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},g),s?{fill:s}:{}),h=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),a?{subtitleFont:a}:{}),c?{subtitleFontSize:c}:{}),l?{subtitleFontStyle:l}:{}),u?{subtitleFontWeight:u}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{}),x=sn(p,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:p,subtitleMarkConfig:x,nonMark:h,subtitle:m}}function _t(e){return C(e)||S(e)&&C(e[0])}function w(e){return e&&!!e.signal}function jt(e){return!!e.step}function vd(e){return S(e)?!1:"fields"in e&&!("data"in e)}function Od(e){return S(e)?!1:"fields"in e&&"data"in e}function ot(e){return S(e)?!1:"field"in e&&"data"in e}const xd={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},_d=y(xd),jd={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},qr=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];var Gr=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ha(e){const t=S(e.condition)?e.condition.map(ma):ma(e.condition);return Object.assign(Object.assign({},pe(e)),{condition:t})}function pe(e){if(Un(e)){const{expr:t}=e,n=Gr(e,["expr"]);return Object.assign({signal:t},n)}return e}function ma(e){if(Un(e)){const{expr:t}=e,n=Gr(e,["expr"]);return Object.assign({signal:t},n)}return e}function q(e){if(Un(e)){const{expr:t}=e,n=Gr(e,["expr"]);return Object.assign({signal:t},n)}return w(e)?e:e!==void 0?{value:e}:void 0}function ba(e){return w(e)?e.signal:R(e.value)}function at(e){return w(e)?e.signal:e==null?null:R(e)}function Sd(e,t,n){for(const i of n){const r=Ut(i,t.markDef,t.config);r!==void 0&&(e[i]=q(r))}return e}function ya(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function z(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:s&&(!r||r===e)?void 0:Ut(e,t,n,i)}function Ut(e,t,n,{vgChannel:i}={}){return Y(i?ki(e,t,n.style):void 0,ki(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function ki(e,t,n){return va(e,ya(t),n)}function va(e,t,n){t=V(t);let i;for(const r of t){const s=n[r];s&&s[e]!==void 0&&(i=s[e])}return i}function Oa(e,t){return V(e).reduce((n,i)=>{var r;return n.field.push(_(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function xa(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Ae(r,i))return;n.push(i)}),n}function _a(e,t){return Ae(e,t)||!t?e:e?[...V(e),...V(t)].join(", "):t}function ja(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((_t(n)||w(n))&&(_t(i)||w(i)))return{explicit:e.explicit,value:_a(n,i)};if(_t(n)||w(n))return{explicit:e.explicit,value:n};if(_t(i)||w(i))return{explicit:e.explicit,value:i};if(!_t(n)&&!w(n)&&!_t(i)&&!w(i))return{explicit:e.explicit,value:xa(n,i)};throw new Error("It should never reach here")}function Vr(e){return`Invalid specification ${M(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const wd='Autosize "fit" only works for single views and layered views.';function Sa(e){const t=e=="width"?"Width":"Height";return`${t} "container" only works for single views and layered views.`}function wa(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function $a(e){return e?`Dropping "fit-${e}" because spec has discrete ${$e(e)}.`:'Dropping "fit" because spec has discrete size.'}function Xr(e){return`Unknown field for ${e}. Cannot calculate view size.`}function Ea(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function $d(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Ed(e){return`The "nearest" transform is not supported for ${e} marks.`}function ka(e){return`Selection not supported for ${e} yet.`}function kd(e){return`Cannot find a selection named "${e}".`}const Cd="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Nd="Legend bindings are only supported for selections over an individual field or encoding channel.";function Fd(e){return`Lookups can only be performed on selection parameters. "${e}" is a variable parameter.`}function Pd(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const Ad="The same selection must be used to override scale domains in a layered view.",Td='Interval selections should be initialized using "x" and/or "y" keys.';function Id(e){return`Unknown repeated value "${e}".`}function Ca(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const Rd="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function zd(e){return`Unrecognized parse "${e}".`}function Na(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const Ld="Attempt to add the same child twice.";function Dd(e){return`Ignoring an invalid transform: ${M(e)}.`}const Md='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function Fa(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function Ud(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${M(t)} is overridden by a child projection ${M(n)}.`}const Bd="Arc marks uses theta channel rather than angle, replacing angle with theta.";function Wd(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${M(n)}}.`}function Pa(e){return`Invalid field type "${e}".`}function Hd(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function qd(e){return`Invalid aggregation operator "${e}".`}function Aa(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function Gd(e){return`Position range does not support relative band size for ${e}.`}function Yr(e,t){return`Dropping ${M(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const Vd="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Ci(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function Xd(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function Yd(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function Kd(e){return`${e} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function Qd(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function Kr(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function Zd(e){return`The ${e} for range marks cannot be an expression`}function Jd(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function eg(e,t){return`Specified orient "${e}" overridden with "${t}".`}function tg(e){return`Cannot use the scale property "${e}" with non-color channel.`}function ng(e){return`Cannot use the relative band size with ${e} scale.`}function ig(e){return`Using unaggregated domain with raw field has no effect (${M(e)}).`}function rg(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function sg(e){return`Unaggregated domain is currently unsupported for log scale (${M(e)}).`}function og(e){return`Cannot apply size to non-oriented mark "${e}".`}function ag(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function cg(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function Ta(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function Ia(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function lg(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${M(n)} and ${M(i)}). Using ${M(n)}.`}function ug(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${M(n)} and ${M(i)}). Using the union of the two domains.`}function fg(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function dg(e){return`Dropping sort property ${M(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const Ra="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",gg="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",pg="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",hg="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function mg(e){return`Cannot stack "${e}" if there is already "${e}2".`}function bg(e){return`Cannot stack non-linear scale (${e}).`}function yg(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Ni(e,t){return`Invalid ${e}: ${M(t)}.`}function vg(e){return`Dropping day from datetime ${M(e)} as day cannot be combined with other units.`}function Og(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function xg(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function _g(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function za(e){return`1D error band does not support ${e}.`}function La(e){return`Channel ${e} is required for "binned" bin.`}function jg(e){return`Channel ${e} should not be used with "binned" bin.`}function Sg(e){return`Domain for ${e} is required for threshold scale.`}var zO=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},LO=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};const Da=df(gf);let ln=Da;function wg(e){return ln=e,ln}function $g(){return ln=Da,ln}function v(...e){ln.warn(...e)}function Eg(...e){ln.debug(...e)}function Bt(e){if(e&&W(e)){for(const t of Zr)if(t in e)return!0}return!1}const Ma=["january","february","march","april","may","june","july","august","september","october","november","december"],kg=Ma.map(e=>e.substr(0,3)),Ua=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Cg=Ua.map(e=>e.substr(0,3));function Ng(e){if(vi(e)&&(e=+e),X(e))return e>4&&v(Ni("quarter",e)),e-1;throw new Error(Ni("quarter",e))}function Fg(e){if(vi(e)&&(e=+e),X(e))return e-1;{const t=e.toLowerCase(),n=Ma.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=kg.indexOf(i);if(r!==-1)return r;throw new Error(Ni("month",e))}}function Pg(e){if(vi(e)&&(e=+e),X(e))return e%7;{const t=e.toLowerCase(),n=Ua.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Cg.indexOf(i);if(r!==-1)return r;throw new Error(Ni("day",e))}}function Qr(e,t){const n=[];if(t&&e.day!==void 0&&(y(e).length>1&&(v(vg(e)),e=N(e),delete e.day)),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Fg(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Ng(e.quarter):e.quarter;n.push(X(i)?i*3:`${i}*3`)}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Pg(e.day):e.day;n.push(X(i)?i+1:`${i}+1`)}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function Bn(e){const t=Qr(e,!0),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Ag(e){const t=Qr(e,!1),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Tg(e){const t=Qr(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}var Ig=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ba={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Zr=y(Ba);function Rg(e){return!!Ba[e]}function Jr(e){return e.startsWith("utc")}function zg(e){return e.substr(3)}const Lg={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function es(e){return Zr.filter(t=>Wa(e,t))}function Wa(e,t){const n=e.indexOf(t);return n<0||(n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")?!1:!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function Dg(e,t,{end:n}={end:!1}){const i=zr(t),r=Jr(e)?"utc":"";function s(c){return c==="quarter"?`(${r}quarter(${i})-1)`:`${r}${c}(${i})`}let o;const a={};for(const c of Zr)Wa(e,c)&&(a[c]=s(c),o=c);return n&&(a[o]+="+1"),Ag(a)}function Ha(e){if(!e)return;const t=es(e);return`timeUnitSpecifier(${M(t)}, ${M(Lg)})`}function Mg(e,t,n){if(!e)return;const i=Ha(e),r=n||Jr(e);return`${r?"utc":"time"}Format(${t}, ${i})`}function oe(e){if(!e)return;let t;return C(e)?t={unit:e}:W(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),Jr(t.unit)&&(t.utc=!0,t.unit=zg(t.unit)),t}function Ug(e){const t=oe(e),{utc:n}=t,i=Ig(t,["utc"]);return i.unit?(n?"utc":"")+y(i).map(r=>H(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+y(i).map(r=>H(`_${r}_${i[r]}`)).join("")}function Bg(e){return e==null?void 0:e.param}function ts(e){return e&&!!e.field&&e.equal!==void 0}function ns(e){return e&&!!e.field&&e.lt!==void 0}function is(e){return e&&!!e.field&&e.lte!==void 0}function rs(e){return e&&!!e.field&&e.gt!==void 0}function ss(e){return e&&!!e.field&&e.gte!==void 0}function os(e){if(e&&e.field){if(S(e.range)&&e.range.length===2)return!0;if(w(e.range))return!0}return!1}function as(e){return e&&!!e.field&&(S(e.oneOf)||S(e.in))}function Wg(e){return e&&!!e.field&&e.valid!==void 0}function qa(e){return as(e)||ts(e)||os(e)||ns(e)||rs(e)||is(e)||ss(e)}function We(e,t){return Vi(e,{timeUnit:t,wrapTime:!0})}function Hg(e,t){return e.map(n=>We(n,t))}function Ga(e,t=!0){var n;const{field:i}=e,r=(n=oe(e.timeUnit))===null||n===void 0?void 0:n.unit,s=r?`time(${Dg(r,i)})`:_(e,{expr:"datum"});if(ts(e))return`${s}===${We(e.equal,r)}`;if(ns(e)){const o=e.lt;return`${s}<${We(o,r)}`}else if(rs(e)){const o=e.gt;return`${s}>${We(o,r)}`}else if(is(e)){const o=e.lte;return`${s}<=${We(o,r)}`}else if(ss(e)){const o=e.gte;return`${s}>=${We(o,r)}`}else{if(as(e))return`indexof([${Hg(e.oneOf,r).join(",")}], ${s}) !== -1`;if(Wg(e))return cs(s,e.valid);if(os(e)){const{range:o}=e,a=w(o)?{signal:`${o.signal}[0]`}:o[0],c=w(o)?{signal:`${o.signal}[1]`}:o[1];if(a!==null&&c!==null&&t)return"inrange("+s+", ["+We(a,r)+", "+We(c,r)+"])";const l=[];return a!==null&&l.push(`${s} >= ${We(a,r)}`),c!==null&&l.push(`${s} <= ${We(c,r)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${M(e)}`)}function cs(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function qg(e){var t;return qa(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=oe(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Wn={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Wt=Wn.quantitative,ls=Wn.ordinal,un=Wn.temporal,us=Wn.nominal,fn=Wn.geojson;function Gg(e){if(e){e=e.toLowerCase();switch(e){case"q":case Wt:return"quantitative";case"t":case un:return"temporal";case"o":case ls:return"ordinal";case"n":case us:return"nominal";case fn:return"geojson"}}return}var Vg=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Z={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},fs={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function Xg(e,t){const n=fs[e],i=fs[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const Yg={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Va(e){return Yg[e]}const Xa=["linear","log","pow","sqrt","symlog","time","utc"],Kg=It(Xa),Qg=["linear","log","pow","sqrt","symlog"],Zg=It(Qg);function Jg(e){return e in Zg}const ep=["quantile","quantize","threshold"],tp=It(ep),np=Xa.concat(["quantile","quantize","threshold","sequential","identity"]),ip=It(np),rp=["ordinal","bin-ordinal","point","band"],sp=It(rp);function te(e){return e in sp}function he(e){return e in ip}function Ee(e){return e in Kg}function Hn(e){return e in tp}const op={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function ap(e){return!C(e)&&!!e.name}function Ya(e){return e==null?void 0:e.param}function cp(e){return e&&e.unionWith}const lp={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},up=Vg(lp,["type","domain","range","rangeMax","rangeMin","scheme"]),fp=y(up);function ds(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return Ee(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return Ee(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return Ee(e);case"nice":return Ee(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return he(e)&&!F(["log","time","utc","threshold","quantile"],e)}}function Ka(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return cn(e)?void 0:tg(e);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function dp(e,t){return F([ls,us],t)?e===void 0||te(e):t===un?F([Z.TIME,Z.UTC,void 0],e):t===Wt?F([Z.LOG,Z.POW,Z.SQRT,Z.SYMLOG,Z.QUANTILE,Z.QUANTIZE,Z.THRESHOLD,Z.LINEAR,void 0],e):!0}function gp(e,t){if(!Ot(e))return!1;switch(e){case G:case Q:case Se:case Re:return Ee(t)||F(["band","point"],t);case nt:case mt:case it:case pt:case ht:case zt:return Ee(t)||Hn(t)||F(["band","point","ordinal"],t);case le:case De:case Me:return t!=="band";case bt:case ue:return t==="ordinal"||Hn(t)}}const ae={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},Qa=ae.arc,Fi=ae.area,Pi=ae.bar,pp=ae.image,Ai=ae.line,Ti=ae.point,hp=ae.rect,Ii=ae.rule,Za=ae.text,gs=ae.tick,mp=ae.trail,ps=ae.circle,hs=ae.square,Ja=ae.geoshape;function St(e){return["line","area","trail"].includes(e)}function ec(e){return["rect","bar","image","arc"].includes(e)}const tc=y(ae);function He(e){return e.type}const DO=It(tc),bp=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],yp=["fill","fillOpacity"],vp=[...bp,...yp],Op={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},nc=y(Op),xp={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},_p={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},jp={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},ic=y(jp);function dn(e){return e&&e.band!=null}const Sp={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},rc=5,wp={binSpacing:1,continuousBandSize:rc,timeUnitBandPosition:.5},$p={binSpacing:0,continuousBandSize:rc,timeUnitBandPosition:.5},Ep={thickness:1};function kp(e){return He(e)?e.type:e}function ms(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:s}=e,o=oc(e);return j(n)&&!fa(n.aggregate)&&r&&Ee(r.get("type"))&&r.get("zero")===!1?sc({fieldDef:n,channel:t,markDef:i,ref:o,config:s}):o}function sc({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){if(St(n.type))return i;const s=z("invalid",n,r);return s===null?i:[Cp(e,t),i]}function Cp(e,t){const n=bs(e,!0),i=Dt(t),r=i==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function bs(e,t=!0){return cs(C(e)?e:_(e,{expr:"datum"}),!t)}function Np(e){const{datum:t}=e;return Bt(t)?Bn(t):`${M(t)}`}function Ht(e,t,n,i){const r={};if(t&&(r.scale=t),$t(e)){const{datum:s}=e;Bt(s)?r.signal=Bn(s):w(s)?r.signal=s.signal:Un(s)?r.signal=s.expr:r.value=s}else r.field=_(e,n);if(i){const{offset:s,band:o}=i;s&&(r.offset=s),o&&(r.band=o)}return r}function Ri({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,bandPosition:s=.5}){const o=0<s&&s<1?"datum":void 0,a=_(t,{expr:o,suffix:r}),c=n!==void 0?_(n,{expr:o}):_(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const u=s===0?a:c;l.field=u}else{const u=w(s)?`${s.signal} * ${a} + (1-${s.signal}) * ${c}`:`${s} * ${a} + ${1-s} * ${c}`;l.signal=`scale("${e}", ${u})`}return i&&(l.offset=i),l}function oc({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l,bandPosition:u}){var f;if(t){if(k(t)){if(xe(t)){u??(u=yc({fieldDef:t,fieldDef2:n,markDef:i,config:r}));const{bin:g,timeUnit:p,type:h}=t;if(U(g)||u&&p&&h===un)return a&&a.impute?Ht(t,s,{binSuffix:"mid"},{offset:c}):u?Ri({scaleName:s,fieldOrDatumDef:t,bandPosition:u,offset:c}):Ht(t,s,Vn(t,e)?{binSuffix:"range"}:{},{offset:c});if(se(g)){if(j(n))return Ri({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:u,offset:c});{const m=e===G?je:Ie;v(La(m))}}}const d=o==null?void 0:o.get("type");return Ht(t,s,te(d)?{binSuffix:"range"}:{},{offset:c,band:d==="band"?(f=u??t.bandPosition)!==null&&f!==void 0?f:.5:void 0})}else if(ke(t)){const d=t.value,g=c?{offset:c}:{};return Object.assign(Object.assign({},qn(e,d)),g)}}return pf(l)&&(l=l()),l&&Object.assign(Object.assign({},l),c?{offset:c}:{})}function qn(e,t){return F(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:F(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:q(t)}function qt(e){return e&&e!=="number"&&e!=="time"}function ac(e,t,n){return`${e}(${t}${n?`, ${M(n)}`:""})`}const Fp=" \u2013 ";function ys({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){var o,a;if(qt(n))return vs({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const c=cc(e,i,r);if(mn(e)){const l=Ap(c,j(e)?(o=oe(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,s.timeFormat,gn(e)&&((a=e.scale)===null||a===void 0?void 0:a.type)===Z.UTC);return l?{signal:l}:void 0}if(t=fc(wt(e),t,s),j(e)&&U(e.bin)){const l=_(e,{expr:i,binSuffix:"end"});return{signal:zi(c,l,t,n,s)}}else return t||wt(e)==="quantitative"?{signal:`${dc(c,t)}`}:{signal:`isValid(${c}) ? ${c} : ""+${c}`}}function cc(e,t,n){return j(e)?n?`${_(e,{expr:t,suffix:"end"})}-${_(e,{expr:t,suffix:"start"})}`:_(e,{expr:t}):Np(e)}function vs({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){if(o??(o=cc(e,i,r)),j(e)&&U(e.bin)){const a=_(e,{expr:i,binSuffix:"end"});return{signal:zi(o,a,t,n,s)}}return{signal:ac(n,o,t)}}function lc(e,t,n,i,r,s){var o;if(qt(i))return;if(mn(e)){const a=j(e)?(o=oe(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return Pp(n,a,r,s)}return fc(t,n,r)}function uc(e,t,n){return e&&(w(e)||e==="number"||e==="time")?e:mn(t)&&n!=="time"&&n!=="utc"?"time":void 0}function fc(e,t,n){return C(t)?t:e===Wt?n.numberFormat:void 0}function Pp(e,t,n,i){return e||(t?{signal:Ha(t)}:i?void 0:n.timeFormat)}function dc(e,t){return`format(${e}, "${t||""}")`}function gc(e,t,n,i){var r;return qt(n)?ac(n,e,t):dc(e,(r=C(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function zi(e,t,n,i,r){const s=gc(e,n,i,r),o=gc(t,n,i,r);return`${cs(e,!1)} ? "null" : ${s} + "${Fp}" + ${o}`}function Ap(e,t,n,i,r){return!t||n?(n=C(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):Mg(t,e,r)}const Li="min",Tp={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function pc(e){return e in Tp}function hc(e){return!!e&&!!e.encoding}function qe(e){return!!e&&(e.op==="count"||!!e.field)}function mc(e){return!!e&&S(e)}function Gn(e){return"row"in e||"column"in e}function Os(e){return!!e&&"header"in e}function Di(e){return"facet"in e}var xs=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Ip(e){return e.param}function Rp(e){return e&&!C(e)&&"repeat"in e}function bc(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function _s(e){return"sort"in e}function yc({fieldDef:e,fieldDef2:t,markDef:n,config:i}){if(k(e)&&e.bandPosition!==void 0)return e.bandPosition;if(j(e)){const{timeUnit:r,bin:s}=e;if(r&&!t)return ec(n.type)?0:Ut("timeUnitBandPosition",n,i);if(U(s))return .5}return}function vc({channel:e,fieldDef:t,fieldDef2:n,markDef:i,config:r,scaleType:s,useVlSizeChannel:o}){var a,c,l;const u=$e(e),f=z(o?"size":u,i,r,{vgChannel:u});if(f!==void 0)return f;if(j(t)){const{timeUnit:d,bin:g}=t;if(d&&!n)return{band:Ut("timeUnitBandSize",i,r)};if(U(g)&&!te(s))return{band:1}}return ec(i.type)?s?te(s)?((a=r[i.type])===null||a===void 0?void 0:a.discreteBandSize)||{band:1}:(c=r[i.type])===null||c===void 0?void 0:c.continuousBandSize:(l=r[i.type])===null||l===void 0?void 0:l.discreteBandSize:void 0}function Oc(e,t,n,i){return U(e.bin)||e.timeUnit&&xe(e)&&e.type==="temporal"?yc({fieldDef:e,fieldDef2:t,markDef:n,config:i})!==void 0:!1}function Mi(e){return!!e&&"condition"in e}function Ui(e){const t=e&&e.condition;return!!t&&!S(t)&&j(t)}function Bi(e){const t=e&&e.condition;return!!t&&!S(t)&&k(t)}function zp(e){const t=e&&e.condition;return!!t&&(S(t)||ke(t))}function j(e){return!!e&&(!!e.field||e.aggregate==="count")}function wt(e){return e&&e.type}function $t(e){return!!e&&"datum"in e}function Ge(e){return xe(e)&&!Wi(e)||js(e)}function js(e){return $t(e)&&X(e.datum)}function k(e){return j(e)||$t(e)}function xe(e){return!!e&&("field"in e||e.aggregate==="count")&&"type"in e}function ke(e){return e&&"value"in e&&"value"in e}function gn(e){return!!e&&("scale"in e||"sort"in e)}function Ss(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function xc(e){return!!e&&"legend"in e}function _c(e){return!!e&&("format"in e||"formatType"in e)}function Lp(e){return ge(e,["legend","axis","header","scale"])}function Dp(e){return"op"in e}function _(e,t={}){var n,i,r;let s=e.field;const o=t.prefix;let a=t.suffix,c="";if(Up(e))s=ea("count");else{let l;if(!t.nofn)if(Dp(e))l=e.op;else{const{bin:u,aggregate:f,timeUnit:d}=e;U(u)?(l=da(u),a=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?xt(f)?(c=`["${s}"]`,s=`argmax_${f.argmax}`):st(f)?(c=`["${s}"]`,s=`argmin_${f.argmin}`):l=String(f):d&&(l=Ug(d),a=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}l&&(s=s?`${l}_${s}`:l)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),t.forAs?Lr(s):t.expr?Qo(s,t.expr)+c:ye(s)+c}function Wi(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return j(e)&&!!e.bin;case"temporal":return!1}throw new Error(Pa(e.type))}function Mp(e){var t;return gn(e)&&Hn((t=e.scale)===null||t===void 0?void 0:t.type)}function Up(e){return e.aggregate==="count"}function Bp(e,t){var n;const{field:i,bin:r,timeUnit:s,aggregate:o}=e;if(o==="count")return t.countTitle;if(U(r))return`${i} (binned)`;if(s){const a=(n=oe(s))===null||n===void 0?void 0:n.unit;if(a)return`${i} (${es(a).join("-")})`}else if(o)return xt(o)?`${i} for max ${o.argmax}`:st(o)?`${i} for min ${o.argmin}`:`${In(o)} of ${i}`;return i}function Wp(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(xt(t))return`${r} for argmax(${t.argmax})`;if(st(t))return`${r} for argmin(${t.argmin})`;const s=oe(i),o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||U(n)&&"bin";return o?`${o.toUpperCase()}(${r})`:r}const jc=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Wp(e);default:return Bp(e,t)}};let Sc=jc;function wc(e){Sc=e}function Hp(){wc(jc)}function pn(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,s;const o=(r=ws(e))===null||r===void 0?void 0:r.title;if(!j(e))return o;const a=e,c=i?$s(a,t):void 0;return n?Y(o,a.title,c):(s=o??a.title)!==null&&s!==void 0?s:c}function ws(e){return Ss(e)&&e.axis?e.axis:xc(e)&&e.legend?e.legend:Os(e)&&e.header?e.header:void 0}function $s(e,t){return Sc(e,t)}function Hi(e){var t;if(_c(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=ws(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function qp(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(_s(e)&&S(e.sort))return"ordinal";const{aggregate:i,bin:r,timeUnit:s}=e;if(s)return"temporal";if(r||i&&!xt(i)&&!st(i))return"quantitative";if(gn(e)&&((n=e.scale)===null||n===void 0?void 0:n.type))switch(fs[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Ve(e){return j(e)?e:Ui(e)?e.condition:void 0}function J(e){return k(e)?e:Bi(e)?e.condition:void 0}function $c(e,t,n,i={}){if(C(e)||X(e)||Pn(e)){const r=C(e)?"string":X(e)?"number":"boolean";return v(Wd(t,r,e)),{value:e}}return k(e)?qi(e,t,n,i):Bi(e)?Object.assign(Object.assign({},e),{condition:qi(e.condition,t,n,i)}):e}function qi(e,t,n,i){if(_c(e)){const{format:r,formatType:s}=e,o=xs(e,["format","formatType"]);if(qt(s)&&!n.customFormatTypes)return v(Fa(t)),qi(o,t,n,i)}else{const r=Ss(e)?"axis":xc(e)?"legend":Os(e)?"header":null;if(r&&e[r]){const s=e[r],{format:o,formatType:a}=s,c=xs(s,["format","formatType"]);if(qt(a)&&!n.customFormatTypes)return v(Fa(t)),qi(Object.assign(Object.assign({},e),{[r]:c}),t,n,i)}}return j(e)?Es(e,t,i):Gp(e)}function Gp(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=X(n)?"quantitative":C(n)?"nominal":Bt(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function Es(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:o}=e,a=Object.assign({},e);if(!n&&i&&!Hr(i)&&!xt(i)&&!st(i)&&(v(qd(i)),delete a.aggregate),r&&(a.timeUnit=oe(r)),o&&(a.field=`${o}`),U(s)&&(a.bin=Gi(s,t)),se(s)&&!Be(t)&&v(jg(t)),xe(a)){const{type:c}=a,l=Gg(c);c!==l&&(a.type=l),c!=="quantitative"&&(fa(i)&&(v(Hd(c,i)),a.type="quantitative"))}else if(!aa(t)){const c=qp(a,t);a.type=c}if(xe(a)){const{compatible:c,warning:l}=Vp(a,t)||{};c===!1&&v(l)}if(_s(a)&&C(a.sort)){const{sort:c}=a;if(pc(c))return Object.assign(Object.assign({},a),{sort:{encoding:c}});const l=c.substr(1);if(c.charAt(0)==="-"&&pc(l))return Object.assign(Object.assign({},a),{sort:{encoding:l,order:"descending"}})}if(Os(a)){const{header:c}=a;if(c){const{orient:l}=c,u=xs(c,["orient"]);if(l)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},u),{labelOrient:c.labelOrient||l,titleOrient:c.titleOrient||l})})}}return a}function Gi(e,t){return Pn(e)?{maxbins:ga(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:ga(t)}):e}const hn={compatible:!0};function Vp(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Ze:case Je:case Oi:return Wi(e)?hn:{compatible:!1,warning:Yd(t)};case G:case Q:case le:case De:case Me:case Ln:case Mn:case xi:case Lt:case _i:case ji:case zt:case Se:case Re:case Si:return hn;case Le:case ve:case ze:case we:return n!==Wt?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:hn;case it:case pt:case ht:case mt:case nt:case tt:case et:case je:case Ie:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:hn;case ue:case bt:return!Wi(e)&&!Mp(e)?{compatible:!1,warning:Kd(t)}:hn;case Dn:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:hn}}function mn(e){const{formatType:t}=Hi(e);return t==="time"||!t&&Xp(e)}function Xp(e){return e&&(e.type==="temporal"||j(e)&&!!e.timeUnit)}function Vi(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var s;const o=t&&((s=oe(t))===null||s===void 0?void 0:s.unit);let a=o||n==="temporal",c;return Un(e)?c=e.expr:w(e)?c=e.signal:Bt(e)?(a=!0,c=Bn(e)):(C(e)||X(e))&&(a&&(c=`datetime(${M(e)})`,Rg(o)&&((X(e)&&e<1e4||C(e)&&isNaN(Date.parse(e)))&&(c=Bn({[o]:e}))))),c?i&&a?`time(${c})`:c:r?void 0:M(e)}function Ec(e,t){const{type:n}=e;return t.map(i=>{const r=Vi(i,{timeUnit:j(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function Vn(e,t){return U(e.bin)?Ot(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const kc={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function Xn(e){return e&&e.condition}const Cc=["domain","grid","labels","ticks","title"],Yp={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Nc={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},Kp=Object.assign(Object.assign({},Nc),{style:1,labelExpr:1,encoding:1});function Fc(e){return!!Kp[e]}const Qp={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},Pc=y(Qp);function ct(e){return"mark"in e}class Xi{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return ct(t)?kp(t.mark)===this.name:!1}}var Zp=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Gt(e,t){const n=e&&e[t];return n?S(n)?on(n,i=>!!i.field):j(n)||Ui(n):!1}function ks(e){return on(Qf,t=>{if(Gt(e,t)){const n=e[t];if(S(n))return on(n,i=>!!i.aggregate);{const i=Ve(n);return i&&!!i.aggregate}}return!1})}function Ac(e,t){const n=[],i=[],r=[],s=[],o={};return Cs(e,(a,c)=>{if(j(a)){const{field:l,aggregate:u,bin:f,timeUnit:d}=a,g=Zp(a,["field","aggregate","bin","timeUnit"]);if(u||d||f){const p=ws(a),h=p&&p.title;let m=_(a,{forAs:!0});const x=Object.assign(Object.assign(Object.assign({},h?[]:{title:pn(a,t,{allowDisabling:!0})}),g),{field:m});if(u){let b;if(xt(u)?(b="argmax",m=_({op:"argmax",field:u.argmax},{forAs:!0}),x.field=`${m}.${l}`):st(u)?(b="argmin",m=_({op:"argmin",field:u.argmin},{forAs:!0}),x.field=`${m}.${l}`):u!=="boxplot"&&u!=="errorbar"&&u!=="errorband"&&(b=u),b){const O={op:b,as:m};l&&(O.field=l),s.push(O)}}else if(n.push(m),xe(a)&&U(f)){if(i.push({bin:f,field:l,as:m}),n.push(_(a,{binSuffix:"end"})),Vn(a,c)&&n.push(_(a,{binSuffix:"range"})),Be(c)){const b={field:`${m}_end`};o[`${c}2`]=b}x.bin="binned",aa(c)||(x.type=Wt)}else if(d){r.push({timeUnit:d,field:l,as:m});const b=xe(a)&&a.type!==un&&"time";b&&(c===Ln||c===Lt?x.formatType=b:od(c)?x.legend=Object.assign({formatType:b},x.legend):Be(c)&&(x.axis=Object.assign({formatType:b},x.axis)))}o[c]=x}else n.push(l),o[c]=e[c]}else o[c]=e[c]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function Jp(e,t,n){const i=cd(t,n);if(i){if(i==="binned"){const r=e[t===je?G:Q];return!!(j(r)&&j(e[t])&&se(r.bin))}}else return!1;return!0}function eh(e,t,n,i){return y(e).reduce((r,s)=>{if(!oa(s))return v(Xd(s)),r;const o=e[s];if(s==="angle"&&t==="arc"&&!e.theta&&(v(Bd),s=Se),!Jp(e,s,t))return v(Ci(s,t)),r;if(s===nt&&t==="line"){const a=Ve(e[s]);if(a==null?void 0:a.aggregate)return v(Vd),r}if(s===le&&(n?"fill"in e:"stroke"in e))return v(Aa("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if(s===Mn||s===Dn&&!S(o)&&!ke(o)||s===Lt&&S(o))o&&(r[s]=V(o).reduce((a,c)=>(j(c)?a.push(Es(c,s)):v(Yr(c,s)),a),[]));else{if(s===Lt&&o===null)r[s]=null;else if(!j(o)&&!$t(o)&&!ke(o)&&!Mi(o)&&!w(o))return v(Yr(o,s)),r;r[s]=$c(o,s,i)}return r},{})}function Yi(e,t){const n={};for(const i of y(e)){const r=$c(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function th(e){const t=[];for(const n of y(e))if(Gt(e,n)){const i=e[n],r=V(i);for(const s of r)j(s)?t.push(s):Ui(s)&&t.push(s.condition)}return t}function Cs(e,t,n){if(!e)return;for(const i of y(e)){const r=e[i];if(S(r))for(const s of r)t.call(n,s,i);else t.call(n,r,i)}}function nh(e,t,n,i){return e?y(e).reduce((r,s)=>{const o=e[s];return S(o)?o.reduce((a,c)=>t.call(i,a,c,s),r):t.call(i,r,o,s)},n):n}function Tc(e,t){return y(t).reduce((n,i)=>{switch(i){case G:case Q:case _i:case Si:case ji:case je:case Ie:case Se:case tt:case Re:case et:case ze:case Le:case we:case ve:case Ln:case ue:case zt:case Lt:return n;case Dn:if(e==="line"||e==="trail")return n;case Mn:case xi:{const r=t[i];if(S(r)||j(r))for(const s of V(r))s.aggregate||n.push(_(s,{}));return n}case nt:if(e==="trail")return n;case le:case De:case Me:case it:case pt:case ht:case bt:case mt:{const r=Ve(t[i]);return r&&!r.aggregate&&n.push(_(r,{})),n}}},[])}var Ic=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ih(e){const{tooltip:t}=e,n=Ic(e,["tooltip"]);if(!t)return{filteredEncoding:n};let i,r;if(S(t)){for(const s of t)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return S(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function Ns(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:o,titlePrefix:a})=>{const c=i?` of ${Fs(t)}`:"";return{field:o+t.field,type:t.type,title:w(a)?{signal:`${a}"${escape(c)}"`}:a+c}}),s=th(n).map(Lp);return{tooltip:[...r,...Te(s,I)]}}function Fs(e){const{title:t,field:n}=e;return Y(t,n)}function Ps(e,t,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:c,positionPrefix:l,endPositionPrefix:u=void 0,extraEncoding:f={}})=>{const d=Fs(n);return Rc(e,a,r,{mark:c,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:`${l}_${n.field}`,type:n.type},d!==void 0?{title:d}:{}),s!==void 0?{scale:s}:{}),o!==void 0?{axis:o}:{})},C(u)?{[`${t}2`]:{field:`${u}_${n.field}`}}:{}),i),f)})}}function Rc(e,t,n,i){const{clip:r,color:s,opacity:o}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),r?{clip:r}:{}),s?{color:s}:{}),o?{opacity:o}:{}),He(i.mark)?i.mark:{type:i.mark}),{style:`${a}-${t}`}),Pn(e[t])?{}:e[t])})]:[]}function zc(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",s=i[r],o=i[`${r}2`],a=i[`${r}Error`],c=i[`${r}Error2`];return{continuousAxisChannelDef:Ki(s,n),continuousAxisChannelDef2:Ki(o,n),continuousAxisChannelDefError:Ki(a,n),continuousAxisChannelDefError2:Ki(c,n),continuousAxis:r}}function Ki(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=Ic(e,["aggregate"]);return n!==t&&v(_g(n,t)),i}else return e}function Lc(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(He(n)&&n.orient)return n.orient;if(Ge(r)){if(Ge(s)){const o=j(r)&&r.aggregate,a=j(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return mn(s)&&!mn(r)?"horizontal":"vertical"}return"horizontal"}else{if(Ge(s))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}var Qi=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Zi="boxplot",rh=["box","median","outliers","rule","ticks"],sh=new Xi(Zi,Mc);function Dc(e){return X(e)?"tukey":e}function Mc(e,{config:t}){var n,i;e=Object.assign(Object.assign({},e),{encoding:Yi(e.encoding,t)});const{mark:r,encoding:s,params:o,projection:a}=e,c=Qi(e,["mark","encoding","params","projection"]),l=He(r)?r:{type:r};o&&v(ka("boxplot"));const u=(n=l.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=z("size",l,t),d=Dc(u),{bins:g,timeUnits:p,transform:h,continuousAxisChannelDef:m,continuousAxis:x,groupby:b,aggregate:O,encodingWithoutContinuousAxis:$,ticksOrient:P,boxOrient:A,customTooltipWithoutAggregatedField:E}=oh(e,u,t),{color:T,size:be}=$,Pe=Qi($,["color","size"]),ui=uf=>Ps(l,x,m,uf,t.boxplot),Qe=ui(Pe),Lo=ui($),Er=ui(Object.assign(Object.assign({},Pe),be?{size:be}:{})),kn=Ns([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],m,$),fi={type:"tick",color:"black",opacity:1,orient:P,invalid:null,aria:!1},Jt=d==="min-max"?kn:Ns([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],m,$),di=[...Qe({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:Jt}),...Qe({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:Jt}),...Qe({partName:"ticks",mark:fi,positionPrefix:"lower_whisker",extraEncoding:Jt}),...Qe({partName:"ticks",mark:fi,positionPrefix:"upper_whisker",extraEncoding:Jt})],Cn=[...d!=="tukey"?di:[],...Lo({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:A,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:kn}),...Er({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},W(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:P,aria:!1}),positionPrefix:"mid_box",extraEncoding:kn})];if(d==="min-max")return Object.assign(Object.assign({},c),{transform:((i=c.transform)!==null&&i!==void 0?i:[]).concat(h),layer:Cn});const Nn=`datum["lower_box_${m.field}"]`,Fn=`datum["upper_box_${m.field}"]`,gi=`(${Fn} - ${Nn})`,Do=`${Nn} - ${u} * ${gi}`,Mo=`${Fn} + ${u} * ${gi}`,pi=`datum["${m.field}"]`,af={joinaggregate:Uc(m.field),groupby:b},Uo={transform:[{filter:`(${Do} <= ${pi}) && (${pi} <= ${Mo})`},{aggregate:[{op:"min",field:m.field,as:`lower_whisker_${m.field}`},{op:"max",field:m.field,as:`upper_whisker_${m.field}`},{op:"min",field:`lower_box_${m.field}`,as:`lower_box_${m.field}`},{op:"max",field:`upper_box_${m.field}`,as:`upper_box_${m.field}`},...O],groupby:b}],layer:di},cf=Qi(Pe,["tooltip"]),{scale:Bo,axis:lf}=m,Wo=Fs(m),Ho=ge(lf,["title"]),qo=Rc(l,"outliers",t.boxplot,{transform:[{filter:`(${pi} < ${Do}) || (${pi} > ${Mo})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[x]:Object.assign(Object.assign(Object.assign({field:m.field,type:m.type},Wo!==void 0?{title:Wo}:{}),Bo!==void 0?{scale:Bo}:{}),L(Ho)?{}:{axis:Ho})},cf),T?{color:T}:{}),E?{tooltip:E}:{})})[0];let hi;const Go=[...g,...p,af];return qo?hi={transform:Go,layer:[qo,Uo]}:(hi=Uo,hi.transform.unshift(...Go)),Object.assign(Object.assign({},c),{layer:[hi,{transform:h,layer:Cn}]})}function Uc(e){return[{op:"q1",field:e,as:`lower_box_${e}`},{op:"q3",field:e,as:`upper_box_${e}`}]}function oh(e,t,n){const i=Lc(e,Zi),{continuousAxisChannelDef:r,continuousAxis:s}=zc(e,i,Zi),o=r.field,a=Dc(t),c=[...Uc(o),{op:"median",field:o,as:`mid_box_${o}`},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:`iqr_${o}`},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:`upper_whisker_${o}`},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:`lower_whisker_${o}`}],u=e.encoding,f=s,d=u[f],g=Qi(u,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:h}=ih(g),{bins:m,timeUnits:x,aggregate:b,groupby:O,encoding:$}=Ac(h,n),P=i==="vertical"?"horizontal":"vertical",A=i,E=[...m,...x,{aggregate:[...b,...c],groupby:O},...l];return{bins:m,timeUnits:x,transform:E,groupby:O,aggregate:b,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:$,ticksOrient:P,boxOrient:A,customTooltipWithoutAggregatedField:p}}var Bc=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const As="errorbar",ah=["ticks","rule"],ch=new Xi(As,Wc);function Wc(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Yi(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:c,tooltipEncoding:l}=Hc(e,As,t);delete s.size;const u=Ps(a,r,i,s,t.errorbar),f=a.thickness,d=a.size,g=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},f!==void 0?{thickness:f}:{}),d!==void 0?{size:d}:{}),p=[...u({partName:"ticks",mark:g,positionPrefix:"lower",extraEncoding:l}),...u({partName:"ticks",mark:g,positionPrefix:"upper",extraEncoding:l}),...u({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},f!==void 0?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},c),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function lh(e,t){const{encoding:n}=e;if(uh(n))return{orient:Lc(e,t),inputType:"raw"};const i=fh(n),r=dh(n),s=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,c=n.y2;if(k(a)&&k(c))throw new Error(`${t} cannot have both x2 and y2`);if(k(a)){if(Ge(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(k(c)){if(Ge(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,c=n.xError2,l=n.yError,u=n.yError2;if(k(c)&&!k(a))throw new Error(`${t} cannot have xError2 without xError`);if(k(u)&&!k(l))throw new Error(`${t} cannot have yError2 without yError`);if(k(a)&&k(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(k(a)){if(Ge(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(k(l)){if(Ge(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function uh(e){return(k(e.x)||k(e.y))&&!k(e.x2)&&!k(e.y2)&&!k(e.xError)&&!k(e.xError2)&&!k(e.yError)&&!k(e.yError2)}function fh(e){return k(e.x2)||k(e.y2)}function dh(e){return k(e.xError)||k(e.xError2)||k(e.yError)||k(e.yError2)}function Hc(e,t,n){var i;const{mark:r,encoding:s,params:o,projection:a}=e,c=Bc(e,["mark","encoding","params","projection"]),l=He(r)?r:{type:r};o&&v(ka(t));const{orient:u,inputType:f}=lh(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:g,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:h,continuousAxis:m}=zc(e,u,t),{errorBarSpecificAggregate:x,postAggregateCalculates:b,tooltipSummary:O,tooltipTitleWithFieldName:$}=gh(l,d,g,p,h,f,t,n),P=s,A=m,E=P[A],T=m==="x"?"x2":"y2",be=P[T],Pe=m==="x"?"xError":"yError",ui=P[Pe],Qe=m==="x"?"xError2":"yError2",Lo=P[Qe],Er=Bc(P,[typeof A=="symbol"?A:A+"",typeof T=="symbol"?T:T+"",typeof Pe=="symbol"?Pe:Pe+"",typeof Qe=="symbol"?Qe:Qe+""]),{bins:kn,timeUnits:fi,aggregate:Jt,groupby:di,encoding:Cn}=Ac(Er,n),Nn=[...Jt,...x],Fn=f!=="raw"?[]:di,gi=Ns(O,d,Cn,$);return{transform:[...(i=c.transform)!==null&&i!==void 0?i:[],...kn,...fi,...Nn.length===0?[]:[{aggregate:Nn,groupby:Fn}],...b],groupby:Fn,continuousAxisChannelDef:d,continuousAxis:m,encodingWithoutContinuousAxis:Cn,ticksOrient:u==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:c,tooltipEncoding:gi}}function gh(e,t,n,i,r,s,o,a){let c=[],l=[];const u=t.field;let f,d=!1;if(s==="raw"){const g=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,p=e.extent?e.extent:g==="mean"?"stderr":"iqr";if(g==="median"!==(p==="iqr")&&v(xg(g,p,o)),p==="stderr"||p==="stdev")c=[{op:p,field:u,as:`extent_${u}`},{op:g,field:u,as:`center_${u}`}],l=[{calculate:`datum["center_${u}"] + datum["extent_${u}"]`,as:`upper_${u}`},{calculate:`datum["center_${u}"] - datum["extent_${u}"]`,as:`lower_${u}`}],f=[{fieldPrefix:"center_",titlePrefix:In(g)},{fieldPrefix:"upper_",titlePrefix:qc(g,p,"+")},{fieldPrefix:"lower_",titlePrefix:qc(g,p,"-")}],d=!0;else{let h,m,x;p==="ci"?(h="mean",m="ci0",x="ci1"):(h="median",m="q1",x="q3"),c=[{op:m,field:u,as:`lower_${u}`},{op:x,field:u,as:`upper_${u}`},{op:h,field:u,as:`center_${u}`}],f=[{fieldPrefix:"upper_",titlePrefix:pn({field:u,aggregate:x,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:pn({field:u,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:pn({field:u,aggregate:h,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&v(Og(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:`upper_${u}`},{calculate:`datum["${u}"]`,as:`lower_${u}`}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:u}],l=[{calculate:`datum["${u}"] + datum["${i.field}"]`,as:`upper_${u}`}],r?l.push({calculate:`datum["${u}"] + datum["${r.field}"]`,as:`lower_${u}`}):l.push({calculate:`datum["${u}"] - datum["${i.field}"]`,as:`lower_${u}`}));for(const g of l)f.push({fieldPrefix:g.as.substring(0,6),titlePrefix:Rt(Rt(g.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:c,tooltipSummary:f,tooltipTitleWithFieldName:d}}function qc(e,t,n){return`${In(e)} ${n} ${t}`}const Ts="errorband",ph=["band","borders"],hh=new Xi(Ts,Gc);function Gc(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Yi(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:c}=Hc(e,Ts,t),l=o,u=Ps(l,r,i,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},g={type:f?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),g=Object.assign(Object.assign(Object.assign({},g),p),{aria:!1})):l.interpolate?v(za("interpolate")):l.tension&&v(za("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...u({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c}),...u({partName:"borders",mark:g,positionPrefix:"lower",extraEncoding:c}),...u({partName:"borders",mark:g,positionPrefix:"upper",extraEncoding:c})]})}const Vc={};function Is(e,t,n){const i=new Xi(e,t);Vc[e]={normalizer:i,parts:n}}function mh(){return y(Vc)}Is(Zi,Mc,rh),Is(As,Wc,ah),Is(Ts,Gc,ph);const bh=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],Xc={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},Yc={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},yh=y(Xc),vh=y(Yc),Oh={header:1,headerRow:1,headerColumn:1,headerFacet:1},Kc=y(Oh),Qc=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],xh={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},_h={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Yn="_vgsid_",jh={point:{on:"click",fields:[Yn],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Rs(e){return!!e&&(e==="legend"||!!e.legend)}function zs(e){return Rs(e)&&W(e)}function Ls(e){return!!e.select}var Sh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Zc(e){const t=[];for(const n of e||[]){if(Ls(n))continue;const{expr:i,bind:r}=n,s=Sh(n,["expr","bind"]);if(r&&i){const o=Object.assign(Object.assign({},s),{bind:r,init:i});t.push(o)}else{const o=Object.assign(Object.assign(Object.assign({},s),i?{update:i}:{}),r?{bind:r}:{});t.push(o)}}return t}function wh(e){return Ji(e)||Ms(e)||Ds(e)}function Ds(e){return"concat"in e}function Ji(e){return"vconcat"in e}function Ms(e){return"hconcat"in e}function Xe(e){return W(e)&&e.step!==void 0}function Jc(e){return e.view||e.width||e.height}const el=20,$h={align:1,bounds:1,center:1,columns:1,spacing:1},Eh=y($h);function kh(e,t,n){var i,r;const s=n[t],o={},{spacing:a,columns:c}=s;a!==void 0&&(o.spacing=a),c!==void 0&&((Di(e)&&!Gn(e.facet)||Ds(e))&&(o.columns=c)),Ji(e)&&(o.columns=1);for(const l of Eh)if(e[l]!==void 0)if(l==="spacing"){const u=e[l];o[l]=X(u)?u:{row:(i=u.row)!==null&&i!==void 0?i:a,column:(r=u.column)!==null&&r!==void 0?r:a}}else o[l]=e[l];return o}var Ch=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Us(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function er(e,t){const n=Kn(e,t);return Xe(n)?n.step:tl}function Kn(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return Y(i,{step:e.step})}const tl=20,Nh={continuousWidth:200,continuousHeight:200,step:tl},Fh={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:Nh,mark:_p,arc:{},area:{},bar:wp,circle:{},geoshape:{},image:{},line:{},point:{},rect:$p,rule:{color:"black"},square:{},text:{color:"black"},tick:Ep,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:op,projection:{},legend:xh,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:jh,style:{},title:{},facet:{spacing:el},concat:{spacing:el}},lt=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],nl={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},il={blue:lt[0],orange:lt[1],red:lt[2],teal:lt[3],green:lt[4],yellow:lt[5],purple:lt[6],pink:lt[7],brown:lt[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Ph(e={}){return{signals:[{name:"color",value:W(e)?Object.assign(Object.assign({},il),e):il}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Ah(e){return{signals:[{name:"fontSize",value:W(e)?Object.assign(Object.assign({},nl),e):nl}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Th(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function rl(e){const t=y(e||{}),n={};for(const i of t){const r=e[i];n[i]=Xn(r)?ha(r):pe(r)}return n}function Ih(e){const t=y(e),n={};for(const i of t)n[i]=rl(e[i]);return n}const Rh=[...ic,...Pc,...Kc,"background","padding","legend","lineBreak","scale","style","title","view"];function sl(e={}){const{color:t,font:n,fontSize:i}=e,r=Ch(e,["color","font","fontSize"]),s=Vo({},Fh,n?Th(n):{},t?Ph(t):{},i?Ah(i):{},r||{}),o=ge(s,Rh);for(const a of["background","lineBreak","padding"])s[a]&&(o[a]=pe(s[a]));for(const a of ic)s[a]&&(o[a]=fe(s[a]));for(const a of Pc)s[a]&&(o[a]=rl(s[a]));for(const a of Kc)s[a]&&(o[a]=fe(s[a]));return s.legend&&(o.legend=fe(s.legend)),s.scale&&(o.scale=fe(s.scale)),s.style&&(o.style=Ih(s.style)),s.title&&(o.title=fe(s.title)),s.view&&(o.view=fe(s.view)),o}const zh=["view",...tc],Lh=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Dh=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},xp);function Mh(e){e=N(e);for(const t of Lh)delete e[t];if(e.axis)for(const t in e.axis)Xn(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of bh)delete e.legend[t];if(e.mark){for(const t of nc)delete e.mark[t];e.mark.tooltip&&W(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(Zc(e.params)),delete e.params);for(const t of zh){for(const i of nc)delete e[t][i];const n=Dh[t];if(n)for(const i of n)delete e[t][i];Bh(e,t)}for(const t of mh())delete e[t];Uh(e);for(const t in e)W(e[t])&&L(e[t])&&delete e[t];return L(e)?void 0:e}function Uh(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=pa(e.title);L(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),L(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),L(i)?delete e.title:e.title=i}function Bh(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},r),e.style[n??t]);L(s)||(e.style[n??t]=s),i||delete e[t]}function tr(e){return"layer"in e}function Wh(e){return"repeat"in e}function Hh(e){return!S(e.repeat)&&e.repeat.layer}var qh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Bs{map(t,n){return Di(t)?this.mapFacet(t,n):Wh(t)?this.mapRepeat(t,n):Ms(t)?this.mapHConcat(t,n):Ji(t)?this.mapVConcat(t,n):Ds(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(tr(t))return this.mapLayer(t,n);if(ct(t))return this.mapUnit(t,n);throw new Error(Vr(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(i=>this.map(i,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(i=>this.map(i,n))})}mapConcat(t,n){const{concat:i}=t,r=qh(t,["concat"]);return Object.assign(Object.assign({},r),{concat:i.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const Gh={zero:1,center:1,normalize:1};function Vh(e){return e in Gh}const Xh=new Set([Qa,Pi,Fi,Ii,Ti,ps,hs,Ai,Za,gs]),Yh=new Set([Pi,Fi,Qa]);function ol(e,t){var n,i;const r=t==="x"?"y":"radius",s=e[t],o=e[r];if(j(s)&&j(o))if(wt(s)==="quantitative"&&wt(o)==="quantitative"){if(s.stack)return t;if(o.stack)return r;const a=j(s)&&!!s.aggregate,c=j(o)&&!!o.aggregate;if(a!==c)return a?t:r;{const l=(n=s.scale)===null||n===void 0?void 0:n.type,u=(i=o.scale)===null||i===void 0?void 0:i.type;if(l&&l!=="linear")return r;if(u&&u!=="linear")return t}}else{if(wt(s)==="quantitative")return t;if(wt(o)==="quantitative")return r}else{if(wt(s)==="quantitative")return t;if(wt(o)==="quantitative")return r}return}function Kh(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function al(e,t,n={}){var i,r;const s=He(e)?e.type:e;if(!Xh.has(s))return null;const o=ol(t,"x")||ol(t,"theta");if(!o)return null;const a=t[o],c=j(a)?_(a,{}):void 0;let l=Kh(o),u=t[l],f=j(u)?_(u,{}):void 0;f===c&&(f=void 0,u=void 0,l=void 0);const d=id.reduce((p,h)=>{if(h!=="tooltip"&&Gt(t,h)){const m=t[h];for(const x of V(m)){const b=Ve(x);if(b.aggregate)continue;const O=_(b,{});(!O||O!==f)&&p.push({channel:h,fieldDef:b})}}return p},[]);let g;if(a.stack!==void 0?Pn(a.stack)?g=a.stack?"zero":null:g=a.stack:Yh.has(s)&&(g="zero"),!g||!Vh(g))return null;if(ks(t)&&d.length===0)return null;if(((i=a==null?void 0:a.scale)===null||i===void 0?void 0:i.type)&&((r=a==null?void 0:a.scale)===null||r===void 0?void 0:r.type)!==Z.LINEAR){if(n.disallowNonLinearStack)return null;v(bg(a.scale.type))}return k(t[rt(o)])?(a.stack!==void 0&&v(mg(o)),null):(j(a)&&a.aggregate&&!F(hd,a.aggregate)&&v(yg(a.aggregate)),{groupbyChannel:u?l:void 0,groupbyField:f,fieldChannel:o,impute:a.impute===null?!1:St(s),stackBy:d,offset:g})}var cl=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Qh(e){const t=cl(e,["point","line"]);return y(t).length>1?t:t.type}function Zh(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:ge(e[t],["point","line"])}));return e}function Ws(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?W(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?W(t.point)?t.point:{}:void 0}function ll(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class Jh{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(ct(t)){const{mark:i,encoding:r}=t,s=He(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!Ws(s,n[s.type],r);case"area":return!!Ws(s,n[s.type],r)||!!ll(s,n[s.type])}}return!1}run(t,n,i){const{config:r}=n,{params:s,projection:o,mark:a,encoding:c}=t,l=cl(t,["params","projection","mark","encoding"]),u=Yi(c,r),f=He(a)?a:{type:a},d=Ws(f,r[f.type],u),g=f.type==="area"&&ll(f,r[f.type]),p=[Object.assign(Object.assign({},s?{params:s}:{}),{mark:Qh(Object.assign(Object.assign({},f.type==="area"&&f.opacity===void 0&&f.fillOpacity===void 0?{opacity:.7}:{}),f)),encoding:ge(u,["shape"])})],h=al(f,u);let m=u;if(h){const{fieldChannel:x,offset:b}=h;m=Object.assign(Object.assign({},u),{[x]:Object.assign(Object.assign({},u[x]),b?{stack:b}:{})})}return g&&p.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},sn(f,["clip","interpolate","tension","tooltip"])),g),encoding:m})),d&&p.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},sn(f,["clip","tooltip"])),d),encoding:m})),i(Object.assign(Object.assign({},l),{layer:p}),Object.assign(Object.assign({},n),{config:Zh(r)}))}}var em=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function tm(e,t){return t?Gn(e)?gl(e,t):ul(e,t):e}function Hs(e,t){return t?gl(e,t):e}function qs(e,t,n){const i=t[e];if(Rp(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});v(Id(i.repeat));return}return t}function ul(e,t){if(e=qs("field",e,t),e===void 0)return;if(e===null)return null;if(_s(e)&&qe(e.sort)){const n=qs("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}function fl(e,t){if(j(e))return ul(e,t);{const n=qs("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function dl(e,t){if(k(e)){const n=fl(e,t);if(n)return n;if(Mi(e))return{condition:e.condition}}else{if(Bi(e)){const n=fl(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const i=em(e,["condition"]);return i}}return e}return}function gl(e,t){const n={};for(const i in e)if(en(e,i)){const r=e[i];if(S(r))n[i]=r.map(s=>dl(s,t)).filter(s=>s);else{const s=dl(r,t);s!==void 0&&(n[i]=s)}}return n}class nm{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(ct(t)){const{encoding:n,mark:i}=t;if(i==="line"||He(i)&&i.type==="line")for(const r of td){const s=Dt(r),o=n[s];if(n[r]&&(j(o)&&!se(o.bin)||$t(o)))return!0}}return!1}run(t,n,i){const{encoding:r,mark:s}=t;return v(Jd(!!r.x2,!!r.y2)),console.log(s),i(Object.assign(Object.assign({},t),{mark:W(s)?Object.assign(Object.assign({},s),{type:"rule"}):"rule"}),n)}}var Et=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class im extends Bs{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[sh,ch,hh,new Jh,new nm]}map(t,n){if(ct(t)){const i=Gt(t.encoding,Ze),r=Gt(t.encoding,Je),s=Gt(t.encoding,Oi);if(i||r||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,s=Hs(t.encoding,n.repeater),o=Object.assign(Object.assign({},t),s?{encoding:s}:{});if(i||r)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const c of this.nonFacetUnitNormalizers)if(c.hasMatchingType(o,n.config))return c.run(o,n,a);return o}mapRepeat(t,n){return Hh(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r}=t,s=Et(t,["repeat","spec"]),{row:o,column:a,layer:c}=i,{repeater:l={},repeaterPrefix:u=""}=n;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:c},spec:r}}),n):Object.assign(Object.assign({},s),{layer:c.map(f=>{const d=Object.assign(Object.assign({},l),{layer:f}),g=`${(r.name||"")+u}child__layer_${H(f)}`,p=this.mapLayerOrUnit(r,Object.assign(Object.assign({},n),{repeater:d,repeaterPrefix:g}));return p.name=g,p})})}mapNonLayerRepeat(t,n){var i;const{repeat:r,spec:s,data:o}=t,a=Et(t,["repeat","spec","data"]);!S(r)&&t.columns&&(t=ge(t,["columns"]),v(Ca("repeat")));const c=[],{repeater:l={},repeaterPrefix:u=""}=n,f=!S(r)&&r.row||[l?l.row:null],d=!S(r)&&r.column||[l?l.column:null],g=S(r)&&r||[l?l.repeat:null];for(const h of g)for(const m of f)for(const x of d){const b={repeat:h,row:m,column:x,layer:l.layer},O=(s.name||"")+u+"child__"+(S(r)?`${H(h)}`:(r.row?`row_${H(m)}`:"")+(r.column?`column_${H(x)}`:"")),$=this.map(s,Object.assign(Object.assign({},n),{repeater:b,repeaterPrefix:O}));$.name=O,c.push(ge($,["data"]))}const p=S(r)?t.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(i=s.data)!==null&&i!==void 0?i:o,align:"all"},a),{columns:p,concat:c})}mapFacet(t,n){const{facet:i}=t;return Gn(i)&&t.columns&&(t=ge(t,["columns"]),v(Ca("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:s,parentProjection:o,config:a}=n,c=hl({parentProjection:o,projection:r}),l=pl({parentEncoding:s,encoding:Hs(i,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),c?{projection:c}:{}),l?{encoding:l}:{}),{config:a})}mapFacetedUnit(t,n){const i=t.encoding,{row:r,column:s,facet:o}=i,a=Et(i,["row","column","facet"]),{mark:c,width:l,projection:u,height:f,view:d,params:g,encoding:p}=t,h=Et(t,["mark","width","projection","height","view","params","encoding"]),{facetMapping:m,layout:x}=this.getFacetMappingAndLayout({row:r,column:s,facet:o},n),b=Hs(a,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},h),x),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),f?{height:f}:{}),d?{view:d}:{}),u?{projection:u}:{}),{mark:c,encoding:b}),g?{params:g}:{})}),n)}getFacetMappingAndLayout(t,n){var i;const{row:r,column:s,facet:o}=t;if(r||s){o&&v(Qd([...r?[Ze]:[],...s?[Je]:[]]));const a={},c={};for(const l of[Ze,Je]){const u=t[l];if(u){const f=Et(u,["align","center","spacing","columns"]);a[l]=f;for(const d of["align","center","spacing"])u[d]!==void 0&&((i=c[d])!==null&&i!==void 0||(c[d]={}),c[d][l]=u[d])}}return{facetMapping:a,layout:c}}else{const{align:a,center:c,spacing:l,columns:u}=o,f=Et(o,["align","center","spacing","columns"]);return{facetMapping:tm(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),c?{center:c}:{}),l?{spacing:l}:{}),u?{columns:u}:{})}}}mapLayer(t,n){var{parentEncoding:i,parentProjection:r}=n,s=Et(n,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,c=Et(t,["encoding","projection"]),l=Object.assign(Object.assign({},s),{parentEncoding:pl({parentEncoding:i,encoding:o,layer:!0}),parentProjection:hl({parentProjection:r,projection:a})});return super.mapLayer(c,l)}}function pl({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...y(e),...y(t)]);for(const s of r){const o=t[s],a=e[s];if(k(o)){const c=Object.assign(Object.assign({},a),o);i[s]=c}else Bi(o)?i[s]=Object.assign(Object.assign({},o),{condition:Object.assign(Object.assign({},a),o.condition)}):o||o===null?i[s]=o:(n||ke(a)||w(a)||k(a)||S(a))&&(i[s]=a)}}else i=t;return!i||L(i)?void 0:i}function hl(e){const{parentProjection:t,projection:n}=e;return t&&n&&v(Ud({parentProjection:t,projection:n})),n??t}function Gs(e){return"filter"in e}function rm(e){return(e==null?void 0:e.stop)!==void 0}function ml(e){return"lookup"in e}function sm(e){return"data"in e}function om(e){return"param"in e}function am(e){return"pivot"in e}function cm(e){return"density"in e}function lm(e){return"quantile"in e}function um(e){return"regression"in e}function fm(e){return"loess"in e}function dm(e){return"sample"in e}function gm(e){return"window"in e}function pm(e){return"joinaggregate"in e}function hm(e){return"flatten"in e}function mm(e){return"calculate"in e}function bl(e){return"bin"in e}function bm(e){return"impute"in e}function ym(e){return"timeUnit"in e}function vm(e){return"aggregate"in e}function Om(e){return"stack"in e}function xm(e){return"fold"in e}function _m(e){return e.map(t=>Gs(t)?{filter:rn(t.filter,qg)}:t)}var kt=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class jm extends Bs{map(t,n){var i,r;return(i=n.emptySelections)!==null&&i!==void 0||(n.emptySelections={}),(r=n.selectionPredicates)!==null&&r!==void 0||(n.selectionPredicates={}),t=yl(t,n),super.map(t,n)}mapLayerOrUnit(t,n){if(t=yl(t,n),t.encoding){const i={};for(const[r,s]of gt(t.encoding))i[r]=vl(s,n);t=Object.assign(Object.assign({},t),{encoding:i})}return super.mapLayerOrUnit(t,n)}mapUnit(t,n){const i=t,{selection:r}=i,s=kt(i,["selection"]);return r?Object.assign(Object.assign({},s),{params:gt(r).map(([o,a])=>{var c;const l=a,{init:u,bind:f,empty:d}=l,g=kt(l,["init","bind","empty"]);g.type==="single"?(g.type="point",g.toggle=!1):g.type==="multi"&&(g.type="point"),n.emptySelections[o]=d!=="none";for(const p of re((c=n.selectionPredicates[o])!==null&&c!==void 0?c:{}))p.empty=d!=="none";return{name:o,value:u,select:g,bind:f}})}):t}}function yl(e,t){const{transform:n}=e,i=kt(e,["transform"]);if(n){const r=n.map(s=>{if(Gs(s))return{filter:Vs(s,t)};if(bl(s)&&Mt(s.bin))return Object.assign(Object.assign({},s),{bin:Ol(s.bin)});if(ml(s)){const o=s.from,{selection:a}=o,c=kt(o,["selection"]);return a?Object.assign(Object.assign({},s),{from:Object.assign({param:a},c)}):s}return s});return Object.assign(Object.assign({},i),{transform:r})}return e}function vl(e,t){var n,i;const r=N(e);if(j(r)&&Mt(r.bin)&&(r.bin=Ol(r.bin)),gn(r)&&((i=(n=r.scale)===null||n===void 0?void 0:n.domain)===null||i===void 0?void 0:i.selection)){const s=r.scale.domain,{selection:o}=s,a=kt(s,["selection"]);r.scale.domain=Object.assign(Object.assign({},a),o?{param:o}:{})}if(Mi(r))if(Xo(r.condition))r.condition=r.condition.map(s=>{const{selection:o,param:a,test:c}=s,l=kt(s,["selection","param","test"]);return a?s:Object.assign(Object.assign({},l),{test:Vs(s,t)})});else{const s=vl(r.condition,t),{selection:o,param:a,test:c}=s,l=kt(s,["selection","param","test"]);r.condition=a?r.condition:Object.assign(Object.assign({},l),{test:Vs(r.condition,t)})}return r}function Ol(e){const t=e.extent;if(t==null?void 0:t.selection){const{selection:n}=t,i=kt(t,["selection"]);return Object.assign(Object.assign({},e),{extent:Object.assign(Object.assign({},i),{param:n})})}return e}function Vs(e,t){const n=i=>rn(i,r=>{var s,o,a;const c=(s=t.emptySelections[r])!==null&&s!==void 0?s:!0,l={param:r,empty:c};return(o=(a=t.selectionPredicates)[r])!==null&&o!==void 0||(a[r]=[]),t.selectionPredicates[r].push(l),l});return e.selection?n(e.selection):rn(e.test||e.filter,i=>i.selection?n(i.selection):i)}class Xs extends Bs{map(t,n){var i;const r=(i=n.selections)!==null&&i!==void 0?i:[];if(t.params&&!ct(t)){const s=[];for(const o of t.params)Ls(o)?r.push(o):s.push(o);t.params=s}return n.selections=r,super.map(t,xl(t,n))}mapUnit(t,n){var i;const r=n.selections;if(!r||!r.length)return t;const s=((i=n.path)!==null&&i!==void 0?i:[]).concat(t.name),o=[];for(const a of r)if(!a.views||!a.views.length)o.push(a);else for(const c of a.views)(mi(c)&&(c===t.name||s.indexOf(c)>=0)||Xo(c)&&c.map(l=>s.indexOf(l)).every((l,u,f)=>l!==-1&&(u===0||l>f[u-1])))&&o.push(a);return o.length&&(t.params=o),t}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=Xs.prototype[e];Xs.prototype[e]=function(n,i){return t.call(this,n,xl(n,i))}}function xl(e,t){var n;return e.name?Object.assign(Object.assign({},t),{path:((n=t.path)!==null&&n!==void 0?n:[]).concat(e.name)}):t}function _l(e,t){t===void 0&&(t=sl(e.config));const n=Em(e,t),{width:i,height:r}=e,s=km(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const Sm=new im,wm=new jm,$m=new Xs;function Em(e,t={}){const n={config:t};return $m.map(Sm.map(wm.map(e,n),n),n)}function jl(e){return C(e)?{type:e}:e??{}}function km(e,t,n){let{width:i,height:r}=t;const s=ct(e)||tr(e),o={};s?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(v(Sa("width")),i=void 0),r=="container"&&(v(Sa("height")),r=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?jl(n.autosize):{}),jl(e.autosize));return a.type==="fit"&&!s&&(v(wd),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&v(wa("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&v(wa("height")),Ae(a,{type:"pad"})?void 0:a}function Cm(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function Nm(e){return e?`fit-${wi(e)}`:"fit"}const Fm=["background","padding"];function Sl(e,t){const n={};for(const i of Fm)e&&e[i]!==void 0&&(n[i]=pe(e[i]));return t&&(n.params=e.params),n}class ut{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new ut(N(this.explicit),N(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return Y(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,{value:n,explicit:i}){n!==void 0&&this.set(t,n,i)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,{explicit:n,implicit:i}){n[t]!==void 0?this.set(t,n[t],!0):i[t]!==void 0&&this.set(t,i[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of y(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function ft(e){return{explicit:!0,value:e}}function me(e){return{explicit:!1,value:e}}function wl(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:nr(t,n,i,r)}}function nr(e,t,n,i){return e.explicit&&t.explicit&&v(lg(n,i,e.value,t.value)),e}function Ct(e,t,n,i,r=nr){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Ae(e.value,t.value)?e:r(e,t,n,i)}class Pm extends ut{constructor(t={},n={},i=!1){super(t,n);this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function Qn(e){return"url"in e}function ir(e){return"values"in e}function $l(e){return"name"in e&&!Qn(e)&&!ir(e)&&!Vt(e)}function Vt(e){return e&&(El(e)||kl(e)||Ys(e))}function El(e){return"sequence"in e}function kl(e){return"sphere"in e}function Ys(e){return"graticule"in e}var B;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(B||(B={}));var Am=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function bn(e,t=!0,n=hf){if(S(e)){const i=e.map(r=>bn(r,t,n));return t?`[${i.join(", ")}]`:i}else if(Bt(e))return n(t?Bn(e):Tg(e));return t?n(M(e)):e}function Tm(e,t){var n;for(const i of re((n=e.component.selection)!==null&&n!==void 0?n:{})){const r=i.name;let s=`${r}${Pt}, `+(i.resolve==="global"?"true":`{unit: ${vn(e)}}`);for(const o of cr){if(!o.defined(i))continue;o.signals&&(t=o.signals(e,i,t)),o.modifyExpr&&(s=o.modifyExpr(e,i,s))}t.push({name:r+gb,on:[{events:{signal:i.name+Pt},update:`modify(${R(i.name+Xt)}, ${s})`}]})}return Ks(t)}function Im(e,t){if(e.component.selection&&y(e.component.selection).length){const n=R(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:nn("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return Ks(t)}function Rm(e,t){var n;let i=!1;for(const r of re((n=e.component.selection)!==null&&n!==void 0?n:{})){const s=r.name,o=R(s+Xt),a=t.filter(c=>c.name===s);if(a.length===0){const c=r.resolve==="global"?"union":r.resolve,l=r.type==="point"?", true, true)":")";t.push({name:r.name,update:`${Ql}(${o}, ${R(c)}${l}`})}i=!0;for(const c of cr)c.defined(r)&&c.topLevelSignals&&(t=c.topLevelSignals(e,r,t))}if(i){const r=t.filter(s=>s.name==="unit");r.length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return Ks(t)}function zm(e,t){var n;const i=[...t];for(const r of re((n=e.component.selection)!==null&&n!==void 0?n:{})){const s={name:r.name+Xt};if(r.init){const a=r.project.items.map(c=>{const l=Am(c,["signals"]);return l});s.values=r.init.map(c=>({unit:vn(e,{escape:!1}),fields:a,values:bn(c,!1)}))}const o=i.filter(a=>a.name===r.name+Xt);o.length||i.push(s)}return i}function Cl(e,t){var n;for(const i of re((n=e.component.selection)!==null&&n!==void 0?n:{}))for(const r of cr)r.defined(i)&&r.marks&&(t=r.marks(e,i,t));return t}function Lm(e,t){for(const n of e.children)K(n)&&(t=Cl(n,t));return t}function Dm(e,t,n,i){const r=nu(e,t.param,t);return{signal:he(n.get("type"))&&S(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function Ks(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}class D{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.includes(t)){v(Ld);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const i of this._children)i.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class ce extends D{constructor(t,n,i,r){super(t,n);this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName=`clone_${this.debugName}`,t._source=this._source,t._name=`clone_${this._name}`,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${Jo()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}var Nl=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Ye extends D{constructor(t,n){super(t);this.formula=n}clone(){return new Ye(null,N(this.formula))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s)=>{const{field:o,timeUnit:a}=s;if(a){const c=_(s,{forAs:!0});r[I({as:c,field:o,timeUnit:a})]={as:c,field:o,timeUnit:a}}return r},{});return L(i)?null:new Ye(t,i)}static makeFromTransform(t,n){const i=Object.assign({},n),{timeUnit:r}=i,s=Nl(i,["timeUnit"]),o=oe(r),a=Object.assign(Object.assign({},s),{timeUnit:o});return new Ye(t,{[I(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)this.formula[n]||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of gt(this.formula))t.has(r.as)||(n[i]=r);this.formula=n}producedFields(){return new Set(re(this.formula).map(t=>t.as))}dependentFields(){return new Set(re(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${I(this.formula)}`}assemble(){const t=[];for(const n of re(this.formula)){const{field:i,as:r,timeUnit:s}=n,o=oe(s),{unit:a,utc:c}=o,l=Nl(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:ye(i),type:"timeunit"},a?{units:es(a)}:{}),c?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return t}}var Mm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Zn="_tuple_fields";class Um{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const Bm={defined:()=>!0,parse:(e,t,n)=>{var i;const r=t.name,s=(i=t.project)!==null&&i!==void 0?i:t.project=new Um,o={},a={},c=new Set,l=(h,m)=>{const x=m==="visual"?h.channel:h.field;let b=H(`${r}_${x}`);for(let O=1;c.has(b);O++)b=H(`${r}_${x}_${O}`);return c.add(b),{[m]:b}},u=t.type,f=e.config.selection[u],d=n.value!==void 0?V(n.value):null;let{fields:g,encodings:p}=W(n.select)?n.select:{};if(!g&&!p&&d)for(const h of d){if(!W(h))continue;for(const m of y(h))ed(m)?(p||(p=[])).push(m):u==="interval"?(v(Td),p=f.encodings):(g||(g=[])).push(m)}!g&&!p&&(p=f.encodings,g=f.fields);for(const h of p??[]){const m=e.fieldDef(h);if(m){let x=m.field;if(m.aggregate){v($d(h,m.aggregate));continue}else if(!x){v(Ea(h));continue}if(m.timeUnit){x=e.vgField(h);const b={timeUnit:m.timeUnit,as:x,field:m.field};a[I(b)]=b}if(!o[x]){let b="E";if(u==="interval"){const $=e.getScaleComponent(h).get("type");he($)&&(b="R")}else m.bin&&(b="R-RE");const O={field:x,channel:h,type:b};O.signals=Object.assign(Object.assign({},l(O,"data")),l(O,"visual")),s.items.push(o[x]=O),s.hasField[x]=s.hasChannel[h]=o[x]}}else v(Ea(h))}for(const h of g??[]){if(s.hasField[h])continue;const m={type:"E",field:h};m.signals=Object.assign({},l(m,"data")),s.items.push(m),s.hasField[h]=m}d&&(t.init=d.map(h=>s.items.map(m=>W(h)?h[m.channel]!==void 0?h[m.channel]:h[m.field]:h))),L(a)||(s.timeUnit=new Ye(null,a))},signals:(e,t,n)=>{const i=t.name+Zn,r=n.filter(s=>s.name===i);return r.length>0?n:n.concat({name:i,value:t.project.items.map(s=>{const o=Mm(s,["signals","hasLegend"]);return o.field=ye(o.field),o})})}},Nt={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!Ot(r))continue;const s=e.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!he(o)){v(Cd);continue}s.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||Zs(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let s=r.update;if(s.indexOf(Ql)>=0)r.update=`{${i.map(o=>`${R(ye(o.field))}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const a=`${R(ye(o.field))}: ${o.signals.data}`;s.includes(a)||(s=`${s.substring(0,s.length-1)}, ${a}}`)}r.update=s}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!Zs(e))for(const i of t.scales){const r=n.filter(s=>s.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function Qs(e,t){const n=R(e.scaleName(t));return`domain(${n})`}function Zs(e){var t;return e.parent&&$n(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:Zs(e.parent.parent))}var Wm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Jn="_brush",Js="_scale_trigger",Hm={defined:e=>e.type==="interval",signals:(e,t,n)=>{const i=t.name,r=i+Zn,s=Nt.defined(t),o=t.init?t.init[0]:null,a=[],c=[];if(t.translate&&!s){const u=`!event.item || event.item.mark.name !== ${R(i+Jn)}`;Fl(t,(f,d)=>{var g,p;const h=V((g=(p=d.between[0]).filter)!==null&&g!==void 0?g:p.filter=[]);return h.includes(u)||h.push(u),f})}t.project.items.forEach((u,f)=>{const d=u.channel;if(d!==G&&d!==Q){v("Interval selections only support x and y encoding channels.");return}const g=o?o[f]:null,p=qm(e,t,u,g),h=u.signals.data,m=u.signals.visual,x=R(e.scaleName(d)),b=e.getScaleComponent(d).get("type"),O=he(b)?"+":"";n.push(...p),a.push(h),c.push({scaleName:e.scaleName(d),expr:`(!isArray(${h}) || (${O}invert(${x}, ${m})[0] === ${O}${h}[0] && ${O}invert(${x}, ${m})[1] === ${O}${h}[1]))`})}),s||n.push({name:i+Js,value:{},on:[{events:c.map(u=>({scale:u.scaleName})),update:`${c.map(u=>u.expr).join(" && ")} ? ${i+Js} : {}`}]});const l=`unit: ${vn(e)}, fields: ${r}, values`;return n.concat(Object.assign(Object.assign({name:i+Pt},o?{init:`{${l}: ${bn(o)}}`}:{}),{on:[{events:[{signal:a.join(" || ")}],update:`${a.join(" && ")} ? {${l}: [${a}]} : null`}]}))},marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,o=r&&r.signals.visual,a=s&&s.signals.visual,c=`data(${R(t.name+Xt)})`;if(Nt.defined(t))return n;const l={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const m of y(l))l[m]=[Object.assign({test:`${c}.length && ${c}[0].unit === ${vn(e)}`},l[m]),{value:0}];const u=t.mark,{fill:f,fillOpacity:d,cursor:g}=u,p=Wm(u,["fill","fillOpacity","cursor"]),h=y(p).reduce((m,x)=>(m[x]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(b=>b).join(" && "),value:p[x]},{value:null}],m),{});return[{name:`${i+Jn}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:l}},...n,{name:i+Jn,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},g?{cursor:{value:g}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),h)}}]}};function qm(e,t,n,i){const r=n.channel,s=n.signals.visual,o=n.signals.data,a=Nt.defined(t),c=R(e.scaleName(r)),l=e.getScaleComponent(r),u=l?l.get("type"):void 0,f=h=>`scale(${c}, ${h})`,d=e.getSizeSignalRef(r===G?"width":"height").signal,g=`${r}(unit)`,p=Fl(t,(h,m)=>[...h,{events:m.between[0],update:`[${g}, ${g}]`},{events:m,update:`[${s}[0], clamp(${g}, 0, ${d})]`}]);return p.push({events:{signal:t.name+Js},update:he(u)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},i?{init:bn(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:bn(i)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${c}, ${s})`}]})]}function Fl(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(v(`${i} is not an ordered event stream for interval selections.`),n),[])}const Gm={defined:e=>e.type==="point",signals:(e,t,n)=>{const i=t.name,r=i+Zn,s=t.project,o="(item().isVoronoi ? datum.datum : datum)",a=s.items.map(u=>{const f=e.fieldDef(u.channel);return f&&f.bin?`[${o}[${R(e.vgField(u.channel,{}))}], ${o}[${R(e.vgField(u.channel,{binSuffix:"end"}))}]]`:`${o}[${R(u.field)}]`}).join(", "),c=`unit: ${vn(e)}, fields: ${r}, values`,l=t.events;return n.concat([{name:i+Pt,on:l?[{events:l,update:`datum && item().mark.marktype !== 'group' ? {${c}: [${a}]} : null`,force:!0}]:[]}])}};function yn(e,t,n,i){const r=Mi(t)&&t.condition,s=i(t);if(r){const o=V(r),a=o.map(c=>{const l=i(c);if(Ip(c)){const{param:u,empty:f}=c,d=tu(e,{param:u,empty:f});return Object.assign({test:d},l)}else{const u=lr(e,c.test);return Object.assign({test:u},l)}});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function eo(e,t="text"){const n=e.encoding[t];return yn(e,n,t,i=>rr(i,e.config))}function rr(e,t,n="datum"){if(e){if(ke(e))return q(e.value);if(k(e)){const{format:i,formatType:r}=Hi(e);return ys({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}return}function Pl(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,o=n.tooltip;if(S(o))return{tooltip:Tl({tooltip:o},s,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return yn(e,o,"tooltip",c=>{const l=rr(c,r,a);if(l)return l;if(c===null)return;let u=z("tooltip",i,r);return u===!0&&(u={content:"encoding"}),C(u)?{value:u}:W(u)?w(u)?u:u.content==="encoding"?Tl(n,s,r,t):{signal:a}:void 0})}}function Al(e,t,n,{reactiveGeom:i}={}){const r={},s=i?"datum.datum":"datum",o=[];function a(l,u){const f=Dt(u),d=xe(l)?l:Object.assign(Object.assign({},l),{type:e[f].type}),g=d.title||$s(d,n),p=V(g).join(", ");let h;if(Be(u)){const m=u==="x"?"x2":"y2",x=Ve(e[m]);if(se(d.bin)&&x){const b=_(d,{expr:s}),O=_(x,{expr:s}),{format:$,formatType:P}=Hi(d);h=zi(b,O,$,P,n),r[m]=!0}else if(t&&t.fieldChannel===u&&t.offset==="normalize"){const{format:b,formatType:O}=Hi(d);h=ys({fieldOrDatumDef:d,format:b,formatType:O,expr:s,config:n,normalizeStack:!0}).signal}}h??(h=rr(d,n,s).signal),o.push({channel:u,key:p,value:h})}Cs(e,(l,u)=>{j(l)?a(l,u):Ui(l)&&a(l.condition,u)});const c={};for(const{channel:l,key:u,value:f}of o)!r[l]&&!c[u]&&(c[u]=f);return c}function Tl(e,t,n,{reactiveGeom:i}={}){const r=Al(e,t,n,{reactiveGeom:i}),s=gt(r).map(([o,a])=>`"${o}": ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function Vm(e){const{markDef:t,config:n}=e,i=z("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),Xm(e)),Ym(e))}function Xm(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=z("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in jd?{}:{ariaRoleDescription:{value:t}}}function Ym(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return yn(e,s,"description",c=>rr(c,e.config));const o=z("description",n,i);if(o!=null)return{description:q(o)};if(i.aria===!1)return{};const a=Al(t,r,i);return L(a)?void 0:{description:{signal:gt(a).map(([c,l],u)=>`"${u>0?"; ":""}${c}: " + (${l})`).join(" + ")}}}function ee(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:c}=n;a===void 0&&(c??(c=z(e,i,s,{vgChannel:o,ignoreVgConfig:!0})),c!==void 0&&(a=q(c)));const l=r[e];return yn(t,l,o??e,u=>oc({channel:e,channelDef:u,markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function Il(e,t={filled:void 0}){var n,i,r,s;const{markDef:o,encoding:a,config:c}=e,{type:l}=o,u=(n=t.filled)!==null&&n!==void 0?n:z("filled",o,c),f=F(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,d=(r=(i=z(u===!0?"color":void 0,o,c,{vgChannel:"fill"}))!==null&&i!==void 0?i:c.mark[u===!0&&"color"])!==null&&r!==void 0?r:f,g=(s=z(u===!1?"color":void 0,o,c,{vgChannel:"stroke"}))!==null&&s!==void 0?s:c.mark[u===!1&&"color"],p=u?"fill":"stroke",h=Object.assign(Object.assign({},d?{fill:q(d)}:{}),g?{stroke:q(g)}:{});return o.color&&(u?o.fill:o.stroke)&&v(Aa("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},h),ee("color",e,{vgChannel:p,defaultValue:u?d:g})),ee("fill",e,{defaultValue:a.fill?d:void 0})),ee("stroke",e,{defaultValue:a.stroke?g:void 0}))}function Km(e){const{encoding:t,mark:n}=e,i=t.order;return!St(n)&&ke(i)?yn(e,i,"zindex",r=>q(r.value)):{}}function ei(e,t){const n=nd(e),i=t[n];return i||void 0}function ne(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:s,config:o,stack:a}=t,c=r[e],l=r[rt(e)],u=t.scaleName(e),f=t.getScaleComponent(e),d=ei(e,s),g=to({model:t,defaultPos:n,channel:e,scaleName:u,scale:f}),p=!c&&Be(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:Qm({channel:e,channelDef:c,channel2Def:l,markDef:s,config:o,scaleName:u,scale:f,stack:a,offset:d,defaultRef:g});return p?{[i||e]:p}:void 0}function Qm(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:s,markDef:o}=e;if(k(n)&&r&&t===r.fieldChannel){if(j(n)){let a=n.bandPosition;if(a===void 0&&o.type==="text"&&(t==="radius"||t==="theta")&&(a=.5),a!==void 0)return Ri({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:a,offset:s})}return Ht(n,i,{suffix:"end"},{offset:s})}return ms(e)}function to({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=e;return()=>{const a=Dt(n),c=yt(n),l=z(n,s,o,{vgChannel:c});if(l!==void 0)return qn(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const u=r.get("type");if(!F([Z.LOG,Z.TIME,Z.UTC],u)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const u=e[$e(n)];return Object.assign(Object.assign({},u),{mult:.5})}}return}}const Zm={left:"x",center:"xc",right:"x2"},Jm={top:"y",middle:"yc",bottom:"y2"};function Rl(e,t,n,i="middle"){if(e==="radius"||e==="theta")return yt(e);const r=e==="x"?"align":"baseline",s=z(r,t,n);let o;return w(s)?(v(Zd(r)),o=void 0):o=s,e==="x"?Zm[o||(i==="top"?"left":"center")]:Jm[o||i]}function sr(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?zl(e,t,{defaultPos:n,defaultPos2:i}):ne(e,t,{defaultPos:n})}function zl(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,o=rt(e),a=$e(e),c=eb(t,i,o),l=c[a]?Rl(e,r,s):yt(e);return Object.assign(Object.assign({},ne(e,t,{defaultPos:n,vgChannel:l})),c)}function eb(e,t,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=e,c=Dt(n),l=$e(n),u=yt(n),f=i[c],d=e.scaleName(c),g=e.getScaleComponent(c),p=n in i||n in s?ei(n,e.markDef):ei(c,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude))return{[u]:{field:e.getName(n)}};const h=tb({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:a,scaleName:d,scale:g,stack:o,offset:p,defaultRef:void 0});return h!==void 0?{[u]:h}:or(n,s)||or(n,{[n]:ki(n,s,a.style),[l]:ki(l,s,a.style)})||or(n,a[r])||or(n,a.mark)||{[u]:to({model:e,defaultPos:t,channel:n,scaleName:d,scale:g})()}}function tb({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l}){return k(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?Ht(t,s,{suffix:"start"},{offset:c}):ms({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:c,defaultRef:l})}function or(e,t){const n=$e(e),i=yt(e);if(t[i]!==void 0)return{[i]:qn(e,t[i])};if(t[e]!==void 0)return{[i]:qn(e,t[e])};if(t[n]){const r=t[n];if(dn(r))v(Gd(n));else return{[n]:qn(e,r)}}return}function Ft(e,t,n){var i,r,s,o;const{config:a,encoding:c,markDef:l}=e,u=rt(t),f=$e(t),d=c[t],g=c[u],p=e.getScaleComponent(t),h=p?p.get("type"):void 0,m=e.scaleName(t),x=l.orient,b=(r=(i=c[f])!==null&&i!==void 0?i:c.size)!==null&&r!==void 0?r:z("size",l,a,{vgChannel:f}),O=n==="bar"&&(t==="x"?x==="vertical":x==="horizontal");if(j(d)&&(U(d.bin)||se(d.bin)||d.timeUnit&&!g)&&!(b&&!dn(b))&&!te(h)){const $=vc({channel:t,fieldDef:d,markDef:l,config:a,scaleType:h}),P=(s=e.component.axes[t])===null||s===void 0?void 0:s[0],A=(o=P==null?void 0:P.get("translate"))!==null&&o!==void 0?o:.5;return rb({fieldDef:d,fieldDef2:g,channel:t,markDef:l,scaleName:m,bandSize:$,axisTranslate:A,spacing:Be(t)?z("binSpacing",l,a):void 0,reverse:p.get("reverse"),config:a})}else return(k(d)&&te(h)||O)&&!g?ib(n,d,t,e):zl(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function nb(e,t,n,i,r){if(dn(r))if(n){const o=n.get("type");if(o==="band")return{scale:t,band:r.band};r.band!==1&&(v(ng(o)),r=void 0)}else return{mult:r.band,field:{group:e}};else{if(w(r))return r;if(r)return{value:r}}if(n){const o=n.get("range");if(jt(o)&&X(o.step))return{value:o.step-2}}const s=er(i.view,e);return{value:s-2}}function ib(e,t,n,i){const{markDef:r,encoding:s,config:o,stack:a}=i,c=r.orient,l=i.scaleName(n),u=i.getScaleComponent(n),f=$e(n),d=rt(n),g=c==="horizontal"&&n==="y"||c==="vertical"&&n==="x";let p;(s.size||r.size)&&(g?p=ee("size",i,{vgChannel:f,defaultRef:q(r.size)}):v(og(r.type)));const h=vc({channel:n,fieldDef:t,markDef:r,config:o,scaleType:u==null?void 0:u.get("type"),useVlSizeChannel:g});p=p||{[f]:nb(f,l,u,o,h)};const m=(u==null?void 0:u.get("type"))!=="band"||!("band"in p[f])?"middle":"top",x=Rl(n,r,o,m),b=x==="xc"||x==="yc",O=ei(n,r),$=ms({channel:n,channelDef:t,markDef:r,config:o,scaleName:l,scale:u,stack:a,offset:O,defaultRef:to({model:i,defaultPos:"mid",channel:n,scaleName:l,scale:u}),bandPosition:b?.5:w(h)?{signal:`(1-${h})/2`}:dn(h)?(1-h.band)/2:0});if(f)return Object.assign({[x]:$},p);{const P=yt(d),A=p[f],E=O?Object.assign(Object.assign({},A),{offset:O}):A;return{[x]:$,[P]:S($)?[$[0],Object.assign(Object.assign({},$[1]),{offset:E})]:Object.assign(Object.assign({},$),{offset:E})}}}function ti(e,t,n,i,r){if(ia(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(w(n)||w(r)||w(i)){const o=at(n),a=at(r),c=at(i),l=c?`${c} + `:"",u=o?`(${o} ? -1 : 1) * `:"",f=a?`(${a} + ${s})`:s;return{signal:l+u+f}}else return r=r||0,i+(n?-r-s:+r+s)}function rb({fieldDef:e,fieldDef2:t,channel:n,bandSize:i,scaleName:r,markDef:s,spacing:o=0,axisTranslate:a,reverse:c,config:l}){const u=rt(n),f=yt(n),d=yt(u),g=ei(n,s),p=w(i)?{signal:`(1-${i.signal})/2`}:dn(i)?(1-i.band)/2:.5;if(U(e.bin)||e.timeUnit)return{[d]:Ll({channel:n,fieldDef:e,scaleName:r,markDef:s,bandPosition:p,offset:ti(u,o,c,a,g),config:l}),[f]:Ll({channel:n,fieldDef:e,scaleName:r,markDef:s,bandPosition:w(p)?{signal:`1-${p.signal}`}:1-p,offset:ti(n,o,c,a,g),config:l})};if(se(e.bin)){const h=Ht(e,r,{},{offset:ti(u,o,c,a,g)});if(j(t))return{[d]:h,[f]:Ht(t,r,{},{offset:ti(n,o,c,a,g)})};if(Mt(e.bin)&&e.bin.step)return{[d]:h,[f]:{signal:`scale("${r}", ${_(e,{expr:"datum"})} + ${e.bin.step})`,offset:ti(n,o,c,a,g)}}}v(La(u));return}function Ll({channel:e,fieldDef:t,scaleName:n,markDef:i,bandPosition:r,offset:s,config:o}){const a=Ri({scaleName:n,fieldOrDatumDef:t,bandPosition:r,offset:s});return sc({fieldDef:t,channel:e,markDef:i,ref:a,config:o})}const sb=new Set(["aria","width","height"]);function _e(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?Il(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ob(e.markDef,t)),Dl(e,"fill",n)),Dl(e,"stroke",i)),ee("opacity",e)),ee("fillOpacity",e)),ee("strokeOpacity",e)),ee("strokeWidth",e)),ee("strokeDash",e)),Km(e)),Pl(e)),eo(e,"href")),Vm(e))}function Dl(e,t,n){const{config:i,mark:r,markDef:s}=e,o=z("invalid",s,i);if(o==="hide"&&n&&!St(r)){const a=ab(e,{invalid:!0,channels:$i});if(a)return{[t]:[{test:a,value:null},...V(n)]}}return n?{[t]:n}:{}}function ob(e,t){return _d.reduce((n,i)=>(!sb.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=q(e[i])),n),{})}function ab(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const c=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&he(c)&&(s[l]=!0)}return s},{}),r=y(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>bs(o,t)).join(` ${s} `)}return}function no(e){const{config:t,markDef:n}=e,i=z("invalid",n,t);if(i){const r=cb(e,{channels:Ue});if(r)return{defined:{signal:r}}}return{}}function cb(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const c=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&he(c)&&(s[l]=!0)}return s},{}),r=y(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>bs(o,t)).join(` ${s} `)}return}function Ml(e,t){return t!==void 0?{[e]:q(t)}:void 0}const io="voronoi",Ul={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(io)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if(St(s))return v(Ed(s)),n;const o={name:e.getName(io),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},Pl(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,c=!1;return n.forEach((l,u)=>{var f;const d=(f=l.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?a=u:d.indexOf(io)>=0&&(c=!0)}),c||n.splice(a+1,0,o),n}},Bl={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!Rs(e.bind),parse:(e,t,n)=>Zl(t,n),topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,o=t.init&&t.init[0],a=Ul.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((c,l)=>{var u,f;const d=H(`${i}_${c.field}`),g=n.filter(p=>p.name===d);g.length||n.unshift(Object.assign(Object.assign({name:d},o?{init:bn(o[l])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${R(c.field)}] : null`}]:[],bind:(f=(u=s[c.field])!==null&&u!==void 0?u:s[c.channel])!==null&&f!==void 0?f:s}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.filter(l=>l.name===i+Pt)[0],o=i+Zn,a=r.items.map(l=>H(`${i}_${l.field}`)),c=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(s.update=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},ar="_toggle",Wl={defined:e=>e.type==="point"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+ar,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Pt,i=t.name+ar;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${vn(e)}}, `)+`${i} ? ${n} : null`}},lb={defined:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t)=>{t.clear&&(t.clear=C(t.clear)?nn(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if(Bl.defined(t))for(const i of t.project.items){const r=n.findIndex(s=>s.name===H(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const r of t.project.items){const s=n.findIndex(o=>o.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(s=>s.name===t.name+Pt);i(r,"null"),Wl.defined(t)&&(r=n.findIndex(s=>s.name===t.name+ar),i(r,"false"))}return n}},Hl={defined:e=>{const t=e.resolve==="global"&&e.bind&&Rs(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Yn;return t&&!n&&v(Nd),t&&n},parse:(e,t,n)=>{var i;const r=N(n);if(r.select=C(r.select)?{type:r.select,toggle:t.toggle}:Object.assign(Object.assign({},r.select),{toggle:t.toggle}),Zl(t,r),yf(n.select)&&(n.select.on||n.select.clear)){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const c of t.events)c.filter=V((i=c.filter)!==null&&i!==void 0?i:[]),c.filter.includes(a)||c.filter.push(a)}const s=zs(t.bind)?t.bind.legend:"click",o=C(s)?nn(s,"view"):V(s);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=zs(t.bind)&&t.bind.legend,s=o=>a=>{const c=N(a);return c.markname=o,c};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${H(o.field)}_legend`,c=`${i}_${a}`,l=n.filter(u=>u.name===c);if(l.length===0){const u=r.merge.map(s(`${a}_symbols`)).concat(r.merge.map(s(`${a}_labels`))).concat(r.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:c},t.init?{}:{value:null}),{on:[{events:u,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${c}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(d=>d.name===i+Pt),o=i+Zn,a=r.items.filter(d=>d.hasLegend).map(d=>H(`${i}_${H(d.field)}_legend`)),c=a.map(d=>`${d} !== null`).join(" && "),l=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const u=n.find(d=>d.name===i+ar),f=zs(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:f})):u.on[0].events=f),n}};function ub(e,t,n){var i,r,s,o;const a=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;for(const c of re((r=e.component.selection)!==null&&r!==void 0?r:{})){const l=(s=c.project.hasField[a])!==null&&s!==void 0?s:c.project.hasChannel[t];if(l&&Hl.defined(c)){const u=(o=n.get("selections"))!==null&&o!==void 0?o:[];u.push(c.name),n.set("selections",u,!1),l.hasLegend=!0}}}const ql="_translate_anchor",Gl="_translate_delta",fb={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Nt.defined(t),s=i+ql,{x:o,y:a}=t.project.hasChannel;let c=nn(t.translate,"scope");return r||(c=c.map(l=>(l.between[0].markname=i+Jn,l))),n.push({name:s,value:{},on:[{events:c.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?`, extent_x: ${r?Qs(e,G):`slice(${o.signals.visual})`}`:"")+(a!==void 0?`, extent_y: ${r?Qs(e,Q):`slice(${a.signals.visual})`}`:"")+"}"}]},{name:i+Gl,value:{},on:[{events:c,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&Vl(e,t,o,"width",n),a!==void 0&&Vl(e,t,a,"height",n),n}};function Vl(e,t,n,i,r){var s,o;const a=t.name,c=a+ql,l=a+Gl,u=n.channel,f=Nt.defined(t),d=r.filter(E=>E.name===n.signals[f?"data":"visual"])[0],g=e.getSizeSignalRef(i).signal,p=e.getScaleComponent(u),h=p.get("type"),m=p.get("reverse"),x=f?u===G?m?"":"-":m?"-":"":"",b=`${c}.extent_${u}`,O=`${x}${l}.${u} / ${f?`${g}`:`span(${b})`}`,$=f?h==="log"?"panLog":h==="symlog"?"panSymlog":h==="pow"?"panPow":"panLinear":"panLinear",P=f?h==="pow"?`, ${(s=p.get("exponent"))!==null&&s!==void 0?s:1}`:h==="symlog"?`, ${(o=p.get("constant"))!==null&&o!==void 0?o:1}`:"":"",A=`${$}(${b}, ${O}${P})`;d.on.push({events:{signal:l},update:f?A:`clampRange(${A}, 0, ${g})`})}const Xl="_zoom_anchor",Yl="_zoom_delta",db={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Nt.defined(t),s=i+Yl,{x:o,y:a}=t.project.hasChannel,c=R(e.scaleName(G)),l=R(e.scaleName(Q));let u=nn(t.zoom,"scope");return r||(u=u.map(f=>(f.markname=i+Jn,f))),n.push({name:i+Xl,on:[{events:u,update:r?"{"+[c?`x: invert(${c}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:u,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&Kl(e,t,o,"width",n),a!==void 0&&Kl(e,t,a,"height",n),n}};function Kl(e,t,n,i,r){var s,o;const a=t.name,c=n.channel,l=Nt.defined(t),u=r.filter($=>$.name===n.signals[l?"data":"visual"])[0],f=e.getSizeSignalRef(i).signal,d=e.getScaleComponent(c),g=d.get("type"),p=l?Qs(e,c):u.name,h=a+Yl,m=`${a}${Xl}.${c}`,x=l?g==="log"?"zoomLog":g==="symlog"?"zoomSymlog":g==="pow"?"zoomPow":"zoomLinear":"zoomLinear",b=l?g==="pow"?`, ${(s=d.get("exponent"))!==null&&s!==void 0?s:1}`:g==="symlog"?`, ${(o=d.get("constant"))!==null&&o!==void 0?o:1}`:"":"",O=`${x}(${p}, ${m}, ${h}${b})`;u.on.push({events:{signal:h},update:l?O:`clampRange(${O}, 0, ${f})`})}const Xt="_store",Pt="_tuple",gb="_modify",Ql="vlSelectionResolve",cr=[Gm,Hm,Bm,Wl,Bl,Nt,Hl,lb,fb,db,Ul];function pb(e){let t=e.parent;for(;t&&!Fe(t);)t=t.parent;return t}function vn(e,{escape:t}={escape:!0}){let n=t?R(e.name):e.name;const i=pb(e);if(i){const{facet:r}=i;for(const s of Oe)r[s]&&(n+=` + '__facet_${s}_' + (facet[${R(i.vgField(s))}])`)}return n}function ro(e){var t;return re((t=e.component.selection)!==null&&t!==void 0?t:{}).reduce((n,i)=>n||i.project.items.some(r=>r.field===Yn),!1)}function Zl(e,t){(mi(t.select)||!t.select.on)&&delete e.events,(mi(t.select)||!t.select.clear)&&delete e.clear,(mi(t.select)||!t.select.toggle)&&delete e.toggle}function so(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...so(e.object)),t.push(...so(e.property))),t)}function Jl(e){return e.object.type==="MemberExpression"?Jl(e.object):e.object.name==="datum"}function eu(e){const t=vf(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&Jl(i)&&n.add(so(i).slice(1).join("."))}),n}class On extends D{constructor(t,n,i){super(t);this.model=n,this.filter=i,this.expr=lr(this.model,this.filter,this),this._dependentFields=eu(this.expr)}clone(){return new On(null,this.model,N(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}var hb=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function mb(e,t){var n;const i={},r=e.config.selection;if(!t||!t.length)return i;for(const s of t){const o=H(s.name),a=s.select,c=C(a)?a:a.type,l=W(a)?N(a):{type:c},u=r[c],f=hb(u,["fields","encodings"]);for(const g in f)g==="mark"&&(l[g]=Object.assign(Object.assign({},f[g]),l[g])),(l[g]===void 0||l[g]===!0)&&(l[g]=(n=f[g])!==null&&n!==void 0?n:l[g]);const d=i[o]=Object.assign(Object.assign({},l),{name:o,type:c,init:s.value,bind:s.bind,events:C(l.on)?nn(l.on,"scope"):V(N(l.on))});for(const g of cr)g.defined(d)&&g.parse&&g.parse(e,d,s)}return i}function tu(e,t,n,i="datum"){const r=C(t)?t:t.param,s=H(r),o=R(s+Xt);let a;try{a=e.getSelectionComponent(s,r)}catch(u){return`!!${s}`}if(a.project.timeUnit){const u=n??e.component.data.raw,f=a.project.timeUnit.clone();u.parent?f.insertAsParentOf(u):u.parent=f}const c=`vlSelectionTest(${o}, ${i}`+(a.resolve==="global"?")":`, ${R(a.resolve)})`),l=`length(data(${o}))`;return t.empty===!1?`${l} && ${c}`:`!${l} || ${c}`}function nu(e,t,n){const i=H(t),r=n.encoding;let s=n.field,o;try{o=e.getSelectionComponent(i,t)}catch(a){return i}if(!r&&!s)s=o.project.items[0].field,o.project.items.length>1&&v(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${R(s)}.`);else if(r&&!s){const a=o.project.items.filter(c=>c.channel===r);!a.length||a.length>1?(s=o.project.items[0].field,v((a.length?"Multiple ":"No ")+`matching ${R(r)} encoding found for selection ${R(n.param)}. Using "field": ${R(s)}.`)):s=a[0].field}return`${o.name}[${R(ye(s))}]`}function bb(e,t){var n;for(const[i,r]of gt((n=e.component.selection)!==null&&n!==void 0?n:{})){const s=e.getName(`lookup_${i}`);e.component.data.outputNodes[s]=r.materialized=new ce(new On(t,e,{param:i}),s,B.Lookup,e.component.data.outputNodeRefCounts)}}function lr(e,t,n){return Tn(t,i=>C(i)?i:Bg(i)?tu(e,i,n):Ga(i))}var ur=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function yb(e,t){return e?S(e)&&!_t(e)?e.map(n=>$s(n,t)).join(", "):e:void 0}function oo(e,t,n,i){var r,s,o,a,c;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(s=(a=e.encode)[t])!==null&&s!==void 0||(a[t]={}),(o=(c=e.encode[t]).update)!==null&&o!==void 0||(c.update={}),e.encode[t].update[n]=i}function ni(e,t,n,i={header:!1}){var r,s;const o=e.combine(),{disable:a,orient:c,scale:l,labelExpr:u,title:f,zindex:d}=o,g=ur(o,["disable","orient","scale","labelExpr","title","zindex"]);if(a)return;for(const p in g){const h=Yp[p],m=g[p];if(h&&h!==t&&h!=="both")delete g[p];else if(Xn(m)){const{condition:x}=m,b=ur(m,["condition"]),O=V(x),$=kc[p];if($){const{vgProp:P,part:A}=$,E=[...O.map(T=>{const{test:be}=T,Pe=ur(T,["test"]);return Object.assign({test:lr(null,be)},Pe)}),b];oo(g,A,P,E),delete g[p]}else if($===null){const P={signal:O.map(A=>{const{test:E}=A,T=ur(A,["test"]);return`${lr(null,E)} ? ${ba(T)} : `}).join("")+ba(b)};g[p]=P}}else if(w(m)){const x=kc[p];if(x){const{vgProp:b,part:O}=x;oo(g,O,b,m),delete g[p]}}F(["labelAlign","labelBaseline"],p)&&g[p]===null&&delete g[p]}if(t==="grid"){if(!g.grid)return;if(g.encode){const{grid:p}=g.encode;g.encode=Object.assign({},p?{grid:p}:{}),L(g.encode)&&delete g.encode}return Object.assign(Object.assign({scale:l,orient:c},g),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:Y(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(u!==void 0){let h=u;((s=(r=g.encode)===null||r===void 0?void 0:r.labels)===null||s===void 0?void 0:s.update)&&w(g.encode.labels.update.text)&&(h=Rt(u,"datum.label",g.encode.labels.update.text.signal)),oo(g,"labels","text",{signal:h})}if(g.labelAlign===null&&delete g.labelAlign,g.encode){for(const h of Cc)e.hasAxisPart(h)||delete g.encode[h];L(g.encode)&&delete g.encode}const p=yb(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:c,grid:!1},p?{title:p}:{}),g),n.aria===!1?{aria:!1}:{}),{zindex:Y(d,0)})}}function iu(e){const{axes:t}=e.component,n=[];for(const i of Ue)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function vb(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>ni(r,"grid",t)),...i.map(r=>ni(r,"grid",t)),...n.map(r=>ni(r,"main",t)),...i.map(r=>ni(r,"main",t))].filter(r=>r)}function ru(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},c=new Set([...y(o),...y(a)]),l={};for(const u of c.values())l[u]={signal:`${i.signal} === "${s}" ? ${at(o[u])} : ${at(a[u])}`};return l}return t[r]})])}function Ob(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:Jg(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=w(n)?"axisOrient":`axis${In(n)}`,a=[...r,...r.map(l=>s+l.substr(4))],c=["axis",o,s];return{vlOnlyAxisConfig:ru(a,i,e,n),vgAxisConfig:ru(c,i,e,n),axisConfigStyle:xb([...c,...a],i)}}function xb(e,t){var n;const i=[{}];for(const r of e){let s=(n=t[r])===null||n===void 0?void 0:n.style;if(s){s=V(s);for(const o of s)i.push(t.style[o])}}return Object.assign.apply(null,i)}function ao(e,t,n,i={}){var r;const s=va(e,n,t);if(s!==void 0)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const su={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return lc(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return uc(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return(i=t.grid)!==null&&i!==void 0?i:_b(n,e)},gridScale:({model:e,channel:t})=>jb(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||au(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||ou(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:wb(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:$b(t.type,n,j(t)&&!!t.timeUnit,j(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var s;const o=e==="x"?"width":e==="y"?"height":void 0,a=o?t.getSizeSignalRef(o):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:kb({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=cu(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return xa(r?[bc(r)]:[],j(o)?[bc(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Cb(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:Nb(n,t)}};function _b(e,t){return!te(e)&&j(t)&&!U(t==null?void 0:t.bin)&&!se(t==null?void 0:t.bin)}function jb(e,t){const n=t==="x"?"y":"x";return e.getScaleComponent(n)?e.scaleName(n):void 0}function Sb(e,t,n,i,r){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return w(s)?s:Rn(s);{const{configValue:o}=ao("labelAngle",i,t==null?void 0:t.style,r);return o!==void 0?Rn(o):n===G&&F([us,ls],e.type)&&!(j(e)&&e.timeUnit)?270:void 0}}function co(e){return`(((${e.signal} % 360) + 360) % 360)`}function ou(e,t,n,i){if(e!==void 0)if(n==="x"){if(w(e)){const r=co(e),s=w(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(w(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(w(e)){const r=co(e),s=w(t)?`(${t.signal} === "left")`:t==="left",o=i?'"middle"':"null";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${o} : (45 <= ${r} && ${r} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(w(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}return}function au(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(w(e)){const o=co(e),a=w(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${r?`(${o} + 90)`:o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${a} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(w(t)){const o=r<e&&e<180+r?"===":"!==",a=`${t.signal} ${o} "${s}"`;return{signal:`${a} ? "left" : "right"`}}return(r<e&&e<180+r)===(t===s)?"left":"right"}function wb(e,t){return t==="x"&&F(["quantitative","temporal"],e)?!0:void 0}function $b(e,t,n,i){return n&&!W(i)||e!=="nominal"&&e!=="ordinal"?t==="log"||t==="symlog"?"greedy":!0:void 0}function Eb(e){return e==="x"?"bottom":"left"}function kb({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!te(t)&&t!=="log"){if(j(e)){if(U(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&F(["month","hours","day","quarter"],(r=oe(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}function cu(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;return s&&o?_a(s,o):s||(o||(s!==void 0?s:o!==void 0?o:void 0))}function Cb(e,t){const n=e.values;return S(n)?Ec(t,n):w(n)?n:void 0}function Nb(e,t){return e==="rect"&&Wi(t)?1:0}class xn extends D{constructor(t,n){super(t);this.transform=n,this._dependentFields=eu(this.transform.calculate)}clone(){return new xn(null,N(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(!gn(i))return;if(mc(i.sort)){const{field:s,timeUnit:o}=i,a=i.sort,c=a.map((l,u)=>`${Ga({field:s,timeUnit:o,equal:l})} ? ${u} : `).join("")+a.length;t=new xn(t,{calculate:c,as:_n(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${I(this.transform)}`}}function _n(e,t,n){return _(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function fr(e,t){return F(["top","bottom"],t)?"column":F(["left","right"],t)||e==="row"?"row":"column"}function jn(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return Y((t||{})[e],r[e],n.header[e])}function dr(e,t,n,i){const r={};for(const s of e){const o=jn(s,t||{},n,i);o!==void 0&&(r[s]=o)}return r}const lo=["row","column"],uo=["header","footer"];function Fb(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=dr(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),c=fr(t,a),l=Rn(o);return{name:`${t}-title`,type:"group",role:`${c}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),uu(l,c)),lu(c,l,s)),fu(i,r,t,yh,Xc))}}function lu(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=au(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function uu(e,t){const n=ou(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Pb(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of uo)if(n[r])for(const s of n[r]){const o=Tb(e,t,r,n,s);o!=null&&i.push(o)}return i}function Ab(e,t){var n;const{sort:i}=e;return qe(i)?{field:_(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:S(i)?{field:_n(e,t,{expr:"datum"}),order:"ascending"}:{field:_(e,{expr:"datum"}),order:i??"ascending"}}function fo(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:c}=dr(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=ys({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,u=fr(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:c?Rt(Rt(c,"datum.label",l),"datum.value",_(e,{expr:"parent"})):l}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),uu(s,u)),lu(u,s,o)),fu(n,e,t,vh,Yc))}function Tb(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=dr(["labelOrient"],o.header,a,t);(t==="row"&&!F(["top","bottom"],f)||t==="column"&&!F(["left","right"],f))&&(s=fo(o,t,a))}const c=Fe(e)&&!Gn(e.facet),l=r.axes,u=(l==null?void 0:l.length)>0;if(s||u){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(`${t}_domain`)},sort:Ab(o,t)}:{}),u&&c?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),u?{axes:l}:{})}}return null}const Ib={column:{start:0,end:1},row:{start:1,end:0}};function Rb(e,t){return Ib[t][e]}function zb(e,t){const n={};for(const i of Oe){const r=e[i];if(r==null?void 0:r.facetFieldDef){const{titleAnchor:s,titleOrient:o}=dr(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=fr(i,o),c=Rb(s,a);c!==void 0&&(n[a]=c)}}return L(n)?void 0:n}function fu(e,t,n,i,r){const s={};for(const o of i){if(!r[o])continue;const a=jn(o,t==null?void 0:t.header,e,n);a!==void 0&&(s[r[o]]=a)}return s}function go(e){return[...gr(e,"width"),...gr(e,"height"),...gr(e,"childWidth"),...gr(e,"childHeight")]}function gr(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(te(o)&&jt(a)){const c=e.scaleName(n);if(Fe(e.parent)){const l=e.parent.component.resolve;if(l.scale[n]==="independent")return[du(c,a)]}return[du(c,a),{name:r,update:gu(c,s,`domain('${c}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=Us(e.config.view,s?"width":"height"),c=`isFinite(${o}) ? ${o} : ${a}`;return[{name:r,init:c,on:[{update:c,events:"window:resize"}]}]}else return[{name:r,value:i}]}function du(e,t){return{name:`${e}_step`,value:t.step}}function gu(e,t,n){const i=t.get("type"),r=t.get("padding"),s=Y(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${at(o)}, ${at(s)}) * ${e}_step`}function pu(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function hu(e,t){return y(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),yn(t,r,i,s=>q(s.value)))},{})}function mu(e,t){if($n(t)||Fe(t))return"shared";if(Co(t))return Be(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function po(e,t){const n=e.scale[t],i=Be(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&v(fg(t)),"independent"):e[i][t]||"shared"}const Lb=Object.assign(Object.assign({},_h),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),bu=y(Lb);class Db extends ut{}const yu={symbols:Mb,gradient:Ub,labels:Bb,entries:Wb};function Mb(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){var o,a,c,l,u,f,d,g;if(s!=="symbol")return;const{markDef:p,encoding:h,config:m,mark:x}=n,b=p.filled&&x!=="trail";let O=Object.assign(Object.assign({},Sd({},n,vp)),Il(n,{filled:b}));const $=(o=r.get("symbolOpacity"))!==null&&o!==void 0?o:m.legend.symbolOpacity,P=(a=r.get("symbolFillColor"))!==null&&a!==void 0?a:m.legend.symbolFillColor,A=(c=r.get("symbolStrokeColor"))!==null&&c!==void 0?c:m.legend.symbolStrokeColor,E=$===void 0?(l=vu(h.opacity))!==null&&l!==void 0?l:p.opacity:void 0;if(O.fill){if(i==="fill"||b&&i===le)delete O.fill;else if(O.fill.field)P?delete O.fill:(O.fill=q((u=m.legend.symbolBaseFillColor)!==null&&u!==void 0?u:"black"),O.fillOpacity=q(E??1));else if(S(O.fill)){const T=(g=(d=ho((f=h.fill)!==null&&f!==void 0?f:h.color))!==null&&d!==void 0?d:p.fill)!==null&&g!==void 0?g:b&&p.color;T&&(O.fill=q(T))}}if(O.stroke){if(i==="stroke"||!b&&i===le)delete O.stroke;else if(O.stroke.field||A)delete O.stroke;else if(S(O.stroke)){const T=Y(ho(h.stroke||h.color),p.stroke,b?p.color:void 0);T&&(O.stroke={value:T})}}if(i!==it){const T=j(t)&&xu(n,r,t);T?O.opacity=[Object.assign({test:T},q(E??1)),q(m.legend.unselectedOpacity)]:E&&(O.opacity=q(E))}return O=Object.assign(Object.assign({},O),e),L(O)?void 0:O}function Ub(e,{model:t,legendType:n,legendCmpt:i}){var r;if(n!=="gradient")return;const{config:s,markDef:o,encoding:a}=t;let c={};const l=(r=i.get("gradientOpacity"))!==null&&r!==void 0?r:s.legend.gradientOpacity,u=l===void 0?vu(a.opacity)||o.opacity:void 0;return u&&(c.opacity=q(u)),c=Object.assign(Object.assign({},c),e),L(c)?void 0:c}function Bb(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=j(t)?xu(n,r,t):void 0,c=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:u}=s,f=qt(u)?vs({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:u,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},c?{opacity:c}:{}),f?{text:f}:{}),e);return L(d)?void 0:d}function Wb(e,{legendCmpt:t}){const n=t.get("selections");return(n==null?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function vu(e){return Ou(e,(t,n)=>Math.max(t,n.value))}function ho(e){return Ou(e,(t,n)=>Y(t,n.value))}function Ou(e,t){return zp(e)?V(e.condition).reduce(t,e.value):ke(e)?e.value:void 0}function xu(e,t,n){const i=t.get("selections");if(!(i==null?void 0:i.length))return;const r=R(n.field);return i.map(s=>{const o=R(H(s)+Xt);return`(!length(data(${o})) || (${s}[${r}] && indexof(${s}[${r}], datum.value) >= 0))`}).join(" || ")}const _u={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return lc(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return uc(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:Kb(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:Qb(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:qb(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>pn(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(cn(n)&&Ee(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>Hb(t,e)};function Hb(e,t){const n=e.values;return S(n)?Ec(t,n):w(n)?n:void 0}function qb(e,t,n,i){var r;if(t!=="shape"){const s=(r=ho(n))!==null&&r!==void 0?r:i;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function Gb(e){const{legend:t}=e;return Y(t.type,Vb(e))}function Vb({channel:e,timeUnit:t,scaleType:n}){if(cn(e)){if(F(["quarter","month","day"],t))return"symbol";if(Ee(n))return"gradient"}return"symbol"}function Xb({legendConfig:e,legendType:t,orient:n,legend:i}){var r,s;return(s=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:Yb(n,t)}function Yb(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function Kb({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:c}=e;return Ee(r)?n==="horizontal"?i==="top"||i==="bottom"?ju(t,"width",o,s):o:ju(t,"height",c,a):void 0}function ju(e,t,n,i){const r=e.getSizeSignalRef(t).signal;return{signal:`clamp(${r}, ${n}, ${i})`}}function Qb(e){return F(["quantile","threshold","log","symlog"],e)?"greedy":void 0}function Su(e){const t=K(e)?Zb(e):ny(e);return e.component.legends=t,t}function Zb(e){const{encoding:t}=e,n={};for(const i of[le,...Qc]){const r=J(t[i]);if(!r||!e.getScaleComponent(i))continue;if(i===ue&&j(r)&&r.type===fn)continue;n[i]=ty(e,i)}return n}function Jb(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function ey(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n==null?void 0:n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function ty(e,t){var n,i,r;let s=e.legend(t);const{markDef:o,encoding:a,config:c}=e,l=c.legend,u=new Db({},Jb(e,t));ub(e,t,u);const f=s!==void 0?!s:l.disable;if(u.set("disable",f,s!==void 0),f)return u;s=s||{};const d=e.getScaleComponent(t).get("type"),g=J(a[t]),p=j(g)?(n=oe(g.timeUnit))===null||n===void 0?void 0:n.unit:void 0,h=s.orient||c.legend.orient||"right",m=Gb({legend:s,channel:t,timeUnit:p,scaleType:d}),x=Xb({legend:s,legendType:m,orient:h,legendConfig:l}),b={legend:s,channel:t,model:e,markDef:o,encoding:a,fieldOrDatumDef:g,legendConfig:l,config:c,scaleType:d,orient:h,legendType:m,direction:x};for(const E of bu){if(m==="gradient"&&E.startsWith("symbol")||m==="symbol"&&E.startsWith("gradient"))continue;const T=E in _u?_u[E](b):s[E];if(T!==void 0){const be=ey(T,E,s,e.fieldDef(t));(be||c.legend[E]===void 0)&&u.set(E,T,be)}}const O=(i=s==null?void 0:s.encoding)!==null&&i!==void 0?i:{},$=u.get("selections"),P={},A={fieldOrDatumDef:g,model:e,channel:t,legendCmpt:u,legendType:m};for(const E of["labels","legend","title","symbols","gradient","entries"]){const T=hu((r=O[E])!==null&&r!==void 0?r:{},e),be=E in yu?yu[E](T,A):T;be!==void 0&&!L(be)&&(P[E]=Object.assign(Object.assign(Object.assign({},($==null?void 0:$.length)&&j(g)?{name:`${H(g.field)}_legend_${E}`}:{}),($==null?void 0:$.length)?{interactive:!!$}:{}),{update:be}))}return L(P)||u.set("encode",P,!!(s==null?void 0:s.encoding)),u}function ny(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){Su(i);for(const r of y(i.component.legends))n.legend[r]=po(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=wu(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of y(t))for(const r of e.children){if(!r.component.legends[i])continue;n.legend[i]==="shared"&&delete r.component.legends[i]}return t}function wu(e,t){var n,i,r,s;if(!e)return t.clone();const o=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let c=!1;for(const l of bu){const u=Ct(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,d)=>{switch(l){case"symbolType":return iy(f,d);case"title":return ja(f,d);case"type":return c=!0,me("symbol")}return nr(f,d,l,"legend")});e.setWithExplicit(l,u)}return c&&(((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient)&&yi(e.implicit,["encode","gradient"]),((s=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||s===void 0?void 0:s.gradient)&&yi(e.explicit,["encode","gradient"])),e}function iy(e,t){return t.value==="circle"?t:e}var ry=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function sy(e,t,n,i){var r,s,o,a,c;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(s=(a=e.encode)[t])!==null&&s!==void 0||(a[t]={}),(o=(c=e.encode[t]).update)!==null&&o!==void 0||(c.update={}),e.encode[t].update[n]=i}function $u(e){const t=e.component.legends,n={};for(const r of y(t)){const s=e.getScaleComponent(r),o=M(s.get("domains"));if(n[o])for(const a of n[o]){const c=wu(a,t[r]);c||n[o].push(t[r])}else n[o]=[t[r].clone()]}const i=re(n).flat().map(r=>oy(r,e.config)).filter(r=>r!==void 0);return i}function oy(e,t){var n,i,r;const s=e.combine(),{disable:o,labelExpr:a,selections:c}=s,l=ry(s,["disable","labelExpr","selections"]);if(o)return;if(t.aria===!1&&l.aria==null&&(l.aria=!1),(n=l.encode)===null||n===void 0?void 0:n.symbols){const u=l.encode.symbols.update;u.fill&&u.fill.value!=="transparent"&&!u.stroke&&!l.stroke&&(u.stroke={value:"transparent"});for(const f of Qc)l[f]&&delete u[f]}if(l.title||delete l.title,a!==void 0){let u=a;((r=(i=l.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&w(l.encode.labels.update.text)&&(u=Rt(a,"datum.label",l.encode.labels.update.text.signal)),sy(l,"labels","text",{signal:u})}return l}function ay(e){return $n(e)||Co(e)?cy(e):Eu(e)}function cy(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),Eu(e))}function Eu(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const c=w(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return F(o,c)||o.push(c),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const ly=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class ku extends ut{constructor(t,n,i,r){super(Object.assign({},n),{name:t});this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function Cu(e){e.component.projection=K(e)?uy(e):gy(e)}function uy(e){var t;if(e.hasProjection){const n=fe(e.specifiedProjection),i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=i?fy(e):void 0,o=new ku(e.projectionName(!0),Object.assign(Object.assign({},(t=fe(e.config.projection))!==null&&t!==void 0?t:{}),n??{}),r,s);return o.get("type")||o.set("type","equalEarth",!1),o}return}function fy(e){const t=[],{encoding:n}=e;for(const i of[[Le,ze],[ve,we]])(J(n[i[0]])||J(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(ue)&&e.typedFieldDef(ue).type===fn&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(B.Main)),t}function dy(e,t){const n=Ar(ly,r=>!en(e.explicit,r)&&!en(t.explicit,r)?!0:!!(en(e.explicit,r)&&en(t.explicit,r)&&Ae(e.get(r),t.get(r)))),i=Ae(e.size,t.size);if(i){if(n)return e;if(Ae(e.explicit,{}))return t;if(Ae(t.explicit,{}))return e}return null}function gy(e){if(e.children.length===0)return;let t;for(const i of e.children)Cu(i);const n=Ar(e.children,i=>{const r=i.component.projection;if(r)if(t){const s=dy(t,r);return s&&(t=s),!!s}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new ku(i,t.specifiedProjection,t.size,N(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),i),o.merged=!0)}return r}return}var py=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function hy(e,t,n,i){var r,s;if(Vn(t,n)){const o=K(e)?(s=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&s!==void 0?s:{}:{},a=_(t,{expr:"datum"}),c=_(t,{expr:"datum",binSuffix:"end"});return{formulaAs:_(t,{binSuffix:"range",forAs:!0}),formula:zi(a,c,o.format,o.formatType,i)}}return{}}function Nu(e,t){return`${da(e)}_${t}`}function my(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function mo(e,t,n){var i;const r=(i=Gi(n,void 0))!==null&&i!==void 0?i:{},s=Nu(r,t);return e.getName(`${s}_bins`)}function by(e){return"as"in e}function Fu(e,t,n){let i,r;by(e)?i=C(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[_(e,{forAs:!0}),_(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},Gi(t,void 0)),o=Nu(s,e.field),{signal:a,extentSignal:c}=my(n,o);if(Ei(s.extent)){const u=s.extent;r=nu(n,u.param,u),delete s.extent}const l=Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[i]},a?{signal:a}:{}),c?{extentSignal:c}:{}),r?{span:r}:{});return{key:o,binComponent:l}}class Ke extends D{constructor(t,n){super(t);this.bins=n}clone(){return new Ke(null,N(this.bins))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{if(xe(s)&&U(s.bin)){const{key:a,binComponent:c}=Fu(s,s.bin,n);r[a]=Object.assign(Object.assign(Object.assign({},c),r[a]),hy(n,s,o,n.config))}return r},{});return L(i)?null:new Ke(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:s}=Fu(n,n.bin,i);return new Ke(t,{[r]:s})}merge(t,n){for(const i of y(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=Te([...this.bins[i].as,...t.bins[i].as],I)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(re(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(re(this.bins).map(t=>t.field))}hash(){return`Bin ${I(this.bins)}`}assemble(){return re(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,s=t.bin,{extent:o}=s,a=py(s,["extent"]),c=Object.assign(Object.assign(Object.assign({type:"bin",field:ye(t.field),as:i,signal:t.signal},Ei(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(n.push({type:"extent",field:ye(t.field),signal:t.extentSignal}),c.extent={signal:t.extentSignal}),n.push(c);for(const l of r)for(let u=0;u<2;u++)n.push({type:"formula",expr:_({field:i[u]},{expr:"datum"}),as:l[u]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function yy(e,t,n,i){const r=K(i)?i.encoding[rt(t)]:void 0;if(xe(n)&&K(i)&&Oc(n,r,i.markDef,i.config))e.add(_(n,{})),e.add(_(n,{suffix:"end"})),n.bin&&Vn(n,t)&&e.add(_(n,{binSuffix:"range"}));else if(Yf(t)){const s=Xf(t);e.add(i.getName(s))}else e.add(_(n));return e}function vy(e,t){var n;for(const i of y(t)){const r=t[i];for(const s of y(r))i in e?e[i][s]=new Set([...(n=e[i][s])!==null&&n!==void 0?n:[],...r[s]]):e[i]={[s]:r[s]}}}class Ce extends D{constructor(t,n,i){super(t);this.dimensions=n,this.measures=i}clone(){return new Ce(null,new Set(this.dimensions),N(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(o=>{o.aggregate&&(i=!0)});const r={},s=new Set;return i?(n.forEachFieldDef((o,a)=>{var c,l,u,f;const{aggregate:d,field:g}=o;if(d)if(d==="count")(c=r["*"])!==null&&c!==void 0||(r["*"]={}),r["*"].count=new Set([_(o,{forAs:!0})]);else{if(st(d)||xt(d)){const p=st(d)?"argmin":"argmax",h=d[p];(l=r[h])!==null&&l!==void 0||(r[h]={}),r[h][p]=new Set([_({op:p,field:h},{forAs:!0})])}else(u=r[g])!==null&&u!==void 0||(r[g]={}),r[g][d]=new Set([_(o,{forAs:!0})]);Ot(a)&&n.scaleDomain(a)==="unaggregated"&&((f=r[g])!==null&&f!==void 0||(r[g]={}),r[g].min=new Set([_({field:g,aggregate:"min"},{forAs:!0})]),r[g].max=new Set([_({field:g,aggregate:"max"},{forAs:!0})]))}else yy(s,a,o,n)}),s.size+y(r).length===0?null:new Ce(t,s,r)):null}static makeFromTransform(t,n){var i,r,s;const o=new Set,a={};for(const c of n.aggregate){const{op:l,field:u,as:f}=c;l&&(l==="count"?((i=a["*"])!==null&&i!==void 0||(a["*"]={}),a["*"].count=new Set([f||_(c,{forAs:!0})])):((r=a[u])!==null&&r!==void 0||(a[u]={}),a[u][l]=new Set([f||_(c,{forAs:!0})])))}for(const c of(s=n.groupby)!==null&&s!==void 0?s:[])o.add(c);return o.size+y(a).length===0?null:new Ce(t,o,a)}merge(t){return Ko(this.dimensions,t.dimensions)?(vy(this.measures,t.measures),!0):(Eg("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...y(this.measures)])}producedFields(){const t=new Set;for(const n of y(this.measures))for(const i of y(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${I({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const s of y(this.measures))for(const o of y(this.measures[s]))for(const a of this.measures[s][o])i.push(a),t.push(o),n.push(s==="*"?null:ye(s));const r={type:"aggregate",groupby:[...this.dimensions].map(ye),ops:t,fields:n,as:i};return r}}class Sn extends D{constructor(t,n,i,r){super(t);this.model=n,this.name=i,this.data=r;for(const s of Oe){const o=n.facet[s];if(o){const{bin:a,sort:c}=o;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[_(o),...U(a)?[_(o,{binSuffix:"end"})]:[]]},qe(c)?{sortField:c}:S(c)?{sortIndexField:_n(o,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of Oe)this[n]&&(t+=` ${n.charAt(0)}:${I(this[n])}`);return t}get fields(){var t;const n=[];for(const i of Oe)((t=this[i])===null||t===void 0?void 0:t.fields)&&n.push(...this[i].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of Oe)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of Ue){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(te(r)&&jt(s)){const o=hr(this.childModel,n),a=$o(o);a?t[n]=a:v(Xr(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x",facet:void 0}[t],s=[],o=[],a=[];r&&i&&i[r]&&(n?(s.push(`distinct_${i[r]}`),o.push("max")):(s.push(i[r]),o.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:c,sortIndexField:l}=this[t];if(c){const{op:u=Li,field:f}=c;s.push(f),o.push(u),a.push(_(c,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var n,i;const{columns:r}=this.model.layout,{layoutHeaders:s}=this.model.component,o=[],a={};for(const u of lo){for(const f of uo){const d=(n=s[u]&&s[u][f])!==null&&n!==void 0?n:[];for(const g of d)if(((i=g.axes)===null||i===void 0?void 0:i.length)>0){a[u]=!0;break}}if(a[u]){const f=`length(data("${this.facet.name}"))`,d=u==="row"?r?{signal:`ceil(${f} / ${r})`}:1:r?{signal:`min(${f}, ${r})`}:{signal:f};o.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:d}]})}}const{row:c,column:l}=a;return(c||l)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,n;const i=[];let r=null;const s=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:c}=this;if(o&&a&&(s.x||s.y)){r=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),u=l.map(()=>"distinct");i.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:u}]})}for(const l of[Je,Ze])this[l]&&i.push(this.assembleRowColumnHeaderData(l,r,s));if(c){const l=this.assembleFacetHeaderData(s);l&&i.push(...l)}return i}}function Pu(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function Oy(e,t){const n=zr(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.startsWith("date:")){const i=Pu(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.startsWith("utc:")){const i=Pu(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return v(zd(t)),null}function xy(e){const t={};return bi(e.filter,n=>{var i;if(qa(n)){let r=null;ts(n)?r=pe(n.equal):is(n)?r=pe(n.lte):ns(n)?r=pe(n.lt):rs(n)?r=pe(n.gt):ss(n)?r=pe(n.gte):os(n)?r=n.range[0]:as(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(Bt(r)?t[n.field]="date":X(r)?t[n.field]="number":C(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function _y(e){const t={};function n(i){mn(i)?t[i.field]="date":i.type==="quantitative"&&pd(i.aggregate)?t[i.field]="number":an(i.field)>1?i.field in t||(t[i.field]="flatten"):gn(i)&&qe(i.sort)&&an(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((K(e)||Fe(e))&&e.forEachFieldDef((i,r)=>{if(xe(i))n(i);else{const s=Dt(r),o=e.fieldDef(s);n(Object.assign(Object.assign({},i),{type:o.type}))}}),K(e)){const{mark:i,markDef:r,encoding:s}=e;if(St(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",a=s[o];j(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function jy(e){const t={};if(K(e)&&e.component.selection)for(const n of y(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&an(r.field)>1&&(t[r.field]="flatten")}return t}class ie extends D{constructor(t,n){super(t);this._parse=n}clone(){return new ie(null,N(this._parse))}hash(){return`Parse ${I(this._parse)}`}static makeExplicit(t,n,i){let r={};const s=n.data;return!Vt(s)&&s&&s.format&&s.format.parse&&(r=s.format.parse),this.makeWithAncestors(t,r,{},i)}static makeWithAncestors(t,n,i,r){for(const a of y(i)){const c=r.getWithExplicit(a);c.value!==void 0&&(c.explicit||c.value===i[a]||c.value==="derived"||i[a]==="flatten"?delete i[a]:v(Na(a,i[a],c.value)))}for(const a of y(n)){const c=r.get(a);c!==void 0&&(c===n[a]?delete n[a]:v(Na(a,n[a],c)))}const s=new ut(n,i);r.copyAll(s);const o={};for(const a of y(s.combine())){const c=s.get(a);c!==null&&(o[a]=c)}return y(o).length===0||r.parseNothing?null:new ie(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of y(this._parse)){const i=this._parse[n];an(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(y(this._parse))}dependentFields(){return new Set(y(this._parse))}assembleTransforms(t=!1){return y(this._parse).filter(n=>t?an(n)>1:!0).map(n=>{const i=Oy(n,this._parse[n]);if(!i)return null;const r={type:"formula",expr:i,as:Lr(n)};return r}).filter(n=>n!==null)}}class At extends D{clone(){return new At(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([Yn])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Yn}}}class ii extends D{constructor(t,n){super(t);this.params=n}clone(){return new ii(null,this.params)}dependentFields(){return new Set}producedFields(){return}hash(){return`Graticule ${I(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class ri extends D{constructor(t,n){super(t);this.params=n}clone(){return new ri(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${I(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class Yt extends D{constructor(t){super(null);t??(t={name:"source"});let n;if(Vt(t)||(n=t.format?Object.assign({},ge(t.format,["parse"])):{}),ir(t))this._data={values:t.values};else if(Qn(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];F(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else kl(t)?this._data={values:[{type:"Sphere"}]}:($l(t)||Vt(t))&&(this._data={});this._generator=Vt(t),t.name&&(this._name=t.name),n&&!L(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){return}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var Au=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},Sy=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},si;function bo(e){return e instanceof Yt||e instanceof ii||e instanceof ri}class yo{constructor(){si.set(this,void 0),Au(this,si,!1)}setModified(){Au(this,si,!0)}get modifiedFlag(){return Sy(this,si)}}si=new WeakMap;class Kt extends yo{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const n=this.getNodeDepths(t,0,new Map),i=[...n.entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class vo extends yo{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class wy extends vo{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of y(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class $y extends vo{constructor(t){super();this.requiresSelectionId=t&&ro(t)}run(t){t instanceof At&&(this.requiresSelectionId&&(bo(t.parent)||t.parent instanceof Ce||t.parent instanceof ie)||(this.setModified(),t.remove()))}}class Ey extends yo{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof Ye&&(i=t.producedFields(),Tr(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class ky extends vo{constructor(){super()}run(t){t instanceof ce&&!t.isRequired()&&(this.setModified(),t.remove())}}class Cy extends Kt{run(t){if(bo(t))return;if(t.numChildren()>1)return;for(const n of t.children)if(n instanceof ie)if(t instanceof ie)this.setModified(),t.merge(n);else{if(Rr(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}return}}class Ny extends Kt{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof ie);if(t.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const o of i){const a=o.parse;for(const c of y(a))c in r?r[c]!==a[c]&&s.add(c):r[c]=a[c]}for(const o of s)delete r[o];if(!L(r)){this.setModified();const o=new ie(t,r);for(const a of n){if(a instanceof ie)for(const c of y(r))delete a.parse[c];t.removeChild(a),a.parent=o,a instanceof ie&&y(a.parse).length===0&&a.remove()}}}}}class Fy extends Kt{run(t){t instanceof ce||t.numChildren()>0||t instanceof Sn||(t instanceof Yt||(this.setModified(),t.remove()))}}class Py extends Kt{run(t){const n=t.children.filter(r=>r instanceof Ye),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class Ay extends Kt{run(t){const n=t.children.filter(r=>r instanceof Ce),i={};for(const r of n){const s=I(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of y(i)){const s=i[r];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(t.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class Ty extends Kt{constructor(t){super();this.model=t}run(t){const n=!(bo(t)||t instanceof On||t instanceof ie||t instanceof At),i=[],r=[];for(const s of t.children)s instanceof Ke&&(n&&!Rr(t.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof Ke?t.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class Iy extends Kt{run(t){const n=[...t.children],i=on(n,o=>o instanceof ce);if(!i||t.numChildren()<=1)return;const r=[];let s;for(const o of n)if(o instanceof ce){let a=o;for(;a.numChildren()===1;){const[c]=a.children;if(c instanceof ce)a=c;else break}r.push(...a.children),s?(t.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else r.push(o);if(r.length){this.setModified();for(const o of r)o.parent.removeChild(o),o.parent=s}}}class Qt extends D{constructor(t,n){super(t);this.transform=n}clone(){return new Qt(null,N(this.transform))}addDimensions(t){this.transform.groupby=Te(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:_(t)}hash(){return`JoinAggregateTransform ${I(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},r!==void 0?{groupby:r}:{})}}function Ry(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=_(i);return r&&t.push(r),t},[])}function zy(e){return S(e)&&e.every(t=>C(t))&&e.length>1}class dt extends D{constructor(t,n){super(t);this._stack=n}clone(){return new dt(null,N(this._stack))}static makeFromTransform(t,n){const{stack:i,groupby:r,as:s,offset:o="zero"}=n,a=[],c=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),c.push(Y(f.order,"ascending"));const l={field:a,order:c};let u;return zy(s)?u=s:C(s)?u=[s,`${s}_end`]:u=[`${n.stack}_start`,`${n.stack}_end`],new dt(t,{stackField:i,groupby:r,offset:o,sort:l,facetby:[],as:u})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannel:s,fieldChannel:o,offset:a,impute:c}=i;let l;if(s){const g=r[s];l=Ve(g)}const u=Ry(n),f=n.encoding.order;let d;return S(f)||j(f)?d=Oa(f):d=u.reduce((g,p)=>(g.field.push(p),g.order.push(o==="y"?"descending":"ascending"),g),{field:[],order:[]}),new dt(t,{dimensionFieldDef:l,stackField:n.vgField(o),facetby:[],stackby:u,sort:d,offset:a,impute:c,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${I(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:i}=this._stack;return t?t.bin?n?[_(t,{binSuffix:"mid"})]:[_(t,{}),_(t,{binSuffix:"end"})]:[_(t)]:i??[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:i,stackField:r,stackby:s,sort:o,offset:a,impute:c,as:l}=this._stack;if(c&&i){const{bandPosition:u=.5,bin:f}=i;f&&t.push({type:"formula",expr:`${u}*`+_(i,{expr:"datum"})+`+${1-u}*`+_(i,{expr:"datum",binSuffix:"end"}),as:_(i,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:r,groupby:[...s,...n],key:_(i,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:o,as:l,offset:a}),t}}class wn extends D{constructor(t,n){super(t);this.transform=n}clone(){return new wn(null,N(this.transform))}addDimensions(t){this.transform.groupby=Te(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const i=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(i.add,i),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(r=>i.add(r.field)),this.transform.window.map(r=>r.field).filter(r=>r!==void 0).forEach(i.add,i),i}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:_(t)}hash(){return`WindowTransform ${I(this.transform)}`}assemble(){var t;const n=[],i=[],r=[],s=[];for(const d of this.transform.window)i.push(d.op),r.push(this.getDefaultName(d)),s.push(d.param===void 0?null:d.param),n.push(d.field===void 0?null:d.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&i.every(d=>Hr(d)))return Object.assign({type:"joinaggregate",as:r,ops:i,fields:n},a!==void 0?{groupby:a}:{});const c=[],l=[];if(this.transform.sort!==void 0)for(const d of this.transform.sort)c.push(d.field),l.push((t=d.order)!==null&&t!==void 0?t:"ascending");const u={field:c,order:l},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:r,ops:i,fields:n,sort:u},f!==void 0?{ignorePeers:f}:{}),a!==void 0?{groupby:a}:{}),o!==void 0?{frame:o}:{})}}function Ly(e){function t(n){if(!(n instanceof Sn)){const i=n.clone();if(i instanceof ce){const r=xo+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof Ce||i instanceof dt||i instanceof wn||i instanceof Qt)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function Oo(e){if(e instanceof Sn)if(e.numChildren()===1&&!(e.children[0]instanceof ce)){const t=e.children[0];(t instanceof Ce||t instanceof dt||t instanceof wn||t instanceof Qt)&&t.addDimensions(e.fields),t.swapWithParent(),Oo(e)}else{const t=e.model.component.data.main;Tu(t);const n=Ly(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(Oo)}function Tu(e){if(e instanceof ce&&e.type===B.Main&&e.numChildren()===1){const t=e.children[0];t instanceof Sn||(t.swapWithParent(),Tu(e))}}const xo="scale_",pr=5;function _o(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!_o(t.children))return!1}return!0}function Ne(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function Iu(e,t,n){let i=e.sources,r=!1;return r=Ne(new ky,i)||r,r=Ne(new $y(t),i)||r,i=i.filter(s=>s.numChildren()>0),r=Ne(new Fy,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=Ne(new Cy,i)||r,r=Ne(new Ty(t),i)||r,r=Ne(new Ey,i)||r,r=Ne(new Ny,i)||r,r=Ne(new Ay,i)||r,r=Ne(new Py,i)||r,r=Ne(new wy,i)||r,r=Ne(new Iy,i)||r),e.sources=i,r}function Dy(e,t){_o(e.sources);let n=0,i=0;for(let r=0;r<pr&&Iu(e,t,!0);r++)n++;e.sources.map(Oo);for(let r=0;r<pr&&Iu(e,t,!1);r++)i++;_o(e.sources),Math.max(n,i)===pr&&v(`Maximum optimization runs(${pr}) reached.`)}class de{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new de(()=>t(n))}}var My=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Ru(e){K(e)?Uy(e):By(e)}function Uy(e){const t=e.component.scales;for(const n of y(t)){const i=Hy(e,n),r=t[n];if(r.setWithExplicit("domains",i),Gy(e,n),e.component.data.isFaceted){let s=e;for(;!Fe(s)&&s.parent;)s=s.parent;const o=s.component.resolve.scale[n];if(o==="shared")for(const a of i.value)ot(a)&&(a.data=xo+a.data.replace(xo,""))}}}function By(e){for(const n of e.children)Ru(n);const t=e.component.scales;for(const n of y(t)){let i,r=null;for(const s of e.children){const o=s.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=Ct(i,o.getWithExplicit("domains"),"domains","scale",wo);const a=o.get("selectionExtent");r&&a&&r.param!==a.param&&v(Ad),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function Wy(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:s}=zu(t,n);if(!r){v(s);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=zu(t,n);if(r)return"unaggregated"}return e}function Hy(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=Wy(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&J(i.x2)?J(i.x)?Ct(Tt(n,r,e,"x"),Tt(n,r,e,"x2"),"domain","scale",wo):Tt(n,r,e,"x2"):t==="y"&&J(i.y2)?J(i.y)?Ct(Tt(n,r,e,"y"),Tt(n,r,e,"y2"),"domain","scale",wo):Tt(n,r,e,"y2"):Tt(n,r,e,t)}function qy(e,t,n){return e.map(i=>{const r=Vi(i,{timeUnit:n,type:t});return{signal:`{data: ${r}}`}})}function jo(e,t,n){var i;const r=(i=oe(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?qy(e,t,r):[e]}function Tt(e,t,n,i){const{encoding:r}=n,s=J(r[i]),{type:o}=s,a=s.timeUnit;if(cp(t)){const f=Tt(e,void 0,n,i),d=jo(t.unionWith,o,a);return ft([...f.value,...d])}else{if(w(t))return ft([t]);if(t&&t!=="unaggregated"&&!Ya(t))return ft(jo(t,o,a))}const c=n.stack;if(c&&i===c.fieldChannel){if(c.offset==="normalize")return me([[0,1]]);const f=n.requestDataName(B.Main);return me([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const l=Ot(i)&&j(s)?Vy(n,i,e):void 0;if($t(s)){const f=jo([s.datum],o,a);return me(f)}const u=s;if(t==="unaggregated"){const f=n.requestDataName(B.Main),{field:d}=s;return me([{data:f,field:_({field:d,aggregate:"min"})},{data:f,field:_({field:d,aggregate:"max"})}])}else if(U(u.bin)){if(te(e))return e==="bin-ordinal"?me([]):me([{data:An(l)?n.requestDataName(B.Main):n.requestDataName(B.Raw),field:n.vgField(i,Vn(u,i)?{binSuffix:"range"}:{}),sort:l===!0||!W(l)?{field:n.vgField(i,{}),op:"min"}:l}]);{const{bin:f}=u;if(U(f)){const d=mo(n,u.field,f);return me([new de(()=>{const g=n.getSignalName(d);return`[${g}.start, ${g}.stop]`})])}else return me([{data:n.requestDataName(B.Main),field:n.vgField(i,{})}])}}else if(u.timeUnit&&F(["time","utc"],e)&&Oc(u,K(n)?n.encoding[rt(i)]:void 0,n.markDef,n.config)){const f=n.requestDataName(B.Main);return me([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return me(l?[{data:An(l)?n.requestDataName(B.Main):n.requestDataName(B.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(B.Main),field:n.vgField(i)}])}function So(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n??(t?"sum":Li)},i?{field:ye(i)}:{}),r?{order:r}:{})}function Gy(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=Ya(r)&&r,a=Mt(s)&&Ei(s.extent)&&s.extent;(o||a)&&i.set("selectionExtent",o??a,!0)}function Vy(e,t,n){if(!te(n))return;const i=e.fieldDef(t),r=i.sort;if(mc(r))return{op:"min",field:_n(i,t),order:"ascending"};const{stack:s}=e,o=s?[...s.groupbyField?[s.groupbyField]:[],...s.stackBy.map(a=>a.fieldDef.field)]:void 0;if(qe(r)){const a=s&&!F(o,r.field);return So(r,a)}else if(hc(r)){const{encoding:a,order:c}=r,l=e.fieldDef(a),{aggregate:u,field:f}=l,d=s&&!F(o,f);if(st(u)||xt(u))return So({field:_(l),order:c},d);if(Hr(u)||!u)return So({op:u,field:f,order:c},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(F(["ascending",void 0],r))return!0}return}function zu(e,t){const{aggregate:n,type:i}=e;return n?C(n)&&!bd[n]?{valid:!1,reason:rg(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:sg(e)}:{valid:!0}:{valid:!1,reason:ig(e)}}function wo(e,t,n,i){return e.explicit&&t.explicit&&v(ug(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function Xy(e){const t=Te(e.map(o=>{if(ot(o)){const a=My(o,["sort"]);return a}return o}),I),n=Te(e.map(o=>{if(ot(o)){const a=o.sort;return a!==void 0&&!An(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}return}).filter(o=>o!==void 0),I);if(t.length===0)return;if(t.length===1){const o=e[0];if(ot(o)&&n.length>0){let a=n[0];if(n.length>1)v(Ra),a=!0;else if(W(a)&&"field"in a){const c=a.field;o.field===c&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},o),{sort:a})}return o}const i=Te(n.map(o=>An(o)||!("op"in o)||C(o.op)&&o.op in dd?o:(v(dg(o)),!0)),I);let r;i.length===1?r=i[0]:i.length>1&&(v(Ra),r=!0);const s=Te(e.map(o=>ot(o)?o.data:null),o=>o);if(s.length===1&&s[0]!==null){const o=Object.assign({data:s[0],fields:t.map(a=>a.field)},r?{sort:r}:{});return o}return Object.assign({fields:t},r?{sort:r}:{})}function $o(e){if(ot(e)&&C(e.field))return e.field;if(vd(e)){let t;for(const n of e.fields)if(ot(n)&&C(n.field)){if(!t)t=n.field;else if(t!==n.field)return v(gg),t}return v(pg),t}else if(Od(e)){v(hg);const t=e.fields[0];return C(t)?t:void 0}return}function hr(e,t){const n=e.component.scales[t],i=n.get("domains").map(r=>(ot(r)&&(r.data=e.lookupDataSource(r.data)),r));return Xy(i)}var Yy=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Lu(e){return $n(e)||Co(e)?e.children.reduce((t,n)=>t.concat(Lu(n)),Du(e)):Du(e)}function Du(e){return y(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:c,range:l,reverse:u}=r,f=Yy(r,["name","type","selectionExtent","domains","range","reverse"]),d=Ky(r.range,s,n,e),g=hr(e,n),p=a?Dm(e,a,i,g):null;return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},g?{domain:g}:{}),p?{domainRaw:p}:{}),{range:d}),u!==void 0?{reverse:u}:{}),f)),t},[])}function Ky(e,t,n,i){if(Be(n)){if(jt(e))return{step:{signal:`${t}_step`}}}else if(W(e)&&ot(e))return Object.assign(Object.assign({},e),{data:i.lookupDataSource(e.data)});return e}class Mu extends ut{constructor(t,n){super({},{name:t});this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:on(this.get("domains"),t=>S(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const Qy=["range","scheme"];function Uu(e){return e==="x"?"width":e==="y"?"height":void 0}function Zy(e){const t=e.component.scales;for(const n of $i){const i=t[n];if(!i)continue;const r=Jy(n,e);i.setWithExplicit("range",r)}}function Bu(e,t){const n=e.fieldDef(t);if(n==null?void 0:n.bin){const{bin:i,field:r}=n,s=Uu(t),o=e.getName(s);if(W(i)&&i.binned&&i.step!==void 0)return new de(()=>{const a=e.scaleName(t),c=`(domain("${a}")[1] - domain("${a}")[0]) / ${i.step}`;return`${e.getSignalName(o)} / (${c})`});if(U(i)){const a=mo(e,r,i);return new de(()=>{const c=e.getSignalName(a),l=`(${c}.stop - ${c}.start) / ${c}.step`;return`${e.getSignalName(o)} / (${l})`})}}return}function Jy(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e),s=r.get("type");for(const l of Qy)if(n[l]!==void 0){const u=ds(s,l),f=Ka(e,l);if(!u)v(Ta(s,l,e));else if(f)v(f);else switch(l){case"range":{const d=n.range;if(S(d)){if(Be(e))return ft(d.map(g=>{if(g==="width"||g==="height"){const p=t.getName(g),h=t.getSignalName.bind(t);return de.fromName(h,p)}return g}))}else if(W(d))return ft({data:t.requestDataName(B.Main),field:d.field,sort:{op:"min",field:t.vgField(e)}});return ft(d)}case"scheme":return ft(ev(n[l]))}}if(e===G||e===Q){const l=e===G?"width":"height",u=i[l];if(Xe(u)){if(te(s))return ft({step:u.step});v(Ia(l))}}const{rangeMin:o,rangeMax:a}=n,c=tv(e,t);return(o!==void 0||a!==void 0)&&ds(s,"rangeMin")&&S(c)&&c.length===2?ft([o??c[0],a??c[1]]):me(c)}function ev(e){return ap(e)?Object.assign({scheme:e.name},ge(e,["name"])):{scheme:e}}function tv(e,t){const{size:n,config:i,mark:r,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=J(s[e]),c=t.getScaleComponent(e),l=c.get("type"),{domain:u,domainMid:f}=t.specifiedScales[e];switch(e){case G:case Q:{if(F(["point","band"],l)){if(e===G&&!n.width){const p=Kn(i.view,"width");if(Xe(p))return p}else if(e===Q&&!n.height){const p=Kn(i.view,"height");if(Xe(p))return p}}const d=Uu(e),g=t.getName(d);return e===Q&&he(l)?[de.fromName(o,g),0]:[0,de.fromName(o,g)]}case nt:{const d=t.component.scales[e].get("zero"),g=Wu(r,d,i),p=rv(r,n,t,i);return Hn(l)?iv(g,p,nv(l,i,u,e)):[g,p]}case Se:return[0,Math.PI*2];case zt:return[0,360];case Re:return[0,new de(()=>{const d=t.getSignalName("width"),g=t.getSignalName("height");return`min(${d},${g})/2`})];case mt:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case bt:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case ue:return"symbol";case le:case De:case Me:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case it:case pt:case ht:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function nv(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&S(n)?n.length+1:(v(Sg(i)),3)}}function iv(e,t,n){const i=()=>{const r=at(t),s=at(e),o=`(${r} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${r} + ${o}, ${o})`};return w(t)?new de(i):{signal:i()}}function Wu(e,t,n){if(t)return w(t)?{signal:`${t.signal} ? 0 : ${Wu(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Ci("size",e))}const Hu=.95;function rv(e,t,n,i){const r={x:Bu(n,"x"),y:Bu(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=qu(t,r,i.view);return X(s)?s-1:new de(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=qu(t,r,i.view);return X(s)?Math.pow(Hu*s,2):new de(()=>`pow(${Hu} * ${s.signal}, 2)`)}}throw new Error(Ci("size",e))}function qu(e,t,n){const i=Xe(e.width)?e.width.step:er(n,"width"),r=Xe(e.height)?e.height.step:er(n,"height");return t.x||t.y?new de(()=>{const s=[t.x?t.x.signal:i,t.y?t.y.signal:r];return`min(${s.join(", ")})`}):Math.min(i,r)}function Gu(e,t){K(e)?sv(e,t):Yu(e,t)}function sv(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=e;for(const a of y(n)){const c=o[a],l=n[a],u=e.getScaleComponent(a),f=J(r[a]),d=c[t],g=u.get("type"),p=u.get("padding"),h=u.get("paddingInner"),m=ds(g,t),x=Ka(a,t);if(d!==void 0&&(m?x&&v(x):v(Ta(g,t,a))),m&&x===void 0)if(d!==void 0){const b=f.timeUnit,O=f.type;switch(t){case"domainMax":case"domainMin":Bt(c[t])||O==="temporal"||b?l.set(t,{signal:Vi(c[t],{type:O,timeUnit:b})},!0):l.set(t,c[t],!0);break;default:l.copyKeyFromObject(t,c)}}else{const b=t in Vu?Vu[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:g,scalePadding:p,scalePaddingInner:h,domain:c.domain,markDef:s,config:i}):i.scale[t];b!==void 0&&l.set(t,b,!1)}}}const Vu={bins:({model:e,fieldOrDatumDef:t})=>j(t)?ov(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>av(e,t.type),nice:({scaleType:e,channel:t,domain:n,fieldOrDatumDef:i})=>cv(e,t,n,i),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>lv(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>uv(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:s})=>fv(e,t,n,i.type,r,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=j(e)?e.sort:void 0;return dv(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>gv(e,t,n,i,r)};function Xu(e){K(e)?Zy(e):Yu(e,"range")}function Yu(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?Xu(i):Gu(i,t);for(const i of y(n)){let r;for(const s of e.children){const o=s.component.scales[i];if(o){const a=o.getWithExplicit(t);r=Ct(r,a,t,"scale",wl((c,l)=>{switch(t){case"range":return c.step&&l.step?c.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function ov(e,t){const n=t.bin;if(U(n)){const i=mo(e,t.field,n);return new de(()=>e.getSignalName(i))}else if(se(n)&&Mt(n)&&n.step!==void 0)return{step:n.step};return}function av(e,t){return F([le,De,Me],e)&&t!=="nominal"?"hcl":void 0}function cv(e,t,n,i){var r;return((r=Ve(i))===null||r===void 0?void 0:r.bin)||S(n)||F([Z.TIME,Z.UTC],e)?void 0:t in vt?!0:void 0}function lv(e,t,n,i,r,s){if(e in vt){if(Ee(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=r;if(o==="bar"&&!(j(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===Z.POINT)return n.pointPadding}return}function uv(e,t,n,i){if(e!==void 0)return;if(t in vt){const{bandPaddingInner:r,barBandPaddingInner:s,rectBandPaddingInner:o}=i;return Y(r,n==="bar"?s:o)}return}function fv(e,t,n,i,r,s){if(e!==void 0)return;if(t in vt&&n===Z.BAND){const{bandPaddingOuter:o}=s;return Y(o,w(r)?{signal:`${r.signal}/2`}:r/2)}return}function dv(e,t,n,i){return n==="x"&&i.xReverse!==void 0?he(e)&&t==="descending"?w(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:he(e)&&t==="descending"?!0:void 0}function gv(e,t,n,i,r){const s=!!n&&n!=="unaggregated";if(s&&he(r)){if(S(n)){const o=n[0],a=n[n.length-1];if(o<=0&&a>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!Hn(r))return!0;if(!(j(t)&&t.bin)&&F([...Ue,...rd],e)){const{orient:o,type:a}=i;return!(F(["bar","area","line","trail"],a)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function pv(e,t,n,i){const r=hv(t,n,i),{type:s}=e;return Ot(t)?s!==void 0?gp(t,s)?j(n)&&!dp(s,n.type)?(v(cg(s,r)),r):s:(v(ag(t,s,r)),r):r:null}function hv(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":{if(cn(e)||Wr(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&v(Kr(e,"ordinal")),"ordinal";if(e in vt){if(F(["rect","bar","image","rule"],n.type))return"band"}else if(n.type==="arc"&&e in Br)return"band";const r=n[$e(e)];return dn(r)||Ss(t)&&((i=t.axis)===null||i===void 0?void 0:i.tickBand)?"band":"point"}case"temporal":return cn(e)?"time":Wr(e)==="discrete"?(v(Kr(e,"temporal")),"ordinal"):j(t)&&t.timeUnit&&oe(t.timeUnit).utc?"utc":"time";case"quantitative":return cn(e)?j(t)&&U(t.bin)?"bin-ordinal":"linear":Wr(e)==="discrete"?(v(Kr(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(Pa(t.type))}function mv(e,{ignoreRange:t}={}){Ku(e),Ru(e);for(const n of fp)Gu(e,n);t||Xu(e)}function Ku(e){K(e)?e.component.scales=bv(e):e.component.scales=vv(e)}function bv(e){const{encoding:t,mark:n,markDef:i}=e;return $i.reduce((r,s)=>{const o=J(t[s]);if(o&&n===Ja&&s===ue&&o.type===fn)return r;let a=o&&o.scale;if(o&&a!==null&&a!==!1){a??(a={});const c=pv(a,s,o,i);r[s]=new Mu(e.scaleName(`${s}`,!0),{value:c,explicit:a.type===c})}return r},{})}const yv=wl((e,t)=>Va(e)-Va(t));function vv(e){var t,n;const i=e.component.scales={},r={},s=e.component.resolve;for(const o of e.children){Ku(o);for(const a of y(o.component.scales))if((t=(n=s.scale)[a])!==null&&t!==void 0||(n[a]=mu(a,e)),s.scale[a]==="shared"){const c=r[a],l=o.component.scales[a].getWithExplicit("type");c?Xg(c.value,l.value)?r[a]=Ct(c,l,"type","scale",yv):(s.scale[a]="independent",delete r[a]):r[a]=l}}for(const o of y(r)){const a=e.scaleName(o,!0),c=r[o];i[o]=new Mu(a,c);for(const l of e.children){const u=l.component.scales[o];u&&(l.renameScale(u.get("name"),a),u.merged=!0)}}return i}var Eo=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class ko{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function K(e){return(e==null?void 0:e.type)==="unit"}function Fe(e){return(e==null?void 0:e.type)==="facet"}function Co(e){return(e==null?void 0:e.type)==="concat"}function $n(e){return(e==null?void 0:e.type)==="layer"}class No{constructor(t,n,i,r,s,o,a){var c,l;this.type=n,this.parent=i,this.config=s,this.correctDataNames=u=>(u.from&&u.from.data&&(u.from.data=this.lookupDataSource(u.from.data)),u.from&&u.from.facet&&u.from.facet.data&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u),this.parent=i,this.config=s,this.view=fe(a),this.name=(c=t.name)!==null&&c!==void 0?c:r,this.title=_t(t.title)?{text:t.title}:t.title?fe(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new ko,this.projectionNameMap=i?i.projectionNameMap:new ko,this.signalNameMap=i?i.signalNameMap:new ko,this.data=t.data,this.description=t.description,this.transforms=_m((l=t.transform)!==null&&l!==void 0?l:[]),this.layout=n==="layer"||n==="unit"?{}:kh(t,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:Di(t)||i&&i.component.data.isFaceted&&t.data===void 0},layoutSize:new ut,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?N(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){mv(this)}parseProjection(){Cu(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Su(this)}assembleGroupStyle(){var t,n;return this.type==="unit"||this.type==="layer"?(n=(t=this.view)===null||t===void 0?void 0:t.style)!==null&&n!==void 0?n:"cell":void 0}assembleEncodeFromView(t){const n=Eo(t,["style"]),i={};for(const r of y(n)){const s=n[r];s!==void 0&&(i[r]=q(s))}return i}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=q(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{}):L(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,i=Eo(t,["spacing"]),{component:r,config:s}=this,o=zb(r.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),i),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of Oe)t[i].title&&n.push(Fb(this,i));for(const i of lo)n=n.concat(Pb(this,i));return n}assembleAxes(){return vb(this.component.axes,this.config)}assembleLegends(){return $u(this)}assembleProjections(){return ay(this)}assembleTitle(){var t,n,i;const r=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=r,o=Eo(r,["encoding"]),a=Object.assign(Object.assign(Object.assign({},pa(this.config.title).nonMark),o),s?{encode:{update:s}}:{});return a.text?(F(["unit","layer"],this.type)?F(["middle",void 0],a.anchor)&&((n=a.frame)!==null&&n!==void 0||(a.frame="group")):(i=a.anchor)!==null&&i!==void 0||(a.anchor="start"),L(a)?void 0:a):void 0}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||Fe(this.parent)?Lu(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return H((this.name?`${this.name}_`:"")+t)}getDataName(t){return this.getName(B[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(Fe(this.parent)){const n=pu(t),i=wi(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if(te(s)&&jt(o)){const a=r.get("name"),c=hr(this,i),l=$o(c);if(l){const u=_({aggregate:"distinct",field:l},{expr:"datum"});return{signal:gu(a,r,u)}}else return v(Xr(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){return n?this.getName(t):oa(t)&&Ot(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(kd(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(i=>i.hasOrientSignalRef()))}}class Qu extends No{vgField(t,n={}){const i=this.fieldDef(t);return i?_(i,n):void 0}reduceFieldDef(t,n){return nh(this.getMapping(),(i,r,s)=>{const o=Ve(r);return o?t(i,o,s):i},n)}forEachFieldDef(t,n){Cs(this.getMapping(),(i,r)=>{const s=Ve(i);s&&t(s,r)},n)}}var Ov=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class mr extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=N(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"value",(s=o[1])!==null&&s!==void 0?s:"density"]}clone(){return new mr(null,N(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${I(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,i=Ov(t,["density"]),r=Object.assign({type:"kde",field:n},i);return r}}class oi extends D{constructor(t,n){super(t);this.filter=n}clone(){return new oi(null,Object.assign({},this.filter))}static make(t,n){const{config:i,mark:r,markDef:s}=n,o=z("invalid",s,i);if(o!=="filter")return null;const a=n.reduceFieldDef((c,l,u)=>{const f=Ot(u)&&n.getScaleComponent(u);if(f){const d=f.get("type");he(d)&&l.aggregate!=="count"&&!St(r)&&(c[l.field]=l)}return c},{});return y(a).length?new oi(t,a):null}dependentFields(){return new Set(y(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${I(this.filter)}`}assemble(){const t=y(this.filter).reduce((n,i)=>{const r=this.filter[i],s=_(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):r.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class br extends D{constructor(t,n){super(t);this.transform=n,this.transform=N(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,o)=>{var a;return(a=r[o])!==null&&a!==void 0?a:s})}clone(){return new br(this.parent,N(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${I(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform,i={type:"flatten",fields:t,as:n};return i}}class yr extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=N(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"key",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new yr(null,N(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${I(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform,i={type:"fold",fields:t,as:n};return i}}class En extends D{constructor(t,n,i,r){super(t);this.fields=n,this.geojson=i,this.signal=r}clone(){return new En(null,N(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[Le,ze],[ve,we]]){const s=r.map(o=>{const a=J(n.encoding[o]);return j(a)?a.field:$t(a)?{expr:`${a.datum}`}:ke(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new En(t,s,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(ue)){const r=n.typedFieldDef(ue);r.type===fn&&(t=new En(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(C);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${I(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})]}}class ai extends D{constructor(t,n,i,r){super(t);this.projection=n,this.fields=i,this.as=r}clone(){return new ai(null,this.projection,N(this.fields),N(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[Le,ze],[ve,we]]){const r=i.map(o=>{const a=J(n.encoding[o]);return j(a)?a.field:$t(a)?{expr:`${a.datum}`}:ke(a)?{expr:`${a.value}`}:void 0}),s=i[0]===ve?"2":"";(r[0]||r[1])&&(t=new ai(t,n.projectionName(),r,[n.getName(`x${s}`),n.getName(`y${s}`)]))}return t}dependentFields(){return new Set(this.fields.filter(C))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${I(this.fields)} ${I(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Zt extends D{constructor(t,n){super(t);this.transform=n}clone(){return new Zt(null,N(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t,s=[n,i,...r?[r]:[]].join(",");return{signal:`sequence(${s})`}}static makeFromTransform(t,n){return new Zt(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,s=i.y;if(j(r)&&j(s)){const o=r.impute?r:s.impute?s:void 0;if(o===void 0)return;const a=r.impute?s:s.impute?r:void 0,{method:c,value:l,frame:u,keyvals:f}=o.impute,d=Tc(n.mark,i);return new Zt(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},c?{method:c}:{}),l!==void 0?{value:l}:{}),u?{frame:u}:{}),f!==void 0?{keyvals:f}:{}),d.length?{groupby:d}:{}))}return null}hash(){return`Impute ${I(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:s,value:o,frame:a=[null,null]}=this.transform,c=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},i?{keyvals:rm(i)?this.processSequence(i):i}:{}),{method:"value"}),s?{groupby:s}:{}),{value:!r||r==="value"?o:null});if(r&&r!=="value"){const l=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1},s?{groupby:s}:{}),u={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[c,l,u]}else return[c]}}var xv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class vr extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=N(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.loess]}clone(){return new vr(null,N(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${I(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:i}=t,r=xv(t,["loess","on"]),s=Object.assign({type:"loess",x:i,y:n},r);return s}}class ci extends D{constructor(t,n,i){super(t);this.transform=n,this.secondary=i}clone(){return new ci(null,N(this.transform),this.secondary)}static make(t,n,i,r){const s=n.component.data.sources,{from:o}=i;let a=null;if(sm(o)){let c=tf(o.data,s);c||(c=new Yt(o.data),s.push(c));const l=n.getName(`lookup_${r}`);a=new ce(c,l,B.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(om(o)){const c=o.param;i=Object.assign({as:c},i);let l;try{l=n.getSelectionComponent(H(c),c)}catch(u){throw new Error(Fd(c))}if(a=l.materialized,!a)throw new Error(Pd(c))}return new ci(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?V(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${I({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:V(this.transform.as)}:{});else{let n=this.transform.as;C(n)||(v(Md),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}var _v=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Or extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=N(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"prob",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new Or(null,N(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${I(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,i=_v(t,["quantile"]),r=Object.assign({type:"quantile",field:n},i);return r}}var jv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class xr extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=N(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.regression]}clone(){return new xr(null,N(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${I(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:i}=t,r=jv(t,["regression","on"]),s=Object.assign({type:"regression",x:i,y:n},r);return s}}class _r extends D{constructor(t,n){super(t);this.transform=n}clone(){return new _r(null,N(this.transform))}addDimensions(t){var n;this.transform.groupby=Te(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),i=>i)}producedFields(){return}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${I(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},r!==void 0?{limit:r}:{}),s!==void 0?{op:s}:{}),i!==void 0?{groupby:i}:{})}}class jr extends D{constructor(t,n){super(t);this.transform=n}clone(){return new jr(null,N(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${I(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function Zu(e){let t=0;function n(i,r){var s;if(i instanceof Yt&&(!i.isGenerator&&!Qn(i.data))){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}if(i instanceof ie&&(i.parent instanceof Yt&&!r.source?(r.format=Object.assign(Object.assign({},(s=r.format)!==null&&s!==void 0?s:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Sn){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,e.push(...i.assemble());return}if((i instanceof ii||i instanceof ri||i instanceof oi||i instanceof On||i instanceof xn||i instanceof ai||i instanceof Ce||i instanceof ci||i instanceof wn||i instanceof Qt||i instanceof yr||i instanceof br||i instanceof mr||i instanceof vr||i instanceof Or||i instanceof xr||i instanceof At||i instanceof jr||i instanceof _r)&&r.transform.push(i.assemble()),(i instanceof Ke||i instanceof Ye||i instanceof Zt||i instanceof dt||i instanceof En)&&r.transform.push(...i.assemble()),i instanceof ce){if(r.source&&r.transform.length===0)i.setSource(r.source);else if(i.parent instanceof ce)i.setSource(r.name);else if(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}}switch(i.numChildren()){case 0:i instanceof ce&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const a of i.children){const c={name:null,source:o,transform:[]};n(a,c)}break}}}return n}function Sv(e){const t=[],n=Zu(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function wv(e,t){var n,i;const r=[],s=Zu(r);let o=0;for(const c of e.sources){c.hasName()||(c.dataName=`source_${o++}`);const l=c.assemble();s(c,l)}for(const c of r)c.transform.length===0&&delete c.transform;let a=0;for(const[c,l]of r.entries())((n=l.transform)!==null&&n!==void 0?n:[]).length===0&&!l.source&&r.splice(a++,0,r.splice(c,1)[0]);for(const c of r)for(const l of(i=c.transform)!==null&&i!==void 0?i:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const c of r)c.name in t&&(c.values=t[c.name]);return r}function $v(e){return e==="top"||e==="left"||w(e)?"header":"footer"}function Ev(e){for(const t of Oe)kv(e,t);ef(e,"x"),ef(e,"y")}function kv(e,t){var n;const{facet:i,config:r,child:s,component:o}=e;if(e.channelHasField(t)){const a=i[t],c=jn("title",null,r,t);let l=pn(a,r,{allowDisabling:!0,includeDefault:c===void 0||!!c});s.component.layoutHeaders[t].title&&(l=S(l)?l.join(", "):l,l+=` / ${s.component.layoutHeaders[t].title}`,s.component.layoutHeaders[t].title=null);const u=jn("labelOrient",a.header,r,t),f=a.header!==null?Y((n=a.header)===null||n===void 0?void 0:n.labels,r.header.labels,!0):!1,d=F(["bottom","right"],u)?"footer":"header";o.layoutHeaders[t]={title:a.header!==null?l:null,facetFieldDef:a,[d]:t==="facet"?[]:[Ju(e,t,f)]}}}function Ju(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function ef(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:s}=e.component;if(s.axis[t]=po(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=r[o];for(const c of i.component.axes[t]){const l=$v(c.get("orient"));(n=a[l])!==null&&n!==void 0||(a[l]=[Ju(e,o,!1)]);const u=ni(c,"main",e.config,{header:!0});u&&a[l][0].axes.push(u),c.mainExtracted=!0}}}}function Cv(e){Fo(e),Sr(e,"width"),Sr(e,"height")}function Nv(e){Fo(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";Sr(e,t),Sr(e,n)}function Fo(e){for(const t of e.children)t.parseLayoutSize()}function Sr(e,t){var n;const i=pu(t),r=wi(i),s=e.component.resolve,o=e.component.layoutSize;let a;for(const c of e.children){const l=c.component.layoutSize.getWithExplicit(i),u=(n=s.scale[r])!==null&&n!==void 0?n:mu(r,e);if(u==="independent"&&l.value==="step"){a=void 0;break}if(a){if(u==="independent"&&a.value!==l.value){a=void 0;break}a=Ct(a,l,i,"")}else a=l}if(a){for(const c of e.children)e.renameSignal(c.getName(i),e.getName(t)),c.component.layoutSize.set(i,"merged",!1);o.setWithExplicit(t,a)}else o.setWithExplicit(t,{explicit:!1,value:void 0})}function Fv(e){const{size:t,component:n}=e;for(const i of Ue){const r=$e(i);if(t[r]){const s=t[r];n.layoutSize.set(r,Xe(s)?"step":s,!0)}else{const s=Pv(e,r);n.layoutSize.set(r,s,!1)}}}function Pv(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const s=r.get("type"),o=r.get("range");if(te(s)){const a=Kn(i.view,t);return jt(o)||Xe(a)?"step":a}else return Us(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return Us(i.view,t);{const s=Kn(i.view,t);return Xe(s)?s.step:s}}}function Po(e,t,n){return _(t,Object.assign({suffix:`by_${_(e)}`},n??{}))}class li extends Qu{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve);this.child=zo(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!Gn(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=y(t),i={};for(const r of n){if(![Ze,Je].includes(r)){v(Ci(r,"facet"));break}const s=t[r];if(s.field===void 0){v(Yr(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(t,n){const i=Es(t,n);return i.header?i.header=fe(i.header):i.header===null&&(i.header=null),i}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=wr(this),this.child.parseData()}parseLayoutSize(){Fo(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),Ev(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,i;const r={};for(const s of Oe)for(const o of uo){const a=this.component.layoutHeaders[s],c=a[o],{facetFieldDef:l}=a;if(l){const u=jn("titleOrient",l.header,this.config,s);if(["right","bottom"].includes(u)){const f=fr(s,u);(t=r.titleAnchor)!==null&&t!==void 0||(r.titleAnchor={}),r.titleAnchor[f]="end"}}if(c==null?void 0:c[0]){const u=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(u)&&((n=r[f])!==null&&n!==void 0||(r[f]={}),r[f][s]=.5),a.title&&((i=r.offset)!==null&&i!==void 0||(r.offset={}),r.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),i?{columns:i}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof li)return;{const t=this.getName("column_domain");return{signal:`length(data('${t}'))`}}}assembleGroup(t){return this.parent&&this.parent instanceof li?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:_(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof li){if(this.child.channelHasField("column")){const r=_(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of Ue){const s=this.child.component.scales[r];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(te(o)&&jt(a)){const c=hr(this.child,r),l=$o(c);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):v(Xr(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),c=[];for(const u of Oe){const f=this.facet[u];if(f){c.push(_(f));const{bin:d,sort:g}=f;if(U(d)&&c.push(_(f,{binSuffix:"end"})),qe(g)){const{field:p,op:h=Li}=g,m=Po(f,g);i&&r?(s.push(m),o.push("max"),a.push(m)):(s.push(p),o.push(h),a.push(m))}else if(S(g)){const p=_n(f,u);s.push(p),o.push("max"),a.push(p)}}}const l=!!i&&!!r;return Object.assign({name:t,data:n,groupby:c},l||s.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),s.length?{fields:s,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:n}=this,i=n[t];return i?qe(i.sort)?[Po(i,i.sort,{expr:"datum"})]:S(i.sort)?[_n(i,t,{expr:"datum"})]:[_(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i,s=(qe(r)?r.order:!S(r)&&r)||"ascending";return[s]}return[]}assembleLabelTitle(){var t;const{facet:n,config:i}=this;if(n.facet)return fo(n.facet,"facet",i);const r={row:["top","bottom"],column:["left","right"]};for(const s of lo)if(n[s]){const o=jn("labelOrient",(t=n[s])===null||t===void 0?void 0:t.header,i,s);if(r[s].includes(o))return fo(n[s],s,i)}return}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=Sv(n),r=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle(),a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},s?{title:s}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:Oe.map(c=>this.facetSortFields(c)).flat(),order:Oe.map(c=>this.facetSortOrder(c)).flat()}}),i.length>0?{data:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(Im(this,[])));return[a]}getMapping(){return this.facet}}function Av(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const s of[n,i])if(qe(s.sort)){const{field:o,op:a=Li}=s.sort;e=r=new Qt(e,{joinaggregate:[{op:a,field:o,as:Po(s,s.sort,{forAs:!0})}],groupby:[_(s)]})}return r}return null}function tf(e,t){var n,i,r,s;for(const o of t){const a=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const c=(n=e.format)===null||n===void 0?void 0:n.mesh,l=(i=a.format)===null||i===void 0?void 0:i.feature;if(c&&l)continue;const u=(r=e.format)===null||r===void 0?void 0:r.feature;if((u||l)&&u!==l)continue;const f=(s=a.format)===null||s===void 0?void 0:s.mesh;if((c||f)&&c!==f)continue;if(ir(e)&&ir(a)){if(Ae(e.values,a.values))return o}else if(Qn(e)&&Qn(a)){if(e.url===a.url)return o}else if($l(e)&&e.name===o.dataName)return o}return null}function Tv(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Yt({values:[]});return t.push(i),i}const n=tf(e.data,t);if(n)return Vt(e.data)||(n.data.format=Yo({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Yt(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function Iv(e,t,n){var i,r;let s=0;for(const o of t.transforms){let a,c;if(mm(o))c=e=new xn(e,o),a="derived";else if(Gs(o)){const l=xy(o);c=e=(i=ie.makeWithAncestors(e,{},l,n))!==null&&i!==void 0?i:e,e=new On(e,t,o.filter)}else if(bl(o))c=e=Ke.makeFromTransform(e,o,t),a="number";else if(ym(o)){a="date";const l=n.getWithExplicit(o.field);l.value===void 0&&(e=new ie(e,{[o.field]:a}),n.set(o.field,a,!1)),c=e=Ye.makeFromTransform(e,o)}else if(vm(o))c=e=Ce.makeFromTransform(e,o),a="number",ro(t)&&(e=new At(e));else if(ml(o))c=e=ci.make(e,t,o,s++),a="derived";else if(gm(o))c=e=new wn(e,o),a="number";else if(pm(o))c=e=new Qt(e,o),a="number";else if(Om(o))c=e=dt.makeFromTransform(e,o),a="derived";else if(xm(o))c=e=new yr(e,o),a="derived";else if(hm(o))c=e=new br(e,o),a="derived";else if(am(o))c=e=new _r(e,o),a="derived";else if(dm(o))e=new jr(e,o);else if(bm(o))c=e=Zt.makeFromTransform(e,o),a="derived";else if(cm(o))c=e=new mr(e,o),a="derived";else if(lm(o))c=e=new Or(e,o),a="derived";else if(um(o))c=e=new xr(e,o),a="derived";else if(fm(o))c=e=new vr(e,o),a="derived";else{v(Dd(o));continue}if(c&&a!==void 0)for(const l of(r=c.producedFields())!==null&&r!==void 0?r:[])n.set(l,a,!1)}return e}function wr(e){var t,n,i,r,s,o,a,c,l,u;let f=Tv(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:g}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new Pm,h=e.data;Vt(h)?(El(h)?f=new ri(f,h.sequence):Ys(h)&&(f=new ii(f,h.graticule)),p.parseNothing=!0):((t=h==null?void 0:h.format)===null||t===void 0?void 0:t.parse)===null&&(p.parseNothing=!0),f=(n=ie.makeExplicit(f,e,p))!==null&&n!==void 0?n:f,f=new At(f);const m=e.parent&&$n(e.parent);(K(e)||Fe(e))&&(m&&(f=(i=Ke.makeFromEncoding(f,e))!==null&&i!==void 0?i:f)),e.transforms.length>0&&(f=Iv(f,e,p));const x=jy(e),b=_y(e);f=(r=ie.makeWithAncestors(f,{},Object.assign(Object.assign({},x),b),p))!==null&&r!==void 0?r:f,K(e)&&(f=En.parseAll(f,e),f=ai.parseAll(f,e)),(K(e)||Fe(e))&&(m||(f=(s=Ke.makeFromEncoding(f,e))!==null&&s!==void 0?s:f),f=(o=Ye.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=xn.parseAllForSortIndex(f,e));const O=e.getDataName(B.Raw),$=new ce(f,O,B.Raw,g);if(d[O]=$,f=$,K(e)){const T=Ce.makeFromEncoding(f,e);T&&(f=T,ro(e)&&(f=new At(f))),f=(a=Zt.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=(c=dt.makeFromEncoding(f,e))!==null&&c!==void 0?c:f}K(e)&&(f=(l=oi.make(f,e))!==null&&l!==void 0?l:f);const P=e.getDataName(B.Main),A=new ce(f,P,B.Main,g);d[P]=A,f=A,K(e)&&bb(e,A);let E=null;if(Fe(e)){const T=e.getName("facet");f=(u=Av(f,e.facet))!==null&&u!==void 0?u:f,E=new Sn(f,e,T,A.getSource()),d[T]=E}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:g,raw:$,main:A,facetRoot:E,ancestorParse:p})}class Rv extends No{constructor(t,n,i,r){var s,o,a,c;super(t,"concat",n,i,r,t.resolve);(((o=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||o===void 0?void 0:o.x)==="shared"||((c=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||c===void 0?void 0:c.y)==="shared")&&v(Rd),this.children=this.getChildren(t).map((l,u)=>zo(l,this,this.getName(`concat_${u}`),void 0,r))}parseData(){this.component.data=wr(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of y(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return Ji(t)?t.vconcat:Ms(t)?t.hconcat:t.concat}parseLayoutSize(){Nv(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=go(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),i?{style:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function zv(e){return e===!1||e===null}const Lv=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},Nc),{labelExpr:1,encode:1}),nf=y(Lv);class Ao extends ut{constructor(t={},n={},i=!1){super();this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new Ao(N(this.explicit),N(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!zv(this.get(t))}hasOrientSignalRef(){return w(this.explicit.orient)}}function Dv(e,t,n){var i;const{encoding:r,config:s}=e,o=(i=J(r[t]))!==null&&i!==void 0?i:J(r[rt(t)]),a=e.axis(t)||{},{format:c,formatType:l}=a;return qt(l)?Object.assign({text:vs({fieldOrDatumDef:o,field:"datum.value",format:c,formatType:l,config:s})},n):n}function Mv(e){return Ue.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[Vv(n,e)]),t),{})}const Uv={bottom:"top",top:"bottom",left:"right",right:"left"};function Bv(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of y(s.component.axes))i.axis[o]=po(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=Wv(n[o],s.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const s of Ue){for(const o of e.children){if(!o.component.axes[s])continue;if(i.axis[s]==="independent"){n[s]=((t=n[s])!==null&&t!==void 0?t:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:c,explicit:l}=a.getWithExplicit("orient");if(w(c))continue;if(r[c]>0&&!l){const u=Uv[c];r[c]>r[u]&&a.set("orient",u,!1)}r[c]++}}delete o.component.axes[s]}if(i.axis[s]==="independent"&&n[s]&&n[s].length>1)for(const o of n[s])!!o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function Wv(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t[i];if(!!r!==!!s)return;if(r&&s){const o=r.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[i]=Hv(r,s)}}}else return t.map(n=>n.clone());return e}function Hv(e,t){for(const n of nf){const i=Ct(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return ja(r,s);case"gridScale":return{explicit:r.explicit,value:Y(r.value,s.value)}}return nr(r,s,n,"axis")});e.setWithExplicit(n,i)}return e}function qv(e,t,n,i,r){if(t==="disable")return n!==void 0;n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(w(n.labelAngle)?n.labelAngle:Rn(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===cu(i,r))return!0}return e===n[t]}const Gv=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Vv(e,t){var n,i,r;let s=t.axis(e);const o=new Ao,a=J(t.encoding[e]),{mark:c,config:l}=t,u=(s==null?void 0:s.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=l.axis)===null||i===void 0?void 0:i.orient)||Eb(e),f=t.getScaleComponent(e).get("type"),d=Ob(e,f,u,t.config),g=s!==void 0?!s:ao("disable",l.style,s==null?void 0:s.style,d).configValue;if(o.set("disable",g,s!==void 0),g)return o;s=s||{};const p=Sb(a,s,e,l.style,d),h={fieldOrDatumDef:a,axis:s,channel:e,model:t,scaleType:f,orient:u,labelAngle:p,mark:c,config:l};for(const b of nf){const O=b in su?su[b](h):Fc(b)?s[b]:void 0,$=O!==void 0,P=qv(O,b,s,t,e);if($&&P)o.set(b,O,P);else{const{configValue:A=void 0,configFrom:E=void 0}=Fc(b)&&b!=="values"?ao(b,l.style,s.style,d):{},T=A!==void 0;$&&!T?o.set(b,O,P):(!(E==="vgAxisConfig")||Gv.has(b)&&T||Xn(A)||w(A))&&o.set(b,A,!1)}}const m=(r=s.encoding)!==null&&r!==void 0?r:{},x=Cc.reduce((b,O)=>{var $;if(!o.hasAxisPart(O))return b;const P=hu(($=m[O])!==null&&$!==void 0?$:{},t),A=O==="labels"?Dv(t,e,P):P;return A!==void 0&&!L(A)&&(b[O]={update:A}),b},{});return L(x)||o.set("encode",x,!!s.encoding||s.labelAngle!==void 0),o}function Xv({encoding:e,size:t}){for(const n of Ue){const i=$e(n);Xe(t[i])&&(Ge(e[n])&&(delete t[i],v(Ia(i))))}return t}function Yv(e,t,n){const i=fe(e),r=z("orient",i,n);if(i.orient=Jv(i.type,t,r),r!==void 0&&r!==i.orient&&v(eg(i.orient,r)),i.type==="bar"&&i.orient){const a=z("cornerRadiusEnd",i,n);if(a!==void 0){const c=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:Sp[i.orient];for(const l of c)i[l]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}const s=z("opacity",i,n);s===void 0&&(i.opacity=Qv(i.type,t));const o=z("cursor",i,n);return o===void 0&&(i.cursor=Kv(i,t,n)),i}function Kv(e,t,n){return t.href||e.href||z("href",e,n)?"pointer":e.cursor}function Qv(e,t){return F([Ti,gs,ps,hs],e)&&!ks(t)?.7:void 0}function Zv(e,t,{graticule:n}){if(n)return!1;const i=Ut("filled",e,t),r=e.type;return Y(i,r!==Ti&&r!==Ai&&r!==Ii)}function Jv(e,t,n){switch(e){case Ti:case ps:case hs:case Za:case hp:case pp:return}const{x:i,y:r,x2:s,y2:o}=t;switch(e){case Pi:if(j(i)&&(se(i.bin)||j(r)&&r.aggregate&&!i.aggregate))return"vertical";if(j(r)&&(se(r.bin)||j(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(j(i)&&i.type===Wt&&!U(i.bin)||js(i)))return"horizontal";if(!o&&(j(r)&&r.type===Wt&&!U(r.bin)||js(r)))return"vertical"}case Ii:if(s&&!(j(i)&&se(i.bin))&&o&&!(j(r)&&se(r.bin)))return;case Fi:if(o)return j(r)&&se(r.bin)?"horizontal":"vertical";if(s)return j(i)&&se(i.bin)?"vertical":"horizontal";if(e===Ii){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case Ai:case gs:{const a=Ge(i),c=Ge(r);if(n)return n;if(a&&!c)return e!=="tick"?"horizontal":"vertical";if(!a&&c)return e!=="tick"?"vertical":"horizontal";if(a&&c){const l=i,u=r,f=l.type===un,d=u.type===un;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!l.aggregate&&u.aggregate?e!=="tick"?"vertical":"horizontal":l.aggregate&&!u.aggregate&&e!=="tick"?"horizontal":"vertical"}else return}}return"vertical"}const eO={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_e(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),ne("x",e,{defaultPos:"mid"})),ne("y",e,{defaultPos:"mid"})),Ft(e,"radius","arc")),Ft(e,"theta","arc"))},tO={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},_e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),sr("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),sr("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),no(e))},nO={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},_e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ft(e,"x","bar")),Ft(e,"y","bar"))},iO={vgMark:"shape",encodeEntry:e=>Object.assign({},_e(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape,i=Object.assign({type:"geoshape",projection:e.projectionName()},n&&j(n)&&n.type===fn?{field:_(n,{expr:"datum"})}:{});return[i]}},rO={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},_e(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),Ft(e,"x","image")),Ft(e,"y","image")),eo(e,"url"))},sO={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_e(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),ne("x",e,{defaultPos:"mid"})),ne("y",e,{defaultPos:"mid"})),ee("size",e,{vgChannel:"strokeWidth"})),no(e))},oO={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_e(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),ne("x",e,{defaultPos:"mid"})),ne("y",e,{defaultPos:"mid"})),ee("size",e)),no(e))};function To(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_e(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),ne("x",e,{defaultPos:"mid"})),ne("y",e,{defaultPos:"mid"})),ee("size",e)),ee("angle",e)),aO(e,n,t))}function aO(e,t,n){return n?{shape:{value:n}}:ee("shape",e)}const cO={vgMark:"symbol",encodeEntry:e=>To(e)},lO={vgMark:"symbol",encodeEntry:e=>To(e,"circle")},uO={vgMark:"symbol",encodeEntry:e=>To(e,"square")},fO={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},_e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ft(e,"x","rect")),Ft(e,"y","rect"))},dO={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},_e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),sr("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),sr("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),ee("size",e,{vgChannel:"strokeWidth"}))}},gO={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_e(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),ne("x",e,{defaultPos:"mid"})),ne("y",e,{defaultPos:"mid"})),eo(e)),ee("size",e,{vgChannel:"fontSize"})),ee("angle",e)),Ml("align",pO(e.markDef,n,t))),Ml("baseline",hO(e.markDef,n,t))),ne("radius",e,{defaultPos:null})),ne("theta",e,{defaultPos:null}))}};function pO(e,t,n){const i=z("align",e,n);return i===void 0?"center":void 0}function hO(e,t,n){const i=z("baseline",e,n);return i===void 0?"middle":void 0}const mO={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",s=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ne("x",e,{defaultPos:"mid",vgChannel:"xc"})),ne("y",e,{defaultPos:"mid",vgChannel:"yc"})),ee("size",e,{defaultValue:bO(e),vgChannel:r})),{[s]:q(z("thickness",n,t))})}};function bO(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,s=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),a=(t=z("size",i,n,{vgChannel:s}))!==null&&t!==void 0?t:n.tick.bandSize;if(a!==void 0)return a;{const c=o?o.get("range"):void 0;if(c&&jt(c)&&X(c.step))return c.step*3/4;const l=er(n.view,s);return l*3/4}}const $r={arc:eO,area:tO,bar:nO,circle:lO,geoshape:iO,image:rO,line:sO,point:cO,rect:fO,rule:dO,square:uO,text:gO,tick:mO,trail:oO};function yO(e){if(F([Ai,Fi,mp],e.mark)){const t=Tc(e.mark,e.encoding);if(t.length>0)return vO(e,t)}else if(e.mark===Pi){const t=qr.some(n=>z(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return OO(e)}return Io(e)}const rf="faceted_path_";function vO(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:rf+e.requestDataName(B.Main),data:e.requestDataName(B.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:Io(e,{fromPrefix:rf})}]}const sf="stack_group_";function OO(e){const[t]=Io(e,{fromPrefix:sf}),n=e.scaleName(e.stack.fieldChannel),i=(l={})=>e.vgField(e.stack.fieldChannel,l),r=(l,u)=>{const f=[i({prefix:"min",suffix:"start",expr:u}),i({prefix:"max",suffix:"start",expr:u}),i({prefix:"min",suffix:"end",expr:u}),i({prefix:"max",suffix:"end",expr:u})];return`${l}(${f.map(d=>`scale('${n}',${d})`).join(",")})`};let s,o;e.stack.fieldChannel==="x"?(s=Object.assign(Object.assign({},sn(t.encode.update,["y","yc","y2","height",...qr])),{x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},ge(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(s=Object.assign(Object.assign({},sn(t.encode.update,["x","xc","x2","width"])),{y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},ge(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const l of qr){const u=Ut(l,e.markDef,e.config);t.encode.update[l]?(s[l]=t.encode.update[l],delete t.encode.update[l]):u&&(s[l]=q(u)),u&&(t.encode.update[l]={value:0})}const a=[];if(e.stack.groupbyChannel){const l=e.fieldDef(e.stack.groupbyChannel),u=_(l);u&&a.push(u),((l==null?void 0:l.bin)||(l==null?void 0:l.timeUnit))&&a.push(_(l,{binSuffix:"end"}))}const c=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return s=c.reduce((l,u)=>{if(t.encode.update[u])return Object.assign(Object.assign({},l),{[u]:t.encode.update[u]});{const f=Ut(u,e.markDef,e.config);return f!==void 0?Object.assign(Object.assign({},l),{[u]:q(f)}):l}},s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(B.Main),name:sf+e.requestDataName(B.Main),groupby:a,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}function xO(e){const{encoding:t,stack:n,mark:i,markDef:r,config:s}=e,o=t.order;if(!S(o)&&ke(o)&&Pr(o.value)||!o&&Pr(z("order",r,s)))return;if((S(o)||j(o))&&!n)return Oa(o,{expr:"datum"});if(St(i)){const a=r.orient==="horizontal"?"y":"x",c=t[a];if(j(c)){const l=c.sort;if(S(l))return{field:_(c,{prefix:a,suffix:"sort_index",expr:"datum"})};if(qe(l))return{field:_({aggregate:ks(e.encoding)?l.op:void 0,field:l.field},{expr:"datum"})};if(hc(l)){const u=e.fieldDef(l.encoding);return{field:_(u,{expr:"datum"}),order:l.order}}else return l===null?void 0:{field:_(c,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}return}return}function Io(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=e,o=Y(i.clip,_O(e),jO(e)),a=ya(i),c=r.key,l=xO(e),u=SO(e),f=z("aria",i,s),d=$r[n].postEncodingTransform?$r[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:$r[n].vgMark},o?{clip:!0}:{}),a?{style:a}:{}),c?{key:c.field}:{}),l?{sort:l}:{}),u||{}),f===!1?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(B.Main)},encode:{update:$r[n].encodeEntry(e)}}),d?{transform:d}:{})]}function _O(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function jO(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function SO(e){if(!e.component.selection)return null;const t=y(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=y(i.component.selection).length,i=i.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}class of extends Qu{constructor(t,n,i,r={},s){var o;super(t,"unit",n,i,s,void 0,Jc(t)?t.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const a=He(t.mark)?Object.assign({},t.mark):{type:t.mark},c=a.type;a.filled===void 0&&(a.filled=Zv(a,s,{graticule:t.data&&Ys(t.data)}));const l=this.encoding=eh(t.encoding||{},c,a.filled,s);this.markDef=Yv(a,l,s),this.size=Xv({encoding:l,size:Jc(t)?Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):r}),this.stack=al(c,l),this.specifiedScales=this.initScales(c,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegends(l),this.specifiedProjection=t.projection,this.selection=((o=t.params)!==null&&o!==void 0?o:[]).filter(u=>Ls(u))}get hasProjection(){const{encoding:t}=this,n=this.mark===Ja,i=t&&Kf.some(r=>k(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return $i.reduce((i,r)=>{var s;const o=J(n[r]);return o&&(i[r]=this.initScale((s=o.scale)!==null&&s!==void 0?s:{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=fe(t);return S(n)&&(r.domain=n.map(pe)),S(i)&&(r.range=i.map(pe)),r}initAxes(t){return Ue.reduce((n,i)=>{const r=t[i];if(k(r)||i===G&&k(t.x2)||i===Q&&k(t.y2)){const s=k(r)?r.axis:void 0;n[i]=s&&this.initAxis(Object.assign({},s))}return n},{})}initAxis(t){const n=y(t),i={};for(const r of n){const s=t[r];i[r]=Xn(s)?ha(s):pe(s)}return i}initLegends(t){return sd.reduce((n,i)=>{const r=J(t[i]);if(r&&ad(i)){const s=r.legend;n[i]=s&&fe(s)}return n},{})}parseData(){this.component.data=wr(this)}parseLayoutSize(){Fv(this)}parseSelections(){this.component.selection=mb(this,this.selection)}parseMarkGroup(){this.component.mark=yO(this)}parseAxesAndHeaders(){this.component.axes=Mv(this)}assembleSelectionTopLevelSignals(t){return Rm(this,t)}assembleSignals(){return[...iu(this),...Tm(this,[])]}assembleSelectionData(t){return zm(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return go(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!$n(this.parent))&&(n=Cl(this,n)),n.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Gt(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return Ve(n)}typedFieldDef(t){const n=this.fieldDef(t);return xe(n)?n:null}}class Ro extends No{constructor(t,n,i,r,s){super(t,"layer",n,i,s,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((a,c)=>{if(tr(a))return new Ro(a,this,this.getName(`layer_${c}`),o,s);if(ct(a))return new of(a,this,this.getName(`layer_${c}`),o,s);throw new Error(Vr(a))})}parseData(){this.component.data=wr(this);for(const t of this.children)t.parseData()}parseLayoutSize(){Cv(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of y(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){Bv(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),iu(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),go(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t;return}assembleLayout(){return null}assembleMarks(){return Lm(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),$u(this))}}function zo(e,t,n,i,r){if(Di(e))return new li(e,t,n,r);if(tr(e))return new Ro(e,t,n,i,r);if(ct(e))return new of(e,t,n,i,r);if(wh(e))return new Rv(e,t,n,r);throw new Error(Vr(e))}var wO=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function $O(e,t={}){t.logger&&wg(t.logger),t.fieldTitle&&wc(t.fieldTitle);try{const n=sl(Vo(t.config,e.config)),i=_l(e,n),r=zo(i,null,"",void 0,n);r.parse(),Dy(r.component.data,r);const s=kO(r,EO(e,i.autosize,n,r),e.datasets,e.usermeta);return{spec:s,normalized:i}}finally{t.logger&&$g(),t.fieldTitle&&Hp()}}function EO(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):C(t)&&(t={type:t}),r&&s&&Cm(t.type)){if(r==="step"&&s==="step")v($a()),t.type="pad";else if(r==="step"||s==="step"){const o=r==="step"?"width":"height";v($a(wi(o)));const a=o==="width"?"height":"width";t.type=Nm(a)}}return Object.assign(Object.assign(Object.assign({},y(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),Sl(n,!1)),Sl(e,!0))}function kO(e,t,n={},i){const r=e.config?Mh(e.config):void 0,s=[].concat(e.assembleSelectionData([]),wv(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),c=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let u=e.assembleLayoutSignals();u=u.filter(g=>(g.name==="width"||g.name==="height")&&g.value!==void 0?(t[g.name]=+g.value,!1):!0);const{params:f}=t,d=wO(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),a?{title:a}:{}),c?{style:c}:{}),l?{encode:{update:l}}:{}),{data:s}),o.length>0?{projections:o}:{}),e.assembleGroup([...u,...e.assembleSelectionTopLevelSignals([]),...Zc(f)])),r?{config:r}:{}),i?{usermeta:i}:{})}const CO=Bf.version;export{an as accessPathDepth,zr as accessPathWithDatum,$O as compile,F as contains,Ae as deepEqual,yi as deleteNestedProperty,N as duplicate,gt as entries,Ar as every,Rr as fieldIntersection,Qo as flatAccessWithDatum,Y as getFirstDefined,Tr as hasIntersection,I as hash,ea as internalField,An as isBoolean,L as isEmpty,Hf as isEqual,ta as isInternalField,Pr as isNullOrFalse,vi as isNumeric,y as keys,Tn as logicalExpr,Yo as mergeDeep,_l as normalize,Rn as normalizeAngle,ge as omit,sn as pick,Ir as prefixGenerator,Lr as removePathFromField,Rt as replaceAll,ye as replacePathInField,Gf as resetIdCounter,Ko as setEqual,on as some,M as stringify,In as titleCase,Te as unique,Jo as uniqueId,re as vals,H as varName,CO as version};export default null;
