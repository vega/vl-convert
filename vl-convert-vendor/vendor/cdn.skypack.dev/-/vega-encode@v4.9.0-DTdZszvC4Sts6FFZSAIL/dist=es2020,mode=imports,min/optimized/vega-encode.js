import{Transform as h,ingest as k,tupleid as me,stableCompare as N}from"/-/vega-dataflow@v5.7.4-DrCzG6Luqf74SfPN5Hxw/dist=es2020,mode=imports,min/optimized/vega-dataflow.js";import{tickCount as A,tickFormat as ce,validTicks as ue,tickValues as he,SymbolLegend as O,labelFormat as ge,labelValues as pe,GradientLegend as ve,scaleFraction as Me,labelFraction as ye,scale as Se,isContinuous as U,Sequential as z,Linear as R,Time as ke,UTC as xe,Pow as F,Sqrt as j,Ordinal as T,scaleImplicit as De,Log as be,Symlog as we,isLogarithmic as ze,BinOrdinal as Y,bandSpace as Ce,isInterpolating as X,interpolateRange as Ae,quantizeInterpolator as Oe,interpolateColors as V,interpolate as Re,Band as Le,Point as q,scheme as Pe,Threshold as Ee,Quantile as Ie,Quantize as Ne,Diverging as Ue}from"/-/vega-scale@v7.2.0-V0J4hKWZmxW22KwUY6dZ/dist=es2020,mode=imports,min/optimized/vega-scale.js";import{inherits as y,isArray as C,error as b,falsy as x,isFunction as D,constant as Fe,peek as w,fastmap as G,one as W,toSet as je,isString as Te,zoomLog as Ye,zoomPow as B,zoomSymlog as Xe,zoomLinear as Ve,stringValue as qe}from"/-/vega-util@v1.17.0-uRskU0IBL2vWCP4Va8OC/dist=es2020,mode=imports,min/optimized/vega-util.js";import{sum as Ge,range as Z}from"/-/d3-array@v3.1.1-Ibshj34oOmCw8da1RLSW/dist=es2020,mode=imports,min/optimized/d3-array.js";import{interpolateRound as We,interpolate as Be}from"/-/d3-interpolate@v3.0.1-i9AsUdFHwyaukRBWNe8d/dist=es2020,mode=imports,min/optimized/d3-interpolate.js";function H(e){h.call(this,null,e)}y(H,h,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var i=t.dataflow.locale(),a=t.fork(t.NO_SOURCE|t.NO_FIELDS),n=this.value,o=e.scale,l=e.count==null?e.values?e.values.length:10:e.count,r=A(o,l,e.minstep),s=e.format||ce(i,o,r,e.formatSpecifier,e.formatType,!!e.values),d=e.values?ue(o,e.values,r):he(o,r);return n&&(a.rem=n),n=d.map((f,m)=>k({index:m/(d.length-1||1),value:f,label:s(f)})),e.extra&&n.length&&n.push(k({index:-1,extra:{value:n[0].value},label:""})),a.source=n,a.add=n,this.value=n,a}});function K(e){h.call(this,null,e)}function Ze(){return k({})}function He(e){const t=G().test(i=>i.exit);return t.lookup=i=>t.get(e(i)),t}y(K,h,{transform(e,t){var i=t.dataflow,a=t.fork(t.NO_SOURCE|t.NO_FIELDS),n=e.item||Ze,o=e.key||me,l=this.value;return C(a.encode)&&(a.encode=null),l&&(e.modified("key")||t.modified(o))&&b("DataJoin does not support modified key function or fields."),l||(t=t.addAll(),this.value=l=He(o)),t.visit(t.ADD,r=>{const s=o(r);let d=l.get(s);d?d.exit?(l.empty--,a.add.push(d)):a.mod.push(d):(d=n(r),l.set(s,d),a.add.push(d)),d.datum=r,d.exit=!1}),t.visit(t.MOD,r=>{const s=o(r),d=l.get(s);d&&(d.datum=r,a.mod.push(d))}),t.visit(t.REM,r=>{const s=o(r),d=l.get(s);r===d.datum&&!d.exit&&(a.rem.push(d),d.exit=!0,++l.empty)}),t.changed(t.ADD_MOD)&&a.modifies("datum"),(t.clean()||e.clean&&l.empty>i.cleanThreshold)&&i.runAfter(l.clean),a}});function J(e){h.call(this,null,e)}y(J,h,{transform(e,t){var i=t.fork(t.ADD_REM),a=e.mod||!1,n=e.encoders,o=t.encode;if(C(o))if(i.changed()||o.every(m=>n[m]))o=o[0],i.encode=null;else return t.StopPropagation;var l=o==="enter",r=n.update||x,s=n.enter||x,d=n.exit||x,f=(o&&!l?n[o]:r)||x;if(t.changed(t.ADD)&&(t.visit(t.ADD,m=>{s(m,e),r(m,e)}),i.modifies(s.output),i.modifies(r.output),f!==x&&f!==r&&(t.visit(t.ADD,m=>{f(m,e)}),i.modifies(f.output))),t.changed(t.REM)&&d!==x&&(t.visit(t.REM,m=>{d(m,e)}),i.modifies(d.output)),l||f!==x){const m=t.MOD|(e.modified()?t.REFLOW:0);l?(t.visit(m,c=>{const g=s(c,e)||a;(f(c,e)||g)&&i.mod.push(c)}),i.mod.length&&i.modifies(s.output)):t.visit(m,c=>{(f(c,e)||a)&&i.mod.push(c)}),i.mod.length&&i.modifies(f.output)}return i.changed()?i:t.StopPropagation}});function $(e){h.call(this,[],e)}y($,h,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var i=t.dataflow.locale(),a=t.fork(t.NO_SOURCE|t.NO_FIELDS),n=this.value,o=e.type||O,l=e.scale,r=+e.limit,s=A(l,e.count==null?5:e.count,e.minstep),d=!!e.values||o===O,f=e.format||ge(i,l,s,o,e.formatSpecifier,e.formatType,d),m=e.values||pe(l,s),c,g,u,M,S;return n&&(a.rem=n),o===O?(r&&m.length>r?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),n=m.slice(0,r-1),S=!0):n=m,D(u=e.size)?(!e.values&&l(n[0])===0&&(n=n.slice(1)),M=n.reduce((p,v)=>Math.max(p,u(v,e)),0)):u=Fe(M=u||8),n=n.map((p,v)=>k({index:v,label:f(p,v,n),value:p,offset:M,size:u(p,e)})),S&&(S=m[n.length],n.push(k({index:n.length,label:"\u2026".concat(m.length-n.length," entries"),value:S,offset:M,size:u(S,e)})))):o===ve?(c=l.domain(),g=Me(l,c[0],w(c)),m.length<3&&!e.values&&c[0]!==w(c)&&(m=[c[0],w(c)]),n=m.map((p,v)=>k({index:v,label:f(p,v,m),value:p,perc:g(p)}))):(u=m.length-1,g=ye(l),n=m.map((p,v)=>k({index:v,label:f(p,v,m),value:p,perc:v?g(p):0,perc2:v===u?1:g(m[v+1])}))),a.source=n,a.add=n,this.value=n,a}});const Ke=e=>e.source.x,Je=e=>e.source.y,$e=e=>e.target.x,Qe=e=>e.target.y;function L(e){h.call(this,{},e)}L.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},y(L,h,{transform(e,t){var i=e.sourceX||Ke,a=e.sourceY||Je,n=e.targetX||$e,o=e.targetY||Qe,l=e.as||"path",r=e.orient||"vertical",s=e.shape||"line",d=te.get(s+"-"+r)||te.get(s);return d||b("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,f=>{f[l]=d(i(f),a(f),n(f),o(f))}),t.reflow(e.modified()).modifies(l)}});const Q=(e,t,i,a)=>"M"+e+","+t+"L"+i+","+a,_e=(e,t,i,a)=>Q(t*Math.cos(e),t*Math.sin(e),a*Math.cos(i),a*Math.sin(i)),_=(e,t,i,a)=>{var n=i-e,o=a-t,l=Math.sqrt(n*n+o*o)/2,r=180*Math.atan2(o,n)/Math.PI;return"M"+e+","+t+"A"+l+","+l+" "+r+" 0 1 "+i+","+a},et=(e,t,i,a)=>_(t*Math.cos(e),t*Math.sin(e),a*Math.cos(i),a*Math.sin(i)),ee=(e,t,i,a)=>{const n=i-e,o=a-t,l=.2*(n+o),r=.2*(o-n);return"M"+e+","+t+"C"+(e+l)+","+(t+r)+" "+(i+r)+","+(a-l)+" "+i+","+a},tt=(e,t,i,a)=>ee(t*Math.cos(e),t*Math.sin(e),a*Math.cos(i),a*Math.sin(i)),nt=(e,t,i,a)=>"M"+e+","+t+"V"+a+"H"+i,it=(e,t,i,a)=>"M"+e+","+t+"H"+i+"V"+a,at=(e,t,i,a)=>{const n=Math.cos(e),o=Math.sin(e),l=Math.cos(i),r=Math.sin(i),s=Math.abs(i-e)>Math.PI?i<=e:i>e;return"M"+t*n+","+t*o+"A"+t+","+t+" 0 0,"+(s?1:0)+" "+t*l+","+t*r+"L"+a*l+","+a*r},ot=(e,t,i,a)=>{const n=(e+i)/2;return"M"+e+","+t+"C"+n+","+t+" "+n+","+a+" "+i+","+a},rt=(e,t,i,a)=>{const n=(t+a)/2;return"M"+e+","+t+"C"+e+","+n+" "+i+","+n+" "+i+","+a},lt=(e,t,i,a)=>{const n=Math.cos(e),o=Math.sin(e),l=Math.cos(i),r=Math.sin(i),s=(t+a)/2;return"M"+t*n+","+t*o+"C"+s*n+","+s*o+" "+s*l+","+s*r+" "+a*l+","+a*r},te=G({line:Q,"line-radial":_e,arc:_,"arc-radial":et,curve:ee,"curve-radial":tt,"orthogonal-horizontal":nt,"orthogonal-vertical":it,"orthogonal-radial":at,"diagonal-horizontal":ot,"diagonal-vertical":rt,"diagonal-radial":lt});function P(e){h.call(this,null,e)}P.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},y(P,h,{transform(e,t){var i=e.as||["startAngle","endAngle"],a=i[0],n=i[1],o=e.field||W,l=e.startAngle||0,r=e.endAngle!=null?e.endAngle:2*Math.PI,s=t.source,d=s.map(o),f=d.length,m=l,c=(r-l)/Ge(d),g=Z(f),u,M,S;for(e.sort&&g.sort((p,v)=>d[p]-d[v]),u=0;u<f;++u)S=d[g[u]],M=s[g[u]],M[a]=m,M[n]=m+=S*c;return this.value=d,t.reflow(e.modified()).modifies(i)}});const st=5;function dt(e){const t=e.type;return!e.bins&&(t===R||t===F||t===j)}function ne(e){return U(e)&&e!==z}const ft=je(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function ie(e){h.call(this,null,e),this.modified(!0)}y(ie,h,{transform(e,t){var i=t.dataflow,a=this.value,n=mt(e);(!a||n!==a.type)&&(this.value=a=Se(n)());for(n in e)if(!ft[n]){if(n==="padding"&&ne(a.type))continue;D(a[n])?a[n](e[n]):i.warn("Unsupported scale property: "+n)}return vt(a,e,pt(a,e,ut(a,e,i))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function mt(e){var t=e.type,i="",a;return t===z?z+"-"+R:(ct(e)&&(a=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,i=a===2?z+"-":a===3?Ue+"-":""),(i+t||R).toLowerCase())}function ct(e){const t=e.type;return U(t)&&t!==ke&&t!==xe&&(e.scheme||e.range&&e.range.length&&e.range.every(Te))}function ut(e,t,i){const a=ht(e,t.domainRaw,i);if(a>-1)return a;var n=t.domain,o=e.type,l=t.zero||t.zero===void 0&&dt(e),r,s;if(!n)return 0;if(ne(o)&&t.padding&&n[0]!==w(n)&&(n=gt(o,n,t.range,t.padding,t.exponent,t.constant)),(l||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(r=(n=n.slice()).length-1||1,l&&(n[0]>0&&(n[0]=0),n[r]<0&&(n[r]=0)),t.domainMin!=null&&(n[0]=t.domainMin),t.domainMax!=null&&(n[r]=t.domainMax),t.domainMid!=null)){s=t.domainMid;const d=s>n[r]?r+1:s<n[0]?0:r;d!==r&&i.warn("Scale domainMid exceeds domain min or max.",s),n.splice(d,0,s)}return e.domain(ae(o,n,i)),o===T&&e.unknown(t.domainImplicit?De:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&A(e,t.nice)||null),n.length}function ht(e,t,i){return t?(e.domain(ae(e.type,t,i)),t.length):-1}function gt(e,t,i,a,n,o){var l=Math.abs(w(i)-i[0]),r=l/(l-2*a),s=e===be?Ye(t,null,r):e===j?B(t,null,r,.5):e===F?B(t,null,r,n||1):e===we?Xe(t,null,r,o||1):Ve(t,null,r);return t=t.slice(),t[0]=s[0],t[t.length-1]=s[1],t}function ae(e,t,i){if(ze(e)){var a=Math.abs(t.reduce((n,o)=>n+(o<0?-1:o>0?1:0),0));a!==t.length&&i.warn("Log scale domain includes zero: "+qe(t))}return t}function pt(e,t,i){let a=t.bins;if(a&&!C(a)){const n=e.domain(),o=n[0],l=w(n),r=a.step;let s=a.start==null?o:a.start,d=a.stop==null?l:a.stop;r||b("Scale bins parameter missing step property."),s<o&&(s=r*Math.ceil(o/r)),d>l&&(d=r*Math.floor(l/r)),a=Z(s,d+r/2,r)}return a?e.bins=a:e.bins&&delete e.bins,e.type===Y&&(a?!t.domain&&!t.domainRaw&&(e.domain(a),i=a.length):e.bins=e.domain()),i}function vt(e,t,i){var a=e.type,n=t.round||!1,o=t.range;if(t.rangeStep!=null)o=Mt(a,t,i);else if(t.scheme&&(o=yt(a,t,i),D(o))){if(e.interpolator)return e.interpolator(o);b("Scale type ".concat(a," does not support interpolating color schemes."))}if(o&&X(a))return e.interpolator(V(E(o,t.reverse),t.interpolate,t.interpolateGamma));o&&t.interpolate&&e.interpolate?e.interpolate(Re(t.interpolate,t.interpolateGamma)):D(e.round)?e.round(n):D(e.rangeRound)&&e.interpolate(n?We:Be),o&&e.range(E(o,t.reverse))}function Mt(e,t,i){e!==Le&&e!==q&&b("Only band and point scales support rangeStep.");var a=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,n=e===q?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*Ce(i,n,a)]}function yt(e,t,i){var a=t.schemeExtent,n,o;return C(t.scheme)?o=V(t.scheme,t.interpolate,t.interpolateGamma):(n=t.scheme.toLowerCase(),o=Pe(n),o||b("Unrecognized scheme name: ".concat(t.scheme))),i=e===Ee?i+1:e===Y?i-1:e===Ie||e===Ne?+t.schemeCount||st:i,X(e)?oe(o,a,t.reverse):D(o)?Oe(oe(o,a),i):e===T?o:o.slice(0,i)}function oe(e,t,i){return D(e)&&(t||i)?Ae(e,E(t||[0,1],i)):e}function E(e,t){return t?e.slice().reverse():e}function re(e){h.call(this,null,e)}y(re,h,{transform(e,t){const i=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return i&&t.source.sort(N(e.sort)),this.modified(i),t}});const le="zero",se="center",de="normalize",fe=["y0","y1"];function I(e){h.call(this,null,e)}I.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:le,values:[le,se,de]},{name:"as",type:"string",array:!0,length:2,default:fe}]},y(I,h,{transform(e,t){var i=e.as||fe,a=i[0],n=i[1],o=N(e.sort),l=e.field||W,r=e.offset===se?St:e.offset===de?kt:xt,s,d,f,m;for(s=Dt(t.source,e.groupby,o,l),d=0,f=s.length,m=s.max;d<f;++d)r(s[d],m,l,a,n);return t.reflow(e.modified()).modifies(i)}});function St(e,t,i,a,n){for(var o=(t-e.sum)/2,l=e.length,r=0,s;r<l;++r)s=e[r],s[a]=o,s[n]=o+=Math.abs(i(s))}function kt(e,t,i,a,n){for(var o=1/e.sum,l=0,r=e.length,s=0,d=0,f;s<r;++s)f=e[s],f[a]=l,f[n]=l=o*(d+=Math.abs(i(f)))}function xt(e,t,i,a,n){for(var o=0,l=0,r=e.length,s=0,d,f;s<r;++s)f=e[s],d=+i(f),d<0?(f[a]=l,f[n]=l+=d):(f[a]=o,f[n]=o+=d)}function Dt(e,t,i,a){var n=[],o=M=>M(f),l,r,s,d,f,m,c,g,u;if(t==null)n.push(e.slice());else for(l={},r=0,s=e.length;r<s;++r)f=e[r],m=t.map(o),c=l[m],c||(l[m]=c=[],n.push(c)),c.push(f);for(m=0,u=0,d=n.length;m<d;++m){for(c=n[m],r=0,g=0,s=c.length;r<s;++r)g+=Math.abs(a(c[r]));c.sum=g,g>u&&(u=g),i&&c.sort(i)}return n.max=u,n}export{H as axisticks,K as datajoin,J as encode,$ as legendentries,L as linkpath,P as pie,ie as scale,re as sortitems,I as stack};export default null;
