import{hasOwnProperty as sn,isNumber as Y,isString as N,writeConfig as $f,splitAccessPath as on,stringValue as I,isObject as H,isBoolean as Dn,isArray as j,array as V,logger as Ef,Warn as kf,isFunction as Cf,mergeConfig as ea,identity as Ff}from"/-/vega-util@v1.17.0-uRskU0IBL2vWCP4Va8OC/dist=es2020,mode=imports,min/optimized/vega-util.js";import"/-/array-flat-polyfill@v1.0.1-l3YUpM9vpzkxx3sm0lhL/dist=es2020,mode=imports,min/optimized/array-flat-polyfill.js";import Nf from"/-/clone@v2.1.2-inH2VLNzDGiYU9HUWyZM/dist=es2020,mode=imports,min/optimized/clone.js";import Pf from"/-/fast-deep-equal@v3.1.3-ysejKs1WDEDPxUJhgGoP/dist=es2020,mode=imports,min/optimized/fast-deep-equal.js";import Pr from"/-/fast-json-stable-stringify@v2.1.0-HLgsuOtxPikt0pw16nth/dist=es2020,mode=imports,min/optimized/fast-json-stable-stringify.js";import{isObject as ta,writeConfig as Tf,isArray as na,isString as Si}from"/-/vega@v5.22.1-1GozmoxV3boOt3w4YuEn/dist=es2020,mode=imports,min/optimized/vega.js";import{parseSelector as an}from"/-/vega-event-selector@v3.0.0-l4odHnkvkuEDkNxAGBfX/dist=es2020,mode=imports,min/optimized/vega-event-selector.js";import{parseExpression as Af}from"/-/vega-expression@v5.0.0-kP0F2avA8xgwhtleXksI/dist=es2020,mode=imports,min/optimized/vega-expression.js";const zf="vega-lite",If='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',Rf="5.2.0",Lf=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],Mf="https://vega.github.io/vega-lite/",Df="Vega-Lite is a concise high-level language for interactive visualization.",Uf=["vega","chart","visualization"],Wf="build/vega-lite.js",Bf="build/vega-lite.min.js",Hf="build/vega-lite.min.js",qf="build/src/index",Gf="build/src/index.d.ts",Vf={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},Xf=["bin","build","src","vega-lite*","tsconfig.json"],Yf={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",jest:"NODE_OPTIONS=--experimental-vm-modules npx jest",test:"yarn jest test/ && yarn lint && yarn schema && yarn jest examples/ && yarn test:runtime","test:cover":"yarn jest --collectCoverage test/","test:inspect":"node --inspect-brk --experimental-vm-modules ./node_modules/.bin/jest --runInBand test","test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"yarn jest --watch test/","watch:test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest --watch test-runtime/ --config test-runtime/jest-config.json",release:"yarn run prebuild && yarn build && yarn shipit",shipit:"auto shipit"},Kf={type:"git",url:"https://github.com/vega/vega-lite.git"},Qf="BSD-3-Clause",Zf={url:"https://github.com/vega/vega-lite/issues"},Jf={"@auto-it/conventional-commits":"^10.34.1","@auto-it/first-time-contributor":"^10.34.1","@babel/core":"^7.17.5","@babel/preset-env":"^7.16.11","@babel/preset-typescript":"^7.16.7","@rollup/plugin-alias":"^3.1.9","@rollup/plugin-babel":"^5.3.1","@rollup/plugin-commonjs":"^22.0.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^13.1.3","@types/chai":"^4.3.0","@types/d3":"^7.1.0","@types/jest":"^27.4.1","@types/mkdirp":"^1.0.2","@types/pako":"^2.0.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0",ajv:"^8.10.0","ajv-formats":"^2.1.1",auto:"^10.34.1",chai:"^4.3.6",cheerio:"^1.0.0-rc.10","conventional-changelog-cli":"^2.2.2",d3:"^7.4.4","del-cli":"^5.0.0",eslint:"^8.11.0","eslint-config-prettier":"^8.5.0","eslint-plugin-jest":"^26.1.1","eslint-plugin-prettier":"^4.0.0","gh-pages":"^4.0.0","highlight.js":"^11.5.0",jest:"^27.5.1","jest-dev-server":"^6.0.3",mkdirp:"^1.0.4",pako:"^2.0.4",prettier:"^2.5.1",puppeteer:"^15.0.0",rollup:"^2.70.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3","rollup-plugin-terser":"^7.0.2",serve:"^14.0.1",terser:"^5.12.1","ts-jest":"^27.1.3","ts-json-schema-generator":"^1.0.0","vega-cli":"^5.22.0",typescript:"~4.7.2","vega-datasets":"~2.4.0","vega-embed":"^6.20.8","vega-tooltip":"^0.28.0","yaml-front-matter":"^4.1.1"},ed={"@types/clone":"~2.1.1","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.4.0","vega-event-selector":"~3.0.0","vega-expression":"~5.0.0","vega-util":"~1.17.0",yargs:"~17.5.1"},td={vega:"^5.22.0"},nd={node:">=12"};var id={name:zf,author:If,version:Rf,collaborators:Lf,homepage:Mf,description:Df,keywords:Uf,main:Wf,unpkg:Bf,jsdelivr:Hf,module:qf,types:Gf,bin:Vf,files:Xf,scripts:Yf,repository:Kf,license:Qf,bugs:Zf,devDependencies:Jf,dependencies:ed,peerDependencies:td,engines:nd};function Tr(e){return!!e.or}function Ar(e){return!!e.and}function zr(e){return!!e.not}function _i(e,t){if(zr(e))_i(e.not,t);else if(Ar(e))for(const n of e.and)_i(n,t);else if(Tr(e))for(const n of e.or)_i(n,t);else t(e)}function cn(e,t){return zr(e)?{not:cn(e.not,t)}:Ar(e)?{and:e.and.map(n=>cn(n,t))}:Tr(e)?{or:e.or.map(n=>cn(n,t))}:t(e)}const Ie=Pf,F=Nf;function ia(e){throw new Error(e)}function ln(e,t){const n={};for(const i of t)sn(e,i)&&(n[i]=e[i]);return n}function be(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>Pr(e)).join(",")})`};const D=Pr;function A(e){if(Y(e))return e;const t=N(e)?e:Pr(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function Ir(e){return e===!1||e===null}function z(e,t){return e.includes(t)}function Rt(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function Rr(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function ra(e,...t){for(const n of t)rd(e,n??{});return e}function rd(e,t){for(const n of v(t))$f(e,n,t[n],!0)}function Re(e,t){const n=[],i={};let r;for(const s of e){if(r=t(s),r in i)continue;i[r]=1,n.push(s)}return n}function sd(e,t){const n=v(e),i=v(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function sa(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Lr(e,t){for(const n of e)if(t.has(n))return!0;return!1}function Mr(e){const t=new Set;for(const n of e){const i=on(n),r=i.map((o,a)=>a===0?o:`[${o}]`),s=r.map((o,a)=>r.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function Dr(e,t){return e===void 0||t===void 0?!0:Lr(Mr(e),Mr(t))}function L(e){return v(e).length===0}const v=Object.keys,ie=Object.values,ht=Object.entries;function Un(e){return e===!0||e===!1}function q(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Wn(e,t){return zr(e)?`!(${Wn(e.not,t)})`:Ar(e)?`(${e.and.map(n=>Wn(n,t)).join(") && (")})`:Tr(e)?`(${e.or.map(n=>Wn(n,t)).join(") || (")})`:t(e)}function ji(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&ji(e[n],t)&&delete e[n],L(e)}function Bn(e){return e.charAt(0).toUpperCase()+e.substr(1)}function Ur(e,t="datum"){const n=on(e),i=[];for(let r=1;r<=n.length;r++){const s=`[${n.slice(0,r).map(I).join("][")}]`;i.push(`${t}${s}`)}return i.join(" && ")}function oa(e,t="datum"){return`${t}[${I(on(e).join("."))}]`}function od(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function xe(e){return`${on(e).map(od).join("\\.")}`}function Lt(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Wr(e){return`${on(e).join(".")}`}function un(e){return e?on(e).length:0}function K(...e){for(const t of e)if(t!==void 0)return t;return}let aa=42;function ca(e){const t=++aa;return e?String(e)+t:t}function ad(){aa=42}function la(e){return ua(e)?e:`__${e}`}function ua(e){return e.startsWith("__")}function Hn(e){return e===void 0?void 0:(e%360+360)%360}function wi(e){return Y(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}var qn=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const nt="row",it="column",$i="facet",G="x",J="y",Ee="x2",Le="y2",bt="xOffset",fn="yOffset",ke="radius",rt="radius2",Se="theta",st="theta2",Me="latitude",De="longitude",Ce="latitude2",_e="longitude2",ue="color",Ue="fill",We="stroke",fe="shape",ot="size",Mt="angle",at="opacity",yt="fillOpacity",vt="strokeOpacity",Ot="strokeWidth",xt="strokeDash",Gn="text",Vn="order",Xn="detail",Ei="key",Dt="tooltip",ki="href",Ci="url",Fi="description",cd={x:1,y:1,x2:1,y2:1},fa={theta:1,theta2:1,radius:1,radius2:1};function da(e){return e in fa}const Br={longitude:1,longitude2:1,latitude:1,latitude2:1};function ld(e){switch(e){case Me:return"y";case Ce:return"y2";case De:return"x";case _e:return"x2"}}function ud(e){return e in Br}const fd=v(Br),Hr=Object.assign(Object.assign(Object.assign(Object.assign({},cd),fa),Br),{xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function dn(e){return e===ue||e===Ue||e===We}const ga={row:1,column:1,facet:1},je=v(ga),qr=Object.assign(Object.assign({},Hr),ga),dd=v(qr),gd=qn(qr,["order","detail","tooltip"]),pd=qn(gd,["row","column","facet"]);function md(e){return!!pd[e]}function pa(e){return!!qr[e]}const hd=[Ee,Le,Ce,_e,st,rt];function ma(e){const t=Ut(e);return t!==e}function Ut(e){switch(e){case Ee:return G;case Le:return J;case Ce:return Me;case _e:return De;case st:return Se;case rt:return ke}return e}function St(e){if(da(e))switch(e){case Se:return"startAngle";case st:return"endAngle";case ke:return"outerRadius";case rt:return"innerRadius"}return e}function ct(e){switch(e){case G:return Ee;case J:return Le;case Me:return Ce;case De:return _e;case Se:return st;case ke:return rt}return}function de(e){switch(e){case G:case Ee:return"width";case J:case Le:return"height"}return}function bd(e){switch(e){case G:return"xOffset";case J:return"yOffset";case Ee:return"x2Offset";case Le:return"y2Offset";case Se:return"thetaOffset";case ke:return"radiusOffset";case st:return"theta2Offset";case rt:return"radius2Offset"}return}function ha(e){switch(e){case G:return"xOffset";case J:return"yOffset"}return}function ba(e){switch(e){case"xOffset":return"x";case"yOffset":return"y"}}const yd=v(Hr),Gr=qn(Hr,["x","y","x2","y2","xOffset","yOffset","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),vd=v(Gr),Vr={x:1,y:1},Be=v(Vr);function ee(e){return e in Vr}const Xr={theta:1,radius:1},Od=v(Xr);function Ni(e){return e==="width"?G:J}const ya={xOffset:1,yOffset:1};function gn(e){return e in ya}const va=qn(Gr,["text","tooltip","href","url","description","detail","key","order"]),xd=v(va);function Sd(e){return!!Gr[e]}function _d(e){switch(e){case ue:case Ue:case We:case ot:case fe:case at:case Ot:case xt:return!0;case yt:case vt:case Mt:return!1}}const Oa=Object.assign(Object.assign(Object.assign(Object.assign({},Vr),Xr),ya),va),Pi=v(Oa);function _t(e){return!!Oa[e]}function jd(e,t){return $d(e)[t]}const xa={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},wd=qn(xa,["geoshape"]);function $d(e){switch(e){case ue:case Ue:case We:case Fi:case Xn:case Ei:case Dt:case ki:case Vn:case at:case yt:case vt:case Ot:case $i:case nt:case it:return xa;case G:case J:case bt:case fn:case Me:case De:return wd;case Ee:case Le:case Ce:case _e:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case ot:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case xt:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case fe:return{point:"always",geoshape:"always"};case Gn:return{text:"always"};case Mt:return{point:"always",square:"always",text:"always"};case Ci:return{image:"always"};case Se:return{text:"always",arc:"always"};case ke:return{text:"always",arc:"always"};case st:case rt:return{arc:"always"}}}function Yr(e){switch(e){case G:case J:case Se:case ke:case bt:case fn:case ot:case Mt:case Ot:case at:case yt:case vt:case Ee:case Le:case st:case rt:return;case $i:case nt:case it:case fe:case xt:case Gn:case Dt:case ki:case Ci:case Fi:return"discrete";case ue:case Ue:case We:return"flexible";case Me:case De:case Ce:case _e:case Xn:case Ei:case Vn:return}}const Ed={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},kd={count:1,min:1,max:1};function lt(e){return!!e&&!!e.argmin}function jt(e){return!!e&&!!e.argmax}function Kr(e){return N(e)&&!!Ed[e]}const Cd=new Set(["count","valid","missing","distinct"]);function Sa(e){return N(e)&&Cd.has(e)}function Fd(e){return N(e)&&z(["min","max"],e)}const Nd=new Set(["count","sum","distinct","valid","missing"]),Pd=new Set(["mean","average","median","q1","q3","min","max"]);function _a(e){return Dn(e)&&(e=Ki(e,void 0)),"bin"+v(e).map(t=>Ti(e[t])?q(`_${t}_${ht(e[t])}`):q(`_${t}_${e[t]}`)).join("")}function U(e){return e===!0||Wt(e)&&!e.binned}function ae(e){return e==="binned"||Wt(e)&&e.binned===!0}function Wt(e){return H(e)}function Ti(e){return e==null?void 0:e.param}function ja(e){switch(e){case nt:case it:case ot:case ue:case Ue:case We:case Ot:case at:case yt:case vt:case fe:return 6;case xt:return 4;default:return 10}}function Yn(e){return!!(e==null?void 0:e.expr)}function ge(e){const t=v(e||{}),n={};for(const i of t)n[i]=ye(e[i]);return n}var Td=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function wa(e){const{anchor:t,frame:n,offset:i,orient:r,angle:s,limit:o,color:a,subtitleColor:c,subtitleFont:l,subtitleFontSize:u,subtitleFontStyle:f,subtitleFontWeight:d,subtitleLineHeight:g,subtitlePadding:p}=e,h=Td(e,["anchor","frame","offset","orient","angle","limit","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),m=Object.assign(Object.assign({},h),a?{fill:a}:{}),b=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),s!==void 0?{angle:s}:{}),o!==void 0?{limit:o}:{}),y=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},c?{subtitleColor:c}:{}),l?{subtitleFont:l}:{}),u?{subtitleFontSize:u}:{}),f?{subtitleFontStyle:f}:{}),d?{subtitleFontWeight:d}:{}),g?{subtitleLineHeight:g}:{}),p?{subtitlePadding:p}:{}),S=ln(e,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:m,subtitleMarkConfig:S,nonMarkTitleProperties:b,subtitle:y}}function wt(e){return N(e)||j(e)&&N(e[0])}function w(e){return!!(e==null?void 0:e.signal)}function $t(e){return!!e.step}function Ad(e){return j(e)?!1:"fields"in e&&!("data"in e)}function zd(e){return j(e)?!1:"fields"in e&&"data"in e}function ut(e){return j(e)?!1:"field"in e&&"data"in e}const Id={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},Rd=v(Id),Ld={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Qr=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];var Zr=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function $a(e){const t=j(e.condition)?e.condition.map(Ea):Ea(e.condition);return Object.assign(Object.assign({},ye(e)),{condition:t})}function ye(e){if(Yn(e)){const{expr:t}=e,n=Zr(e,["expr"]);return Object.assign({signal:t},n)}return e}function Ea(e){if(Yn(e)){const{expr:t}=e,n=Zr(e,["expr"]);return Object.assign({signal:t},n)}return e}function B(e){if(Yn(e)){const{expr:t}=e,n=Zr(e,["expr"]);return Object.assign({signal:t},n)}return w(e)?e:e!==void 0?{value:e}:void 0}function Md(e){return w(e)?e.signal:I(e)}function ka(e){return w(e)?e.signal:I(e.value)}function ft(e){return w(e)?e.signal:e==null?null:I(e)}function Dd(e,t,n){for(const i of n){const r=Bt(i,t.markDef,t.config);r!==void 0&&(e[i]=B(r))}return e}function Ca(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function R(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:s&&(!r||r===e)?void 0:Bt(e,t,n,i)}function Bt(e,t,n,{vgChannel:i}={}){return K(i?Ai(e,t,n.style):void 0,Ai(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function Ai(e,t,n){return Fa(e,Ca(t),n)}function Fa(e,t,n){t=V(t);let i;for(const r of t){const s=n[r];s&&s[e]!==void 0&&(i=s[e])}return i}function Na(e,t){return V(e).reduce((n,i)=>{var r;return n.field.push(_(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function Pa(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Ie(r,i))return;n.push(i)}),n}function Ta(e,t){return Ie(e,t)||!t?e:e?[...V(e),...V(t)].join(", "):t}function Aa(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((wt(n)||w(n))&&(wt(i)||w(i)))return{explicit:e.explicit,value:Ta(n,i)};if(wt(n)||w(n))return{explicit:e.explicit,value:n};if(wt(i)||w(i))return{explicit:e.explicit,value:i};if(!wt(n)&&!w(n)&&!wt(i)&&!w(i))return{explicit:e.explicit,value:Pa(n,i)};throw new Error("It should never reach here")}function Jr(e){return`Invalid specification ${D(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Ud='Autosize "fit" only works for single views and layered views.';function za(e){const t=e=="width"?"Width":"Height";return`${t} "container" only works for single views and layered views.`}function Ia(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function Ra(e){return e?`Dropping "fit-${e}" because spec has discrete ${de(e)}.`:'Dropping "fit" because spec has discrete size.'}function es(e){return`Unknown field for ${e}. Cannot calculate view size.`}function La(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Wd(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Bd(e){return`The "nearest" transform is not supported for ${e} marks.`}function Ma(e){return`Selection not supported for ${e} yet.`}function Hd(e){return`Cannot find a selection named "${e}".`}const qd="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Gd="Legend bindings are only supported for selections over an individual field or encoding channel.";function Vd(e){return`Lookups can only be performed on selection parameters. "${e}" is a variable parameter.`}function Xd(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const Yd="The same selection must be used to override scale domains in a layered view.",Kd='Interval selections should be initialized using "x" and/or "y" keys.';function Qd(e){return`Unknown repeated value "${e}".`}function Da(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const Zd="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Jd(e){return`Unrecognized parse "${e}".`}function Ua(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const eg="Attempt to add the same child twice.";function tg(e){return`Ignoring an invalid transform: ${D(e)}.`}const ng='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function Wa(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function ig(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${D(t)} is overridden by a child projection ${D(n)}.`}const rg="Arc marks uses theta channel rather than angle, replacing angle with theta.";function sg(e){return`${e}Offset dropped because ${e} is continuous`}function og(e){return`There is no ${e} encoding. Replacing ${e}Offset encoding as ${e}.`}function ag(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${D(n)}}.`}function Ba(e){return`Invalid field type "${e}".`}function cg(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function lg(e){return`Invalid aggregation operator "${e}".`}function Ha(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function ug(e){return`Position range does not support relative band size for ${e}.`}function ts(e,t){return`Dropping ${D(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const fg="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function zi(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function dg(e){return`${e} encoding has no scale, so specified scale is ignored.`}function gg(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function pg(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function mg(e){return`${e} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function hg(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function ns(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function bg(e){return`The ${e} for range marks cannot be an expression`}function yg(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function vg(e,t){return`Specified orient "${e}" overridden with "${t}".`}function Og(e){return`Cannot use the scale property "${e}" with non-color channel.`}function xg(e){return`Cannot use the relative band size with ${e} scale.`}function Sg(e){return`Using unaggregated domain with raw field has no effect (${D(e)}).`}function _g(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function jg(e){return`Unaggregated domain is currently unsupported for log scale (${D(e)}).`}function wg(e){return`Cannot apply size to non-oriented mark "${e}".`}function $g(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Eg(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function qa(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function Ga(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function kg(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${D(n)} and ${D(i)}). Using ${D(n)}.`}function Cg(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${D(n)} and ${D(i)}). Using the union of the two domains.`}function Fg(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Ng(e){return`Dropping sort property ${D(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const Va="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Pg="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Tg="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Ag="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function zg(e){return`Cannot stack "${e}" if there is already "${e}2".`}function Ig(e){return`Cannot stack non-linear scale (${e}).`}function Rg(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Ii(e,t){return`Invalid ${e}: ${D(t)}.`}function Lg(e){return`Dropping day from datetime ${D(e)} as day cannot be combined with other units.`}function Mg(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function Dg(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Ug(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Xa(e){return`1D error band does not support ${e}.`}function Ya(e){return`Channel ${e} is required for "binned" bin.`}function Wg(e){return`Channel ${e} should not be used with "binned" bin.`}function Bg(e){return`Domain for ${e} is required for threshold scale.`}var JO=function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},ex=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)};const Ka=Ef(kf);let pn=Ka;function Hg(e){return pn=e,pn}function qg(){return pn=Ka,pn}function O(...e){pn.warn(...e)}function Gg(...e){pn.debug(...e)}function Ht(e){if(e&&H(e)){for(const t of rs)if(t in e)return!0}return!1}const Qa=["january","february","march","april","may","june","july","august","september","october","november","december"],Vg=Qa.map(e=>e.substr(0,3)),Za=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Xg=Za.map(e=>e.substr(0,3));function Yg(e){if(wi(e)&&(e=+e),Y(e))return e>4&&O(Ii("quarter",e)),e-1;throw new Error(Ii("quarter",e))}function Kg(e){if(wi(e)&&(e=+e),Y(e))return e-1;{const t=e.toLowerCase(),n=Qa.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Vg.indexOf(i);if(r!==-1)return r;throw new Error(Ii("month",e))}}function Qg(e){if(wi(e)&&(e=+e),Y(e))return e%7;{const t=e.toLowerCase(),n=Za.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Xg.indexOf(i);if(r!==-1)return r;throw new Error(Ii("day",e))}}function is(e,t){const n=[];if(t&&e.day!==void 0&&(v(e).length>1&&(O(Lg(e)),e=F(e),delete e.day)),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Kg(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Yg(e.quarter):e.quarter;n.push(Y(i)?i*3:`${i}*3`)}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Qg(e.day):e.day;n.push(Y(i)?i+1:`${i}+1`)}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function Kn(e){const t=is(e,!0),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Zg(e){const t=is(e,!1),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Jg(e){const t=is(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}var ep=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ja={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},rs=v(Ja);function tp(e){return!!Ja[e]}function ss(e){return e.startsWith("utc")}function np(e){return e.substr(3)}const ip={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function os(e){return rs.filter(t=>ec(e,t))}function ec(e,t){const n=e.indexOf(t);return n<0||(n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")?!1:!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function rp(e,t,{end:n}={end:!1}){const i=Ur(t),r=ss(e)?"utc":"";function s(c){return c==="quarter"?`(${r}quarter(${i})-1)`:`${r}${c}(${i})`}let o;const a={};for(const c of rs)ec(e,c)&&(a[c]=s(c),o=c);return n&&(a[o]+="+1"),Zg(a)}function tc(e){if(!e)return;const t=os(e);return`timeUnitSpecifier(${D(t)}, ${D(ip)})`}function sp(e,t,n){if(!e)return;const i=tc(e),r=n||ss(e);return`${r?"utc":"time"}Format(${t}, ${i})`}function re(e){if(!e)return;let t;return N(e)?t={unit:e}:H(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),ss(t.unit)&&(t.utc=!0,t.unit=np(t.unit)),t}function op(e){const t=re(e),{utc:n}=t,i=ep(t,["utc"]);return i.unit?(n?"utc":"")+v(i).map(r=>q(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+v(i).map(r=>q(`_${r}_${i[r]}`)).join("")}function ap(e){return e==null?void 0:e.param}function as(e){return!!(e==null?void 0:e.field)&&e.equal!==void 0}function cs(e){return!!(e==null?void 0:e.field)&&e.lt!==void 0}function ls(e){return!!(e==null?void 0:e.field)&&e.lte!==void 0}function us(e){return!!(e==null?void 0:e.field)&&e.gt!==void 0}function fs(e){return!!(e==null?void 0:e.field)&&e.gte!==void 0}function ds(e){if(e==null?void 0:e.field){if(j(e.range)&&e.range.length===2)return!0;if(w(e.range))return!0}return!1}function gs(e){return!!(e==null?void 0:e.field)&&(j(e.oneOf)||j(e.in))}function cp(e){return!!(e==null?void 0:e.field)&&e.valid!==void 0}function nc(e){return gs(e)||as(e)||ds(e)||cs(e)||us(e)||ls(e)||fs(e)}function He(e,t){return Qi(e,{timeUnit:t,wrapTime:!0})}function lp(e,t){return e.map(n=>He(n,t))}function ic(e,t=!0){var n;const{field:i}=e,r=(n=re(e.timeUnit))===null||n===void 0?void 0:n.unit,s=r?`time(${rp(r,i)})`:_(e,{expr:"datum"});if(as(e))return`${s}===${He(e.equal,r)}`;if(cs(e)){const o=e.lt;return`${s}<${He(o,r)}`}else if(us(e)){const o=e.gt;return`${s}>${He(o,r)}`}else if(ls(e)){const o=e.lte;return`${s}<=${He(o,r)}`}else if(fs(e)){const o=e.gte;return`${s}>=${He(o,r)}`}else{if(gs(e))return`indexof([${lp(e.oneOf,r).join(",")}], ${s}) !== -1`;if(cp(e))return ps(s,e.valid);if(ds(e)){const{range:o}=e,a=w(o)?{signal:`${o.signal}[0]`}:o[0],c=w(o)?{signal:`${o.signal}[1]`}:o[1];if(a!==null&&c!==null&&t)return"inrange("+s+", ["+He(a,r)+", "+He(c,r)+"])";const l=[];return a!==null&&l.push(`${s} >= ${He(a,r)}`),c!==null&&l.push(`${s} <= ${He(c,r)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${D(e)}`)}function ps(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function up(e){var t;return nc(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=re(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Qn={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function fp(e){return e==="quantitative"||e==="temporal"}function rc(e){return e==="ordinal"||e==="nominal"}const qt=Qn.quantitative,ms=Qn.ordinal,mn=Qn.temporal,hs=Qn.nominal,hn=Qn.geojson;function dp(e){if(e){e=e.toLowerCase();switch(e){case"q":case qt:return"quantitative";case"t":case mn:return"temporal";case"o":case ms:return"ordinal";case"n":case hs:return"nominal";case hn:return"geojson"}}return}var gp=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const pe={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},bs={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function pp(e,t){const n=bs[e],i=bs[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const mp={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function sc(e){return mp[e]}const oc=new Set(["linear","log","pow","sqrt","symlog"]),ac=new Set([...oc,"time","utc"]);function cc(e){return oc.has(e)}const lc=new Set(["quantile","quantize","threshold"]),hp=new Set([...ac,...lc,"sequential","identity"]),bp=new Set(["ordinal","bin-ordinal","point","band"]);function te(e){return bp.has(e)}function ve(e){return hp.has(e)}function Fe(e){return ac.has(e)}function bn(e){return lc.has(e)}const yp={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function vp(e){return!N(e)&&!!e.name}function uc(e){return e==null?void 0:e.param}function Op(e){return e==null?void 0:e.unionWith}function xp(e){return ta(e)&&"field"in e}const Sp={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},_p=gp(Sp,["type","domain","range","rangeMax","rangeMin","scheme"]),jp=v(_p);function ys(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return Fe(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return Fe(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return Fe(e);case"nice":return Fe(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return ve(e)&&!z(["log","time","utc","threshold","quantile"],e)}}function fc(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return dn(e)?void 0:Og(t);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function wp(e,t){return z([ms,hs],t)?e===void 0||te(e):t===mn?z([pe.TIME,pe.UTC,void 0],e):t===qt?cc(e)||bn(e)||e===void 0:!0}function $p(e,t,n=!1){if(!_t(e))return!1;switch(e){case G:case J:case bt:case fn:case Se:case ke:return Fe(t)||t==="band"?!0:t==="point"?!n:!1;case ot:case Ot:case at:case yt:case vt:case Mt:return Fe(t)||bn(t)||z(["band","point","ordinal"],t);case ue:case Ue:case We:return t!=="band";case xt:case fe:return t==="ordinal"||bn(t)}}const ce={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},dc=ce.arc,Ri=ce.area,Li=ce.bar,Ep=ce.image,Mi=ce.line,Di=ce.point,kp=ce.rect,Ui=ce.rule,gc=ce.text,vs=ce.tick,Cp=ce.trail,Os=ce.circle,xs=ce.square,pc=ce.geoshape;function Et(e){return["line","area","trail"].includes(e)}function mc(e){return["rect","bar","image","arc"].includes(e)}const Fp=new Set(v(ce));function qe(e){return e.type}const Np=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],Pp=["fill","fillOpacity"],Tp=[...Np,...Pp],Ap={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},hc=v(Ap),zp={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},Ip={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},Rp={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},bc=v(Rp);function Gt(e){return e&&e.band!=null}const Lp={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},yc=5,Mp={binSpacing:1,continuousBandSize:yc,timeUnitBandPosition:.5},Dp={binSpacing:0,continuousBandSize:yc,timeUnitBandPosition:.5},Up={thickness:1};function Wp(e){return qe(e)?e.type:e}function Ss(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:s}=e,o=js(e);return x(n)&&!Sa(n.aggregate)&&r&&Fe(r.get("type"))?Bp({fieldDef:n,channel:t,markDef:i,ref:o,config:s}):o}function Bp({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){if(Et(n.type))return i;const s=R("invalid",n,r);return s===null?[Hp(e,t),i]:i}function Hp(e,t){const n=_s(e,!0),i=Ut(t),r=i==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function _s(e,t=!0){return ps(N(e)?e:_(e,{expr:"datum"}),!t)}function qp(e){const{datum:t}=e;return Ht(t)?Kn(t):`${D(t)}`}function Vt(e,t,n,i){const r={};if(t&&(r.scale=t),Ve(e)){const{datum:s}=e;Ht(s)?r.signal=Kn(s):w(s)?r.signal=s.signal:Yn(s)?r.signal=s.expr:r.value=s}else r.field=_(e,n);if(i){const{offset:s,band:o}=i;s&&(r.offset=s),o&&(r.band=o)}return r}function Wi({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,bandPosition:s=.5}){const o=0<s&&s<1?"datum":void 0,a=_(t,{expr:o,suffix:r}),c=n!==void 0?_(n,{expr:o}):_(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const u=s===0?a:c;l.field=u}else{const u=w(s)?`${s.signal} * ${a} + (1-${s.signal}) * ${c}`:`${s} * ${a} + ${1-s} * ${c}`;l.signal=`scale("${e}", ${u})`}return i&&(l.offset=i),l}function js({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l,bandPosition:u}){var f;if(t){if(C(t)){const d=o==null?void 0:o.get("type");if(we(t)){u??(u=Cc({fieldDef:t,fieldDef2:n,markDef:i,config:r}));const{bin:g,timeUnit:p,type:h}=t;if(U(g)||u&&p&&h===mn)return(a==null?void 0:a.impute)?Vt(t,s,{binSuffix:"mid"},{offset:c}):u&&!te(d)?Wi({scaleName:s,fieldOrDatumDef:t,bandPosition:u,offset:c}):Vt(t,s,ni(t,e)?{binSuffix:"range"}:{},{offset:c});if(ae(g)){if(x(n))return Wi({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:u,offset:c});{const m=e===G?Ee:Le;O(Ya(m))}}}return Vt(t,s,te(d)?{binSuffix:"range"}:{},{offset:c,band:d==="band"?(f=u??t.bandPosition)!==null&&f!==void 0?f:.5:void 0})}else if(Pe(t)){const d=t.value,g=c?{offset:c}:{};return Object.assign(Object.assign({},Zn(e,d)),g)}}return Cf(l)&&(l=l()),l&&Object.assign(Object.assign({},l),c?{offset:c}:{})}function Zn(e,t){return z(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:z(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:B(t)}function Xt(e){return e&&e!=="number"&&e!=="time"}function vc(e,t,n){return`${e}(${t}${n?`, ${D(n)}`:""})`}const Gp=" \u2013 ";function ws({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){var o,a;if(Xt(n))return Ne({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const c=Oc(e,i,r),l=yn(e);if(t===void 0&&n===void 0&&s.customFormatTypes){if(l==="quantitative"){if(r&&s.normalizedNumberFormatType)return Ne({fieldOrDatumDef:e,format:s.normalizedNumberFormat,formatType:s.normalizedNumberFormatType,expr:i,config:s});if(s.numberFormatType)return Ne({fieldOrDatumDef:e,format:s.numberFormat,formatType:s.numberFormatType,expr:i,config:s})}if(l==="temporal"&&s.timeFormatType&&x(e)&&e.timeUnit===void 0)return Ne({fieldOrDatumDef:e,format:s.timeFormat,formatType:s.timeFormatType,expr:i,config:s})}if(Sn(e)){const u=Xp({field:c,timeUnit:x(e)?(o=re(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,format:t,formatType:s.timeFormatType,rawTimeFormat:s.timeFormat,isUTCScale:Yt(e)&&((a=e.scale)===null||a===void 0?void 0:a.type)===pe.UTC});return u?{signal:u}:void 0}if(t=$s({type:l,specifiedFormat:t,config:s,normalizeStack:r}),x(e)&&U(e.bin)){const u=_(e,{expr:i,binSuffix:"end"});return{signal:Jn(c,u,t,n,s)}}else return t||yn(e)==="quantitative"?{signal:`${_c(c,t)}`}:{signal:`isValid(${c}) ? ${c} : ""+${c}`}}function Oc(e,t,n){return x(e)?n?`${_(e,{expr:t,suffix:"end"})}-${_(e,{expr:t,suffix:"start"})}`:_(e,{expr:t}):qp(e)}function Ne({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){if(o??(o=Oc(e,i,r)),o!=="datum.value"&&x(e)&&U(e.bin)){const a=_(e,{expr:i,binSuffix:"end"});return{signal:Jn(o,a,t,n,s)}}return{signal:vc(n,o,t)}}function xc(e,t,n,i,r,s){var o;if(Xt(i))return;if(n===void 0&&i===void 0&&r.customFormatTypes&&yn(e)==="quantitative"){if(r.normalizedNumberFormatType&&vn(e)&&e.stack==="normalize")return;if(r.numberFormatType)return}if(vn(e)&&e.stack==="normalize"&&r.normalizedNumberFormat)return $s({type:"quantitative",config:r,normalizeStack:!0});if(Sn(e)){const a=x(e)?(o=re(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return a===void 0&&r.customFormatTypes&&r.timeFormatType?void 0:Vp({specifiedFormat:n,timeUnit:a,config:r,omitTimeFormatConfig:s})}return $s({type:t,specifiedFormat:n,config:r})}function Sc(e,t,n){var i;return e&&(w(e)||e==="number"||e==="time")?e:Sn(t)&&n!=="time"&&n!=="utc"?x(t)&&((i=re(t==null?void 0:t.timeUnit))===null||i===void 0?void 0:i.utc)?"utc":"time":void 0}function $s({type:e,specifiedFormat:t,config:n,normalizeStack:i}){return N(t)?t:e===qt?i?n.normalizedNumberFormat:n.numberFormat:void 0}function Vp({specifiedFormat:e,timeUnit:t,config:n,omitTimeFormatConfig:i}){return e||(t?{signal:tc(t)}:i?void 0:n.timeFormat)}function _c(e,t){return`format(${e}, "${t||""}")`}function jc(e,t,n,i){var r;return Xt(n)?vc(n,e,t):_c(e,(r=N(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function Jn(e,t,n,i,r){if(n===void 0&&i===void 0&&r.customFormatTypes&&r.numberFormatType)return Jn(e,t,r.numberFormat,r.numberFormatType,r);const s=jc(e,n,i,r),o=jc(t,n,i,r);return`${ps(e,!1)} ? "null" : ${s} + "${Gp}" + ${o}`}function Xp({field:e,timeUnit:t,format:n,formatType:i,rawTimeFormat:r,isUTCScale:s}){return!t||n?!t&&i?`${i}(${e}, '${n}')`:(n=N(n)?n:r,`${s?"utc":"time"}Format(${e}, '${n}')`):sp(t,e,s)}const Bi="min",Yp={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function wc(e){return e in Yp}function $c(e){return!!(e==null?void 0:e.encoding)}function Ge(e){return e&&(e.op==="count"||!!e.field)}function Ec(e){return e&&j(e)}function ei(e){return"row"in e||"column"in e}function Es(e){return!!e&&"header"in e}function Hi(e){return"facet"in e}var ks=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Kp(e){return e.param}function Qp(e){return e&&!N(e)&&"repeat"in e}function kc(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function Cs(e){return"sort"in e}function Cc({fieldDef:e,fieldDef2:t,markDef:n,config:i}){if(C(e)&&e.bandPosition!==void 0)return e.bandPosition;if(x(e)){const{timeUnit:r,bin:s}=e;if(r&&!t)return mc(n.type)?0:Bt("timeUnitBandPosition",n,i);if(U(s))return .5}return}function Fc({channel:e,fieldDef:t,fieldDef2:n,markDef:i,config:r,scaleType:s,useVlSizeChannel:o}){var a,c,l;const u=de(e),f=R(o?"size":u,i,r,{vgChannel:u});if(f!==void 0)return f;if(x(t)){const{timeUnit:d,bin:g}=t;if(d&&!n)return{band:Bt("timeUnitBandSize",i,r)};if(U(g)&&!te(s))return{band:1}}return mc(i.type)?s?te(s)?((a=r[i.type])===null||a===void 0?void 0:a.discreteBandSize)||{band:1}:(c=r[i.type])===null||c===void 0?void 0:c.continuousBandSize:(l=r[i.type])===null||l===void 0?void 0:l.discreteBandSize:void 0}function Nc(e,t,n,i){return U(e.bin)||e.timeUnit&&we(e)&&e.type==="temporal"?Cc({fieldDef:e,fieldDef2:t,markDef:n,config:i})!==void 0:!1}function qi(e){return e&&"condition"in e}function Gi(e){const t=e==null?void 0:e.condition;return!!t&&!j(t)&&x(t)}function ti(e){const t=e==null?void 0:e.condition;return!!t&&!j(t)&&C(t)}function Zp(e){const t=e==null?void 0:e.condition;return!!t&&(j(t)||Pe(t))}function x(e){return e&&(!!e.field||e.aggregate==="count")}function yn(e){return e==null?void 0:e.type}function Ve(e){return e&&"datum"in e}function Xe(e){return we(e)&&!Vi(e)||Fs(e)}function Fs(e){return Ve(e)&&Y(e.datum)}function C(e){return x(e)||Ve(e)}function we(e){return e&&("field"in e||e.aggregate==="count")&&"type"in e}function Pe(e){return e&&"value"in e&&"value"in e}function Yt(e){return e&&("scale"in e||"sort"in e)}function vn(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function Pc(e){return e&&"legend"in e}function Tc(e){return e&&("format"in e||"formatType"in e)}function Jp(e){return be(e,["legend","axis","header","scale"])}function em(e){return"op"in e}function _(e,t={}){var n,i,r;let s=e.field;const o=t.prefix;let a=t.suffix,c="";if(nm(e))s=la("count");else{let l;if(!t.nofn)if(em(e))l=e.op;else{const{bin:u,aggregate:f,timeUnit:d}=e;U(u)?(l=_a(u),a=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?jt(f)?(c=`["${s}"]`,s=`argmax_${f.argmax}`):lt(f)?(c=`["${s}"]`,s=`argmin_${f.argmin}`):l=String(f):d&&(l=op(d),a=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}l&&(s=s?`${l}_${s}`:l)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),t.forAs?Wr(s):t.expr?oa(s,t.expr)+c:xe(s)+c}function Vi(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return x(e)&&!!e.bin;case"temporal":return!1}throw new Error(Ba(e.type))}function tm(e){var t;return Yt(e)&&bn((t=e.scale)===null||t===void 0?void 0:t.type)}function nm(e){return e.aggregate==="count"}function im(e,t){var n;const{field:i,bin:r,timeUnit:s,aggregate:o}=e;if(o==="count")return t.countTitle;if(U(r))return`${i} (binned)`;if(s){const a=(n=re(s))===null||n===void 0?void 0:n.unit;if(a)return`${i} (${os(a).join("-")})`}else if(o)return jt(o)?`${i} for max ${o.argmax}`:lt(o)?`${i} for min ${o.argmin}`:`${Bn(o)} of ${i}`;return i}function rm(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(jt(t))return`${r} for argmax(${t.argmax})`;if(lt(t))return`${r} for argmin(${t.argmin})`;const s=re(i),o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||U(n)&&"bin";return o?`${o.toUpperCase()}(${r})`:r}const Ac=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return rm(e);default:return im(e,t)}};let zc=Ac;function Ic(e){zc=e}function sm(){Ic(Ac)}function On(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,s;const o=(r=Ns(e))===null||r===void 0?void 0:r.title;if(!x(e))return o??e.title;const a=e,c=i?Ps(a,t):void 0;return n?K(o,a.title,c):(s=o??a.title)!==null&&s!==void 0?s:c}function Ns(e){return vn(e)&&e.axis?e.axis:Pc(e)&&e.legend?e.legend:Es(e)&&e.header?e.header:void 0}function Ps(e,t){return zc(e,t)}function Xi(e){var t;if(Tc(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=Ns(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function om(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(Cs(e)&&j(e.sort))return"ordinal";const{aggregate:i,bin:r,timeUnit:s}=e;if(s)return"temporal";if(r||i&&!jt(i)&&!lt(i))return"quantitative";if(Yt(e)&&((n=e.scale)===null||n===void 0?void 0:n.type))switch(bs[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Ye(e){return x(e)?e:Gi(e)?e.condition:void 0}function Z(e){return C(e)?e:ti(e)?e.condition:void 0}function Rc(e,t,n,i={}){if(N(e)||Y(e)||Dn(e)){const r=N(e)?"string":Y(e)?"number":"boolean";return O(ag(t,r,e)),{value:e}}return C(e)?Yi(e,t,n,i):ti(e)?Object.assign(Object.assign({},e),{condition:Yi(e.condition,t,n,i)}):e}function Yi(e,t,n,i){if(Tc(e)){const{format:r,formatType:s}=e,o=ks(e,["format","formatType"]);if(Xt(s)&&!n.customFormatTypes)return O(Wa(t)),Yi(o,t,n,i)}else{const r=vn(e)?"axis":Pc(e)?"legend":Es(e)?"header":null;if(r&&e[r]){const s=e[r],{format:o,formatType:a}=s,c=ks(s,["format","formatType"]);if(Xt(a)&&!n.customFormatTypes)return O(Wa(t)),Yi(Object.assign(Object.assign({},e),{[r]:c}),t,n,i)}}return x(e)?Ts(e,t,i):am(e)}function am(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Y(n)?"quantitative":N(n)?"nominal":Ht(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function Ts(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:o}=e,a=Object.assign({},e);if(!n&&i&&!Kr(i)&&!jt(i)&&!lt(i)&&(O(lg(i)),delete a.aggregate),r&&(a.timeUnit=re(r)),o&&(a.field=`${o}`),U(s)&&(a.bin=Ki(s,t)),ae(s)&&!ee(t)&&O(Wg(t)),we(a)){const{type:c}=a,l=dp(c);c!==l&&(a.type=l),c!=="quantitative"&&(Sa(i)&&(O(cg(c,i)),a.type="quantitative"))}else if(!ma(t)){const c=om(a,t);a.type=c}if(we(a)){const{compatible:c,warning:l}=cm(a,t)||{};c===!1&&O(l)}if(Cs(a)&&N(a.sort)){const{sort:c}=a;if(wc(c))return Object.assign(Object.assign({},a),{sort:{encoding:c}});const l=c.substr(1);if(c.charAt(0)==="-"&&wc(l))return Object.assign(Object.assign({},a),{sort:{encoding:l,order:"descending"}})}if(Es(a)){const{header:c}=a;if(c){const{orient:l}=c,u=ks(c,["orient"]);if(l)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},u),{labelOrient:c.labelOrient||l,titleOrient:c.titleOrient||l})})}}return a}function Ki(e,t){return Dn(e)?{maxbins:ja(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:ja(t)}):e}const xn={compatible:!0};function cm(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case nt:case it:case $i:return Vi(e)?xn:{compatible:!1,warning:pg(t)};case G:case J:case bt:case fn:case ue:case Ue:case We:case Gn:case Xn:case Ei:case Dt:case ki:case Ci:case Mt:case Se:case ke:case Fi:return xn;case De:case _e:case Me:case Ce:return n!==qt?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:xn;case at:case yt:case vt:case Ot:case ot:case st:case rt:case Ee:case Le:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:xn;case fe:case xt:return!Vi(e)&&!tm(e)?{compatible:!1,warning:mg(t)}:xn;case Vn:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:xn}}function Sn(e){const{formatType:t}=Xi(e);return t==="time"||!t&&lm(e)}function lm(e){return e&&(e.type==="temporal"||x(e)&&!!e.timeUnit)}function Qi(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var s;const o=t&&((s=re(t))===null||s===void 0?void 0:s.unit);let a=o||n==="temporal",c;return Yn(e)?c=e.expr:w(e)?c=e.signal:Ht(e)?(a=!0,c=Kn(e)):(N(e)||Y(e))&&(a&&(c=`datetime(${D(e)})`,tp(o)&&((Y(e)&&e<1e4||N(e)&&isNaN(Date.parse(e)))&&(c=Kn({[o]:e}))))),c?i&&a?`time(${c})`:c:r?void 0:D(e)}function Lc(e,t){const{type:n}=e;return t.map(i=>{const r=Qi(i,{timeUnit:x(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function ni(e,t){return U(e.bin)?_t(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const Mc={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function ii(e){return e==null?void 0:e.condition}const Dc=["domain","grid","labels","ticks","title"],um={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Uc={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},fm=Object.assign(Object.assign({},Uc),{style:1,labelExpr:1,encoding:1});function Wc(e){return!!fm[e]}const dm={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},Bc=v(dm);function dt(e){return"mark"in e}class Zi{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return dt(t)?Wp(t.mark)===this.name:!1}}var gm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Kt(e,t){const n=e&&e[t];return n?j(n)?Rt(n,i=>!!i.field):x(n)||Gi(n):!1}function Hc(e,t){const n=e&&e[t];return n?j(n)?Rt(n,i=>!!i.field):x(n)||Ve(n)||ti(n):!1}function As(e,t){if(ee(t)){const n=e[t];if((x(n)||Ve(n))&&rc(n.type)){const i=ha(t);return Hc(e,i)}}return!1}function zs(e){return Rt(dd,t=>{if(Kt(e,t)){const n=e[t];if(j(n))return Rt(n,i=>!!i.aggregate);{const i=Ye(n);return i&&!!i.aggregate}}return!1})}function qc(e,t){const n=[],i=[],r=[],s=[],o={};return Is(e,(a,c)=>{if(x(a)){const{field:l,aggregate:u,bin:f,timeUnit:d}=a,g=gm(a,["field","aggregate","bin","timeUnit"]);if(u||d||f){const p=Ns(a),h=p==null?void 0:p.title;let m=_(a,{forAs:!0});const b=Object.assign(Object.assign(Object.assign({},h?[]:{title:On(a,t,{allowDisabling:!0})}),g),{field:m});if(u){let y;if(jt(u)?(y="argmax",m=_({op:"argmax",field:u.argmax},{forAs:!0}),b.field=`${m}.${l}`):lt(u)?(y="argmin",m=_({op:"argmin",field:u.argmin},{forAs:!0}),b.field=`${m}.${l}`):u!=="boxplot"&&u!=="errorbar"&&u!=="errorband"&&(y=u),y){const S={op:y,as:m};l&&(S.field=l),s.push(S)}}else if(n.push(m),we(a)&&U(f)){if(i.push({bin:f,field:l,as:m}),n.push(_(a,{binSuffix:"end"})),ni(a,c)&&n.push(_(a,{binSuffix:"range"})),ee(c)){const y={field:`${m}_end`};o[`${c}2`]=y}b.bin="binned",ma(c)||(b.type=qt)}else if(d){r.push({timeUnit:d,field:l,as:m});const y=we(a)&&a.type!==mn&&"time";y&&(c===Gn||c===Dt?b.formatType=y:Sd(c)?b.legend=Object.assign({formatType:y},b.legend):ee(c)&&(b.axis=Object.assign({formatType:y},b.axis)))}o[c]=b}else n.push(l),o[c]=e[c]}else o[c]=e[c]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function pm(e,t,n){const i=jd(t,n);if(i){if(i==="binned"){const r=e[t===Ee?G:J];return!!(x(r)&&x(e[t])&&ae(r.bin))}}else return!1;return!0}function mm(e,t,n,i){const r={};for(const s of v(e))pa(s)||O(gg(s));for(let s of yd){if(!e[s])continue;const o=e[s];if(gn(s)){const a=ba(s),c=r[a];if(x(c)){if(fp(c.type)&&x(o)){O(sg(a));continue}}else s=a,O(og(a))}if(s==="angle"&&t==="arc"&&!e.theta&&(O(rg),s=Se),!pm(e,s,t)){O(zi(s,t));continue}if(s===ot&&t==="line"){const a=Ye(e[s]);if(a==null?void 0:a.aggregate){O(fg);continue}}if(s===ue&&(n?"fill"in e:"stroke"in e)){O(Ha("encoding",{fill:"fill"in e,stroke:"stroke"in e}));continue}if(s===Xn||s===Vn&&!j(o)&&!Pe(o)||s===Dt&&j(o))o&&(r[s]=V(o).reduce((a,c)=>(x(c)?a.push(Ts(c,s)):O(ts(c,s)),a),[]));else{if(s===Dt&&o===null)r[s]=null;else if(!x(o)&&!Ve(o)&&!Pe(o)&&!qi(o)&&!w(o)){O(ts(o,s));continue}r[s]=Rc(o,s,i)}}return r}function Ji(e,t){const n={};for(const i of v(e)){const r=Rc(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function hm(e){const t=[];for(const n of v(e))if(Kt(e,n)){const i=e[n],r=V(i);for(const s of r)x(s)?t.push(s):Gi(s)&&t.push(s.condition)}return t}function Is(e,t,n){if(!e)return;for(const i of v(e)){const r=e[i];if(j(r))for(const s of r)t.call(n,s,i);else t.call(n,r,i)}}function bm(e,t,n,i){return e?v(e).reduce((r,s)=>{const o=e[s];return j(o)?o.reduce((a,c)=>t.call(i,a,c,s),r):t.call(i,r,o,s)},n):n}function Gc(e,t){return v(t).reduce((n,i)=>{switch(i){case G:case J:case ki:case Fi:case Ci:case Ee:case Le:case bt:case fn:case Se:case st:case ke:case rt:case Me:case De:case Ce:case _e:case Gn:case fe:case Mt:case Dt:return n;case Vn:if(e==="line"||e==="trail")return n;case Xn:case Ei:{const r=t[i];if(j(r)||x(r))for(const s of V(r))s.aggregate||n.push(_(s,{}));return n}case ot:if(e==="trail")return n;case ue:case Ue:case We:case at:case yt:case vt:case xt:case Ot:{const r=Ye(t[i]);return r&&!r.aggregate&&n.push(_(r,{})),n}}},[])}var Vc=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ym(e){const{tooltip:t}=e,n=Vc(e,["tooltip"]);if(!t)return{filteredEncoding:n};let i,r;if(j(t)){for(const s of t)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return j(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function Rs(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:o,titlePrefix:a})=>{const c=i?` of ${Ls(t)}`:"";return{field:o+t.field,type:t.type,title:w(a)?{signal:`${a}"${escape(c)}"`}:a+c}}),s=hm(n).map(Jp);return{tooltip:[...r,...Re(s,A)]}}function Ls(e){const{title:t,field:n}=e;return K(t,n)}function Ms(e,t,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:c,positionPrefix:l,endPositionPrefix:u=void 0,extraEncoding:f={}})=>{const d=Ls(n);return Xc(e,a,r,{mark:c,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:`${l}_${n.field}`,type:n.type},d!==void 0?{title:d}:{}),s!==void 0?{scale:s}:{}),o!==void 0?{axis:o}:{})},N(u)?{[`${t}2`]:{field:`${u}_${n.field}`}}:{}),i),f)})}}function Xc(e,t,n,i){const{clip:r,color:s,opacity:o}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),r?{clip:r}:{}),s?{color:s}:{}),o?{opacity:o}:{}),qe(i.mark)?i.mark:{type:i.mark}),{style:`${a}-${String(t)}`}),Dn(e[t])?{}:e[t])})]:[]}function Yc(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",s=i[r],o=i[`${r}2`],a=i[`${r}Error`],c=i[`${r}Error2`];return{continuousAxisChannelDef:er(s,n),continuousAxisChannelDef2:er(o,n),continuousAxisChannelDefError:er(a,n),continuousAxisChannelDefError2:er(c,n),continuousAxis:r}}function er(e,t){if(e==null?void 0:e.aggregate){const{aggregate:n}=e,i=Vc(e,["aggregate"]);return n!==t&&O(Ug(n,t)),i}else return e}function Kc(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(qe(n)&&n.orient)return n.orient;if(Xe(r)){if(Xe(s)){const o=x(r)&&r.aggregate,a=x(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return Sn(s)&&!Sn(r)?"horizontal":"vertical"}return"horizontal"}else{if(Xe(s))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}var tr=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const nr="boxplot",vm=["box","median","outliers","rule","ticks"],Om=new Zi(nr,Zc);function Qc(e){return Y(e)?"tukey":e}function Zc(e,{config:t}){var n,i;e=Object.assign(Object.assign({},e),{encoding:Ji(e.encoding,t)});const{mark:r,encoding:s,params:o,projection:a}=e,c=tr(e,["mark","encoding","params","projection"]),l=qe(r)?r:{type:r};o&&O(Ma("boxplot"));const u=(n=l.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=R("size",l,t),d=Qc(u),{bins:g,timeUnits:p,transform:h,continuousAxisChannelDef:m,continuousAxis:b,groupby:y,aggregate:S,encodingWithoutContinuousAxis:E,ticksOrient:k,boxOrient:P,customTooltipWithoutAggregatedField:$}=xm(e,u,t),{color:T,size:X}=E,he=tr(E,["color","size"]),hi=wf=>Ms(l,b,m,wf,t.boxplot),tt=hi(he),qo=hi(E),Nr=hi(Object.assign(Object.assign({},he),X?{size:X}:{})),In=Rs([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],m,E),bi={type:"tick",color:"black",opacity:1,orient:k,invalid:null,aria:!1},rn=d==="min-max"?In:Rs([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],m,E),yi=[...tt({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:rn}),...tt({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:rn}),...tt({partName:"ticks",mark:bi,positionPrefix:"lower_whisker",extraEncoding:rn}),...tt({partName:"ticks",mark:bi,positionPrefix:"upper_whisker",extraEncoding:rn})],Rn=[...d!=="tukey"?yi:[],...qo({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:P,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:In}),...Nr({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},H(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:k,aria:!1}),positionPrefix:"mid_box",extraEncoding:In})];if(d==="min-max")return Object.assign(Object.assign({},c),{transform:((i=c.transform)!==null&&i!==void 0?i:[]).concat(h),layer:Rn});const Ln=`datum["lower_box_${m.field}"]`,Mn=`datum["upper_box_${m.field}"]`,vi=`(${Mn} - ${Ln})`,Go=`${Ln} - ${u} * ${vi}`,Vo=`${Mn} + ${u} * ${vi}`,Oi=`datum["${m.field}"]`,Sf={joinaggregate:Jc(m.field),groupby:y},Xo={transform:[{filter:`(${Go} <= ${Oi}) && (${Oi} <= ${Vo})`},{aggregate:[{op:"min",field:m.field,as:`lower_whisker_${m.field}`},{op:"max",field:m.field,as:`upper_whisker_${m.field}`},{op:"min",field:`lower_box_${m.field}`,as:`lower_box_${m.field}`},{op:"max",field:`upper_box_${m.field}`,as:`upper_box_${m.field}`},...S],groupby:y}],layer:yi},_f=tr(he,["tooltip"]),{scale:Yo,axis:jf}=m,Ko=Ls(m),Qo=be(jf,["title"]),Zo=Xc(l,"outliers",t.boxplot,{transform:[{filter:`(${Oi} < ${Go}) || (${Oi} > ${Vo})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[b]:Object.assign(Object.assign(Object.assign({field:m.field,type:m.type},Ko!==void 0?{title:Ko}:{}),Yo!==void 0?{scale:Yo}:{}),L(Qo)?{}:{axis:Qo})},_f),T?{color:T}:{}),$?{tooltip:$}:{})})[0];let xi;const Jo=[...g,...p,Sf];return Zo?xi={transform:Jo,layer:[Zo,Xo]}:(xi=Xo,xi.transform.unshift(...Jo)),Object.assign(Object.assign({},c),{layer:[xi,{transform:h,layer:Rn}]})}function Jc(e){return[{op:"q1",field:e,as:`lower_box_${e}`},{op:"q3",field:e,as:`upper_box_${e}`}]}function xm(e,t,n){const i=Kc(e,nr),{continuousAxisChannelDef:r,continuousAxis:s}=Yc(e,i,nr),o=r.field,a=Qc(t),c=[...Jc(o),{op:"median",field:o,as:`mid_box_${o}`},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:`iqr_${o}`},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:`upper_whisker_${o}`},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:`lower_whisker_${o}`}],u=e.encoding,f=s,d=u[f],g=tr(u,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:h}=ym(g),{bins:m,timeUnits:b,aggregate:y,groupby:S,encoding:E}=qc(h,n),k=i==="vertical"?"horizontal":"vertical",P=i,$=[...m,...b,{aggregate:[...y,...c],groupby:S},...l];return{bins:m,timeUnits:b,transform:$,groupby:S,aggregate:y,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:E,ticksOrient:k,boxOrient:P,customTooltipWithoutAggregatedField:p}}var el=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ds="errorbar",Sm=["ticks","rule"],_m=new Zi(Ds,tl);function tl(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Ji(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:c,tooltipEncoding:l}=nl(e,Ds,t);delete s.size;const u=Ms(a,r,i,s,t.errorbar),f=a.thickness,d=a.size,g=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},f!==void 0?{thickness:f}:{}),d!==void 0?{size:d}:{}),p=[...u({partName:"ticks",mark:g,positionPrefix:"lower",extraEncoding:l}),...u({partName:"ticks",mark:g,positionPrefix:"upper",extraEncoding:l}),...u({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},f!==void 0?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},c),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function jm(e,t){const{encoding:n}=e;if(wm(n))return{orient:Kc(e,t),inputType:"raw"};const i=$m(n),r=Em(n),s=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,c=n.y2;if(C(a)&&C(c))throw new Error(`${t} cannot have both x2 and y2`);if(C(a)){if(Xe(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(C(c)){if(Xe(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,c=n.xError2,l=n.yError,u=n.yError2;if(C(c)&&!C(a))throw new Error(`${t} cannot have xError2 without xError`);if(C(u)&&!C(l))throw new Error(`${t} cannot have yError2 without yError`);if(C(a)&&C(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(C(a)){if(Xe(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(C(l)){if(Xe(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function wm(e){return(C(e.x)||C(e.y))&&!C(e.x2)&&!C(e.y2)&&!C(e.xError)&&!C(e.xError2)&&!C(e.yError)&&!C(e.yError2)}function $m(e){return C(e.x2)||C(e.y2)}function Em(e){return C(e.xError)||C(e.xError2)||C(e.yError)||C(e.yError2)}function nl(e,t,n){var i;const{mark:r,encoding:s,params:o,projection:a}=e,c=el(e,["mark","encoding","params","projection"]),l=qe(r)?r:{type:r};o&&O(Ma(t));const{orient:u,inputType:f}=jm(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:g,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:h,continuousAxis:m}=Yc(e,u,t),{errorBarSpecificAggregate:b,postAggregateCalculates:y,tooltipSummary:S,tooltipTitleWithFieldName:E}=km(l,d,g,p,h,f,t,n),k=s,P=m,$=k[P],T=m==="x"?"x2":"y2",X=k[T],he=m==="x"?"xError":"yError",hi=k[he],tt=m==="x"?"xError2":"yError2",qo=k[tt],Nr=el(k,[typeof P=="symbol"?P:P+"",typeof T=="symbol"?T:T+"",typeof he=="symbol"?he:he+"",typeof tt=="symbol"?tt:tt+""]),{bins:In,timeUnits:bi,aggregate:rn,groupby:yi,encoding:Rn}=qc(Nr,n),Ln=[...rn,...b],Mn=f!=="raw"?[]:yi,vi=Rs(S,d,Rn,E);return{transform:[...(i=c.transform)!==null&&i!==void 0?i:[],...In,...bi,...Ln.length===0?[]:[{aggregate:Ln,groupby:Mn}],...y],groupby:Mn,continuousAxisChannelDef:d,continuousAxis:m,encodingWithoutContinuousAxis:Rn,ticksOrient:u==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:c,tooltipEncoding:vi}}function km(e,t,n,i,r,s,o,a){let c=[],l=[];const u=t.field;let f,d=!1;if(s==="raw"){const g=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,p=e.extent?e.extent:g==="mean"?"stderr":"iqr";if(g==="median"!==(p==="iqr")&&O(Dg(g,p,o)),p==="stderr"||p==="stdev")c=[{op:p,field:u,as:`extent_${u}`},{op:g,field:u,as:`center_${u}`}],l=[{calculate:`datum["center_${u}"] + datum["extent_${u}"]`,as:`upper_${u}`},{calculate:`datum["center_${u}"] - datum["extent_${u}"]`,as:`lower_${u}`}],f=[{fieldPrefix:"center_",titlePrefix:Bn(g)},{fieldPrefix:"upper_",titlePrefix:il(g,p,"+")},{fieldPrefix:"lower_",titlePrefix:il(g,p,"-")}],d=!0;else{let h,m,b;p==="ci"?(h="mean",m="ci0",b="ci1"):(h="median",m="q1",b="q3"),c=[{op:m,field:u,as:`lower_${u}`},{op:b,field:u,as:`upper_${u}`},{op:h,field:u,as:`center_${u}`}],f=[{fieldPrefix:"upper_",titlePrefix:On({field:u,aggregate:b,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:On({field:u,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:On({field:u,aggregate:h,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&O(Mg(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:`upper_${u}`},{calculate:`datum["${u}"]`,as:`lower_${u}`}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:u}],l=[{calculate:`datum["${u}"] + datum["${i.field}"]`,as:`upper_${u}`}],r?l.push({calculate:`datum["${u}"] + datum["${r.field}"]`,as:`lower_${u}`}):l.push({calculate:`datum["${u}"] - datum["${i.field}"]`,as:`lower_${u}`}));for(const g of l)f.push({fieldPrefix:g.as.substring(0,6),titlePrefix:Lt(Lt(g.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:c,tooltipSummary:f,tooltipTitleWithFieldName:d}}function il(e,t,n){return`${Bn(e)} ${n} ${t}`}const Us="errorband",Cm=["band","borders"],Fm=new Zi(Us,rl);function rl(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Ji(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:c}=nl(e,Us,t),l=o,u=Ms(l,r,i,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},g={type:f?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),g=Object.assign(Object.assign(Object.assign({},g),p),{aria:!1})):l.interpolate?O(Xa("interpolate")):l.tension&&O(Xa("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...u({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c}),...u({partName:"borders",mark:g,positionPrefix:"lower",extraEncoding:c}),...u({partName:"borders",mark:g,positionPrefix:"upper",extraEncoding:c})]})}const sl={};function Ws(e,t,n){const i=new Zi(e,t);sl[e]={normalizer:i,parts:n}}function Nm(){return v(sl)}Ws(nr,Zc,vm),Ws(Ds,tl,Sm),Ws(Us,rl,Cm);const Pm=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],ol={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},al={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Tm=v(ol),Am=v(al),zm={header:1,headerRow:1,headerColumn:1,headerFacet:1},cl=v(zm),ll=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Im={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},Rm={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Ke="_vgsid_",Lm={point:{on:"click",fields:[Ke],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Bs(e){return e==="legend"||!!(e==null?void 0:e.legend)}function Hs(e){return Bs(e)&&H(e)}function qs(e){return!!(e==null?void 0:e.select)}var Mm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ul(e){const t=[];for(const n of e||[]){if(qs(n))continue;const{expr:i,bind:r}=n,s=Mm(n,["expr","bind"]);if(r&&i){const o=Object.assign(Object.assign({},s),{bind:r,init:i});t.push(o)}else{const o=Object.assign(Object.assign(Object.assign({},s),i?{update:i}:{}),r?{bind:r}:{});t.push(o)}}return t}function Dm(e){return ir(e)||Vs(e)||Gs(e)}function Gs(e){return"concat"in e}function ir(e){return"vconcat"in e}function Vs(e){return"hconcat"in e}function fl({step:e,offsetIsDiscrete:t}){var n;return t?(n=e.for)!==null&&n!==void 0?n:"offset":"position"}function Qe(e){return H(e)&&e.step!==void 0}function dl(e){return e.view||e.width||e.height}const gl=20,Um={align:1,bounds:1,center:1,columns:1,spacing:1},Wm=v(Um);function Bm(e,t,n){var i,r;const s=n[t],o={},{spacing:a,columns:c}=s;a!==void 0&&(o.spacing=a),c!==void 0&&((Hi(e)&&!ei(e.facet)||Gs(e))&&(o.columns=c)),ir(e)&&(o.columns=1);for(const l of Wm)if(e[l]!==void 0)if(l==="spacing"){const u=e[l];o[l]=Y(u)?u:{row:(i=u.row)!==null&&i!==void 0?i:a,column:(r=u.column)!==null&&r!==void 0?r:a}}else o[l]=e[l];return o}var Hm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Xs(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function rr(e,t){const n=sr(e,t);return Qe(n)?n.step:pl}function sr(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return K(i,{step:e.step})}const pl=20,qm={continuousWidth:200,continuousHeight:200,step:pl},Gm={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:qm,mark:Ip,arc:{},area:{},bar:Mp,circle:{},geoshape:{},image:{},line:{},point:{},rect:Dp,rule:{color:"black"},square:{},text:{color:"black"},tick:Up,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:yp,projection:{},legend:Im,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Lm,style:{},title:{},facet:{spacing:gl},concat:{spacing:gl},normalizedNumberFormat:".0%"},gt=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],ml={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},hl={blue:gt[0],orange:gt[1],red:gt[2],teal:gt[3],green:gt[4],yellow:gt[5],purple:gt[6],pink:gt[7],brown:gt[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Vm(e={}){return{signals:[{name:"color",value:H(e)?Object.assign(Object.assign({},hl),e):hl}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Xm(e){return{signals:[{name:"fontSize",value:H(e)?Object.assign(Object.assign({},ml),e):ml}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Ym(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function bl(e){const t=v(e||{}),n={};for(const i of t){const r=e[i];n[i]=ii(r)?$a(r):ye(r)}return n}function Km(e){const t=v(e),n={};for(const i of t)n[i]=bl(e[i]);return n}const Qm=[...bc,...Bc,...cl,"background","padding","legend","lineBreak","scale","style","title","view"];function yl(e={}){const{color:t,font:n,fontSize:i,selection:r}=e,s=Hm(e,["color","font","fontSize","selection"]),o=ea({},F(Gm),n?Ym(n):{},t?Vm(t):{},i?Xm(i):{},s||{});r&&Tf(o,"selection",r,!0);const a=be(o,Qm);for(const c of["background","lineBreak","padding"])o[c]&&(a[c]=ye(o[c]));for(const c of bc)o[c]&&(a[c]=ge(o[c]));for(const c of Bc)o[c]&&(a[c]=bl(o[c]));for(const c of cl)o[c]&&(a[c]=ge(o[c]));return o.legend&&(a.legend=ge(o.legend)),o.scale&&(a.scale=ge(o.scale)),o.style&&(a.style=Km(o.style)),o.title&&(a.title=ge(o.title)),o.view&&(a.view=ge(o.view)),a}const Zm=new Set(["view",...Fp]),Jm=["color","fontSize","background","padding","facet","concat","numberFormat","numberFormatType","normalizedNumberFormat","normalizedNumberFormatType","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],eh=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},zp);function th(e){e=F(e);for(const t of Jm)delete e[t];if(e.axis)for(const t in e.axis)ii(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Pm)delete e.legend[t];if(e.mark){for(const t of hc)delete e.mark[t];e.mark.tooltip&&H(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(ul(e.params)),delete e.params);for(const t of Zm){for(const i of hc)delete e[t][i];const n=eh[t];if(n)for(const i of n)delete e[t][i];ih(e,t)}for(const t of Nm())delete e[t];nh(e);for(const t in e)H(e[t])&&L(e[t])&&delete e[t];return L(e)?void 0:e}function nh(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=wa(e.title);L(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),L(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),L(i)?delete e.title:e.title=i}function ih(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},r),e.style[n??t]);L(s)||(e.style[n??t]=s),i||delete e[t]}function or(e){return"layer"in e}function rh(e){return"repeat"in e}function sh(e){return!j(e.repeat)&&e.repeat.layer}var oh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Ys{map(t,n){return Hi(t)?this.mapFacet(t,n):rh(t)?this.mapRepeat(t,n):Vs(t)?this.mapHConcat(t,n):ir(t)?this.mapVConcat(t,n):Gs(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(or(t))return this.mapLayer(t,n);if(dt(t))return this.mapUnit(t,n);throw new Error(Jr(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(i=>this.map(i,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(i=>this.map(i,n))})}mapConcat(t,n){const{concat:i}=t,r=oh(t,["concat"]);return Object.assign(Object.assign({},r),{concat:i.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const ah={zero:1,center:1,normalize:1};function ch(e){return e in ah}const lh=new Set([dc,Li,Ri,Ui,Di,Os,xs,Mi,gc,vs]),uh=new Set([Li,Ri,dc]);function _n(e){return x(e)&&yn(e)==="quantitative"&&!e.bin}function vl(e,t){var n,i;const r=t==="x"?"y":"radius",s=e[t],o=e[r];if(x(s)&&x(o))if(_n(s)&&_n(o)){if(s.stack)return t;if(o.stack)return r;const a=x(s)&&!!s.aggregate,c=x(o)&&!!o.aggregate;if(a!==c)return a?t:r;{const l=(n=s.scale)===null||n===void 0?void 0:n.type,u=(i=o.scale)===null||i===void 0?void 0:i.type;if(l&&l!=="linear")return r;if(u&&u!=="linear")return t}}else{if(_n(s))return t;if(_n(o))return r}else{if(_n(s))return t;if(_n(o))return r}return}function fh(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function Ol(e,t){var n,i;const r=qe(e)?e.type:e;if(!lh.has(r))return null;const s=vl(t,"x")||vl(t,"theta");if(!s)return null;const o=t[s],a=x(o)?_(o,{}):void 0,c=fh(s),l=[],u=new Set;if(t[c]){const g=t[c],p=x(g)?_(g,{}):void 0;p&&p!==a&&(l.push(c),u.add(p));const h=c==="x"?"xOffset":"yOffset",m=t[h],b=x(m)?_(m,{}):void 0;b&&b!==a&&(l.push(h),u.add(b))}const f=vd.reduce((g,p)=>{if(p!=="tooltip"&&Kt(t,p)){const h=t[p];for(const m of V(h)){const b=Ye(m);if(b.aggregate)continue;const y=_(b,{});(!y||!u.has(y))&&g.push({channel:p,fieldDef:b})}}return g},[]);let d;return o.stack!==void 0?Dn(o.stack)?d=o.stack?"zero":null:d=o.stack:uh.has(r)&&(d="zero"),!d||!ch(d)||zs(t)&&f.length===0?null:((n=o==null?void 0:o.scale)===null||n===void 0?void 0:n.type)&&((i=o==null?void 0:o.scale)===null||i===void 0?void 0:i.type)!==pe.LINEAR?(O(Ig(o.scale.type)),null):C(t[ct(s)])?(o.stack!==void 0&&O(zg(s)),null):(x(o)&&o.aggregate&&!Nd.has(o.aggregate)&&O(Rg(o.aggregate)),{groupbyChannels:l,groupbyFields:u,fieldChannel:s,impute:o.impute===null?!1:Et(r),stackBy:f,offset:d})}var xl=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function dh(e){const t=xl(e,["point","line"]);return v(t).length>1?t:t.type}function gh(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:be(e[t],["point","line"])}));return e}function Ks(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?H(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?H(t.point)?t.point:{}:void 0}function Sl(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class ph{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(dt(t)){const{mark:i,encoding:r}=t,s=qe(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!Ks(s,n[s.type],r);case"area":return!!Ks(s,n[s.type],r)||!!Sl(s,n[s.type])}}return!1}run(t,n,i){const{config:r}=n,{params:s,projection:o,mark:a,encoding:c}=t,l=xl(t,["params","projection","mark","encoding"]),u=Ji(c,r),f=qe(a)?a:{type:a},d=Ks(f,r[f.type],u),g=f.type==="area"&&Sl(f,r[f.type]),p=[Object.assign(Object.assign({},s?{params:s}:{}),{mark:dh(Object.assign(Object.assign({},f.type==="area"&&f.opacity===void 0&&f.fillOpacity===void 0?{opacity:.7}:{}),f)),encoding:be(u,["shape"])})],h=Ol(f,u);let m=u;if(h){const{fieldChannel:b,offset:y}=h;m=Object.assign(Object.assign({},u),{[b]:Object.assign(Object.assign({},u[b]),y?{stack:y}:{})})}return g&&p.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},ln(f,["clip","interpolate","tension","tooltip"])),g),encoding:m})),d&&p.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},ln(f,["clip","tooltip"])),d),encoding:m})),i(Object.assign(Object.assign({},l),{layer:p}),Object.assign(Object.assign({},n),{config:gh(r)}))}}var mh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function hh(e,t){return t?ei(e)?$l(e,t):_l(e,t):e}function Qs(e,t){return t?$l(e,t):e}function Zs(e,t,n){const i=t[e];if(Qp(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});O(Qd(i.repeat));return}return t}function _l(e,t){if(e=Zs("field",e,t),e===void 0)return;if(e===null)return null;if(Cs(e)&&Ge(e.sort)){const n=Zs("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}function jl(e,t){if(x(e))return _l(e,t);{const n=Zs("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function wl(e,t){if(C(e)){const n=jl(e,t);if(n)return n;if(qi(e))return{condition:e.condition}}else{if(ti(e)){const n=jl(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const i=mh(e,["condition"]);return i}}return e}return}function $l(e,t){const n={};for(const i in e)if(sn(e,i)){const r=e[i];if(j(r))n[i]=r.map(s=>wl(s,t)).filter(s=>s);else{const s=wl(r,t);s!==void 0&&(n[i]=s)}}return n}class bh{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(dt(t)){const{encoding:n,mark:i}=t;if(i==="line"||qe(i)&&i.type==="line")for(const r of hd){const s=Ut(r),o=n[s];if(n[r]&&(x(o)&&!ae(o.bin)||Ve(o)))return!0}}return!1}run(t,n,i){const{encoding:r,mark:s}=t;return O(yg(!!r.x2,!!r.y2)),i(Object.assign(Object.assign({},t),{mark:H(s)?Object.assign(Object.assign({},s),{type:"rule"}):"rule"}),n)}}var kt=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class yh extends Ys{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[Om,_m,Fm,new ph,new bh]}map(t,n){if(dt(t)){const i=Kt(t.encoding,nt),r=Kt(t.encoding,it),s=Kt(t.encoding,$i);if(i||r||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,s=Qs(t.encoding,n.repeater),o=Object.assign(Object.assign({},t),s?{encoding:s}:{});if(i||r)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const c of this.nonFacetUnitNormalizers)if(c.hasMatchingType(o,n.config))return c.run(o,n,a);return o}mapRepeat(t,n){return sh(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r}=t,s=kt(t,["repeat","spec"]),{row:o,column:a,layer:c}=i,{repeater:l={},repeaterPrefix:u=""}=n;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:c},spec:r}}),n):Object.assign(Object.assign({},s),{layer:c.map(f=>{const d=Object.assign(Object.assign({},l),{layer:f}),g=`${(r.name||"")+u}child__layer_${q(f)}`,p=this.mapLayerOrUnit(r,Object.assign(Object.assign({},n),{repeater:d,repeaterPrefix:g}));return p.name=g,p})})}mapNonLayerRepeat(t,n){var i;const{repeat:r,spec:s,data:o}=t,a=kt(t,["repeat","spec","data"]);!j(r)&&t.columns&&(t=be(t,["columns"]),O(Da("repeat")));const c=[],{repeater:l={},repeaterPrefix:u=""}=n,f=!j(r)&&r.row||[l?l.row:null],d=!j(r)&&r.column||[l?l.column:null],g=j(r)&&r||[l?l.repeat:null];for(const h of g)for(const m of f)for(const b of d){const y={repeat:h,row:m,column:b,layer:l.layer},S=(s.name||"")+u+"child__"+(j(r)?`${q(h)}`:(r.row?`row_${q(m)}`:"")+(r.column?`column_${q(b)}`:"")),E=this.map(s,Object.assign(Object.assign({},n),{repeater:y,repeaterPrefix:S}));E.name=S,c.push(be(E,["data"]))}const p=j(r)?t.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(i=s.data)!==null&&i!==void 0?i:o,align:"all"},a),{columns:p,concat:c})}mapFacet(t,n){const{facet:i}=t;return ei(i)&&t.columns&&(t=be(t,["columns"]),O(Da("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:s,parentProjection:o,config:a}=n,c=kl({parentProjection:o,projection:r}),l=El({parentEncoding:s,encoding:Qs(i,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),c?{projection:c}:{}),l?{encoding:l}:{}),{config:a})}mapFacetedUnit(t,n){const i=t.encoding,{row:r,column:s,facet:o}=i,a=kt(i,["row","column","facet"]),{mark:c,width:l,projection:u,height:f,view:d,params:g,encoding:p}=t,h=kt(t,["mark","width","projection","height","view","params","encoding"]),{facetMapping:m,layout:b}=this.getFacetMappingAndLayout({row:r,column:s,facet:o},n),y=Qs(a,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},h),b),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),f?{height:f}:{}),d?{view:d}:{}),u?{projection:u}:{}),{mark:c,encoding:y}),g?{params:g}:{})}),n)}getFacetMappingAndLayout(t,n){var i;const{row:r,column:s,facet:o}=t;if(r||s){o&&O(hg([...r?[nt]:[],...s?[it]:[]]));const a={},c={};for(const l of[nt,it]){const u=t[l];if(u){const f=kt(u,["align","center","spacing","columns"]);a[l]=f;for(const d of["align","center","spacing"])u[d]!==void 0&&((i=c[d])!==null&&i!==void 0||(c[d]={}),c[d][l]=u[d])}}return{facetMapping:a,layout:c}}else{const{align:a,center:c,spacing:l,columns:u}=o,f=kt(o,["align","center","spacing","columns"]);return{facetMapping:hh(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),c?{center:c}:{}),l?{spacing:l}:{}),u?{columns:u}:{})}}}mapLayer(t,n){var{parentEncoding:i,parentProjection:r}=n,s=kt(n,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,c=kt(t,["encoding","projection"]),l=Object.assign(Object.assign({},s),{parentEncoding:El({parentEncoding:i,encoding:o,layer:!0}),parentProjection:kl({parentProjection:r,projection:a})});return super.mapLayer(c,l)}}function El({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...v(e),...v(t)]);for(const s of r){const o=t[s],a=e[s];if(C(o)){const c=Object.assign(Object.assign({},a),o);i[s]=c}else ti(o)?i[s]=Object.assign(Object.assign({},o),{condition:Object.assign(Object.assign({},a),o.condition)}):o||o===null?i[s]=o:(n||Pe(a)||w(a)||C(a)||j(a))&&(i[s]=a)}}else i=t;return!i||L(i)?void 0:i}function kl(e){const{parentProjection:t,projection:n}=e;return t&&n&&O(ig({parentProjection:t,projection:n})),n??t}function Js(e){return"filter"in e}function vh(e){return(e==null?void 0:e.stop)!==void 0}function Cl(e){return"lookup"in e}function Oh(e){return"data"in e}function xh(e){return"param"in e}function Sh(e){return"pivot"in e}function _h(e){return"density"in e}function jh(e){return"quantile"in e}function wh(e){return"regression"in e}function $h(e){return"loess"in e}function Eh(e){return"sample"in e}function kh(e){return"window"in e}function Ch(e){return"joinaggregate"in e}function Fh(e){return"flatten"in e}function Nh(e){return"calculate"in e}function Fl(e){return"bin"in e}function Ph(e){return"impute"in e}function Th(e){return"timeUnit"in e}function Ah(e){return"aggregate"in e}function zh(e){return"stack"in e}function Ih(e){return"fold"in e}function Rh(e){return e.map(t=>Js(t)?{filter:cn(t.filter,up)}:t)}var Ct=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Lh extends Ys{map(t,n){var i,r;return(i=n.emptySelections)!==null&&i!==void 0||(n.emptySelections={}),(r=n.selectionPredicates)!==null&&r!==void 0||(n.selectionPredicates={}),t=Nl(t,n),super.map(t,n)}mapLayerOrUnit(t,n){if(t=Nl(t,n),t.encoding){const i={};for(const[r,s]of ht(t.encoding))i[r]=Pl(s,n);t=Object.assign(Object.assign({},t),{encoding:i})}return super.mapLayerOrUnit(t,n)}mapUnit(t,n){const i=t,{selection:r}=i,s=Ct(i,["selection"]);return r?Object.assign(Object.assign({},s),{params:ht(r).map(([o,a])=>{var c;const l=a,{init:u,bind:f,empty:d}=l,g=Ct(l,["init","bind","empty"]);g.type==="single"?(g.type="point",g.toggle=!1):g.type==="multi"&&(g.type="point"),n.emptySelections[o]=d!=="none";for(const p of ie((c=n.selectionPredicates[o])!==null&&c!==void 0?c:{}))p.empty=d!=="none";return{name:o,value:u,select:g,bind:f}})}):t}}function Nl(e,t){const{transform:n}=e,i=Ct(e,["transform"]);if(n){const r=n.map(s=>{if(Js(s))return{filter:eo(s,t)};if(Fl(s)&&Wt(s.bin))return Object.assign(Object.assign({},s),{bin:Tl(s.bin)});if(Cl(s)){const o=s.from,{selection:a}=o,c=Ct(o,["selection"]);return a?Object.assign(Object.assign({},s),{from:Object.assign({param:a},c)}):s}return s});return Object.assign(Object.assign({},i),{transform:r})}return e}function Pl(e,t){var n,i;const r=F(e);if(x(r)&&Wt(r.bin)&&(r.bin=Tl(r.bin)),Yt(r)&&((i=(n=r.scale)===null||n===void 0?void 0:n.domain)===null||i===void 0?void 0:i.selection)){const s=r.scale.domain,{selection:o}=s,a=Ct(s,["selection"]);r.scale.domain=Object.assign(Object.assign({},a),o?{param:o}:{})}if(qi(r))if(na(r.condition))r.condition=r.condition.map(s=>{const{selection:o,param:a,test:c}=s,l=Ct(s,["selection","param","test"]);return a?s:Object.assign(Object.assign({},l),{test:eo(s,t)})});else{const s=Pl(r.condition,t),{selection:o,param:a,test:c}=s,l=Ct(s,["selection","param","test"]);r.condition=a?r.condition:Object.assign(Object.assign({},l),{test:eo(r.condition,t)})}return r}function Tl(e){const t=e.extent;if(t==null?void 0:t.selection){const{selection:n}=t,i=Ct(t,["selection"]);return Object.assign(Object.assign({},e),{extent:Object.assign(Object.assign({},i),{param:n})})}return e}function eo(e,t){const n=i=>cn(i,r=>{var s,o,a;const c=(s=t.emptySelections[r])!==null&&s!==void 0?s:!0,l={param:r,empty:c};return(o=(a=t.selectionPredicates)[r])!==null&&o!==void 0||(a[r]=[]),t.selectionPredicates[r].push(l),l});return e.selection?n(e.selection):cn(e.test||e.filter,i=>i.selection?n(i.selection):i)}class to extends Ys{map(t,n){var i;const r=(i=n.selections)!==null&&i!==void 0?i:[];if(t.params&&!dt(t)){const s=[];for(const o of t.params)qs(o)?r.push(o):s.push(o);t.params=s}return n.selections=r,super.map(t,Al(t,n))}mapUnit(t,n){var i;const r=n.selections;if(!r||!r.length)return t;const s=((i=n.path)!==null&&i!==void 0?i:[]).concat(t.name),o=[];for(const a of r)if(!a.views||!a.views.length)o.push(a);else for(const c of a.views)(Si(c)&&(c===t.name||s.indexOf(c)>=0)||na(c)&&c.map(l=>s.indexOf(l)).every((l,u,f)=>l!==-1&&(u===0||l>f[u-1])))&&o.push(a);return o.length&&(t.params=o),t}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=to.prototype[e];to.prototype[e]=function(n,i){return t.call(this,n,Al(n,i))}}function Al(e,t){var n;return e.name?Object.assign(Object.assign({},t),{path:((n=t.path)!==null&&n!==void 0?n:[]).concat(e.name)}):t}function zl(e,t){t===void 0&&(t=yl(e.config));const n=Wh(e,t),{width:i,height:r}=e,s=Bh(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const Mh=new yh,Dh=new Lh,Uh=new to;function Wh(e,t={}){const n={config:t};return Uh.map(Mh.map(Dh.map(e,n),n),n)}function Il(e){return N(e)?{type:e}:e??{}}function Bh(e,t,n){let{width:i,height:r}=t;const s=dt(e)||or(e),o={};s?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(O(za("width")),i=void 0),r=="container"&&(O(za("height")),r=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?Il(n.autosize):{}),Il(e.autosize));return a.type==="fit"&&!s&&(O(Ud),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&O(Ia("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&O(Ia("height")),Ie(a,{type:"pad"})?void 0:a}function Hh(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function qh(e){return e?`fit-${Ni(e)}`:"fit"}const Gh=["background","padding"];function Rl(e,t){const n={};for(const i of Gh)e&&e[i]!==void 0&&(n[i]=ye(e[i]));return t&&(n.params=e.params),n}class pt{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new pt(F(this.explicit),F(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return K(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,{value:n,explicit:i}){n!==void 0&&this.set(t,n,i)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,{explicit:n,implicit:i}){n[t]!==void 0?this.set(t,n[t],!0):i[t]!==void 0&&this.set(t,i[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of v(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function Ze(e){return{explicit:!0,value:e}}function Oe(e){return{explicit:!1,value:e}}function Ll(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:ar(t,n,i,r)}}function ar(e,t,n,i){return e.explicit&&t.explicit&&O(kg(n,i,e.value,t.value)),e}function Ft(e,t,n,i,r=ar){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Ie(e.value,t.value)?e:r(e,t,n,i)}class Vh extends pt{constructor(t={},n={},i=!1){super(t,n);this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function jn(e){return"url"in e}function ri(e){return"values"in e}function Ml(e){return"name"in e&&!jn(e)&&!ri(e)&&!Nt(e)}function Nt(e){return e&&(Dl(e)||Ul(e)||no(e))}function Dl(e){return"sequence"in e}function Ul(e){return"sphere"in e}function no(e){return"graticule"in e}var W;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(W||(W={}));var Xh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Qt(e,t=!0,n=Ff){if(j(e)){const i=e.map(r=>Qt(r,t,n));return t?`[${i.join(", ")}]`:i}else if(Ht(e))return n(t?Kn(e):Jg(e));return t?n(D(e)):e}function Yh(e,t){var n;for(const i of ie((n=e.component.selection)!==null&&n!==void 0?n:{})){const r=i.name;let s=`${r}${At}, ${i.resolve==="global"?"true":`{unit: ${En(e)}}`}`;for(const o of dr){if(!o.defined(i))continue;o.signals&&(t=o.signals(e,i,t)),o.modifyExpr&&(s=o.modifyExpr(e,i,s))}t.push({name:r+kb,on:[{events:{signal:i.name+At},update:`modify(${I(i.name+Zt)}, ${s})`}]})}return io(t)}function Kh(e,t){if(e.component.selection&&v(e.component.selection).length){const n=I(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:an("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return io(t)}function Qh(e,t){var n;let i=!1;for(const r of ie((n=e.component.selection)!==null&&n!==void 0?n:{})){const s=r.name,o=I(s+Zt),a=t.filter(c=>c.name===s);if(a.length===0){const c=r.resolve==="global"?"union":r.resolve,l=r.type==="point"?", true, true)":")";t.push({name:r.name,update:`${uu}(${o}, ${I(c)}${l}`})}i=!0;for(const c of dr)c.defined(r)&&c.topLevelSignals&&(t=c.topLevelSignals(e,r,t))}if(i){const r=t.filter(s=>s.name==="unit");r.length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return io(t)}function Zh(e,t){var n;const i=[...t],r=En(e,{escape:!1});for(const s of ie((n=e.component.selection)!==null&&n!==void 0?n:{})){const o={name:s.name+Zt};if(s.project.hasSelectionId&&(o.transform=[{type:"collect",sort:{field:Ke}}]),s.init){const c=s.project.items.map(l=>{const u=Xh(l,["signals"]);return u});o.values=s.project.hasSelectionId?s.init.map(l=>({unit:r,[Ke]:Qt(l,!1)[0]})):s.init.map(l=>({unit:r,fields:c,values:Qt(l,!1)}))}const a=i.filter(c=>c.name===s.name+Zt);a.length||i.push(o)}return i}function Wl(e,t){var n;for(const i of ie((n=e.component.selection)!==null&&n!==void 0?n:{}))for(const r of dr)r.defined(i)&&r.marks&&(t=r.marks(e,i,t));return t}function Jh(e,t){for(const n of e.children)Q(n)&&(t=Wl(n,t));return t}function eb(e,t,n,i){const r=mu(e,t.param,t);return{signal:ve(n.get("type"))&&j(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function io(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}class M{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.includes(t)){O(eg);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this);const i=t.parent.removeChild(t);this._parent=n,n.addChild(this,i),t.parent=this}}class le extends M{constructor(t,n,i,r){super(t,n);this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName=`clone_${this.debugName}`,t._source=this._source,t._name=`clone_${this._name}`,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${ca()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}var Bl=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Je extends M{constructor(t,n){super(t);this.formula=n}clone(){return new Je(null,F(this.formula))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s)=>{const{field:o,timeUnit:a}=s;if(a){const c=_(s,{forAs:!0});r[A({as:c,field:o,timeUnit:a})]={as:c,field:o,timeUnit:a}}return r},{});return L(i)?null:new Je(t,i)}static makeFromTransform(t,n){const i=Object.assign({},n),{timeUnit:r}=i,s=Bl(i,["timeUnit"]),o=re(r),a=Object.assign(Object.assign({},s),{timeUnit:o});return new Je(t,{[A(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)this.formula[n]||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of ht(this.formula))t.has(r.as)||(n[i]=r);this.formula=n}producedFields(){return new Set(ie(this.formula).map(t=>t.as))}dependentFields(){return new Set(ie(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${A(this.formula)}`}assemble(){const t=[];for(const n of ie(this.formula)){const{field:i,as:r,timeUnit:s}=n,o=re(s),{unit:a,utc:c}=o,l=Bl(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:xe(i),type:"timeunit"},a?{units:os(a)}:{}),c?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return t}}var tb=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const si="_tuple_fields";class nb{constructor(...t){this.items=t,this.hasChannel={},this.hasField={},this.hasSelectionId=!1}}const ib={defined:()=>!0,parse:(e,t,n)=>{var i;const r=t.name,s=(i=t.project)!==null&&i!==void 0?i:t.project=new nb,o={},a={},c=new Set,l=(h,m)=>{const b=m==="visual"?h.channel:h.field;let y=q(`${r}_${b}`);for(let S=1;c.has(y);S++)y=q(`${r}_${b}_${S}`);return c.add(y),{[m]:y}},u=t.type,f=e.config.selection[u],d=n.value!==void 0?V(n.value):null;let{fields:g,encodings:p}=H(n.select)?n.select:{};if(!g&&!p&&d)for(const h of d){if(!H(h))continue;for(const m of v(h))md(m)?(p||(p=[])).push(m):u==="interval"?(O(Kd),p=f.encodings):(g||(g=[])).push(m)}!g&&!p&&(p=f.encodings,"fields"in f&&(g=f.fields));for(const h of p??[]){const m=e.fieldDef(h);if(m){let b=m.field;if(m.aggregate){O(Wd(h,m.aggregate));continue}else if(!b){O(La(h));continue}if(m.timeUnit){b=e.vgField(h);const y={timeUnit:m.timeUnit,as:b,field:m.field};a[A(y)]=y}if(!o[b]){let y="E";if(u==="interval"){const E=e.getScaleComponent(h).get("type");ve(E)&&(y="R")}else m.bin&&(y="R-RE");const S={field:b,channel:h,type:y};S.signals=Object.assign(Object.assign({},l(S,"data")),l(S,"visual")),s.items.push(o[b]=S),s.hasField[b]=s.hasChannel[h]=o[b],s.hasSelectionId=s.hasSelectionId||b===Ke}}else O(La(h))}for(const h of g??[]){if(s.hasField[h])continue;const m={type:"E",field:h};m.signals=Object.assign({},l(m,"data")),s.items.push(m),s.hasField[h]=m,s.hasSelectionId=s.hasSelectionId||h===Ke}d&&(t.init=d.map(h=>s.items.map(m=>H(h)?h[m.channel]!==void 0?h[m.channel]:h[m.field]:h))),L(a)||(s.timeUnit=new Je(null,a))},signals:(e,t,n)=>{const i=t.name+si,r=n.filter(s=>s.name===i);return r.length>0||t.project.hasSelectionId?n:n.concat({name:i,value:t.project.items.map(s=>{const o=tb(s,["signals","hasLegend"]);return o.field=xe(o.field),o})})}},Pt={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!_t(r))continue;const s=e.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!ve(o)){O(qd);continue}s.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||so(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let s=r.update;if(s.indexOf(uu)>=0)r.update=`{${i.map(o=>`${I(xe(o.field))}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const a=`${I(xe(o.field))}: ${o.signals.data}`;s.includes(a)||(s=`${s.substring(0,s.length-1)}, ${a}}`)}r.update=s}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!so(e))for(const i of t.scales){const r=n.filter(s=>s.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function ro(e,t){const n=I(e.scaleName(t));return`domain(${n})`}function so(e){var t;return e.parent&&An(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:so(e.parent.parent))}var rb=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const wn="_brush",oo="_scale_trigger",sb={defined:e=>e.type==="interval",signals:(e,t,n)=>{const i=t.name,r=i+si,s=Pt.defined(t),o=t.init?t.init[0]:null,a=[],c=[];if(t.translate&&!s){const u=`!event.item || event.item.mark.name !== ${I(i+wn)}`;Hl(t,(f,d)=>{var g,p;const h=V((g=(p=d.between[0]).filter)!==null&&g!==void 0?g:p.filter=[]);return h.includes(u)||h.push(u),f})}t.project.items.forEach((u,f)=>{const d=u.channel;if(d!==G&&d!==J){O("Interval selections only support x and y encoding channels.");return}const g=o?o[f]:null,p=ob(e,t,u,g),h=u.signals.data,m=u.signals.visual,b=I(e.scaleName(d)),y=e.getScaleComponent(d).get("type"),S=ve(y)?"+":"";n.push(...p),a.push(h),c.push({scaleName:e.scaleName(d),expr:`(!isArray(${h}) || (${S}invert(${b}, ${m})[0] === ${S}${h}[0] && ${S}invert(${b}, ${m})[1] === ${S}${h}[1]))`})}),!s&&c.length&&n.push({name:i+oo,value:{},on:[{events:c.map(u=>({scale:u.scaleName})),update:`${c.map(u=>u.expr).join(" && ")} ? ${i+oo} : {}`}]});const l=`unit: ${En(e)}, fields: ${r}, values`;return n.concat(Object.assign(Object.assign({name:i+At},o?{init:`{${l}: ${Qt(o)}}`}:{}),a.length?{on:[{events:[{signal:a.join(" || ")}],update:`${a.join(" && ")} ? {${l}: [${a}]} : null`}]}:{}))},marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,o=r==null?void 0:r.signals.visual,a=s==null?void 0:s.signals.visual,c=`data(${I(t.name+Zt)})`;if(Pt.defined(t)||!r&&!s)return n;const l={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const m of v(l))l[m]=[Object.assign({test:`${c}.length && ${c}[0].unit === ${En(e)}`},l[m]),{value:0}];const u=t.mark,{fill:f,fillOpacity:d,cursor:g}=u,p=rb(u,["fill","fillOpacity","cursor"]),h=v(p).reduce((m,b)=>(m[b]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(y=>y).join(" && "),value:p[b]},{value:null}],m),{});return[{name:`${i+wn}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:l}},...n,{name:i+wn,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},g?{cursor:{value:g}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),h)}}]}};function ob(e,t,n,i){const r=n.channel,s=n.signals.visual,o=n.signals.data,a=Pt.defined(t),c=I(e.scaleName(r)),l=e.getScaleComponent(r),u=l?l.get("type"):void 0,f=h=>`scale(${c}, ${h})`,d=e.getSizeSignalRef(r===G?"width":"height").signal,g=`${r}(unit)`,p=Hl(t,(h,m)=>[...h,{events:m.between[0],update:`[${g}, ${g}]`},{events:m,update:`[${s}[0], clamp(${g}, 0, ${d})]`}]);return p.push({events:{signal:t.name+oo},update:ve(u)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},i?{init:Qt(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:Qt(i)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${c}, ${s})`}]})]}function Hl(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(O(`${i} is not an ordered event stream for interval selections.`),n),[])}const ab={defined:e=>e.type==="point",signals:(e,t,n)=>{var i;const r=t.name,s=r+si,o=t.project,a="(item().isVoronoi ? datum.datum : datum)",c=ie((i=e.component.selection)!==null&&i!==void 0?i:{}).reduce((d,g)=>g.type==="interval"?d.concat(g.name+wn):d,[]).map(d=>`indexof(item().mark.name, '${d}') < 0`).join(" && "),l=`datum && item().mark.marktype !== 'group' && indexof(item().mark.role, 'legend') < 0${c?` && ${c}`:""}`;let u=`unit: ${En(e)}, `;if(t.project.hasSelectionId)u+=`${Ke}: ${a}[${I(Ke)}]`;else{const d=o.items.map(g=>{const p=e.fieldDef(g.channel);return(p==null?void 0:p.bin)?`[${a}[${I(e.vgField(g.channel,{}))}], ${a}[${I(e.vgField(g.channel,{binSuffix:"end"}))}]]`:`${a}[${I(g.field)}]`}).join(", ");u+=`fields: ${s}, values: [${d}]`}const f=t.events;return n.concat([{name:r+At,on:f?[{events:f,update:`${l} ? {${u}} : null`,force:!0}]:[]}])}};function $n(e,t,n,i){const r=qi(t)&&t.condition,s=i(t);if(r){const o=V(r),a=o.map(c=>{const l=i(c);if(Kp(c)){const{param:u,empty:f}=c,d=pu(e,{param:u,empty:f});return Object.assign({test:d},l)}else{const u=gr(e,c.test);return Object.assign({test:u},l)}});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function ao(e,t="text"){const n=e.encoding[t];return $n(e,n,t,i=>cr(i,e.config))}function cr(e,t,n="datum"){if(e){if(Pe(e))return B(e.value);if(C(e)){const{format:i,formatType:r}=Xi(e);return ws({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}return}function ql(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,o=n.tooltip;if(j(o))return{tooltip:Vl({tooltip:o},s,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return $n(e,o,"tooltip",c=>{const l=cr(c,r,a);if(l)return l;if(c===null)return;let u=R("tooltip",i,r);return u===!0&&(u={content:"encoding"}),N(u)?{value:u}:H(u)?w(u)?u:u.content==="encoding"?Vl(n,s,r,t):{signal:a}:void 0})}}function Gl(e,t,n,{reactiveGeom:i}={}){const r={},s=i?"datum.datum":"datum",o=[];function a(l,u){const f=Ut(u),d=we(l)?l:Object.assign(Object.assign({},l),{type:e[f].type}),g=d.title||Ps(d,n),p=V(g).join(", ");let h;if(ee(u)){const m=u==="x"?"x2":"y2",b=Ye(e[m]);if(ae(d.bin)&&b){const y=_(d,{expr:s}),S=_(b,{expr:s}),{format:E,formatType:k}=Xi(d);h=Jn(y,S,E,k,n),r[m]=!0}}if((ee(u)||u===Se||u===ke)&&t&&t.fieldChannel===u&&t.offset==="normalize"){const{format:m,formatType:b}=Xi(d);h=ws({fieldOrDatumDef:d,format:m,formatType:b,expr:s,config:n,normalizeStack:!0}).signal}h??(h=cr(d,n,s).signal),o.push({channel:u,key:p,value:h})}Is(e,(l,u)=>{x(l)?a(l,u):Gi(l)&&a(l.condition,u)});const c={};for(const{channel:l,key:u,value:f}of o)!r[l]&&!c[u]&&(c[u]=f);return c}function Vl(e,t,n,{reactiveGeom:i}={}){const r=Gl(e,t,n,{reactiveGeom:i}),s=ht(r).map(([o,a])=>`"${o}": ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function cb(e){const{markDef:t,config:n}=e,i=R("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),lb(e)),ub(e))}function lb(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=R("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in Ld?{}:{ariaRoleDescription:{value:t}}}function ub(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return $n(e,s,"description",c=>cr(c,e.config));const o=R("description",n,i);if(o!=null)return{description:B(o)};if(i.aria===!1)return{};const a=Gl(t,r,i);return L(a)?void 0:{description:{signal:ht(a).map(([c,l],u)=>`"${u>0?"; ":""}${c}: " + (${l})`).join(" + ")}}}function ne(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:c}=n;a===void 0&&(c??(c=R(e,i,s,{vgChannel:o,ignoreVgConfig:!0})),c!==void 0&&(a=B(c)));const l=r[e];return $n(t,l,o??e,u=>js({channel:e,channelDef:u,markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function Xl(e,t={filled:void 0}){var n,i,r,s;const{markDef:o,encoding:a,config:c}=e,{type:l}=o,u=(n=t.filled)!==null&&n!==void 0?n:R("filled",o,c),f=z(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,d=(r=(i=R(u===!0?"color":void 0,o,c,{vgChannel:"fill"}))!==null&&i!==void 0?i:c.mark[u===!0&&"color"])!==null&&r!==void 0?r:f,g=(s=R(u===!1?"color":void 0,o,c,{vgChannel:"stroke"}))!==null&&s!==void 0?s:c.mark[u===!1&&"color"],p=u?"fill":"stroke",h=Object.assign(Object.assign({},d?{fill:B(d)}:{}),g?{stroke:B(g)}:{});return o.color&&(u?o.fill:o.stroke)&&O(Ha("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},h),ne("color",e,{vgChannel:p,defaultValue:u?d:g})),ne("fill",e,{defaultValue:a.fill?d:void 0})),ne("stroke",e,{defaultValue:a.stroke?g:void 0}))}function fb(e){const{encoding:t,mark:n}=e,i=t.order;return!Et(n)&&Pe(i)?$n(e,i,"zindex",r=>B(r.value)):{}}function oi({channel:e,markDef:t,encoding:n={},model:i,bandPosition:r}){const s=`${e}Offset`,o=t[s],a=n[s];if((s==="xOffset"||s==="yOffset")&&a){const l=js({channel:s,channelDef:a,markDef:t,config:i==null?void 0:i.config,scaleName:i.scaleName(s),scale:i.getScaleComponent(s),stack:null,defaultRef:B(o),bandPosition:r});return{offsetType:"encoding",offset:l}}const c=t[s];return c?{offsetType:"visual",offset:c}:{}}function se(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:s,config:o,stack:a}=t,c=r[e],l=r[ct(e)],u=t.scaleName(e),f=t.getScaleComponent(e),{offset:d,offsetType:g}=oi({channel:e,markDef:s,encoding:r,model:t,bandPosition:.5}),p=co({model:t,defaultPos:n,channel:e,scaleName:u,scale:f}),h=!c&&ee(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:db({channel:e,channelDef:c,channel2Def:l,markDef:s,config:o,scaleName:u,scale:f,stack:a,offset:d,defaultRef:p,bandPosition:g==="encoding"?0:void 0});return h?{[i||e]:h}:void 0}function db(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:s,markDef:o}=e;if(C(n)&&r&&t===r.fieldChannel){if(x(n)){let a=n.bandPosition;if(a===void 0&&o.type==="text"&&(t==="radius"||t==="theta")&&(a=.5),a!==void 0)return Wi({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:a,offset:s})}return Vt(n,i,{suffix:"end"},{offset:s})}return Ss(e)}function co({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=e;return()=>{const a=Ut(n),c=St(n),l=R(n,s,o,{vgChannel:c});if(l!==void 0)return Zn(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const u=r.get("type");if(!z([pe.LOG,pe.TIME,pe.UTC],u)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const u=e[de(n)];return Object.assign(Object.assign({},u),{mult:.5})}}return}}const gb={left:"x",center:"xc",right:"x2"},pb={top:"y",middle:"yc",bottom:"y2"};function Yl(e,t,n,i="middle"){if(e==="radius"||e==="theta")return St(e);const r=e==="x"?"align":"baseline",s=R(r,t,n);let o;return w(s)?(O(bg(r)),o=void 0):o=s,e==="x"?gb[o||(i==="top"?"left":"center")]:pb[o||i]}function lr(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?Kl(e,t,{defaultPos:n,defaultPos2:i}):se(e,t,{defaultPos:n})}function Kl(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,o=ct(e),a=de(e),c=mb(t,i,o),l=c[a]?Yl(e,r,s):St(e);return Object.assign(Object.assign({},se(e,t,{defaultPos:n,vgChannel:l})),c)}function mb(e,t,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=e,c=Ut(n),l=de(n),u=St(n),f=i[c],d=e.scaleName(c),g=e.getScaleComponent(c),{offset:p}=n in i||n in s?oi({channel:n,markDef:s,encoding:i,model:e}):oi({channel:c,markDef:s,encoding:i,model:e});if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const m=de(n),b=e.markDef[m];return b!=null?{[m]:{value:b}}:{[u]:{field:e.getName(n)}}}const h=hb({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:a,scaleName:d,scale:g,stack:o,offset:p,defaultRef:void 0});return h!==void 0?{[u]:h}:ur(n,s)||ur(n,{[n]:Ai(n,s,a.style),[l]:Ai(l,s,a.style)})||ur(n,a[r])||ur(n,a.mark)||{[u]:co({model:e,defaultPos:t,channel:n,scaleName:d,scale:g})()}}function hb({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l}){return C(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?Vt(t,s,{suffix:"start"},{offset:c}):Ss({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:c,defaultRef:l})}function ur(e,t){const n=de(e),i=St(e);if(t[i]!==void 0)return{[i]:Zn(e,t[i])};if(t[e]!==void 0)return{[i]:Zn(e,t[e])};if(t[n]){const r=t[n];if(Gt(r))O(ug(n));else return{[n]:Zn(e,r)}}return}function Tt(e,t){var n,i;const{config:r,encoding:s,markDef:o}=e,a=o.type,c=ct(t),l=de(t),u=s[t],f=s[c],d=e.getScaleComponent(t),g=d?d.get("type"):void 0,p=o.orient,h=(i=(n=s[l])!==null&&n!==void 0?n:s.size)!==null&&i!==void 0?i:R("size",o,r,{vgChannel:l}),m=a==="bar"&&(t==="x"?p==="vertical":p==="horizontal");return x(u)&&(U(u.bin)||ae(u.bin)||u.timeUnit&&!f)&&!(h&&!Gt(h))&&!te(g)?vb({fieldDef:u,fieldDef2:f,channel:t,model:e}):(C(u)&&te(g)||m)&&!f?yb(u,t,e):Kl(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function bb(e,t,n,i,r){if(Gt(r))if(n){const o=n.get("type");if(o==="band"){let a=`bandwidth('${t}')`;return r.band!==1&&(a=`${r.band} * ${a}`),{signal:`max(0.25, ${a})`}}else r.band!==1&&(O(xg(o)),r=void 0)}else return{mult:r.band,field:{group:e}};else{if(w(r))return r;if(r)return{value:r}}if(n){const o=n.get("range");if($t(o)&&Y(o.step))return{value:o.step-2}}const s=rr(i.view,e);return{value:s-2}}function yb(e,t,n){const{markDef:i,encoding:r,config:s,stack:o}=n,a=i.orient,c=n.scaleName(t),l=n.getScaleComponent(t),u=de(t),f=ct(t),d=bd(t),g=n.scaleName(d),p=a==="horizontal"&&t==="y"||a==="vertical"&&t==="x";let h;(r.size||i.size)&&(p?h=ne("size",n,{vgChannel:u,defaultRef:B(i.size)}):O(wg(i.type)));const m=!!h,b=Fc({channel:t,fieldDef:e,markDef:i,config:s,scaleType:l==null?void 0:l.get("type"),useVlSizeChannel:p});h=h||{[u]:bb(u,g||c,l,s,b)};const y=(l==null?void 0:l.get("type"))==="band"&&Gt(b)&&!m?"top":"middle",S=Yl(t,i,s,y),E=S==="xc"||S==="yc",{offset:k,offsetType:P}=oi({channel:t,markDef:i,encoding:r,model:n,bandPosition:E?.5:0}),$=Ss({channel:t,channelDef:e,markDef:i,config:s,scaleName:c,scale:l,stack:o,offset:k,defaultRef:co({model:n,defaultPos:"mid",channel:t,scaleName:c,scale:l}),bandPosition:E?P==="encoding"?0:.5:w(b)?{signal:`(1-${b})/2`}:Gt(b)?(1-b.band)/2:0});if(u)return Object.assign({[S]:$},h);{const T=St(f),X=h[u],he=k?Object.assign(Object.assign({},X),{offset:k}):X;return{[S]:$,[T]:j($)?[$[0],Object.assign(Object.assign({},$[1]),{offset:he})]:Object.assign(Object.assign({},$),{offset:he})}}}function ai(e,t,n,i,r){if(da(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(w(n)||w(r)||w(i)){const o=ft(n),a=ft(r),c=ft(i),l=c?`${c} + `:"",u=o?`(${o} ? -1 : 1) * `:"",f=a?`(${a} + ${s})`:s;return{signal:l+u+f}}else return r=r||0,i+(n?-r-s:+r+s)}function vb({fieldDef:e,fieldDef2:t,channel:n,model:i}){var r,s,o;const{config:a,markDef:c,encoding:l}=i,u=i.getScaleComponent(n),f=i.scaleName(n),d=u?u.get("type"):void 0,g=u.get("reverse"),p=Fc({channel:n,fieldDef:e,markDef:c,config:a,scaleType:d}),h=(r=i.component.axes[n])===null||r===void 0?void 0:r[0],m=(s=h==null?void 0:h.get("translate"))!==null&&s!==void 0?s:.5,b=ee(n)&&((o=R("binSpacing",c,a))!==null&&o!==void 0)?o:0,y=ct(n),S=St(n),E=St(y),{offset:k}=oi({channel:n,markDef:c,encoding:l,model:i,bandPosition:0}),P=w(p)?{signal:`(1-${p.signal})/2`}:Gt(p)?(1-p.band)/2:.5;if(U(e.bin)||e.timeUnit)return{[E]:Ql({fieldDef:e,scaleName:f,bandPosition:P,offset:ai(y,b,g,m,k)}),[S]:Ql({fieldDef:e,scaleName:f,bandPosition:w(P)?{signal:`1-${P.signal}`}:1-P,offset:ai(n,b,g,m,k)})};if(ae(e.bin)){const $=Vt(e,f,{},{offset:ai(y,b,g,m,k)});if(x(t))return{[E]:$,[S]:Vt(t,f,{},{offset:ai(n,b,g,m,k)})};if(Wt(e.bin)&&e.bin.step)return{[E]:$,[S]:{signal:`scale("${f}", ${_(e,{expr:"datum"})} + ${e.bin.step})`,offset:ai(n,b,g,m,k)}}}O(Ya(y));return}function Ql({fieldDef:e,scaleName:t,bandPosition:n,offset:i}){return Wi({scaleName:t,fieldOrDatumDef:e,bandPosition:n,offset:i})}const Ob=new Set(["aria","width","height"]);function $e(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?Xl(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},xb(e.markDef,t)),Zl(e,"fill",n)),Zl(e,"stroke",i)),ne("opacity",e)),ne("fillOpacity",e)),ne("strokeOpacity",e)),ne("strokeWidth",e)),ne("strokeDash",e)),fb(e)),ql(e)),ao(e,"href")),cb(e))}function Zl(e,t,n){const{config:i,mark:r,markDef:s}=e,o=R("invalid",s,i);if(o==="hide"&&n&&!Et(r)){const a=Sb(e,{invalid:!0,channels:Pi});if(a)return{[t]:[{test:a,value:null},...V(n)]}}return n?{[t]:n}:{}}function xb(e,t){return Rd.reduce((n,i)=>(!Ob.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=B(e[i])),n),{})}function Sb(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const c=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&ve(c)&&(s[l]=!0)}return s},{}),r=v(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>_s(o,t)).join(` ${s} `)}return}function lo(e){const{config:t,markDef:n}=e,i=R("invalid",n,t);if(i){const r=_b(e,{channels:Be});if(r)return{defined:{signal:r}}}return{}}function _b(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{var a;const c=e.getScaleComponent(o);if(c){const l=c.get("type"),u=e.vgField(o,{expr:"datum",binSuffix:((a=e.stack)===null||a===void 0?void 0:a.impute)?"mid":void 0});u&&ve(l)&&(s[u]=!0)}return s},{}),r=v(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>_s(o,t)).join(` ${s} `)}return}function Jl(e,t){return t!==void 0?{[e]:B(t)}:void 0}const uo="voronoi",eu={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(uo)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if(Et(s))return O(Bd(s)),n;const o={name:e.getName(uo),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},ql(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,c=!1;return n.forEach((l,u)=>{var f;const d=(f=l.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?a=u:d.indexOf(uo)>=0&&(c=!0)}),c||n.splice(a+1,0,o),n}},tu={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!Bs(e.bind),parse:(e,t,n)=>fu(t,n),topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,o=t.init&&t.init[0],a=eu.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((c,l)=>{var u,f;const d=q(`${i}_${c.field}`),g=n.filter(p=>p.name===d);g.length||n.unshift(Object.assign(Object.assign({name:d},o?{init:Qt(o[l])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${I(c.field)}] : null`}]:[],bind:(f=(u=s[c.field])!==null&&u!==void 0?u:s[c.channel])!==null&&f!==void 0?f:s}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.filter(l=>l.name===i+At)[0],o=i+si,a=r.items.map(l=>q(`${i}_${l.field}`)),c=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(s.update=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},fr="_toggle",nu={defined:e=>e.type==="point"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+fr,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+At,i=t.name+fr;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${En(e)}}, `)+`${i} ? ${n} : null`}},jb={defined:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t)=>{t.clear&&(t.clear=N(t.clear)?an(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if(tu.defined(t))for(const i of t.project.items){const r=n.findIndex(s=>s.name===q(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const r of t.project.items){const s=n.findIndex(o=>o.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(s=>s.name===t.name+At);i(r,"null"),nu.defined(t)&&(r=n.findIndex(s=>s.name===t.name+fr),i(r,"false"))}return n}},iu={defined:e=>{const t=e.resolve==="global"&&e.bind&&Bs(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Ke;return t&&!n&&O(Gd),t&&n},parse:(e,t,n)=>{var i;const r=F(n);if(r.select=N(r.select)?{type:r.select,toggle:t.toggle}:Object.assign(Object.assign({},r.select),{toggle:t.toggle}),fu(t,r),ta(n.select)&&(n.select.on||n.select.clear)){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const c of t.events)c.filter=V((i=c.filter)!==null&&i!==void 0?i:[]),c.filter.includes(a)||c.filter.push(a)}const s=Hs(t.bind)?t.bind.legend:"click",o=N(s)?an(s,"view"):V(s);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=Hs(t.bind)&&t.bind.legend,s=o=>a=>{const c=F(a);return c.markname=o,c};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${q(o.field)}_legend`,c=`${i}_${a}`,l=n.filter(u=>u.name===c);if(l.length===0){const u=r.merge.map(s(`${a}_symbols`)).concat(r.merge.map(s(`${a}_labels`))).concat(r.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:c},t.init?{}:{value:null}),{on:[{events:u,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${c}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(d=>d.name===i+At),o=i+si,a=r.items.filter(d=>d.hasLegend).map(d=>q(`${i}_${q(d.field)}_legend`)),c=a.map(d=>`${d} !== null`).join(" && "),l=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const u=n.find(d=>d.name===i+fr),f=Hs(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:f})):u.on[0].events=f),n}};function wb(e,t,n){var i,r,s,o;const a=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;for(const c of ie((r=e.component.selection)!==null&&r!==void 0?r:{})){const l=(s=c.project.hasField[a])!==null&&s!==void 0?s:c.project.hasChannel[t];if(l&&iu.defined(c)){const u=(o=n.get("selections"))!==null&&o!==void 0?o:[];u.push(c.name),n.set("selections",u,!1),l.hasLegend=!0}}}const ru="_translate_anchor",su="_translate_delta",$b={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Pt.defined(t),s=i+ru,{x:o,y:a}=t.project.hasChannel;let c=an(t.translate,"scope");return r||(c=c.map(l=>(l.between[0].markname=i+wn,l))),n.push({name:s,value:{},on:[{events:c.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?`, extent_x: ${r?ro(e,G):`slice(${o.signals.visual})`}`:"")+(a!==void 0?`, extent_y: ${r?ro(e,J):`slice(${a.signals.visual})`}`:"")+"}"}]},{name:i+su,value:{},on:[{events:c,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&ou(e,t,o,"width",n),a!==void 0&&ou(e,t,a,"height",n),n}};function ou(e,t,n,i,r){var s,o;const a=t.name,c=a+ru,l=a+su,u=n.channel,f=Pt.defined(t),d=r.filter($=>$.name===n.signals[f?"data":"visual"])[0],g=e.getSizeSignalRef(i).signal,p=e.getScaleComponent(u),h=p.get("type"),m=p.get("reverse"),b=f?u===G?m?"":"-":m?"-":"":"",y=`${c}.extent_${u}`,S=`${b}${l}.${u} / ${f?`${g}`:`span(${y})`}`,E=f?h==="log"?"panLog":h==="symlog"?"panSymlog":h==="pow"?"panPow":"panLinear":"panLinear",k=f?h==="pow"?`, ${(s=p.get("exponent"))!==null&&s!==void 0?s:1}`:h==="symlog"?`, ${(o=p.get("constant"))!==null&&o!==void 0?o:1}`:"":"",P=`${E}(${y}, ${S}${k})`;d.on.push({events:{signal:l},update:f?P:`clampRange(${P}, 0, ${g})`})}const au="_zoom_anchor",cu="_zoom_delta",Eb={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Pt.defined(t),s=i+cu,{x:o,y:a}=t.project.hasChannel,c=I(e.scaleName(G)),l=I(e.scaleName(J));let u=an(t.zoom,"scope");return r||(u=u.map(f=>(f.markname=i+wn,f))),n.push({name:i+au,on:[{events:u,update:r?"{"+[c?`x: invert(${c}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:u,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&lu(e,t,o,"width",n),a!==void 0&&lu(e,t,a,"height",n),n}};function lu(e,t,n,i,r){var s,o;const a=t.name,c=n.channel,l=Pt.defined(t),u=r.filter(E=>E.name===n.signals[l?"data":"visual"])[0],f=e.getSizeSignalRef(i).signal,d=e.getScaleComponent(c),g=d.get("type"),p=l?ro(e,c):u.name,h=a+cu,m=`${a}${au}.${c}`,b=l?g==="log"?"zoomLog":g==="symlog"?"zoomSymlog":g==="pow"?"zoomPow":"zoomLinear":"zoomLinear",y=l?g==="pow"?`, ${(s=d.get("exponent"))!==null&&s!==void 0?s:1}`:g==="symlog"?`, ${(o=d.get("constant"))!==null&&o!==void 0?o:1}`:"":"",S=`${b}(${p}, ${m}, ${h}${y})`;u.on.push({events:{signal:h},update:l?S:`clampRange(${S}, 0, ${f})`})}const Zt="_store",At="_tuple",kb="_modify",uu="vlSelectionResolve",dr=[ab,sb,ib,nu,tu,Pt,iu,jb,$b,Eb,eu];function Cb(e){let t=e.parent;for(;t&&!ze(t);)t=t.parent;return t}function En(e,{escape:t}={escape:!0}){let n=t?I(e.name):e.name;const i=Cb(e);if(i){const{facet:r}=i;for(const s of je)r[s]&&(n+=` + '__facet_${s}_' + (facet[${I(i.vgField(s))}])`)}return n}function fo(e){var t;return ie((t=e.component.selection)!==null&&t!==void 0?t:{}).reduce((n,i)=>n||i.project.hasSelectionId,!1)}function fu(e,t){(Si(t.select)||!t.select.on)&&delete e.events,(Si(t.select)||!t.select.clear)&&delete e.clear,(Si(t.select)||!t.select.toggle)&&delete e.toggle}function go(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...go(e.object)),t.push(...go(e.property))),t)}function du(e){return e.object.type==="MemberExpression"?du(e.object):e.object.name==="datum"}function gu(e){const t=Af(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&du(i)&&n.add(go(i).slice(1).join("."))}),n}class kn extends M{constructor(t,n,i){super(t);this.model=n,this.filter=i,this.expr=gr(this.model,this.filter,this),this._dependentFields=gu(this.expr)}clone(){return new kn(null,this.model,F(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function Fb(e,t){var n;const i={},r=e.config.selection;if(!t||!t.length)return i;for(const s of t){const o=q(s.name),a=s.select,c=N(a)?a:a.type,l=H(a)?F(a):{type:c},u=r[c];for(const d in u){if(d==="fields"||d==="encodings")continue;d==="mark"&&(l[d]=Object.assign(Object.assign({},u[d]),l[d])),(l[d]===void 0||l[d]===!0)&&(l[d]=(n=u[d])!==null&&n!==void 0?n:l[d])}const f=i[o]=Object.assign(Object.assign({},l),{name:o,type:c,init:s.value,bind:s.bind,events:N(l.on)?an(l.on,"scope"):V(F(l.on))});for(const d of dr)d.defined(f)&&d.parse&&d.parse(e,f,s)}return i}function pu(e,t,n,i="datum"){const r=N(t)?t:t.param,s=q(r),o=I(s+Zt);let a;try{a=e.getSelectionComponent(s,r)}catch(d){return`!!${s}`}if(a.project.timeUnit){const d=n??e.component.data.raw,g=a.project.timeUnit.clone();d.parent?g.insertAsParentOf(d):d.parent=g}const c=a.project.hasSelectionId?"vlSelectionIdTest(":"vlSelectionTest(",l=a.resolve==="global"?")":`, ${I(a.resolve)})`,u=`${c}${o}, ${i}${l}`,f=`length(data(${o}))`;return t.empty===!1?`${f} && ${u}`:`!${f} || ${u}`}function mu(e,t,n){const i=q(t),r=n.encoding;let s=n.field,o;try{o=e.getSelectionComponent(i,t)}catch(a){return i}if(!r&&!s)s=o.project.items[0].field,o.project.items.length>1&&O(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${I(s)}.`);else if(r&&!s){const a=o.project.items.filter(c=>c.channel===r);!a.length||a.length>1?(s=o.project.items[0].field,O((a.length?"Multiple ":"No ")+`matching ${I(r)} encoding found for selection ${I(n.param)}. Using "field": ${I(s)}.`)):s=a[0].field}return`${o.name}[${I(xe(s))}]`}function Nb(e,t){var n;for(const[i,r]of ht((n=e.component.selection)!==null&&n!==void 0?n:{})){const s=e.getName(`lookup_${i}`);e.component.data.outputNodes[s]=r.materialized=new le(new kn(t,e,{param:i}),s,W.Lookup,e.component.data.outputNodeRefCounts)}}function gr(e,t,n){return Wn(t,i=>N(i)?i:ap(i)?pu(e,i,n):ic(i))}var pr=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Pb(e,t){return e?j(e)&&!wt(e)?e.map(n=>Ps(n,t)).join(", "):e:void 0}function po(e,t,n,i){var r,s,o,a,c;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(s=(a=e.encode)[t])!==null&&s!==void 0||(a[t]={}),(o=(c=e.encode[t]).update)!==null&&o!==void 0||(c.update={}),e.encode[t].update[n]=i}function ci(e,t,n,i={header:!1}){var r,s;const o=e.combine(),{disable:a,orient:c,scale:l,labelExpr:u,title:f,zindex:d}=o,g=pr(o,["disable","orient","scale","labelExpr","title","zindex"]);if(a)return;for(const p in g){const h=um[p],m=g[p];if(h&&h!==t&&h!=="both")delete g[p];else if(ii(m)){const{condition:b}=m,y=pr(m,["condition"]),S=V(b),E=Mc[p];if(E){const{vgProp:k,part:P}=E,$=[...S.map(T=>{const{test:X}=T,he=pr(T,["test"]);return Object.assign({test:gr(null,X)},he)}),y];po(g,P,k,$),delete g[p]}else if(E===null){const k={signal:S.map(P=>{const{test:$}=P,T=pr(P,["test"]);return`${gr(null,$)} ? ${ka(T)} : `}).join("")+ka(y)};g[p]=k}}else if(w(m)){const b=Mc[p];if(b){const{vgProp:y,part:S}=b;po(g,S,y,m),delete g[p]}}z(["labelAlign","labelBaseline"],p)&&g[p]===null&&delete g[p]}if(t==="grid"){if(!g.grid)return;if(g.encode){const{grid:p}=g.encode;g.encode=Object.assign({},p?{grid:p}:{}),L(g.encode)&&delete g.encode}return Object.assign(Object.assign({scale:l,orient:c},g),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:K(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(u!==void 0){let h=u;((s=(r=g.encode)===null||r===void 0?void 0:r.labels)===null||s===void 0?void 0:s.update)&&w(g.encode.labels.update.text)&&(h=Lt(u,"datum.label",g.encode.labels.update.text.signal)),po(g,"labels","text",{signal:h})}if(g.labelAlign===null&&delete g.labelAlign,g.encode){for(const h of Dc)e.hasAxisPart(h)||delete g.encode[h];L(g.encode)&&delete g.encode}const p=Pb(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:c,grid:!1},p?{title:p}:{}),g),n.aria===!1?{aria:!1}:{}),{zindex:K(d,0)})}}function hu(e){const{axes:t}=e.component,n=[];for(const i of Be)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function Tb(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>ci(r,"grid",t)),...i.map(r=>ci(r,"grid",t)),...n.map(r=>ci(r,"main",t)),...i.map(r=>ci(r,"main",t))].filter(r=>r)}function bu(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},c=new Set([...v(o),...v(a)]),l={};for(const u of c.values())l[u]={signal:`${i.signal} === "${s}" ? ${ft(o[u])} : ${ft(a[u])}`};return l}return t[r]})])}function Ab(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:cc(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=w(n)?"axisOrient":`axis${Bn(n)}`,a=[...r,...r.map(l=>s+l.substr(4))],c=["axis",o,s];return{vlOnlyAxisConfig:bu(a,i,e,n),vgAxisConfig:bu(c,i,e,n),axisConfigStyle:zb([...c,...a],i)}}function zb(e,t){var n;const i=[{}];for(const r of e){let s=(n=t[r])===null||n===void 0?void 0:n.style;if(s){s=V(s);for(const o of s)i.push(t.style[o])}}return Object.assign.apply(null,i)}function mo(e,t,n,i={}){var r;const s=Fa(e,n,t);if(s!==void 0)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const yu={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return xc(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return Sc(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return(i=t.grid)!==null&&i!==void 0?i:Ib(n,e)},gridScale:({model:e,channel:t})=>Rb(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||Ou(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||vu(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:Mb(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:Db(t.type,n,x(t)&&!!t.timeUnit,x(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var s;const o=e==="x"?"width":e==="y"?"height":void 0,a=o?t.getSizeSignalRef(o):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:Wb({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=xu(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return Pa(r?[kc(r)]:[],x(o)?[kc(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Bb(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:Hb(n,t)}};function Ib(e,t){return!te(e)&&x(t)&&!U(t==null?void 0:t.bin)&&!ae(t==null?void 0:t.bin)}function Rb(e,t){const n=t==="x"?"y":"x";return e.getScaleComponent(n)?e.scaleName(n):void 0}function Lb(e,t,n,i,r){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return w(s)?s:Hn(s);{const{configValue:o}=mo("labelAngle",i,t==null?void 0:t.style,r);return o!==void 0?Hn(o):n===G&&z([hs,ms],e.type)&&!(x(e)&&e.timeUnit)?270:void 0}}function ho(e){return`(((${e.signal} % 360) + 360) % 360)`}function vu(e,t,n,i){if(e!==void 0)if(n==="x"){if(w(e)){const r=ho(e),s=w(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(w(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(w(e)){const r=ho(e),s=w(t)?`(${t.signal} === "left")`:t==="left",o=i?'"middle"':"null";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${o} : (45 <= ${r} && ${r} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(w(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}return}function Ou(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(w(e)){const o=ho(e),a=w(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${r?`(${o} + 90)`:o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${a} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(w(t)){const o=r<e&&e<180+r?"===":"!==",a=`${t.signal} ${o} "${s}"`;return{signal:`${a} ? "left" : "right"`}}return(r<e&&e<180+r)===(t===s)?"left":"right"}function Mb(e,t){return t==="x"&&z(["quantitative","temporal"],e)?!0:void 0}function Db(e,t,n,i){return n&&!H(i)||e!=="nominal"&&e!=="ordinal"?t==="log"||t==="symlog"?"greedy":!0:void 0}function Ub(e){return e==="x"?"bottom":"left"}function Wb({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!te(t)&&t!=="log"){if(x(e)){if(U(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&z(["month","hours","day","quarter"],(r=re(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}function xu(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;return s&&o?Ta(s,o):s||(o||(s!==void 0?s:o!==void 0?o:void 0))}function Bb(e,t){const n=e.values;return j(n)?Lc(t,n):w(n)?n:void 0}function Hb(e,t){return e==="rect"&&Vi(t)?1:0}class Cn extends M{constructor(t,n){super(t);this.transform=n,this._dependentFields=gu(this.transform.calculate)}clone(){return new Cn(null,F(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(!Yt(i))return;if(Ec(i.sort)){const{field:s,timeUnit:o}=i,a=i.sort,c=a.map((l,u)=>`${ic({field:s,timeUnit:o,equal:l})} ? ${u} : `).join("")+a.length;t=new Cn(t,{calculate:c,as:Fn(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${A(this.transform)}`}}function Fn(e,t,n){return _(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function mr(e,t){return z(["top","bottom"],t)?"column":z(["left","right"],t)||e==="row"?"row":"column"}function Nn(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return K((t||{})[e],r[e],n.header[e])}function hr(e,t,n,i){const r={};for(const s of e){const o=Nn(s,t||{},n,i);o!==void 0&&(r[s]=o)}return r}const bo=["row","column"],yo=["header","footer"];function qb(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=hr(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),c=mr(t,a),l=Hn(o);return{name:`${t}-title`,type:"group",role:`${c}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),_u(l,c)),Su(c,l,s)),ju(i,r,t,Tm,ol))}}function Su(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=Ou(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function _u(e,t){const n=vu(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Gb(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of yo)if(n[r])for(const s of n[r]){const o=Xb(e,t,r,n,s);o!=null&&i.push(o)}return i}function Vb(e,t){var n;const{sort:i}=e;return Ge(i)?{field:_(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:j(i)?{field:Fn(e,t,{expr:"datum"}),order:"ascending"}:{field:_(e,{expr:"datum"}),order:i??"ascending"}}function vo(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:c}=hr(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=ws({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,u=mr(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:c?Lt(Lt(c,"datum.label",l),"datum.value",_(e,{expr:"parent"})):l}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),_u(s,u)),Su(u,s,o)),ju(n,e,t,Am,al))}function Xb(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=hr(["labelOrient"],o.header,a,t);(t==="row"&&!z(["top","bottom"],f)||t==="column"&&!z(["left","right"],f))&&(s=vo(o,t,a))}const c=ze(e)&&!ei(e.facet),l=r.axes,u=(l==null?void 0:l.length)>0;if(s||u){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(`${t}_domain`)},sort:Vb(o,t)}:{}),u&&c?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),u?{axes:l}:{})}}return null}const Yb={column:{start:0,end:1},row:{start:1,end:0}};function Kb(e,t){return Yb[t][e]}function Qb(e,t){const n={};for(const i of je){const r=e[i];if(r==null?void 0:r.facetFieldDef){const{titleAnchor:s,titleOrient:o}=hr(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=mr(i,o),c=Kb(s,a);c!==void 0&&(n[a]=c)}}return L(n)?void 0:n}function ju(e,t,n,i,r){const s={};for(const o of i){if(!r[o])continue;const a=Nn(o,t==null?void 0:t.header,e,n);a!==void 0&&(s[r[o]]=a)}return s}function Oo(e){return[...br(e,"width"),...br(e,"height"),...br(e,"childWidth"),...br(e,"childHeight")]}function br(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(te(o)&&$t(a)){const c=e.scaleName(n);if(ze(e.parent)){const l=e.parent.component.resolve;if(l.scale[n]==="independent")return[wu(c,a)]}return[wu(c,a),{name:r,update:$u(c,s,`domain('${c}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=Xs(e.config.view,s?"width":"height"),c=`isFinite(${o}) ? ${o} : ${a}`;return[{name:r,init:c,on:[{update:c,events:"window:resize"}]}]}else return[{name:r,value:i}]}function wu(e,t){const n=`${e}_step`;return w(t.step)?{name:n,update:t.step.signal}:{name:n,value:t.step}}function $u(e,t,n){const i=t.get("type"),r=t.get("padding"),s=K(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${ft(o)}, ${ft(s)}) * ${e}_step`}function Eu(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function ku(e,t){return v(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),$n(t,r,i,s=>B(s.value)))},{})}function Cu(e,t){if(ze(t))return e==="theta"?"independent":"shared";if(An(t))return"shared";if(Io(t))return ee(e)||e==="theta"||e==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function xo(e,t){const n=e.scale[t],i=ee(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&O(Fg(t)),"independent"):e[i][t]||"shared"}const Zb=Object.assign(Object.assign({},Rm),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),Fu=v(Zb);class Jb extends pt{}const Nu={symbols:ey,gradient:ty,labels:ny,entries:iy};function ey(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){var o,a,c,l,u,f,d,g;if(s!=="symbol")return;const{markDef:p,encoding:h,config:m,mark:b}=n,y=p.filled&&b!=="trail";let S=Object.assign(Object.assign({},Dd({},n,Tp)),Xl(n,{filled:y}));const E=(o=r.get("symbolOpacity"))!==null&&o!==void 0?o:m.legend.symbolOpacity,k=(a=r.get("symbolFillColor"))!==null&&a!==void 0?a:m.legend.symbolFillColor,P=(c=r.get("symbolStrokeColor"))!==null&&c!==void 0?c:m.legend.symbolStrokeColor,$=E===void 0?(l=Pu(h.opacity))!==null&&l!==void 0?l:p.opacity:void 0;if(S.fill){if(i==="fill"||y&&i===ue)delete S.fill;else if(S.fill.field)k?delete S.fill:(S.fill=B((u=m.legend.symbolBaseFillColor)!==null&&u!==void 0?u:"black"),S.fillOpacity=B($??1));else if(j(S.fill)){const T=(g=(d=So((f=h.fill)!==null&&f!==void 0?f:h.color))!==null&&d!==void 0?d:p.fill)!==null&&g!==void 0?g:y&&p.color;T&&(S.fill=B(T))}}if(S.stroke){if(i==="stroke"||!y&&i===ue)delete S.stroke;else if(S.stroke.field||P)delete S.stroke;else if(j(S.stroke)){const T=K(So(h.stroke||h.color),p.stroke,y?p.color:void 0);T&&(S.stroke={value:T})}}if(i!==at){const T=x(t)&&Au(n,r,t);T?S.opacity=[Object.assign({test:T},B($??1)),B(m.legend.unselectedOpacity)]:$&&(S.opacity=B($))}return S=Object.assign(Object.assign({},S),e),L(S)?void 0:S}function ty(e,{model:t,legendType:n,legendCmpt:i}){var r;if(n!=="gradient")return;const{config:s,markDef:o,encoding:a}=t;let c={};const l=(r=i.get("gradientOpacity"))!==null&&r!==void 0?r:s.legend.gradientOpacity,u=l===void 0?Pu(a.opacity)||o.opacity:void 0;return u&&(c.opacity=B(u)),c=Object.assign(Object.assign({},c),e),L(c)?void 0:c}function ny(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=x(t)?Au(n,r,t):void 0,c=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:u}=s;let f;Xt(u)?f=Ne({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:u,config:o}):l===void 0&&u===void 0&&o.customFormatTypes&&(t.type==="quantitative"&&o.numberFormatType?f=Ne({fieldOrDatumDef:t,field:"datum.value",format:o.numberFormat,formatType:o.numberFormatType,config:o}):t.type==="temporal"&&o.timeFormatType&&x(t)&&t.timeUnit===void 0&&(f=Ne({fieldOrDatumDef:t,field:"datum.value",format:o.timeFormat,formatType:o.timeFormatType,config:o})));const d=Object.assign(Object.assign(Object.assign({},c?{opacity:c}:{}),f?{text:f}:{}),e);return L(d)?void 0:d}function iy(e,{legendCmpt:t}){const n=t.get("selections");return(n==null?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function Pu(e){return Tu(e,(t,n)=>Math.max(t,n.value))}function So(e){return Tu(e,(t,n)=>K(t,n.value))}function Tu(e,t){return Zp(e)?V(e.condition).reduce(t,e.value):Pe(e)?e.value:void 0}function Au(e,t,n){const i=t.get("selections");if(!(i==null?void 0:i.length))return;const r=I(n.field);return i.map(s=>{const o=I(q(s)+Zt);return`(!length(data(${o})) || (${s}[${r}] && indexof(${s}[${r}], datum.value) >= 0))`}).join(" || ")}const zu={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return xc(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return Sc(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:uy(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:fy(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:sy(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>On(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(dn(n)&&Fe(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>ry(t,e)};function ry(e,t){const n=e.values;return j(n)?Lc(t,n):w(n)?n:void 0}function sy(e,t,n,i){var r;if(t!=="shape"){const s=(r=So(n))!==null&&r!==void 0?r:i;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function oy(e){const{legend:t}=e;return K(t.type,ay(e))}function ay({channel:e,timeUnit:t,scaleType:n}){if(dn(e)){if(z(["quarter","month","day"],t))return"symbol";if(Fe(n))return"gradient"}return"symbol"}function cy({legendConfig:e,legendType:t,orient:n,legend:i}){var r,s;return(s=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:ly(n,t)}function ly(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function uy({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:c}=e;return Fe(r)?n==="horizontal"?i==="top"||i==="bottom"?Iu(t,"width",o,s):o:Iu(t,"height",c,a):void 0}function Iu(e,t,n,i){const r=e.getSizeSignalRef(t).signal;return{signal:`clamp(${r}, ${n}, ${i})`}}function fy(e){return z(["quantile","threshold","log","symlog"],e)?"greedy":void 0}function Ru(e){const t=Q(e)?dy(e):hy(e);return e.component.legends=t,t}function dy(e){const{encoding:t}=e,n={};for(const i of[ue,...ll]){const r=Z(t[i]);if(!r||!e.getScaleComponent(i))continue;if(i===fe&&x(r)&&r.type===hn)continue;n[i]=my(e,i)}return n}function gy(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function py(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n==null?void 0:n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function my(e,t){var n,i,r;let s=e.legend(t);const{markDef:o,encoding:a,config:c}=e,l=c.legend,u=new Jb({},gy(e,t));wb(e,t,u);const f=s!==void 0?!s:l.disable;if(u.set("disable",f,s!==void 0),f)return u;s=s||{};const d=e.getScaleComponent(t).get("type"),g=Z(a[t]),p=x(g)?(n=re(g.timeUnit))===null||n===void 0?void 0:n.unit:void 0,h=s.orient||c.legend.orient||"right",m=oy({legend:s,channel:t,timeUnit:p,scaleType:d}),b=cy({legend:s,legendType:m,orient:h,legendConfig:l}),y={legend:s,channel:t,model:e,markDef:o,encoding:a,fieldOrDatumDef:g,legendConfig:l,config:c,scaleType:d,orient:h,legendType:m,direction:b};for(const $ of Fu){if(m==="gradient"&&$.startsWith("symbol")||m==="symbol"&&$.startsWith("gradient"))continue;const T=$ in zu?zu[$](y):s[$];if(T!==void 0){const X=py(T,$,s,e.fieldDef(t));(X||c.legend[$]===void 0)&&u.set($,T,X)}}const S=(i=s==null?void 0:s.encoding)!==null&&i!==void 0?i:{},E=u.get("selections"),k={},P={fieldOrDatumDef:g,model:e,channel:t,legendCmpt:u,legendType:m};for(const $ of["labels","legend","title","symbols","gradient","entries"]){const T=ku((r=S[$])!==null&&r!==void 0?r:{},e),X=$ in Nu?Nu[$](T,P):T;X!==void 0&&!L(X)&&(k[$]=Object.assign(Object.assign(Object.assign({},(E==null?void 0:E.length)&&x(g)?{name:`${q(g.field)}_legend_${$}`}:{}),(E==null?void 0:E.length)?{interactive:!!E}:{}),{update:X}))}return L(k)||u.set("encode",k,!!(s==null?void 0:s.encoding)),u}function hy(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){Ru(i);for(const r of v(i.component.legends))n.legend[r]=xo(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=Lu(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of v(t))for(const r of e.children){if(!r.component.legends[i])continue;n.legend[i]==="shared"&&delete r.component.legends[i]}return t}function Lu(e,t){var n,i,r,s;if(!e)return t.clone();const o=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let c=!1;for(const l of Fu){const u=Ft(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,d)=>{switch(l){case"symbolType":return by(f,d);case"title":return Aa(f,d);case"type":return c=!0,Oe("symbol")}return ar(f,d,l,"legend")});e.setWithExplicit(l,u)}return c&&(((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient)&&ji(e.implicit,["encode","gradient"]),((s=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||s===void 0?void 0:s.gradient)&&ji(e.explicit,["encode","gradient"])),e}function by(e,t){return t.value==="circle"?t:e}var yy=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function vy(e,t,n,i){var r,s,o,a,c;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(s=(a=e.encode)[t])!==null&&s!==void 0||(a[t]={}),(o=(c=e.encode[t]).update)!==null&&o!==void 0||(c.update={}),e.encode[t].update[n]=i}function Mu(e){const t=e.component.legends,n={};for(const r of v(t)){const s=e.getScaleComponent(r),o=D(s.get("domains"));if(n[o])for(const a of n[o]){const c=Lu(a,t[r]);c||n[o].push(t[r])}else n[o]=[t[r].clone()]}const i=ie(n).flat().map(r=>Oy(r,e.config)).filter(r=>r!==void 0);return i}function Oy(e,t){var n,i,r;const s=e.combine(),{disable:o,labelExpr:a,selections:c}=s,l=yy(s,["disable","labelExpr","selections"]);if(o)return;if(t.aria===!1&&l.aria==null&&(l.aria=!1),(n=l.encode)===null||n===void 0?void 0:n.symbols){const u=l.encode.symbols.update;u.fill&&u.fill.value!=="transparent"&&!u.stroke&&!l.stroke&&(u.stroke={value:"transparent"});for(const f of ll)l[f]&&delete u[f]}if(l.title||delete l.title,a!==void 0){let u=a;((r=(i=l.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&w(l.encode.labels.update.text)&&(u=Lt(a,"datum.label",l.encode.labels.update.text.signal)),vy(l,"labels","text",{signal:u})}return l}function xy(e){return An(e)||Io(e)?Sy(e):Du(e)}function Sy(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),Du(e))}function Du(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const c=w(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return z(o,c)||o.push(c),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const _y=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Uu extends pt{constructor(t,n,i,r){super(Object.assign({},n),{name:t});this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function Wu(e){e.component.projection=Q(e)?jy(e):Ey(e)}function jy(e){var t;if(e.hasProjection){const n=ge(e.specifiedProjection),i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=i?wy(e):void 0,o=new Uu(e.projectionName(!0),Object.assign(Object.assign({},(t=ge(e.config.projection))!==null&&t!==void 0?t:{}),n??{}),r,s);return o.get("type")||o.set("type","equalEarth",!1),o}return}function wy(e){const t=[],{encoding:n}=e;for(const i of[[De,Me],[_e,Ce]])(Z(n[i[0]])||Z(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(fe)&&e.typedFieldDef(fe).type===hn&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(W.Main)),t}function $y(e,t){const n=Rr(_y,r=>!sn(e.explicit,r)&&!sn(t.explicit,r)?!0:!!(sn(e.explicit,r)&&sn(t.explicit,r)&&Ie(e.get(r),t.get(r)))),i=Ie(e.size,t.size);if(i){if(n)return e;if(Ie(e.explicit,{}))return t;if(Ie(t.explicit,{}))return e}return null}function Ey(e){if(e.children.length===0)return;let t;for(const i of e.children)Wu(i);const n=Rr(e.children,i=>{const r=i.component.projection;if(r)if(t){const s=$y(t,r);return s&&(t=s),!!s}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new Uu(i,t.specifiedProjection,t.size,F(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),i),o.merged=!0)}return r}return}var ky=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Cy(e,t,n,i){var r,s;if(ni(t,n)){const o=Q(e)?(s=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&s!==void 0?s:{}:{},a=_(t,{expr:"datum"}),c=_(t,{expr:"datum",binSuffix:"end"});return{formulaAs:_(t,{binSuffix:"range",forAs:!0}),formula:Jn(a,c,o.format,o.formatType,i)}}return{}}function Bu(e,t){return`${_a(e)}_${t}`}function Fy(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function _o(e,t,n){var i;const r=(i=Ki(n,void 0))!==null&&i!==void 0?i:{},s=Bu(r,t);return e.getName(`${s}_bins`)}function Ny(e){return"as"in e}function Hu(e,t,n){let i,r;Ny(e)?i=N(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[_(e,{forAs:!0}),_(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},Ki(t,void 0)),o=Bu(s,e.field),{signal:a,extentSignal:c}=Fy(n,o);if(Ti(s.extent)){const u=s.extent;r=mu(n,u.param,u),delete s.extent}const l=Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[i]},a?{signal:a}:{}),c?{extentSignal:c}:{}),r?{span:r}:{});return{key:o,binComponent:l}}class et extends M{constructor(t,n){super(t);this.bins=n}clone(){return new et(null,F(this.bins))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{if(we(s)&&U(s.bin)){const{key:a,binComponent:c}=Hu(s,s.bin,n);r[a]=Object.assign(Object.assign(Object.assign({},c),r[a]),Cy(n,s,o,n.config))}return r},{});return L(i)?null:new et(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:s}=Hu(n,n.bin,i);return new et(t,{[r]:s})}merge(t,n){for(const i of v(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=Re([...this.bins[i].as,...t.bins[i].as],A)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(ie(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(ie(this.bins).map(t=>t.field))}hash(){return`Bin ${A(this.bins)}`}assemble(){return ie(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,s=t.bin,{extent:o}=s,a=ky(s,["extent"]),c=Object.assign(Object.assign(Object.assign({type:"bin",field:xe(t.field),as:i,signal:t.signal},Ti(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(n.push({type:"extent",field:xe(t.field),signal:t.extentSignal}),c.extent={signal:t.extentSignal}),n.push(c);for(const l of r)for(let u=0;u<2;u++)n.push({type:"formula",expr:_({field:i[u]},{expr:"datum"}),as:l[u]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function Py(e,t,n,i){var r;const s=Q(i)?i.encoding[ct(t)]:void 0;if(we(n)&&Q(i)&&Nc(n,s,i.markDef,i.config))e.add(_(n,{})),e.add(_(n,{suffix:"end"})),n.bin&&ni(n,t)&&e.add(_(n,{binSuffix:"range"}));else if(ud(t)){const o=ld(t);e.add(i.getName(o))}else e.add(_(n));return Yt(n)&&xp((r=n.scale)===null||r===void 0?void 0:r.range)&&e.add(n.scale.range.field),e}function Ty(e,t){var n;for(const i of v(t)){const r=t[i];for(const s of v(r))i in e?e[i][s]=new Set([...(n=e[i][s])!==null&&n!==void 0?n:[],...r[s]]):e[i]={[s]:r[s]}}}class Te extends M{constructor(t,n,i){super(t);this.dimensions=n,this.measures=i}clone(){return new Te(null,new Set(this.dimensions),F(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(o=>{o.aggregate&&(i=!0)});const r={},s=new Set;return i?(n.forEachFieldDef((o,a)=>{var c,l,u,f;const{aggregate:d,field:g}=o;if(d)if(d==="count")(c=r["*"])!==null&&c!==void 0||(r["*"]={}),r["*"].count=new Set([_(o,{forAs:!0})]);else{if(lt(d)||jt(d)){const p=lt(d)?"argmin":"argmax",h=d[p];(l=r[h])!==null&&l!==void 0||(r[h]={}),r[h][p]=new Set([_({op:p,field:h},{forAs:!0})])}else(u=r[g])!==null&&u!==void 0||(r[g]={}),r[g][d]=new Set([_(o,{forAs:!0})]);_t(a)&&n.scaleDomain(a)==="unaggregated"&&((f=r[g])!==null&&f!==void 0||(r[g]={}),r[g].min=new Set([_({field:g,aggregate:"min"},{forAs:!0})]),r[g].max=new Set([_({field:g,aggregate:"max"},{forAs:!0})]))}else Py(s,a,o,n)}),s.size+v(r).length===0?null:new Te(t,s,r)):null}static makeFromTransform(t,n){var i,r,s;const o=new Set,a={};for(const c of n.aggregate){const{op:l,field:u,as:f}=c;l&&(l==="count"?((i=a["*"])!==null&&i!==void 0||(a["*"]={}),a["*"].count=new Set([f||_(c,{forAs:!0})])):((r=a[u])!==null&&r!==void 0||(a[u]={}),a[u][l]=new Set([f||_(c,{forAs:!0})])))}for(const c of(s=n.groupby)!==null&&s!==void 0?s:[])o.add(c);return o.size+v(a).length===0?null:new Te(t,o,a)}merge(t){return sa(this.dimensions,t.dimensions)?(Ty(this.measures,t.measures),!0):(Gg("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...v(this.measures)])}producedFields(){const t=new Set;for(const n of v(this.measures))for(const i of v(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${A({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const s of v(this.measures))for(const o of v(this.measures[s]))for(const a of this.measures[s][o])i.push(a),t.push(o),n.push(s==="*"?null:xe(s));const r={type:"aggregate",groupby:[...this.dimensions].map(xe),ops:t,fields:n,as:i};return r}}class Pn extends M{constructor(t,n,i,r){super(t);this.model=n,this.name=i,this.data=r;for(const s of je){const o=n.facet[s];if(o){const{bin:a,sort:c}=o;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[_(o),...U(a)?[_(o,{binSuffix:"end"})]:[]]},Ge(c)?{sortField:c}:j(c)?{sortIndexField:Fn(o,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of je)this[n]&&(t+=` ${n.charAt(0)}:${A(this[n])}`);return t}get fields(){var t;const n=[];for(const i of je)((t=this[i])===null||t===void 0?void 0:t.fields)&&n.push(...this[i].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of je)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of Be){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(te(r)&&$t(s)){const o=vr(this.childModel,n),a=To(o);a?t[n]=a:O(es(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x",facet:void 0}[t],s=[],o=[],a=[];r&&i&&i[r]&&(n?(s.push(`distinct_${i[r]}`),o.push("max")):(s.push(i[r]),o.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:c,sortIndexField:l}=this[t];if(c){const{op:u=Bi,field:f}=c;s.push(f),o.push(u),a.push(_(c,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var n,i;const{columns:r}=this.model.layout,{layoutHeaders:s}=this.model.component,o=[],a={};for(const u of bo){for(const f of yo){const d=(n=s[u]&&s[u][f])!==null&&n!==void 0?n:[];for(const g of d)if(((i=g.axes)===null||i===void 0?void 0:i.length)>0){a[u]=!0;break}}if(a[u]){const f=`length(data("${this.facet.name}"))`,d=u==="row"?r?{signal:`ceil(${f} / ${r})`}:1:r?{signal:`min(${f}, ${r})`}:{signal:f};o.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:d}]})}}const{row:c,column:l}=a;return(c||l)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,n;const i=[];let r=null;const s=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:c}=this;if(o&&a&&(s.x||s.y)){r=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),u=l.map(()=>"distinct");i.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:u}]})}for(const l of[it,nt])this[l]&&i.push(this.assembleRowColumnHeaderData(l,r,s));if(c){const l=this.assembleFacetHeaderData(s);l&&i.push(...l)}return i}}function qu(e){return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function Ay(e,t){const n=Ur(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.startsWith("date:")){const i=qu(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.startsWith("utc:")){const i=qu(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return O(Jd(t)),null}function zy(e){const t={};return _i(e.filter,n=>{var i;if(nc(n)){let r=null;as(n)?r=ye(n.equal):ls(n)?r=ye(n.lte):cs(n)?r=ye(n.lt):us(n)?r=ye(n.gt):fs(n)?r=ye(n.gte):ds(n)?r=n.range[0]:gs(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(Ht(r)?t[n.field]="date":Y(r)?t[n.field]="number":N(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function Iy(e){const t={};function n(i){Sn(i)?t[i.field]="date":i.type==="quantitative"&&Fd(i.aggregate)?t[i.field]="number":un(i.field)>1?i.field in t||(t[i.field]="flatten"):Yt(i)&&Ge(i.sort)&&un(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((Q(e)||ze(e))&&e.forEachFieldDef((i,r)=>{if(we(i))n(i);else{const s=Ut(r),o=e.fieldDef(s);n(Object.assign(Object.assign({},i),{type:o.type}))}}),Q(e)){const{mark:i,markDef:r,encoding:s}=e;if(Et(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",a=s[o];x(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function Ry(e){const t={};if(Q(e)&&e.component.selection)for(const n of v(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&un(r.field)>1&&(t[r.field]="flatten")}return t}class oe extends M{constructor(t,n){super(t);this._parse=n}clone(){return new oe(null,F(this._parse))}hash(){return`Parse ${A(this._parse)}`}static makeExplicit(t,n,i){var r;let s={};const o=n.data;return!Nt(o)&&((r=o==null?void 0:o.format)===null||r===void 0?void 0:r.parse)&&(s=o.format.parse),this.makeWithAncestors(t,s,{},i)}static makeWithAncestors(t,n,i,r){for(const a of v(i)){const c=r.getWithExplicit(a);c.value!==void 0&&(c.explicit||c.value===i[a]||c.value==="derived"||i[a]==="flatten"?delete i[a]:O(Ua(a,i[a],c.value)))}for(const a of v(n)){const c=r.get(a);c!==void 0&&(c===n[a]?delete n[a]:O(Ua(a,n[a],c)))}const s=new pt(n,i);r.copyAll(s);const o={};for(const a of v(s.combine())){const c=s.get(a);c!==null&&(o[a]=c)}return v(o).length===0||r.parseNothing?null:new oe(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of v(this._parse)){const i=this._parse[n];un(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(v(this._parse))}dependentFields(){return new Set(v(this._parse))}assembleTransforms(t=!1){return v(this._parse).filter(n=>t?un(n)>1:!0).map(n=>{const i=Ay(n,this._parse[n]);if(!i)return null;const r={type:"formula",expr:i,as:Wr(n)};return r}).filter(n=>n!==null)}}class zt extends M{clone(){return new zt(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([Ke])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Ke}}}class li extends M{constructor(t,n){super(t);this.params=n}clone(){return new li(null,this.params)}dependentFields(){return new Set}producedFields(){return}hash(){return`Graticule ${A(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class ui extends M{constructor(t,n){super(t);this.params=n}clone(){return new ui(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${A(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class Jt extends M{constructor(t){super(null);t??(t={name:"source"});let n;if(Nt(t)||(n=t.format?Object.assign({},be(t.format,["parse"])):{}),ri(t))this._data={values:t.values};else if(jn(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];z(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else Ul(t)?this._data={values:[{type:"Sphere"}]}:(Ml(t)||Nt(t))&&(this._data={});this._generator=Nt(t),t.name&&(this._name=t.name),n&&!L(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){return}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var Gu=function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},Ly=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},fi;function jo(e){return e instanceof Jt||e instanceof li||e instanceof ui}class wo{constructor(){fi.set(this,void 0),Gu(this,fi,!1,"f")}setModified(){Gu(this,fi,!0,"f")}get modifiedFlag(){return Ly(this,fi,"f")}}fi=new WeakMap;class en extends wo{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const n=this.getNodeDepths(t,0,new Map),i=[...n.entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class $o extends wo{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class My extends $o{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of v(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class Dy extends $o{constructor(t){super();this.requiresSelectionId=t&&fo(t)}run(t){t instanceof zt&&(this.requiresSelectionId&&(jo(t.parent)||t.parent instanceof Te||t.parent instanceof oe)||(this.setModified(),t.remove()))}}class Uy extends wo{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof Je&&(i=t.producedFields(),Lr(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class Wy extends $o{constructor(){super()}run(t){t instanceof le&&!t.isRequired()&&(this.setModified(),t.remove())}}class By extends en{run(t){if(jo(t))return;if(t.numChildren()>1)return;for(const n of t.children)if(n instanceof oe)if(t instanceof oe)this.setModified(),t.merge(n);else{if(Dr(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}return}}class Hy extends en{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof oe);if(t.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const o of i){const a=o.parse;for(const c of v(a))c in r?r[c]!==a[c]&&s.add(c):r[c]=a[c]}for(const o of s)delete r[o];if(!L(r)){this.setModified();const o=new oe(t,r);for(const a of n){if(a instanceof oe)for(const c of v(r))delete a.parse[c];t.removeChild(a),a.parent=o,a instanceof oe&&v(a.parse).length===0&&a.remove()}}}}}class qy extends en{run(t){t instanceof le||t.numChildren()>0||t instanceof Pn||(t instanceof Jt||(this.setModified(),t.remove()))}}class Gy extends en{run(t){const n=t.children.filter(r=>r instanceof Je),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class Vy extends en{run(t){const n=t.children.filter(r=>r instanceof Te),i={};for(const r of n){const s=A(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of v(i)){const s=i[r];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(t.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class Xy extends en{constructor(t){super();this.model=t}run(t){const n=!(jo(t)||t instanceof kn||t instanceof oe||t instanceof zt),i=[],r=[];for(const s of t.children)s instanceof et&&(n&&!Dr(t.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof et?t.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class Yy extends en{run(t){const n=[...t.children],i=Rt(n,o=>o instanceof le);if(!i||t.numChildren()<=1)return;const r=[];let s;for(const o of n)if(o instanceof le){let a=o;for(;a.numChildren()===1;){const[c]=a.children;if(c instanceof le)a=c;else break}r.push(...a.children),s?(t.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else r.push(o);if(r.length){this.setModified();for(const o of r)o.parent.removeChild(o),o.parent=s}}}class tn extends M{constructor(t,n){super(t);this.transform=n}clone(){return new tn(null,F(this.transform))}addDimensions(t){this.transform.groupby=Re(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:_(t)}hash(){return`JoinAggregateTransform ${A(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},r!==void 0?{groupby:r}:{})}}function Ky(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=_(i);return r&&t.push(r),t},[])}function Qy(e){return j(e)&&e.every(t=>N(t))&&e.length>1}class mt extends M{constructor(t,n){super(t);this._stack=n}clone(){return new mt(null,F(this._stack))}static makeFromTransform(t,n){const{stack:i,groupby:r,as:s,offset:o="zero"}=n,a=[],c=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),c.push(K(f.order,"ascending"));const l={field:a,order:c};let u;return Qy(s)?u=s:N(s)?u=[s,`${s}_end`]:u=[`${n.stack}_start`,`${n.stack}_end`],new mt(t,{dimensionFieldDefs:[],stackField:i,groupby:r,offset:o,sort:l,facetby:[],as:u})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannels:s,fieldChannel:o,offset:a,impute:c}=i,l=s.map(g=>{const p=r[g];return Ye(p)}).filter(g=>!!g),u=Ky(n),f=n.encoding.order;let d;return j(f)||x(f)?d=Na(f):d=u.reduce((g,p)=>(g.field.push(p),g.order.push(o==="y"?"descending":"ascending"),g),{field:[],order:[]}),new mt(t,{dimensionFieldDefs:l,stackField:n.vgField(o),facetby:[],stackby:u,sort:d,offset:a,impute:c,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${A(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:t,impute:n,groupby:i}=this._stack;return t.length>0?t.map(r=>r.bin?n?[_(r,{binSuffix:"mid"})]:[_(r,{}),_(r,{binSuffix:"end"})]:[_(r)]).flat():i??[]}assemble(){const t=[],{facetby:n,dimensionFieldDefs:i,stackField:r,stackby:s,sort:o,offset:a,impute:c,as:l}=this._stack;if(c)for(const u of i){const{bandPosition:f=.5,bin:d}=u;if(d){const g=_(u,{expr:"datum"}),p=_(u,{expr:"datum",binSuffix:"end"});t.push({type:"formula",expr:`${f}*${g}+${1-f}*${p}`,as:_(u,{binSuffix:"mid",forAs:!0})})}t.push({type:"impute",field:r,groupby:[...s,...n],key:_(u,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:o,as:l,offset:a}),t}}class Tn extends M{constructor(t,n){super(t);this.transform=n}clone(){return new Tn(null,F(this.transform))}addDimensions(t){this.transform.groupby=Re(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const i=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(i.add,i),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(r=>i.add(r.field)),this.transform.window.map(r=>r.field).filter(r=>r!==void 0).forEach(i.add,i),i}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:_(t)}hash(){return`WindowTransform ${A(this.transform)}`}assemble(){var t;const n=[],i=[],r=[],s=[];for(const d of this.transform.window)i.push(d.op),r.push(this.getDefaultName(d)),s.push(d.param===void 0?null:d.param),n.push(d.field===void 0?null:d.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&i.every(d=>Kr(d)))return Object.assign({type:"joinaggregate",as:r,ops:i,fields:n},a!==void 0?{groupby:a}:{});const c=[],l=[];if(this.transform.sort!==void 0)for(const d of this.transform.sort)c.push(d.field),l.push((t=d.order)!==null&&t!==void 0?t:"ascending");const u={field:c,order:l},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:r,ops:i,fields:n,sort:u},f!==void 0?{ignorePeers:f}:{}),a!==void 0?{groupby:a}:{}),o!==void 0?{frame:o}:{})}}function Zy(e){function t(n){if(!(n instanceof Pn)){const i=n.clone();if(i instanceof le){const r=ko+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof Te||i instanceof mt||i instanceof Tn||i instanceof tn)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function Eo(e){if(e instanceof Pn)if(e.numChildren()===1&&!(e.children[0]instanceof le)){const t=e.children[0];(t instanceof Te||t instanceof mt||t instanceof Tn||t instanceof tn)&&t.addDimensions(e.fields),t.swapWithParent(),Eo(e)}else{const t=e.model.component.data.main;Vu(t);const n=Zy(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(Eo)}function Vu(e){if(e instanceof le&&e.type===W.Main&&e.numChildren()===1){const t=e.children[0];t instanceof Pn||(t.swapWithParent(),Vu(e))}}const ko="scale_",yr=5;function Co(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!Co(t.children))return!1}return!0}function Ae(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function Xu(e,t,n){let i=e.sources,r=!1;return r=Ae(new Wy,i)||r,r=Ae(new Dy(t),i)||r,i=i.filter(s=>s.numChildren()>0),r=Ae(new qy,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=Ae(new By,i)||r,r=Ae(new Xy(t),i)||r,r=Ae(new Uy,i)||r,r=Ae(new Hy,i)||r,r=Ae(new Vy,i)||r,r=Ae(new Gy,i)||r,r=Ae(new My,i)||r,r=Ae(new Yy,i)||r),e.sources=i,r}function Jy(e,t){Co(e.sources);let n=0,i=0;for(let r=0;r<yr&&Xu(e,t,!0);r++)n++;e.sources.map(Eo);for(let r=0;r<yr&&Xu(e,t,!1);r++)i++;Co(e.sources),Math.max(n,i)===yr&&O(`Maximum optimization runs(${yr}) reached.`)}class me{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new me(()=>t(n))}}var ev=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Yu(e){Q(e)?tv(e):nv(e)}function tv(e){const t=e.component.scales;for(const n of v(t)){const i=rv(e,n),r=t[n];if(r.setWithExplicit("domains",i),ov(e,n),e.component.data.isFaceted){let s=e;for(;!ze(s)&&s.parent;)s=s.parent;const o=s.component.resolve.scale[n];if(o==="shared")for(const a of i.value)ut(a)&&(a.data=ko+a.data.replace(ko,""))}}}function nv(e){for(const n of e.children)Yu(n);const t=e.component.scales;for(const n of v(t)){let i,r=null;for(const s of e.children){const o=s.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=Ft(i,o.getWithExplicit("domains"),"domains","scale",Po);const a=o.get("selectionExtent");r&&a&&r.param!==a.param&&O(Yd),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function iv(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:s}=Ku(t,n);if(!r){O(s);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=Ku(t,n);if(r)return"unaggregated"}return e}function rv(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=iv(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&Z(i.x2)?Z(i.x)?Ft(It(n,r,e,"x"),It(n,r,e,"x2"),"domain","scale",Po):It(n,r,e,"x2"):t==="y"&&Z(i.y2)?Z(i.y)?Ft(It(n,r,e,"y"),It(n,r,e,"y2"),"domain","scale",Po):It(n,r,e,"y2"):It(n,r,e,t)}function sv(e,t,n){return e.map(i=>{const r=Qi(i,{timeUnit:n,type:t});return{signal:`{data: ${r}}`}})}function Fo(e,t,n){var i;const r=(i=re(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?sv(e,t,r):[e]}function It(e,t,n,i){const{encoding:r}=n,s=Z(r[i]),{type:o}=s,a=s.timeUnit;if(Op(t)){const f=It(e,void 0,n,i),d=Fo(t.unionWith,o,a);return Ze([...f.value,...d])}else{if(w(t))return Ze([t]);if(t&&t!=="unaggregated"&&!uc(t))return Ze(Fo(t,o,a))}const c=n.stack;if(c&&i===c.fieldChannel){if(c.offset==="normalize")return Oe([[0,1]]);const f=n.requestDataName(W.Main);return Oe([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const l=_t(i)&&x(s)?av(n,i,e):void 0;if(Ve(s)){const f=Fo([s.datum],o,a);return Oe(f)}const u=s;if(t==="unaggregated"){const f=n.requestDataName(W.Main),{field:d}=s;return Oe([{data:f,field:_({field:d,aggregate:"min"})},{data:f,field:_({field:d,aggregate:"max"})}])}else if(U(u.bin)){if(te(e))return e==="bin-ordinal"?Oe([]):Oe([{data:Un(l)?n.requestDataName(W.Main):n.requestDataName(W.Raw),field:n.vgField(i,ni(u,i)?{binSuffix:"range"}:{}),sort:l===!0||!H(l)?{field:n.vgField(i,{}),op:"min"}:l}]);{const{bin:f}=u;if(U(f)){const d=_o(n,u.field,f);return Oe([new me(()=>{const g=n.getSignalName(d);return`[${g}.start, ${g}.stop]`})])}else return Oe([{data:n.requestDataName(W.Main),field:n.vgField(i,{})}])}}else if(u.timeUnit&&z(["time","utc"],e)&&Nc(u,Q(n)?n.encoding[ct(i)]:void 0,n.markDef,n.config)){const f=n.requestDataName(W.Main);return Oe([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return Oe(l?[{data:Un(l)?n.requestDataName(W.Main):n.requestDataName(W.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(W.Main),field:n.vgField(i)}])}function No(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n??(t?"sum":Bi)},i?{field:xe(i)}:{}),r?{order:r}:{})}function ov(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=uc(r)&&r,a=Wt(s)&&Ti(s.extent)&&s.extent;(o||a)&&i.set("selectionExtent",o??a,!0)}function av(e,t,n){if(!te(n))return;const i=e.fieldDef(t),r=i.sort;if(Ec(r))return{op:"min",field:Fn(i,t),order:"ascending"};const{stack:s}=e,o=s?new Set([...s.groupbyFields,...s.stackBy.map(a=>a.fieldDef.field)]):void 0;if(Ge(r)){const a=s&&!o.has(r.field);return No(r,a)}else if($c(r)){const{encoding:a,order:c}=r,l=e.fieldDef(a),{aggregate:u,field:f}=l,d=s&&!o.has(f);if(lt(u)||jt(u))return No({field:_(l),order:c},d);if(Kr(u)||!u)return No({op:u,field:f,order:c},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(z(["ascending",void 0],r))return!0}return}function Ku(e,t){const{aggregate:n,type:i}=e;return n?N(n)&&!Pd.has(n)?{valid:!1,reason:_g(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:jg(e)}:{valid:!0}:{valid:!1,reason:Sg(e)}}function Po(e,t,n,i){return e.explicit&&t.explicit&&O(Cg(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function cv(e){const t=Re(e.map(o=>{if(ut(o)){const a=ev(o,["sort"]);return a}return o}),A),n=Re(e.map(o=>{if(ut(o)){const a=o.sort;return a!==void 0&&!Un(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}return}).filter(o=>o!==void 0),A);if(t.length===0)return;if(t.length===1){const o=e[0];if(ut(o)&&n.length>0){let a=n[0];if(n.length>1)O(Va),a=!0;else if(H(a)&&"field"in a){const c=a.field;o.field===c&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},o),{sort:a})}return o}const i=Re(n.map(o=>Un(o)||!("op"in o)||N(o.op)&&o.op in kd?o:(O(Ng(o)),!0)),A);let r;i.length===1?r=i[0]:i.length>1&&(O(Va),r=!0);const s=Re(e.map(o=>ut(o)?o.data:null),o=>o);if(s.length===1&&s[0]!==null){const o=Object.assign({data:s[0],fields:t.map(a=>a.field)},r?{sort:r}:{});return o}return Object.assign({fields:t},r?{sort:r}:{})}function To(e){if(ut(e)&&N(e.field))return e.field;if(Ad(e)){let t;for(const n of e.fields)if(ut(n)&&N(n.field)){if(!t)t=n.field;else if(t!==n.field)return O(Pg),t}return O(Tg),t}else if(zd(e)){O(Ag);const t=e.fields[0];return N(t)?t:void 0}return}function vr(e,t){const n=e.component.scales[t],i=n.get("domains").map(r=>(ut(r)&&(r.data=e.lookupDataSource(r.data)),r));return cv(i)}var lv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Qu(e){return An(e)||Io(e)?e.children.reduce((t,n)=>t.concat(Qu(n)),Zu(e)):Zu(e)}function Zu(e){return v(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:c,range:l,reverse:u}=r,f=lv(r,["name","type","selectionExtent","domains","range","reverse"]),d=uv(r.range,s,n,e),g=vr(e,n),p=a?eb(e,a,i,g):null;return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},g?{domain:g}:{}),p?{domainRaw:p}:{}),{range:d}),u!==void 0?{reverse:u}:{}),f)),t},[])}function uv(e,t,n,i){if(ee(n)){if($t(e))return{step:{signal:`${t}_step`}}}else if(H(e)&&ut(e))return Object.assign(Object.assign({},e),{data:i.lookupDataSource(e.data)});return e}class Ju extends pt{constructor(t,n){super({},{name:t});this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:Rt(this.get("domains"),t=>j(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const fv=["range","scheme"];function dv(e){const t=e.component.scales;for(const n of Pi){const i=t[n];if(!i)continue;const r=gv(n,e);i.setWithExplicit("range",r)}}function ef(e,t){const n=e.fieldDef(t);if(n==null?void 0:n.bin){const{bin:i,field:r}=n,s=de(t),o=e.getName(s);if(H(i)&&i.binned&&i.step!==void 0)return new me(()=>{const a=e.scaleName(t),c=`(domain("${a}")[1] - domain("${a}")[0]) / ${i.step}`;return`${e.getSignalName(o)} / (${c})`});if(U(i)){const a=_o(e,r,i);return new me(()=>{const c=e.getSignalName(a),l=`(${c}.stop - ${c}.start) / ${c}.step`;return`${e.getSignalName(o)} / (${l})`})}}return}function gv(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e),s=r.get("type");for(const f of fv)if(n[f]!==void 0){const d=ys(s,f),g=fc(e,f);if(!d)O(qa(s,f,e));else if(g)O(g);else switch(f){case"range":{const p=n.range;if(j(p)){if(ee(e))return Ze(p.map(h=>{if(h==="width"||h==="height"){const m=t.getName(h),b=t.getSignalName.bind(t);return me.fromName(b,m)}return h}))}else if(H(p))return Ze({data:t.requestDataName(W.Main),field:p.field,sort:{op:"min",field:t.vgField(e)}});return Ze(p)}case"scheme":return Ze(pv(n[f]))}}const o=e===G||e==="xOffset"?"width":"height",a=i[o];if(Qe(a)){if(ee(e))if(te(s)){const f=tf(a,t,e);if(f)return Ze({step:f})}else O(Ga(o));else if(gn(e)){const f=e===bt?"x":"y",d=t.getScaleComponent(f),g=d.get("type");if(g==="band"){const p=nf(a,s);if(p)return Ze(p)}}}const{rangeMin:c,rangeMax:l}=n,u=mv(e,t);return(c!==void 0||l!==void 0)&&ys(s,"rangeMin")&&j(u)&&u.length===2?Ze([c??u[0],l??u[1]]):Oe(u)}function pv(e){return vp(e)?Object.assign({scheme:e.name},be(e,["name"])):{scheme:e}}function mv(e,t){const{size:n,config:i,mark:r,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=Z(s[e]),c=t.getScaleComponent(e),l=c.get("type"),{domain:u,domainMid:f}=t.specifiedScales[e];switch(e){case G:case J:{if(z(["point","band"],l)){const p=rf(e,n,i.view);if(Qe(p)){const h=tf(p,t,e);return{step:h}}}const d=de(e),g=t.getName(d);return e===J&&ve(l)?[me.fromName(o,g),0]:[0,me.fromName(o,g)]}case bt:case fn:return hv(e,t,l);case ot:{const d=t.component.scales[e].get("zero"),g=sf(r,d,i),p=vv(r,n,t,i);return bn(l)?yv(g,p,bv(l,i,u,e)):[g,p]}case Se:return[0,Math.PI*2];case Mt:return[0,360];case ke:return[0,new me(()=>{const d=t.getSignalName("width"),g=t.getSignalName("height");return`min(${d},${g})/2`})];case Ot:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case xt:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case fe:return"symbol";case ue:case Ue:case We:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case at:case yt:case vt:return[i.scale.minOpacity,i.scale.maxOpacity]}}function tf(e,t,n){var i,r,s,o,a;const{encoding:c}=t,l=t.getScaleComponent(n),u=ha(n),f=c[u],d=fl({step:e,offsetIsDiscrete:C(f)&&rc(f.type)});if(d==="offset"&&Hc(c,u)){const g=t.getScaleComponent(u),p=t.scaleName(u);let h=`domain('${p}').length`;if(g.get("type")==="band"){const b=(r=(i=g.get("paddingInner"))!==null&&i!==void 0?i:g.get("padding"))!==null&&r!==void 0?r:0,y=(o=(s=g.get("paddingOuter"))!==null&&s!==void 0?s:g.get("padding"))!==null&&o!==void 0?o:0;h=`bandspace(${h}, ${b}, ${y})`}const m=(a=l.get("paddingInner"))!==null&&a!==void 0?a:l.get("padding");return{signal:`${e.step} * ${h} / (1-${Md(m)})`}}else return e.step}function nf(e,t){const n=fl({step:e,offsetIsDiscrete:te(t)});return n==="offset"?{step:e.step}:void 0}function hv(e,t,n){const i=e===bt?"x":"y",r=t.getScaleComponent(i),s=r.get("type"),o=t.scaleName(i);if(s==="band"){const a=rf(i,t.size,t.config.view);if(Qe(a)){const c=nf(a,n);if(c)return c}return[0,{signal:`bandwidth('${o}')`}]}else return ia(`Cannot use ${e} scale if ${i} scale is not discrete.`)}function rf(e,t,n){const i=e===G?"width":"height",r=t[i];return r||sr(n,i)}function bv(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&j(n)?n.length+1:(O(Bg(i)),3)}}function yv(e,t,n){const i=()=>{const r=ft(t),s=ft(e),o=`(${r} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${r} + ${o}, ${o})`};return w(t)?new me(i):{signal:i()}}function sf(e,t,n){if(t)return w(t)?{signal:`${t.signal} ? 0 : ${sf(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(zi("size",e))}const of=.95;function vv(e,t,n,i){const r={x:ef(n,"x"),y:ef(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=af(t,r,i.view);return Y(s)?s-1:new me(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=af(t,r,i.view);return Y(s)?Math.pow(of*s,2):new me(()=>`pow(${of} * ${s.signal}, 2)`)}}throw new Error(zi("size",e))}function af(e,t,n){const i=Qe(e.width)?e.width.step:rr(n,"width"),r=Qe(e.height)?e.height.step:rr(n,"height");return t.x||t.y?new me(()=>{const s=[t.x?t.x.signal:i,t.y?t.y.signal:r];return`min(${s.join(", ")})`}):Math.min(i,r)}function cf(e,t){Q(e)?Ov(e,t):ff(e,t)}function Ov(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=e;for(const a of v(n)){const c=o[a],l=n[a],u=e.getScaleComponent(a),f=Z(r[a]),d=c[t],g=u.get("type"),p=u.get("padding"),h=u.get("paddingInner"),m=ys(g,t),b=fc(a,t);if(d!==void 0&&(m?b&&O(b):O(qa(g,t,a))),m&&b===void 0)if(d!==void 0){const y=f.timeUnit,S=f.type;switch(t){case"domainMax":case"domainMin":Ht(c[t])||S==="temporal"||y?l.set(t,{signal:Qi(c[t],{type:S,timeUnit:y})},!0):l.set(t,c[t],!0);break;default:l.copyKeyFromObject(t,c)}}else{const y=t in lf?lf[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:g,scalePadding:p,scalePaddingInner:h,domain:c.domain,domainMin:c.domainMin,domainMax:c.domainMax,markDef:s,config:i,hasNestedOffsetScale:As(r,a)}):i.scale[t];y!==void 0&&l.set(t,y,!1)}}}const lf={bins:({model:e,fieldOrDatumDef:t})=>x(t)?xv(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>Sv(e,t.type),nice:({scaleType:e,channel:t,domain:n,domainMin:i,domainMax:r,fieldOrDatumDef:s})=>_v(e,t,n,i,r,s),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>jv(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,scaleType:i,config:r,hasNestedOffsetScale:s})=>wv(e,t,n.type,i,r.scale,s),paddingOuter:({scalePadding:e,channel:t,scaleType:n,scalePaddingInner:i,config:r,hasNestedOffsetScale:s})=>$v(e,t,n,i,r.scale,s),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=x(e)?e.sort:void 0;return Ev(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>kv(e,t,n,i,r)};function uf(e){Q(e)?dv(e):ff(e,"range")}function ff(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?uf(i):cf(i,t);for(const i of v(n)){let r;for(const s of e.children){const o=s.component.scales[i];if(o){const a=o.getWithExplicit(t);r=Ft(r,a,t,"scale",Ll((c,l)=>{switch(t){case"range":return c.step&&l.step?c.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function xv(e,t){const n=t.bin;if(U(n)){const i=_o(e,t.field,n);return new me(()=>e.getSignalName(i))}else if(ae(n)&&Wt(n)&&n.step!==void 0)return{step:n.step};return}function Sv(e,t){return z([ue,Ue,We],e)&&t!=="nominal"?"hcl":void 0}function _v(e,t,n,i,r,s){var o;return((o=Ye(s))===null||o===void 0?void 0:o.bin)||j(n)||r!=null||i!=null||z([pe.TIME,pe.UTC],e)?void 0:ee(t)?!0:void 0}function jv(e,t,n,i,r,s){if(ee(e)){if(Fe(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=r;if(o==="bar"&&!(x(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===pe.POINT)return n.pointPadding}return}function wv(e,t,n,i,r,s=!1){if(e!==void 0)return;if(ee(t)){const{bandPaddingInner:o,barBandPaddingInner:a,rectBandPaddingInner:c,bandWithNestedOffsetPaddingInner:l}=r;return s?l:K(o,n==="bar"?a:c)}else if(gn(t)&&i===pe.BAND)return r.offsetBandPaddingInner;return}function $v(e,t,n,i,r,s=!1){if(e!==void 0)return;if(ee(t)){const{bandPaddingOuter:o,bandWithNestedOffsetPaddingOuter:a}=r;if(s)return a;if(n===pe.BAND)return K(o,w(i)?{signal:`${i.signal}/2`}:i/2)}else if(gn(t)){if(n===pe.POINT)return .5;if(n===pe.BAND)return r.offsetBandPaddingOuter}return}function Ev(e,t,n,i){return n==="x"&&i.xReverse!==void 0?ve(e)&&t==="descending"?w(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:ve(e)&&t==="descending"?!0:void 0}function kv(e,t,n,i,r){const s=!!n&&n!=="unaggregated";if(s&&ve(r)){if(j(n)){const o=n[0],a=n[n.length-1];if(o<=0&&a>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!bn(r))return!0;if(!(x(t)&&t.bin)&&z([...Be,...Od],e)){const{orient:o,type:a}=i;return!(z(["bar","area","line","trail"],a)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function Cv(e,t,n,i,r=!1){const s=Fv(t,n,i,r),{type:o}=e;return _t(t)?o!==void 0?$p(t,o)?x(n)&&!wp(o,n.type)?(O(Eg(o,s)),s):o:(O($g(t,o,s)),s):s:null}function Fv(e,t,n,i){var r;switch(t.type){case"nominal":case"ordinal":{if(dn(e)||Yr(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&O(ns(e,"ordinal")),"ordinal";if(ee(e)||gn(e)){if(z(["rect","bar","image","rule"],n.type))return"band";if(i)return"band"}else if(n.type==="arc"&&e in Xr)return"band";const s=n[de(e)];return Gt(s)||vn(t)&&((r=t.axis)===null||r===void 0?void 0:r.tickBand)?"band":"point"}case"temporal":return dn(e)?"time":Yr(e)==="discrete"?(O(ns(e,"temporal")),"ordinal"):x(t)&&t.timeUnit&&re(t.timeUnit).utc?"utc":"time";case"quantitative":return dn(e)?x(t)&&U(t.bin)?"bin-ordinal":"linear":Yr(e)==="discrete"?(O(ns(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(Ba(t.type))}function Nv(e,{ignoreRange:t}={}){df(e),Yu(e);for(const n of jp)cf(e,n);t||uf(e)}function df(e){Q(e)?e.component.scales=Pv(e):e.component.scales=Av(e)}function Pv(e){const{encoding:t,mark:n,markDef:i}=e,r={};for(const s of Pi){const o=Z(t[s]);if(o&&n===pc&&s===fe&&o.type===hn)continue;let a=o&&o.scale;if(gn(s)){const c=ba(s);if(!As(t,c)){a&&O(dg(s));continue}}if(o&&a!==null&&a!==!1){a??(a={});const c=As(t,s),l=Cv(a,s,o,i,c);r[s]=new Ju(e.scaleName(`${s}`,!0),{value:l,explicit:a.type===l})}}return r}const Tv=Ll((e,t)=>sc(e)-sc(t));function Av(e){var t,n;const i=e.component.scales={},r={},s=e.component.resolve;for(const o of e.children){df(o);for(const a of v(o.component.scales))if((t=(n=s.scale)[a])!==null&&t!==void 0||(n[a]=Cu(a,e)),s.scale[a]==="shared"){const c=r[a],l=o.component.scales[a].getWithExplicit("type");c?pp(c.value,l.value)?r[a]=Ft(c,l,"type","scale",Tv):(s.scale[a]="independent",delete r[a]):r[a]=l}}for(const o of v(r)){const a=e.scaleName(o,!0),c=r[o];i[o]=new Ju(a,c);for(const l of e.children){const u=l.component.scales[o];u&&(l.renameScale(u.get("name"),a),u.merged=!0)}}return i}var Ao=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class zo{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function Q(e){return(e==null?void 0:e.type)==="unit"}function ze(e){return(e==null?void 0:e.type)==="facet"}function Io(e){return(e==null?void 0:e.type)==="concat"}function An(e){return(e==null?void 0:e.type)==="layer"}class Ro{constructor(t,n,i,r,s,o,a){var c,l;this.type=n,this.parent=i,this.config=s,this.correctDataNames=u=>{var f,d,g;return((f=u.from)===null||f===void 0?void 0:f.data)&&(u.from.data=this.lookupDataSource(u.from.data)),((g=(d=u.from)===null||d===void 0?void 0:d.facet)===null||g===void 0?void 0:g.data)&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u},this.parent=i,this.config=s,this.view=ge(a),this.name=(c=t.name)!==null&&c!==void 0?c:r,this.title=wt(t.title)?{text:t.title}:t.title?ge(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new zo,this.projectionNameMap=i?i.projectionNameMap:new zo,this.signalNameMap=i?i.signalNameMap:new zo,this.data=t.data,this.description=t.description,this.transforms=Rh((l=t.transform)!==null&&l!==void 0?l:[]),this.layout=n==="layer"||n==="unit"?{}:Bm(t,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:Hi(t)||(i==null?void 0:i.component.data.isFaceted)&&t.data===void 0},layoutSize:new pt,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?F(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){Nv(this)}parseProjection(){Wu(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Ru(this)}assembleEncodeFromView(t){const n=Ao(t,["style"]),i={};for(const r of v(n)){const s=n[r];s!==void 0&&(i[r]=B(s))}return i}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=B(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{}):L(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,i=Ao(t,["spacing"]),{component:r,config:s}=this,o=Qb(r.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),i),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of je)t[i].title&&n.push(qb(this,i));for(const i of bo)n=n.concat(Gb(this,i));return n}assembleAxes(){return Tb(this.component.axes,this.config)}assembleLegends(){return Mu(this)}assembleProjections(){return xy(this)}assembleTitle(){var t,n,i;const r=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=r,o=Ao(r,["encoding"]),a=Object.assign(Object.assign(Object.assign({},wa(this.config.title).nonMarkTitleProperties),o),s?{encode:{update:s}}:{});return a.text?(z(["unit","layer"],this.type)?z(["middle",void 0],a.anchor)&&((n=a.frame)!==null&&n!==void 0||(a.frame="group")):(i=a.anchor)!==null&&i!==void 0||(a.anchor="start"),L(a)?void 0:a):void 0}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||ze(this.parent)?Qu(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return q((this.name?`${this.name}_`:"")+t)}getDataName(t){return this.getName(W[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(ze(this.parent)){const n=Eu(t),i=Ni(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if(te(s)&&$t(o)){const a=r.get("name"),c=vr(this,i),l=To(c);if(l){const u=_({aggregate:"distinct",field:l},{expr:"datum"});return{signal:$u(a,r,u)}}else return O(es(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){return n?this.getName(t):pa(t)&&_t(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(Hd(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(i=>i.hasOrientSignalRef()))}}class gf extends Ro{vgField(t,n={}){const i=this.fieldDef(t);return i?_(i,n):void 0}reduceFieldDef(t,n){return bm(this.getMapping(),(i,r,s)=>{const o=Ye(r);return o?t(i,o,s):i},n)}forEachFieldDef(t,n){Is(this.getMapping(),(i,r)=>{const s=Ye(i);s&&t(s,r)},n)}}var zv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Or extends M{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=F(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"value",(s=o[1])!==null&&s!==void 0?s:"density"],n.groupby&&n.minsteps==null&&n.maxsteps==null&&n.steps==null&&(this.transform.steps=200)}clone(){return new Or(null,F(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${A(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,i=zv(t,["density"]),r=Object.assign({type:"kde",field:n},i);return r}}class di extends M{constructor(t,n){super(t);this.filter=n}clone(){return new di(null,Object.assign({},this.filter))}static make(t,n){const{config:i,mark:r,markDef:s}=n,o=R("invalid",s,i);if(o!=="filter")return null;const a=n.reduceFieldDef((c,l,u)=>{const f=_t(u)&&n.getScaleComponent(u);if(f){const d=f.get("type");ve(d)&&l.aggregate!=="count"&&!Et(r)&&(c[l.field]=l)}return c},{});return v(a).length?new di(t,a):null}dependentFields(){return new Set(v(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${A(this.filter)}`}assemble(){const t=v(this.filter).reduce((n,i)=>{const r=this.filter[i],s=_(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):r.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class xr extends M{constructor(t,n){super(t);this.transform=n,this.transform=F(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,o)=>{var a;return(a=r[o])!==null&&a!==void 0?a:s})}clone(){return new xr(this.parent,F(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${A(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform,i={type:"flatten",fields:t,as:n};return i}}class Sr extends M{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=F(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"key",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new Sr(null,F(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${A(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform,i={type:"fold",fields:t,as:n};return i}}class zn extends M{constructor(t,n,i,r){super(t);this.fields=n,this.geojson=i,this.signal=r}clone(){return new zn(null,F(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[De,Me],[_e,Ce]]){const s=r.map(o=>{const a=Z(n.encoding[o]);return x(a)?a.field:Ve(a)?{expr:`${a.datum}`}:Pe(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new zn(t,s,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(fe)){const r=n.typedFieldDef(fe);r.type===hn&&(t=new zn(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(N);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${A(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})]}}class gi extends M{constructor(t,n,i,r){super(t);this.projection=n,this.fields=i,this.as=r}clone(){return new gi(null,this.projection,F(this.fields),F(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[De,Me],[_e,Ce]]){const r=i.map(o=>{const a=Z(n.encoding[o]);return x(a)?a.field:Ve(a)?{expr:`${a.datum}`}:Pe(a)?{expr:`${a.value}`}:void 0}),s=i[0]===_e?"2":"";(r[0]||r[1])&&(t=new gi(t,n.projectionName(),r,[n.getName(`x${s}`),n.getName(`y${s}`)]))}return t}dependentFields(){return new Set(this.fields.filter(N))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${A(this.fields)} ${A(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class nn extends M{constructor(t,n){super(t);this.transform=n}clone(){return new nn(null,F(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t,s=[n,i,...r?[r]:[]].join(",");return{signal:`sequence(${s})`}}static makeFromTransform(t,n){return new nn(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,s=i.y;if(x(r)&&x(s)){const o=r.impute?r:s.impute?s:void 0;if(o===void 0)return;const a=r.impute?s:s.impute?r:void 0,{method:c,value:l,frame:u,keyvals:f}=o.impute,d=Gc(n.mark,i);return new nn(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},c?{method:c}:{}),l!==void 0?{value:l}:{}),u?{frame:u}:{}),f!==void 0?{keyvals:f}:{}),d.length?{groupby:d}:{}))}return null}hash(){return`Impute ${A(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:s,value:o,frame:a=[null,null]}=this.transform,c=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},i?{keyvals:vh(i)?this.processSequence(i):i}:{}),{method:"value"}),s?{groupby:s}:{}),{value:!r||r==="value"?o:null});if(r&&r!=="value"){const l=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1},s?{groupby:s}:{}),u={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[c,l,u]}else return[c]}}var Iv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class _r extends M{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=F(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.loess]}clone(){return new _r(null,F(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${A(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:i}=t,r=Iv(t,["loess","on"]),s=Object.assign({type:"loess",x:i,y:n},r);return s}}class pi extends M{constructor(t,n,i){super(t);this.transform=n,this.secondary=i}clone(){return new pi(null,F(this.transform),this.secondary)}static make(t,n,i,r){const s=n.component.data.sources,{from:o}=i;let a=null;if(Oh(o)){let c=bf(o.data,s);c||(c=new Jt(o.data),s.push(c));const l=n.getName(`lookup_${r}`);a=new le(c,l,W.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(xh(o)){const c=o.param;i=Object.assign({as:c},i);let l;try{l=n.getSelectionComponent(q(c),c)}catch(u){throw new Error(Vd(c))}if(a=l.materialized,!a)throw new Error(Xd(c))}return new pi(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?V(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${A({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:V(this.transform.as)}:{});else{let n=this.transform.as;N(n)||(O(ng),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}var Rv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class jr extends M{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=F(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"prob",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new jr(null,F(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${A(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,i=Rv(t,["quantile"]),r=Object.assign({type:"quantile",field:n},i);return r}}var Lv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class wr extends M{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=F(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.regression]}clone(){return new wr(null,F(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${A(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:i}=t,r=Lv(t,["regression","on"]),s=Object.assign({type:"regression",x:i,y:n},r);return s}}class $r extends M{constructor(t,n){super(t);this.transform=n}clone(){return new $r(null,F(this.transform))}addDimensions(t){var n;this.transform.groupby=Re(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),i=>i)}producedFields(){return}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${A(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},r!==void 0?{limit:r}:{}),s!==void 0?{op:s}:{}),i!==void 0?{groupby:i}:{})}}class Er extends M{constructor(t,n){super(t);this.transform=n}clone(){return new Er(null,F(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${A(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function pf(e){let t=0;function n(i,r){var s;if(i instanceof Jt&&(!i.isGenerator&&!jn(i.data))){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}if(i instanceof oe&&(i.parent instanceof Jt&&!r.source?(r.format=Object.assign(Object.assign({},(s=r.format)!==null&&s!==void 0?s:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Pn){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,e.push(...i.assemble());return}if((i instanceof li||i instanceof ui||i instanceof di||i instanceof kn||i instanceof Cn||i instanceof gi||i instanceof Te||i instanceof pi||i instanceof Tn||i instanceof tn||i instanceof Sr||i instanceof xr||i instanceof Or||i instanceof _r||i instanceof jr||i instanceof wr||i instanceof zt||i instanceof Er||i instanceof $r)&&r.transform.push(i.assemble()),(i instanceof et||i instanceof Je||i instanceof nn||i instanceof mt||i instanceof zn)&&r.transform.push(...i.assemble()),i instanceof le){if(r.source&&r.transform.length===0)i.setSource(r.source);else if(i.parent instanceof le)i.setSource(r.name);else if(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}}switch(i.numChildren()){case 0:i instanceof le&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const a of i.children){const c={name:null,source:o,transform:[]};n(a,c)}break}}}return n}function Mv(e){const t=[],n=pf(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function Dv(e,t){var n,i;const r=[],s=pf(r);let o=0;for(const c of e.sources){c.hasName()||(c.dataName=`source_${o++}`);const l=c.assemble();s(c,l)}for(const c of r)c.transform.length===0&&delete c.transform;let a=0;for(const[c,l]of r.entries())((n=l.transform)!==null&&n!==void 0?n:[]).length===0&&!l.source&&r.splice(a++,0,r.splice(c,1)[0]);for(const c of r)for(const l of(i=c.transform)!==null&&i!==void 0?i:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const c of r)c.name in t&&(c.values=t[c.name]);return r}function Uv(e){return e==="top"||e==="left"||w(e)?"header":"footer"}function Wv(e){for(const t of je)Bv(e,t);hf(e,"x"),hf(e,"y")}function Bv(e,t){var n;const{facet:i,config:r,child:s,component:o}=e;if(e.channelHasField(t)){const a=i[t],c=Nn("title",null,r,t);let l=On(a,r,{allowDisabling:!0,includeDefault:c===void 0||!!c});s.component.layoutHeaders[t].title&&(l=j(l)?l.join(", "):l,l+=` / ${s.component.layoutHeaders[t].title}`,s.component.layoutHeaders[t].title=null);const u=Nn("labelOrient",a.header,r,t),f=a.header!==null?K((n=a.header)===null||n===void 0?void 0:n.labels,r.header.labels,!0):!1,d=z(["bottom","right"],u)?"footer":"header";o.layoutHeaders[t]={title:a.header!==null?l:null,facetFieldDef:a,[d]:t==="facet"?[]:[mf(e,t,f)]}}}function mf(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function hf(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:s}=e.component;if(s.axis[t]=xo(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=r[o];for(const c of i.component.axes[t]){const l=Uv(c.get("orient"));(n=a[l])!==null&&n!==void 0||(a[l]=[mf(e,o,!1)]);const u=ci(c,"main",e.config,{header:!0});u&&a[l][0].axes.push(u),c.mainExtracted=!0}}}}function Hv(e){Lo(e),kr(e,"width"),kr(e,"height")}function qv(e){Lo(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";kr(e,t),kr(e,n)}function Lo(e){for(const t of e.children)t.parseLayoutSize()}function kr(e,t){var n;const i=Eu(t),r=Ni(i),s=e.component.resolve,o=e.component.layoutSize;let a;for(const c of e.children){const l=c.component.layoutSize.getWithExplicit(i),u=(n=s.scale[r])!==null&&n!==void 0?n:Cu(r,e);if(u==="independent"&&l.value==="step"){a=void 0;break}if(a){if(u==="independent"&&a.value!==l.value){a=void 0;break}a=Ft(a,l,i,"")}else a=l}if(a){for(const c of e.children)e.renameSignal(c.getName(i),e.getName(t)),c.component.layoutSize.set(i,"merged",!1);o.setWithExplicit(t,a)}else o.setWithExplicit(t,{explicit:!1,value:void 0})}function Gv(e){const{size:t,component:n}=e;for(const i of Be){const r=de(i);if(t[r]){const s=t[r];n.layoutSize.set(r,Qe(s)?"step":s,!0)}else{const s=Vv(e,r);n.layoutSize.set(r,s,!1)}}}function Vv(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const s=r.get("type"),o=r.get("range");if(te(s)){const a=sr(i.view,t);return $t(o)||Qe(a)?"step":a}else return Xs(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return Xs(i.view,t);{const s=sr(i.view,t);return Qe(s)?s.step:s}}}function Mo(e,t,n){return _(t,Object.assign({suffix:`by_${_(e)}`},n??{}))}class mi extends gf{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve);this.child=Ho(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!ei(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=v(t),i={};for(const r of n){if(![nt,it].includes(r)){O(zi(r,"facet"));break}const s=t[r];if(s.field===void 0){O(ts(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(t,n){const i=Ts(t,n);return i.header?i.header=ge(i.header):i.header===null&&(i.header=null),i}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=Cr(this),this.child.parseData()}parseLayoutSize(){Lo(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),Wv(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,i;const r={};for(const s of je)for(const o of yo){const a=this.component.layoutHeaders[s],c=a[o],{facetFieldDef:l}=a;if(l){const u=Nn("titleOrient",l.header,this.config,s);if(["right","bottom"].includes(u)){const f=mr(s,u);(t=r.titleAnchor)!==null&&t!==void 0||(r.titleAnchor={}),r.titleAnchor[f]="end"}}if(c==null?void 0:c[0]){const u=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(u)&&((n=r[f])!==null&&n!==void 0||(r[f]={}),r[f][s]=.5),a.title&&((i=r.offset)!==null&&i!==void 0||(r.offset={}),r.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),i?{columns:i}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof mi)return;{const t=this.getName("column_domain");return{signal:`length(data('${t}'))`}}}assembleGroupStyle(){return}assembleGroup(t){return this.parent&&this.parent instanceof mi?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:_(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof mi){if(this.child.channelHasField("column")){const r=_(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of Be){const s=this.child.component.scales[r];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(te(o)&&$t(a)){const c=vr(this.child,r),l=To(c);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):O(es(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),c=[];for(const u of je){const f=this.facet[u];if(f){c.push(_(f));const{bin:d,sort:g}=f;if(U(d)&&c.push(_(f,{binSuffix:"end"})),Ge(g)){const{field:p,op:h=Bi}=g,m=Mo(f,g);i&&r?(s.push(m),o.push("max"),a.push(m)):(s.push(p),o.push(h),a.push(m))}else if(j(g)){const p=Fn(f,u);s.push(p),o.push("max"),a.push(p)}}}const l=!!i&&!!r;return Object.assign({name:t,data:n,groupby:c},l||s.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),s.length?{fields:s,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:n}=this,i=n[t];return i?Ge(i.sort)?[Mo(i,i.sort,{expr:"datum"})]:j(i.sort)?[Fn(i,t,{expr:"datum"})]:[_(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i,s=(Ge(r)?r.order:!j(r)&&r)||"ascending";return[s]}return[]}assembleLabelTitle(){var t;const{facet:n,config:i}=this;if(n.facet)return vo(n.facet,"facet",i);const r={row:["top","bottom"],column:["left","right"]};for(const s of bo)if(n[s]){const o=Nn("labelOrient",(t=n[s])===null||t===void 0?void 0:t.header,i,s);if(r[s].includes(o))return vo(n[s],s,i)}return}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=Mv(n),r=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle(),a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},s?{title:s}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:je.map(c=>this.facetSortFields(c)).flat(),order:je.map(c=>this.facetSortOrder(c)).flat()}}),i.length>0?{data:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(Kh(this,[])));return[a]}getMapping(){return this.facet}}function Xv(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const s of[n,i])if(Ge(s.sort)){const{field:o,op:a=Bi}=s.sort;e=r=new tn(e,{joinaggregate:[{op:a,field:o,as:Mo(s,s.sort,{forAs:!0})}],groupby:[_(s)]})}return r}return null}function bf(e,t){var n,i,r,s;for(const o of t){const a=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const c=(n=e.format)===null||n===void 0?void 0:n.mesh,l=(i=a.format)===null||i===void 0?void 0:i.feature;if(c&&l)continue;const u=(r=e.format)===null||r===void 0?void 0:r.feature;if((u||l)&&u!==l)continue;const f=(s=a.format)===null||s===void 0?void 0:s.mesh;if((c||f)&&c!==f)continue;if(ri(e)&&ri(a)){if(Ie(e.values,a.values))return o}else if(jn(e)&&jn(a)){if(e.url===a.url)return o}else if(Ml(e)&&e.name===o.dataName)return o}return null}function Yv(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Jt({values:[]});return t.push(i),i}const n=bf(e.data,t);if(n)return Nt(e.data)||(n.data.format=ra({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Jt(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function Kv(e,t,n){var i,r;let s=0;for(const o of t.transforms){let a,c;if(Nh(o))c=e=new Cn(e,o),a="derived";else if(Js(o)){const l=zy(o);c=e=(i=oe.makeWithAncestors(e,{},l,n))!==null&&i!==void 0?i:e,e=new kn(e,t,o.filter)}else if(Fl(o))c=e=et.makeFromTransform(e,o,t),a="number";else if(Th(o)){a="date";const l=n.getWithExplicit(o.field);l.value===void 0&&(e=new oe(e,{[o.field]:a}),n.set(o.field,a,!1)),c=e=Je.makeFromTransform(e,o)}else if(Ah(o))c=e=Te.makeFromTransform(e,o),a="number",fo(t)&&(e=new zt(e));else if(Cl(o))c=e=pi.make(e,t,o,s++),a="derived";else if(kh(o))c=e=new Tn(e,o),a="number";else if(Ch(o))c=e=new tn(e,o),a="number";else if(zh(o))c=e=mt.makeFromTransform(e,o),a="derived";else if(Ih(o))c=e=new Sr(e,o),a="derived";else if(Fh(o))c=e=new xr(e,o),a="derived";else if(Sh(o))c=e=new $r(e,o),a="derived";else if(Eh(o))e=new Er(e,o);else if(Ph(o))c=e=nn.makeFromTransform(e,o),a="derived";else if(_h(o))c=e=new Or(e,o),a="derived";else if(jh(o))c=e=new jr(e,o),a="derived";else if(wh(o))c=e=new wr(e,o),a="derived";else if($h(o))c=e=new _r(e,o),a="derived";else{O(tg(o));continue}if(c&&a!==void 0)for(const l of(r=c.producedFields())!==null&&r!==void 0?r:[])n.set(l,a,!1)}return e}function Cr(e){var t,n,i,r,s,o,a,c,l,u;let f=Yv(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:g}=e.component.data,p=e.data,h=p&&(Nt(p)||jn(p)||ri(p)),m=!h&&e.parent?e.parent.component.data.ancestorParse.clone():new Vh;Nt(p)?(Dl(p)?f=new ui(f,p.sequence):no(p)&&(f=new li(f,p.graticule)),m.parseNothing=!0):((t=p==null?void 0:p.format)===null||t===void 0?void 0:t.parse)===null&&(m.parseNothing=!0),f=(n=oe.makeExplicit(f,e,m))!==null&&n!==void 0?n:f,f=new zt(f);const b=e.parent&&An(e.parent);(Q(e)||ze(e))&&(b&&(f=(i=et.makeFromEncoding(f,e))!==null&&i!==void 0?i:f)),e.transforms.length>0&&(f=Kv(f,e,m));const y=Ry(e),S=Iy(e);f=(r=oe.makeWithAncestors(f,{},Object.assign(Object.assign({},y),S),m))!==null&&r!==void 0?r:f,Q(e)&&(f=zn.parseAll(f,e),f=gi.parseAll(f,e)),(Q(e)||ze(e))&&(b||(f=(s=et.makeFromEncoding(f,e))!==null&&s!==void 0?s:f),f=(o=Je.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=Cn.parseAllForSortIndex(f,e));const E=e.getDataName(W.Raw),k=new le(f,E,W.Raw,g);if(d[E]=k,f=k,Q(e)){const X=Te.makeFromEncoding(f,e);X&&(f=X,fo(e)&&(f=new zt(f))),f=(a=nn.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=(c=mt.makeFromEncoding(f,e))!==null&&c!==void 0?c:f}Q(e)&&(f=(l=di.make(f,e))!==null&&l!==void 0?l:f);const P=e.getDataName(W.Main),$=new le(f,P,W.Main,g);d[P]=$,f=$,Q(e)&&Nb(e,$);let T=null;if(ze(e)){const X=e.getName("facet");f=(u=Xv(f,e.facet))!==null&&u!==void 0?u:f,T=new Pn(f,e,X,$.getSource()),d[X]=T}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:g,raw:k,main:$,facetRoot:T,ancestorParse:m})}class Qv extends Ro{constructor(t,n,i,r){var s,o,a,c;super(t,"concat",n,i,r,t.resolve);(((o=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||o===void 0?void 0:o.x)==="shared"||((c=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||c===void 0?void 0:c.y)==="shared")&&O(Zd),this.children=this.getChildren(t).map((l,u)=>Ho(l,this,this.getName(`concat_${u}`),void 0,r))}parseData(){this.component.data=Cr(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of v(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return ir(t)?t.vconcat:Vs(t)?t.hconcat:t.concat}parseLayoutSize(){qv(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=Oo(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),i?{style:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup())})}assembleGroupStyle(){return}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function Zv(e){return e===!1||e===null}const Jv=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},Uc),{labelExpr:1,encode:1}),yf=v(Jv);class Do extends pt{constructor(t={},n={},i=!1){super();this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new Do(F(this.explicit),F(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!Zv(this.get(t))}hasOrientSignalRef(){return w(this.explicit.orient)}}function eO(e,t,n){var i;const{encoding:r,config:s}=e,o=(i=Z(r[t]))!==null&&i!==void 0?i:Z(r[ct(t)]),a=e.axis(t)||{},{format:c,formatType:l}=a;if(Xt(l))return Object.assign({text:Ne({fieldOrDatumDef:o,field:"datum.value",format:c,formatType:l,config:s})},n);if(c===void 0&&l===void 0&&s.customFormatTypes){if(yn(o)==="quantitative"){if(vn(o)&&o.stack==="normalize"&&s.normalizedNumberFormatType)return Object.assign({text:Ne({fieldOrDatumDef:o,field:"datum.value",format:s.normalizedNumberFormat,formatType:s.normalizedNumberFormatType,config:s})},n);if(s.numberFormatType)return Object.assign({text:Ne({fieldOrDatumDef:o,field:"datum.value",format:s.numberFormat,formatType:s.numberFormatType,config:s})},n)}if(yn(o)==="temporal"&&s.timeFormatType&&x(o)&&!o.timeUnit)return Object.assign({text:Ne({fieldOrDatumDef:o,field:"datum.value",format:s.timeFormat,formatType:s.timeFormatType,config:s})},n)}return n}function tO(e){return Be.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[cO(n,e)]),t),{})}const nO={bottom:"top",top:"bottom",left:"right",right:"left"};function iO(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of v(s.component.axes))i.axis[o]=xo(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=rO(n[o],s.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const s of Be){for(const o of e.children){if(!o.component.axes[s])continue;if(i.axis[s]==="independent"){n[s]=((t=n[s])!==null&&t!==void 0?t:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:c,explicit:l}=a.getWithExplicit("orient");if(w(c))continue;if(r[c]>0&&!l){const u=nO[c];r[c]>r[u]&&a.set("orient",u,!1)}r[c]++}}delete o.component.axes[s]}if(i.axis[s]==="independent"&&n[s]&&n[s].length>1)for(const o of n[s])!!o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function rO(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t[i];if(!!r!==!!s)return;if(r&&s){const o=r.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[i]=sO(r,s)}}}else return t.map(n=>n.clone());return e}function sO(e,t){for(const n of yf){const i=Ft(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return Aa(r,s);case"gridScale":return{explicit:r.explicit,value:K(r.value,s.value)}}return ar(r,s,n,"axis")});e.setWithExplicit(n,i)}return e}function oO(e,t,n,i,r){if(t==="disable")return n!==void 0;n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(w(n.labelAngle)?n.labelAngle:Hn(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===xu(i,r))return!0}return e===n[t]}const aO=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function cO(e,t){var n,i,r;let s=t.axis(e);const o=new Do,a=Z(t.encoding[e]),{mark:c,config:l}=t,u=(s==null?void 0:s.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=l.axis)===null||i===void 0?void 0:i.orient)||Ub(e),f=t.getScaleComponent(e).get("type"),d=Ab(e,f,u,t.config),g=s!==void 0?!s:mo("disable",l.style,s==null?void 0:s.style,d).configValue;if(o.set("disable",g,s!==void 0),g)return o;s=s||{};const p=Lb(a,s,e,l.style,d),h={fieldOrDatumDef:a,axis:s,channel:e,model:t,scaleType:f,orient:u,labelAngle:p,mark:c,config:l};for(const y of yf){const S=y in yu?yu[y](h):Wc(y)?s[y]:void 0,E=S!==void 0,k=oO(S,y,s,t,e);if(E&&k)o.set(y,S,k);else{const{configValue:P=void 0,configFrom:$=void 0}=Wc(y)&&y!=="values"?mo(y,l.style,s.style,d):{},T=P!==void 0;E&&!T?o.set(y,S,k):(!($==="vgAxisConfig")||aO.has(y)&&T||ii(P)||w(P))&&o.set(y,P,!1)}}const m=(r=s.encoding)!==null&&r!==void 0?r:{},b=Dc.reduce((y,S)=>{var E;if(!o.hasAxisPart(S))return y;const k=ku((E=m[S])!==null&&E!==void 0?E:{},t),P=S==="labels"?eO(t,e,k):k;return P!==void 0&&!L(P)&&(y[S]={update:P}),y},{});return L(b)||o.set("encode",b,!!s.encoding||s.labelAngle!==void 0),o}function lO({encoding:e,size:t}){for(const n of Be){const i=de(n);Qe(t[i])&&(Xe(e[n])&&(delete t[i],O(Ga(i))))}return t}function uO(e,t,n){const i=ge(e),r=R("orient",i,n);if(i.orient=pO(i.type,t,r),r!==void 0&&r!==i.orient&&O(vg(i.orient,r)),i.type==="bar"&&i.orient){const a=R("cornerRadiusEnd",i,n);if(a!==void 0){const c=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:Lp[i.orient];for(const l of c)i[l]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}const s=R("opacity",i,n);s===void 0&&(i.opacity=dO(i.type,t));const o=R("cursor",i,n);return o===void 0&&(i.cursor=fO(i,t,n)),i}function fO(e,t,n){return t.href||e.href||R("href",e,n)?"pointer":e.cursor}function dO(e,t){return z([Di,vs,Os,xs],e)&&!zs(t)?.7:void 0}function gO(e,t,{graticule:n}){if(n)return!1;const i=Bt("filled",e,t),r=e.type;return K(i,r!==Di&&r!==Mi&&r!==Ui)}function pO(e,t,n){switch(e){case Di:case Os:case xs:case gc:case kp:case Ep:return}const{x:i,y:r,x2:s,y2:o}=t;switch(e){case Li:if(x(i)&&(ae(i.bin)||x(r)&&r.aggregate&&!i.aggregate))return"vertical";if(x(r)&&(ae(r.bin)||x(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(x(i)&&i.type===qt&&!U(i.bin)||Fs(i)))return"horizontal";if(!o&&(x(r)&&r.type===qt&&!U(r.bin)||Fs(r)))return"vertical"}case Ui:if(s&&!(x(i)&&ae(i.bin))&&o&&!(x(r)&&ae(r.bin)))return;case Ri:if(o)return x(r)&&ae(r.bin)?"horizontal":"vertical";if(s)return x(i)&&ae(i.bin)?"vertical":"horizontal";if(e===Ui){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case Mi:case vs:{const a=Xe(i),c=Xe(r);if(n)return n;if(a&&!c)return e!=="tick"?"horizontal":"vertical";if(!a&&c)return e!=="tick"?"vertical":"horizontal";if(a&&c){const l=i,u=r,f=l.type===mn,d=u.type===mn;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!l.aggregate&&u.aggregate?e!=="tick"?"vertical":"horizontal":l.aggregate&&!u.aggregate&&e!=="tick"?"horizontal":"vertical"}else return}}return"vertical"}const mO={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),se("x",e,{defaultPos:"mid"})),se("y",e,{defaultPos:"mid"})),Tt(e,"radius")),Tt(e,"theta"))},hO={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),lr("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),lr("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),lo(e))},bO={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Tt(e,"x")),Tt(e,"y"))},yO={vgMark:"shape",encodeEntry:e=>Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape,i=Object.assign({type:"geoshape",projection:e.projectionName()},n&&x(n)&&n.type===hn?{field:_(n,{expr:"datum"})}:{});return[i]}},vO={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),Tt(e,"x")),Tt(e,"y")),ao(e,"url"))},OO={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),se("x",e,{defaultPos:"mid"})),se("y",e,{defaultPos:"mid"})),ne("size",e,{vgChannel:"strokeWidth"})),lo(e))},xO={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),se("x",e,{defaultPos:"mid"})),se("y",e,{defaultPos:"mid"})),ne("size",e)),lo(e))};function Uo(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),se("x",e,{defaultPos:"mid"})),se("y",e,{defaultPos:"mid"})),ne("size",e)),ne("angle",e)),SO(e,n,t))}function SO(e,t,n){return n?{shape:{value:n}}:ne("shape",e)}const _O={vgMark:"symbol",encodeEntry:e=>Uo(e)},jO={vgMark:"symbol",encodeEntry:e=>Uo(e,"circle")},wO={vgMark:"symbol",encodeEntry:e=>Uo(e,"square")},$O={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Tt(e,"x")),Tt(e,"y"))},EO={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),lr("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),lr("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),ne("size",e,{vgChannel:"strokeWidth"}))}},kO={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),se("x",e,{defaultPos:"mid"})),se("y",e,{defaultPos:"mid"})),ao(e)),ne("size",e,{vgChannel:"fontSize"})),ne("angle",e)),Jl("align",CO(e.markDef,n,t))),Jl("baseline",FO(e.markDef,n,t))),se("radius",e,{defaultPos:null})),se("theta",e,{defaultPos:null}))}};function CO(e,t,n){const i=R("align",e,n);return i===void 0?"center":void 0}function FO(e,t,n){const i=R("baseline",e,n);return i===void 0?"middle":void 0}const NO={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",s=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),se("x",e,{defaultPos:"mid",vgChannel:"xc"})),se("y",e,{defaultPos:"mid",vgChannel:"yc"})),ne("size",e,{defaultValue:PO(e),vgChannel:r})),{[s]:B(R("thickness",n,t))})}};function PO(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,s=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),a=(t=R("size",i,n,{vgChannel:s}))!==null&&t!==void 0?t:n.tick.bandSize;if(a!==void 0)return a;{const c=o?o.get("range"):void 0;if(c&&$t(c)&&Y(c.step))return c.step*3/4;const l=rr(n.view,s);return l*3/4}}const Fr={arc:mO,area:hO,bar:bO,circle:jO,geoshape:yO,image:vO,line:OO,point:_O,rect:$O,rule:EO,square:wO,text:kO,tick:NO,trail:xO};function TO(e){if(z([Mi,Ri,Cp],e.mark)){const t=Gc(e.mark,e.encoding);if(t.length>0)return AO(e,t)}else if(e.mark===Li){const t=Qr.some(n=>R(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return zO(e)}return Wo(e)}const vf="faceted_path_";function AO(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:vf+e.requestDataName(W.Main),data:e.requestDataName(W.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:Wo(e,{fromPrefix:vf})}]}const Of="stack_group_";function zO(e){var t;const[n]=Wo(e,{fromPrefix:Of}),i=e.scaleName(e.stack.fieldChannel),r=(u={})=>e.vgField(e.stack.fieldChannel,u),s=(u,f)=>{const d=[r({prefix:"min",suffix:"start",expr:f}),r({prefix:"max",suffix:"start",expr:f}),r({prefix:"min",suffix:"end",expr:f}),r({prefix:"max",suffix:"end",expr:f})];return`${u}(${d.map(g=>`scale('${i}',${g})`).join(",")})`};let o,a;e.stack.fieldChannel==="x"?(o=Object.assign(Object.assign({},ln(n.encode.update,["y","yc","y2","height",...Qr])),{x:{signal:s("min","datum")},x2:{signal:s("max","datum")},clip:{value:!0}}),a={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},n.encode.update=Object.assign(Object.assign({},be(n.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},ln(n.encode.update,["x","xc","x2","width"])),{y:{signal:s("min","datum")},y2:{signal:s("max","datum")},clip:{value:!0}}),a={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},n.encode.update=Object.assign(Object.assign({},be(n.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const u of Qr){const f=Bt(u,e.markDef,e.config);n.encode.update[u]?(o[u]=n.encode.update[u],delete n.encode.update[u]):f&&(o[u]=B(f)),f&&(n.encode.update[u]={value:0})}const c=[];if(((t=e.stack.groupbyChannels)===null||t===void 0?void 0:t.length)>0)for(const u of e.stack.groupbyChannels){const f=e.fieldDef(u),d=_(f);d&&c.push(d),((f==null?void 0:f.bin)||(f==null?void 0:f.timeUnit))&&c.push(_(f,{binSuffix:"end"}))}const l=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return o=l.reduce((u,f)=>{if(n.encode.update[f])return Object.assign(Object.assign({},u),{[f]:n.encode.update[f]});{const d=Bt(f,e.markDef,e.config);return d!==void 0?Object.assign(Object.assign({},u),{[f]:B(d)}):u}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(W.Main),name:Of+e.requestDataName(W.Main),groupby:c,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:a},marks:[n]}]}]}function IO(e){var t;const{encoding:n,stack:i,mark:r,markDef:s,config:o}=e,a=n.order;if(!j(a)&&Pe(a)&&Ir(a.value)||!a&&Ir(R("order",s,o)))return;if((j(a)||x(a))&&!i)return Na(a,{expr:"datum"});if(Et(r)){const c=s.orient==="horizontal"?"y":"x",l=n[c];if(x(l)){const u=l.sort;if(j(u))return{field:_(l,{prefix:c,suffix:"sort_index",expr:"datum"})};if(Ge(u))return{field:_({aggregate:zs(e.encoding)?u.op:void 0,field:u.field},{expr:"datum"})};if($c(u)){const f=e.fieldDef(u.encoding);return{field:_(f,{expr:"datum"}),order:u.order}}else return u===null?void 0:{field:_(l,{binSuffix:((t=e.stack)===null||t===void 0?void 0:t.impute)?"mid":void 0,expr:"datum"})}}return}return}function Wo(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=e,o=K(i.clip,RO(e),LO(e)),a=Ca(i),c=r.key,l=IO(e),u=MO(e),f=R("aria",i,s),d=Fr[n].postEncodingTransform?Fr[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:Fr[n].vgMark},o?{clip:!0}:{}),a?{style:a}:{}),c?{key:c.field}:{}),l?{sort:l}:{}),u||{}),f===!1?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(W.Main)},encode:{update:Fr[n].encodeEntry(e)}}),d?{transform:d}:{})]}function RO(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return(t==null?void 0:t.get("selectionExtent"))||(n==null?void 0:n.get("selectionExtent"))?!0:void 0}function LO(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function MO(e){if(!e.component.selection)return null;const t=v(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=v(i.component.selection).length,i=i.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}class xf extends gf{constructor(t,n,i,r={},s){var o;super(t,"unit",n,i,s,void 0,dl(t)?t.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const a=qe(t.mark)?Object.assign({},t.mark):{type:t.mark},c=a.type;a.filled===void 0&&(a.filled=gO(a,s,{graticule:t.data&&no(t.data)}));const l=this.encoding=mm(t.encoding||{},c,a.filled,s);this.markDef=uO(a,l,s),this.size=lO({encoding:l,size:dl(t)?Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):r}),this.stack=Ol(c,l),this.specifiedScales=this.initScales(c,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegends(l),this.specifiedProjection=t.projection,this.selection=((o=t.params)!==null&&o!==void 0?o:[]).filter(u=>qs(u))}get hasProjection(){const{encoding:t}=this,n=this.mark===pc,i=t&&fd.some(r=>C(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return Pi.reduce((i,r)=>{var s;const o=Z(n[r]);return o&&(i[r]=this.initScale((s=o.scale)!==null&&s!==void 0?s:{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=ge(t);return j(n)&&(r.domain=n.map(ye)),j(i)&&(r.range=i.map(ye)),r}initAxes(t){return Be.reduce((n,i)=>{const r=t[i];if(C(r)||i===G&&C(t.x2)||i===J&&C(t.y2)){const s=C(r)?r.axis:void 0;n[i]=s&&this.initAxis(Object.assign({},s))}return n},{})}initAxis(t){const n=v(t),i={};for(const r of n){const s=t[r];i[r]=ii(s)?$a(s):ye(s)}return i}initLegends(t){return xd.reduce((n,i)=>{const r=Z(t[i]);if(r&&_d(i)){const s=r.legend;n[i]=s&&ge(s)}return n},{})}parseData(){this.component.data=Cr(this)}parseLayoutSize(){Gv(this)}parseSelections(){this.component.selection=Fb(this,this.selection)}parseMarkGroup(){this.component.mark=TO(this)}parseAxesAndHeaders(){this.component.axes=tO(this)}assembleSelectionTopLevelSignals(t){return Qh(this,t)}assembleSignals(){return[...hu(this),...Yh(this,[])]}assembleSelectionData(t){return Zh(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return Oo(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!An(this.parent))&&(n=Wl(this,n)),n.map(this.correctDataNames)}assembleGroupStyle(){const{style:t}=this.view||{};return t!==void 0?t:this.encoding.x||this.encoding.y?"cell":void 0}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Kt(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return Ye(n)}typedFieldDef(t){const n=this.fieldDef(t);return we(n)?n:null}}class Bo extends Ro{constructor(t,n,i,r,s){super(t,"layer",n,i,s,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((a,c)=>{if(or(a))return new Bo(a,this,this.getName(`layer_${c}`),o,s);if(dt(a))return new xf(a,this,this.getName(`layer_${c}`),o,s);throw new Error(Jr(a))})}parseData(){this.component.data=Cr(this);for(const t of this.children)t.parseData()}parseLayoutSize(){Hv(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of v(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){iO(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),hu(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),Oo(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleGroupStyle(){const t=new Set;for(const i of this.children)for(const r of V(i.assembleGroupStyle()))t.add(r);const n=Array.from(t);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t;return}assembleLayout(){return null}assembleMarks(){return Jh(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),Mu(this))}}function Ho(e,t,n,i,r){if(Hi(e))return new mi(e,t,n,r);if(or(e))return new Bo(e,t,n,i,r);if(dt(e))return new xf(e,t,n,i,r);if(Dm(e))return new Qv(e,t,n,r);throw new Error(Jr(e))}var DO=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function UO(e,t={}){t.logger&&Hg(t.logger),t.fieldTitle&&Ic(t.fieldTitle);try{const n=yl(ea(t.config,e.config)),i=zl(e,n),r=Ho(i,null,"",void 0,n);r.parse(),Jy(r.component.data,r);const s=BO(r,WO(e,i.autosize,n,r),e.datasets,e.usermeta);return{spec:s,normalized:i}}finally{t.logger&&qg(),t.fieldTitle&&sm()}}function WO(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):N(t)&&(t={type:t}),r&&s&&Hh(t.type)){if(r==="step"&&s==="step")O(Ra()),t.type="pad";else if(r==="step"||s==="step"){const o=r==="step"?"width":"height";O(Ra(Ni(o)));const a=o==="width"?"height":"width";t.type=qh(a)}}return Object.assign(Object.assign(Object.assign({},v(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),Rl(n,!1)),Rl(e,!0))}function BO(e,t,n={},i){const r=e.config?th(e.config):void 0,s=[].concat(e.assembleSelectionData([]),Dv(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),c=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let u=e.assembleLayoutSignals();u=u.filter(g=>(g.name==="width"||g.name==="height")&&g.value!==void 0?(t[g.name]=+g.value,!1):!0);const{params:f}=t,d=DO(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),a?{title:a}:{}),c?{style:c}:{}),l?{encode:{update:l}}:{}),{data:s}),o.length>0?{projections:o}:{}),e.assembleGroup([...u,...e.assembleSelectionTopLevelSignals([]),...ul(f)])),r?{config:r}:{}),i?{usermeta:i}:{})}const HO=id.version;export{un as accessPathDepth,Ur as accessPathWithDatum,UO as compile,z as contains,Ie as deepEqual,ji as deleteNestedProperty,F as duplicate,ht as entries,Rr as every,Dr as fieldIntersection,oa as flatAccessWithDatum,K as getFirstDefined,Lr as hasIntersection,A as hash,la as internalField,Un as isBoolean,L as isEmpty,sd as isEqual,ua as isInternalField,Ir as isNullOrFalse,wi as isNumeric,v as keys,Wn as logicalExpr,ra as mergeDeep,ia as never,zl as normalize,Hn as normalizeAngle,be as omit,ln as pick,Mr as prefixGenerator,Wr as removePathFromField,Lt as replaceAll,xe as replacePathInField,ad as resetIdCounter,sa as setEqual,Rt as some,D as stringify,Bn as titleCase,Re as unique,ca as uniqueId,ie as vals,q as varName,HO as version};export default null;
