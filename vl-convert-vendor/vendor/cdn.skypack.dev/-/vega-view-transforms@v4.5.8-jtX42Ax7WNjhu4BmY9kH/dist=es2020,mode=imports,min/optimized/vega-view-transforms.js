import{Transform as v}from"/-/vega-dataflow@v5.7.4-DrCzG6Luqf74SfPN5Hxw/dist=es2020,mode=imports,min/optimized/vega-dataflow.js";import{Marks as Dt,boundClip as St,GroupItem as Gt,Item as Pt,Bounds as U,multiLineOffset as dt,boundStroke as lt}from"/-/vega-scenegraph@v4.9.4-Rfd7OGmaS9T7w10Fz4Yx/dist=es2020,mode=imports,min/optimized/vega-scenegraph.js";import{inherits as H,peek as Q,isObject as jt}from"/-/vega-util@v1.17.0-uRskU0IBL2vWCP4Va8OC/dist=es2020,mode=imports,min/optimized/vega-util.js";const N="top",D="left",S="right",P="bottom",Bt="top-left",Ht="top-right",Nt="bottom-left",Vt="bottom-right",Z="start",_="middle",T="end",Yt="x",qt="y",W="group",tt="axis",nt="title",Ut="frame",Wt="scope",ot="legend",ut="row-header",ft="row-footer",ht="row-title",mt="column-header",yt="column-footer",bt="column-title",Xt="padding",$t="symbol",xt="fit",Jt="fit-x",Kt="fit-y",Qt="pad",et="none",X="all",at="each",rt="flush",j="column",B="row";function gt(n){v.call(this,null,n)}H(gt,v,{transform(n,t){const o=t.dataflow,r=n.mark,a=r.marktype,i=Dt[a],s=i.bound;let c=r.bounds,l;if(i.nested)r.items.length&&o.dirty(r.items[0]),c=$(r,s),r.items.forEach(u=>{u.bounds.clear().union(c)});else if(a===W||n.modified()){t.visit(t.MOD,u=>o.dirty(u)),c.clear(),r.items.forEach(u=>c.union($(u,s)));switch(r.role){case tt:case ot:case nt:t.reflow()}}else l=t.changed(t.REM),t.visit(t.ADD,u=>{c.union($(u,s))}),t.visit(t.MOD,u=>{l=l||c.alignsWith(u.bounds),o.dirty(u),c.union($(u,s))}),l&&(c.clear(),r.items.forEach(u=>c.union(u.bounds)));return St(r),t.modifies("bounds")}});function $(n,t,o){return t(n.bounds.clear(),n,o)}const kt=":vega_identifier:";function it(n){v.call(this,0,n)}it.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},H(it,v,{transform(n,t){const o=Zt(t.dataflow),r=n.as;let a=o.value;return t.visit(t.ADD,i=>i[r]=i[r]||++a),o.set(this.value=a),t}});function Zt(n){return n._signals[kt]||(n._signals[kt]=n.add(0))}function Mt(n){v.call(this,null,n)}H(Mt,v,{transform(n,t){let o=this.value;o||(o=t.dataflow.scenegraph().mark(n.markdef,_t(n),n.index),o.group.context=n.context,n.context.group||(n.context.group=o.group),o.source=this.source,o.clip=n.clip,o.interactive=n.interactive,this.value=o);const r=o.marktype===W?Gt:Pt;return t.visit(t.ADD,a=>r.call(a,o)),(n.modified("clip")||n.modified("interactive"))&&(o.clip=n.clip,o.interactive=!!n.interactive,o.zdirty=!0,t.reflow()),o.items=t.source,t}});function _t(n){const t=n.groups,o=n.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&o?t.lookup(o):null}function wt(n){v.call(this,null,n)}const pt={parity:n=>n.filter((t,o)=>o%2?t.opacity=0:1),greedy:(n,t)=>{let o;return n.filter((r,a)=>!a||!Et(o.bounds,r.bounds,t)?(o=r,1):r.opacity=0)}},Et=(n,t,o)=>o>Math.max(t.x1-n.x2,n.x1-t.x2,t.y1-n.y2,n.y1-t.y2),Rt=(n,t)=>{for(var o=1,r=n.length,a=n[0].bounds,i;o<r;a=i,++o)if(Et(a,i=n[o].bounds,t))return!0},tn=n=>{const t=n.bounds;return t.width()>1&&t.height()>1},nn=(n,t,o)=>{var r=n.range(),a=new U;return t===N||t===P?a.set(r[0],-Infinity,r[1],Infinity):a.set(-Infinity,r[0],Infinity,r[1]),a.expand(o||1),i=>a.encloses(i.bounds)},Lt=n=>(n.forEach(t=>t.opacity=1),n),zt=(n,t)=>n.reflow(t.modified()).modifies("opacity");H(wt,v,{transform(n,t){const o=pt[n.method]||pt.parity,r=n.separation||0;let a=t.materialize(t.SOURCE).source,i,s;if(!a||!a.length)return;if(!n.method)return n.modified("method")&&(Lt(a),t=zt(t,n)),t;if(a=a.filter(tn),!a.length)return;if(n.sort&&(a=a.slice().sort(n.sort)),i=Lt(a),t=zt(t,n),i.length>=3&&Rt(i,r)){do i=o(i,r);while(i.length>=3&&Rt(i,r));i.length<3&&!Q(a).opacity&&(i.length>1&&(Q(i).opacity=0),Q(a).opacity=1)}n.boundScale&&n.boundTolerance>=0&&(s=nn(n.boundScale,n.boundOrient,+n.boundTolerance),a.forEach(l=>{s(l)||(l.opacity=0)}));const c=i[0].mark.bounds.clear();return a.forEach(l=>{l.opacity&&c.union(l.bounds)}),t}});function At(n){v.call(this,null,n)}H(At,v,{transform(n,t){const o=t.dataflow;if(t.visit(t.ALL,r=>o.dirty(r)),t.fields&&t.fields.zindex){const r=t.source&&t.source[0];r&&(r.mark.zdirty=!0)}}});const A=new U;function V(n,t,o){return n[t]===o?0:(n[t]=o,1)}function on(n){var t=n.items[0].orient;return t===D||t===S}function en(n){let t=+n.grid;return[n.ticks?t++:-1,n.labels?t++:-1,t+ +n.domain]}function an(n,t,o,r){var a=t.items[0],i=a.datum,s=a.translate!=null?a.translate:.5,c=a.orient,l=en(i),u=a.range,d=a.offset,m=a.position,h=a.minExtent,x=a.maxExtent,b=i.title&&a.items[l[2]].items[0],g=a.titlePadding,f=a.bounds,y=b&&dt(b),k=0,M=0,L,E;A.clear().union(f),f.clear(),(L=l[0])>-1&&f.union(a.items[L].bounds),(L=l[1])>-1&&f.union(a.items[L].bounds);switch(c){case N:k=m||0,M=-d,E=Math.max(h,Math.min(x,-f.y1)),f.add(0,-E).add(u,0),b&&J(n,b,E,g,y,0,-1,f);break;case D:k=-d,M=m||0,E=Math.max(h,Math.min(x,-f.x1)),f.add(-E,0).add(0,u),b&&J(n,b,E,g,y,1,-1,f);break;case S:k=o+d,M=m||0,E=Math.max(h,Math.min(x,f.x2)),f.add(0,0).add(E,u),b&&J(n,b,E,g,y,1,1,f);break;case P:k=m||0,M=r+d,E=Math.max(h,Math.min(x,f.y2)),f.add(0,0).add(u,E),b&&J(n,b,E,g,0,0,1,f);break;default:k=a.x,M=a.y}return lt(f.translate(k,M),a),V(a,"x",k+s)|V(a,"y",M+s)&&(a.bounds=A,n.dirty(a),a.bounds=f,n.dirty(a)),a.mark.bounds.clear().union(f)}function J(n,t,o,r,a,i,s,c){const l=t.bounds;if(t.auto){const u=s*(o+a+r);let d=0,m=0;n.dirty(t),i?d=(t.x||0)-(t.x=u):m=(t.y||0)-(t.y=u),t.mark.bounds.clear().union(l.translate(-d,-m)),n.dirty(t)}c.union(l)}const Tt=(n,t)=>Math.floor(Math.min(n,t)),Ot=(n,t)=>Math.ceil(Math.max(n,t));function rn(n){var t=n.items,o=t.length,r=0,a,i;const s={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;r<o;++r)if(a=t[r],i=a.items,a.marktype===W)switch(a.role){case tt:case ot:case nt:break;case ut:s.rowheaders.push(...i);break;case ft:s.rowfooters.push(...i);break;case mt:s.colheaders.push(...i);break;case yt:s.colfooters.push(...i);break;case ht:s.rowtitle=i[0];break;case bt:s.coltitle=i[0];break;default:s.marks.push(...i)}return s}function sn(n){return new U().set(0,0,n.width||0,n.height||0)}function cn(n){const t=n.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(n.x||0),-(n.y||0))}function w(n,t,o){const r=jt(n)?n[t]:n;return r??(o!==void 0?o:0)}function Ft(n){return n<0?Math.ceil(-n):0}function It(n,t,o){var r=!o.nodirty,a=o.bounds===rt?sn:cn,i=A.set(0,0,0,0),s=w(o.align,j),c=w(o.align,B),l=w(o.padding,j),u=w(o.padding,B),d=o.columns||t.length,m=d<=0?1:Math.ceil(t.length/d),h=t.length,x=Array(h),b=Array(d),g=0,f=Array(h),y=Array(m),k=0,M=Array(h),L=Array(h),E=Array(h),O,e,p,R,G,I,st,ct,F,C,z;for(e=0;e<d;++e)b[e]=0;for(e=0;e<m;++e)y[e]=0;for(e=0;e<h;++e)I=t[e],G=E[e]=a(I),I.x=I.x||0,M[e]=0,I.y=I.y||0,L[e]=0,p=e%d,R=~~(e/d),g=Math.max(g,st=Math.ceil(G.x2)),k=Math.max(k,ct=Math.ceil(G.y2)),b[p]=Math.max(b[p],st),y[R]=Math.max(y[R],ct),x[e]=l+Ft(G.x1),f[e]=u+Ft(G.y1),r&&n.dirty(t[e]);for(e=0;e<h;++e)e%d===0&&(x[e]=0),e<d&&(f[e]=0);if(s===at)for(p=1;p<d;++p){for(z=0,e=p;e<h;e+=d)z<x[e]&&(z=x[e]);for(e=p;e<h;e+=d)x[e]=z+b[p-1]}else if(s===X){for(z=0,e=0;e<h;++e)e%d&&z<x[e]&&(z=x[e]);for(e=0;e<h;++e)e%d&&(x[e]=z+g)}else for(s=!1,p=1;p<d;++p)for(e=p;e<h;e+=d)x[e]+=b[p-1];if(c===at)for(R=1;R<m;++R){for(z=0,e=R*d,O=e+d;e<O;++e)z<f[e]&&(z=f[e]);for(e=R*d;e<O;++e)f[e]=z+y[R-1]}else if(c===X){for(z=0,e=d;e<h;++e)z<f[e]&&(z=f[e]);for(e=d;e<h;++e)f[e]=z+k}else for(c=!1,R=1;R<m;++R)for(e=R*d,O=e+d;e<O;++e)f[e]+=y[R-1];for(F=0,e=0;e<h;++e)F=x[e]+(e%d?F:0),M[e]+=F-t[e].x;for(p=0;p<d;++p)for(C=0,e=p;e<h;e+=d)C+=f[e],L[e]+=C-t[e].y;if(s&&w(o.center,j)&&m>1)for(e=0;e<h;++e)G=s===X?g:b[e%d],F=G-E[e].x2-t[e].x-M[e],F>0&&(M[e]+=F/2);if(c&&w(o.center,B)&&d!==1)for(e=0;e<h;++e)G=c===X?k:y[~~(e/d)],C=G-E[e].y2-t[e].y-L[e],C>0&&(L[e]+=C/2);for(e=0;e<h;++e)i.union(E[e].translate(M[e],L[e]));F=w(o.anchor,Yt),C=w(o.anchor,qt);switch(w(o.anchor,j)){case T:F-=i.width();break;case _:F-=i.width()/2}switch(w(o.anchor,B)){case T:C-=i.height();break;case _:C-=i.height()/2}for(F=Math.round(F),C=Math.round(C),i.clear(),e=0;e<h;++e)t[e].mark.bounds.clear();for(e=0;e<h;++e)I=t[e],I.x+=M[e]+=F,I.y+=L[e]+=C,i.union(I.mark.bounds.union(I.bounds.translate(M[e],L[e]))),r&&n.dirty(I);return i}function dn(n,t,o){var r=rn(t),a=r.marks,i=o.bounds===rt?ln:un,s=o.offset,c=o.columns||a.length,l=c<=0?1:Math.ceil(a.length/c),u=l*c,d,m,h,x,b,g,f;const y=It(n,a,o);y.empty()&&y.set(0,0,0,0),r.rowheaders&&(g=w(o.headerBand,B,null),d=K(n,r.rowheaders,a,c,l,-w(s,"rowHeader"),Tt,0,i,"x1",0,c,1,g)),r.colheaders&&(g=w(o.headerBand,j,null),m=K(n,r.colheaders,a,c,c,-w(s,"columnHeader"),Tt,1,i,"y1",0,1,c,g)),r.rowfooters&&(g=w(o.footerBand,B,null),h=K(n,r.rowfooters,a,c,l,w(s,"rowFooter"),Ot,0,i,"x2",c-1,c,1,g)),r.colfooters&&(g=w(o.footerBand,j,null),x=K(n,r.colfooters,a,c,c,w(s,"columnFooter"),Ot,1,i,"y2",u-c,1,c,g)),r.rowtitle&&(b=w(o.titleAnchor,B),f=w(s,"rowTitle"),f=b===T?h+f:d-f,g=w(o.titleBand,B,.5),Ct(n,r.rowtitle,f,0,y,g)),r.coltitle&&(b=w(o.titleAnchor,j),f=w(s,"columnTitle"),f=b===T?x+f:m-f,g=w(o.titleBand,j,.5),Ct(n,r.coltitle,f,1,y,g))}function ln(n,t){return t==="x1"?n.x||0:t==="y1"?n.y||0:t==="x2"?(n.x||0)+(n.width||0):t==="y2"?(n.y||0)+(n.height||0):void 0}function un(n,t){return n.bounds[t]}function K(n,t,o,r,a,i,s,c,l,u,d,m,h,x){var b=o.length,g=0,f=0,y,k,M,L,E,O,e,p,R;if(!b)return g;for(y=d;y<b;y+=m)o[y]&&(g=s(g,l(o[y],u)));if(!t.length)return g;for(t.length>a&&(n.warn("Grid headers exceed limit: "+a),t=t.slice(0,a)),g+=i,k=0,L=t.length;k<L;++k)n.dirty(t[k]),t[k].mark.bounds.clear();for(y=d,k=0,L=t.length;k<L;++k,y+=m){for(O=t[k],E=O.mark.bounds,M=y;M>=0&&(e=o[M])==null;M-=h);c?(p=x==null?e.x:Math.round(e.bounds.x1+x*e.bounds.width()),R=g):(p=g,R=x==null?e.y:Math.round(e.bounds.y1+x*e.bounds.height())),E.union(O.bounds.translate(p-(O.x||0),R-(O.y||0))),O.x=p,O.y=R,n.dirty(O),f=s(f,E[u])}return f}function Ct(n,t,o,r,a,i){if(!t)return;n.dirty(t);var s=o,c=o;r?s=Math.round(a.x1+i*a.width()):c=Math.round(a.y1+i*a.height()),t.bounds.translate(s-(t.x||0),c-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=s,t.y=c,n.dirty(t)}function fn(n,t){const o=n[t]||{};return(r,a)=>o[r]!=null?o[r]:n[r]!=null?n[r]:a}function hn(n,t){let o=-Infinity;return n.forEach(r=>{r.offset!=null&&(o=Math.max(o,r.offset))}),o>-Infinity?o:t}function mn(n,t,o,r,a,i,s){const c=fn(o,t),l=hn(n,c("offset",0)),u=c("anchor",Z),d=u===T?1:u===_?.5:0,m={align:at,bounds:c("bounds",rt),columns:c("direction")==="vertical"?1:n.length,padding:c("margin",8),center:c("center"),nodirty:!0};switch(t){case D:m.anchor={x:Math.floor(r.x1)-l,column:T,y:d*(s||r.height()+2*r.y1),row:u};break;case S:m.anchor={x:Math.ceil(r.x2)+l,y:d*(s||r.height()+2*r.y1),row:u};break;case N:m.anchor={y:Math.floor(a.y1)-l,row:T,x:d*(i||a.width()+2*a.x1),column:u};break;case P:m.anchor={y:Math.ceil(a.y2)+l,x:d*(i||a.width()+2*a.x1),column:u};break;case Bt:m.anchor={x:l,y:l};break;case Ht:m.anchor={x:i-l,y:l,column:T};break;case Nt:m.anchor={x:l,y:s-l,row:T};break;case Vt:m.anchor={x:i-l,y:s-l,column:T,row:T};break}return m}function yn(n,t){var o=t.items[0],r=o.datum,a=o.orient,i=o.bounds,s=o.x,c=o.y,l,u;return o._bounds?o._bounds.clear().union(i):o._bounds=i.clone(),i.clear(),xn(n,o,o.items[0].items[0]),i=bn(o,i),l=2*o.padding,u=2*o.padding,i.empty()||(l=Math.ceil(i.width()+l),u=Math.ceil(i.height()+u)),r.type===$t&&gn(o.items[0].items[0].items[0].items),a!==et&&(o.x=s=0,o.y=c=0),o.width=l,o.height=u,lt(i.set(s,c,s+l,c+u),o),o.mark.bounds.clear().union(i),o}function bn(n,t){return n.items.forEach(o=>t.union(o.bounds)),t.x1=n.padding,t.y1=n.padding,t}function xn(n,t,o){var r=t.padding,a=r-o.x,i=r-o.y;if(!t.datum.title)(a||i)&&q(n,o,a,i);else{var s=t.items[1].items[0],c=s.anchor,l=t.titlePadding||0,u=r-s.x,d=r-s.y;switch(s.orient){case D:a+=Math.ceil(s.bounds.width())+l;break;case S:case P:break;default:i+=s.bounds.height()+l}(a||i)&&q(n,o,a,i);switch(s.orient){case D:d+=Y(t,o,s,c,1,1);break;case S:u+=Y(t,o,s,T,0,0)+l,d+=Y(t,o,s,c,1,1);break;case P:u+=Y(t,o,s,c,0,0),d+=Y(t,o,s,T,-1,0,1)+l;break;default:u+=Y(t,o,s,c,0,0)}(u||d)&&q(n,s,u,d),(u=Math.round(s.bounds.x1-r))<0&&(q(n,o,-u,0),q(n,s,-u,0))}}function Y(n,t,o,r,a,i,s){const c=n.datum.type!=="symbol",l=o.datum.vgrad,u=c&&(i||!l)&&!s?t.items[0]:t,d=u.bounds[a?"y2":"x2"]-n.padding,m=l&&i?d:0,h=l&&i?0:d,x=a<=0?0:dt(o);return Math.round(r===Z?m:r===T?h-x:.5*(d-x))}function q(n,t,o,r){t.x+=o,t.y+=r,t.bounds.translate(o,r),t.mark.bounds.translate(o,r),n.dirty(t)}function gn(n){const t=n.reduce((o,r)=>(o[r.column]=Math.max(r.bounds.x2-r.x,o[r.column]||0),o),{});n.forEach(o=>{o.width=t[o.column],o.height=o.bounds.y2-o.y})}function kn(n,t,o,r,a){var i=t.items[0],s=i.frame,c=i.orient,l=i.anchor,u=i.offset,d=i.padding,m=i.items[0].items[0],h=i.items[1]&&i.items[1].items[0],x=c===D||c===S?r:o,b=0,g=0,f=0,y=0,k=0,M;if(s!==W?c===D?(b=a.y2,x=a.y1):c===S?(b=a.y1,x=a.y2):(b=a.x1,x=a.x2):c===D&&(b=r,x=0),M=l===Z?b:l===T?x:(b+x)/2,h&&h.text){switch(c){case N:case P:k=m.bounds.height()+d;break;case D:y=m.bounds.width()+d;break;case S:y=-m.bounds.width()-d;break}A.clear().union(h.bounds),A.translate(y-(h.x||0),k-(h.y||0)),V(h,"x",y)|V(h,"y",k)&&(n.dirty(h),h.bounds.clear().union(A),h.mark.bounds.clear().union(A),n.dirty(h)),A.clear().union(h.bounds)}else A.clear();A.union(m.bounds);switch(c){case N:g=M,f=a.y1-A.height()-u;break;case D:g=a.x1-A.width()-u,f=M;break;case S:g=a.x2+A.width()+u,f=M;break;case P:g=M,f=a.y2+u;break;default:g=i.x,f=i.y}return V(i,"x",g)|V(i,"y",f)&&(A.translate(g,f),n.dirty(i),i.bounds.clear().union(A),t.bounds.clear().union(A),n.dirty(i)),i.bounds}function vt(n){v.call(this,null,n)}H(vt,v,{transform(n,t){const o=t.dataflow;return n.mark.items.forEach(r=>{n.layout&&dn(o,r,n.layout),wn(o,r,n)}),Mn(n.mark.group)?t.reflow():t}});function Mn(n){return n&&n.mark.role!=="legend-entry"}function wn(n,t,o){var r=t.items,a=Math.max(0,t.width||0),i=Math.max(0,t.height||0),s=new U().set(0,0,a,i),c=s.clone(),l=s.clone(),u=[],d,m,h,x,b,g;for(b=0,g=r.length;b<g;++b){m=r[b];switch(m.role){case tt:x=on(m)?c:l,x.union(an(n,m,a,i));break;case nt:d=m;break;case ot:u.push(yn(n,m));break;case Ut:case Wt:case ut:case ft:case ht:case mt:case yt:case bt:c.union(m.bounds),l.union(m.bounds);break;default:s.union(m.bounds)}}if(u.length){const f={};u.forEach(y=>{h=y.orient||S,h!==et&&(f[h]||(f[h]=[])).push(y)});for(const y in f){const k=f[y];It(n,k,mn(k,y,o.legends,c,l,a,i))}u.forEach(y=>{const k=y.bounds;if(k.equals(y._bounds)||(y.bounds=y._bounds,n.dirty(y),y.bounds=k,n.dirty(y)),o.autosize&&o.autosize.type===xt)switch(y.orient){case D:case S:s.add(k.x1,0).add(k.x2,0);break;case N:case P:s.add(0,k.y1).add(0,k.y2)}else s.union(k)})}s.union(c).union(l),d&&s.union(kn(n,d,a,i,s)),t.clip&&s.set(0,0,t.width||0,t.height||0),pn(n,t,s,o)}function pn(n,t,o,r){const a=r.autosize||{},i=a.type;if(n._autosize<1||!i)return;let s=n._width,c=n._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-o.x1)),d=Math.max(0,t.height||0),m=Math.max(0,Math.ceil(-o.y1));const h=Math.max(0,Math.ceil(o.x2-l)),x=Math.max(0,Math.ceil(o.y2-d));if(a.contains===Xt){const b=n.padding();s-=b.left+b.right,c-=b.top+b.bottom}i===et?(u=0,m=0,l=s,d=c):i===xt?(l=Math.max(0,s-u-h),d=Math.max(0,c-m-x)):i===Jt?(l=Math.max(0,s-u-h),c=d+m+x):i===Kt?(s=l+u+h,d=Math.max(0,c-m-x)):i===Qt&&(s=l+u+h,c=d+m+x),n._resizeView(s,c,l,d,[u,m],a.resize)}export{gt as bound,it as identifier,Mt as mark,wt as overlap,At as render,vt as viewlayout};export default null;
