import{canvas as H}from"/-/vega-canvas@v1.2.6-LOIUlXMv11fR2KwlkAGG/dist=es2020,mode=imports,min/optimized/vega-canvas.js";import{Transform as E}from"/-/vega-dataflow@v5.7.4-DrCzG6Luqf74SfPN5Hxw/dist=es2020,mode=imports,min/optimized/vega-dataflow.js";import{inherits as J,error as K,isFunction as F,constant as Y,extent as Z}from"/-/vega-util@v1.17.0-uRskU0IBL2vWCP4Va8OC/dist=es2020,mode=imports,min/optimized/vega-util.js";import{scale as Q}from"/-/vega-scale@v7.1.1-ZDIRLXqFpzGB7NTGb7z6/dist=es2020,mode=imports,min/optimized/vega-scale.js";import{random as $}from"/-/vega-statistics@v1.7.10-LV9NsWqBJNud79RMDFen/dist=es2020,mode=imports,min/optimized/vega-statistics.js";var G=Math.PI/180,D=1<<11>>5,N=1<<11;function _(){var e=[256,256],t,o,m,f,y,a,c,p=U,v=[],s=Math.random,i={};i.layout=function(){for(var r=l(H()),n=at((e[0]>>5)*e[1]),u=null,b=v.length,z=-1,S=[],w=v.map(h=>({text:t(h),font:o(h),style:f(h),weight:y(h),rotate:a(h),size:~~(m(h)+1e-14),padding:c(h),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:h})).sort((h,d)=>d.size-h.size);++z<b;){var x=w[z];x.x=e[0]*(s()+.5)>>1,x.y=e[1]*(s()+.5)>>1,tt(r,x,w,z),x.hasText&&g(n,x,u)&&(S.push(x),u?rt(u,x):u=[{x:x.x+x.x0,y:x.y+x.y0},{x:x.x+x.x1,y:x.y+x.y1}],x.x-=e[0]>>1,x.y-=e[1]>>1)}return S};function l(r){r.width=r.height=1;var n=Math.sqrt(r.getContext("2d").getImageData(0,0,1,1).data.length>>2);r.width=(D<<5)/n,r.height=N/n;var u=r.getContext("2d");return u.fillStyle=u.strokeStyle="red",u.textAlign="center",{context:u,ratio:n}}function g(r,n,u){for(var b=n.x,z=n.y,S=Math.sqrt(e[0]*e[0]+e[1]*e[1]),w=p(e),x=s()<.5?1:-1,h=-x,d,W,k;(d=w(h+=x))&&!(W=~~d[0],k=~~d[1],Math.min(Math.abs(W),Math.abs(k))>=S);){if(n.x=b+W,n.y=z+k,n.x+n.x0<0||n.y+n.y0<0||n.x+n.x1>e[0]||n.y+n.y1>e[1])continue;if((!u||!et(n,r,e[0]))&&(!u||nt(n,u))){for(var T=n.sprite,C=n.width>>5,A=e[0]>>5,B=n.x-(C<<4),O=B&127,j=32-O,V=n.y1-n.y0,P=(n.y+n.y0)*A+(B>>5),q,I=0;I<V;I++){q=0;for(var R=0;R<=C;R++)r[P+R]|=q<<j|(R<C?(q=T[I*C+R])>>>O:0);P+=A}return n.sprite=null,!0}}return!1}return i.words=function(r){return arguments.length?(v=r,i):v},i.size=function(r){return arguments.length?(e=[+r[0],+r[1]],i):e},i.font=function(r){return arguments.length?(o=M(r),i):o},i.fontStyle=function(r){return arguments.length?(f=M(r),i):f},i.fontWeight=function(r){return arguments.length?(y=M(r),i):y},i.rotate=function(r){return arguments.length?(a=M(r),i):a},i.text=function(r){return arguments.length?(t=M(r),i):t},i.spiral=function(r){return arguments.length?(p=ot[r]||r,i):p},i.fontSize=function(r){return arguments.length?(m=M(r),i):m},i.padding=function(r){return arguments.length?(c=M(r),i):c},i.random=function(r){return arguments.length?(s=r,i):s},i}function tt(e,t,o,m){if(t.sprite)return;var f=e.context,y=e.ratio;f.clearRect(0,0,(D<<5)/y,N/y);var a=0,c=0,p=0,v=o.length,s,i,l,g,r;for(--m;++m<v;){if(t=o[m],f.save(),f.font=t.style+" "+t.weight+" "+~~((t.size+1)/y)+"px "+t.font,s=f.measureText(t.text+"m").width*y,l=t.size<<1,t.rotate){var n=Math.sin(t.rotate*G),u=Math.cos(t.rotate*G),b=s*u,z=s*n,S=l*u,w=l*n;s=Math.max(Math.abs(b+w),Math.abs(b-w))+31>>5<<5,l=~~Math.max(Math.abs(z+S),Math.abs(z-S))}else s=s+31>>5<<5;if(l>p&&(p=l),a+s>=D<<5&&(a=0,c+=p,p=0),c+l>=N)break;f.translate((a+(s>>1))/y,(c+(l>>1))/y),t.rotate&&f.rotate(t.rotate*G),f.fillText(t.text,0,0),t.padding&&(f.lineWidth=2*t.padding,f.strokeText(t.text,0,0)),f.restore(),t.width=s,t.height=l,t.xoff=a,t.yoff=c,t.x1=s>>1,t.y1=l>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,a+=s}for(var x=f.getImageData(0,0,(D<<5)/y,N/y).data,h=[];--m>=0;){if(t=o[m],!t.hasText)continue;for(s=t.width,i=s>>5,l=t.y1-t.y0,g=0;g<l*i;g++)h[g]=0;if(a=t.xoff,a==null)return;c=t.yoff;var d=0,W=-1;for(r=0;r<l;r++){for(g=0;g<s;g++){var k=i*r+(g>>5),T=x[(c+r)*(D<<5)+(a+g)<<2]?1<<31-g%32:0;h[k]|=T,d|=T}d?W=r:(t.y0++,l--,r--,c++)}t.y1=t.y0+W,t.sprite=h.slice(0,(t.y1-t.y0)*i)}}function et(e,t,o){o>>=5;for(var m=e.sprite,f=e.width>>5,y=e.x-(f<<4),a=y&127,c=32-a,p=e.y1-e.y0,v=(e.y+e.y0)*o+(y>>5),s,i=0;i<p;i++){s=0;for(var l=0;l<=f;l++)if((s<<c|(l<f?(s=m[i*f+l])>>>a:0))&t[v+l])return!0;v+=o}return!1}function rt(e,t){var o=e[0],m=e[1];t.x+t.x0<o.x&&(o.x=t.x+t.x0),t.y+t.y0<o.y&&(o.y=t.y+t.y0),t.x+t.x1>m.x&&(m.x=t.x+t.x1),t.y+t.y1>m.y&&(m.y=t.y+t.y1)}function nt(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function U(e){var t=e[0]/e[1];return function(o){return[t*(o*=.1)*Math.cos(o),o*Math.sin(o)]}}function it(e){var t=4,o=t*e[0]/e[1],m=0,f=0;return function(y){var a=y<0?-1:1;switch(Math.sqrt(1+4*a*y)-a&3){case 0:m+=o;break;case 1:f+=t;break;case 2:m-=o;break;default:f-=t;break}return[m,f]}}function at(e){for(var t=[],o=-1;++o<e;)t[o]=0;return t}function M(e){return typeof e=="function"?e:function(){return e}}var ot={archimedean:U,rectangular:it};const X=["x","y","font","fontSize","fontStyle","fontWeight","angle"],ft=["text","font","rotate","fontSize","fontStyle","fontWeight"];function L(e){E.call(this,_(),e)}L.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:X}]},J(L,E,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&K("Wordcloud size dimensions must be non-zero.");function o(r){const n=e[r];return F(n)&&t.modified(n.fields)}const m=e.modified();if(!(m||t.changed(t.ADD_REM)||ft.some(o)))return;const f=t.materialize(t.SOURCE).source,y=this.value,a=e.as||X;let c=e.fontSize||14,p;if(F(c)?p=e.fontSizeRange:c=Y(c),p){const r=c,n=Q("sqrt")().domain(Z(f,r)).range(p);c=u=>n(r(u))}f.forEach(r=>{r[a[0]]=NaN,r[a[1]]=NaN,r[a[3]]=0});const v=y.words(f).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(c).random($).layout(),s=y.size(),i=s[0]>>1,l=s[1]>>1,g=v.length;for(let r=0,n,u;r<g;++r)n=v[r],u=n.datum,u[a[0]]=n.x+i,u[a[1]]=n.y+l,u[a[2]]=n.font,u[a[3]]=n.size,u[a[4]]=n.style,u[a[5]]=n.weight,u[a[6]]=n.rotate;return t.reflow(m).modifies(a)}});export{L as wordcloud};export default null;
