import{hasOwnProperty as en,isNumber as Y,isString as F,writeConfig as $f,splitAccessPath as tn,stringValue as z,isObject as H,isBoolean as zn,isArray as j,array as V,logger as Ef,Warn as kf,isFunction as Cf,mergeConfig as Jo,identity as Nf}from"/-/vega-util@v1.17.0-uRskU0IBL2vWCP4Va8OC/dist=es2020,mode=imports,min/optimized/vega-util.js";import"/-/array-flat-polyfill@v1.0.1-l3YUpM9vpzkxx3sm0lhL/dist=es2020,mode=imports,min/optimized/array-flat-polyfill.js";import Pf from"/-/clone@v2.1.2-inH2VLNzDGiYU9HUWyZM/dist=es2020,mode=imports,min/optimized/clone.js";import Ff from"/-/fast-deep-equal@v3.1.3-ysejKs1WDEDPxUJhgGoP/dist=es2020,mode=imports,min/optimized/fast-deep-equal.js";import Cr from"/-/fast-json-stable-stringify@v2.1.0-HLgsuOtxPikt0pw16nth/dist=es2020,mode=imports,min/optimized/fast-json-stable-stringify.js";import{isObject as ea,writeConfig as Af,isArray as ta,isString as yi}from"/-/vega@v5.21.0-p1iA2nFhhypDthI1mAci/dist=es2020,mode=imports,min/optimized/vega.js";import{parseSelector as nn}from"/-/vega-event-selector@v3.0.0-l4odHnkvkuEDkNxAGBfX/dist=es2020,mode=imports,min/optimized/vega-event-selector.js";import{parseExpression as Tf}from"/-/vega-expression@v5.0.0-kP0F2avA8xgwhtleXksI/dist=es2020,mode=imports,min/optimized/vega-expression.js";const If="vega-lite",zf='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',Rf="5.2.0",Lf=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],Df="https://vega.github.io/vega-lite/",Mf="Vega-Lite is a concise high-level language for interactive visualization.",Uf="build/vega-lite.js",Wf="build/vega-lite.min.js",Bf="build/vega-lite.min.js",Hf="build/src/index",qf="build/src/index.d.ts",Gf={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},Vf={test:"test"},Xf=["bin","build","src","vega-lite*","tsconfig.json"],Yf={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",jest:"NODE_OPTIONS=--experimental-vm-modules npx jest",test:"yarn jest test/ && yarn lint && yarn schema && yarn jest examples/ && yarn test:runtime","test:cover":"yarn jest --collectCoverage test/","test:inspect":"node --inspect-brk --experimental-vm-modules ./node_modules/.bin/jest --runInBand test","test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"yarn jest --watch test/"},Kf={type:"git",url:"https://github.com/vega/vega-lite.git"},Qf="BSD-3-Clause",Zf={url:"https://github.com/vega/vega-lite/issues"},Jf={"@babel/core":"^7.16.0","@babel/preset-env":"^7.16.0","@babel/preset-typescript":"^7.16.0","@rollup/plugin-alias":"^3.1.8","@rollup/plugin-babel":"^5.3.0","@rollup/plugin-commonjs":"^21.0.1","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^13.0.6","@types/chai":"^4.2.22","@types/d3":"^7.1.0","@types/jest":"^27.0.2","@types/mkdirp":"^1.0.2","@types/pako":"^1.0.2","@typescript-eslint/eslint-plugin":"^5.4.0","@typescript-eslint/parser":"^5.4.0",ajv:"^8.8.0","ajv-formats":"^2.1.1",chai:"^4.3.4",cheerio:"^1.0.0-rc.10","conventional-changelog-cli":"^2.1.1",d3:"^7.1.1","del-cli":"^4.0.1",eslint:"^8.2.0","eslint-config-prettier":"^8.3.0","eslint-plugin-jest":"^25.2.4","eslint-plugin-prettier":"^4.0.0","gh-pages":"^3.2.3","highlight.js":"^11.3.1",jest:"^27.3.1","jest-dev-server":"^6.0.0",mkdirp:"^1.0.4",pako:"^2.0.4",prettier:"^2.4.1",puppeteer:"^11.0.0",rollup:"^2.60.0","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3","rollup-plugin-terser":"^7.0.2",serve:"^13.0.2",terser:"^5.10.0","ts-jest":"^27.0.7","ts-json-schema-generator":"^0.97.0",typescript:"~4.5.2","vega-cli":"^5.21.0","vega-datasets":"~2.2.0","vega-embed":"^6.20.2","vega-tooltip":"^0.27.0","yaml-front-matter":"^4.1.1"},ed={"@types/clone":"~2.1.1","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.3.1","vega-event-selector":"~3.0.0","vega-expression":"~5.0.0","vega-util":"~1.17.0",yargs:"~17.2.1"},td={vega:"^5.21.0"},nd={node:">=12"};var id={name:If,author:zf,version:Rf,collaborators:Lf,homepage:Df,description:Mf,main:Uf,unpkg:Wf,jsdelivr:Bf,module:Hf,types:qf,bin:Gf,directories:Vf,files:Xf,scripts:Yf,repository:Kf,license:Qf,bugs:Zf,devDependencies:Jf,dependencies:ed,peerDependencies:td,engines:nd};function Nr(e){return!!e.or}function Pr(e){return!!e.and}function Fr(e){return!!e.not}function vi(e,t){if(Fr(e))vi(e.not,t);else if(Pr(e))for(const n of e.and)vi(n,t);else if(Nr(e))for(const n of e.or)vi(n,t);else t(e)}function rn(e,t){return Fr(e)?{not:rn(e.not,t)}:Pr(e)?{and:e.and.map(n=>rn(n,t))}:Nr(e)?{or:e.or.map(n=>rn(n,t))}:t(e)}const Te=Ff,P=Pf;function na(e){throw new Error(e)}function sn(e,t){const n={};for(const i of t)en(e,i)&&(n[i]=e[i]);return n}function me(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>Cr(e)).join(",")})`};const M=Cr;function T(e){if(Y(e))return e;const t=F(e)?e:Cr(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function Ar(e){return e===!1||e===null}function I(e,t){return e.includes(t)}function It(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function Tr(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function ia(e,...t){for(const n of t)rd(e,n??{});return e}function rd(e,t){for(const n of y(t))$f(e,n,t[n],!0)}function Ie(e,t){const n=[],i={};let r;for(const s of e){if(r=t(s),r in i)continue;i[r]=1,n.push(s)}return n}function sd(e,t){const n=y(e),i=y(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function ra(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Ir(e,t){for(const n of e)if(t.has(n))return!0;return!1}function zr(e){const t=new Set;for(const n of e){const i=tn(n),r=i.map((o,a)=>a===0?o:`[${o}]`),s=r.map((o,a)=>r.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function Rr(e,t){return e===void 0||t===void 0?!0:Ir(zr(e),zr(t))}function L(e){return y(e).length===0}const y=Object.keys,ie=Object.values,pt=Object.entries;function Rn(e){return e===!0||e===!1}function q(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Ln(e,t){return Fr(e)?`!(${Ln(e.not,t)})`:Pr(e)?`(${e.and.map(n=>Ln(n,t)).join(") && (")})`:Nr(e)?`(${e.or.map(n=>Ln(n,t)).join(") || (")})`:t(e)}function Oi(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&Oi(e[n],t)&&delete e[n],L(e)}function Dn(e){return e.charAt(0).toUpperCase()+e.substr(1)}function Lr(e,t="datum"){const n=tn(e),i=[];for(let r=1;r<=n.length;r++){const s=`[${n.slice(0,r).map(z).join("][")}]`;i.push(`${t}${s}`)}return i.join(" && ")}function sa(e,t="datum"){return`${t}[${z(tn(e).join("."))}]`}function od(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Oe(e){return`${tn(e).map(od).join("\\.")}`}function zt(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Dr(e){return`${tn(e).join(".")}`}function on(e){return e?tn(e).length:0}function K(...e){for(const t of e)if(t!==void 0)return t;return}let oa=42;function aa(e){const t=++oa;return e?String(e)+t:t}function ad(){oa=42}function ca(e){return la(e)?e:`__${e}`}function la(e){return e.startsWith("__")}function Mn(e){return e===void 0?void 0:(e%360+360)%360}function xi(e){return Y(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}var Un=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const et="row",tt="column",_i="facet",G="x",J="y",we="x2",ze="y2",ht="xOffset",an="yOffset",Re="radius",nt="radius2",$e="theta",it="theta2",Le="latitude",De="longitude",Ee="latitude2",xe="longitude2",ue="color",Me="fill",Ue="stroke",fe="shape",rt="size",Rt="angle",st="opacity",mt="fillOpacity",bt="strokeOpacity",yt="strokeWidth",vt="strokeDash",Wn="text",Bn="order",Hn="detail",Si="key",Lt="tooltip",ji="href",wi="url",$i="description",cd={x:1,y:1,x2:1,y2:1},ua={theta:1,theta2:1,radius:1,radius2:1};function fa(e){return e in ua}const Mr={longitude:1,longitude2:1,latitude:1,latitude2:1};function ld(e){switch(e){case Le:return"y";case Ee:return"y2";case De:return"x";case xe:return"x2"}}function ud(e){return e in Mr}const fd=y(Mr),Ur=Object.assign(Object.assign(Object.assign(Object.assign({},cd),ua),Mr),{xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function cn(e){return e===ue||e===Me||e===Ue}const da={row:1,column:1,facet:1},_e=y(da),Wr=Object.assign(Object.assign({},Ur),da),dd=y(Wr),gd=Un(Wr,["order","detail","tooltip"]),pd=Un(gd,["row","column","facet"]);function hd(e){return!!pd[e]}function ga(e){return!!Wr[e]}const md=[we,ze,Ee,xe,it,nt];function pa(e){const t=Dt(e);return t!==e}function Dt(e){switch(e){case we:return G;case ze:return J;case Ee:return Le;case xe:return De;case it:return $e;case nt:return Re}return e}function Ot(e){if(fa(e))switch(e){case $e:return"startAngle";case it:return"endAngle";case Re:return"outerRadius";case nt:return"innerRadius"}return e}function ot(e){switch(e){case G:return we;case J:return ze;case Le:return Ee;case De:return xe;case $e:return it;case Re:return nt}return}function de(e){switch(e){case G:case we:return"width";case J:case ze:return"height"}return}function bd(e){switch(e){case G:return"xOffset";case J:return"yOffset";case we:return"x2Offset";case ze:return"y2Offset";case $e:return"thetaOffset";case Re:return"radiusOffset";case it:return"theta2Offset";case nt:return"radius2Offset"}return}function ha(e){switch(e){case G:return"xOffset";case J:return"yOffset"}return}function ma(e){switch(e){case"xOffset":return"x";case"yOffset":return"y"}}const yd=y(Ur),Br=Un(Ur,["x","y","x2","y2","xOffset","yOffset","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),vd=y(Br),Hr={x:1,y:1},We=y(Hr);function ne(e){return e in Hr}const qr={theta:1,radius:1},Od=y(qr);function Ei(e){return e==="width"?G:J}const ba={xOffset:1,yOffset:1};function ln(e){return e in ba}const ya=Un(Br,["text","tooltip","href","url","description","detail","key","order"]),xd=y(ya);function _d(e){return!!Br[e]}function Sd(e){switch(e){case ue:case Me:case Ue:case rt:case fe:case st:case yt:case vt:return!0;case mt:case bt:case Rt:return!1}}const va=Object.assign(Object.assign(Object.assign(Object.assign({},Hr),qr),ba),ya),ki=y(va);function xt(e){return!!va[e]}function jd(e,t){return $d(e)[t]}const Oa={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},wd=Un(Oa,["geoshape"]);function $d(e){switch(e){case ue:case Me:case Ue:case $i:case Hn:case Si:case Lt:case ji:case Bn:case st:case mt:case bt:case yt:case _i:case et:case tt:return Oa;case G:case J:case ht:case an:case Le:case De:return wd;case we:case ze:case Ee:case xe:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case rt:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case vt:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case fe:return{point:"always",geoshape:"always"};case Wn:return{text:"always"};case Rt:return{point:"always",square:"always",text:"always"};case wi:return{image:"always"};case $e:return{text:"always",arc:"always"};case Re:return{text:"always",arc:"always"};case it:case nt:return{arc:"always"}}}function Gr(e){switch(e){case G:case J:case $e:case Re:case ht:case an:case rt:case Rt:case yt:case st:case mt:case bt:case we:case ze:case it:case nt:return;case _i:case et:case tt:case fe:case vt:case Wn:case Lt:case ji:case wi:case $i:return"discrete";case ue:case Me:case Ue:return"flexible";case Le:case De:case Ee:case xe:case Hn:case Si:case Bn:return}}const Ed={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},kd={count:1,min:1,max:1};function at(e){return!!e&&!!e.argmin}function _t(e){return!!e&&!!e.argmax}function Vr(e){return F(e)&&!!Ed[e]}const Cd=new Set(["count","valid","missing","distinct"]);function xa(e){return F(e)&&Cd.has(e)}function Nd(e){return F(e)&&I(["min","max"],e)}const Pd=new Set(["count","sum","distinct","valid","missing"]),Fd=new Set(["mean","average","median","q1","q3","min","max"]);function _a(e){return zn(e)&&(e=Vi(e,void 0)),"bin"+y(e).map(t=>Ci(e[t])?q(`_${t}_${pt(e[t])}`):q(`_${t}_${e[t]}`)).join("")}function U(e){return e===!0||Mt(e)&&!e.binned}function oe(e){return e==="binned"||Mt(e)&&e.binned===!0}function Mt(e){return H(e)}function Ci(e){return e==null?void 0:e.param}function Sa(e){switch(e){case et:case tt:case rt:case ue:case Me:case Ue:case yt:case st:case mt:case bt:case fe:return 6;case vt:return 4;default:return 10}}function qn(e){return e&&!!e.expr}function ge(e){const t=y(e||{}),n={};for(const i of t)n[i]=be(e[i]);return n}var Ad=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ja(e){const{anchor:t,frame:n,offset:i,orient:r,angle:s,limit:o,color:a,subtitleColor:c,subtitleFont:l,subtitleFontSize:u,subtitleFontStyle:f,subtitleFontWeight:d,subtitleLineHeight:g,subtitlePadding:p}=e,m=Ad(e,["anchor","frame","offset","orient","angle","limit","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),h=Object.assign(Object.assign({},m),a?{fill:a}:{}),v=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),s!==void 0?{angle:s}:{}),o!==void 0?{limit:o}:{}),b=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},c?{subtitleColor:c}:{}),l?{subtitleFont:l}:{}),u?{subtitleFontSize:u}:{}),f?{subtitleFontStyle:f}:{}),d?{subtitleFontWeight:d}:{}),g?{subtitleLineHeight:g}:{}),p?{subtitlePadding:p}:{}),x=sn(e,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:h,subtitleMarkConfig:x,nonMarkTitleProperties:v,subtitle:b}}function St(e){return F(e)||j(e)&&F(e[0])}function w(e){return e&&!!e.signal}function jt(e){return!!e.step}function Td(e){return j(e)?!1:"fields"in e&&!("data"in e)}function Id(e){return j(e)?!1:"fields"in e&&"data"in e}function ct(e){return j(e)?!1:"field"in e&&"data"in e}const zd={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},Rd=y(zd),Ld={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Xr=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];var Yr=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function wa(e){const t=j(e.condition)?e.condition.map($a):$a(e.condition);return Object.assign(Object.assign({},be(e)),{condition:t})}function be(e){if(qn(e)){const{expr:t}=e,n=Yr(e,["expr"]);return Object.assign({signal:t},n)}return e}function $a(e){if(qn(e)){const{expr:t}=e,n=Yr(e,["expr"]);return Object.assign({signal:t},n)}return e}function B(e){if(qn(e)){const{expr:t}=e,n=Yr(e,["expr"]);return Object.assign({signal:t},n)}return w(e)?e:e!==void 0?{value:e}:void 0}function Dd(e){return w(e)?e.signal:z(e)}function Ea(e){return w(e)?e.signal:z(e.value)}function lt(e){return w(e)?e.signal:e==null?null:z(e)}function Md(e,t,n){for(const i of n){const r=Ut(i,t.markDef,t.config);r!==void 0&&(e[i]=B(r))}return e}function ka(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function R(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:s&&(!r||r===e)?void 0:Ut(e,t,n,i)}function Ut(e,t,n,{vgChannel:i}={}){return K(i?Ni(e,t,n.style):void 0,Ni(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function Ni(e,t,n){return Ca(e,ka(t),n)}function Ca(e,t,n){t=V(t);let i;for(const r of t){const s=n[r];s&&s[e]!==void 0&&(i=s[e])}return i}function Na(e,t){return V(e).reduce((n,i)=>{var r;return n.field.push(S(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function Pa(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Te(r,i))return;n.push(i)}),n}function Fa(e,t){return Te(e,t)||!t?e:e?[...V(e),...V(t)].join(", "):t}function Aa(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((St(n)||w(n))&&(St(i)||w(i)))return{explicit:e.explicit,value:Fa(n,i)};if(St(n)||w(n))return{explicit:e.explicit,value:n};if(St(i)||w(i))return{explicit:e.explicit,value:i};if(!St(n)&&!w(n)&&!St(i)&&!w(i))return{explicit:e.explicit,value:Pa(n,i)};throw new Error("It should never reach here")}function Kr(e){return`Invalid specification ${M(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Ud='Autosize "fit" only works for single views and layered views.';function Ta(e){const t=e=="width"?"Width":"Height";return`${t} "container" only works for single views and layered views.`}function Ia(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function za(e){return e?`Dropping "fit-${e}" because spec has discrete ${de(e)}.`:'Dropping "fit" because spec has discrete size.'}function Qr(e){return`Unknown field for ${e}. Cannot calculate view size.`}function Ra(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Wd(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Bd(e){return`The "nearest" transform is not supported for ${e} marks.`}function La(e){return`Selection not supported for ${e} yet.`}function Hd(e){return`Cannot find a selection named "${e}".`}const qd="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Gd="Legend bindings are only supported for selections over an individual field or encoding channel.";function Vd(e){return`Lookups can only be performed on selection parameters. "${e}" is a variable parameter.`}function Xd(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const Yd="The same selection must be used to override scale domains in a layered view.",Kd='Interval selections should be initialized using "x" and/or "y" keys.';function Qd(e){return`Unknown repeated value "${e}".`}function Da(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const Zd="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Jd(e){return`Unrecognized parse "${e}".`}function Ma(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const eg="Attempt to add the same child twice.";function tg(e){return`Ignoring an invalid transform: ${M(e)}.`}const ng='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function Ua(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function ig(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${M(t)} is overridden by a child projection ${M(n)}.`}const rg="Arc marks uses theta channel rather than angle, replacing angle with theta.";function sg(e){return`${e}Offset dropped because ${e} is continuous`}function og(e){return`There is no ${e} encoding. Replacing ${e}Offset encoding as ${e}.`}function ag(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${M(n)}}.`}function Wa(e){return`Invalid field type "${e}".`}function cg(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function lg(e){return`Invalid aggregation operator "${e}".`}function Ba(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function ug(e){return`Position range does not support relative band size for ${e}.`}function Zr(e,t){return`Dropping ${M(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const fg="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Pi(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function dg(e){return`${e} encoding has no scale, so specified scale is ignored.`}function gg(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function pg(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function hg(e){return`${e} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function mg(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function Jr(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function bg(e){return`The ${e} for range marks cannot be an expression`}function yg(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function vg(e,t){return`Specified orient "${e}" overridden with "${t}".`}function Og(e){return`Cannot use the scale property "${e}" with non-color channel.`}function xg(e){return`Cannot use the relative band size with ${e} scale.`}function _g(e){return`Using unaggregated domain with raw field has no effect (${M(e)}).`}function Sg(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function jg(e){return`Unaggregated domain is currently unsupported for log scale (${M(e)}).`}function wg(e){return`Cannot apply size to non-oriented mark "${e}".`}function $g(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Eg(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function Ha(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function qa(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function kg(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${M(n)} and ${M(i)}). Using ${M(n)}.`}function Cg(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${M(n)} and ${M(i)}). Using the union of the two domains.`}function Ng(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Pg(e){return`Dropping sort property ${M(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const Ga="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Fg="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Ag="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Tg="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function Ig(e){return`Cannot stack "${e}" if there is already "${e}2".`}function zg(e){return`Cannot stack non-linear scale (${e}).`}function Rg(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Fi(e,t){return`Invalid ${e}: ${M(t)}.`}function Lg(e){return`Dropping day from datetime ${M(e)} as day cannot be combined with other units.`}function Dg(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function Mg(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Ug(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Va(e){return`1D error band does not support ${e}.`}function Xa(e){return`Channel ${e} is required for "binned" bin.`}function Wg(e){return`Channel ${e} should not be used with "binned" bin.`}function Bg(e){return`Domain for ${e} is required for threshold scale.`}var JO=function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},ex=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)};const Ya=Ef(kf);let un=Ya;function Hg(e){return un=e,un}function qg(){return un=Ya,un}function O(...e){un.warn(...e)}function Gg(...e){un.debug(...e)}function Wt(e){if(e&&H(e)){for(const t of ts)if(t in e)return!0}return!1}const Ka=["january","february","march","april","may","june","july","august","september","october","november","december"],Vg=Ka.map(e=>e.substr(0,3)),Qa=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Xg=Qa.map(e=>e.substr(0,3));function Yg(e){if(xi(e)&&(e=+e),Y(e))return e>4&&O(Fi("quarter",e)),e-1;throw new Error(Fi("quarter",e))}function Kg(e){if(xi(e)&&(e=+e),Y(e))return e-1;{const t=e.toLowerCase(),n=Ka.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Vg.indexOf(i);if(r!==-1)return r;throw new Error(Fi("month",e))}}function Qg(e){if(xi(e)&&(e=+e),Y(e))return e%7;{const t=e.toLowerCase(),n=Qa.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Xg.indexOf(i);if(r!==-1)return r;throw new Error(Fi("day",e))}}function es(e,t){const n=[];if(t&&e.day!==void 0&&(y(e).length>1&&(O(Lg(e)),e=P(e),delete e.day)),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Kg(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Yg(e.quarter):e.quarter;n.push(Y(i)?i*3:`${i}*3`)}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Qg(e.day):e.day;n.push(Y(i)?i+1:`${i}+1`)}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function Gn(e){const t=es(e,!0),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Zg(e){const t=es(e,!1),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Jg(e){const t=es(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}var ep=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Za={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},ts=y(Za);function tp(e){return!!Za[e]}function ns(e){return e.startsWith("utc")}function np(e){return e.substr(3)}const ip={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function is(e){return ts.filter(t=>Ja(e,t))}function Ja(e,t){const n=e.indexOf(t);return n<0||(n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")?!1:!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function rp(e,t,{end:n}={end:!1}){const i=Lr(t),r=ns(e)?"utc":"";function s(c){return c==="quarter"?`(${r}quarter(${i})-1)`:`${r}${c}(${i})`}let o;const a={};for(const c of ts)Ja(e,c)&&(a[c]=s(c),o=c);return n&&(a[o]+="+1"),Zg(a)}function ec(e){if(!e)return;const t=is(e);return`timeUnitSpecifier(${M(t)}, ${M(ip)})`}function sp(e,t,n){if(!e)return;const i=ec(e),r=n||ns(e);return`${r?"utc":"time"}Format(${t}, ${i})`}function ae(e){if(!e)return;let t;return F(e)?t={unit:e}:H(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),ns(t.unit)&&(t.utc=!0,t.unit=np(t.unit)),t}function op(e){const t=ae(e),{utc:n}=t,i=ep(t,["utc"]);return i.unit?(n?"utc":"")+y(i).map(r=>q(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+y(i).map(r=>q(`_${r}_${i[r]}`)).join("")}function ap(e){return e==null?void 0:e.param}function rs(e){return e&&!!e.field&&e.equal!==void 0}function ss(e){return e&&!!e.field&&e.lt!==void 0}function os(e){return e&&!!e.field&&e.lte!==void 0}function as(e){return e&&!!e.field&&e.gt!==void 0}function cs(e){return e&&!!e.field&&e.gte!==void 0}function ls(e){if(e==null?void 0:e.field){if(j(e.range)&&e.range.length===2)return!0;if(w(e.range))return!0}return!1}function us(e){return e&&!!e.field&&(j(e.oneOf)||j(e.in))}function cp(e){return e&&!!e.field&&e.valid!==void 0}function tc(e){return us(e)||rs(e)||ls(e)||ss(e)||as(e)||os(e)||cs(e)}function Be(e,t){return Xi(e,{timeUnit:t,wrapTime:!0})}function lp(e,t){return e.map(n=>Be(n,t))}function nc(e,t=!0){var n;const{field:i}=e,r=(n=ae(e.timeUnit))===null||n===void 0?void 0:n.unit,s=r?`time(${rp(r,i)})`:S(e,{expr:"datum"});if(rs(e))return`${s}===${Be(e.equal,r)}`;if(ss(e)){const o=e.lt;return`${s}<${Be(o,r)}`}else if(as(e)){const o=e.gt;return`${s}>${Be(o,r)}`}else if(os(e)){const o=e.lte;return`${s}<=${Be(o,r)}`}else if(cs(e)){const o=e.gte;return`${s}>=${Be(o,r)}`}else{if(us(e))return`indexof([${lp(e.oneOf,r).join(",")}], ${s}) !== -1`;if(cp(e))return fs(s,e.valid);if(ls(e)){const{range:o}=e,a=w(o)?{signal:`${o.signal}[0]`}:o[0],c=w(o)?{signal:`${o.signal}[1]`}:o[1];if(a!==null&&c!==null&&t)return"inrange("+s+", ["+Be(a,r)+", "+Be(c,r)+"])";const l=[];return a!==null&&l.push(`${s} >= ${Be(a,r)}`),c!==null&&l.push(`${s} <= ${Be(c,r)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${M(e)}`)}function fs(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function up(e){var t;return tc(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=ae(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Vn={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function fp(e){return e==="quantitative"||e==="temporal"}function ic(e){return e==="ordinal"||e==="nominal"}const Bt=Vn.quantitative,ds=Vn.ordinal,fn=Vn.temporal,gs=Vn.nominal,dn=Vn.geojson;function dp(e){if(e){e=e.toLowerCase();switch(e){case"q":case Bt:return"quantitative";case"t":case fn:return"temporal";case"o":case ds:return"ordinal";case"n":case gs:return"nominal";case dn:return"geojson"}}return}var gp=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const pe={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},ps={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function pp(e,t){const n=ps[e],i=ps[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const hp={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function rc(e){return hp[e]}const sc=new Set(["linear","log","pow","sqrt","symlog"]),oc=new Set([...sc,"time","utc"]);function ac(e){return sc.has(e)}const cc=new Set(["quantile","quantize","threshold"]),mp=new Set([...oc,...cc,"sequential","identity"]),bp=new Set(["ordinal","bin-ordinal","point","band"]);function ee(e){return bp.has(e)}function ye(e){return mp.has(e)}function ke(e){return oc.has(e)}function gn(e){return cc.has(e)}const yp={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function vp(e){return!F(e)&&!!e.name}function lc(e){return e==null?void 0:e.param}function Op(e){return e&&e.unionWith}function xp(e){return ea(e)&&"field"in e}const _p={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Sp=gp(_p,["type","domain","range","rangeMax","rangeMin","scheme"]),jp=y(Sp);function hs(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return ke(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return ke(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return ke(e);case"nice":return ke(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return ye(e)&&!I(["log","time","utc","threshold","quantile"],e)}}function uc(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return cn(e)?void 0:Og(e);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function wp(e,t){return I([ds,gs],t)?e===void 0||ee(e):t===fn?I([pe.TIME,pe.UTC,void 0],e):t===Bt?ac(e)||gn(e)||e===void 0:!0}function $p(e,t,n=!1){if(!xt(e))return!1;switch(e){case G:case J:case ht:case an:case $e:case Re:return ke(t)||t==="band"?!0:t==="point"?!n:!1;case rt:case yt:case st:case mt:case bt:case Rt:return ke(t)||gn(t)||I(["band","point","ordinal"],t);case ue:case Me:case Ue:return t!=="band";case vt:case fe:return t==="ordinal"||gn(t)}}const ce={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},fc=ce.arc,Ai=ce.area,Ti=ce.bar,Ep=ce.image,Ii=ce.line,zi=ce.point,kp=ce.rect,Ri=ce.rule,dc=ce.text,ms=ce.tick,Cp=ce.trail,bs=ce.circle,ys=ce.square,gc=ce.geoshape;function wt(e){return["line","area","trail"].includes(e)}function pc(e){return["rect","bar","image","arc"].includes(e)}const Np=new Set(y(ce));function He(e){return e.type}const Pp=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],Fp=["fill","fillOpacity"],Ap=[...Pp,...Fp],Tp={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},hc=y(Tp),Ip={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},zp={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},Rp={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},mc=y(Rp);function pn(e){return e&&e.band!=null}const Lp={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},bc=5,Dp={binSpacing:1,continuousBandSize:bc,timeUnitBandPosition:.5},Mp={binSpacing:0,continuousBandSize:bc,timeUnitBandPosition:.5},Up={thickness:1};function Wp(e){return He(e)?e.type:e}function vs(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:s}=e,o=xs(e);return _(n)&&!xa(n.aggregate)&&r&&ke(r.get("type"))?Bp({fieldDef:n,channel:t,markDef:i,ref:o,config:s}):o}function Bp({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){if(wt(n.type))return i;const s=R("invalid",n,r);return s===null?[Hp(e,t),i]:i}function Hp(e,t){const n=Os(e,!0),i=Dt(t),r=i==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function Os(e,t=!0){return fs(F(e)?e:S(e,{expr:"datum"}),!t)}function qp(e){const{datum:t}=e;return Wt(t)?Gn(t):`${M(t)}`}function Ht(e,t,n,i){const r={};if(t&&(r.scale=t),Ge(e)){const{datum:s}=e;Wt(s)?r.signal=Gn(s):w(s)?r.signal=s.signal:qn(s)?r.signal=s.expr:r.value=s}else r.field=S(e,n);if(i){const{offset:s,band:o}=i;s&&(r.offset=s),o&&(r.band=o)}return r}function Li({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,bandPosition:s=.5}){const o=0<s&&s<1?"datum":void 0,a=S(t,{expr:o,suffix:r}),c=n!==void 0?S(n,{expr:o}):S(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const u=s===0?a:c;l.field=u}else{const u=w(s)?`${s.signal} * ${a} + (1-${s.signal}) * ${c}`:`${s} * ${a} + ${1-s} * ${c}`;l.signal=`scale("${e}", ${u})`}return i&&(l.offset=i),l}function xs({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l,bandPosition:u}){var f;if(t){if(k(t)){const d=o==null?void 0:o.get("type");if(Se(t)){u??(u=Cc({fieldDef:t,fieldDef2:n,markDef:i,config:r}));const{bin:g,timeUnit:p,type:m}=t;if(U(g)||u&&p&&m===fn)return(a==null?void 0:a.impute)?Ht(t,s,{binSuffix:"mid"},{offset:c}):u&&!ee(d)?Li({scaleName:s,fieldOrDatumDef:t,bandPosition:u,offset:c}):Ht(t,s,Qn(t,e)?{binSuffix:"range"}:{},{offset:c});if(oe(g)){if(_(n))return Li({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:u,offset:c});{const h=e===G?we:ze;O(Xa(h))}}}return Ht(t,s,ee(d)?{binSuffix:"range"}:{},{offset:c,band:d==="band"?(f=u??t.bandPosition)!==null&&f!==void 0?f:.5:void 0})}else if(Ce(t)){const d=t.value,g=c?{offset:c}:{};return Object.assign(Object.assign({},Xn(e,d)),g)}}return Cf(l)&&(l=l()),l&&Object.assign(Object.assign({},l),c?{offset:c}:{})}function Xn(e,t){return I(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:I(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:B(t)}function qt(e){return e&&e!=="number"&&e!=="time"}function yc(e,t,n){return`${e}(${t}${n?`, ${M(n)}`:""})`}const Gp=" \u2013 ";function _s({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){var o,a;if(qt(n))return Ss({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const c=vc(e,i,r);if(bn(e)){const l=Xp(c,_(e)?(o=ae(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,s.timeFormat,Gt(e)&&((a=e.scale)===null||a===void 0?void 0:a.type)===pe.UTC);return l?{signal:l}:void 0}if(t=_c(Es(e),t,s),_(e)&&U(e.bin)){const l=S(e,{expr:i,binSuffix:"end"});return{signal:Di(c,l,t,n,s)}}else return t||Es(e)==="quantitative"?{signal:`${Sc(c,t)}`}:{signal:`isValid(${c}) ? ${c} : ""+${c}`}}function vc(e,t,n){return _(e)?n?`${S(e,{expr:t,suffix:"end"})}-${S(e,{expr:t,suffix:"start"})}`:S(e,{expr:t}):qp(e)}function Ss({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){if(o??(o=vc(e,i,r)),_(e)&&U(e.bin)){const a=S(e,{expr:i,binSuffix:"end"});return{signal:Di(o,a,t,n,s)}}return{signal:yc(n,o,t)}}function Oc(e,t,n,i,r,s){var o;if(qt(i))return;if(bn(e)){const a=_(e)?(o=ae(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return Vp(n,a,r,s)}return _c(t,n,r)}function xc(e,t,n){return e&&(w(e)||e==="number"||e==="time")?e:bn(t)&&n!=="time"&&n!=="utc"?"time":void 0}function _c(e,t,n){return F(t)?t:e===Bt?n.numberFormat:void 0}function Vp(e,t,n,i){return e||(t?{signal:ec(t)}:i?void 0:n.timeFormat)}function Sc(e,t){return`format(${e}, "${t||""}")`}function jc(e,t,n,i){var r;return qt(n)?yc(n,e,t):Sc(e,(r=F(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function Di(e,t,n,i,r){const s=jc(e,n,i,r),o=jc(t,n,i,r);return`${fs(e,!1)} ? "null" : ${s} + "${Gp}" + ${o}`}function Xp(e,t,n,i,r){return!t||n?(n=F(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):sp(t,e,r)}const Mi="min",Yp={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function wc(e){return e in Yp}function $c(e){return!!e&&!!e.encoding}function qe(e){return!!e&&(e.op==="count"||!!e.field)}function Ec(e){return!!e&&j(e)}function Yn(e){return"row"in e||"column"in e}function js(e){return!!e&&"header"in e}function Ui(e){return"facet"in e}var ws=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Kp(e){return e.param}function Qp(e){return e&&!F(e)&&"repeat"in e}function kc(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function $s(e){return"sort"in e}function Cc({fieldDef:e,fieldDef2:t,markDef:n,config:i}){if(k(e)&&e.bandPosition!==void 0)return e.bandPosition;if(_(e)){const{timeUnit:r,bin:s}=e;if(r&&!t)return pc(n.type)?0:Ut("timeUnitBandPosition",n,i);if(U(s))return .5}return}function Nc({channel:e,fieldDef:t,fieldDef2:n,markDef:i,config:r,scaleType:s,useVlSizeChannel:o}){var a,c,l;const u=de(e),f=R(o?"size":u,i,r,{vgChannel:u});if(f!==void 0)return f;if(_(t)){const{timeUnit:d,bin:g}=t;if(d&&!n)return{band:Ut("timeUnitBandSize",i,r)};if(U(g)&&!ee(s))return{band:1}}return pc(i.type)?s?ee(s)?((a=r[i.type])===null||a===void 0?void 0:a.discreteBandSize)||{band:1}:(c=r[i.type])===null||c===void 0?void 0:c.continuousBandSize:(l=r[i.type])===null||l===void 0?void 0:l.discreteBandSize:void 0}function Pc(e,t,n,i){return U(e.bin)||e.timeUnit&&Se(e)&&e.type==="temporal"?Cc({fieldDef:e,fieldDef2:t,markDef:n,config:i})!==void 0:!1}function Wi(e){return e&&"condition"in e}function Bi(e){const t=e&&e.condition;return!!t&&!j(t)&&_(t)}function Kn(e){const t=e&&e.condition;return!!t&&!j(t)&&k(t)}function Zp(e){const t=e&&e.condition;return!!t&&(j(t)||Ce(t))}function _(e){return e&&(!!e.field||e.aggregate==="count")}function Es(e){return e&&e.type}function Ge(e){return e&&"datum"in e}function Ve(e){return Se(e)&&!Hi(e)||ks(e)}function ks(e){return Ge(e)&&Y(e.datum)}function k(e){return _(e)||Ge(e)}function Se(e){return e&&("field"in e||e.aggregate==="count")&&"type"in e}function Ce(e){return e&&"value"in e&&"value"in e}function Gt(e){return e&&("scale"in e||"sort"in e)}function Cs(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function Fc(e){return e&&"legend"in e}function Ac(e){return e&&("format"in e||"formatType"in e)}function Jp(e){return me(e,["legend","axis","header","scale"])}function eh(e){return"op"in e}function S(e,t={}){var n,i,r;let s=e.field;const o=t.prefix;let a=t.suffix,c="";if(nh(e))s=ca("count");else{let l;if(!t.nofn)if(eh(e))l=e.op;else{const{bin:u,aggregate:f,timeUnit:d}=e;U(u)?(l=_a(u),a=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?_t(f)?(c=`["${s}"]`,s=`argmax_${f.argmax}`):at(f)?(c=`["${s}"]`,s=`argmin_${f.argmin}`):l=String(f):d&&(l=op(d),a=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}l&&(s=s?`${l}_${s}`:l)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),t.forAs?Dr(s):t.expr?sa(s,t.expr)+c:Oe(s)+c}function Hi(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return _(e)&&!!e.bin;case"temporal":return!1}throw new Error(Wa(e.type))}function th(e){var t;return Gt(e)&&gn((t=e.scale)===null||t===void 0?void 0:t.type)}function nh(e){return e.aggregate==="count"}function ih(e,t){var n;const{field:i,bin:r,timeUnit:s,aggregate:o}=e;if(o==="count")return t.countTitle;if(U(r))return`${i} (binned)`;if(s){const a=(n=ae(s))===null||n===void 0?void 0:n.unit;if(a)return`${i} (${is(a).join("-")})`}else if(o)return _t(o)?`${i} for max ${o.argmax}`:at(o)?`${i} for min ${o.argmin}`:`${Dn(o)} of ${i}`;return i}function rh(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(_t(t))return`${r} for argmax(${t.argmax})`;if(at(t))return`${r} for argmin(${t.argmin})`;const s=ae(i),o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||U(n)&&"bin";return o?`${o.toUpperCase()}(${r})`:r}const Tc=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return rh(e);default:return ih(e,t)}};let Ic=Tc;function zc(e){Ic=e}function sh(){zc(Tc)}function hn(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,s;const o=(r=Ns(e))===null||r===void 0?void 0:r.title;if(!_(e))return o??e.title;const a=e,c=i?Ps(a,t):void 0;return n?K(o,a.title,c):(s=o??a.title)!==null&&s!==void 0?s:c}function Ns(e){return Cs(e)&&e.axis?e.axis:Fc(e)&&e.legend?e.legend:js(e)&&e.header?e.header:void 0}function Ps(e,t){return Ic(e,t)}function qi(e){var t;if(Ac(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=Ns(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function oh(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if($s(e)&&j(e.sort))return"ordinal";const{aggregate:i,bin:r,timeUnit:s}=e;if(s)return"temporal";if(r||i&&!_t(i)&&!at(i))return"quantitative";if(Gt(e)&&((n=e.scale)===null||n===void 0?void 0:n.type))switch(ps[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Xe(e){return _(e)?e:Bi(e)?e.condition:void 0}function Z(e){return k(e)?e:Kn(e)?e.condition:void 0}function Rc(e,t,n,i={}){if(F(e)||Y(e)||zn(e)){const r=F(e)?"string":Y(e)?"number":"boolean";return O(ag(t,r,e)),{value:e}}return k(e)?Gi(e,t,n,i):Kn(e)?Object.assign(Object.assign({},e),{condition:Gi(e.condition,t,n,i)}):e}function Gi(e,t,n,i){if(Ac(e)){const{format:r,formatType:s}=e,o=ws(e,["format","formatType"]);if(qt(s)&&!n.customFormatTypes)return O(Ua(t)),Gi(o,t,n,i)}else{const r=Cs(e)?"axis":Fc(e)?"legend":js(e)?"header":null;if(r&&e[r]){const s=e[r],{format:o,formatType:a}=s,c=ws(s,["format","formatType"]);if(qt(a)&&!n.customFormatTypes)return O(Ua(t)),Gi(Object.assign(Object.assign({},e),{[r]:c}),t,n,i)}}return _(e)?Fs(e,t,i):ah(e)}function ah(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Y(n)?"quantitative":F(n)?"nominal":Wt(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function Fs(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:o}=e,a=Object.assign({},e);if(!n&&i&&!Vr(i)&&!_t(i)&&!at(i)&&(O(lg(i)),delete a.aggregate),r&&(a.timeUnit=ae(r)),o&&(a.field=`${o}`),U(s)&&(a.bin=Vi(s,t)),oe(s)&&!ne(t)&&O(Wg(t)),Se(a)){const{type:c}=a,l=dp(c);c!==l&&(a.type=l),c!=="quantitative"&&(xa(i)&&(O(cg(c,i)),a.type="quantitative"))}else if(!pa(t)){const c=oh(a,t);a.type=c}if(Se(a)){const{compatible:c,warning:l}=ch(a,t)||{};c===!1&&O(l)}if($s(a)&&F(a.sort)){const{sort:c}=a;if(wc(c))return Object.assign(Object.assign({},a),{sort:{encoding:c}});const l=c.substr(1);if(c.charAt(0)==="-"&&wc(l))return Object.assign(Object.assign({},a),{sort:{encoding:l,order:"descending"}})}if(js(a)){const{header:c}=a;if(c){const{orient:l}=c,u=ws(c,["orient"]);if(l)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},u),{labelOrient:c.labelOrient||l,titleOrient:c.titleOrient||l})})}}return a}function Vi(e,t){return zn(e)?{maxbins:Sa(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:Sa(t)}):e}const mn={compatible:!0};function ch(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case et:case tt:case _i:return Hi(e)?mn:{compatible:!1,warning:pg(t)};case G:case J:case ht:case an:case ue:case Me:case Ue:case Wn:case Hn:case Si:case Lt:case ji:case wi:case Rt:case $e:case Re:case $i:return mn;case De:case xe:case Le:case Ee:return n!==Bt?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:mn;case st:case mt:case bt:case yt:case rt:case it:case nt:case we:case ze:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:mn;case fe:case vt:return!Hi(e)&&!th(e)?{compatible:!1,warning:hg(t)}:mn;case Bn:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:mn}}function bn(e){const{formatType:t}=qi(e);return t==="time"||!t&&lh(e)}function lh(e){return e&&(e.type==="temporal"||_(e)&&!!e.timeUnit)}function Xi(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var s;const o=t&&((s=ae(t))===null||s===void 0?void 0:s.unit);let a=o||n==="temporal",c;return qn(e)?c=e.expr:w(e)?c=e.signal:Wt(e)?(a=!0,c=Gn(e)):(F(e)||Y(e))&&(a&&(c=`datetime(${M(e)})`,tp(o)&&((Y(e)&&e<1e4||F(e)&&isNaN(Date.parse(e)))&&(c=Gn({[o]:e}))))),c?i&&a?`time(${c})`:c:r?void 0:M(e)}function Lc(e,t){const{type:n}=e;return t.map(i=>{const r=Xi(i,{timeUnit:_(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function Qn(e,t){return U(e.bin)?xt(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const Dc={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function Zn(e){return e&&e.condition}const Mc=["domain","grid","labels","ticks","title"],uh={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Uc={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},fh=Object.assign(Object.assign({},Uc),{style:1,labelExpr:1,encoding:1});function Wc(e){return!!fh[e]}const dh={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},Bc=y(dh);function ut(e){return"mark"in e}class Yi{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return ut(t)?Wp(t.mark)===this.name:!1}}var gh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Vt(e,t){const n=e&&e[t];return n?j(n)?It(n,i=>!!i.field):_(n)||Bi(n):!1}function Hc(e,t){const n=e&&e[t];return n?j(n)?It(n,i=>!!i.field):_(n)||Ge(n)||Kn(n):!1}function As(e,t){if(ne(t)){const n=e[t];if((_(n)||Ge(n))&&ic(n.type)){const i=ha(t);return Hc(e,i)}}return!1}function Ts(e){return It(dd,t=>{if(Vt(e,t)){const n=e[t];if(j(n))return It(n,i=>!!i.aggregate);{const i=Xe(n);return i&&!!i.aggregate}}return!1})}function qc(e,t){const n=[],i=[],r=[],s=[],o={};return Is(e,(a,c)=>{if(_(a)){const{field:l,aggregate:u,bin:f,timeUnit:d}=a,g=gh(a,["field","aggregate","bin","timeUnit"]);if(u||d||f){const p=Ns(a),m=p==null?void 0:p.title;let h=S(a,{forAs:!0});const v=Object.assign(Object.assign(Object.assign({},m?[]:{title:hn(a,t,{allowDisabling:!0})}),g),{field:h});if(u){let b;if(_t(u)?(b="argmax",h=S({op:"argmax",field:u.argmax},{forAs:!0}),v.field=`${h}.${l}`):at(u)?(b="argmin",h=S({op:"argmin",field:u.argmin},{forAs:!0}),v.field=`${h}.${l}`):u!=="boxplot"&&u!=="errorbar"&&u!=="errorband"&&(b=u),b){const x={op:b,as:h};l&&(x.field=l),s.push(x)}}else if(n.push(h),Se(a)&&U(f)){if(i.push({bin:f,field:l,as:h}),n.push(S(a,{binSuffix:"end"})),Qn(a,c)&&n.push(S(a,{binSuffix:"range"})),ne(c)){const b={field:`${h}_end`};o[`${c}2`]=b}v.bin="binned",pa(c)||(v.type=Bt)}else if(d){r.push({timeUnit:d,field:l,as:h});const b=Se(a)&&a.type!==fn&&"time";b&&(c===Wn||c===Lt?v.formatType=b:_d(c)?v.legend=Object.assign({formatType:b},v.legend):ne(c)&&(v.axis=Object.assign({formatType:b},v.axis)))}o[c]=v}else n.push(l),o[c]=e[c]}else o[c]=e[c]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function ph(e,t,n){const i=jd(t,n);if(i){if(i==="binned"){const r=e[t===we?G:J];return!!(_(r)&&_(e[t])&&oe(r.bin))}}else return!1;return!0}function hh(e,t,n,i){const r={};for(const s of y(e))ga(s)||O(gg(s));for(let s of yd){if(!e[s])continue;const o=e[s];if(ln(s)){const a=ma(s),c=r[a];if(_(c)){if(fp(c.type)&&_(o)){O(sg(a));continue}}else s=a,O(og(a))}if(s==="angle"&&t==="arc"&&!e.theta&&(O(rg),s=$e),!ph(e,s,t)){O(Pi(s,t));continue}if(s===rt&&t==="line"){const a=Xe(e[s]);if(a==null?void 0:a.aggregate){O(fg);continue}}if(s===ue&&(n?"fill"in e:"stroke"in e)){O(Ba("encoding",{fill:"fill"in e,stroke:"stroke"in e}));continue}if(s===Hn||s===Bn&&!j(o)&&!Ce(o)||s===Lt&&j(o))o&&(r[s]=V(o).reduce((a,c)=>(_(c)?a.push(Fs(c,s)):O(Zr(c,s)),a),[]));else{if(s===Lt&&o===null)r[s]=null;else if(!_(o)&&!Ge(o)&&!Ce(o)&&!Wi(o)&&!w(o)){O(Zr(o,s));continue}r[s]=Rc(o,s,i)}}return r}function Ki(e,t){const n={};for(const i of y(e)){const r=Rc(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function mh(e){const t=[];for(const n of y(e))if(Vt(e,n)){const i=e[n],r=V(i);for(const s of r)_(s)?t.push(s):Bi(s)&&t.push(s.condition)}return t}function Is(e,t,n){if(!e)return;for(const i of y(e)){const r=e[i];if(j(r))for(const s of r)t.call(n,s,i);else t.call(n,r,i)}}function bh(e,t,n,i){return e?y(e).reduce((r,s)=>{const o=e[s];return j(o)?o.reduce((a,c)=>t.call(i,a,c,s),r):t.call(i,r,o,s)},n):n}function Gc(e,t){return y(t).reduce((n,i)=>{switch(i){case G:case J:case ji:case $i:case wi:case we:case ze:case ht:case an:case $e:case it:case Re:case nt:case Le:case De:case Ee:case xe:case Wn:case fe:case Rt:case Lt:return n;case Bn:if(e==="line"||e==="trail")return n;case Hn:case Si:{const r=t[i];if(j(r)||_(r))for(const s of V(r))s.aggregate||n.push(S(s,{}));return n}case rt:if(e==="trail")return n;case ue:case Me:case Ue:case st:case mt:case bt:case vt:case yt:{const r=Xe(t[i]);return r&&!r.aggregate&&n.push(S(r,{})),n}}},[])}var Vc=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function yh(e){const{tooltip:t}=e,n=Vc(e,["tooltip"]);if(!t)return{filteredEncoding:n};let i,r;if(j(t)){for(const s of t)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return j(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function zs(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:o,titlePrefix:a})=>{const c=i?` of ${Rs(t)}`:"";return{field:o+t.field,type:t.type,title:w(a)?{signal:`${a}"${escape(c)}"`}:a+c}}),s=mh(n).map(Jp);return{tooltip:[...r,...Ie(s,T)]}}function Rs(e){const{title:t,field:n}=e;return K(t,n)}function Ls(e,t,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:c,positionPrefix:l,endPositionPrefix:u=void 0,extraEncoding:f={}})=>{const d=Rs(n);return Xc(e,a,r,{mark:c,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:`${l}_${n.field}`,type:n.type},d!==void 0?{title:d}:{}),s!==void 0?{scale:s}:{}),o!==void 0?{axis:o}:{})},F(u)?{[`${t}2`]:{field:`${u}_${n.field}`}}:{}),i),f)})}}function Xc(e,t,n,i){const{clip:r,color:s,opacity:o}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),r?{clip:r}:{}),s?{color:s}:{}),o?{opacity:o}:{}),He(i.mark)?i.mark:{type:i.mark}),{style:`${a}-${t}`}),zn(e[t])?{}:e[t])})]:[]}function Yc(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",s=i[r],o=i[`${r}2`],a=i[`${r}Error`],c=i[`${r}Error2`];return{continuousAxisChannelDef:Qi(s,n),continuousAxisChannelDef2:Qi(o,n),continuousAxisChannelDefError:Qi(a,n),continuousAxisChannelDefError2:Qi(c,n),continuousAxis:r}}function Qi(e,t){if(e==null?void 0:e.aggregate){const{aggregate:n}=e,i=Vc(e,["aggregate"]);return n!==t&&O(Ug(n,t)),i}else return e}function Kc(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(He(n)&&n.orient)return n.orient;if(Ve(r)){if(Ve(s)){const o=_(r)&&r.aggregate,a=_(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return bn(s)&&!bn(r)?"horizontal":"vertical"}return"horizontal"}else{if(Ve(s))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}var Zi=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ji="boxplot",vh=["box","median","outliers","rule","ticks"],Oh=new Yi(Ji,Zc);function Qc(e){return Y(e)?"tukey":e}function Zc(e,{config:t}){var n,i;e=Object.assign(Object.assign({},e),{encoding:Ki(e.encoding,t)});const{mark:r,encoding:s,params:o,projection:a}=e,c=Zi(e,["mark","encoding","params","projection"]),l=He(r)?r:{type:r};o&&O(La("boxplot"));const u=(n=l.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=R("size",l,t),d=Qc(u),{bins:g,timeUnits:p,transform:m,continuousAxisChannelDef:h,continuousAxis:v,groupby:b,aggregate:x,encodingWithoutContinuousAxis:$,ticksOrient:N,boxOrient:C,customTooltipWithoutAggregatedField:E}=xh(e,u,t),{color:A,size:X}=$,Ae=Zi($,["color","size"]),di=wf=>Ls(l,v,h,wf,t.boxplot),Je=di(Ae),Ho=di($),kr=di(Object.assign(Object.assign({},Ae),X?{size:X}:{})),Fn=zs([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],h,$),gi={type:"tick",color:"black",opacity:1,orient:N,invalid:null,aria:!1},Jt=d==="min-max"?Fn:zs([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],h,$),pi=[...Je({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:Jt}),...Je({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:Jt}),...Je({partName:"ticks",mark:gi,positionPrefix:"lower_whisker",extraEncoding:Jt}),...Je({partName:"ticks",mark:gi,positionPrefix:"upper_whisker",extraEncoding:Jt})],An=[...d!=="tukey"?pi:[],...Ho({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:C,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:Fn}),...kr({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},H(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:N,aria:!1}),positionPrefix:"mid_box",extraEncoding:Fn})];if(d==="min-max")return Object.assign(Object.assign({},c),{transform:((i=c.transform)!==null&&i!==void 0?i:[]).concat(m),layer:An});const Tn=`datum["lower_box_${h.field}"]`,In=`datum["upper_box_${h.field}"]`,hi=`(${In} - ${Tn})`,qo=`${Tn} - ${u} * ${hi}`,Go=`${In} + ${u} * ${hi}`,mi=`datum["${h.field}"]`,_f={joinaggregate:Jc(h.field),groupby:b},Vo={transform:[{filter:`(${qo} <= ${mi}) && (${mi} <= ${Go})`},{aggregate:[{op:"min",field:h.field,as:`lower_whisker_${h.field}`},{op:"max",field:h.field,as:`upper_whisker_${h.field}`},{op:"min",field:`lower_box_${h.field}`,as:`lower_box_${h.field}`},{op:"max",field:`upper_box_${h.field}`,as:`upper_box_${h.field}`},...x],groupby:b}],layer:pi},Sf=Zi(Ae,["tooltip"]),{scale:Xo,axis:jf}=h,Yo=Rs(h),Ko=me(jf,["title"]),Qo=Xc(l,"outliers",t.boxplot,{transform:[{filter:`(${mi} < ${qo}) || (${mi} > ${Go})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[v]:Object.assign(Object.assign(Object.assign({field:h.field,type:h.type},Yo!==void 0?{title:Yo}:{}),Xo!==void 0?{scale:Xo}:{}),L(Ko)?{}:{axis:Ko})},Sf),A?{color:A}:{}),E?{tooltip:E}:{})})[0];let bi;const Zo=[...g,...p,_f];return Qo?bi={transform:Zo,layer:[Qo,Vo]}:(bi=Vo,bi.transform.unshift(...Zo)),Object.assign(Object.assign({},c),{layer:[bi,{transform:m,layer:An}]})}function Jc(e){return[{op:"q1",field:e,as:`lower_box_${e}`},{op:"q3",field:e,as:`upper_box_${e}`}]}function xh(e,t,n){const i=Kc(e,Ji),{continuousAxisChannelDef:r,continuousAxis:s}=Yc(e,i,Ji),o=r.field,a=Qc(t),c=[...Jc(o),{op:"median",field:o,as:`mid_box_${o}`},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:`iqr_${o}`},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:`upper_whisker_${o}`},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:`lower_whisker_${o}`}],u=e.encoding,f=s,d=u[f],g=Zi(u,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:m}=yh(g),{bins:h,timeUnits:v,aggregate:b,groupby:x,encoding:$}=qc(m,n),N=i==="vertical"?"horizontal":"vertical",C=i,E=[...h,...v,{aggregate:[...b,...c],groupby:x},...l];return{bins:h,timeUnits:v,transform:E,groupby:x,aggregate:b,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:$,ticksOrient:N,boxOrient:C,customTooltipWithoutAggregatedField:p}}var el=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ds="errorbar",_h=["ticks","rule"],Sh=new Yi(Ds,tl);function tl(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Ki(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:c,tooltipEncoding:l}=nl(e,Ds,t);delete s.size;const u=Ls(a,r,i,s,t.errorbar),f=a.thickness,d=a.size,g=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},f!==void 0?{thickness:f}:{}),d!==void 0?{size:d}:{}),p=[...u({partName:"ticks",mark:g,positionPrefix:"lower",extraEncoding:l}),...u({partName:"ticks",mark:g,positionPrefix:"upper",extraEncoding:l}),...u({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},f!==void 0?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},c),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function jh(e,t){const{encoding:n}=e;if(wh(n))return{orient:Kc(e,t),inputType:"raw"};const i=$h(n),r=Eh(n),s=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,c=n.y2;if(k(a)&&k(c))throw new Error(`${t} cannot have both x2 and y2`);if(k(a)){if(Ve(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(k(c)){if(Ve(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,c=n.xError2,l=n.yError,u=n.yError2;if(k(c)&&!k(a))throw new Error(`${t} cannot have xError2 without xError`);if(k(u)&&!k(l))throw new Error(`${t} cannot have yError2 without yError`);if(k(a)&&k(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(k(a)){if(Ve(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(k(l)){if(Ve(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function wh(e){return(k(e.x)||k(e.y))&&!k(e.x2)&&!k(e.y2)&&!k(e.xError)&&!k(e.xError2)&&!k(e.yError)&&!k(e.yError2)}function $h(e){return k(e.x2)||k(e.y2)}function Eh(e){return k(e.xError)||k(e.xError2)||k(e.yError)||k(e.yError2)}function nl(e,t,n){var i;const{mark:r,encoding:s,params:o,projection:a}=e,c=el(e,["mark","encoding","params","projection"]),l=He(r)?r:{type:r};o&&O(La(t));const{orient:u,inputType:f}=jh(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:g,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:h}=Yc(e,u,t),{errorBarSpecificAggregate:v,postAggregateCalculates:b,tooltipSummary:x,tooltipTitleWithFieldName:$}=kh(l,d,g,p,m,f,t,n),N=s,C=h,E=N[C],A=h==="x"?"x2":"y2",X=N[A],Ae=h==="x"?"xError":"yError",di=N[Ae],Je=h==="x"?"xError2":"yError2",Ho=N[Je],kr=el(N,[typeof C=="symbol"?C:C+"",typeof A=="symbol"?A:A+"",typeof Ae=="symbol"?Ae:Ae+"",typeof Je=="symbol"?Je:Je+""]),{bins:Fn,timeUnits:gi,aggregate:Jt,groupby:pi,encoding:An}=qc(kr,n),Tn=[...Jt,...v],In=f!=="raw"?[]:pi,hi=zs(x,d,An,$);return{transform:[...(i=c.transform)!==null&&i!==void 0?i:[],...Fn,...gi,...Tn.length===0?[]:[{aggregate:Tn,groupby:In}],...b],groupby:In,continuousAxisChannelDef:d,continuousAxis:h,encodingWithoutContinuousAxis:An,ticksOrient:u==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:c,tooltipEncoding:hi}}function kh(e,t,n,i,r,s,o,a){let c=[],l=[];const u=t.field;let f,d=!1;if(s==="raw"){const g=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,p=e.extent?e.extent:g==="mean"?"stderr":"iqr";if(g==="median"!==(p==="iqr")&&O(Mg(g,p,o)),p==="stderr"||p==="stdev")c=[{op:p,field:u,as:`extent_${u}`},{op:g,field:u,as:`center_${u}`}],l=[{calculate:`datum["center_${u}"] + datum["extent_${u}"]`,as:`upper_${u}`},{calculate:`datum["center_${u}"] - datum["extent_${u}"]`,as:`lower_${u}`}],f=[{fieldPrefix:"center_",titlePrefix:Dn(g)},{fieldPrefix:"upper_",titlePrefix:il(g,p,"+")},{fieldPrefix:"lower_",titlePrefix:il(g,p,"-")}],d=!0;else{let m,h,v;p==="ci"?(m="mean",h="ci0",v="ci1"):(m="median",h="q1",v="q3"),c=[{op:h,field:u,as:`lower_${u}`},{op:v,field:u,as:`upper_${u}`},{op:m,field:u,as:`center_${u}`}],f=[{fieldPrefix:"upper_",titlePrefix:hn({field:u,aggregate:v,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:hn({field:u,aggregate:h,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:hn({field:u,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&O(Dg(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:`upper_${u}`},{calculate:`datum["${u}"]`,as:`lower_${u}`}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:u}],l=[{calculate:`datum["${u}"] + datum["${i.field}"]`,as:`upper_${u}`}],r?l.push({calculate:`datum["${u}"] + datum["${r.field}"]`,as:`lower_${u}`}):l.push({calculate:`datum["${u}"] - datum["${i.field}"]`,as:`lower_${u}`}));for(const g of l)f.push({fieldPrefix:g.as.substring(0,6),titlePrefix:zt(zt(g.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:c,tooltipSummary:f,tooltipTitleWithFieldName:d}}function il(e,t,n){return`${Dn(e)} ${n} ${t}`}const Ms="errorband",Ch=["band","borders"],Nh=new Yi(Ms,rl);function rl(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Ki(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:c}=nl(e,Ms,t),l=o,u=Ls(l,r,i,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},g={type:f?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),g=Object.assign(Object.assign(Object.assign({},g),p),{aria:!1})):l.interpolate?O(Va("interpolate")):l.tension&&O(Va("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...u({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c}),...u({partName:"borders",mark:g,positionPrefix:"lower",extraEncoding:c}),...u({partName:"borders",mark:g,positionPrefix:"upper",extraEncoding:c})]})}const sl={};function Us(e,t,n){const i=new Yi(e,t);sl[e]={normalizer:i,parts:n}}function Ph(){return y(sl)}Us(Ji,Zc,vh),Us(Ds,tl,_h),Us(Ms,rl,Ch);const Fh=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],ol={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},al={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Ah=y(ol),Th=y(al),Ih={header:1,headerRow:1,headerColumn:1,headerFacet:1},cl=y(Ih),ll=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],zh={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},Rh={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Jn="_vgsid_",Lh={point:{on:"click",fields:[Jn],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Ws(e){return!!e&&(e==="legend"||!!e.legend)}function Bs(e){return Ws(e)&&H(e)}function Hs(e){return!!e.select}var Dh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ul(e){const t=[];for(const n of e||[]){if(Hs(n))continue;const{expr:i,bind:r}=n,s=Dh(n,["expr","bind"]);if(r&&i){const o=Object.assign(Object.assign({},s),{bind:r,init:i});t.push(o)}else{const o=Object.assign(Object.assign(Object.assign({},s),i?{update:i}:{}),r?{bind:r}:{});t.push(o)}}return t}function Mh(e){return er(e)||Gs(e)||qs(e)}function qs(e){return"concat"in e}function er(e){return"vconcat"in e}function Gs(e){return"hconcat"in e}function fl({step:e,offsetIsDiscrete:t}){var n;return t?(n=e.for)!==null&&n!==void 0?n:"offset":"position"}function Ye(e){return H(e)&&e.step!==void 0}function dl(e){return e.view||e.width||e.height}const gl=20,Uh={align:1,bounds:1,center:1,columns:1,spacing:1},Wh=y(Uh);function Bh(e,t,n){var i,r;const s=n[t],o={},{spacing:a,columns:c}=s;a!==void 0&&(o.spacing=a),c!==void 0&&((Ui(e)&&!Yn(e.facet)||qs(e))&&(o.columns=c)),er(e)&&(o.columns=1);for(const l of Wh)if(e[l]!==void 0)if(l==="spacing"){const u=e[l];o[l]=Y(u)?u:{row:(i=u.row)!==null&&i!==void 0?i:a,column:(r=u.column)!==null&&r!==void 0?r:a}}else o[l]=e[l];return o}var Hh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Vs(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function tr(e,t){const n=nr(e,t);return Ye(n)?n.step:pl}function nr(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return K(i,{step:e.step})}const pl=20,qh={continuousWidth:200,continuousHeight:200,step:pl},Gh={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:qh,mark:zp,arc:{},area:{},bar:Dp,circle:{},geoshape:{},image:{},line:{},point:{},rect:Mp,rule:{color:"black"},square:{},text:{color:"black"},tick:Up,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:yp,projection:{},legend:zh,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Lh,style:{},title:{},facet:{spacing:gl},concat:{spacing:gl}},ft=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],hl={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},ml={blue:ft[0],orange:ft[1],red:ft[2],teal:ft[3],green:ft[4],yellow:ft[5],purple:ft[6],pink:ft[7],brown:ft[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Vh(e={}){return{signals:[{name:"color",value:H(e)?Object.assign(Object.assign({},ml),e):ml}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Xh(e){return{signals:[{name:"fontSize",value:H(e)?Object.assign(Object.assign({},hl),e):hl}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Yh(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function bl(e){const t=y(e||{}),n={};for(const i of t){const r=e[i];n[i]=Zn(r)?wa(r):be(r)}return n}function Kh(e){const t=y(e),n={};for(const i of t)n[i]=bl(e[i]);return n}const Qh=[...mc,...Bc,...cl,"background","padding","legend","lineBreak","scale","style","title","view"];function yl(e={}){const{color:t,font:n,fontSize:i,selection:r}=e,s=Hh(e,["color","font","fontSize","selection"]),o=Jo({},P(Gh),n?Yh(n):{},t?Vh(t):{},i?Xh(i):{},s||{});r&&Af(o,"selection",r,!0);const a=me(o,Qh);for(const c of["background","lineBreak","padding"])o[c]&&(a[c]=be(o[c]));for(const c of mc)o[c]&&(a[c]=ge(o[c]));for(const c of Bc)o[c]&&(a[c]=bl(o[c]));for(const c of cl)o[c]&&(a[c]=ge(o[c]));return o.legend&&(a.legend=ge(o.legend)),o.scale&&(a.scale=ge(o.scale)),o.style&&(a.style=Kh(o.style)),o.title&&(a.title=ge(o.title)),o.view&&(a.view=ge(o.view)),a}const Zh=new Set(["view",...Np]),Jh=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],em=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},Ip);function tm(e){e=P(e);for(const t of Jh)delete e[t];if(e.axis)for(const t in e.axis)Zn(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Fh)delete e.legend[t];if(e.mark){for(const t of hc)delete e.mark[t];e.mark.tooltip&&H(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(ul(e.params)),delete e.params);for(const t of Zh){for(const i of hc)delete e[t][i];const n=em[t];if(n)for(const i of n)delete e[t][i];im(e,t)}for(const t of Ph())delete e[t];nm(e);for(const t in e)H(e[t])&&L(e[t])&&delete e[t];return L(e)?void 0:e}function nm(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=ja(e.title);L(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),L(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),L(i)?delete e.title:e.title=i}function im(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},r),e.style[n??t]);L(s)||(e.style[n??t]=s),i||delete e[t]}function ir(e){return"layer"in e}function rm(e){return"repeat"in e}function sm(e){return!j(e.repeat)&&e.repeat.layer}var om=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Xs{map(t,n){return Ui(t)?this.mapFacet(t,n):rm(t)?this.mapRepeat(t,n):Gs(t)?this.mapHConcat(t,n):er(t)?this.mapVConcat(t,n):qs(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(ir(t))return this.mapLayer(t,n);if(ut(t))return this.mapUnit(t,n);throw new Error(Kr(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(i=>this.map(i,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(i=>this.map(i,n))})}mapConcat(t,n){const{concat:i}=t,r=om(t,["concat"]);return Object.assign(Object.assign({},r),{concat:i.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const am={zero:1,center:1,normalize:1};function cm(e){return e in am}const lm=new Set([fc,Ti,Ai,Ri,zi,bs,ys,Ii,dc,ms]),um=new Set([Ti,Ai,fc]);function yn(e){return _(e)&&Es(e)==="quantitative"&&!e.bin}function vl(e,t){var n,i;const r=t==="x"?"y":"radius",s=e[t],o=e[r];if(_(s)&&_(o))if(yn(s)&&yn(o)){if(s.stack)return t;if(o.stack)return r;const a=_(s)&&!!s.aggregate,c=_(o)&&!!o.aggregate;if(a!==c)return a?t:r;{const l=(n=s.scale)===null||n===void 0?void 0:n.type,u=(i=o.scale)===null||i===void 0?void 0:i.type;if(l&&l!=="linear")return r;if(u&&u!=="linear")return t}}else{if(yn(s))return t;if(yn(o))return r}else{if(yn(s))return t;if(yn(o))return r}return}function fm(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function Ol(e,t,n={}){var i,r;const s=He(e)?e.type:e;if(!lm.has(s))return null;const o=vl(t,"x")||vl(t,"theta");if(!o)return null;const a=t[o],c=_(a)?S(a,{}):void 0,l=fm(o),u=[],f=new Set;if(t[l]){const p=t[l],m=_(p)?S(p,{}):void 0;m&&m!==c&&(u.push(l),f.add(m));const h=l==="x"?"xOffset":"yOffset",v=t[h],b=_(v)?S(v,{}):void 0;b&&b!==c&&(u.push(h),f.add(b))}const d=vd.reduce((p,m)=>{if(m!=="tooltip"&&Vt(t,m)){const h=t[m];for(const v of V(h)){const b=Xe(v);if(b.aggregate)continue;const x=S(b,{});(!x||!f.has(x))&&p.push({channel:m,fieldDef:b})}}return p},[]);let g;if(a.stack!==void 0?zn(a.stack)?g=a.stack?"zero":null:g=a.stack:um.has(s)&&(g="zero"),!g||!cm(g))return null;if(Ts(t)&&d.length===0)return null;if(((i=a==null?void 0:a.scale)===null||i===void 0?void 0:i.type)&&((r=a==null?void 0:a.scale)===null||r===void 0?void 0:r.type)!==pe.LINEAR){if(n.disallowNonLinearStack)return null;O(zg(a.scale.type))}return k(t[ot(o)])?(a.stack!==void 0&&O(Ig(o)),null):(_(a)&&a.aggregate&&!Pd.has(a.aggregate)&&O(Rg(a.aggregate)),{groupbyChannels:u,groupbyFields:f,fieldChannel:o,impute:a.impute===null?!1:wt(s),stackBy:d,offset:g})}var xl=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function dm(e){const t=xl(e,["point","line"]);return y(t).length>1?t:t.type}function gm(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:me(e[t],["point","line"])}));return e}function Ys(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?H(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?H(t.point)?t.point:{}:void 0}function _l(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class pm{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(ut(t)){const{mark:i,encoding:r}=t,s=He(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!Ys(s,n[s.type],r);case"area":return!!Ys(s,n[s.type],r)||!!_l(s,n[s.type])}}return!1}run(t,n,i){const{config:r}=n,{params:s,projection:o,mark:a,encoding:c}=t,l=xl(t,["params","projection","mark","encoding"]),u=Ki(c,r),f=He(a)?a:{type:a},d=Ys(f,r[f.type],u),g=f.type==="area"&&_l(f,r[f.type]),p=[Object.assign(Object.assign({},s?{params:s}:{}),{mark:dm(Object.assign(Object.assign({},f.type==="area"&&f.opacity===void 0&&f.fillOpacity===void 0?{opacity:.7}:{}),f)),encoding:me(u,["shape"])})],m=Ol(f,u);let h=u;if(m){const{fieldChannel:v,offset:b}=m;h=Object.assign(Object.assign({},u),{[v]:Object.assign(Object.assign({},u[v]),b?{stack:b}:{})})}return g&&p.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},sn(f,["clip","interpolate","tension","tooltip"])),g),encoding:h})),d&&p.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},sn(f,["clip","tooltip"])),d),encoding:h})),i(Object.assign(Object.assign({},l),{layer:p}),Object.assign(Object.assign({},n),{config:gm(r)}))}}var hm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function mm(e,t){return t?Yn(e)?$l(e,t):Sl(e,t):e}function Ks(e,t){return t?$l(e,t):e}function Qs(e,t,n){const i=t[e];if(Qp(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});O(Qd(i.repeat));return}return t}function Sl(e,t){if(e=Qs("field",e,t),e===void 0)return;if(e===null)return null;if($s(e)&&qe(e.sort)){const n=Qs("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}function jl(e,t){if(_(e))return Sl(e,t);{const n=Qs("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function wl(e,t){if(k(e)){const n=jl(e,t);if(n)return n;if(Wi(e))return{condition:e.condition}}else{if(Kn(e)){const n=jl(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const i=hm(e,["condition"]);return i}}return e}return}function $l(e,t){const n={};for(const i in e)if(en(e,i)){const r=e[i];if(j(r))n[i]=r.map(s=>wl(s,t)).filter(s=>s);else{const s=wl(r,t);s!==void 0&&(n[i]=s)}}return n}class bm{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(ut(t)){const{encoding:n,mark:i}=t;if(i==="line"||He(i)&&i.type==="line")for(const r of md){const s=Dt(r),o=n[s];if(n[r]&&(_(o)&&!oe(o.bin)||Ge(o)))return!0}}return!1}run(t,n,i){const{encoding:r,mark:s}=t;return O(yg(!!r.x2,!!r.y2)),i(Object.assign(Object.assign({},t),{mark:H(s)?Object.assign(Object.assign({},s),{type:"rule"}):"rule"}),n)}}var $t=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class ym extends Xs{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[Oh,Sh,Nh,new pm,new bm]}map(t,n){if(ut(t)){const i=Vt(t.encoding,et),r=Vt(t.encoding,tt),s=Vt(t.encoding,_i);if(i||r||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,s=Ks(t.encoding,n.repeater),o=Object.assign(Object.assign({},t),s?{encoding:s}:{});if(i||r)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const c of this.nonFacetUnitNormalizers)if(c.hasMatchingType(o,n.config))return c.run(o,n,a);return o}mapRepeat(t,n){return sm(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r}=t,s=$t(t,["repeat","spec"]),{row:o,column:a,layer:c}=i,{repeater:l={},repeaterPrefix:u=""}=n;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:c},spec:r}}),n):Object.assign(Object.assign({},s),{layer:c.map(f=>{const d=Object.assign(Object.assign({},l),{layer:f}),g=`${(r.name||"")+u}child__layer_${q(f)}`,p=this.mapLayerOrUnit(r,Object.assign(Object.assign({},n),{repeater:d,repeaterPrefix:g}));return p.name=g,p})})}mapNonLayerRepeat(t,n){var i;const{repeat:r,spec:s,data:o}=t,a=$t(t,["repeat","spec","data"]);!j(r)&&t.columns&&(t=me(t,["columns"]),O(Da("repeat")));const c=[],{repeater:l={},repeaterPrefix:u=""}=n,f=!j(r)&&r.row||[l?l.row:null],d=!j(r)&&r.column||[l?l.column:null],g=j(r)&&r||[l?l.repeat:null];for(const m of g)for(const h of f)for(const v of d){const b={repeat:m,row:h,column:v,layer:l.layer},x=(s.name||"")+u+"child__"+(j(r)?`${q(m)}`:(r.row?`row_${q(h)}`:"")+(r.column?`column_${q(v)}`:"")),$=this.map(s,Object.assign(Object.assign({},n),{repeater:b,repeaterPrefix:x}));$.name=x,c.push(me($,["data"]))}const p=j(r)?t.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(i=s.data)!==null&&i!==void 0?i:o,align:"all"},a),{columns:p,concat:c})}mapFacet(t,n){const{facet:i}=t;return Yn(i)&&t.columns&&(t=me(t,["columns"]),O(Da("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:s,parentProjection:o,config:a}=n,c=kl({parentProjection:o,projection:r}),l=El({parentEncoding:s,encoding:Ks(i,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),c?{projection:c}:{}),l?{encoding:l}:{}),{config:a})}mapFacetedUnit(t,n){const i=t.encoding,{row:r,column:s,facet:o}=i,a=$t(i,["row","column","facet"]),{mark:c,width:l,projection:u,height:f,view:d,params:g,encoding:p}=t,m=$t(t,["mark","width","projection","height","view","params","encoding"]),{facetMapping:h,layout:v}=this.getFacetMappingAndLayout({row:r,column:s,facet:o},n),b=Ks(a,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},m),v),{facet:h,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),f?{height:f}:{}),d?{view:d}:{}),u?{projection:u}:{}),{mark:c,encoding:b}),g?{params:g}:{})}),n)}getFacetMappingAndLayout(t,n){var i;const{row:r,column:s,facet:o}=t;if(r||s){o&&O(mg([...r?[et]:[],...s?[tt]:[]]));const a={},c={};for(const l of[et,tt]){const u=t[l];if(u){const f=$t(u,["align","center","spacing","columns"]);a[l]=f;for(const d of["align","center","spacing"])u[d]!==void 0&&((i=c[d])!==null&&i!==void 0||(c[d]={}),c[d][l]=u[d])}}return{facetMapping:a,layout:c}}else{const{align:a,center:c,spacing:l,columns:u}=o,f=$t(o,["align","center","spacing","columns"]);return{facetMapping:mm(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),c?{center:c}:{}),l?{spacing:l}:{}),u?{columns:u}:{})}}}mapLayer(t,n){var{parentEncoding:i,parentProjection:r}=n,s=$t(n,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,c=$t(t,["encoding","projection"]),l=Object.assign(Object.assign({},s),{parentEncoding:El({parentEncoding:i,encoding:o,layer:!0}),parentProjection:kl({parentProjection:r,projection:a})});return super.mapLayer(c,l)}}function El({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...y(e),...y(t)]);for(const s of r){const o=t[s],a=e[s];if(k(o)){const c=Object.assign(Object.assign({},a),o);i[s]=c}else Kn(o)?i[s]=Object.assign(Object.assign({},o),{condition:Object.assign(Object.assign({},a),o.condition)}):o||o===null?i[s]=o:(n||Ce(a)||w(a)||k(a)||j(a))&&(i[s]=a)}}else i=t;return!i||L(i)?void 0:i}function kl(e){const{parentProjection:t,projection:n}=e;return t&&n&&O(ig({parentProjection:t,projection:n})),n??t}function Zs(e){return"filter"in e}function vm(e){return(e==null?void 0:e.stop)!==void 0}function Cl(e){return"lookup"in e}function Om(e){return"data"in e}function xm(e){return"param"in e}function _m(e){return"pivot"in e}function Sm(e){return"density"in e}function jm(e){return"quantile"in e}function wm(e){return"regression"in e}function $m(e){return"loess"in e}function Em(e){return"sample"in e}function km(e){return"window"in e}function Cm(e){return"joinaggregate"in e}function Nm(e){return"flatten"in e}function Pm(e){return"calculate"in e}function Nl(e){return"bin"in e}function Fm(e){return"impute"in e}function Am(e){return"timeUnit"in e}function Tm(e){return"aggregate"in e}function Im(e){return"stack"in e}function zm(e){return"fold"in e}function Rm(e){return e.map(t=>Zs(t)?{filter:rn(t.filter,up)}:t)}var Et=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Lm extends Xs{map(t,n){var i,r;return(i=n.emptySelections)!==null&&i!==void 0||(n.emptySelections={}),(r=n.selectionPredicates)!==null&&r!==void 0||(n.selectionPredicates={}),t=Pl(t,n),super.map(t,n)}mapLayerOrUnit(t,n){if(t=Pl(t,n),t.encoding){const i={};for(const[r,s]of pt(t.encoding))i[r]=Fl(s,n);t=Object.assign(Object.assign({},t),{encoding:i})}return super.mapLayerOrUnit(t,n)}mapUnit(t,n){const i=t,{selection:r}=i,s=Et(i,["selection"]);return r?Object.assign(Object.assign({},s),{params:pt(r).map(([o,a])=>{var c;const l=a,{init:u,bind:f,empty:d}=l,g=Et(l,["init","bind","empty"]);g.type==="single"?(g.type="point",g.toggle=!1):g.type==="multi"&&(g.type="point"),n.emptySelections[o]=d!=="none";for(const p of ie((c=n.selectionPredicates[o])!==null&&c!==void 0?c:{}))p.empty=d!=="none";return{name:o,value:u,select:g,bind:f}})}):t}}function Pl(e,t){const{transform:n}=e,i=Et(e,["transform"]);if(n){const r=n.map(s=>{if(Zs(s))return{filter:Js(s,t)};if(Nl(s)&&Mt(s.bin))return Object.assign(Object.assign({},s),{bin:Al(s.bin)});if(Cl(s)){const o=s.from,{selection:a}=o,c=Et(o,["selection"]);return a?Object.assign(Object.assign({},s),{from:Object.assign({param:a},c)}):s}return s});return Object.assign(Object.assign({},i),{transform:r})}return e}function Fl(e,t){var n,i;const r=P(e);if(_(r)&&Mt(r.bin)&&(r.bin=Al(r.bin)),Gt(r)&&((i=(n=r.scale)===null||n===void 0?void 0:n.domain)===null||i===void 0?void 0:i.selection)){const s=r.scale.domain,{selection:o}=s,a=Et(s,["selection"]);r.scale.domain=Object.assign(Object.assign({},a),o?{param:o}:{})}if(Wi(r))if(ta(r.condition))r.condition=r.condition.map(s=>{const{selection:o,param:a,test:c}=s,l=Et(s,["selection","param","test"]);return a?s:Object.assign(Object.assign({},l),{test:Js(s,t)})});else{const s=Fl(r.condition,t),{selection:o,param:a,test:c}=s,l=Et(s,["selection","param","test"]);r.condition=a?r.condition:Object.assign(Object.assign({},l),{test:Js(r.condition,t)})}return r}function Al(e){const t=e.extent;if(t==null?void 0:t.selection){const{selection:n}=t,i=Et(t,["selection"]);return Object.assign(Object.assign({},e),{extent:Object.assign(Object.assign({},i),{param:n})})}return e}function Js(e,t){const n=i=>rn(i,r=>{var s,o,a;const c=(s=t.emptySelections[r])!==null&&s!==void 0?s:!0,l={param:r,empty:c};return(o=(a=t.selectionPredicates)[r])!==null&&o!==void 0||(a[r]=[]),t.selectionPredicates[r].push(l),l});return e.selection?n(e.selection):rn(e.test||e.filter,i=>i.selection?n(i.selection):i)}class eo extends Xs{map(t,n){var i;const r=(i=n.selections)!==null&&i!==void 0?i:[];if(t.params&&!ut(t)){const s=[];for(const o of t.params)Hs(o)?r.push(o):s.push(o);t.params=s}return n.selections=r,super.map(t,Tl(t,n))}mapUnit(t,n){var i;const r=n.selections;if(!r||!r.length)return t;const s=((i=n.path)!==null&&i!==void 0?i:[]).concat(t.name),o=[];for(const a of r)if(!a.views||!a.views.length)o.push(a);else for(const c of a.views)(yi(c)&&(c===t.name||s.indexOf(c)>=0)||ta(c)&&c.map(l=>s.indexOf(l)).every((l,u,f)=>l!==-1&&(u===0||l>f[u-1])))&&o.push(a);return o.length&&(t.params=o),t}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=eo.prototype[e];eo.prototype[e]=function(n,i){return t.call(this,n,Tl(n,i))}}function Tl(e,t){var n;return e.name?Object.assign(Object.assign({},t),{path:((n=t.path)!==null&&n!==void 0?n:[]).concat(e.name)}):t}function Il(e,t){t===void 0&&(t=yl(e.config));const n=Wm(e,t),{width:i,height:r}=e,s=Bm(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const Dm=new ym,Mm=new Lm,Um=new eo;function Wm(e,t={}){const n={config:t};return Um.map(Dm.map(Mm.map(e,n),n),n)}function zl(e){return F(e)?{type:e}:e??{}}function Bm(e,t,n){let{width:i,height:r}=t;const s=ut(e)||ir(e),o={};s?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(O(Ta("width")),i=void 0),r=="container"&&(O(Ta("height")),r=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?zl(n.autosize):{}),zl(e.autosize));return a.type==="fit"&&!s&&(O(Ud),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&O(Ia("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&O(Ia("height")),Te(a,{type:"pad"})?void 0:a}function Hm(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function qm(e){return e?`fit-${Ei(e)}`:"fit"}const Gm=["background","padding"];function Rl(e,t){const n={};for(const i of Gm)e&&e[i]!==void 0&&(n[i]=be(e[i]));return t&&(n.params=e.params),n}class dt{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new dt(P(this.explicit),P(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return K(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,{value:n,explicit:i}){n!==void 0&&this.set(t,n,i)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,{explicit:n,implicit:i}){n[t]!==void 0?this.set(t,n[t],!0):i[t]!==void 0&&this.set(t,i[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of y(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function Ke(e){return{explicit:!0,value:e}}function ve(e){return{explicit:!1,value:e}}function Ll(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:rr(t,n,i,r)}}function rr(e,t,n,i){return e.explicit&&t.explicit&&O(kg(n,i,e.value,t.value)),e}function kt(e,t,n,i,r=rr){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Te(e.value,t.value)?e:r(e,t,n,i)}class Vm extends dt{constructor(t={},n={},i=!1){super(t,n);this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function vn(e){return"url"in e}function ei(e){return"values"in e}function Dl(e){return"name"in e&&!vn(e)&&!ei(e)&&!Ct(e)}function Ct(e){return e&&(Ml(e)||Ul(e)||to(e))}function Ml(e){return"sequence"in e}function Ul(e){return"sphere"in e}function to(e){return"graticule"in e}var W;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(W||(W={}));var Xm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function On(e,t=!0,n=Nf){if(j(e)){const i=e.map(r=>On(r,t,n));return t?`[${i.join(", ")}]`:i}else if(Wt(e))return n(t?Gn(e):Jg(e));return t?n(M(e)):e}function Ym(e,t){var n;for(const i of ie((n=e.component.selection)!==null&&n!==void 0?n:{})){const r=i.name;let s=`${r}${Ft}, ${i.resolve==="global"?"true":`{unit: ${Sn(e)}}`}`;for(const o of lr){if(!o.defined(i))continue;o.signals&&(t=o.signals(e,i,t)),o.modifyExpr&&(s=o.modifyExpr(e,i,s))}t.push({name:r+kb,on:[{events:{signal:i.name+Ft},update:`modify(${z(i.name+Xt)}, ${s})`}]})}return no(t)}function Km(e,t){if(e.component.selection&&y(e.component.selection).length){const n=z(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:nn("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return no(t)}function Qm(e,t){var n;let i=!1;for(const r of ie((n=e.component.selection)!==null&&n!==void 0?n:{})){const s=r.name,o=z(s+Xt),a=t.filter(c=>c.name===s);if(a.length===0){const c=r.resolve==="global"?"union":r.resolve,l=r.type==="point"?", true, true)":")";t.push({name:r.name,update:`${uu}(${o}, ${z(c)}${l}`})}i=!0;for(const c of lr)c.defined(r)&&c.topLevelSignals&&(t=c.topLevelSignals(e,r,t))}if(i){const r=t.filter(s=>s.name==="unit");r.length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return no(t)}function Zm(e,t){var n;const i=[...t];for(const r of ie((n=e.component.selection)!==null&&n!==void 0?n:{})){const s={name:r.name+Xt};if(r.init){const a=r.project.items.map(c=>{const l=Xm(c,["signals"]);return l});s.values=r.init.map(c=>({unit:Sn(e,{escape:!1}),fields:a,values:On(c,!1)}))}const o=i.filter(a=>a.name===r.name+Xt);o.length||i.push(s)}return i}function Wl(e,t){var n;for(const i of ie((n=e.component.selection)!==null&&n!==void 0?n:{}))for(const r of lr)r.defined(i)&&r.marks&&(t=r.marks(e,i,t));return t}function Jm(e,t){for(const n of e.children)Q(n)&&(t=Wl(n,t));return t}function eb(e,t,n,i){const r=hu(e,t.param,t);return{signal:ye(n.get("type"))&&j(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function no(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}class D{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.includes(t)){O(eg);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const i of this._children)i.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class le extends D{constructor(t,n,i,r){super(t,n);this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName=`clone_${this.debugName}`,t._source=this._source,t._name=`clone_${this._name}`,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${aa()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}var Bl=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Qe extends D{constructor(t,n){super(t);this.formula=n}clone(){return new Qe(null,P(this.formula))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s)=>{const{field:o,timeUnit:a}=s;if(a){const c=S(s,{forAs:!0});r[T({as:c,field:o,timeUnit:a})]={as:c,field:o,timeUnit:a}}return r},{});return L(i)?null:new Qe(t,i)}static makeFromTransform(t,n){const i=Object.assign({},n),{timeUnit:r}=i,s=Bl(i,["timeUnit"]),o=ae(r),a=Object.assign(Object.assign({},s),{timeUnit:o});return new Qe(t,{[T(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)this.formula[n]||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of pt(this.formula))t.has(r.as)||(n[i]=r);this.formula=n}producedFields(){return new Set(ie(this.formula).map(t=>t.as))}dependentFields(){return new Set(ie(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${T(this.formula)}`}assemble(){const t=[];for(const n of ie(this.formula)){const{field:i,as:r,timeUnit:s}=n,o=ae(s),{unit:a,utc:c}=o,l=Bl(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:Oe(i),type:"timeunit"},a?{units:is(a)}:{}),c?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return t}}var tb=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const ti="_tuple_fields";class nb{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const ib={defined:()=>!0,parse:(e,t,n)=>{var i;const r=t.name,s=(i=t.project)!==null&&i!==void 0?i:t.project=new nb,o={},a={},c=new Set,l=(m,h)=>{const v=h==="visual"?m.channel:m.field;let b=q(`${r}_${v}`);for(let x=1;c.has(b);x++)b=q(`${r}_${v}_${x}`);return c.add(b),{[h]:b}},u=t.type,f=e.config.selection[u],d=n.value!==void 0?V(n.value):null;let{fields:g,encodings:p}=H(n.select)?n.select:{};if(!g&&!p&&d)for(const m of d){if(!H(m))continue;for(const h of y(m))hd(h)?(p||(p=[])).push(h):u==="interval"?(O(Kd),p=f.encodings):(g||(g=[])).push(h)}!g&&!p&&(p=f.encodings,"fields"in f&&(g=f.fields));for(const m of p??[]){const h=e.fieldDef(m);if(h){let v=h.field;if(h.aggregate){O(Wd(m,h.aggregate));continue}else if(!v){O(Ra(m));continue}if(h.timeUnit){v=e.vgField(m);const b={timeUnit:h.timeUnit,as:v,field:h.field};a[T(b)]=b}if(!o[v]){let b="E";if(u==="interval"){const $=e.getScaleComponent(m).get("type");ye($)&&(b="R")}else h.bin&&(b="R-RE");const x={field:v,channel:m,type:b};x.signals=Object.assign(Object.assign({},l(x,"data")),l(x,"visual")),s.items.push(o[v]=x),s.hasField[v]=s.hasChannel[m]=o[v]}}else O(Ra(m))}for(const m of g??[]){if(s.hasField[m])continue;const h={type:"E",field:m};h.signals=Object.assign({},l(h,"data")),s.items.push(h),s.hasField[m]=h}d&&(t.init=d.map(m=>s.items.map(h=>H(m)?m[h.channel]!==void 0?m[h.channel]:m[h.field]:m))),L(a)||(s.timeUnit=new Qe(null,a))},signals:(e,t,n)=>{const i=t.name+ti,r=n.filter(s=>s.name===i);return r.length>0?n:n.concat({name:i,value:t.project.items.map(s=>{const o=tb(s,["signals","hasLegend"]);return o.field=Oe(o.field),o})})}},Nt={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!xt(r))continue;const s=e.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!ye(o)){O(qd);continue}s.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||ro(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let s=r.update;if(s.indexOf(uu)>=0)r.update=`{${i.map(o=>`${z(Oe(o.field))}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const a=`${z(Oe(o.field))}: ${o.signals.data}`;s.includes(a)||(s=`${s.substring(0,s.length-1)}, ${a}}`)}r.update=s}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!ro(e))for(const i of t.scales){const r=n.filter(s=>s.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function io(e,t){const n=z(e.scaleName(t));return`domain(${n})`}function ro(e){var t;return e.parent&&Nn(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:ro(e.parent.parent))}var rb=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const xn="_brush",so="_scale_trigger",sb={defined:e=>e.type==="interval",signals:(e,t,n)=>{const i=t.name,r=i+ti,s=Nt.defined(t),o=t.init?t.init[0]:null,a=[],c=[];if(t.translate&&!s){const u=`!event.item || event.item.mark.name !== ${z(i+xn)}`;Hl(t,(f,d)=>{var g,p;const m=V((g=(p=d.between[0]).filter)!==null&&g!==void 0?g:p.filter=[]);return m.includes(u)||m.push(u),f})}t.project.items.forEach((u,f)=>{const d=u.channel;if(d!==G&&d!==J){O("Interval selections only support x and y encoding channels.");return}const g=o?o[f]:null,p=ob(e,t,u,g),m=u.signals.data,h=u.signals.visual,v=z(e.scaleName(d)),b=e.getScaleComponent(d).get("type"),x=ye(b)?"+":"";n.push(...p),a.push(m),c.push({scaleName:e.scaleName(d),expr:`(!isArray(${m}) || (${x}invert(${v}, ${h})[0] === ${x}${m}[0] && ${x}invert(${v}, ${h})[1] === ${x}${m}[1]))`})}),!s&&c.length&&n.push({name:i+so,value:{},on:[{events:c.map(u=>({scale:u.scaleName})),update:`${c.map(u=>u.expr).join(" && ")} ? ${i+so} : {}`}]});const l=`unit: ${Sn(e)}, fields: ${r}, values`;return n.concat(Object.assign(Object.assign({name:i+Ft},o?{init:`{${l}: ${On(o)}}`}:{}),a.length?{on:[{events:[{signal:a.join(" || ")}],update:`${a.join(" && ")} ? {${l}: [${a}]} : null`}]}:{}))},marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,o=r==null?void 0:r.signals.visual,a=s==null?void 0:s.signals.visual,c=`data(${z(t.name+Xt)})`;if(Nt.defined(t)||!r&&!s)return n;const l={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const h of y(l))l[h]=[Object.assign({test:`${c}.length && ${c}[0].unit === ${Sn(e)}`},l[h]),{value:0}];const u=t.mark,{fill:f,fillOpacity:d,cursor:g}=u,p=rb(u,["fill","fillOpacity","cursor"]),m=y(p).reduce((h,v)=>(h[v]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(b=>b).join(" && "),value:p[v]},{value:null}],h),{});return[{name:`${i+xn}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:l}},...n,{name:i+xn,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},g?{cursor:{value:g}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),m)}}]}};function ob(e,t,n,i){const r=n.channel,s=n.signals.visual,o=n.signals.data,a=Nt.defined(t),c=z(e.scaleName(r)),l=e.getScaleComponent(r),u=l?l.get("type"):void 0,f=m=>`scale(${c}, ${m})`,d=e.getSizeSignalRef(r===G?"width":"height").signal,g=`${r}(unit)`,p=Hl(t,(m,h)=>[...m,{events:h.between[0],update:`[${g}, ${g}]`},{events:h,update:`[${s}[0], clamp(${g}, 0, ${d})]`}]);return p.push({events:{signal:t.name+so},update:ye(u)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},i?{init:On(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:On(i)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${c}, ${s})`}]})]}function Hl(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(O(`${i} is not an ordered event stream for interval selections.`),n),[])}const ab={defined:e=>e.type==="point",signals:(e,t,n)=>{var i;const r=t.name,s=r+ti,o=t.project,a="(item().isVoronoi ? datum.datum : datum)",c=o.items.map(g=>{const p=e.fieldDef(g.channel);return(p==null?void 0:p.bin)?`[${a}[${z(e.vgField(g.channel,{}))}], ${a}[${z(e.vgField(g.channel,{binSuffix:"end"}))}]]`:`${a}[${z(g.field)}]`}).join(", "),l=`unit: ${Sn(e)}, fields: ${s}, values`,u=t.events,f=ie((i=e.component.selection)!==null&&i!==void 0?i:{}).reduce((g,p)=>p.type==="interval"?g.concat(p.name+xn):g,[]).map(g=>`indexof(item().mark.name, '${g}') < 0`).join(" && "),d=`datum && item().mark.marktype !== 'group'${f?` && ${f}`:""}`;return n.concat([{name:r+Ft,on:u?[{events:u,update:`${d} ? {${l}: [${c}]} : null`,force:!0}]:[]}])}};function _n(e,t,n,i){const r=Wi(t)&&t.condition,s=i(t);if(r){const o=V(r),a=o.map(c=>{const l=i(c);if(Kp(c)){const{param:u,empty:f}=c,d=pu(e,{param:u,empty:f});return Object.assign({test:d},l)}else{const u=ur(e,c.test);return Object.assign({test:u},l)}});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function oo(e,t="text"){const n=e.encoding[t];return _n(e,n,t,i=>sr(i,e.config))}function sr(e,t,n="datum"){if(e){if(Ce(e))return B(e.value);if(k(e)){const{format:i,formatType:r}=qi(e);return _s({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}return}function ql(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,o=n.tooltip;if(j(o))return{tooltip:Vl({tooltip:o},s,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return _n(e,o,"tooltip",c=>{const l=sr(c,r,a);if(l)return l;if(c===null)return;let u=R("tooltip",i,r);return u===!0&&(u={content:"encoding"}),F(u)?{value:u}:H(u)?w(u)?u:u.content==="encoding"?Vl(n,s,r,t):{signal:a}:void 0})}}function Gl(e,t,n,{reactiveGeom:i}={}){const r={},s=i?"datum.datum":"datum",o=[];function a(l,u){const f=Dt(u),d=Se(l)?l:Object.assign(Object.assign({},l),{type:e[f].type}),g=d.title||Ps(d,n),p=V(g).join(", ");let m;if(ne(u)){const h=u==="x"?"x2":"y2",v=Xe(e[h]);if(oe(d.bin)&&v){const b=S(d,{expr:s}),x=S(v,{expr:s}),{format:$,formatType:N}=qi(d);m=Di(b,x,$,N,n),r[h]=!0}else if(t&&t.fieldChannel===u&&t.offset==="normalize"){const{format:b,formatType:x}=qi(d);m=_s({fieldOrDatumDef:d,format:b,formatType:x,expr:s,config:n,normalizeStack:!0}).signal}}m??(m=sr(d,n,s).signal),o.push({channel:u,key:p,value:m})}Is(e,(l,u)=>{_(l)?a(l,u):Bi(l)&&a(l.condition,u)});const c={};for(const{channel:l,key:u,value:f}of o)!r[l]&&!c[u]&&(c[u]=f);return c}function Vl(e,t,n,{reactiveGeom:i}={}){const r=Gl(e,t,n,{reactiveGeom:i}),s=pt(r).map(([o,a])=>`"${o}": ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function cb(e){const{markDef:t,config:n}=e,i=R("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),lb(e)),ub(e))}function lb(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=R("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in Ld?{}:{ariaRoleDescription:{value:t}}}function ub(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return _n(e,s,"description",c=>sr(c,e.config));const o=R("description",n,i);if(o!=null)return{description:B(o)};if(i.aria===!1)return{};const a=Gl(t,r,i);return L(a)?void 0:{description:{signal:pt(a).map(([c,l],u)=>`"${u>0?"; ":""}${c}: " + (${l})`).join(" + ")}}}function te(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:c}=n;a===void 0&&(c??(c=R(e,i,s,{vgChannel:o,ignoreVgConfig:!0})),c!==void 0&&(a=B(c)));const l=r[e];return _n(t,l,o??e,u=>xs({channel:e,channelDef:u,markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function Xl(e,t={filled:void 0}){var n,i,r,s;const{markDef:o,encoding:a,config:c}=e,{type:l}=o,u=(n=t.filled)!==null&&n!==void 0?n:R("filled",o,c),f=I(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,d=(r=(i=R(u===!0?"color":void 0,o,c,{vgChannel:"fill"}))!==null&&i!==void 0?i:c.mark[u===!0&&"color"])!==null&&r!==void 0?r:f,g=(s=R(u===!1?"color":void 0,o,c,{vgChannel:"stroke"}))!==null&&s!==void 0?s:c.mark[u===!1&&"color"],p=u?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:B(d)}:{}),g?{stroke:B(g)}:{});return o.color&&(u?o.fill:o.stroke)&&O(Ba("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),te("color",e,{vgChannel:p,defaultValue:u?d:g})),te("fill",e,{defaultValue:a.fill?d:void 0})),te("stroke",e,{defaultValue:a.stroke?g:void 0}))}function fb(e){const{encoding:t,mark:n}=e,i=t.order;return!wt(n)&&Ce(i)?_n(e,i,"zindex",r=>B(r.value)):{}}function ni({channel:e,markDef:t,encoding:n={},model:i,bandPosition:r}){const s=`${e}Offset`,o=t[s],a=n[s];if((s==="xOffset"||s==="yOffset")&&a){const l=xs({channel:s,channelDef:a,markDef:t,config:i==null?void 0:i.config,scaleName:i.scaleName(s),scale:i.getScaleComponent(s),stack:null,defaultRef:B(o),bandPosition:r});return{offsetType:"encoding",offset:l}}const c=t[s];return c?{offsetType:"visual",offset:c}:{}}function re(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:s,config:o,stack:a}=t,c=r[e],l=r[ot(e)],u=t.scaleName(e),f=t.getScaleComponent(e),{offset:d,offsetType:g}=ni({channel:e,markDef:s,encoding:r,model:t,bandPosition:.5}),p=ao({model:t,defaultPos:n,channel:e,scaleName:u,scale:f}),m=!c&&ne(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:db({channel:e,channelDef:c,channel2Def:l,markDef:s,config:o,scaleName:u,scale:f,stack:a,offset:d,defaultRef:p,bandPosition:g==="encoding"?0:void 0});return m?{[i||e]:m}:void 0}function db(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:s,markDef:o}=e;if(k(n)&&r&&t===r.fieldChannel){if(_(n)){let a=n.bandPosition;if(a===void 0&&o.type==="text"&&(t==="radius"||t==="theta")&&(a=.5),a!==void 0)return Li({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:a,offset:s})}return Ht(n,i,{suffix:"end"},{offset:s})}return vs(e)}function ao({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=e;return()=>{const a=Dt(n),c=Ot(n),l=R(n,s,o,{vgChannel:c});if(l!==void 0)return Xn(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const u=r.get("type");if(!I([pe.LOG,pe.TIME,pe.UTC],u)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const u=e[de(n)];return Object.assign(Object.assign({},u),{mult:.5})}}return}}const gb={left:"x",center:"xc",right:"x2"},pb={top:"y",middle:"yc",bottom:"y2"};function Yl(e,t,n,i="middle"){if(e==="radius"||e==="theta")return Ot(e);const r=e==="x"?"align":"baseline",s=R(r,t,n);let o;return w(s)?(O(bg(r)),o=void 0):o=s,e==="x"?gb[o||(i==="top"?"left":"center")]:pb[o||i]}function or(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?Kl(e,t,{defaultPos:n,defaultPos2:i}):re(e,t,{defaultPos:n})}function Kl(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,o=ot(e),a=de(e),c=hb(t,i,o),l=c[a]?Yl(e,r,s):Ot(e);return Object.assign(Object.assign({},re(e,t,{defaultPos:n,vgChannel:l})),c)}function hb(e,t,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=e,c=Dt(n),l=de(n),u=Ot(n),f=i[c],d=e.scaleName(c),g=e.getScaleComponent(c),{offset:p}=n in i||n in s?ni({channel:n,markDef:s,encoding:i,model:e}):ni({channel:c,markDef:s,encoding:i,model:e});if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const h=de(n),v=e.markDef[h];return v!=null?{[h]:{value:v}}:{[u]:{field:e.getName(n)}}}const m=mb({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:a,scaleName:d,scale:g,stack:o,offset:p,defaultRef:void 0});return m!==void 0?{[u]:m}:ar(n,s)||ar(n,{[n]:Ni(n,s,a.style),[l]:Ni(l,s,a.style)})||ar(n,a[r])||ar(n,a.mark)||{[u]:ao({model:e,defaultPos:t,channel:n,scaleName:d,scale:g})()}}function mb({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l}){return k(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?Ht(t,s,{suffix:"start"},{offset:c}):vs({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:c,defaultRef:l})}function ar(e,t){const n=de(e),i=Ot(e);if(t[i]!==void 0)return{[i]:Xn(e,t[i])};if(t[e]!==void 0)return{[i]:Xn(e,t[e])};if(t[n]){const r=t[n];if(pn(r))O(ug(n));else return{[n]:Xn(e,r)}}return}function Pt(e,t){var n,i;const{config:r,encoding:s,markDef:o}=e,a=o.type,c=ot(t),l=de(t),u=s[t],f=s[c],d=e.getScaleComponent(t),g=d?d.get("type"):void 0,p=o.orient,m=(i=(n=s[l])!==null&&n!==void 0?n:s.size)!==null&&i!==void 0?i:R("size",o,r,{vgChannel:l}),h=a==="bar"&&(t==="x"?p==="vertical":p==="horizontal");return _(u)&&(U(u.bin)||oe(u.bin)||u.timeUnit&&!f)&&!(m&&!pn(m))&&!ee(g)?vb({fieldDef:u,fieldDef2:f,channel:t,model:e}):(k(u)&&ee(g)||h)&&!f?yb(u,t,e):Kl(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function bb(e,t,n,i,r){if(pn(r))if(n){const o=n.get("type");if(o==="band")return{scale:t,band:r.band};r.band!==1&&(O(xg(o)),r=void 0)}else return{mult:r.band,field:{group:e}};else{if(w(r))return r;if(r)return{value:r}}if(n){const o=n.get("range");if(jt(o)&&Y(o.step))return{value:o.step-2}}const s=tr(i.view,e);return{value:s-2}}function yb(e,t,n){const{markDef:i,encoding:r,config:s,stack:o}=n,a=i.orient,c=n.scaleName(t),l=n.getScaleComponent(t),u=de(t),f=ot(t),d=bd(t),g=n.scaleName(d),p=a==="horizontal"&&t==="y"||a==="vertical"&&t==="x";let m;(r.size||i.size)&&(p?m=te("size",n,{vgChannel:u,defaultRef:B(i.size)}):O(wg(i.type)));const h=Nc({channel:t,fieldDef:e,markDef:i,config:s,scaleType:l==null?void 0:l.get("type"),useVlSizeChannel:p});m=m||{[u]:bb(u,g||c,l,s,h)};const v=(l==null?void 0:l.get("type"))!=="band"||!("band"in m[u])?"middle":"top",b=Yl(t,i,s,v),x=b==="xc"||b==="yc",{offset:$,offsetType:N}=ni({channel:t,markDef:i,encoding:r,model:n,bandPosition:x?.5:0}),C=vs({channel:t,channelDef:e,markDef:i,config:s,scaleName:c,scale:l,stack:o,offset:$,defaultRef:ao({model:n,defaultPos:"mid",channel:t,scaleName:c,scale:l}),bandPosition:x?N==="encoding"?0:.5:w(h)?{signal:`(1-${h})/2`}:pn(h)?(1-h.band)/2:0});if(u)return Object.assign({[b]:C},m);{const E=Ot(f),A=m[u],X=$?Object.assign(Object.assign({},A),{offset:$}):A;return{[b]:C,[E]:j(C)?[C[0],Object.assign(Object.assign({},C[1]),{offset:X})]:Object.assign(Object.assign({},C),{offset:X})}}}function ii(e,t,n,i,r){if(fa(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(w(n)||w(r)||w(i)){const o=lt(n),a=lt(r),c=lt(i),l=c?`${c} + `:"",u=o?`(${o} ? -1 : 1) * `:"",f=a?`(${a} + ${s})`:s;return{signal:l+u+f}}else return r=r||0,i+(n?-r-s:+r+s)}function vb({fieldDef:e,fieldDef2:t,channel:n,model:i}){var r,s,o;const{config:a,markDef:c,encoding:l}=i,u=i.getScaleComponent(n),f=i.scaleName(n),d=u?u.get("type"):void 0,g=u.get("reverse"),p=Nc({channel:n,fieldDef:e,markDef:c,config:a,scaleType:d}),m=(r=i.component.axes[n])===null||r===void 0?void 0:r[0],h=(s=m==null?void 0:m.get("translate"))!==null&&s!==void 0?s:.5,v=ne(n)&&((o=R("binSpacing",c,a))!==null&&o!==void 0)?o:0,b=ot(n),x=Ot(n),$=Ot(b),{offset:N}=ni({channel:n,markDef:c,encoding:l,model:i,bandPosition:0}),C=w(p)?{signal:`(1-${p.signal})/2`}:pn(p)?(1-p.band)/2:.5;if(U(e.bin)||e.timeUnit)return{[$]:Ql({fieldDef:e,scaleName:f,bandPosition:C,offset:ii(b,v,g,h,N)}),[x]:Ql({fieldDef:e,scaleName:f,bandPosition:w(C)?{signal:`1-${C.signal}`}:1-C,offset:ii(n,v,g,h,N)})};if(oe(e.bin)){const E=Ht(e,f,{},{offset:ii(b,v,g,h,N)});if(_(t))return{[$]:E,[x]:Ht(t,f,{},{offset:ii(n,v,g,h,N)})};if(Mt(e.bin)&&e.bin.step)return{[$]:E,[x]:{signal:`scale("${f}", ${S(e,{expr:"datum"})} + ${e.bin.step})`,offset:ii(n,v,g,h,N)}}}O(Xa(b));return}function Ql({fieldDef:e,scaleName:t,bandPosition:n,offset:i}){return Li({scaleName:t,fieldOrDatumDef:e,bandPosition:n,offset:i})}const Ob=new Set(["aria","width","height"]);function je(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?Xl(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},xb(e.markDef,t)),Zl(e,"fill",n)),Zl(e,"stroke",i)),te("opacity",e)),te("fillOpacity",e)),te("strokeOpacity",e)),te("strokeWidth",e)),te("strokeDash",e)),fb(e)),ql(e)),oo(e,"href")),cb(e))}function Zl(e,t,n){const{config:i,mark:r,markDef:s}=e,o=R("invalid",s,i);if(o==="hide"&&n&&!wt(r)){const a=_b(e,{invalid:!0,channels:ki});if(a)return{[t]:[{test:a,value:null},...V(n)]}}return n?{[t]:n}:{}}function xb(e,t){return Rd.reduce((n,i)=>(!Ob.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=B(e[i])),n),{})}function _b(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const c=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&ye(c)&&(s[l]=!0)}return s},{}),r=y(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>Os(o,t)).join(` ${s} `)}return}function co(e){const{config:t,markDef:n}=e,i=R("invalid",n,t);if(i){const r=Sb(e,{channels:We});if(r)return{defined:{signal:r}}}return{}}function Sb(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const c=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&ye(c)&&(s[l]=!0)}return s},{}),r=y(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>Os(o,t)).join(` ${s} `)}return}function Jl(e,t){return t!==void 0?{[e]:B(t)}:void 0}const lo="voronoi",eu={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(lo)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if(wt(s))return O(Bd(s)),n;const o={name:e.getName(lo),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},ql(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,c=!1;return n.forEach((l,u)=>{var f;const d=(f=l.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?a=u:d.indexOf(lo)>=0&&(c=!0)}),c||n.splice(a+1,0,o),n}},tu={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!Ws(e.bind),parse:(e,t,n)=>fu(t,n),topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,o=t.init&&t.init[0],a=eu.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((c,l)=>{var u,f;const d=q(`${i}_${c.field}`),g=n.filter(p=>p.name===d);g.length||n.unshift(Object.assign(Object.assign({name:d},o?{init:On(o[l])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${z(c.field)}] : null`}]:[],bind:(f=(u=s[c.field])!==null&&u!==void 0?u:s[c.channel])!==null&&f!==void 0?f:s}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.filter(l=>l.name===i+Ft)[0],o=i+ti,a=r.items.map(l=>q(`${i}_${l.field}`)),c=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(s.update=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},cr="_toggle",nu={defined:e=>e.type==="point"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+cr,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Ft,i=t.name+cr;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${Sn(e)}}, `)+`${i} ? ${n} : null`}},jb={defined:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t)=>{t.clear&&(t.clear=F(t.clear)?nn(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if(tu.defined(t))for(const i of t.project.items){const r=n.findIndex(s=>s.name===q(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const r of t.project.items){const s=n.findIndex(o=>o.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(s=>s.name===t.name+Ft);i(r,"null"),nu.defined(t)&&(r=n.findIndex(s=>s.name===t.name+cr),i(r,"false"))}return n}},iu={defined:e=>{const t=e.resolve==="global"&&e.bind&&Ws(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Jn;return t&&!n&&O(Gd),t&&n},parse:(e,t,n)=>{var i;const r=P(n);if(r.select=F(r.select)?{type:r.select,toggle:t.toggle}:Object.assign(Object.assign({},r.select),{toggle:t.toggle}),fu(t,r),ea(n.select)&&(n.select.on||n.select.clear)){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const c of t.events)c.filter=V((i=c.filter)!==null&&i!==void 0?i:[]),c.filter.includes(a)||c.filter.push(a)}const s=Bs(t.bind)?t.bind.legend:"click",o=F(s)?nn(s,"view"):V(s);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=Bs(t.bind)&&t.bind.legend,s=o=>a=>{const c=P(a);return c.markname=o,c};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${q(o.field)}_legend`,c=`${i}_${a}`,l=n.filter(u=>u.name===c);if(l.length===0){const u=r.merge.map(s(`${a}_symbols`)).concat(r.merge.map(s(`${a}_labels`))).concat(r.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:c},t.init?{}:{value:null}),{on:[{events:u,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${c}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(d=>d.name===i+Ft),o=i+ti,a=r.items.filter(d=>d.hasLegend).map(d=>q(`${i}_${q(d.field)}_legend`)),c=a.map(d=>`${d} !== null`).join(" && "),l=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const u=n.find(d=>d.name===i+cr),f=Bs(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:f})):u.on[0].events=f),n}};function wb(e,t,n){var i,r,s,o;const a=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;for(const c of ie((r=e.component.selection)!==null&&r!==void 0?r:{})){const l=(s=c.project.hasField[a])!==null&&s!==void 0?s:c.project.hasChannel[t];if(l&&iu.defined(c)){const u=(o=n.get("selections"))!==null&&o!==void 0?o:[];u.push(c.name),n.set("selections",u,!1),l.hasLegend=!0}}}const ru="_translate_anchor",su="_translate_delta",$b={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Nt.defined(t),s=i+ru,{x:o,y:a}=t.project.hasChannel;let c=nn(t.translate,"scope");return r||(c=c.map(l=>(l.between[0].markname=i+xn,l))),n.push({name:s,value:{},on:[{events:c.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?`, extent_x: ${r?io(e,G):`slice(${o.signals.visual})`}`:"")+(a!==void 0?`, extent_y: ${r?io(e,J):`slice(${a.signals.visual})`}`:"")+"}"}]},{name:i+su,value:{},on:[{events:c,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&ou(e,t,o,"width",n),a!==void 0&&ou(e,t,a,"height",n),n}};function ou(e,t,n,i,r){var s,o;const a=t.name,c=a+ru,l=a+su,u=n.channel,f=Nt.defined(t),d=r.filter(E=>E.name===n.signals[f?"data":"visual"])[0],g=e.getSizeSignalRef(i).signal,p=e.getScaleComponent(u),m=p.get("type"),h=p.get("reverse"),v=f?u===G?h?"":"-":h?"-":"":"",b=`${c}.extent_${u}`,x=`${v}${l}.${u} / ${f?`${g}`:`span(${b})`}`,$=f?m==="log"?"panLog":m==="symlog"?"panSymlog":m==="pow"?"panPow":"panLinear":"panLinear",N=f?m==="pow"?`, ${(s=p.get("exponent"))!==null&&s!==void 0?s:1}`:m==="symlog"?`, ${(o=p.get("constant"))!==null&&o!==void 0?o:1}`:"":"",C=`${$}(${b}, ${x}${N})`;d.on.push({events:{signal:l},update:f?C:`clampRange(${C}, 0, ${g})`})}const au="_zoom_anchor",cu="_zoom_delta",Eb={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Nt.defined(t),s=i+cu,{x:o,y:a}=t.project.hasChannel,c=z(e.scaleName(G)),l=z(e.scaleName(J));let u=nn(t.zoom,"scope");return r||(u=u.map(f=>(f.markname=i+xn,f))),n.push({name:i+au,on:[{events:u,update:r?"{"+[c?`x: invert(${c}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:u,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&lu(e,t,o,"width",n),a!==void 0&&lu(e,t,a,"height",n),n}};function lu(e,t,n,i,r){var s,o;const a=t.name,c=n.channel,l=Nt.defined(t),u=r.filter($=>$.name===n.signals[l?"data":"visual"])[0],f=e.getSizeSignalRef(i).signal,d=e.getScaleComponent(c),g=d.get("type"),p=l?io(e,c):u.name,m=a+cu,h=`${a}${au}.${c}`,v=l?g==="log"?"zoomLog":g==="symlog"?"zoomSymlog":g==="pow"?"zoomPow":"zoomLinear":"zoomLinear",b=l?g==="pow"?`, ${(s=d.get("exponent"))!==null&&s!==void 0?s:1}`:g==="symlog"?`, ${(o=d.get("constant"))!==null&&o!==void 0?o:1}`:"":"",x=`${v}(${p}, ${h}, ${m}${b})`;u.on.push({events:{signal:m},update:l?x:`clampRange(${x}, 0, ${f})`})}const Xt="_store",Ft="_tuple",kb="_modify",uu="vlSelectionResolve",lr=[ab,sb,ib,nu,tu,Nt,iu,jb,$b,Eb,eu];function Cb(e){let t=e.parent;for(;t&&!Fe(t);)t=t.parent;return t}function Sn(e,{escape:t}={escape:!0}){let n=t?z(e.name):e.name;const i=Cb(e);if(i){const{facet:r}=i;for(const s of _e)r[s]&&(n+=` + '__facet_${s}_' + (facet[${z(i.vgField(s))}])`)}return n}function uo(e){var t;return ie((t=e.component.selection)!==null&&t!==void 0?t:{}).reduce((n,i)=>n||i.project.items.some(r=>r.field===Jn),!1)}function fu(e,t){(yi(t.select)||!t.select.on)&&delete e.events,(yi(t.select)||!t.select.clear)&&delete e.clear,(yi(t.select)||!t.select.toggle)&&delete e.toggle}function fo(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...fo(e.object)),t.push(...fo(e.property))),t)}function du(e){return e.object.type==="MemberExpression"?du(e.object):e.object.name==="datum"}function gu(e){const t=Tf(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&du(i)&&n.add(fo(i).slice(1).join("."))}),n}class jn extends D{constructor(t,n,i){super(t);this.model=n,this.filter=i,this.expr=ur(this.model,this.filter,this),this._dependentFields=gu(this.expr)}clone(){return new jn(null,this.model,P(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function Nb(e,t){var n;const i={},r=e.config.selection;if(!t||!t.length)return i;for(const s of t){const o=q(s.name),a=s.select,c=F(a)?a:a.type,l=H(a)?P(a):{type:c},u=r[c];for(const d in u){if(d==="fields"||d==="encodings")continue;d==="mark"&&(l[d]=Object.assign(Object.assign({},u[d]),l[d])),(l[d]===void 0||l[d]===!0)&&(l[d]=(n=u[d])!==null&&n!==void 0?n:l[d])}const f=i[o]=Object.assign(Object.assign({},l),{name:o,type:c,init:s.value,bind:s.bind,events:F(l.on)?nn(l.on,"scope"):V(P(l.on))});for(const d of lr)d.defined(f)&&d.parse&&d.parse(e,f,s)}return i}function pu(e,t,n,i="datum"){const r=F(t)?t:t.param,s=q(r),o=z(s+Xt);let a;try{a=e.getSelectionComponent(s,r)}catch(u){return`!!${s}`}if(a.project.timeUnit){const u=n??e.component.data.raw,f=a.project.timeUnit.clone();u.parent?f.insertAsParentOf(u):u.parent=f}const c=`vlSelectionTest(${o}, ${i}${a.resolve==="global"?")":`, ${z(a.resolve)})`}`,l=`length(data(${o}))`;return t.empty===!1?`${l} && ${c}`:`!${l} || ${c}`}function hu(e,t,n){const i=q(t),r=n.encoding;let s=n.field,o;try{o=e.getSelectionComponent(i,t)}catch(a){return i}if(!r&&!s)s=o.project.items[0].field,o.project.items.length>1&&O(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${z(s)}.`);else if(r&&!s){const a=o.project.items.filter(c=>c.channel===r);!a.length||a.length>1?(s=o.project.items[0].field,O((a.length?"Multiple ":"No ")+`matching ${z(r)} encoding found for selection ${z(n.param)}. Using "field": ${z(s)}.`)):s=a[0].field}return`${o.name}[${z(Oe(s))}]`}function Pb(e,t){var n;for(const[i,r]of pt((n=e.component.selection)!==null&&n!==void 0?n:{})){const s=e.getName(`lookup_${i}`);e.component.data.outputNodes[s]=r.materialized=new le(new jn(t,e,{param:i}),s,W.Lookup,e.component.data.outputNodeRefCounts)}}function ur(e,t,n){return Ln(t,i=>F(i)?i:ap(i)?pu(e,i,n):nc(i))}var fr=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Fb(e,t){return e?j(e)&&!St(e)?e.map(n=>Ps(n,t)).join(", "):e:void 0}function go(e,t,n,i){var r,s,o,a,c;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(s=(a=e.encode)[t])!==null&&s!==void 0||(a[t]={}),(o=(c=e.encode[t]).update)!==null&&o!==void 0||(c.update={}),e.encode[t].update[n]=i}function ri(e,t,n,i={header:!1}){var r,s;const o=e.combine(),{disable:a,orient:c,scale:l,labelExpr:u,title:f,zindex:d}=o,g=fr(o,["disable","orient","scale","labelExpr","title","zindex"]);if(a)return;for(const p in g){const m=uh[p],h=g[p];if(m&&m!==t&&m!=="both")delete g[p];else if(Zn(h)){const{condition:v}=h,b=fr(h,["condition"]),x=V(v),$=Dc[p];if($){const{vgProp:N,part:C}=$,E=[...x.map(A=>{const{test:X}=A,Ae=fr(A,["test"]);return Object.assign({test:ur(null,X)},Ae)}),b];go(g,C,N,E),delete g[p]}else if($===null){const N={signal:x.map(C=>{const{test:E}=C,A=fr(C,["test"]);return`${ur(null,E)} ? ${Ea(A)} : `}).join("")+Ea(b)};g[p]=N}}else if(w(h)){const v=Dc[p];if(v){const{vgProp:b,part:x}=v;go(g,x,b,h),delete g[p]}}I(["labelAlign","labelBaseline"],p)&&g[p]===null&&delete g[p]}if(t==="grid"){if(!g.grid)return;if(g.encode){const{grid:p}=g.encode;g.encode=Object.assign({},p?{grid:p}:{}),L(g.encode)&&delete g.encode}return Object.assign(Object.assign({scale:l,orient:c},g),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:K(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(u!==void 0){let m=u;((s=(r=g.encode)===null||r===void 0?void 0:r.labels)===null||s===void 0?void 0:s.update)&&w(g.encode.labels.update.text)&&(m=zt(u,"datum.label",g.encode.labels.update.text.signal)),go(g,"labels","text",{signal:m})}if(g.labelAlign===null&&delete g.labelAlign,g.encode){for(const m of Mc)e.hasAxisPart(m)||delete g.encode[m];L(g.encode)&&delete g.encode}const p=Fb(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:c,grid:!1},p?{title:p}:{}),g),n.aria===!1?{aria:!1}:{}),{zindex:K(d,0)})}}function mu(e){const{axes:t}=e.component,n=[];for(const i of We)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function Ab(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>ri(r,"grid",t)),...i.map(r=>ri(r,"grid",t)),...n.map(r=>ri(r,"main",t)),...i.map(r=>ri(r,"main",t))].filter(r=>r)}function bu(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},c=new Set([...y(o),...y(a)]),l={};for(const u of c.values())l[u]={signal:`${i.signal} === "${s}" ? ${lt(o[u])} : ${lt(a[u])}`};return l}return t[r]})])}function Tb(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:ac(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=w(n)?"axisOrient":`axis${Dn(n)}`,a=[...r,...r.map(l=>s+l.substr(4))],c=["axis",o,s];return{vlOnlyAxisConfig:bu(a,i,e,n),vgAxisConfig:bu(c,i,e,n),axisConfigStyle:Ib([...c,...a],i)}}function Ib(e,t){var n;const i=[{}];for(const r of e){let s=(n=t[r])===null||n===void 0?void 0:n.style;if(s){s=V(s);for(const o of s)i.push(t.style[o])}}return Object.assign.apply(null,i)}function po(e,t,n,i={}){var r;const s=Ca(e,n,t);if(s!==void 0)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const yu={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return Oc(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return xc(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return(i=t.grid)!==null&&i!==void 0?i:zb(n,e)},gridScale:({model:e,channel:t})=>Rb(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||Ou(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||vu(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:Db(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:Mb(t.type,n,_(t)&&!!t.timeUnit,_(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var s;const o=e==="x"?"width":e==="y"?"height":void 0,a=o?t.getSizeSignalRef(o):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:Wb({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=xu(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return Pa(r?[kc(r)]:[],_(o)?[kc(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Bb(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:Hb(n,t)}};function zb(e,t){return!ee(e)&&_(t)&&!U(t==null?void 0:t.bin)&&!oe(t==null?void 0:t.bin)}function Rb(e,t){const n=t==="x"?"y":"x";return e.getScaleComponent(n)?e.scaleName(n):void 0}function Lb(e,t,n,i,r){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return w(s)?s:Mn(s);{const{configValue:o}=po("labelAngle",i,t==null?void 0:t.style,r);return o!==void 0?Mn(o):n===G&&I([gs,ds],e.type)&&!(_(e)&&e.timeUnit)?270:void 0}}function ho(e){return`(((${e.signal} % 360) + 360) % 360)`}function vu(e,t,n,i){if(e!==void 0)if(n==="x"){if(w(e)){const r=ho(e),s=w(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(w(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(w(e)){const r=ho(e),s=w(t)?`(${t.signal} === "left")`:t==="left",o=i?'"middle"':"null";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${o} : (45 <= ${r} && ${r} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(w(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}return}function Ou(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(w(e)){const o=ho(e),a=w(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${r?`(${o} + 90)`:o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${a} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(w(t)){const o=r<e&&e<180+r?"===":"!==",a=`${t.signal} ${o} "${s}"`;return{signal:`${a} ? "left" : "right"`}}return(r<e&&e<180+r)===(t===s)?"left":"right"}function Db(e,t){return t==="x"&&I(["quantitative","temporal"],e)?!0:void 0}function Mb(e,t,n,i){return n&&!H(i)||e!=="nominal"&&e!=="ordinal"?t==="log"||t==="symlog"?"greedy":!0:void 0}function Ub(e){return e==="x"?"bottom":"left"}function Wb({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!ee(t)&&t!=="log"){if(_(e)){if(U(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&I(["month","hours","day","quarter"],(r=ae(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}function xu(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;return s&&o?Fa(s,o):s||(o||(s!==void 0?s:o!==void 0?o:void 0))}function Bb(e,t){const n=e.values;return j(n)?Lc(t,n):w(n)?n:void 0}function Hb(e,t){return e==="rect"&&Hi(t)?1:0}class wn extends D{constructor(t,n){super(t);this.transform=n,this._dependentFields=gu(this.transform.calculate)}clone(){return new wn(null,P(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(!Gt(i))return;if(Ec(i.sort)){const{field:s,timeUnit:o}=i,a=i.sort,c=a.map((l,u)=>`${nc({field:s,timeUnit:o,equal:l})} ? ${u} : `).join("")+a.length;t=new wn(t,{calculate:c,as:$n(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${T(this.transform)}`}}function $n(e,t,n){return S(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function dr(e,t){return I(["top","bottom"],t)?"column":I(["left","right"],t)||e==="row"?"row":"column"}function En(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return K((t||{})[e],r[e],n.header[e])}function gr(e,t,n,i){const r={};for(const s of e){const o=En(s,t||{},n,i);o!==void 0&&(r[s]=o)}return r}const mo=["row","column"],bo=["header","footer"];function qb(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=gr(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),c=dr(t,a),l=Mn(o);return{name:`${t}-title`,type:"group",role:`${c}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),Su(l,c)),_u(c,l,s)),ju(i,r,t,Ah,ol))}}function _u(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=Ou(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function Su(e,t){const n=vu(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Gb(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of bo)if(n[r])for(const s of n[r]){const o=Xb(e,t,r,n,s);o!=null&&i.push(o)}return i}function Vb(e,t){var n;const{sort:i}=e;return qe(i)?{field:S(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:j(i)?{field:$n(e,t,{expr:"datum"}),order:"ascending"}:{field:S(e,{expr:"datum"}),order:i??"ascending"}}function yo(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:c}=gr(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=_s({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,u=dr(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:c?zt(zt(c,"datum.label",l),"datum.value",S(e,{expr:"parent"})):l}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),Su(s,u)),_u(u,s,o)),ju(n,e,t,Th,al))}function Xb(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=gr(["labelOrient"],o.header,a,t);(t==="row"&&!I(["top","bottom"],f)||t==="column"&&!I(["left","right"],f))&&(s=yo(o,t,a))}const c=Fe(e)&&!Yn(e.facet),l=r.axes,u=(l==null?void 0:l.length)>0;if(s||u){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(`${t}_domain`)},sort:Vb(o,t)}:{}),u&&c?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),u?{axes:l}:{})}}return null}const Yb={column:{start:0,end:1},row:{start:1,end:0}};function Kb(e,t){return Yb[t][e]}function Qb(e,t){const n={};for(const i of _e){const r=e[i];if(r==null?void 0:r.facetFieldDef){const{titleAnchor:s,titleOrient:o}=gr(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=dr(i,o),c=Kb(s,a);c!==void 0&&(n[a]=c)}}return L(n)?void 0:n}function ju(e,t,n,i,r){const s={};for(const o of i){if(!r[o])continue;const a=En(o,t==null?void 0:t.header,e,n);a!==void 0&&(s[r[o]]=a)}return s}function vo(e){return[...pr(e,"width"),...pr(e,"height"),...pr(e,"childWidth"),...pr(e,"childHeight")]}function pr(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(ee(o)&&jt(a)){const c=e.scaleName(n);if(Fe(e.parent)){const l=e.parent.component.resolve;if(l.scale[n]==="independent")return[wu(c,a)]}return[wu(c,a),{name:r,update:$u(c,s,`domain('${c}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=Vs(e.config.view,s?"width":"height"),c=`isFinite(${o}) ? ${o} : ${a}`;return[{name:r,init:c,on:[{update:c,events:"window:resize"}]}]}else return[{name:r,value:i}]}function wu(e,t){const n=`${e}_step`;return w(t.step)?{name:n,update:t.step.signal}:{name:n,value:t.step}}function $u(e,t,n){const i=t.get("type"),r=t.get("padding"),s=K(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${lt(o)}, ${lt(s)}) * ${e}_step`}function Eu(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function ku(e,t){return y(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),_n(t,r,i,s=>B(s.value)))},{})}function Cu(e,t){if(Fe(t))return e==="theta"?"independent":"shared";if(Nn(t))return"shared";if(Io(t))return ne(e)||e==="theta"||e==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function Oo(e,t){const n=e.scale[t],i=ne(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&O(Ng(t)),"independent"):e[i][t]||"shared"}const Zb=Object.assign(Object.assign({},Rh),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),Nu=y(Zb);class Jb extends dt{}const Pu={symbols:ey,gradient:ty,labels:ny,entries:iy};function ey(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){var o,a,c,l,u,f,d,g;if(s!=="symbol")return;const{markDef:p,encoding:m,config:h,mark:v}=n,b=p.filled&&v!=="trail";let x=Object.assign(Object.assign({},Md({},n,Ap)),Xl(n,{filled:b}));const $=(o=r.get("symbolOpacity"))!==null&&o!==void 0?o:h.legend.symbolOpacity,N=(a=r.get("symbolFillColor"))!==null&&a!==void 0?a:h.legend.symbolFillColor,C=(c=r.get("symbolStrokeColor"))!==null&&c!==void 0?c:h.legend.symbolStrokeColor,E=$===void 0?(l=Fu(m.opacity))!==null&&l!==void 0?l:p.opacity:void 0;if(x.fill){if(i==="fill"||b&&i===ue)delete x.fill;else if(x.fill.field)N?delete x.fill:(x.fill=B((u=h.legend.symbolBaseFillColor)!==null&&u!==void 0?u:"black"),x.fillOpacity=B(E??1));else if(j(x.fill)){const A=(g=(d=xo((f=m.fill)!==null&&f!==void 0?f:m.color))!==null&&d!==void 0?d:p.fill)!==null&&g!==void 0?g:b&&p.color;A&&(x.fill=B(A))}}if(x.stroke){if(i==="stroke"||!b&&i===ue)delete x.stroke;else if(x.stroke.field||C)delete x.stroke;else if(j(x.stroke)){const A=K(xo(m.stroke||m.color),p.stroke,b?p.color:void 0);A&&(x.stroke={value:A})}}if(i!==st){const A=_(t)&&Tu(n,r,t);A?x.opacity=[Object.assign({test:A},B(E??1)),B(h.legend.unselectedOpacity)]:E&&(x.opacity=B(E))}return x=Object.assign(Object.assign({},x),e),L(x)?void 0:x}function ty(e,{model:t,legendType:n,legendCmpt:i}){var r;if(n!=="gradient")return;const{config:s,markDef:o,encoding:a}=t;let c={};const l=(r=i.get("gradientOpacity"))!==null&&r!==void 0?r:s.legend.gradientOpacity,u=l===void 0?Fu(a.opacity)||o.opacity:void 0;return u&&(c.opacity=B(u)),c=Object.assign(Object.assign({},c),e),L(c)?void 0:c}function ny(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=_(t)?Tu(n,r,t):void 0,c=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:u}=s,f=qt(u)?Ss({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:u,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},c?{opacity:c}:{}),f?{text:f}:{}),e);return L(d)?void 0:d}function iy(e,{legendCmpt:t}){const n=t.get("selections");return(n==null?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function Fu(e){return Au(e,(t,n)=>Math.max(t,n.value))}function xo(e){return Au(e,(t,n)=>K(t,n.value))}function Au(e,t){return Zp(e)?V(e.condition).reduce(t,e.value):Ce(e)?e.value:void 0}function Tu(e,t,n){const i=t.get("selections");if(!(i==null?void 0:i.length))return;const r=z(n.field);return i.map(s=>{const o=z(q(s)+Xt);return`(!length(data(${o})) || (${s}[${r}] && indexof(${s}[${r}], datum.value) >= 0))`}).join(" || ")}const Iu={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return Oc(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return xc(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:uy(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:fy(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:sy(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>hn(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(cn(n)&&ke(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>ry(t,e)};function ry(e,t){const n=e.values;return j(n)?Lc(t,n):w(n)?n:void 0}function sy(e,t,n,i){var r;if(t!=="shape"){const s=(r=xo(n))!==null&&r!==void 0?r:i;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function oy(e){const{legend:t}=e;return K(t.type,ay(e))}function ay({channel:e,timeUnit:t,scaleType:n}){if(cn(e)){if(I(["quarter","month","day"],t))return"symbol";if(ke(n))return"gradient"}return"symbol"}function cy({legendConfig:e,legendType:t,orient:n,legend:i}){var r,s;return(s=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:ly(n,t)}function ly(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function uy({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:c}=e;return ke(r)?n==="horizontal"?i==="top"||i==="bottom"?zu(t,"width",o,s):o:zu(t,"height",c,a):void 0}function zu(e,t,n,i){const r=e.getSizeSignalRef(t).signal;return{signal:`clamp(${r}, ${n}, ${i})`}}function fy(e){return I(["quantile","threshold","log","symlog"],e)?"greedy":void 0}function Ru(e){const t=Q(e)?dy(e):my(e);return e.component.legends=t,t}function dy(e){const{encoding:t}=e,n={};for(const i of[ue,...ll]){const r=Z(t[i]);if(!r||!e.getScaleComponent(i))continue;if(i===fe&&_(r)&&r.type===dn)continue;n[i]=hy(e,i)}return n}function gy(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function py(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n==null?void 0:n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function hy(e,t){var n,i,r;let s=e.legend(t);const{markDef:o,encoding:a,config:c}=e,l=c.legend,u=new Jb({},gy(e,t));wb(e,t,u);const f=s!==void 0?!s:l.disable;if(u.set("disable",f,s!==void 0),f)return u;s=s||{};const d=e.getScaleComponent(t).get("type"),g=Z(a[t]),p=_(g)?(n=ae(g.timeUnit))===null||n===void 0?void 0:n.unit:void 0,m=s.orient||c.legend.orient||"right",h=oy({legend:s,channel:t,timeUnit:p,scaleType:d}),v=cy({legend:s,legendType:h,orient:m,legendConfig:l}),b={legend:s,channel:t,model:e,markDef:o,encoding:a,fieldOrDatumDef:g,legendConfig:l,config:c,scaleType:d,orient:m,legendType:h,direction:v};for(const E of Nu){if(h==="gradient"&&E.startsWith("symbol")||h==="symbol"&&E.startsWith("gradient"))continue;const A=E in Iu?Iu[E](b):s[E];if(A!==void 0){const X=py(A,E,s,e.fieldDef(t));(X||c.legend[E]===void 0)&&u.set(E,A,X)}}const x=(i=s==null?void 0:s.encoding)!==null&&i!==void 0?i:{},$=u.get("selections"),N={},C={fieldOrDatumDef:g,model:e,channel:t,legendCmpt:u,legendType:h};for(const E of["labels","legend","title","symbols","gradient","entries"]){const A=ku((r=x[E])!==null&&r!==void 0?r:{},e),X=E in Pu?Pu[E](A,C):A;X!==void 0&&!L(X)&&(N[E]=Object.assign(Object.assign(Object.assign({},($==null?void 0:$.length)&&_(g)?{name:`${q(g.field)}_legend_${E}`}:{}),($==null?void 0:$.length)?{interactive:!!$}:{}),{update:X}))}return L(N)||u.set("encode",N,!!(s==null?void 0:s.encoding)),u}function my(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){Ru(i);for(const r of y(i.component.legends))n.legend[r]=Oo(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=Lu(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of y(t))for(const r of e.children){if(!r.component.legends[i])continue;n.legend[i]==="shared"&&delete r.component.legends[i]}return t}function Lu(e,t){var n,i,r,s;if(!e)return t.clone();const o=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let c=!1;for(const l of Nu){const u=kt(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,d)=>{switch(l){case"symbolType":return by(f,d);case"title":return Aa(f,d);case"type":return c=!0,ve("symbol")}return rr(f,d,l,"legend")});e.setWithExplicit(l,u)}return c&&(((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient)&&Oi(e.implicit,["encode","gradient"]),((s=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||s===void 0?void 0:s.gradient)&&Oi(e.explicit,["encode","gradient"])),e}function by(e,t){return t.value==="circle"?t:e}var yy=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function vy(e,t,n,i){var r,s,o,a,c;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(s=(a=e.encode)[t])!==null&&s!==void 0||(a[t]={}),(o=(c=e.encode[t]).update)!==null&&o!==void 0||(c.update={}),e.encode[t].update[n]=i}function Du(e){const t=e.component.legends,n={};for(const r of y(t)){const s=e.getScaleComponent(r),o=M(s.get("domains"));if(n[o])for(const a of n[o]){const c=Lu(a,t[r]);c||n[o].push(t[r])}else n[o]=[t[r].clone()]}const i=ie(n).flat().map(r=>Oy(r,e.config)).filter(r=>r!==void 0);return i}function Oy(e,t){var n,i,r;const s=e.combine(),{disable:o,labelExpr:a,selections:c}=s,l=yy(s,["disable","labelExpr","selections"]);if(o)return;if(t.aria===!1&&l.aria==null&&(l.aria=!1),(n=l.encode)===null||n===void 0?void 0:n.symbols){const u=l.encode.symbols.update;u.fill&&u.fill.value!=="transparent"&&!u.stroke&&!l.stroke&&(u.stroke={value:"transparent"});for(const f of ll)l[f]&&delete u[f]}if(l.title||delete l.title,a!==void 0){let u=a;((r=(i=l.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&w(l.encode.labels.update.text)&&(u=zt(a,"datum.label",l.encode.labels.update.text.signal)),vy(l,"labels","text",{signal:u})}return l}function xy(e){return Nn(e)||Io(e)?_y(e):Mu(e)}function _y(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),Mu(e))}function Mu(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const c=w(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return I(o,c)||o.push(c),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const Sy=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Uu extends dt{constructor(t,n,i,r){super(Object.assign({},n),{name:t});this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function Wu(e){e.component.projection=Q(e)?jy(e):Ey(e)}function jy(e){var t;if(e.hasProjection){const n=ge(e.specifiedProjection),i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=i?wy(e):void 0,o=new Uu(e.projectionName(!0),Object.assign(Object.assign({},(t=ge(e.config.projection))!==null&&t!==void 0?t:{}),n??{}),r,s);return o.get("type")||o.set("type","equalEarth",!1),o}return}function wy(e){const t=[],{encoding:n}=e;for(const i of[[De,Le],[xe,Ee]])(Z(n[i[0]])||Z(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(fe)&&e.typedFieldDef(fe).type===dn&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(W.Main)),t}function $y(e,t){const n=Tr(Sy,r=>!en(e.explicit,r)&&!en(t.explicit,r)?!0:!!(en(e.explicit,r)&&en(t.explicit,r)&&Te(e.get(r),t.get(r)))),i=Te(e.size,t.size);if(i){if(n)return e;if(Te(e.explicit,{}))return t;if(Te(t.explicit,{}))return e}return null}function Ey(e){if(e.children.length===0)return;let t;for(const i of e.children)Wu(i);const n=Tr(e.children,i=>{const r=i.component.projection;if(r)if(t){const s=$y(t,r);return s&&(t=s),!!s}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new Uu(i,t.specifiedProjection,t.size,P(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),i),o.merged=!0)}return r}return}var ky=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Cy(e,t,n,i){var r,s;if(Qn(t,n)){const o=Q(e)?(s=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&s!==void 0?s:{}:{},a=S(t,{expr:"datum"}),c=S(t,{expr:"datum",binSuffix:"end"});return{formulaAs:S(t,{binSuffix:"range",forAs:!0}),formula:Di(a,c,o.format,o.formatType,i)}}return{}}function Bu(e,t){return`${_a(e)}_${t}`}function Ny(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function _o(e,t,n){var i;const r=(i=Vi(n,void 0))!==null&&i!==void 0?i:{},s=Bu(r,t);return e.getName(`${s}_bins`)}function Py(e){return"as"in e}function Hu(e,t,n){let i,r;Py(e)?i=F(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[S(e,{forAs:!0}),S(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},Vi(t,void 0)),o=Bu(s,e.field),{signal:a,extentSignal:c}=Ny(n,o);if(Ci(s.extent)){const u=s.extent;r=hu(n,u.param,u),delete s.extent}const l=Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[i]},a?{signal:a}:{}),c?{extentSignal:c}:{}),r?{span:r}:{});return{key:o,binComponent:l}}class Ze extends D{constructor(t,n){super(t);this.bins=n}clone(){return new Ze(null,P(this.bins))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{if(Se(s)&&U(s.bin)){const{key:a,binComponent:c}=Hu(s,s.bin,n);r[a]=Object.assign(Object.assign(Object.assign({},c),r[a]),Cy(n,s,o,n.config))}return r},{});return L(i)?null:new Ze(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:s}=Hu(n,n.bin,i);return new Ze(t,{[r]:s})}merge(t,n){for(const i of y(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=Ie([...this.bins[i].as,...t.bins[i].as],T)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(ie(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(ie(this.bins).map(t=>t.field))}hash(){return`Bin ${T(this.bins)}`}assemble(){return ie(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,s=t.bin,{extent:o}=s,a=ky(s,["extent"]),c=Object.assign(Object.assign(Object.assign({type:"bin",field:Oe(t.field),as:i,signal:t.signal},Ci(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(n.push({type:"extent",field:Oe(t.field),signal:t.extentSignal}),c.extent={signal:t.extentSignal}),n.push(c);for(const l of r)for(let u=0;u<2;u++)n.push({type:"formula",expr:S({field:i[u]},{expr:"datum"}),as:l[u]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function Fy(e,t,n,i){var r;const s=Q(i)?i.encoding[ot(t)]:void 0;if(Se(n)&&Q(i)&&Pc(n,s,i.markDef,i.config))e.add(S(n,{})),e.add(S(n,{suffix:"end"})),n.bin&&Qn(n,t)&&e.add(S(n,{binSuffix:"range"}));else if(ud(t)){const o=ld(t);e.add(i.getName(o))}else e.add(S(n));return Gt(n)&&xp((r=n.scale)===null||r===void 0?void 0:r.range)&&e.add(n.scale.range.field),e}function Ay(e,t){var n;for(const i of y(t)){const r=t[i];for(const s of y(r))i in e?e[i][s]=new Set([...(n=e[i][s])!==null&&n!==void 0?n:[],...r[s]]):e[i]={[s]:r[s]}}}class Ne extends D{constructor(t,n,i){super(t);this.dimensions=n,this.measures=i}clone(){return new Ne(null,new Set(this.dimensions),P(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(o=>{o.aggregate&&(i=!0)});const r={},s=new Set;return i?(n.forEachFieldDef((o,a)=>{var c,l,u,f;const{aggregate:d,field:g}=o;if(d)if(d==="count")(c=r["*"])!==null&&c!==void 0||(r["*"]={}),r["*"].count=new Set([S(o,{forAs:!0})]);else{if(at(d)||_t(d)){const p=at(d)?"argmin":"argmax",m=d[p];(l=r[m])!==null&&l!==void 0||(r[m]={}),r[m][p]=new Set([S({op:p,field:m},{forAs:!0})])}else(u=r[g])!==null&&u!==void 0||(r[g]={}),r[g][d]=new Set([S(o,{forAs:!0})]);xt(a)&&n.scaleDomain(a)==="unaggregated"&&((f=r[g])!==null&&f!==void 0||(r[g]={}),r[g].min=new Set([S({field:g,aggregate:"min"},{forAs:!0})]),r[g].max=new Set([S({field:g,aggregate:"max"},{forAs:!0})]))}else Fy(s,a,o,n)}),s.size+y(r).length===0?null:new Ne(t,s,r)):null}static makeFromTransform(t,n){var i,r,s;const o=new Set,a={};for(const c of n.aggregate){const{op:l,field:u,as:f}=c;l&&(l==="count"?((i=a["*"])!==null&&i!==void 0||(a["*"]={}),a["*"].count=new Set([f||S(c,{forAs:!0})])):((r=a[u])!==null&&r!==void 0||(a[u]={}),a[u][l]=new Set([f||S(c,{forAs:!0})])))}for(const c of(s=n.groupby)!==null&&s!==void 0?s:[])o.add(c);return o.size+y(a).length===0?null:new Ne(t,o,a)}merge(t){return ra(this.dimensions,t.dimensions)?(Ay(this.measures,t.measures),!0):(Gg("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...y(this.measures)])}producedFields(){const t=new Set;for(const n of y(this.measures))for(const i of y(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${T({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const s of y(this.measures))for(const o of y(this.measures[s]))for(const a of this.measures[s][o])i.push(a),t.push(o),n.push(s==="*"?null:Oe(s));const r={type:"aggregate",groupby:[...this.dimensions].map(Oe),ops:t,fields:n,as:i};return r}}class kn extends D{constructor(t,n,i,r){super(t);this.model=n,this.name=i,this.data=r;for(const s of _e){const o=n.facet[s];if(o){const{bin:a,sort:c}=o;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[S(o),...U(a)?[S(o,{binSuffix:"end"})]:[]]},qe(c)?{sortField:c}:j(c)?{sortIndexField:$n(o,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of _e)this[n]&&(t+=` ${n.charAt(0)}:${T(this[n])}`);return t}get fields(){var t;const n=[];for(const i of _e)((t=this[i])===null||t===void 0?void 0:t.fields)&&n.push(...this[i].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of _e)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of We){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(ee(r)&&jt(s)){const o=mr(this.childModel,n),a=Fo(o);a?t[n]=a:O(Qr(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x",facet:void 0}[t],s=[],o=[],a=[];r&&i&&i[r]&&(n?(s.push(`distinct_${i[r]}`),o.push("max")):(s.push(i[r]),o.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:c,sortIndexField:l}=this[t];if(c){const{op:u=Mi,field:f}=c;s.push(f),o.push(u),a.push(S(c,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var n,i;const{columns:r}=this.model.layout,{layoutHeaders:s}=this.model.component,o=[],a={};for(const u of mo){for(const f of bo){const d=(n=s[u]&&s[u][f])!==null&&n!==void 0?n:[];for(const g of d)if(((i=g.axes)===null||i===void 0?void 0:i.length)>0){a[u]=!0;break}}if(a[u]){const f=`length(data("${this.facet.name}"))`,d=u==="row"?r?{signal:`ceil(${f} / ${r})`}:1:r?{signal:`min(${f}, ${r})`}:{signal:f};o.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:d}]})}}const{row:c,column:l}=a;return(c||l)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,n;const i=[];let r=null;const s=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:c}=this;if(o&&a&&(s.x||s.y)){r=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),u=l.map(()=>"distinct");i.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:u}]})}for(const l of[tt,et])this[l]&&i.push(this.assembleRowColumnHeaderData(l,r,s));if(c){const l=this.assembleFacetHeaderData(s);l&&i.push(...l)}return i}}function qu(e){return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function Ty(e,t){const n=Lr(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.startsWith("date:")){const i=qu(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.startsWith("utc:")){const i=qu(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return O(Jd(t)),null}function Iy(e){const t={};return vi(e.filter,n=>{var i;if(tc(n)){let r=null;rs(n)?r=be(n.equal):os(n)?r=be(n.lte):ss(n)?r=be(n.lt):as(n)?r=be(n.gt):cs(n)?r=be(n.gte):ls(n)?r=n.range[0]:us(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(Wt(r)?t[n.field]="date":Y(r)?t[n.field]="number":F(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function zy(e){const t={};function n(i){bn(i)?t[i.field]="date":i.type==="quantitative"&&Nd(i.aggregate)?t[i.field]="number":on(i.field)>1?i.field in t||(t[i.field]="flatten"):Gt(i)&&qe(i.sort)&&on(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((Q(e)||Fe(e))&&e.forEachFieldDef((i,r)=>{if(Se(i))n(i);else{const s=Dt(r),o=e.fieldDef(s);n(Object.assign(Object.assign({},i),{type:o.type}))}}),Q(e)){const{mark:i,markDef:r,encoding:s}=e;if(wt(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",a=s[o];_(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function Ry(e){const t={};if(Q(e)&&e.component.selection)for(const n of y(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&on(r.field)>1&&(t[r.field]="flatten")}return t}class se extends D{constructor(t,n){super(t);this._parse=n}clone(){return new se(null,P(this._parse))}hash(){return`Parse ${T(this._parse)}`}static makeExplicit(t,n,i){var r;let s={};const o=n.data;return!Ct(o)&&((r=o==null?void 0:o.format)===null||r===void 0?void 0:r.parse)&&(s=o.format.parse),this.makeWithAncestors(t,s,{},i)}static makeWithAncestors(t,n,i,r){for(const a of y(i)){const c=r.getWithExplicit(a);c.value!==void 0&&(c.explicit||c.value===i[a]||c.value==="derived"||i[a]==="flatten"?delete i[a]:O(Ma(a,i[a],c.value)))}for(const a of y(n)){const c=r.get(a);c!==void 0&&(c===n[a]?delete n[a]:O(Ma(a,n[a],c)))}const s=new dt(n,i);r.copyAll(s);const o={};for(const a of y(s.combine())){const c=s.get(a);c!==null&&(o[a]=c)}return y(o).length===0||r.parseNothing?null:new se(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of y(this._parse)){const i=this._parse[n];on(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(y(this._parse))}dependentFields(){return new Set(y(this._parse))}assembleTransforms(t=!1){return y(this._parse).filter(n=>t?on(n)>1:!0).map(n=>{const i=Ty(n,this._parse[n]);if(!i)return null;const r={type:"formula",expr:i,as:Dr(n)};return r}).filter(n=>n!==null)}}class At extends D{clone(){return new At(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([Jn])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Jn}}}class si extends D{constructor(t,n){super(t);this.params=n}clone(){return new si(null,this.params)}dependentFields(){return new Set}producedFields(){return}hash(){return`Graticule ${T(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class oi extends D{constructor(t,n){super(t);this.params=n}clone(){return new oi(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${T(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class Yt extends D{constructor(t){super(null);t??(t={name:"source"});let n;if(Ct(t)||(n=t.format?Object.assign({},me(t.format,["parse"])):{}),ei(t))this._data={values:t.values};else if(vn(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];I(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else Ul(t)?this._data={values:[{type:"Sphere"}]}:(Dl(t)||Ct(t))&&(this._data={});this._generator=Ct(t),t.name&&(this._name=t.name),n&&!L(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){return}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var Gu=function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},Ly=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},ai;function So(e){return e instanceof Yt||e instanceof si||e instanceof oi}class jo{constructor(){ai.set(this,void 0),Gu(this,ai,!1,"f")}setModified(){Gu(this,ai,!0,"f")}get modifiedFlag(){return Ly(this,ai,"f")}}ai=new WeakMap;class Kt extends jo{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const n=this.getNodeDepths(t,0,new Map),i=[...n.entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class wo extends jo{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class Dy extends wo{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of y(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class My extends wo{constructor(t){super();this.requiresSelectionId=t&&uo(t)}run(t){t instanceof At&&(this.requiresSelectionId&&(So(t.parent)||t.parent instanceof Ne||t.parent instanceof se)||(this.setModified(),t.remove()))}}class Uy extends jo{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof Qe&&(i=t.producedFields(),Ir(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class Wy extends wo{constructor(){super()}run(t){t instanceof le&&!t.isRequired()&&(this.setModified(),t.remove())}}class By extends Kt{run(t){if(So(t))return;if(t.numChildren()>1)return;for(const n of t.children)if(n instanceof se)if(t instanceof se)this.setModified(),t.merge(n);else{if(Rr(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}return}}class Hy extends Kt{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof se);if(t.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const o of i){const a=o.parse;for(const c of y(a))c in r?r[c]!==a[c]&&s.add(c):r[c]=a[c]}for(const o of s)delete r[o];if(!L(r)){this.setModified();const o=new se(t,r);for(const a of n){if(a instanceof se)for(const c of y(r))delete a.parse[c];t.removeChild(a),a.parent=o,a instanceof se&&y(a.parse).length===0&&a.remove()}}}}}class qy extends Kt{run(t){t instanceof le||t.numChildren()>0||t instanceof kn||(t instanceof Yt||(this.setModified(),t.remove()))}}class Gy extends Kt{run(t){const n=t.children.filter(r=>r instanceof Qe),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class Vy extends Kt{run(t){const n=t.children.filter(r=>r instanceof Ne),i={};for(const r of n){const s=T(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of y(i)){const s=i[r];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(t.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class Xy extends Kt{constructor(t){super();this.model=t}run(t){const n=!(So(t)||t instanceof jn||t instanceof se||t instanceof At),i=[],r=[];for(const s of t.children)s instanceof Ze&&(n&&!Rr(t.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof Ze?t.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class Yy extends Kt{run(t){const n=[...t.children],i=It(n,o=>o instanceof le);if(!i||t.numChildren()<=1)return;const r=[];let s;for(const o of n)if(o instanceof le){let a=o;for(;a.numChildren()===1;){const[c]=a.children;if(c instanceof le)a=c;else break}r.push(...a.children),s?(t.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else r.push(o);if(r.length){this.setModified();for(const o of r)o.parent.removeChild(o),o.parent=s}}}class Qt extends D{constructor(t,n){super(t);this.transform=n}clone(){return new Qt(null,P(this.transform))}addDimensions(t){this.transform.groupby=Ie(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:S(t)}hash(){return`JoinAggregateTransform ${T(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},r!==void 0?{groupby:r}:{})}}function Ky(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=S(i);return r&&t.push(r),t},[])}function Qy(e){return j(e)&&e.every(t=>F(t))&&e.length>1}class gt extends D{constructor(t,n){super(t);this._stack=n}clone(){return new gt(null,P(this._stack))}static makeFromTransform(t,n){const{stack:i,groupby:r,as:s,offset:o="zero"}=n,a=[],c=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),c.push(K(f.order,"ascending"));const l={field:a,order:c};let u;return Qy(s)?u=s:F(s)?u=[s,`${s}_end`]:u=[`${n.stack}_start`,`${n.stack}_end`],new gt(t,{dimensionFieldDefs:[],stackField:i,groupby:r,offset:o,sort:l,facetby:[],as:u})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannels:s,fieldChannel:o,offset:a,impute:c}=i,l=s.map(g=>{const p=r[g];return Xe(p)}).filter(g=>!!g),u=Ky(n),f=n.encoding.order;let d;return j(f)||_(f)?d=Na(f):d=u.reduce((g,p)=>(g.field.push(p),g.order.push(o==="y"?"descending":"ascending"),g),{field:[],order:[]}),new gt(t,{dimensionFieldDefs:l,stackField:n.vgField(o),facetby:[],stackby:u,sort:d,offset:a,impute:c,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${T(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:t,impute:n,groupby:i}=this._stack;return t.length>0?t.map(r=>r.bin?n?[S(r,{binSuffix:"mid"})]:[S(r,{}),S(r,{binSuffix:"end"})]:[S(r)]).flat():i??[]}assemble(){const t=[],{facetby:n,dimensionFieldDefs:i,stackField:r,stackby:s,sort:o,offset:a,impute:c,as:l}=this._stack;if(c)for(const u of i){const{bandPosition:f=.5,bin:d}=u;if(d){const g=S(u,{expr:"datum"}),p=S(u,{expr:"datum",binSuffix:"end"});t.push({type:"formula",expr:`${f}*${g}+${1-f}*${p}`,as:S(u,{binSuffix:"mid",forAs:!0})})}t.push({type:"impute",field:r,groupby:[...s,...n],key:S(u,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:o,as:l,offset:a}),t}}class Cn extends D{constructor(t,n){super(t);this.transform=n}clone(){return new Cn(null,P(this.transform))}addDimensions(t){this.transform.groupby=Ie(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const i=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(i.add,i),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(r=>i.add(r.field)),this.transform.window.map(r=>r.field).filter(r=>r!==void 0).forEach(i.add,i),i}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:S(t)}hash(){return`WindowTransform ${T(this.transform)}`}assemble(){var t;const n=[],i=[],r=[],s=[];for(const d of this.transform.window)i.push(d.op),r.push(this.getDefaultName(d)),s.push(d.param===void 0?null:d.param),n.push(d.field===void 0?null:d.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&i.every(d=>Vr(d)))return Object.assign({type:"joinaggregate",as:r,ops:i,fields:n},a!==void 0?{groupby:a}:{});const c=[],l=[];if(this.transform.sort!==void 0)for(const d of this.transform.sort)c.push(d.field),l.push((t=d.order)!==null&&t!==void 0?t:"ascending");const u={field:c,order:l},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:r,ops:i,fields:n,sort:u},f!==void 0?{ignorePeers:f}:{}),a!==void 0?{groupby:a}:{}),o!==void 0?{frame:o}:{})}}function Zy(e){function t(n){if(!(n instanceof kn)){const i=n.clone();if(i instanceof le){const r=Eo+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof Ne||i instanceof gt||i instanceof Cn||i instanceof Qt)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function $o(e){if(e instanceof kn)if(e.numChildren()===1&&!(e.children[0]instanceof le)){const t=e.children[0];(t instanceof Ne||t instanceof gt||t instanceof Cn||t instanceof Qt)&&t.addDimensions(e.fields),t.swapWithParent(),$o(e)}else{const t=e.model.component.data.main;Vu(t);const n=Zy(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map($o)}function Vu(e){if(e instanceof le&&e.type===W.Main&&e.numChildren()===1){const t=e.children[0];t instanceof kn||(t.swapWithParent(),Vu(e))}}const Eo="scale_",hr=5;function ko(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!ko(t.children))return!1}return!0}function Pe(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function Xu(e,t,n){let i=e.sources,r=!1;return r=Pe(new Wy,i)||r,r=Pe(new My(t),i)||r,i=i.filter(s=>s.numChildren()>0),r=Pe(new qy,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=Pe(new By,i)||r,r=Pe(new Xy(t),i)||r,r=Pe(new Uy,i)||r,r=Pe(new Hy,i)||r,r=Pe(new Vy,i)||r,r=Pe(new Gy,i)||r,r=Pe(new Dy,i)||r,r=Pe(new Yy,i)||r),e.sources=i,r}function Jy(e,t){ko(e.sources);let n=0,i=0;for(let r=0;r<hr&&Xu(e,t,!0);r++)n++;e.sources.map($o);for(let r=0;r<hr&&Xu(e,t,!1);r++)i++;ko(e.sources),Math.max(n,i)===hr&&O(`Maximum optimization runs(${hr}) reached.`)}class he{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new he(()=>t(n))}}var ev=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Yu(e){Q(e)?tv(e):nv(e)}function tv(e){const t=e.component.scales;for(const n of y(t)){const i=rv(e,n),r=t[n];if(r.setWithExplicit("domains",i),ov(e,n),e.component.data.isFaceted){let s=e;for(;!Fe(s)&&s.parent;)s=s.parent;const o=s.component.resolve.scale[n];if(o==="shared")for(const a of i.value)ct(a)&&(a.data=Eo+a.data.replace(Eo,""))}}}function nv(e){for(const n of e.children)Yu(n);const t=e.component.scales;for(const n of y(t)){let i,r=null;for(const s of e.children){const o=s.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=kt(i,o.getWithExplicit("domains"),"domains","scale",Po);const a=o.get("selectionExtent");r&&a&&r.param!==a.param&&O(Yd),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function iv(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:s}=Ku(t,n);if(!r){O(s);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=Ku(t,n);if(r)return"unaggregated"}return e}function rv(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=iv(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&Z(i.x2)?Z(i.x)?kt(Tt(n,r,e,"x"),Tt(n,r,e,"x2"),"domain","scale",Po):Tt(n,r,e,"x2"):t==="y"&&Z(i.y2)?Z(i.y)?kt(Tt(n,r,e,"y"),Tt(n,r,e,"y2"),"domain","scale",Po):Tt(n,r,e,"y2"):Tt(n,r,e,t)}function sv(e,t,n){return e.map(i=>{const r=Xi(i,{timeUnit:n,type:t});return{signal:`{data: ${r}}`}})}function Co(e,t,n){var i;const r=(i=ae(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?sv(e,t,r):[e]}function Tt(e,t,n,i){const{encoding:r}=n,s=Z(r[i]),{type:o}=s,a=s.timeUnit;if(Op(t)){const f=Tt(e,void 0,n,i),d=Co(t.unionWith,o,a);return Ke([...f.value,...d])}else{if(w(t))return Ke([t]);if(t&&t!=="unaggregated"&&!lc(t))return Ke(Co(t,o,a))}const c=n.stack;if(c&&i===c.fieldChannel){if(c.offset==="normalize")return ve([[0,1]]);const f=n.requestDataName(W.Main);return ve([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const l=xt(i)&&_(s)?av(n,i,e):void 0;if(Ge(s)){const f=Co([s.datum],o,a);return ve(f)}const u=s;if(t==="unaggregated"){const f=n.requestDataName(W.Main),{field:d}=s;return ve([{data:f,field:S({field:d,aggregate:"min"})},{data:f,field:S({field:d,aggregate:"max"})}])}else if(U(u.bin)){if(ee(e))return e==="bin-ordinal"?ve([]):ve([{data:Rn(l)?n.requestDataName(W.Main):n.requestDataName(W.Raw),field:n.vgField(i,Qn(u,i)?{binSuffix:"range"}:{}),sort:l===!0||!H(l)?{field:n.vgField(i,{}),op:"min"}:l}]);{const{bin:f}=u;if(U(f)){const d=_o(n,u.field,f);return ve([new he(()=>{const g=n.getSignalName(d);return`[${g}.start, ${g}.stop]`})])}else return ve([{data:n.requestDataName(W.Main),field:n.vgField(i,{})}])}}else if(u.timeUnit&&I(["time","utc"],e)&&Pc(u,Q(n)?n.encoding[ot(i)]:void 0,n.markDef,n.config)){const f=n.requestDataName(W.Main);return ve([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return ve(l?[{data:Rn(l)?n.requestDataName(W.Main):n.requestDataName(W.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(W.Main),field:n.vgField(i)}])}function No(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n??(t?"sum":Mi)},i?{field:Oe(i)}:{}),r?{order:r}:{})}function ov(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=lc(r)&&r,a=Mt(s)&&Ci(s.extent)&&s.extent;(o||a)&&i.set("selectionExtent",o??a,!0)}function av(e,t,n){if(!ee(n))return;const i=e.fieldDef(t),r=i.sort;if(Ec(r))return{op:"min",field:$n(i,t),order:"ascending"};const{stack:s}=e,o=s?new Set([...s.groupbyFields,...s.stackBy.map(a=>a.fieldDef.field)]):void 0;if(qe(r)){const a=s&&!o.has(r.field);return No(r,a)}else if($c(r)){const{encoding:a,order:c}=r,l=e.fieldDef(a),{aggregate:u,field:f}=l,d=s&&!o.has(f);if(at(u)||_t(u))return No({field:S(l),order:c},d);if(Vr(u)||!u)return No({op:u,field:f,order:c},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(I(["ascending",void 0],r))return!0}return}function Ku(e,t){const{aggregate:n,type:i}=e;return n?F(n)&&!Fd.has(n)?{valid:!1,reason:Sg(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:jg(e)}:{valid:!0}:{valid:!1,reason:_g(e)}}function Po(e,t,n,i){return e.explicit&&t.explicit&&O(Cg(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function cv(e){const t=Ie(e.map(o=>{if(ct(o)){const a=ev(o,["sort"]);return a}return o}),T),n=Ie(e.map(o=>{if(ct(o)){const a=o.sort;return a!==void 0&&!Rn(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}return}).filter(o=>o!==void 0),T);if(t.length===0)return;if(t.length===1){const o=e[0];if(ct(o)&&n.length>0){let a=n[0];if(n.length>1)O(Ga),a=!0;else if(H(a)&&"field"in a){const c=a.field;o.field===c&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},o),{sort:a})}return o}const i=Ie(n.map(o=>Rn(o)||!("op"in o)||F(o.op)&&o.op in kd?o:(O(Pg(o)),!0)),T);let r;i.length===1?r=i[0]:i.length>1&&(O(Ga),r=!0);const s=Ie(e.map(o=>ct(o)?o.data:null),o=>o);if(s.length===1&&s[0]!==null){const o=Object.assign({data:s[0],fields:t.map(a=>a.field)},r?{sort:r}:{});return o}return Object.assign({fields:t},r?{sort:r}:{})}function Fo(e){if(ct(e)&&F(e.field))return e.field;if(Td(e)){let t;for(const n of e.fields)if(ct(n)&&F(n.field)){if(!t)t=n.field;else if(t!==n.field)return O(Fg),t}return O(Ag),t}else if(Id(e)){O(Tg);const t=e.fields[0];return F(t)?t:void 0}return}function mr(e,t){const n=e.component.scales[t],i=n.get("domains").map(r=>(ct(r)&&(r.data=e.lookupDataSource(r.data)),r));return cv(i)}var lv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Qu(e){return Nn(e)||Io(e)?e.children.reduce((t,n)=>t.concat(Qu(n)),Zu(e)):Zu(e)}function Zu(e){return y(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:c,range:l,reverse:u}=r,f=lv(r,["name","type","selectionExtent","domains","range","reverse"]),d=uv(r.range,s,n,e),g=mr(e,n),p=a?eb(e,a,i,g):null;return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},g?{domain:g}:{}),p?{domainRaw:p}:{}),{range:d}),u!==void 0?{reverse:u}:{}),f)),t},[])}function uv(e,t,n,i){if(ne(n)){if(jt(e))return{step:{signal:`${t}_step`}}}else if(H(e)&&ct(e))return Object.assign(Object.assign({},e),{data:i.lookupDataSource(e.data)});return e}class Ju extends dt{constructor(t,n){super({},{name:t});this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:It(this.get("domains"),t=>j(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const fv=["range","scheme"];function dv(e){const t=e.component.scales;for(const n of ki){const i=t[n];if(!i)continue;const r=gv(n,e);i.setWithExplicit("range",r)}}function ef(e,t){const n=e.fieldDef(t);if(n==null?void 0:n.bin){const{bin:i,field:r}=n,s=de(t),o=e.getName(s);if(H(i)&&i.binned&&i.step!==void 0)return new he(()=>{const a=e.scaleName(t),c=`(domain("${a}")[1] - domain("${a}")[0]) / ${i.step}`;return`${e.getSignalName(o)} / (${c})`});if(U(i)){const a=_o(e,r,i);return new he(()=>{const c=e.getSignalName(a),l=`(${c}.stop - ${c}.start) / ${c}.step`;return`${e.getSignalName(o)} / (${l})`})}}return}function gv(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e),s=r.get("type");for(const f of fv)if(n[f]!==void 0){const d=hs(s,f),g=uc(e,f);if(!d)O(Ha(s,f,e));else if(g)O(g);else switch(f){case"range":{const p=n.range;if(j(p)){if(ne(e))return Ke(p.map(m=>{if(m==="width"||m==="height"){const h=t.getName(m),v=t.getSignalName.bind(t);return he.fromName(v,h)}return m}))}else if(H(p))return Ke({data:t.requestDataName(W.Main),field:p.field,sort:{op:"min",field:t.vgField(e)}});return Ke(p)}case"scheme":return Ke(pv(n[f]))}}const o=e===G||e==="xOffset"?"width":"height",a=i[o];if(Ye(a)){if(ne(e))if(ee(s)){const f=tf(a,t,e);if(f)return Ke({step:f})}else O(qa(o));else if(ln(e)){const f=e===ht?"x":"y",d=t.getScaleComponent(f),g=d.get("type");if(g==="band"){const p=nf(a,s);if(p)return Ke(p)}}}const{rangeMin:c,rangeMax:l}=n,u=hv(e,t);return(c!==void 0||l!==void 0)&&hs(s,"rangeMin")&&j(u)&&u.length===2?Ke([c??u[0],l??u[1]]):ve(u)}function pv(e){return vp(e)?Object.assign({scheme:e.name},me(e,["name"])):{scheme:e}}function hv(e,t){const{size:n,config:i,mark:r,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=Z(s[e]),c=t.getScaleComponent(e),l=c.get("type"),{domain:u,domainMid:f}=t.specifiedScales[e];switch(e){case G:case J:{if(I(["point","band"],l)){const p=rf(e,n,i.view);if(Ye(p)){const m=tf(p,t,e);return{step:m}}}const d=de(e),g=t.getName(d);return e===J&&ye(l)?[he.fromName(o,g),0]:[0,he.fromName(o,g)]}case ht:case an:return mv(e,t,l);case rt:{const d=t.component.scales[e].get("zero"),g=sf(r,d,i),p=vv(r,n,t,i);return gn(l)?yv(g,p,bv(l,i,u,e)):[g,p]}case $e:return[0,Math.PI*2];case Rt:return[0,360];case Re:return[0,new he(()=>{const d=t.getSignalName("width"),g=t.getSignalName("height");return`min(${d},${g})/2`})];case yt:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case vt:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case fe:return"symbol";case ue:case Me:case Ue:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case st:case mt:case bt:return[i.scale.minOpacity,i.scale.maxOpacity]}}function tf(e,t,n){var i,r,s,o,a;const{encoding:c}=t,l=t.getScaleComponent(n),u=ha(n),f=c[u],d=fl({step:e,offsetIsDiscrete:k(f)&&ic(f.type)});if(d==="offset"&&Hc(c,u)){const g=t.getScaleComponent(u),p=t.scaleName(u);let m=`domain('${p}').length`;if(g.get("type")==="band"){const v=(r=(i=g.get("paddingInner"))!==null&&i!==void 0?i:g.get("padding"))!==null&&r!==void 0?r:0,b=(o=(s=g.get("paddingOuter"))!==null&&s!==void 0?s:g.get("padding"))!==null&&o!==void 0?o:0;m=`bandspace(${m}, ${v}, ${b})`}const h=(a=l.get("paddingInner"))!==null&&a!==void 0?a:l.get("padding");return{signal:`${e.step} * ${m} / (1-${Dd(h)})`}}else return e.step}function nf(e,t){const n=fl({step:e,offsetIsDiscrete:ee(t)});return n==="offset"?{step:e.step}:void 0}function mv(e,t,n){const i=e===ht?"x":"y",r=t.getScaleComponent(i),s=r.get("type"),o=t.scaleName(i);if(s==="band"){const a=rf(i,t.size,t.config.view);if(Ye(a)){const c=nf(a,n);if(c)return c}return[0,{signal:`bandwidth('${o}')`}]}else return na(`Cannot use ${e} scale if ${i} scale is not discrete.`)}function rf(e,t,n){const i=e===G?"width":"height",r=t[i];return r||nr(n,i)}function bv(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&j(n)?n.length+1:(O(Bg(i)),3)}}function yv(e,t,n){const i=()=>{const r=lt(t),s=lt(e),o=`(${r} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${r} + ${o}, ${o})`};return w(t)?new he(i):{signal:i()}}function sf(e,t,n){if(t)return w(t)?{signal:`${t.signal} ? 0 : ${sf(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Pi("size",e))}const of=.95;function vv(e,t,n,i){const r={x:ef(n,"x"),y:ef(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=af(t,r,i.view);return Y(s)?s-1:new he(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=af(t,r,i.view);return Y(s)?Math.pow(of*s,2):new he(()=>`pow(${of} * ${s.signal}, 2)`)}}throw new Error(Pi("size",e))}function af(e,t,n){const i=Ye(e.width)?e.width.step:tr(n,"width"),r=Ye(e.height)?e.height.step:tr(n,"height");return t.x||t.y?new he(()=>{const s=[t.x?t.x.signal:i,t.y?t.y.signal:r];return`min(${s.join(", ")})`}):Math.min(i,r)}function cf(e,t){Q(e)?Ov(e,t):ff(e,t)}function Ov(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=e;for(const a of y(n)){const c=o[a],l=n[a],u=e.getScaleComponent(a),f=Z(r[a]),d=c[t],g=u.get("type"),p=u.get("padding"),m=u.get("paddingInner"),h=hs(g,t),v=uc(a,t);if(d!==void 0&&(h?v&&O(v):O(Ha(g,t,a))),h&&v===void 0)if(d!==void 0){const b=f.timeUnit,x=f.type;switch(t){case"domainMax":case"domainMin":Wt(c[t])||x==="temporal"||b?l.set(t,{signal:Xi(c[t],{type:x,timeUnit:b})},!0):l.set(t,c[t],!0);break;default:l.copyKeyFromObject(t,c)}}else{const b=t in lf?lf[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:g,scalePadding:p,scalePaddingInner:m,domain:c.domain,domainMin:c.domainMin,domainMax:c.domainMax,markDef:s,config:i,hasNestedOffsetScale:As(r,a)}):i.scale[t];b!==void 0&&l.set(t,b,!1)}}}const lf={bins:({model:e,fieldOrDatumDef:t})=>_(t)?xv(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>_v(e,t.type),nice:({scaleType:e,channel:t,domain:n,domainMin:i,domainMax:r,fieldOrDatumDef:s})=>Sv(e,t,n,i,r,s),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>jv(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,scaleType:i,config:r,hasNestedOffsetScale:s})=>wv(e,t,n.type,i,r.scale,s),paddingOuter:({scalePadding:e,channel:t,scaleType:n,scalePaddingInner:i,config:r,hasNestedOffsetScale:s})=>$v(e,t,n,i,r.scale,s),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=_(e)?e.sort:void 0;return Ev(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>kv(e,t,n,i,r)};function uf(e){Q(e)?dv(e):ff(e,"range")}function ff(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?uf(i):cf(i,t);for(const i of y(n)){let r;for(const s of e.children){const o=s.component.scales[i];if(o){const a=o.getWithExplicit(t);r=kt(r,a,t,"scale",Ll((c,l)=>{switch(t){case"range":return c.step&&l.step?c.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function xv(e,t){const n=t.bin;if(U(n)){const i=_o(e,t.field,n);return new he(()=>e.getSignalName(i))}else if(oe(n)&&Mt(n)&&n.step!==void 0)return{step:n.step};return}function _v(e,t){return I([ue,Me,Ue],e)&&t!=="nominal"?"hcl":void 0}function Sv(e,t,n,i,r,s){var o;return((o=Xe(s))===null||o===void 0?void 0:o.bin)||j(n)||r!=null||i!=null||I([pe.TIME,pe.UTC],e)?void 0:ne(t)?!0:void 0}function jv(e,t,n,i,r,s){if(ne(e)){if(ke(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=r;if(o==="bar"&&!(_(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===pe.POINT)return n.pointPadding}return}function wv(e,t,n,i,r,s=!1){if(e!==void 0)return;if(ne(t)){const{bandPaddingInner:o,barBandPaddingInner:a,rectBandPaddingInner:c,bandWithNestedOffsetPaddingInner:l}=r;return s?l:K(o,n==="bar"?a:c)}else if(ln(t)&&i===pe.BAND)return r.offsetBandPaddingInner;return}function $v(e,t,n,i,r,s=!1){if(e!==void 0)return;if(ne(t)){const{bandPaddingOuter:o,bandWithNestedOffsetPaddingOuter:a}=r;if(s)return a;if(n===pe.BAND)return K(o,w(i)?{signal:`${i.signal}/2`}:i/2)}else if(ln(t)){if(n===pe.POINT)return .5;if(n===pe.BAND)return r.offsetBandPaddingOuter}return}function Ev(e,t,n,i){return n==="x"&&i.xReverse!==void 0?ye(e)&&t==="descending"?w(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:ye(e)&&t==="descending"?!0:void 0}function kv(e,t,n,i,r){const s=!!n&&n!=="unaggregated";if(s&&ye(r)){if(j(n)){const o=n[0],a=n[n.length-1];if(o<=0&&a>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!gn(r))return!0;if(!(_(t)&&t.bin)&&I([...We,...Od],e)){const{orient:o,type:a}=i;return!(I(["bar","area","line","trail"],a)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function Cv(e,t,n,i,r=!1){const s=Nv(t,n,i,r),{type:o}=e;return xt(t)?o!==void 0?$p(t,o)?_(n)&&!wp(o,n.type)?(O(Eg(o,s)),s):o:(O($g(t,o,s)),s):s:null}function Nv(e,t,n,i){var r;switch(t.type){case"nominal":case"ordinal":{if(cn(e)||Gr(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&O(Jr(e,"ordinal")),"ordinal";if(ne(e)||ln(e)){if(I(["rect","bar","image","rule"],n.type))return"band";if(i)return"band"}else if(n.type==="arc"&&e in qr)return"band";const s=n[de(e)];return pn(s)||Cs(t)&&((r=t.axis)===null||r===void 0?void 0:r.tickBand)?"band":"point"}case"temporal":return cn(e)?"time":Gr(e)==="discrete"?(O(Jr(e,"temporal")),"ordinal"):_(t)&&t.timeUnit&&ae(t.timeUnit).utc?"utc":"time";case"quantitative":return cn(e)?_(t)&&U(t.bin)?"bin-ordinal":"linear":Gr(e)==="discrete"?(O(Jr(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(Wa(t.type))}function Pv(e,{ignoreRange:t}={}){df(e),Yu(e);for(const n of jp)cf(e,n);t||uf(e)}function df(e){Q(e)?e.component.scales=Fv(e):e.component.scales=Tv(e)}function Fv(e){const{encoding:t,mark:n,markDef:i}=e,r={};for(const s of ki){const o=Z(t[s]);if(o&&n===gc&&s===fe&&o.type===dn)continue;let a=o&&o.scale;if(ln(s)){const c=ma(s);if(!As(t,c)){a&&O(dg(s));continue}}if(o&&a!==null&&a!==!1){a??(a={});const c=As(t,s),l=Cv(a,s,o,i,c);r[s]=new Ju(e.scaleName(`${s}`,!0),{value:l,explicit:a.type===l})}}return r}const Av=Ll((e,t)=>rc(e)-rc(t));function Tv(e){var t,n;const i=e.component.scales={},r={},s=e.component.resolve;for(const o of e.children){df(o);for(const a of y(o.component.scales))if((t=(n=s.scale)[a])!==null&&t!==void 0||(n[a]=Cu(a,e)),s.scale[a]==="shared"){const c=r[a],l=o.component.scales[a].getWithExplicit("type");c?pp(c.value,l.value)?r[a]=kt(c,l,"type","scale",Av):(s.scale[a]="independent",delete r[a]):r[a]=l}}for(const o of y(r)){const a=e.scaleName(o,!0),c=r[o];i[o]=new Ju(a,c);for(const l of e.children){const u=l.component.scales[o];u&&(l.renameScale(u.get("name"),a),u.merged=!0)}}return i}var Ao=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class To{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function Q(e){return(e==null?void 0:e.type)==="unit"}function Fe(e){return(e==null?void 0:e.type)==="facet"}function Io(e){return(e==null?void 0:e.type)==="concat"}function Nn(e){return(e==null?void 0:e.type)==="layer"}class zo{constructor(t,n,i,r,s,o,a){var c,l;this.type=n,this.parent=i,this.config=s,this.correctDataNames=u=>{var f,d,g;return((f=u.from)===null||f===void 0?void 0:f.data)&&(u.from.data=this.lookupDataSource(u.from.data)),((g=(d=u.from)===null||d===void 0?void 0:d.facet)===null||g===void 0?void 0:g.data)&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u},this.parent=i,this.config=s,this.view=ge(a),this.name=(c=t.name)!==null&&c!==void 0?c:r,this.title=St(t.title)?{text:t.title}:t.title?ge(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new To,this.projectionNameMap=i?i.projectionNameMap:new To,this.signalNameMap=i?i.signalNameMap:new To,this.data=t.data,this.description=t.description,this.transforms=Rm((l=t.transform)!==null&&l!==void 0?l:[]),this.layout=n==="layer"||n==="unit"?{}:Bh(t,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:Ui(t)||(i==null?void 0:i.component.data.isFaceted)&&t.data===void 0},layoutSize:new dt,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?P(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){Pv(this)}parseProjection(){Wu(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Ru(this)}assembleEncodeFromView(t){const n=Ao(t,["style"]),i={};for(const r of y(n)){const s=n[r];s!==void 0&&(i[r]=B(s))}return i}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=B(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{}):L(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,i=Ao(t,["spacing"]),{component:r,config:s}=this,o=Qb(r.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),i),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of _e)t[i].title&&n.push(qb(this,i));for(const i of mo)n=n.concat(Gb(this,i));return n}assembleAxes(){return Ab(this.component.axes,this.config)}assembleLegends(){return Du(this)}assembleProjections(){return xy(this)}assembleTitle(){var t,n,i;const r=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=r,o=Ao(r,["encoding"]),a=Object.assign(Object.assign(Object.assign({},ja(this.config.title).nonMarkTitleProperties),o),s?{encode:{update:s}}:{});return a.text?(I(["unit","layer"],this.type)?I(["middle",void 0],a.anchor)&&((n=a.frame)!==null&&n!==void 0||(a.frame="group")):(i=a.anchor)!==null&&i!==void 0||(a.anchor="start"),L(a)?void 0:a):void 0}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||Fe(this.parent)?Qu(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return q((this.name?`${this.name}_`:"")+t)}getDataName(t){return this.getName(W[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(Fe(this.parent)){const n=Eu(t),i=Ei(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if(ee(s)&&jt(o)){const a=r.get("name"),c=mr(this,i),l=Fo(c);if(l){const u=S({aggregate:"distinct",field:l},{expr:"datum"});return{signal:$u(a,r,u)}}else return O(Qr(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){return n?this.getName(t):ga(t)&&xt(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(Hd(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(i=>i.hasOrientSignalRef()))}}class gf extends zo{vgField(t,n={}){const i=this.fieldDef(t);return i?S(i,n):void 0}reduceFieldDef(t,n){return bh(this.getMapping(),(i,r,s)=>{const o=Xe(r);return o?t(i,o,s):i},n)}forEachFieldDef(t,n){Is(this.getMapping(),(i,r)=>{const s=Xe(i);s&&t(s,r)},n)}}var Iv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class br extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=P(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"value",(s=o[1])!==null&&s!==void 0?s:"density"]}clone(){return new br(null,P(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${T(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,i=Iv(t,["density"]),r=Object.assign({type:"kde",field:n},i);return r}}class ci extends D{constructor(t,n){super(t);this.filter=n}clone(){return new ci(null,Object.assign({},this.filter))}static make(t,n){const{config:i,mark:r,markDef:s}=n,o=R("invalid",s,i);if(o!=="filter")return null;const a=n.reduceFieldDef((c,l,u)=>{const f=xt(u)&&n.getScaleComponent(u);if(f){const d=f.get("type");ye(d)&&l.aggregate!=="count"&&!wt(r)&&(c[l.field]=l)}return c},{});return y(a).length?new ci(t,a):null}dependentFields(){return new Set(y(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${T(this.filter)}`}assemble(){const t=y(this.filter).reduce((n,i)=>{const r=this.filter[i],s=S(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):r.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class yr extends D{constructor(t,n){super(t);this.transform=n,this.transform=P(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,o)=>{var a;return(a=r[o])!==null&&a!==void 0?a:s})}clone(){return new yr(this.parent,P(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${T(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform,i={type:"flatten",fields:t,as:n};return i}}class vr extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=P(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"key",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new vr(null,P(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${T(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform,i={type:"fold",fields:t,as:n};return i}}class Pn extends D{constructor(t,n,i,r){super(t);this.fields=n,this.geojson=i,this.signal=r}clone(){return new Pn(null,P(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[De,Le],[xe,Ee]]){const s=r.map(o=>{const a=Z(n.encoding[o]);return _(a)?a.field:Ge(a)?{expr:`${a.datum}`}:Ce(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new Pn(t,s,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(fe)){const r=n.typedFieldDef(fe);r.type===dn&&(t=new Pn(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(F);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${T(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})]}}class li extends D{constructor(t,n,i,r){super(t);this.projection=n,this.fields=i,this.as=r}clone(){return new li(null,this.projection,P(this.fields),P(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[De,Le],[xe,Ee]]){const r=i.map(o=>{const a=Z(n.encoding[o]);return _(a)?a.field:Ge(a)?{expr:`${a.datum}`}:Ce(a)?{expr:`${a.value}`}:void 0}),s=i[0]===xe?"2":"";(r[0]||r[1])&&(t=new li(t,n.projectionName(),r,[n.getName(`x${s}`),n.getName(`y${s}`)]))}return t}dependentFields(){return new Set(this.fields.filter(F))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${T(this.fields)} ${T(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Zt extends D{constructor(t,n){super(t);this.transform=n}clone(){return new Zt(null,P(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t,s=[n,i,...r?[r]:[]].join(",");return{signal:`sequence(${s})`}}static makeFromTransform(t,n){return new Zt(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,s=i.y;if(_(r)&&_(s)){const o=r.impute?r:s.impute?s:void 0;if(o===void 0)return;const a=r.impute?s:s.impute?r:void 0,{method:c,value:l,frame:u,keyvals:f}=o.impute,d=Gc(n.mark,i);return new Zt(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},c?{method:c}:{}),l!==void 0?{value:l}:{}),u?{frame:u}:{}),f!==void 0?{keyvals:f}:{}),d.length?{groupby:d}:{}))}return null}hash(){return`Impute ${T(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:s,value:o,frame:a=[null,null]}=this.transform,c=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},i?{keyvals:vm(i)?this.processSequence(i):i}:{}),{method:"value"}),s?{groupby:s}:{}),{value:!r||r==="value"?o:null});if(r&&r!=="value"){const l=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1},s?{groupby:s}:{}),u={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[c,l,u]}else return[c]}}var zv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Or extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=P(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.loess]}clone(){return new Or(null,P(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${T(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:i}=t,r=zv(t,["loess","on"]),s=Object.assign({type:"loess",x:i,y:n},r);return s}}class ui extends D{constructor(t,n,i){super(t);this.transform=n,this.secondary=i}clone(){return new ui(null,P(this.transform),this.secondary)}static make(t,n,i,r){const s=n.component.data.sources,{from:o}=i;let a=null;if(Om(o)){let c=bf(o.data,s);c||(c=new Yt(o.data),s.push(c));const l=n.getName(`lookup_${r}`);a=new le(c,l,W.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(xm(o)){const c=o.param;i=Object.assign({as:c},i);let l;try{l=n.getSelectionComponent(q(c),c)}catch(u){throw new Error(Vd(c))}if(a=l.materialized,!a)throw new Error(Xd(c))}return new ui(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?V(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${T({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:V(this.transform.as)}:{});else{let n=this.transform.as;F(n)||(O(ng),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}var Rv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class xr extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=P(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"prob",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new xr(null,P(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${T(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,i=Rv(t,["quantile"]),r=Object.assign({type:"quantile",field:n},i);return r}}var Lv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class _r extends D{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=P(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.regression]}clone(){return new _r(null,P(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${T(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:i}=t,r=Lv(t,["regression","on"]),s=Object.assign({type:"regression",x:i,y:n},r);return s}}class Sr extends D{constructor(t,n){super(t);this.transform=n}clone(){return new Sr(null,P(this.transform))}addDimensions(t){var n;this.transform.groupby=Ie(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),i=>i)}producedFields(){return}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${T(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},r!==void 0?{limit:r}:{}),s!==void 0?{op:s}:{}),i!==void 0?{groupby:i}:{})}}class jr extends D{constructor(t,n){super(t);this.transform=n}clone(){return new jr(null,P(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${T(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function pf(e){let t=0;function n(i,r){var s;if(i instanceof Yt&&(!i.isGenerator&&!vn(i.data))){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}if(i instanceof se&&(i.parent instanceof Yt&&!r.source?(r.format=Object.assign(Object.assign({},(s=r.format)!==null&&s!==void 0?s:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof kn){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,e.push(...i.assemble());return}if((i instanceof si||i instanceof oi||i instanceof ci||i instanceof jn||i instanceof wn||i instanceof li||i instanceof Ne||i instanceof ui||i instanceof Cn||i instanceof Qt||i instanceof vr||i instanceof yr||i instanceof br||i instanceof Or||i instanceof xr||i instanceof _r||i instanceof At||i instanceof jr||i instanceof Sr)&&r.transform.push(i.assemble()),(i instanceof Ze||i instanceof Qe||i instanceof Zt||i instanceof gt||i instanceof Pn)&&r.transform.push(...i.assemble()),i instanceof le){if(r.source&&r.transform.length===0)i.setSource(r.source);else if(i.parent instanceof le)i.setSource(r.name);else if(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}}switch(i.numChildren()){case 0:i instanceof le&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const a of i.children){const c={name:null,source:o,transform:[]};n(a,c)}break}}}return n}function Dv(e){const t=[],n=pf(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function Mv(e,t){var n,i;const r=[],s=pf(r);let o=0;for(const c of e.sources){c.hasName()||(c.dataName=`source_${o++}`);const l=c.assemble();s(c,l)}for(const c of r)c.transform.length===0&&delete c.transform;let a=0;for(const[c,l]of r.entries())((n=l.transform)!==null&&n!==void 0?n:[]).length===0&&!l.source&&r.splice(a++,0,r.splice(c,1)[0]);for(const c of r)for(const l of(i=c.transform)!==null&&i!==void 0?i:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const c of r)c.name in t&&(c.values=t[c.name]);return r}function Uv(e){return e==="top"||e==="left"||w(e)?"header":"footer"}function Wv(e){for(const t of _e)Bv(e,t);mf(e,"x"),mf(e,"y")}function Bv(e,t){var n;const{facet:i,config:r,child:s,component:o}=e;if(e.channelHasField(t)){const a=i[t],c=En("title",null,r,t);let l=hn(a,r,{allowDisabling:!0,includeDefault:c===void 0||!!c});s.component.layoutHeaders[t].title&&(l=j(l)?l.join(", "):l,l+=` / ${s.component.layoutHeaders[t].title}`,s.component.layoutHeaders[t].title=null);const u=En("labelOrient",a.header,r,t),f=a.header!==null?K((n=a.header)===null||n===void 0?void 0:n.labels,r.header.labels,!0):!1,d=I(["bottom","right"],u)?"footer":"header";o.layoutHeaders[t]={title:a.header!==null?l:null,facetFieldDef:a,[d]:t==="facet"?[]:[hf(e,t,f)]}}}function hf(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function mf(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:s}=e.component;if(s.axis[t]=Oo(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=r[o];for(const c of i.component.axes[t]){const l=Uv(c.get("orient"));(n=a[l])!==null&&n!==void 0||(a[l]=[hf(e,o,!1)]);const u=ri(c,"main",e.config,{header:!0});u&&a[l][0].axes.push(u),c.mainExtracted=!0}}}}function Hv(e){Ro(e),wr(e,"width"),wr(e,"height")}function qv(e){Ro(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";wr(e,t),wr(e,n)}function Ro(e){for(const t of e.children)t.parseLayoutSize()}function wr(e,t){var n;const i=Eu(t),r=Ei(i),s=e.component.resolve,o=e.component.layoutSize;let a;for(const c of e.children){const l=c.component.layoutSize.getWithExplicit(i),u=(n=s.scale[r])!==null&&n!==void 0?n:Cu(r,e);if(u==="independent"&&l.value==="step"){a=void 0;break}if(a){if(u==="independent"&&a.value!==l.value){a=void 0;break}a=kt(a,l,i,"")}else a=l}if(a){for(const c of e.children)e.renameSignal(c.getName(i),e.getName(t)),c.component.layoutSize.set(i,"merged",!1);o.setWithExplicit(t,a)}else o.setWithExplicit(t,{explicit:!1,value:void 0})}function Gv(e){const{size:t,component:n}=e;for(const i of We){const r=de(i);if(t[r]){const s=t[r];n.layoutSize.set(r,Ye(s)?"step":s,!0)}else{const s=Vv(e,r);n.layoutSize.set(r,s,!1)}}}function Vv(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const s=r.get("type"),o=r.get("range");if(ee(s)){const a=nr(i.view,t);return jt(o)||Ye(a)?"step":a}else return Vs(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return Vs(i.view,t);{const s=nr(i.view,t);return Ye(s)?s.step:s}}}function Lo(e,t,n){return S(t,Object.assign({suffix:`by_${S(e)}`},n??{}))}class fi extends gf{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve);this.child=Bo(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!Yn(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=y(t),i={};for(const r of n){if(![et,tt].includes(r)){O(Pi(r,"facet"));break}const s=t[r];if(s.field===void 0){O(Zr(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(t,n){const i=Fs(t,n);return i.header?i.header=ge(i.header):i.header===null&&(i.header=null),i}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=$r(this),this.child.parseData()}parseLayoutSize(){Ro(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),Wv(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,i;const r={};for(const s of _e)for(const o of bo){const a=this.component.layoutHeaders[s],c=a[o],{facetFieldDef:l}=a;if(l){const u=En("titleOrient",l.header,this.config,s);if(["right","bottom"].includes(u)){const f=dr(s,u);(t=r.titleAnchor)!==null&&t!==void 0||(r.titleAnchor={}),r.titleAnchor[f]="end"}}if(c==null?void 0:c[0]){const u=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(u)&&((n=r[f])!==null&&n!==void 0||(r[f]={}),r[f][s]=.5),a.title&&((i=r.offset)!==null&&i!==void 0||(r.offset={}),r.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),i?{columns:i}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof fi)return;{const t=this.getName("column_domain");return{signal:`length(data('${t}'))`}}}assembleGroupStyle(){return}assembleGroup(t){return this.parent&&this.parent instanceof fi?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:S(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof fi){if(this.child.channelHasField("column")){const r=S(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of We){const s=this.child.component.scales[r];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(ee(o)&&jt(a)){const c=mr(this.child,r),l=Fo(c);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):O(Qr(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),c=[];for(const u of _e){const f=this.facet[u];if(f){c.push(S(f));const{bin:d,sort:g}=f;if(U(d)&&c.push(S(f,{binSuffix:"end"})),qe(g)){const{field:p,op:m=Mi}=g,h=Lo(f,g);i&&r?(s.push(h),o.push("max"),a.push(h)):(s.push(p),o.push(m),a.push(h))}else if(j(g)){const p=$n(f,u);s.push(p),o.push("max"),a.push(p)}}}const l=!!i&&!!r;return Object.assign({name:t,data:n,groupby:c},l||s.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),s.length?{fields:s,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:n}=this,i=n[t];return i?qe(i.sort)?[Lo(i,i.sort,{expr:"datum"})]:j(i.sort)?[$n(i,t,{expr:"datum"})]:[S(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i,s=(qe(r)?r.order:!j(r)&&r)||"ascending";return[s]}return[]}assembleLabelTitle(){var t;const{facet:n,config:i}=this;if(n.facet)return yo(n.facet,"facet",i);const r={row:["top","bottom"],column:["left","right"]};for(const s of mo)if(n[s]){const o=En("labelOrient",(t=n[s])===null||t===void 0?void 0:t.header,i,s);if(r[s].includes(o))return yo(n[s],s,i)}return}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=Dv(n),r=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle(),a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},s?{title:s}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:_e.map(c=>this.facetSortFields(c)).flat(),order:_e.map(c=>this.facetSortOrder(c)).flat()}}),i.length>0?{data:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(Km(this,[])));return[a]}getMapping(){return this.facet}}function Xv(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const s of[n,i])if(qe(s.sort)){const{field:o,op:a=Mi}=s.sort;e=r=new Qt(e,{joinaggregate:[{op:a,field:o,as:Lo(s,s.sort,{forAs:!0})}],groupby:[S(s)]})}return r}return null}function bf(e,t){var n,i,r,s;for(const o of t){const a=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const c=(n=e.format)===null||n===void 0?void 0:n.mesh,l=(i=a.format)===null||i===void 0?void 0:i.feature;if(c&&l)continue;const u=(r=e.format)===null||r===void 0?void 0:r.feature;if((u||l)&&u!==l)continue;const f=(s=a.format)===null||s===void 0?void 0:s.mesh;if((c||f)&&c!==f)continue;if(ei(e)&&ei(a)){if(Te(e.values,a.values))return o}else if(vn(e)&&vn(a)){if(e.url===a.url)return o}else if(Dl(e)&&e.name===o.dataName)return o}return null}function Yv(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Yt({values:[]});return t.push(i),i}const n=bf(e.data,t);if(n)return Ct(e.data)||(n.data.format=ia({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Yt(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function Kv(e,t,n){var i,r;let s=0;for(const o of t.transforms){let a,c;if(Pm(o))c=e=new wn(e,o),a="derived";else if(Zs(o)){const l=Iy(o);c=e=(i=se.makeWithAncestors(e,{},l,n))!==null&&i!==void 0?i:e,e=new jn(e,t,o.filter)}else if(Nl(o))c=e=Ze.makeFromTransform(e,o,t),a="number";else if(Am(o)){a="date";const l=n.getWithExplicit(o.field);l.value===void 0&&(e=new se(e,{[o.field]:a}),n.set(o.field,a,!1)),c=e=Qe.makeFromTransform(e,o)}else if(Tm(o))c=e=Ne.makeFromTransform(e,o),a="number",uo(t)&&(e=new At(e));else if(Cl(o))c=e=ui.make(e,t,o,s++),a="derived";else if(km(o))c=e=new Cn(e,o),a="number";else if(Cm(o))c=e=new Qt(e,o),a="number";else if(Im(o))c=e=gt.makeFromTransform(e,o),a="derived";else if(zm(o))c=e=new vr(e,o),a="derived";else if(Nm(o))c=e=new yr(e,o),a="derived";else if(_m(o))c=e=new Sr(e,o),a="derived";else if(Em(o))e=new jr(e,o);else if(Fm(o))c=e=Zt.makeFromTransform(e,o),a="derived";else if(Sm(o))c=e=new br(e,o),a="derived";else if(jm(o))c=e=new xr(e,o),a="derived";else if(wm(o))c=e=new _r(e,o),a="derived";else if($m(o))c=e=new Or(e,o),a="derived";else{O(tg(o));continue}if(c&&a!==void 0)for(const l of(r=c.producedFields())!==null&&r!==void 0?r:[])n.set(l,a,!1)}return e}function $r(e){var t,n,i,r,s,o,a,c,l,u;let f=Yv(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:g}=e.component.data,p=e.data,m=p&&(Ct(p)||vn(p)||ei(p)),h=!m&&e.parent?e.parent.component.data.ancestorParse.clone():new Vm;Ct(p)?(Ml(p)?f=new oi(f,p.sequence):to(p)&&(f=new si(f,p.graticule)),h.parseNothing=!0):((t=p==null?void 0:p.format)===null||t===void 0?void 0:t.parse)===null&&(h.parseNothing=!0),f=(n=se.makeExplicit(f,e,h))!==null&&n!==void 0?n:f,f=new At(f);const v=e.parent&&Nn(e.parent);(Q(e)||Fe(e))&&(v&&(f=(i=Ze.makeFromEncoding(f,e))!==null&&i!==void 0?i:f)),e.transforms.length>0&&(f=Kv(f,e,h));const b=Ry(e),x=zy(e);f=(r=se.makeWithAncestors(f,{},Object.assign(Object.assign({},b),x),h))!==null&&r!==void 0?r:f,Q(e)&&(f=Pn.parseAll(f,e),f=li.parseAll(f,e)),(Q(e)||Fe(e))&&(v||(f=(s=Ze.makeFromEncoding(f,e))!==null&&s!==void 0?s:f),f=(o=Qe.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=wn.parseAllForSortIndex(f,e));const $=e.getDataName(W.Raw),N=new le(f,$,W.Raw,g);if(d[$]=N,f=N,Q(e)){const X=Ne.makeFromEncoding(f,e);X&&(f=X,uo(e)&&(f=new At(f))),f=(a=Zt.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=(c=gt.makeFromEncoding(f,e))!==null&&c!==void 0?c:f}Q(e)&&(f=(l=ci.make(f,e))!==null&&l!==void 0?l:f);const C=e.getDataName(W.Main),E=new le(f,C,W.Main,g);d[C]=E,f=E,Q(e)&&Pb(e,E);let A=null;if(Fe(e)){const X=e.getName("facet");f=(u=Xv(f,e.facet))!==null&&u!==void 0?u:f,A=new kn(f,e,X,E.getSource()),d[X]=A}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:g,raw:N,main:E,facetRoot:A,ancestorParse:h})}class Qv extends zo{constructor(t,n,i,r){var s,o,a,c;super(t,"concat",n,i,r,t.resolve);(((o=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||o===void 0?void 0:o.x)==="shared"||((c=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||c===void 0?void 0:c.y)==="shared")&&O(Zd),this.children=this.getChildren(t).map((l,u)=>Bo(l,this,this.getName(`concat_${u}`),void 0,r))}parseData(){this.component.data=$r(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of y(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return er(t)?t.vconcat:Gs(t)?t.hconcat:t.concat}parseLayoutSize(){qv(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=vo(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),i?{style:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup())})}assembleGroupStyle(){return}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function Zv(e){return e===!1||e===null}const Jv=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},Uc),{labelExpr:1,encode:1}),yf=y(Jv);class Do extends dt{constructor(t={},n={},i=!1){super();this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new Do(P(this.explicit),P(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!Zv(this.get(t))}hasOrientSignalRef(){return w(this.explicit.orient)}}function eO(e,t,n){var i;const{encoding:r,config:s}=e,o=(i=Z(r[t]))!==null&&i!==void 0?i:Z(r[ot(t)]),a=e.axis(t)||{},{format:c,formatType:l}=a;return qt(l)?Object.assign({text:Ss({fieldOrDatumDef:o,field:"datum.value",format:c,formatType:l,config:s})},n):n}function tO(e){return We.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[cO(n,e)]),t),{})}const nO={bottom:"top",top:"bottom",left:"right",right:"left"};function iO(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of y(s.component.axes))i.axis[o]=Oo(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=rO(n[o],s.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const s of We){for(const o of e.children){if(!o.component.axes[s])continue;if(i.axis[s]==="independent"){n[s]=((t=n[s])!==null&&t!==void 0?t:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:c,explicit:l}=a.getWithExplicit("orient");if(w(c))continue;if(r[c]>0&&!l){const u=nO[c];r[c]>r[u]&&a.set("orient",u,!1)}r[c]++}}delete o.component.axes[s]}if(i.axis[s]==="independent"&&n[s]&&n[s].length>1)for(const o of n[s])!!o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function rO(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t[i];if(!!r!==!!s)return;if(r&&s){const o=r.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[i]=sO(r,s)}}}else return t.map(n=>n.clone());return e}function sO(e,t){for(const n of yf){const i=kt(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return Aa(r,s);case"gridScale":return{explicit:r.explicit,value:K(r.value,s.value)}}return rr(r,s,n,"axis")});e.setWithExplicit(n,i)}return e}function oO(e,t,n,i,r){if(t==="disable")return n!==void 0;n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(w(n.labelAngle)?n.labelAngle:Mn(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===xu(i,r))return!0}return e===n[t]}const aO=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function cO(e,t){var n,i,r;let s=t.axis(e);const o=new Do,a=Z(t.encoding[e]),{mark:c,config:l}=t,u=(s==null?void 0:s.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=l.axis)===null||i===void 0?void 0:i.orient)||Ub(e),f=t.getScaleComponent(e).get("type"),d=Tb(e,f,u,t.config),g=s!==void 0?!s:po("disable",l.style,s==null?void 0:s.style,d).configValue;if(o.set("disable",g,s!==void 0),g)return o;s=s||{};const p=Lb(a,s,e,l.style,d),m={fieldOrDatumDef:a,axis:s,channel:e,model:t,scaleType:f,orient:u,labelAngle:p,mark:c,config:l};for(const b of yf){const x=b in yu?yu[b](m):Wc(b)?s[b]:void 0,$=x!==void 0,N=oO(x,b,s,t,e);if($&&N)o.set(b,x,N);else{const{configValue:C=void 0,configFrom:E=void 0}=Wc(b)&&b!=="values"?po(b,l.style,s.style,d):{},A=C!==void 0;$&&!A?o.set(b,x,N):(!(E==="vgAxisConfig")||aO.has(b)&&A||Zn(C)||w(C))&&o.set(b,C,!1)}}const h=(r=s.encoding)!==null&&r!==void 0?r:{},v=Mc.reduce((b,x)=>{var $;if(!o.hasAxisPart(x))return b;const N=ku(($=h[x])!==null&&$!==void 0?$:{},t),C=x==="labels"?eO(t,e,N):N;return C!==void 0&&!L(C)&&(b[x]={update:C}),b},{});return L(v)||o.set("encode",v,!!s.encoding||s.labelAngle!==void 0),o}function lO({encoding:e,size:t}){for(const n of We){const i=de(n);Ye(t[i])&&(Ve(e[n])&&(delete t[i],O(qa(i))))}return t}function uO(e,t,n){const i=ge(e),r=R("orient",i,n);if(i.orient=pO(i.type,t,r),r!==void 0&&r!==i.orient&&O(vg(i.orient,r)),i.type==="bar"&&i.orient){const a=R("cornerRadiusEnd",i,n);if(a!==void 0){const c=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:Lp[i.orient];for(const l of c)i[l]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}const s=R("opacity",i,n);s===void 0&&(i.opacity=dO(i.type,t));const o=R("cursor",i,n);return o===void 0&&(i.cursor=fO(i,t,n)),i}function fO(e,t,n){return t.href||e.href||R("href",e,n)?"pointer":e.cursor}function dO(e,t){return I([zi,ms,bs,ys],e)&&!Ts(t)?.7:void 0}function gO(e,t,{graticule:n}){if(n)return!1;const i=Ut("filled",e,t),r=e.type;return K(i,r!==zi&&r!==Ii&&r!==Ri)}function pO(e,t,n){switch(e){case zi:case bs:case ys:case dc:case kp:case Ep:return}const{x:i,y:r,x2:s,y2:o}=t;switch(e){case Ti:if(_(i)&&(oe(i.bin)||_(r)&&r.aggregate&&!i.aggregate))return"vertical";if(_(r)&&(oe(r.bin)||_(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(_(i)&&i.type===Bt&&!U(i.bin)||ks(i)))return"horizontal";if(!o&&(_(r)&&r.type===Bt&&!U(r.bin)||ks(r)))return"vertical"}case Ri:if(s&&!(_(i)&&oe(i.bin))&&o&&!(_(r)&&oe(r.bin)))return;case Ai:if(o)return _(r)&&oe(r.bin)?"horizontal":"vertical";if(s)return _(i)&&oe(i.bin)?"vertical":"horizontal";if(e===Ri){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case Ii:case ms:{const a=Ve(i),c=Ve(r);if(n)return n;if(a&&!c)return e!=="tick"?"horizontal":"vertical";if(!a&&c)return e!=="tick"?"vertical":"horizontal";if(a&&c){const l=i,u=r,f=l.type===fn,d=u.type===fn;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!l.aggregate&&u.aggregate?e!=="tick"?"vertical":"horizontal":l.aggregate&&!u.aggregate&&e!=="tick"?"horizontal":"vertical"}else return}}return"vertical"}const hO={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),re("x",e,{defaultPos:"mid"})),re("y",e,{defaultPos:"mid"})),Pt(e,"radius")),Pt(e,"theta"))},mO={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),or("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),or("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),co(e))},bO={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Pt(e,"x")),Pt(e,"y"))},yO={vgMark:"shape",encodeEntry:e=>Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape,i=Object.assign({type:"geoshape",projection:e.projectionName()},n&&_(n)&&n.type===dn?{field:S(n,{expr:"datum"})}:{});return[i]}},vO={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),Pt(e,"x")),Pt(e,"y")),oo(e,"url"))},OO={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),re("x",e,{defaultPos:"mid"})),re("y",e,{defaultPos:"mid"})),te("size",e,{vgChannel:"strokeWidth"})),co(e))},xO={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),re("x",e,{defaultPos:"mid"})),re("y",e,{defaultPos:"mid"})),te("size",e)),co(e))};function Mo(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),re("x",e,{defaultPos:"mid"})),re("y",e,{defaultPos:"mid"})),te("size",e)),te("angle",e)),_O(e,n,t))}function _O(e,t,n){return n?{shape:{value:n}}:te("shape",e)}const SO={vgMark:"symbol",encodeEntry:e=>Mo(e)},jO={vgMark:"symbol",encodeEntry:e=>Mo(e,"circle")},wO={vgMark:"symbol",encodeEntry:e=>Mo(e,"square")},$O={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Pt(e,"x")),Pt(e,"y"))},EO={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),or("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),or("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),te("size",e,{vgChannel:"strokeWidth"}))}},kO={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),re("x",e,{defaultPos:"mid"})),re("y",e,{defaultPos:"mid"})),oo(e)),te("size",e,{vgChannel:"fontSize"})),te("angle",e)),Jl("align",CO(e.markDef,n,t))),Jl("baseline",NO(e.markDef,n,t))),re("radius",e,{defaultPos:null})),re("theta",e,{defaultPos:null}))}};function CO(e,t,n){const i=R("align",e,n);return i===void 0?"center":void 0}function NO(e,t,n){const i=R("baseline",e,n);return i===void 0?"middle":void 0}const PO={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",s=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},je(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),re("x",e,{defaultPos:"mid",vgChannel:"xc"})),re("y",e,{defaultPos:"mid",vgChannel:"yc"})),te("size",e,{defaultValue:FO(e),vgChannel:r})),{[s]:B(R("thickness",n,t))})}};function FO(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,s=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),a=(t=R("size",i,n,{vgChannel:s}))!==null&&t!==void 0?t:n.tick.bandSize;if(a!==void 0)return a;{const c=o?o.get("range"):void 0;if(c&&jt(c)&&Y(c.step))return c.step*3/4;const l=tr(n.view,s);return l*3/4}}const Er={arc:hO,area:mO,bar:bO,circle:jO,geoshape:yO,image:vO,line:OO,point:SO,rect:$O,rule:EO,square:wO,text:kO,tick:PO,trail:xO};function AO(e){if(I([Ii,Ai,Cp],e.mark)){const t=Gc(e.mark,e.encoding);if(t.length>0)return TO(e,t)}else if(e.mark===Ti){const t=Xr.some(n=>R(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return IO(e)}return Uo(e)}const vf="faceted_path_";function TO(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:vf+e.requestDataName(W.Main),data:e.requestDataName(W.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:Uo(e,{fromPrefix:vf})}]}const Of="stack_group_";function IO(e){var t;const[n]=Uo(e,{fromPrefix:Of}),i=e.scaleName(e.stack.fieldChannel),r=(u={})=>e.vgField(e.stack.fieldChannel,u),s=(u,f)=>{const d=[r({prefix:"min",suffix:"start",expr:f}),r({prefix:"max",suffix:"start",expr:f}),r({prefix:"min",suffix:"end",expr:f}),r({prefix:"max",suffix:"end",expr:f})];return`${u}(${d.map(g=>`scale('${i}',${g})`).join(",")})`};let o,a;e.stack.fieldChannel==="x"?(o=Object.assign(Object.assign({},sn(n.encode.update,["y","yc","y2","height",...Xr])),{x:{signal:s("min","datum")},x2:{signal:s("max","datum")},clip:{value:!0}}),a={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},n.encode.update=Object.assign(Object.assign({},me(n.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},sn(n.encode.update,["x","xc","x2","width"])),{y:{signal:s("min","datum")},y2:{signal:s("max","datum")},clip:{value:!0}}),a={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},n.encode.update=Object.assign(Object.assign({},me(n.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const u of Xr){const f=Ut(u,e.markDef,e.config);n.encode.update[u]?(o[u]=n.encode.update[u],delete n.encode.update[u]):f&&(o[u]=B(f)),f&&(n.encode.update[u]={value:0})}const c=[];if(((t=e.stack.groupbyChannels)===null||t===void 0?void 0:t.length)>0)for(const u of e.stack.groupbyChannels){const f=e.fieldDef(u),d=S(f);d&&c.push(d),((f==null?void 0:f.bin)||(f==null?void 0:f.timeUnit))&&c.push(S(f,{binSuffix:"end"}))}const l=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return o=l.reduce((u,f)=>{if(n.encode.update[f])return Object.assign(Object.assign({},u),{[f]:n.encode.update[f]});{const d=Ut(f,e.markDef,e.config);return d!==void 0?Object.assign(Object.assign({},u),{[f]:B(d)}):u}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(W.Main),name:Of+e.requestDataName(W.Main),groupby:c,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:a},marks:[n]}]}]}function zO(e){var t;const{encoding:n,stack:i,mark:r,markDef:s,config:o}=e,a=n.order;if(!j(a)&&Ce(a)&&Ar(a.value)||!a&&Ar(R("order",s,o)))return;if((j(a)||_(a))&&!i)return Na(a,{expr:"datum"});if(wt(r)){const c=s.orient==="horizontal"?"y":"x",l=n[c];if(_(l)){const u=l.sort;if(j(u))return{field:S(l,{prefix:c,suffix:"sort_index",expr:"datum"})};if(qe(u))return{field:S({aggregate:Ts(e.encoding)?u.op:void 0,field:u.field},{expr:"datum"})};if($c(u)){const f=e.fieldDef(u.encoding);return{field:S(f,{expr:"datum"}),order:u.order}}else return u===null?void 0:{field:S(l,{binSuffix:((t=e.stack)===null||t===void 0?void 0:t.impute)?"mid":void 0,expr:"datum"})}}return}return}function Uo(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=e,o=K(i.clip,RO(e),LO(e)),a=ka(i),c=r.key,l=zO(e),u=DO(e),f=R("aria",i,s),d=Er[n].postEncodingTransform?Er[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:Er[n].vgMark},o?{clip:!0}:{}),a?{style:a}:{}),c?{key:c.field}:{}),l?{sort:l}:{}),u||{}),f===!1?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(W.Main)},encode:{update:Er[n].encodeEntry(e)}}),d?{transform:d}:{})]}function RO(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return(t==null?void 0:t.get("selectionExtent"))||(n==null?void 0:n.get("selectionExtent"))?!0:void 0}function LO(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function DO(e){if(!e.component.selection)return null;const t=y(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=y(i.component.selection).length,i=i.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}class xf extends gf{constructor(t,n,i,r={},s){var o;super(t,"unit",n,i,s,void 0,dl(t)?t.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const a=He(t.mark)?Object.assign({},t.mark):{type:t.mark},c=a.type;a.filled===void 0&&(a.filled=gO(a,s,{graticule:t.data&&to(t.data)}));const l=this.encoding=hh(t.encoding||{},c,a.filled,s);this.markDef=uO(a,l,s),this.size=lO({encoding:l,size:dl(t)?Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):r}),this.stack=Ol(c,l),this.specifiedScales=this.initScales(c,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegends(l),this.specifiedProjection=t.projection,this.selection=((o=t.params)!==null&&o!==void 0?o:[]).filter(u=>Hs(u))}get hasProjection(){const{encoding:t}=this,n=this.mark===gc,i=t&&fd.some(r=>k(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return ki.reduce((i,r)=>{var s;const o=Z(n[r]);return o&&(i[r]=this.initScale((s=o.scale)!==null&&s!==void 0?s:{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=ge(t);return j(n)&&(r.domain=n.map(be)),j(i)&&(r.range=i.map(be)),r}initAxes(t){return We.reduce((n,i)=>{const r=t[i];if(k(r)||i===G&&k(t.x2)||i===J&&k(t.y2)){const s=k(r)?r.axis:void 0;n[i]=s&&this.initAxis(Object.assign({},s))}return n},{})}initAxis(t){const n=y(t),i={};for(const r of n){const s=t[r];i[r]=Zn(s)?wa(s):be(s)}return i}initLegends(t){return xd.reduce((n,i)=>{const r=Z(t[i]);if(r&&Sd(i)){const s=r.legend;n[i]=s&&ge(s)}return n},{})}parseData(){this.component.data=$r(this)}parseLayoutSize(){Gv(this)}parseSelections(){this.component.selection=Nb(this,this.selection)}parseMarkGroup(){this.component.mark=AO(this)}parseAxesAndHeaders(){this.component.axes=tO(this)}assembleSelectionTopLevelSignals(t){return Qm(this,t)}assembleSignals(){return[...mu(this),...Ym(this,[])]}assembleSelectionData(t){return Zm(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return vo(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!Nn(this.parent))&&(n=Wl(this,n)),n.map(this.correctDataNames)}assembleGroupStyle(){const{style:t}=this.view||{};return t!==void 0?t:this.encoding.x||this.encoding.y?"cell":void 0}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Vt(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return Xe(n)}typedFieldDef(t){const n=this.fieldDef(t);return Se(n)?n:null}}class Wo extends zo{constructor(t,n,i,r,s){super(t,"layer",n,i,s,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((a,c)=>{if(ir(a))return new Wo(a,this,this.getName(`layer_${c}`),o,s);if(ut(a))return new xf(a,this,this.getName(`layer_${c}`),o,s);throw new Error(Kr(a))})}parseData(){this.component.data=$r(this);for(const t of this.children)t.parseData()}parseLayoutSize(){Hv(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of y(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){iO(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),mu(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),vo(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleGroupStyle(){const t=new Set;for(const i of this.children)for(const r of V(i.assembleGroupStyle()))t.add(r);const n=Array.from(t);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t;return}assembleLayout(){return null}assembleMarks(){return Jm(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),Du(this))}}function Bo(e,t,n,i,r){if(Ui(e))return new fi(e,t,n,r);if(ir(e))return new Wo(e,t,n,i,r);if(ut(e))return new xf(e,t,n,i,r);if(Mh(e))return new Qv(e,t,n,r);throw new Error(Kr(e))}var MO=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function UO(e,t={}){t.logger&&Hg(t.logger),t.fieldTitle&&zc(t.fieldTitle);try{const n=yl(Jo(t.config,e.config)),i=Il(e,n),r=Bo(i,null,"",void 0,n);r.parse(),Jy(r.component.data,r);const s=BO(r,WO(e,i.autosize,n,r),e.datasets,e.usermeta);return{spec:s,normalized:i}}finally{t.logger&&qg(),t.fieldTitle&&sh()}}function WO(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):F(t)&&(t={type:t}),r&&s&&Hm(t.type)){if(r==="step"&&s==="step")O(za()),t.type="pad";else if(r==="step"||s==="step"){const o=r==="step"?"width":"height";O(za(Ei(o)));const a=o==="width"?"height":"width";t.type=qm(a)}}return Object.assign(Object.assign(Object.assign({},y(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),Rl(n,!1)),Rl(e,!0))}function BO(e,t,n={},i){const r=e.config?tm(e.config):void 0,s=[].concat(e.assembleSelectionData([]),Mv(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),c=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let u=e.assembleLayoutSignals();u=u.filter(g=>(g.name==="width"||g.name==="height")&&g.value!==void 0?(t[g.name]=+g.value,!1):!0);const{params:f}=t,d=MO(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),a?{title:a}:{}),c?{style:c}:{}),l?{encode:{update:l}}:{}),{data:s}),o.length>0?{projections:o}:{}),e.assembleGroup([...u,...e.assembleSelectionTopLevelSignals([]),...ul(f)])),r?{config:r}:{}),i?{usermeta:i}:{})}const HO=id.version;export{on as accessPathDepth,Lr as accessPathWithDatum,UO as compile,I as contains,Te as deepEqual,Oi as deleteNestedProperty,P as duplicate,pt as entries,Tr as every,Rr as fieldIntersection,sa as flatAccessWithDatum,K as getFirstDefined,Ir as hasIntersection,T as hash,ca as internalField,Rn as isBoolean,L as isEmpty,sd as isEqual,la as isInternalField,Ar as isNullOrFalse,xi as isNumeric,y as keys,Ln as logicalExpr,ia as mergeDeep,na as never,Il as normalize,Mn as normalizeAngle,me as omit,sn as pick,zr as prefixGenerator,Dr as removePathFromField,zt as replaceAll,Oe as replacePathInField,ad as resetIdCounter,ra as setEqual,It as some,M as stringify,Dn as titleCase,Ie as unique,aa as uniqueId,ie as vals,q as varName,HO as version};export default null;
