# vl-convert

Rust library + CLI + Python bindings for converting Vega-Lite to static images (SVG, PNG, PDF, JPEG) without internet.

## Architecture

```
vl-convert-rs/      Core Rust library (Deno v8 for JS execution)
vl-convert/         CLI wrapper
vl-convert-python/  Python bindings (PyO3/maturin)
vl-convert-vendor/  JS vendoring utility (dev only, not published)
```

## Development Environment

Uses **Pixi** for environment management. All commands via `pixi run <cmd>`.

## Essential Commands

```bash
pixi run dev-py         # Build Python lib in dev mode
pixi run test-rs        # Rust tests (single-threaded, Deno requirement)
pixi run test-cli       # CLI integration tests
pixi run test-py        # Python tests
pixi run fmt-rs         # Format Rust
pixi run fmt-py         # Format Python (Ruff)
pixi run clippy         # Lint Rust (warnings = errors)
pixi run vendor         # Regenerate vendored JavaScript
pixi run bundle-licenses # Bundle Rust licenses for Python wheels
```

## Code Quality

### Rust
- Format: `cargo fmt`
- Lint: clippy with `-D warnings` (no warnings allowed)
- Tests must be single-threaded: `cargo test -- --test-threads=1`

### Python
- Format + Lint: Ruff (`pixi run fmt-py`)
- Docstrings: NumPy convention
- Type stubs: `vl_convert.pyi` must stay in sync with `lib.rs`

## Critical Constraints

1. **Single-threaded tests**: Deno runtime is not thread-safe
2. **Vendored JS**: All JavaScript is vendored - no runtime internet
3. **Generated files**: `import_map.rs` is auto-generated by `pixi run vendor`
4. **Font handling**: Custom Rust text measurement, not browser-based

## Release Process

```bash
cargo ws publish --all --force "vl-convert*" --allow-branch main custom X.Y.Z
```

CI publishes to PyPI after manual approval.

## Configuration

User config: `~/.config/vl-convert/config.json`
