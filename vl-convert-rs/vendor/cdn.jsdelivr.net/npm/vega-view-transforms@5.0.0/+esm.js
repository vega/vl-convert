/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/vega-view-transforms@5.0.0/build/vega-view-transforms.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Transform as t}from"/npm/vega-dataflow@6.0.0/+esm";import{Marks as e,boundClip as n,GroupItem as o,Item as a,Bounds as r,multiLineOffset as i,boundStroke as s}from"/npm/vega-scenegraph@5.0.0/+esm";import{inherits as c,peek as u,isObject as l}from"/npm/vega-util@2.0.0/+esm";const d="top",h="left",f="right",m="bottom",y="start",b="middle",x="end",g="group",p="axis",w="title",k="frame",M="scope",v="legend",E="row-header",z="row-footer",A="row-title",_="column-header",D="column-footer",B="column-title",O="padding",T="fit",S="fit-x",j="fit-y",q="none",F="all",H="each",L="flush",P="column",R="row";function C(e){t.call(this,null,e)}function G(t,e,n){return e(t.bounds.clear(),t,n)}c(C,t,{transform(t,o){const a=o.dataflow,r=t.mark,i=r.marktype,s=e[i],c=s.bound;let u,l=r.bounds;if(s.nested)r.items.length&&a.dirty(r.items[0]),l=G(r,c),r.items.forEach((t=>{t.bounds.clear().union(l)}));else if(i===g||t.modified())switch(o.visit(o.MOD,(t=>a.dirty(t))),l.clear(),r.items.forEach((t=>l.union(G(t,c)))),r.role){case p:case v:case w:o.reflow()}else u=o.changed(o.REM),o.visit(o.ADD,(t=>{l.union(G(t,c))})),o.visit(o.MOD,(t=>{u=u||l.alignsWith(t.bounds),a.dirty(t),l.union(G(t,c))})),u&&(l.clear(),r.items.forEach((t=>l.union(t.bounds))));return n(r),o.modifies("bounds")}});const I=":vega_identifier:";function U(e){t.call(this,0,e)}function V(e){t.call(this,null,e)}function W(e){t.call(this,null,e)}U.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},c(U,t,{transform(t,e){const n=(a=e.dataflow)._signals[I]||(a._signals[I]=a.add(0)),o=t.as;var a;let r=n.value;return e.visit(e.ADD,(t=>t[o]=t[o]||++r)),n.set(this.value=r),e}}),c(V,t,{transform(t,e){let n=this.value;n||(n=e.dataflow.scenegraph().mark(t.markdef,function(t){const e=t.groups,n=t.parent;return e&&1===e.size?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}(t),t.index),n.group.context=t.context,t.context.group||(t.context.group=n.group),n.source=this.source,n.clip=t.clip,n.interactive=t.interactive,this.value=n);const r=n.marktype===g?o:a;return e.visit(e.ADD,(t=>r.call(t,n))),(t.modified("clip")||t.modified("interactive"))&&(n.clip=t.clip,n.interactive=!!t.interactive,n.zdirty=!0,e.reflow()),n.items=e.source,e}});const J={parity:t=>t.filter(((t,e)=>e%2?t.opacity=0:1)),greedy:(t,e)=>{let n;return t.filter(((t,o)=>o&&K(n.bounds,t.bounds,e)?t.opacity=0:(n=t,1)))}},K=(t,e,n)=>n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),N=(t,e)=>{for(var n,o=1,a=t.length,r=t[0].bounds;o<a;r=n,++o)if(K(r,n=t[o].bounds,e))return!0},Q=t=>{const e=t.bounds;return e.width()>1&&e.height()>1},X=t=>(t.forEach((t=>t.opacity=1)),t),Y=(t,e)=>t.reflow(e.modified()).modifies("opacity");function Z(e){t.call(this,null,e)}c(W,t,{transform(t,e){const n=J[t.method]||J.parity,o=t.separation||0;let a,i,s=e.materialize(e.SOURCE).source;if(!s||!s.length)return;if(!t.method)return t.modified("method")&&(X(s),e=Y(e,t)),e;if(s=s.filter(Q),!s.length)return;if(t.sort&&(s=s.slice().sort(t.sort)),a=X(s),e=Y(e,t),a.length>=3&&N(a,o)){do{a=n(a,o)}while(a.length>=3&&N(a,o));a.length<3&&!u(s).opacity&&(a.length>1&&(u(a).opacity=0),u(s).opacity=1)}var c,l,h,f,y;t.boundScale&&t.boundTolerance>=0&&(c=t.boundScale,l=t.boundOrient,h=+t.boundTolerance,f=c.range(),y=new r,l===d||l===m?y.set(f[0],-1/0,f[1],1/0):y.set(-1/0,f[0],1/0,f[1]),y.expand(h||1),i=t=>y.encloses(t.bounds),s.forEach((t=>{i(t)||(t.opacity=0)})));const b=a[0].mark.bounds.clear();return s.forEach((t=>{t.opacity&&b.union(t.bounds)})),e}}),c(Z,t,{transform(t,e){const n=e.dataflow;if(e.visit(e.ALL,(t=>n.dirty(t))),e.fields&&e.fields.zindex){const t=e.source&&e.source[0];t&&(t.mark.zdirty=!0)}}});const $=new r;function tt(t,e,n){return t[e]===n?0:(t[e]=n,1)}function et(t){var e=t.items[0].orient;return e===h||e===f}function nt(t,e,n,o){var a,r,c=e.items[0],u=c.datum,l=null!=c.translate?c.translate:.5,y=c.orient,b=function(t){let e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}(u),x=c.range,g=c.offset,p=c.position,w=c.minExtent,k=c.maxExtent,M=u.title&&c.items[b[2]].items[0],v=c.titlePadding,E=c.bounds,z=M&&i(M),A=0,_=0;switch($.clear().union(E),E.clear(),(a=b[0])>-1&&E.union(c.items[a].bounds),(a=b[1])>-1&&E.union(c.items[a].bounds),y){case d:A=p||0,_=-g,r=Math.max(w,Math.min(k,-E.y1)),E.add(0,-r).add(x,0),M&&ot(t,M,r,v,z,0,-1,E);break;case h:A=-g,_=p||0,r=Math.max(w,Math.min(k,-E.x1)),E.add(-r,0).add(0,x),M&&ot(t,M,r,v,z,1,-1,E);break;case f:A=n+g,_=p||0,r=Math.max(w,Math.min(k,E.x2)),E.add(0,0).add(r,x),M&&ot(t,M,r,v,z,1,1,E);break;case m:A=p||0,_=o+g,r=Math.max(w,Math.min(k,E.y2)),E.add(0,0).add(x,r),M&&ot(t,M,r,v,0,0,1,E);break;default:A=c.x,_=c.y}return s(E.translate(A,_),c),tt(c,"x",A+l)|tt(c,"y",_+l)&&(c.bounds=$,t.dirty(c),c.bounds=E,t.dirty(c)),c.mark.bounds.clear().union(E)}function ot(t,e,n,o,a,r,i,s){const c=e.bounds;if(e.auto){const s=i*(n+a+o);let u=0,l=0;t.dirty(e),r?u=(e.x||0)-(e.x=s):l=(e.y||0)-(e.y=s),e.mark.bounds.clear().union(c.translate(-u,-l)),t.dirty(e)}s.union(c)}const at=(t,e)=>Math.floor(Math.min(t,e)),rt=(t,e)=>Math.ceil(Math.max(t,e));function it(t){return(new r).set(0,0,t.width||0,t.height||0)}function st(t){const e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function ct(t,e,n){const o=l(t)?t[e]:t;return null!=o?o:void 0!==n?n:0}function ut(t){return t<0?Math.ceil(-t):0}function lt(t,e,n){var o,a,r,i,s,c,u,l,d,h,f,m=!n.nodirty,y=n.bounds===L?it:st,g=$.set(0,0,0,0),p=ct(n.align,P),w=ct(n.align,R),k=ct(n.padding,P),M=ct(n.padding,R),v=n.columns||e.length,E=v<=0?1:Math.ceil(e.length/v),z=e.length,A=Array(z),_=Array(v),D=0,B=Array(z),O=Array(E),T=0,S=Array(z),j=Array(z),q=Array(z);for(a=0;a<v;++a)_[a]=0;for(a=0;a<E;++a)O[a]=0;for(a=0;a<z;++a)c=e[a],s=q[a]=y(c),c.x=c.x||0,S[a]=0,c.y=c.y||0,j[a]=0,r=a%v,i=~~(a/v),D=Math.max(D,u=Math.ceil(s.x2)),T=Math.max(T,l=Math.ceil(s.y2)),_[r]=Math.max(_[r],u),O[i]=Math.max(O[i],l),A[a]=k+ut(s.x1),B[a]=M+ut(s.y1),m&&t.dirty(e[a]);for(a=0;a<z;++a)a%v==0&&(A[a]=0),a<v&&(B[a]=0);if(p===H)for(r=1;r<v;++r){for(f=0,a=r;a<z;a+=v)f<A[a]&&(f=A[a]);for(a=r;a<z;a+=v)A[a]=f+_[r-1]}else if(p===F){for(f=0,a=0;a<z;++a)a%v&&f<A[a]&&(f=A[a]);for(a=0;a<z;++a)a%v&&(A[a]=f+D)}else for(p=!1,r=1;r<v;++r)for(a=r;a<z;a+=v)A[a]+=_[r-1];if(w===H)for(i=1;i<E;++i){for(f=0,o=(a=i*v)+v;a<o;++a)f<B[a]&&(f=B[a]);for(a=i*v;a<o;++a)B[a]=f+O[i-1]}else if(w===F){for(f=0,a=v;a<z;++a)f<B[a]&&(f=B[a]);for(a=v;a<z;++a)B[a]=f+T}else for(w=!1,i=1;i<E;++i)for(o=(a=i*v)+v;a<o;++a)B[a]+=O[i-1];for(d=0,a=0;a<z;++a)d=A[a]+(a%v?d:0),S[a]+=d-e[a].x;for(r=0;r<v;++r)for(h=0,a=r;a<z;a+=v)h+=B[a],j[a]+=h-e[a].y;if(p&&ct(n.center,P)&&E>1)for(a=0;a<z;++a)(d=(s=p===F?D:_[a%v])-q[a].x2-e[a].x-S[a])>0&&(S[a]+=d/2);if(w&&ct(n.center,R)&&1!==v)for(a=0;a<z;++a)(h=(s=w===F?T:O[~~(a/v)])-q[a].y2-e[a].y-j[a])>0&&(j[a]+=h/2);for(a=0;a<z;++a)g.union(q[a].translate(S[a],j[a]));switch(d=ct(n.anchor,"x"),h=ct(n.anchor,"y"),ct(n.anchor,P)){case x:d-=g.width();break;case b:d-=g.width()/2}switch(ct(n.anchor,R)){case x:h-=g.height();break;case b:h-=g.height()/2}for(d=Math.round(d),h=Math.round(h),g.clear(),a=0;a<z;++a)e[a].mark.bounds.clear();for(a=0;a<z;++a)(c=e[a]).x+=S[a]+=d,c.y+=j[a]+=h,g.union(c.mark.bounds.union(c.bounds.translate(S[a],j[a]))),m&&t.dirty(c);return g}function dt(t,e,n){var o,a,r,i,s,c,u,l=function(t){var e,n,o=t.items,a=o.length,r=0;const i={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;r<a;++r)if(n=(e=o[r]).items,e.marktype===g)switch(e.role){case p:case v:case w:break;case E:i.rowheaders.push(...n);break;case z:i.rowfooters.push(...n);break;case _:i.colheaders.push(...n);break;case D:i.colfooters.push(...n);break;case A:i.rowtitle=n[0];break;case B:i.coltitle=n[0];break;default:i.marks.push(...n)}return i}(e),d=l.marks,h=n.bounds===L?ht:ft,f=n.offset,m=n.columns||d.length,y=m<=0?1:Math.ceil(d.length/m),b=y*m;const k=lt(t,d,n);k.empty()&&k.set(0,0,0,0),l.rowheaders&&(c=ct(n.headerBand,R,null),o=mt(t,l.rowheaders,d,m,y,-ct(f,"rowHeader"),at,0,h,"x1",0,m,1,c)),l.colheaders&&(c=ct(n.headerBand,P,null),a=mt(t,l.colheaders,d,m,m,-ct(f,"columnHeader"),at,1,h,"y1",0,1,m,c)),l.rowfooters&&(c=ct(n.footerBand,R,null),r=mt(t,l.rowfooters,d,m,y,ct(f,"rowFooter"),rt,0,h,"x2",m-1,m,1,c)),l.colfooters&&(c=ct(n.footerBand,P,null),i=mt(t,l.colfooters,d,m,m,ct(f,"columnFooter"),rt,1,h,"y2",b-m,1,m,c)),l.rowtitle&&(s=ct(n.titleAnchor,R),u=ct(f,"rowTitle"),u=s===x?r+u:o-u,c=ct(n.titleBand,R,.5),yt(t,l.rowtitle,u,0,k,c)),l.coltitle&&(s=ct(n.titleAnchor,P),u=ct(f,"columnTitle"),u=s===x?i+u:a-u,c=ct(n.titleBand,P,.5),yt(t,l.coltitle,u,1,k,c))}function ht(t,e){return"x1"===e?t.x||0:"y1"===e?t.y||0:"x2"===e?(t.x||0)+(t.width||0):"y2"===e?(t.y||0)+(t.height||0):void 0}function ft(t,e){return t.bounds[e]}function mt(t,e,n,o,a,r,i,s,c,u,l,d,h,f){var m,y,b,x,g,p,w,k,M,v=n.length,E=0,z=0;if(!v)return E;for(m=l;m<v;m+=d)n[m]&&(E=i(E,c(n[m],u)));if(!e.length)return E;for(e.length>a&&(t.warn("Grid headers exceed limit: "+a),e=e.slice(0,a)),E+=r,y=0,x=e.length;y<x;++y)t.dirty(e[y]),e[y].mark.bounds.clear();for(m=l,y=0,x=e.length;y<x;++y,m+=d){for(g=(p=e[y]).mark.bounds,b=m;b>=0&&null==(w=n[b]);b-=h);s?(k=null==f?w.x:Math.round(w.bounds.x1+f*w.bounds.width()),M=E):(k=E,M=null==f?w.y:Math.round(w.bounds.y1+f*w.bounds.height())),g.union(p.bounds.translate(k-(p.x||0),M-(p.y||0))),p.x=k,p.y=M,t.dirty(p),z=i(z,g[u])}return z}function yt(t,e,n,o,a,r){if(e){t.dirty(e);var i=n,s=n;o?i=Math.round(a.x1+r*a.width()):s=Math.round(a.y1+r*a.height()),e.bounds.translate(i-(e.x||0),s-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=i,e.y=s,t.dirty(e)}}function bt(t,e,n,o,a,r,i){const s=function(t,e){const n=t[e]||{};return(e,o)=>null!=n[e]?n[e]:null!=t[e]?t[e]:o}(n,e),c=function(t,e){let n=-1/0;return t.forEach((t=>{null!=t.offset&&(n=Math.max(n,t.offset))})),n>-1/0?n:e}(t,s("offset",0)),u=s("anchor",y),l=u===x?1:u===b?.5:0,g={align:H,bounds:s("bounds",L),columns:"vertical"===s("direction")?1:t.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(e){case h:g.anchor={x:Math.floor(o.x1)-c,column:x,y:l*(i||o.height()+2*o.y1),row:u};break;case f:g.anchor={x:Math.ceil(o.x2)+c,y:l*(i||o.height()+2*o.y1),row:u};break;case d:g.anchor={y:Math.floor(a.y1)-c,row:x,x:l*(r||a.width()+2*a.x1),column:u};break;case m:g.anchor={y:Math.ceil(a.y2)+c,x:l*(r||a.width()+2*a.x1),column:u};break;case"top-left":g.anchor={x:c,y:c};break;case"top-right":g.anchor={x:r-c,y:c,column:x};break;case"bottom-left":g.anchor={x:c,y:i-c,row:x};break;case"bottom-right":g.anchor={x:r-c,y:i-c,column:x,row:x}}return g}function xt(t,e){var n,o,a=e.items[0],r=a.datum,i=a.orient,c=a.bounds,u=a.x,l=a.y;return a._bounds?a._bounds.clear().union(c):a._bounds=c.clone(),c.clear(),function(t,e,n){var o=e.padding,a=o-n.x,r=o-n.y;if(e.datum.title){var i=e.items[1].items[0],s=i.anchor,c=e.titlePadding||0,u=o-i.x,l=o-i.y;switch(i.orient){case h:a+=Math.ceil(i.bounds.width())+c;break;case f:case m:break;default:r+=i.bounds.height()+c}switch((a||r)&&pt(t,n,a,r),i.orient){case h:l+=gt(e,n,i,s,1,1);break;case f:u+=gt(e,n,i,x,0,0)+c,l+=gt(e,n,i,s,1,1);break;case m:u+=gt(e,n,i,s,0,0),l+=gt(e,n,i,x,-1,0,1)+c;break;default:u+=gt(e,n,i,s,0,0)}(u||l)&&pt(t,i,u,l),(u=Math.round(i.bounds.x1-o))<0&&(pt(t,n,-u,0),pt(t,i,-u,0))}else(a||r)&&pt(t,n,a,r)}(t,a,a.items[0].items[0]),c=function(t,e){return t.items.forEach((t=>e.union(t.bounds))),e.x1=t.padding,e.y1=t.padding,e}(a,c),n=2*a.padding,o=2*a.padding,c.empty()||(n=Math.ceil(c.width()+n),o=Math.ceil(c.height()+o)),"symbol"===r.type&&function(t){const e=t.reduce(((t,e)=>(t[e.column]=Math.max(e.bounds.x2-e.x,t[e.column]||0),t)),{});t.forEach((t=>{t.width=e[t.column],t.height=t.bounds.y2-t.y}))}(a.items[0].items[0].items[0].items),i!==q&&(a.x=u=0,a.y=l=0),a.width=n,a.height=o,s(c.set(u,l,u+n,l+o),a),a.mark.bounds.clear().union(c),a}function gt(t,e,n,o,a,r,s){const c="symbol"!==t.datum.type,u=n.datum.vgrad,l=(!c||!r&&u||s?e:e.items[0]).bounds[a?"y2":"x2"]-t.padding,d=u&&r?l:0,h=u&&r?0:l,f=a<=0?0:i(n);return Math.round(o===y?d:o===x?h-f:.5*(l-f))}function pt(t,e,n,o){e.x+=n,e.y+=o,e.bounds.translate(n,o),e.mark.bounds.translate(n,o),t.dirty(e)}function wt(e){t.call(this,null,e)}c(wt,t,{transform(t,e){const n=e.dataflow;return t.mark.items.forEach((e=>{t.layout&&dt(n,e,t.layout),function(t,e,n){var o,a,i,s,c,u=e.items,l=Math.max(0,e.width||0),b=Math.max(0,e.height||0),F=(new r).set(0,0,l,b),H=F.clone(),L=F.clone(),P=[];for(s=0,c=u.length;s<c;++s)switch((a=u[s]).role){case p:(et(a)?H:L).union(nt(t,a,l,b));break;case w:o=a;break;case v:P.push(xt(t,a));break;case k:case M:case E:case z:case A:case _:case D:case B:H.union(a.bounds),L.union(a.bounds);break;default:F.union(a.bounds)}if(P.length){const e={};P.forEach((t=>{(i=t.orient||f)!==q&&(e[i]||(e[i]=[])).push(t)}));for(const o in e){const a=e[o];lt(t,a,bt(a,o,n.legends,H,L,l,b))}P.forEach((e=>{const o=e.bounds;if(o.equals(e._bounds)||(e.bounds=e._bounds,t.dirty(e),e.bounds=o,t.dirty(e)),!n.autosize||n.autosize.type!==T&&n.autosize.type!==S&&n.autosize.type!==j)F.union(o);else switch(e.orient){case h:case f:F.add(o.x1,0).add(o.x2,0);break;case d:case m:F.add(0,o.y1).add(0,o.y2)}}))}F.union(H).union(L),o&&F.union(function(t,e,n,o,a){var r,i=e.items[0],s=i.frame,c=i.orient,u=i.anchor,l=i.offset,b=i.padding,p=i.items[0].items[0],w=i.items[1]&&i.items[1].items[0],k=c===h||c===f?o:n,M=0,v=0,E=0,z=0,A=0;if(s!==g?c===h?(M=a.y2,k=a.y1):c===f?(M=a.y1,k=a.y2):(M=a.x1,k=a.x2):c===h&&(M=o,k=0),r=u===y?M:u===x?k:(M+k)/2,w&&w.text){switch(c){case d:case m:A=p.bounds.height()+b;break;case h:z=p.bounds.width()+b;break;case f:z=-p.bounds.width()-b}$.clear().union(w.bounds),$.translate(z-(w.x||0),A-(w.y||0)),tt(w,"x",z)|tt(w,"y",A)&&(t.dirty(w),w.bounds.clear().union($),w.mark.bounds.clear().union($),t.dirty(w)),$.clear().union(w.bounds)}else $.clear();switch($.union(p.bounds),c){case d:v=r,E=a.y1-$.height()-l;break;case h:v=a.x1-$.width()-l,E=r;break;case f:v=a.x2+$.width()+l,E=r;break;case m:v=r,E=a.y2+l;break;default:v=i.x,E=i.y}return tt(i,"x",v)|tt(i,"y",E)&&($.translate(v,E),t.dirty(i),i.bounds.clear().union($),e.bounds.clear().union($),t.dirty(i)),i.bounds}(t,o,l,b,F));e.clip&&F.set(0,0,e.width||0,e.height||0);!function(t,e,n,o){const a=o.autosize||{},r=a.type;if(t._autosize<1||!r)return;let i=t._width,s=t._height,c=Math.max(0,e.width||0),u=Math.max(0,Math.ceil(-n.x1)),l=Math.max(0,e.height||0),d=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-c)),f=Math.max(0,Math.ceil(n.y2-l));if(a.contains===O){const e=t.padding();i-=e.left+e.right,s-=e.top+e.bottom}r===q?(u=0,d=0,c=i,l=s):r===T?(c=Math.max(0,i-u-h),l=Math.max(0,s-d-f)):r===S?(c=Math.max(0,i-u-h),s=l+d+f):r===j?(i=c+u+h,l=Math.max(0,s-d-f)):"pad"===r&&(i=c+u+h,s=l+d+f);t._resizeView(i,s,c,l,[u,d],a.resize)}(t,e,F,n)}(n,e,t)})),(o=t.mark.group)&&"legend-entry"!==o.mark.role?e.reflow():e;var o}});export{C as bound,U as identifier,V as mark,W as overlap,Z as render,wt as viewlayout};export default null;
//# sourceMappingURL=/sm/fc4981a6a0d38a7d4b7a2eced681db6bf6afec8a256a87c9832a35c253c7963d.map