/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/vega-wordcloud@5.1.0/build/vega-wordcloud.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{canvas as t}from"/npm/vega-canvas@2.0.0/+esm";import{Transform as e}from"/npm/vega-dataflow@6.1.0/+esm";import{inherits as n,error as r,isFunction as a,constant as o,extent as i}from"/npm/vega-util@2.1.0/+esm";import{scale as f}from"/npm/vega-scale@8.1.0/+esm";import{random as s}from"/npm/vega-statistics@2.0.0/+esm";var u=Math.PI/180,l=2048;function y(){var e,n,r,a,o,i,f,s=[256,256],u=d,y=[],p=Math.random,v={};function z(t,e,n){for(var r,a,o,i,f,l=e.x,y=e.y,x=Math.hypot(s[0],s[1]),m=u(s),d=p()<.5?1:-1,c=-d;(r=m(c+=d))&&(a=~~r[0],o=~~r[1],!(Math.min(Math.abs(a),Math.abs(o))>=x));)if(e.x=l+a,e.y=y+o,!(e.x+e.x0<0||e.y+e.y0<0||e.x+e.x1>s[0]||e.y+e.y1>s[1]||n&&h(e,t,s[0])||n&&(f=n,!((i=e).x+i.x1>f[0].x&&i.x+i.x0<f[1].x&&i.y+i.y1>f[0].y&&i.y+i.y0<f[1].y)))){for(var g,v=e.sprite,z=e.width>>5,M=s[0]>>5,b=e.x-(z<<4),S=127&b,w=32-S,W=e.y1-e.y0,T=(e.y+e.y0)*M+(b>>5),k=0;k<W;k++){g=0;for(var D=0;D<=z;D++)t[T+D]|=g<<w|(D<z?(g=v[k*z+D])>>>S:0);T+=M}return e.sprite=null,!0}return!1}return v.layout=function(){for(var u=function(t){t.width=t.height=1;var e=Math.sqrt(t.getContext("2d").getImageData(0,0,1,1).data.length>>2);t.width=2048/e,t.height=l/e;var n=t.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:e}}(t()),h=function(t){var e=[],n=-1;for(;++n<t;)e[n]=0;return e}((s[0]>>5)*s[1]),d=null,c=y.length,g=-1,v=[],M=y.map((t=>({text:e(t),font:n(t),style:a(t),weight:o(t),rotate:i(t),size:~~(r(t)+1e-14),padding:f(t),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:t}))).sort(((t,e)=>e.size-t.size));++g<c;){var b=M[g];b.x=s[0]*(p()+.5)>>1,b.y=s[1]*(p()+.5)>>1,x(u,b,M,g),b.hasText&&z(h,b,d)&&(v.push(b),d?m(d,b):d=[{x:b.x+b.x0,y:b.y+b.y0},{x:b.x+b.x1,y:b.y+b.y1}],b.x-=s[0]>>1,b.y-=s[1]>>1)}return v},v.words=function(t){return arguments.length?(y=t,v):y},v.size=function(t){return arguments.length?(s=[+t[0],+t[1]],v):s},v.font=function(t){return arguments.length?(n=c(t),v):n},v.fontStyle=function(t){return arguments.length?(a=c(t),v):a},v.fontWeight=function(t){return arguments.length?(o=c(t),v):o},v.rotate=function(t){return arguments.length?(i=c(t),v):i},v.text=function(t){return arguments.length?(e=c(t),v):e},v.spiral=function(t){return arguments.length?(u=g[t]||t,v):u},v.fontSize=function(t){return arguments.length?(r=c(t),v):r},v.padding=function(t){return arguments.length?(f=c(t),v):f},v.random=function(t){return arguments.length?(p=t,v):p},v}function x(t,e,n,r){if(!e.sprite){var a=t.context,o=t.ratio;a.clearRect(0,0,2048/o,l/o);var i,f,s,y,x,h=0,m=0,d=0,c=n.length;for(--r;++r<c;){if(e=n[r],a.save(),a.font=e.style+" "+e.weight+" "+~~((e.size+1)/o)+"px "+e.font,i=a.measureText(e.text+"m").width*o,s=e.size<<1,e.rotate){var g=Math.sin(e.rotate*u),p=Math.cos(e.rotate*u),v=i*p,z=i*g,M=s*p,b=s*g;i=Math.max(Math.abs(v+b),Math.abs(v-b))+31>>5<<5,s=~~Math.max(Math.abs(z+M),Math.abs(z-M))}else i=i+31>>5<<5;if(s>d&&(d=s),h+i>=2048&&(h=0,m+=d,d=0),m+s>=l)break;a.translate((h+(i>>1))/o,(m+(s>>1))/o),e.rotate&&a.rotate(e.rotate*u),a.fillText(e.text,0,0),e.padding&&(a.lineWidth=2*e.padding,a.strokeText(e.text,0,0)),a.restore(),e.width=i,e.height=s,e.xoff=h,e.yoff=m,e.x1=i>>1,e.y1=s>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,h+=i}for(var S=a.getImageData(0,0,2048/o,l/o).data,w=[];--r>=0;)if((e=n[r]).hasText){for(f=(i=e.width)>>5,s=e.y1-e.y0,y=0;y<s*f;y++)w[y]=0;if(null==(h=e.xoff))return;m=e.yoff;var W=0,T=-1;for(x=0;x<s;x++){for(y=0;y<i;y++){var k=f*x+(y>>5),D=S[2048*(m+x)+(h+y)<<2]?1<<31-y%32:0;w[k]|=D,W|=D}W?T=x:(e.y0++,s--,x--,m++)}e.y1=e.y0+T,e.sprite=w.slice(0,(e.y1-e.y0)*f)}}}function h(t,e,n){n>>=5;for(var r,a=t.sprite,o=t.width>>5,i=t.x-(o<<4),f=127&i,s=32-f,u=t.y1-t.y0,l=(t.y+t.y0)*n+(i>>5),y=0;y<u;y++){r=0;for(var x=0;x<=o;x++)if((r<<s|(x<o?(r=a[y*o+x])>>>f:0))&e[l+x])return!0;l+=n}return!1}function m(t,e){var n=t[0],r=t[1];e.x+e.x0<n.x&&(n.x=e.x+e.x0),e.y+e.y0<n.y&&(n.y=e.y+e.y0),e.x+e.x1>r.x&&(r.x=e.x+e.x1),e.y+e.y1>r.y&&(r.y=e.y+e.y1)}function d(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function c(t){return"function"==typeof t?t:function(){return t}}var g={archimedean:d,rectangular:function(t){var e=4*t[0]/t[1],n=0,r=0;return function(t){var a=t<0?-1:1;switch(Math.sqrt(1+4*a*t)-a&3){case 0:n+=e;break;case 1:r+=4;break;case 2:n-=e;break;default:r-=4}return[n,r]}}};const p=["x","y","font","fontSize","fontStyle","fontWeight","angle"],v=["text","font","rotate","fontSize","fontStyle","fontWeight"];function z(t){e.call(this,y(),t)}z.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:p}]},n(z,e,{transform(t,e){!t.size||t.size[0]&&t.size[1]||r("Wordcloud size dimensions must be non-zero.");const n=t.modified();if(!(n||e.changed(e.ADD_REM)||v.some((function(n){const r=t[n];return a(r)&&e.modified(r.fields)}))))return;const u=e.materialize(e.SOURCE).source,l=this.value,y=t.as||p;let x,h=t.fontSize||14;if(a(h)?x=t.fontSizeRange:h=o(h),x){const t=h,e=f("sqrt")().domain(i(u,t)).range(x);h=n=>e(t(n))}u.forEach((t=>{t[y[0]]=NaN,t[y[1]]=NaN,t[y[3]]=0}));const m=l.words(u).text(t.text).size(t.size||[500,500]).padding(t.padding||1).spiral(t.spiral||"archimedean").rotate(t.rotate||0).font(t.font||"sans-serif").fontStyle(t.fontStyle||"normal").fontWeight(t.fontWeight||"normal").fontSize(h).random(s).layout(),d=l.size(),c=d[0]>>1,g=d[1]>>1,z=m.length;for(let t,e,n=0;n<z;++n)t=m[n],e=t.datum,e[y[0]]=t.x+c,e[y[1]]=t.y+g,e[y[2]]=t.font,e[y[3]]=t.size,e[y[4]]=t.style,e[y[5]]=t.weight,e[y[6]]=t.rotate;return e.reflow(n).modifies(y)}});export{z as wordcloud};export default null;
//# sourceMappingURL=/sm/4b46d9d60ba3f45733d9b06874bc2d86d4a04f47b8b511b1f8555b686bab4268.map