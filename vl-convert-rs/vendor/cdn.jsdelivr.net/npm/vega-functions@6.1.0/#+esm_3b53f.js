/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/vega-functions@6.1.0/build/vega-functions.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{truthy as t,error as n,hasOwnProperty as e,extend as o,isArray as r,field as i,isFunction as a,isString as c,isRegExp as s,ascending as u,peek as l,isBoolean as f,isDate as m,isNumber as d,isObject as p,toBoolean as h,toDate as g,toNumber as v,toString as x,flush as y,lerp as w,pad as b,span as S,inrange as N,truncate as E,quarter as _,utcquarter as A,extent as F,clampRange as $,panLinear as k,panLog as R,panPow as M,panSymlog as I,zoomLinear as L,zoomLog as P,zoomPow as q,zoomSymlog as D,stringValue as T,identity as X,array as z}from"/npm/vega-util@2.1.0/+esm";import{codegenExpression as B,Literal as O,constants as U,functions as Y,parseExpression as G,CallExpression as j}from"/npm/vega-expression@6.1.0/+esm";import{bandSpace as C,scale as H,scaleFraction as V,isRegisteredScale as W}from"/npm/vega-scale@8.1.0/+esm";import{geoArea as Z,geoBounds as J,geoCentroid as K}from"/npm/d3-geo@3.1.1/+esm";import{rgb as Q,lab as tt,hcl as nt,hsl as et}from"/npm/d3-color@3.1.0/+esm";import{isTuple as ot}from"/npm/vega-dataflow@6.1.0/+esm";import{Gradient as rt,pathRender as it,pathParse as at,Bounds as ct,intersect as st}from"/npm/vega-scenegraph@5.1.0/+esm";import{selectionVisitor as ut,selectionTest as lt,selectionIdTest as ft,selectionResolve as mt,selectionTuples as dt}from"/npm/vega-selections@6.1.0/+esm";import{random as pt,cumulativeNormal as ht,cumulativeLogNormal as gt,cumulativeUniform as vt,densityNormal as xt,densityLogNormal as yt,densityUniform as wt,quantileNormal as bt,quantileLogNormal as St,quantileUniform as Nt,sampleNormal as Et,sampleLogNormal as _t,sampleUniform as At}from"/npm/vega-statistics@2.0.0/+esm";import{utcOffset as Ft,utcSequence as $t,timeOffset as kt,timeSequence as Rt,timeUnitSpecifier as Mt,week as It,utcweek as Lt,dayofyear as Pt,utcdayofyear as qt}from"/npm/vega-time@3.1.0/+esm";import{range as Dt}from"/npm/d3-array@3.2.4/+esm";function Tt(t){const n=this.context.data[t];return n?n.values.value:[]}function Xt(t,n,e){const o=this.context.data[t]["index:"+n],r=o?o.value.get(e):void 0;return r?r.count:r}function zt(n,e){const o=this.context.dataflow,r=this.context.data[n].input;return o.pulse(r,o.changeset().remove(t).insert(e)),1}function Bt(t,n,e){if(t){const e=this.context.dataflow,o=t.mark.source;e.pulse(o,e.changeset().encode(t,n))}return void 0!==e?e:t}const Ot=t=>function(n,e){const o=this.context.dataflow.locale();return null===n?"null":o[t](e)(n)},Ut=Ot("format"),Yt=Ot("timeFormat"),Gt=Ot("utcFormat"),jt=Ot("timeParse"),Ct=Ot("utcParse"),Ht=new Date(2e3,0,1);function Vt(t,n,e){return Number.isInteger(t)&&Number.isInteger(n)?(Ht.setYear(2e3),Ht.setMonth(t),Ht.setDate(n),Yt.call(this,Ht,e)):""}function Wt(t){return Vt.call(this,t,1,"%B")}function Zt(t){return Vt.call(this,t,1,"%b")}function Jt(t){return Vt.call(this,0,2+t,"%A")}function Kt(t){return Vt.call(this,0,2+t,"%a")}const Qt=":",tn="@",nn="%",en="$";function on(t,o,r,i){o[0].type!==O&&n("First argument to data functions must be a string literal.");const a=o[0].value,c=":"+a;if(!e(c,i))try{i[c]=r.getData(a).tuplesRef()}catch(t){}}function rn(t,o,r,i){o[0].type!==O&&n("First argument to indata must be a string literal."),o[1].type!==O&&n("Second argument to indata must be a string literal.");const a=o[0].value,c=o[1].value,s="@"+c;e(s,i)||(i[s]=r.getData(a).indataRef(r,c))}function an(t,n,e,o){if(n[0].type===O)cn(e,o,n[0].value);else for(t in e.scales)cn(e,o,t)}function cn(t,n,o){const r=nn+o;if(!e(n,r))try{n[r]=t.scaleRef(o)}catch(t){}}function sn(t,n){if(c(t)){const e=n.scales[t];return e&&W(e.value)?e.value:void 0}if(a(t))return W(t)?t:void 0}function un(t,n,e){n.__bandwidth=t=>t&&t.bandwidth?t.bandwidth():0,e._bandwidth=an,e._range=an,e._scale=an;const o=n=>"_["+(n.type===O?T(nn+n.value):T(nn)+"+"+t(n))+"]";return{_bandwidth:t=>`this.__bandwidth(${o(t[0])})`,_range:t=>`${o(t[0])}.range()`,_scale:n=>`${o(n[0])}(${t(n[1])})`}}function ln(t,n){return function(e,o,r){if(e){const n=sn(e,(r||this).context);return n&&n.path[t](o)}return n(o)}}const fn=ln("area",Z),mn=ln("bounds",J),dn=ln("centroid",K);function pn(t,n){const e=sn(t,(n||this).context);return e&&e.scale()}function hn(t){const n=this.context.group;let e=!1;if(n)for(;t;){if(t===n){e=!0;break}t=t.mark.group}return e}function gn(t,n,e){try{t[n].apply(t,["EXPRESSION"].concat([].slice.call(e)))}catch(n){t.warn(n)}return e[e.length-1]}function vn(){return gn(this.context.dataflow,"warn",arguments)}function xn(){return gn(this.context.dataflow,"info",arguments)}function yn(){return gn(this.context.dataflow,"debug",arguments)}function wn(t){const n=t/255;return n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}function bn(t){const n=Q(t);return.2126*wn(n.r)+.7152*wn(n.g)+.0722*wn(n.b)}function Sn(t,n){const e=bn(t),o=bn(n);return(Math.max(e,o)+.05)/(Math.min(e,o)+.05)}function Nn(){const t=[].slice.call(arguments);return t.unshift({}),o(...t)}function En(t,n){return t===n||t!=t&&n!=n||(r(t)?!(!r(n)||t.length!==n.length)&&function(t,n){for(let e=0,o=t.length;e<o;++e)if(!En(t[e],n[e]))return!1;return!0}(t,n):!(!p(t)||!p(n))&&_n(t,n))}function _n(t,n){for(const e in t)if(!En(t[e],n[e]))return!1;return!0}function An(t){return n=>_n(t,n)}function Fn(n,e,o,i,a,c){const s=this.context.dataflow,u=this.context.data[n],l=u.input,f=s.stamp();let m,d,p=u.changes;if(!1===s._trigger||!(l.value.length||e||i))return 0;if((!p||p.stamp<f)&&(u.changes=p=s.changeset(),p.stamp=f,s.runAfter((()=>{u.modified=!0,s.pulse(l,p).run()}),!0,1)),o&&(m=!0===o?t:r(o)||ot(o)?o:An(o),p.remove(m)),e&&p.insert(e),i&&(m=An(i),l.value.some(m)?p.remove(m):p.insert(i)),a)for(d in c)p.modify(a,d,c[d]);return 1}function $n(t){const n=t.touches,e=n[0].clientX-n[1].clientX,o=n[0].clientY-n[1].clientY;return Math.hypot(e,o)}function kn(t){const n=t.touches;return Math.atan2(n[0].clientY-n[1].clientY,n[0].clientX-n[1].clientX)}const Rn={};function Mn(t,n){const e=Rn[n]||(Rn[n]=i(n));return r(t)?t.map(e):e(t)}function In(t){return r(t)||ArrayBuffer.isView(t)?t:null}function Ln(t){return In(t)||(c(t)?t:null)}function Pn(t,...n){return In(t).join(...n)}function qn(t,...n){return Ln(t).indexOf(...n)}function Dn(t,...n){return Ln(t).lastIndexOf(...n)}function Tn(t,...n){return Ln(t).slice(...n)}function Xn(t,e,o){return a(o)&&n("Function argument passed to replace."),c(e)||s(e)||n("Please pass a string or RegExp argument to replace."),String(t).replace(e,o)}function zn(t){return In(t).slice().reverse()}function Bn(t){return In(t).slice().sort(u)}function On(t,n,e){return C(t||0,n||0,e||0)}function Un(t,n){const e=sn(t,(n||this).context);return e&&e.bandwidth?e.bandwidth():0}function Yn(t,n){const e=sn(t,(n||this).context);return e?e.copy():void 0}function Gn(t,n){const e=sn(t,(n||this).context);return e?e.domain():[]}function jn(t,n,e){const o=sn(t,(e||this).context);return o?r(n)?(o.invertRange||o.invert)(n):(o.invert||o.invertExtent)(n):void 0}function Cn(t,n){const e=sn(t,(n||this).context);return e&&e.range?e.range():[]}function Hn(t,n,e){const o=sn(t,(e||this).context);return o?o(n):void 0}function Vn(t,n,e,o,r){t=sn(t,(r||this).context);const i=rt(n,e);let a=t.domain(),c=a[0],s=l(a),u=X;return s-c?u=V(t,c,s):t=(t.interpolator?H("sequential")().interpolator(t.interpolator()):H("linear")().interpolate(t.interpolate()).range(t.range())).domain([c=0,s=1]),t.ticks&&(a=t.ticks(+o||15),c!==a[0]&&a.unshift(c),s!==l(a)&&a.push(s)),a.forEach((n=>i.stop(u(n),t(n)))),i}function Wn(t,n,e){const o=sn(t,(e||this).context);return function(t){return o?o.path.context(t)(n):""}}function Zn(t){let n=null;return function(e){return e?it(e,n=n||at(t)):t}}const Jn=t=>t.data;function Kn(t,n){const e=Tt.call(n,t);return e.root&&e.root.lookup||{}}function Qn(t,n,e){const o=Kn(t,this),r=o[n],i=o[e];return r&&i?r.path(i).map(Jn):void 0}function te(t,n){const e=Kn(t,this)[n];return e?e.ancestors().map(Jn):void 0}const ne=()=>"undefined"!=typeof window&&window||null;function ee(){const t=ne();return t?t.screen:{}}function oe(){const t=ne();return t?[t.innerWidth,t.innerHeight]:[void 0,void 0]}function re(){const t=this.context.dataflow,n=t.container&&t.container();return n?[n.clientWidth,n.clientHeight]:[void 0,void 0]}function ie(t,n,e){if(!t)return[];const[o,r]=t,i=(new ct).set(o[0],o[1],r[0],r[1]),a=e||this.context.dataflow.scenegraph().root;return st(a,i,function(t){let n=null;if(t){const e=z(t.marktype),o=z(t.markname);n=t=>(!e.length||e.some((n=>t.marktype===n)))&&(!o.length||o.some((n=>t.name===n)))}return n}(n))}const ae={random:()=>pt(),cumulativeNormal:ht,cumulativeLogNormal:gt,cumulativeUniform:vt,densityNormal:xt,densityLogNormal:yt,densityUniform:wt,quantileNormal:bt,quantileLogNormal:St,quantileUniform:Nt,sampleNormal:Et,sampleLogNormal:_t,sampleUniform:At,isArray:r,isBoolean:f,isDate:m,isDefined:t=>void 0!==t,isNumber:d,isObject:p,isRegExp:s,isString:c,isTuple:ot,isValid:t=>null!=t&&t==t,toBoolean:h,toDate:t=>g(t),toNumber:v,toString:x,indexof:qn,join:Pn,lastindexof:Dn,replace:Xn,reverse:zn,sort:Bn,slice:Tn,flush:y,lerp:w,merge:Nn,pad:b,peek:l,pluck:Mn,span:S,inrange:N,truncate:E,rgb:Q,lab:tt,hcl:nt,hsl:et,luminance:bn,contrast:Sn,sequence:Dt,format:Ut,utcFormat:Gt,utcParse:Ct,utcOffset:Ft,utcSequence:$t,timeFormat:Yt,timeParse:jt,timeOffset:kt,timeSequence:Rt,timeUnitSpecifier:Mt,monthFormat:Wt,monthAbbrevFormat:Zt,dayFormat:Jt,dayAbbrevFormat:Kt,quarter:_,utcquarter:A,week:It,utcweek:Lt,dayofyear:Pt,utcdayofyear:qt,warn:vn,info:xn,debug:yn,extent:t=>F(t),inScope:hn,intersect:ie,clampRange:$,pinchDistance:$n,pinchAngle:kn,screen:ee,containerSize:re,windowSize:oe,bandspace:On,setdata:zt,pathShape:Zn,panLinear:k,panLog:R,panPow:M,panSymlog:I,zoomLinear:L,zoomLog:P,zoomPow:q,zoomSymlog:D,encode:Bt,modify:Fn,lassoAppend:function(t,n,e,o=5){const r=(t=z(t))[t.length-1];return void 0===r||Math.hypot(r[0]-n,r[1]-e)>o?[...t,[n,e]]:t},lassoPath:function(t){return z(t).reduce(((n,[e,o],r)=>n+(0==r?`M ${e},${o} `:r===t.length-1?" Z":`L ${e},${o} `)),"")},intersectLasso:function(t,n,e){const{x:o,y:r,mark:i}=e,a=(new ct).set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(const[t,e]of n)t<a.x1&&(a.x1=t),t>a.x2&&(a.x2=t),e<a.y1&&(a.y1=e),e>a.y2&&(a.y2=e);return a.translate(o,r),ie([[a.x1,a.y1],[a.x2,a.y2]],t,i).filter((t=>function(t,n,e){let o=0;for(let r=0,i=e.length-1;r<e.length;i=r++){const[a,c]=e[i],[s,u]=e[r];u>n!=c>n&&t<(a-s)*(n-u)/(c-u)+s&&o++}return 1&o}(t.x,t.y,n)))}},ce=["view","item","group","xy","x","y"],se="this.",ue={},le={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:t=>`_[${T("$"+t)}]`,functions:function(t){const n=Y(t);ce.forEach((t=>n[t]="event.vega."+t));for(const t in ae)n[t]=se+t;return o(n,un(t,ae,ue)),n},constants:U,visitors:ue},fe=B(le);function me(t,n,e){return 1===arguments.length?ae[t]:(ae[t]=n,e&&(ue[t]=e),fe&&(fe.functions[t]=se+t),this)}function de(t,r){const i={};let a;try{t=c(t)?t:T(t)+"",a=G(t)}catch(e){n("Expression parse error: "+t)}a.visit((t=>{if(t.type!==j)return;const n=t.callee.name,e=le.visitors[n];e&&e(n,t.arguments,r,i)}));const s=fe(a);return s.globals.forEach((t=>{const n="$"+t;!e(i,n)&&r.getSignal(t)&&(i[n]=r.signalRef(t))})),{$expr:o({code:s.code},r.options.ast?{ast:a}:null),$fields:s.fields,$params:i}}me("bandwidth",Un,an),me("copy",Yn,an),me("domain",Gn,an),me("range",Cn,an),me("invert",jn,an),me("scale",Hn,an),me("gradient",Vn,an),me("geoArea",fn,an),me("geoBounds",mn,an),me("geoCentroid",dn,an),me("geoShape",Wn,an),me("geoScale",pn,an),me("indata",Xt,rn),me("data",Tt,on),me("treePath",Qn,on),me("treeAncestors",te,on),me("vlSelectionTest",lt,ut),me("vlSelectionIdTest",ft,ut),me("vlSelectionResolve",mt,ut),me("vlSelectionTuples",dt);export{Qt as DataPrefix,tn as IndexPrefix,nn as ScalePrefix,en as SignalPrefix,On as bandspace,Un as bandwidth,fe as codeGenerator,le as codegenParams,re as containerSize,Sn as contrast,Yn as copy,Tt as data,on as dataVisitor,Kt as dayAbbrevFormat,Jt as dayFormat,yn as debug,Gn as domain,Bt as encode,me as expressionFunction,Ut as format,ae as functionContext,fn as geoArea,mn as geoBounds,dn as geoCentroid,pn as geoScale,Wn as geoShape,hn as inScope,Xt as indata,rn as indataVisitor,qn as indexof,xn as info,jn as invert,Pn as join,Dn as lastindexof,bn as luminance,Nn as merge,Fn as modify,Zt as monthAbbrevFormat,Wt as monthFormat,de as parseExpression,Zn as pathShape,kn as pinchAngle,$n as pinchDistance,Mn as pluck,Cn as range,Xn as replace,zn as reverse,Hn as scale,Vn as scaleGradient,an as scaleVisitor,ee as screen,zt as setdata,Tn as slice,Bn as sort,Yt as timeFormat,jt as timeParse,te as treeAncestors,Qn as treePath,Gt as utcFormat,Ct as utcParse,vn as warn,oe as windowSize};export default null;
//# sourceMappingURL=/sm/691089c19d7ca51ed8863ce224721308561834e3e4ef1e8a2dfed07842158bc2.map