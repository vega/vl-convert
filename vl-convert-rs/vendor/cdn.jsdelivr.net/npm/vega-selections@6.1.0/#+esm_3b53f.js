/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/vega-selections@6.1.0/build/vega-selection.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{bisector as e,union as t,intersection as n}from"/npm/d3-array@3.2.4/+esm";import{field as r,extend as i,array as u,toNumber as f,error as l,peek as s,hasOwnProperty as a,isDate as o,isArray as c,inrange as p}from"/npm/vega-util@2.1.0/+esm";import{Literal as d}from"/npm/vega-expression@6.1.0/+esm";const v=Symbol("vega_selection_getter");function g(e){return e.getter&&e.getter[v]||(e.getter=r(e.field),e.getter[v]=!0),e.getter}const h="intersect",m="union",y="or",E="and",_="_vgsid_",R=r(_),x="index:unit";function $(e,t){for(var n,r,i=t.fields,u=t.values,l=i.length,s=0;s<l;++s)if(n=g(r=i[s])(e),o(n)&&(n=f(n)),o(u[s])&&(u[s]=f(u[s])),c(u[s])&&o(u[s][0])&&(u[s]=u[s].map(f)),"E"===r.type){if(c(u[s])?!u[s].includes(n):n!==u[s])return!1}else if("R"===r.type){if(!p(n,u[s]))return!1}else if("R-RE"===r.type){if(!p(n,u[s],!0,!1))return!1}else if("R-E"===r.type){if(!p(n,u[s],!1,!1))return!1}else if("R-LE"===r.type){if(!p(n,u[s],!1,!0))return!1}else if("E-LT"===r.type){if(n>=u[s])return!1}else if("E-LTE"===r.type){if(n>u[s])return!1}else if("E-GT"===r.type){if(n<=u[s])return!1}else if("E-GTE"===r.type){if(n<u[s])return!1}else if("E-VALID"===r.type){if(null===n||isNaN(n))return!1}else if("E-ONE"===r.type&&-1===u[s].indexOf(n))return!1;return!0}function b(e,t,n){for(var r,i,u,f,l,s=this.context.data[e],a=s?s.values.value:[],o=s?s[x]&&s[x].value:void 0,c=n===h,p=a.length,d=0;d<p;++d)if(r=a[d],o&&c){if(-1===(u=(i=i||{})[f=r.unit]||0))continue;if(l=$(t,r),i[f]=l?-1:++u,l&&1===o.size)return!0;if(!l&&u===o.get(f).count)return!1}else if(c^(l=$(t,r)))return l;return p&&c}const O=e(R),j=O.left,L=O.right;function T(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],u=r?r[x]&&r[x].value:void 0,f=n===h,l=R(t),s=j(i,l);if(s===i.length)return!1;if(R(i[s])!==l)return!1;if(u&&f){if(1===u.size)return!0;if(L(i,l)-s<u.size)return!1}return!0}function k(e,t){return e.map((e=>i(t.fields?{values:t.fields.map((t=>g(t)(e.datum)))}:{[_]:R(e.datum)},t)))}function z(e,t,n,r){for(var i,f,l,s,a,o,c,p,d,v,g,h,x=this.context.data[e],$=x?x.values.value:[],b={},O={},j={},L=$.length,T=0;T<L;++T)if(s=(i=$[T]).unit,f=i.fields,l=i.values,f&&l){for(g=0,h=f.length;g<h;++g)a=f[g],p=(c=b[a.field]||(b[a.field]={}))[s]||(c[s]=[]),j[a.field]=d=a.type.charAt(0),v=D[`${d}_union`],c[s]=v(p,u(l[g]));n&&(p=O[s]||(O[s]=[])).push(u(l).reduce(((e,t,n)=>(e[f[n].field]=t,e)),{}))}else a=_,o=R(i),(p=(c=b[a]||(b[a]={}))[s]||(c[s]=[])).push(o),n&&(p=O[s]||(O[s]=[])).push({[_]:o});if(t=t||m,b[_]?b[_]=D[`${_}_${t}`](...Object.values(b[_])):Object.keys(b).forEach((e=>{b[e]=Object.keys(b[e]).map((t=>b[e][t])).reduce(((n,r)=>void 0===n?r:D[`${j[e]}_${t}`](n,r)))})),$=Object.keys(O),n&&$.length){b[r?"vlPoint":"vlMulti"]=t===m?{[y]:$.reduce(((e,t)=>(e.push(...O[t]),e)),[])}:{[E]:$.map((e=>({[y]:O[e]})))}}return b}var D={[`${_}_union`]:t,[`${_}_intersect`]:n,E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.includes(t[n])||e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.includes(e))):t},R_union:function(e,t){var n=f(t[0]),r=f(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=f(t[0]),r=f(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};function N(e,t,n,r){t[0].type!==d&&l("First argument to selection functions must be a string literal.");const i=t[0].value,u="unit",f="@"+u,o=":"+i;(t.length>=2&&s(t).value)!==h||a(r,f)||(r[f]=n.getData(i).indataRef(n,u)),a(r,o)||(r[o]=n.getData(i).tuplesRef())}export{T as selectionIdTest,z as selectionResolve,b as selectionTest,k as selectionTuples,N as selectionVisitor};export default null;
//# sourceMappingURL=/sm/6b197a97fc047a161fb7252b07b77206b0fbac8fc665163d9c1d76988089d27d.map