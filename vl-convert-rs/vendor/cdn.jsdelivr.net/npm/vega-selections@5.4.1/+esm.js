/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/vega-selections@5.4.1/build/vega-selection.module.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{bisector as e,union as t,intersection as n}from"/npm/d3-array@3.2.2/+esm";import{field as r,extend as i,array as u,toNumber as f,error as l,peek as a,hasOwnProperty as s,isDate as o,isArray as c,inrange as d}from"/npm/vega-util@1.17.1/+esm";import{Literal as v}from"/npm/vega-expression@5.0.1/+esm";const p="intersect",g="union",h="or",m="and",y="_vgsid_",_=r(y),x="index:unit";function R(e,t){for(var n,i,u=t.fields,l=t.values,a=u.length,s=0;s<a;++s)if((i=u[s]).getter=r.getter||r(i.field),n=i.getter(e),o(n)&&(n=f(n)),o(l[s])&&(l[s]=f(l[s])),o(l[s][0])&&(l[s]=l[s].map(f)),"E"===i.type){if(c(l[s])?l[s].indexOf(n)<0:n!==l[s])return!1}else if("R"===i.type){if(!d(n,l[s]))return!1}else if("R-RE"===i.type){if(!d(n,l[s],!0,!1))return!1}else if("R-E"===i.type){if(!d(n,l[s],!1,!1))return!1}else if("R-LE"===i.type&&!d(n,l[s],!1,!0))return!1;return!0}function E(e,t,n){for(var r,i,u,f,l,a=this.context.data[e],s=a?a.values.value:[],o=a?a[x]&&a[x].value:void 0,c=n===p,d=s.length,v=0;v<d;++v)if(r=s[v],o&&c){if(-1===(u=(i=i||{})[f=r.unit]||0))continue;if(l=R(t,r),i[f]=l?-1:++u,l&&1===o.size)return!0;if(!l&&u===o.get(f).count)return!1}else if(c^(l=R(t,r)))return l;return d&&c}const O=e(_),$=O.left,b=O.right;function j(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],u=r?r[x]&&r[x].value:void 0,f=n===p,l=_(t),a=$(i,l);if(a===i.length)return!1;if(_(i[a])!==l)return!1;if(u&&f){if(1===u.size)return!0;if(b(i,l)-a<u.size)return!1}return!0}function k(e,t){return e.map((e=>i(t.fields?{values:t.fields.map((t=>(t.getter||(t.getter=r(t.field)))(e.datum)))}:{[y]:_(e.datum)},t)))}function z(e,t,n,r){for(var i,f,l,a,s,o,c,d,v,p,x,R,E=this.context.data[e],O=E?E.values.value:[],$={},b={},j={},k=O.length,z=0;z<k;++z)if(a=(i=O[z]).unit,f=i.fields,l=i.values,f&&l){for(x=0,R=f.length;x<R;++x)s=f[x],d=(c=$[s.field]||($[s.field]={}))[a]||(c[a]=[]),j[s.field]=v=s.type.charAt(0),p=D[`${v}_union`],c[a]=p(d,u(l[x]));n&&(d=b[a]||(b[a]=[])).push(u(l).reduce(((e,t,n)=>(e[f[n].field]=t,e)),{}))}else s=y,o=_(i),(d=(c=$[s]||($[s]={}))[a]||(c[a]=[])).push(o),n&&(d=b[a]||(b[a]=[])).push({[y]:o});if(t=t||g,$[y]?$[y]=D[`${y}_${t}`](...Object.values($[y])):Object.keys($).forEach((e=>{$[e]=Object.keys($[e]).map((t=>$[e][t])).reduce(((n,r)=>void 0===n?r:D[`${j[e]}_${t}`](n,r)))})),O=Object.keys(b),n&&O.length){$[r?"vlPoint":"vlMulti"]=t===g?{[h]:O.reduce(((e,t)=>(e.push(...b[t]),e)),[])}:{[m]:O.map((e=>({[h]:b[e]})))}}return $}var D={[`${y}_union`]:t,[`${y}_intersect`]:n,E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.indexOf(e)>=0)):t},R_union:function(e,t){var n=f(t[0]),r=f(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=f(t[0]),r=f(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};function A(e,t,n,r){t[0].type!==v&&l("First argument to selection functions must be a string literal.");const i=t[0].value,u="unit",f="@"+u,o=":"+i;(t.length>=2&&a(t).value)!==p||s(r,f)||(r[f]=n.getData(i).indataRef(n,u)),s(r,o)||(r[o]=n.getData(i).tuplesRef())}export{j as selectionIdTest,z as selectionResolve,E as selectionTest,k as selectionTuples,A as selectionVisitor};export default null;
//# sourceMappingURL=/sm/b9a86f9002856c310bd671902927d300db88d4b750895c42b1d7e8a6944f0e2a.map