/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/vega-parser@7.1.0/build/vega-parser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{stringValue as e,error as t,peek as n,isString as i,array as a,hasOwnProperty as l,isObject as o,extend as s,isArray as r,mergeConfig as u,splitAccessPath as c}from"/npm/vega-util@2.1.0/+esm";import{parseExpression as d}from"/npm/vega-functions@6.1.0/+esm";import{parseSelector as f}from"/npm/vega-event-selector@4.0.0/+esm";import{isValidScaleType as p,isDiscrete as g,isQuantile as m,isContinuous as h,isDiscretizing as y}from"/npm/vega-scale@8.1.0/+esm";import{definition as b}from"/npm/vega-dataflow@6.1.0/+esm";function x(e){return o(e)?e:{type:e||"pad"}}const k=e=>+e||0;function v(e){return o(e)?e.signal?e:{top:k(e.top),bottom:k(e.bottom),left:k(e.left),right:k(e.right)}:{top:t=k(e),bottom:t,left:t,right:t};var t}const $=e=>o(e)&&!r(e)?s({},e):{value:e};function S(e,t,n,i){if(null!=n){return o(n)&&!r(n)||r(n)&&n.length&&o(n[0])?e.update[t]=n:e[i||"enter"][t]={value:n},1}return 0}function R(e,t,n){for(const n in t)S(e,n,t[n]);for(const t in n)S(e,t,n[t],"update")}function O(e,t,n){for(const i in t)n&&l(n,i)||(e[i]=s(e[i]||{},t[i]));return e}function z(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const w="mark",W="frame",j="scope",_="axis",C="axis-domain",D="axis-grid",E="axis-label",F="axis-tick",L="axis-title",P="legend",T="legend-entry",B="legend-label",U="legend-symbol",A="legend-title",H="title-text",M="title-subtitle";function V(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const q=t=>i(t)?e(t):t.signal?`(${t.signal})`:N(t);function I(t){if(null!=t.gradient)return function(t){const i=[t.start,t.stop,t.count].map((t=>null==t?null:e(t)));for(;i.length&&null==n(i);)i.pop();return i.unshift(q(t.gradient)),`gradient(${i.join(",")})`}(t);let i=t.signal?`(${t.signal})`:t.color?function(e){return e.c?X("hcl",e.h,e.c,e.l):e.h||e.s?X("hsl",e.h,e.s,e.l):e.l||e.a?X("lab",e.l,e.a,e.b):e.r||e.g||e.b?X("rgb",e.r,e.g,e.b):null}(t.color):null!=t.field?N(t.field):void 0!==t.value?e(t.value):void 0;return null!=t.scale&&(i=function(e,t){const n=q(e.scale);null!=e.range?t=`lerp(_range(${n}), ${+e.range})`:(void 0!==t&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(1==+e.band?"":"*"+Y(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),null==t&&(t="0"));return t}(t,i)),void 0===i&&(i=null),null!=t.exponent&&(i=`pow(${i},${Y(t.exponent)})`),null!=t.mult&&(i+=`*${Y(t.mult)}`),null!=t.offset&&(i+=`+${Y(t.offset)}`),t.round&&(i=`round(${i})`),i}const X=(e,t,n,i)=>`(${e}(${[t,n,i].map(I).join(",")})+'')`;function Y(e){return o(e)?"("+I(e)+")":e}function N(e){return G(o(e)?e:{datum:e})}function G(n){let a,l,o;if(n.signal)a="datum",o=n.signal;else if(n.group||n.parent){for(l=Math.max(1,n.level||1),a="item";l-- >0;)a+=".mark.group";n.parent?(o=n.parent,a+=".datum"):o=n.group}else n.datum?(a="datum",o=n.datum):t("Invalid field reference: "+e(n));return n.signal||(o=i(o)?c(o).map(e).join("]["):G(o)),a+"["+o+"]"}function J(e,t,n,i,l,o){const r={};(o=o||{}).encoders={$encode:r},e=function(e,t,n,i,l){const o={},r={};let u,c,d,f;for(c in c="lineBreak","text"!==t||null==l[c]||z(c,e)||V(o,c,l[c]),("legend"==n||String(n).startsWith("axis"))&&(n=null),f=n===W?l.group:n===w?s({},l.mark,l[t]):null,f)d=z(c,e)||("fill"===c||"stroke"===c)&&(z("fill",e)||z("stroke",e)),d||V(o,c,f[c]);for(c in a(i).forEach((t=>{const n=l.style&&l.style[t];for(const t in n)z(t,e)||V(o,t,n[t])})),e=s({},e),o)f=o[c],f.signal?(u=u||{})[c]=f:r[c]=f;return e.enter=s(r,e.enter),u&&(e.update=s(u,e.update)),e}(e,t,n,i,l.config);for(const n in e)r[n]=K(e[n],t,o,l);return o}function K(e,t,i,a){const l={},o={};for(const t in e)null!=e[t]&&(l[t]=Q((s=e[t],r(s)?function(e){let t="";return e.forEach((e=>{const n=I(e);t+=e.test?`(${e.test})?${n}:`:n})),":"===n(t)&&(t+="null"),t}(s):I(s)),a,i,o));var s;return{$expr:{marktype:t,channels:l},$fields:Object.keys(o),$output:Object.keys(e)}}function Q(e,t,n,i){const a=d(e,t);return a.$fields.forEach((e=>i[e]=1)),s(n,a.$params),a.$expr}const Z=["value","update","init","react","bind"];function ee(n,i){t(n+' for "outer" push: '+e(i))}function te(e,t){const n=e.name;if("outer"===e.push)t.signals[n]||ee("No prior signal definition",n),Z.forEach((t=>{void 0!==e[t]&&ee("Invalid property ",t)}));else{const i=t.addSignal(n,e.value);!1===e.react&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function ne(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function ie(e,t,n,i){return new ne(e,t,n,i)}function ae(e,t){return ie("operator",e,t)}function le(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function oe(e,t){return t?{$field:e,$name:t}:{$field:e}}const se=oe("key");function re(e,t){return{$compare:e,$order:t}}function ue(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const ce="scope",de="view";function fe(e){return e&&e.signal}function pe(e){if(fe(e))return!0;if(o(e))for(const t in e)if(pe(e[t]))return!0;return!1}function ge(e,t){return null!=e?e:t}function me(e){return e&&e.signal||e}const he="timer";function ye(n,i){return(n.merge?be:n.stream?xe:n.type?ke:t("Invalid stream specification: "+e(n)))(n,i)}function be(e,t){const n=ve({merge:e.merge.map((e=>ye(e,t)))},e,t);return t.addStream(n).id}function xe(e,t){const n=ve({stream:ye(e.stream,t)},e,t);return t.addStream(n).id}function ke(e,t){let n;var i;e.type===he?(n=t.event(he,e.throttle),e={between:e.between,filter:e.filter}):n=t.event((i=e.source)===ce?de:i||de,e.type);const a=ve({stream:n},e,t);return 1===Object.keys(a).length?n:t.addStream(a).id}function ve(n,i,a){let l=i.between;return l&&(2!==l.length&&t('Stream "between" parameter must have 2 entries: '+e(i)),n.between=[ye(l[0],a),ye(l[1],a)]),l=i.filter?[].concat(i.filter):[],(i.marktype||i.markname||i.markrole)&&l.push(function(e,t,n){const i="event.item";return i+(e&&"*"!==e?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}(i.marktype,i.markname,i.markrole)),i.source===ce&&l.push("inScope(event.item)"),l.length&&(n.filter=d("("+l.join(")&&(")+")",a).$expr),null!=(l=i.throttle)&&(n.throttle=+l),null!=(l=i.debounce)&&(n.debounce=+l),i.consume&&(n.consume=!0),n}const $e={code:"_.$value",ast:{type:"Identifier",value:"value"}};function Se(n,l,o){const r=n.encode,u={target:o};let c=n.events,p=n.update,g=[];c||t("Signal update missing events specification."),i(c)&&(c=f(c,l.isSubscope()?ce:de)),c=a(c).filter((e=>e.signal||e.scale?(g.push(e),0):1)),g.length>1&&(g=[Re(g)]),c.length&&g.push(c.length>1?{merge:c}:c[0]),null!=r&&(p&&t("Signal encode and update are mutually exclusive."),p="encode(item(),"+e(r)+")"),u.update=i(p)?d(p,l):null!=p.expr?d(p.expr,l):null!=p.value?p.value:null!=p.signal?{$expr:$e,$params:{$value:l.signalRef(p.signal)}}:t("Invalid signal update specification."),n.force&&(u.options={force:!0}),g.forEach((e=>l.addUpdate(s(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):ye(e,t)}}(e,l),u))))}function Re(e){return{signal:"["+e.map((e=>e.scale?'scale("'+e.scale+'")':e.signal))+"]"}}function Oe(e,n){const i=n.getSignal(e.name);let a=e.update;e.init&&(a?t("Signals can not include both init and update expressions."):(a=e.init,i.initonly=!0)),a&&(a=d(a,n),i.update=a.$expr,i.params=a.$params),e.on&&e.on.forEach((e=>Se(e,n,i.id)))}const ze=e=>(t,n,i)=>ie(e,n,t||void 0,i),we=ze("aggregate"),We=ze("axisticks"),je=ze("bound"),_e=ze("collect"),Ce=ze("compare"),De=ze("datajoin"),Ee=ze("encode"),Fe=ze("expression"),Le=ze("facet"),Pe=ze("field"),Te=ze("key"),Be=ze("legendentries"),Ue=ze("load"),Ae=ze("mark"),He=ze("multiextent"),Me=ze("multivalues"),Ve=ze("overlap"),qe=ze("params"),Ie=ze("prefacet"),Xe=ze("projection"),Ye=ze("proxy"),Ne=ze("relay"),Ge=ze("render"),Je=ze("scale"),Ke=ze("sieve"),Qe=ze("sortitems"),Ze=ze("viewlayout"),et=ze("values");let tt=0;const nt={min:"min",max:"max",count:"sum"};function it(e,t){const n=t.getScale(e.name).params;let i;for(i in n.domain=st(e.domain,e,t),null!=e.range&&(n.range=mt(e,t,n)),null!=e.interpolate&&function(e,t){t.interpolate=at(e.type||e),null!=e.gamma&&(t.interpolateGamma=at(e.gamma))}(e.interpolate,n),null!=e.nice&&(n.nice=function(e,t){return e.signal?t.signalRef(e.signal):o(e)?{interval:at(e.interval),step:at(e.step)}:at(e)}(e.nice,t)),null!=e.bins&&(n.bins=function(e,t){return e.signal||r(e)?lt(e,t):t.objectProperty(e)}(e.bins,t)),e)l(n,i)||"name"===i||(n[i]=at(e[i],t))}function at(n,i){return o(n)?n.signal?i.signalRef(n.signal):t("Unsupported object: "+e(n)):n}function lt(e,t){return e.signal?t.signalRef(e.signal):e.map((e=>at(e,t)))}function ot(n){t("Can not find data set: "+e(n))}function st(e,n,i){if(e)return e.signal?i.signalRef(e.signal):(r(e)?rt:e.fields?ct:ut)(e,n,i);null==n.domainMin&&null==n.domainMax||t("No scale domain defined for domainMin/domainMax to override.")}function rt(e,t,n){return e.map((e=>at(e,n)))}function ut(e,t,n){const i=n.getData(e.data);return i||ot(e.data),g(t.type)?i.valuesRef(n,e.field,ft(e.sort,!1)):m(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function ct(t,n,a){const l=t.data,o=t.fields.reduce(((t,n)=>(n=i(n)?{data:l,field:n}:r(n)||n.signal?function(t,n){const i="_:vega:_"+tt++,a=_e({});if(r(t))a.value={$ingest:t};else if(t.signal){const l="setdata("+e(i)+","+t.signal+")";a.params.input=n.signalRef(l)}return n.addDataPipeline(i,[a,Ke({})]),{data:i,field:"data"}}(n,a):n,t.push(n),t)),[]);return(g(n.type)?dt:m(n.type)?pt:gt)(t,a,o)}function dt(e,t,n){const i=ft(e.sort,!0);let a,l;const o=n.map((e=>{const n=t.getData(e.data);return n||ot(e.data),n.countsRef(t,e.field,i)})),s={groupby:se,pulse:o};i&&(a=i.op||"count",l=i.field?ue(a,i.field):"count",s.ops=[nt[a]],s.fields=[t.fieldRef(l)],s.as=[l]),a=t.add(we(s));const r=t.add(_e({pulse:le(a)}));return l=t.add(et({field:se,sort:t.sortRef(i),pulse:le(r)})),le(l)}function ft(e,n){return e&&(e.field||e.op?e.field||"count"===e.op?n&&e.field&&e.op&&!nt[e.op]&&t("Multiple domain scales can not be sorted using "+e.op):t("No field provided for sort aggregate op: "+e.op):o(e)?e.field="key":e={field:"key"}),e}function pt(e,t,n){const i=n.map((e=>{const n=t.getData(e.data);return n||ot(e.data),n.domainRef(t,e.field)}));return le(t.add(Me({values:i})))}function gt(e,t,n){const i=n.map((e=>{const n=t.getData(e.data);return n||ot(e.data),n.extentRef(t,e.field)}));return le(t.add(He({extents:i})))}function mt(n,a,o){const u=a.config.range;let c=n.range;if(c.signal)return a.signalRef(c.signal);if(i(c)){if(u&&l(u,c))return mt(n=s({},n,{range:u[c]}),a,o);"width"===c?c=[0,{signal:"width"}]:"height"===c?c=g(n.type)?[0,{signal:"height"}]:[{signal:"height"},0]:t("Unrecognized scale range value: "+e(c))}else{if(c.scheme)return o.scheme=r(c.scheme)?lt(c.scheme,a):at(c.scheme,a),c.extent&&(o.schemeExtent=lt(c.extent,a)),void(c.count&&(o.schemeCount=at(c.count,a)));if(c.step)return void(o.rangeStep=at(c.step,a));if(g(n.type)&&!r(c))return st(c,n,a);r(c)||t("Unsupported range type: "+e(c))}return c.map((e=>(r(e)?lt:at)(e,a)))}function ht(n,i,a){return r(n)?n.map((e=>ht(e,i,a))):o(n)?n.signal?a.signalRef(n.signal):"fit"===i?n:t("Unsupported parameter object: "+e(n)):n}const yt="top",bt="left",xt="right",kt="bottom",vt="center",$t="index",St="label",Rt="perc",Ot="value",zt="guide-label",wt="guide-title",Wt="group-title",jt="group-subtitle",_t="symbol",Ct="gradient",Dt="discrete",Et="size",Ft=[Et,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],Lt={name:1,style:1,interactive:1},Pt={value:0},Tt={value:1},Bt="group",Ut="rect",At="rule",Ht="text";function Mt(e){return e.type=Bt,e.interactive=e.interactive||!1,e}function Vt(e,t){const n=(n,i)=>ge(e[n],ge(t[n],i));return n.isVertical=n=>"vertical"===ge(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>ge(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>ge(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>ge(e.columns,ge(t.columns,+n.isVertical(!0))),n}function qt(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function It(e,t,n){return`item.anchor === 'start' ? ${e} : item.anchor === 'end' ? ${t} : ${n}`}const Xt=It(e(bt),e(xt),e(vt));function Yt(e,t){return t?e?o(e)?Object.assign({},e,{offset:Yt(e.offset,t)}):{value:e,offset:t}:t:e}function Nt(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=O(e.encode,t,Lt)):e.interactive=!1,e}function Gt(e,t,n,i){const a=Vt(e,n),l=a.isVertical(),o=a.gradientThickness(),r=a.gradientLength();let u,c,d,f,p;l?(c=[0,1],d=[0,0],f=o,p=r):(c=[0,0],d=[1,0],f=r,p=o);const g={enter:u={opacity:Pt,x:Pt,y:Pt,width:$(f),height:$(p)},update:s({},u,{opacity:Tt,fill:{gradient:t,start:c,stop:d}}),exit:{opacity:Pt}};return R(g,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),Nt({type:Ut,role:"legend-gradient",encode:g},i)}function Jt(e,t,n,i,a){const l=Vt(e,n),o=l.isVertical(),r=l.gradientThickness(),u=l.gradientLength();let c,d,f,p,g="";o?(c="y",f="y2",d="x",p="width",g="1-"):(c="x",f="x2",d="y",p="height");const m={opacity:Pt,fill:{scale:t,field:Ot}};m[c]={signal:g+"datum."+Rt,mult:u},m[d]=Pt,m[f]={signal:g+"datum.perc2",mult:u},m[p]=$(r);const h={enter:m,update:s({},m,{opacity:Tt}),exit:{opacity:Pt}};return R(h,{stroke:l("gradientStrokeColor"),strokeWidth:l("gradientStrokeWidth")},{opacity:l("gradientOpacity")}),Nt({type:Ut,role:"legend-band",key:Ot,from:a,encode:h},i)}const Kt=`datum.${Rt}<=0?"${bt}":datum.${Rt}>=1?"${xt}":"${vt}"`,Qt=`datum.${Rt}<=0?"${kt}":datum.${Rt}>=1?"${yt}":"middle"`;function Zt(e,t,n,i){const a=Vt(e,t),l=a.isVertical(),o=$(a.gradientThickness()),s=a.gradientLength();let r,u,c,d,f=a("labelOverlap"),p="";const g={enter:r={opacity:Pt},update:u={opacity:Tt,text:{field:St}},exit:{opacity:Pt}};return R(g,{fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:ge(e.labelLimit,t.gradientLabelLimit)}),l?(r.align={value:"left"},r.baseline=u.baseline={signal:Qt},c="y",d="x",p="1-"):(r.align=u.align={signal:Kt},r.baseline={value:"top"},c="x",d="y"),r[c]=u[c]={signal:p+"datum."+Rt,mult:s},r[d]=u[d]=o,o.offset=ge(e.labelOffset,t.gradientLabelOffset)||0,f=f?{separation:a("labelSeparation"),method:f,order:"datum."+$t}:void 0,Nt({type:Ht,role:B,style:zt,key:Ot,from:i,encode:g,overlap:f},n)}function en(e,t,n,i,a){const l=Vt(e,t),o=n.entries,s=!(!o||!o.interactive),r=o?o.name:void 0,u=l("clipHeight"),c=l("symbolOffset"),d={data:"value"},f=`(${a}) ? datum.offset : datum.${Et}`,p=u?$(u):{field:Et},g=`datum.${$t}`,m=`max(1, ${a})`;let h,y,b,x,k;p.mult=.5,h={enter:y={opacity:Pt,x:{signal:f,mult:.5,offset:c},y:p},update:b={opacity:Tt,x:y.x,y:y.y},exit:{opacity:Pt}};let v=null,S=null;e.fill||(v=t.symbolBaseFillColor,S=t.symbolBaseStrokeColor),R(h,{fill:l("symbolFillColor",v),shape:l("symbolType"),size:l("symbolSize"),stroke:l("symbolStrokeColor",S),strokeDash:l("symbolDash"),strokeDashOffset:l("symbolDashOffset"),strokeWidth:l("symbolStrokeWidth")},{opacity:l("symbolOpacity")}),Ft.forEach((t=>{e[t]&&(b[t]=y[t]={scale:e[t],field:Ot})}));const z=Nt({type:"symbol",role:U,key:Ot,from:d,clip:!!u||void 0,encode:h},n.symbols),w=$(c);w.offset=l("labelOffset"),h={enter:y={opacity:Pt,x:{signal:f,offset:w},y:p},update:b={opacity:Tt,text:{field:St},x:y.x,y:y.y},exit:{opacity:Pt}},R(h,{align:l("labelAlign"),baseline:l("labelBaseline"),fill:l("labelColor"),fillOpacity:l("labelOpacity"),font:l("labelFont"),fontSize:l("labelFontSize"),fontStyle:l("labelFontStyle"),fontWeight:l("labelFontWeight"),limit:l("labelLimit")});const W=Nt({type:Ht,role:B,style:zt,key:Ot,from:d,encode:h},n.labels);return h={enter:{noBound:{value:!u},width:Pt,height:u?$(u):Pt,opacity:Pt},exit:{opacity:Pt},update:b={opacity:Tt,row:{signal:null},column:{signal:null}}},l.isVertical(!0)?(x=`ceil(item.mark.items.length / ${m})`,b.row.signal=`${g}%${x}`,b.column.signal=`floor(${g} / ${x})`,k={field:["row",g]}):(b.row.signal=`floor(${g} / ${m})`,b.column.signal=`${g} % ${m}`,k={field:g}),b.column.signal=`(${a})?${b.column.signal}:${g}`,Mt({role:j,from:i={facet:{data:i,name:"value",groupby:$t}},encode:O(h,o,Lt),marks:[z,W],name:r,interactive:s,sort:k})}const tn='item.orient === "left"',nn='item.orient === "right"',an=`(${tn} || ${nn})`,ln=`datum.vgrad && ${an}`,on=It('"top"','"bottom"','"middle"'),sn=`datum.vgrad && ${nn} ? (${It('"right"','"left"','"center"')}) : (${an} && !(datum.vgrad && ${tn})) ? "left" : ${Xt}`,rn=`item._anchor || (${an} ? "middle" : "start")`,un=`${ln} ? (${tn} ? -90 : 90) : 0`,cn=`${an} ? (datum.vgrad ? (${nn} ? "bottom" : "top") : ${on}) : "top"`;function dn(e,t){let n;return o(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+fn(e.path)+")":e.sphere&&(n="geoShape("+fn(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function fn(t){return o(t)&&t.signal?t.signal:e(t)}function pn(e){const t=e.role||"";return t.startsWith("axis")||t.startsWith("legend")||t.startsWith("title")?t:e.type===Bt?j:t||w}function gn(e){return{marktype:e.type,name:e.name||void 0,role:e.role||pn(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function mn(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function hn(n,i){const a=b(n.type);a||t("Unrecognized transform type: "+e(n.type));const l=ie(a.type.toLowerCase(),null,yn(a,n,i));return n.signal&&i.addSignal(n.signal,i.proxy(l)),l.metadata=a.metadata||{},l}function yn(e,t,n){const i={},a=e.params.length;for(let l=0;l<a;++l){const a=e.params[l];i[a.name]=bn(a,t,n)}return i}function bn(n,a,l){const o=n.type,s=a[n.name];return"index"===o?function(e,n,a){i(n.from)||t('Lookup "from" parameter must be a string literal.');return a.getData(n.from).lookupRef(a,n.key)}(0,a,l):void 0!==s?"param"===o?function(n,i,a){const l=i[n.name];return n.array?(r(l)||t("Expected an array of sub-parameters. Instead: "+e(l)),l.map((e=>kn(n,e,a)))):kn(n,l,a)}(n,a,l):"projection"===o?l.projectionRef(a[n.name]):n.array&&!fe(s)?s.map((e=>xn(n,e,l))):xn(n,s,l):void(n.required&&t("Missing required "+e(a.type)+" parameter: "+e(n.name)))}function xn(e,n,i){const a=e.type;if(fe(n))return Rn(a)?t("Expression references can not be signals."):On(a)?i.fieldRef(n):zn(a)?i.compareRef(n):i.signalRef(n.signal);{const t=e.expr||On(a);return t&&vn(n)?i.exprRef(n.expr,n.as):t&&$n(n)?oe(n.field,n.as):Rn(a)?d(n,i):Sn(a)?le(i.getData(n).values):On(a)?oe(n):zn(a)?i.compareRef(n):n}}function kn(n,i,a){const l=n.params.length;let o;for(let e=0;e<l;++e){o=n.params[e];for(const e in o.key)if(o.key[e]!==i[e]){o=null;break}if(o)break}o||t("Unsupported parameter: "+e(i));const r=s(yn(o,i,a),o.key);return le(a.add(qe(r)))}const vn=e=>e&&e.expr,$n=e=>e&&e.field,Sn=e=>"data"===e,Rn=e=>"expr"===e,On=e=>"field"===e,zn=e=>"compare"===e;function wn(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:le(t.getData(e.data).output)}function Wn(e,t,n,i,a){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=a,this.index={}}function jn(e){return i(e)?e:null}function _n(e,t,n){const i=ue(n.op,n.field);let a;if(t.ops){for(let e=0,n=t.as.length;e<n;++e)if(t.as[e]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((a=n.op.signal)?e.signalRef(a):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function Cn(e,t,n,i,a,l,s){const r=t[n]||(t[n]={}),u=function(e){return o(e)?("descending"===e.order?"-":"+")+ue(e.op,e.field):""}(l);let c,d,f=jn(a);if(null!=f&&(e=t.scope,f+=u?"|"+u:"",c=r[f]),!c){const n=l?{field:se,pulse:t.countsRef(e,a,l)}:{field:e.fieldRef(a),pulse:le(t.output)};u&&(n.sort=e.sortRef(l)),d=e.add(ie(i,void 0,n)),s&&(t.index[a]=d),c=le(d),null!=f&&(r[f]=c)}return c}function Dn(e,t,n){const i=e.remove,a=e.insert,l=e.toggle,o=e.modify,s=e.values,r=t.add(ae()),u="if("+e.trigger+',modify("'+n+'",'+[a,i,l,o,s].map((e=>null==e?"null":e)).join(",")+"),0)",c=d(u,t);r.update=c.$expr,r.params=c.$params}function En(n,i){const l=pn(n),o=n.type===Bt,r=n.from&&n.from.facet,u=n.overlap;let c,d,f,p,g,m,h,y=n.layout||l===j||l===W;const b=l===w||y||r,x=function(e,n,i){let l,o,r,u,c;return e?(l=e.facet)&&(n||t("Only group marks can be faceted."),null!=l.field?u=c=wn(l,i):(e.data?c=le(i.getData(e.data).aggregate):(r=hn(s({type:"aggregate",groupby:a(l.groupby)},l.aggregate),i),r.params.key=i.keyRef(l.groupby),r.params.pulse=wn(l,i),u=c=le(i.add(r))),o=i.keyRef(l.groupby,!0))):u=le(i.add(_e(null,[{}]))),u||(u=wn(e,i)),{key:o,pulse:u,parent:c}}(n.from,o,i);d=i.add(De({key:x.key||(n.key?oe(n.key):void 0),pulse:x.pulse,clean:!o}));const k=le(d);d=f=i.add(_e({pulse:k})),d=i.add(Ae({markdef:gn(n),interactive:mn(n.interactive,i),clip:dn(n.clip,i),context:{$context:!0},groups:i.lookup(),parent:i.signals.parent?i.signalRef("parent"):null,index:i.markpath(),pulse:le(d)}));const v=le(d);d=p=i.add(Ee(J(n.encode,n.type,l,n.style,i,{mod:!1,pulse:v}))),d.params.parent=i.encode(),n.transform&&n.transform.forEach((e=>{const n=hn(e,i),a=n.metadata;(a.generates||a.changes)&&t("Mark transforms should not generate new data."),a.nomod||(p.params.mod=!0),n.params.pulse=le(d),i.add(d=n)})),n.sort&&(d=i.add(Qe({sort:i.compareRef(n.sort),pulse:le(d)})));const $=le(d);(r||y)&&(y=i.add(Ze({layout:i.objectProperty(n.layout),legends:i.legends,mark:v,pulse:$})),m=le(y));const S=i.add(je({mark:v,pulse:m||$}));h=le(S),o&&(b&&(c=i.operators,c.pop(),y&&c.pop()),i.pushState($,m||h,k),r?function(n,i,a){const l=n.from.facet,o=l.name,s=wn(l,i);let r;l.name||t("Facet must have a name: "+e(l)),l.data||t("Facet must reference a data set: "+e(l)),l.field?r=i.add(Ie({field:i.fieldRef(l.field),pulse:s})):l.groupby?r=i.add(Le({key:i.keyRef(l.groupby),group:le(i.proxy(a.parent)),pulse:s})):t("Facet must specify groupby or field: "+e(l));const u=i.fork(),c=u.add(_e()),d=u.add(Ke({pulse:le(c)}));u.addData(o,new Wn(u,c,c,d)),u.addSignal("parent",null),r.params.subflow={$subflow:u.parse(n).toRuntime()}}(n,i,x):b?function(e,t,n){const i=t.add(Ie({pulse:n.pulse})),a=t.fork();a.add(Ke()),a.addSignal("parent",null),i.params.subflow={$subflow:a.parse(e).toRuntime()}}(n,i,x):i.parse(n),i.popState(),b&&(y&&c.push(y),c.push(S))),u&&(h=function(e,t,n){const i=e.method,a=e.bound,l=e.separation,o={separation:fe(l)?n.signalRef(l.signal):l,method:fe(i)?n.signalRef(i.signal):i,pulse:t};e.order&&(o.sort=n.compareRef({field:e.order}));if(a){const e=a.tolerance;o.boundTolerance=fe(e)?n.signalRef(e.signal):+e,o.boundScale=n.scaleRef(a.scale),o.boundOrient=a.orient}return le(n.add(Ve(o)))}(u,h,i));const R=i.add(Ge({pulse:h})),O=i.add(Ke({pulse:le(R)},void 0,i.parent()));null!=n.name&&(g=n.name,i.addData(g,new Wn(i,f,R,O)),n.on&&n.on.forEach((e=>{(e.insert||e.remove||e.toggle)&&t("Marks only support modify triggers."),Dn(e,i,g)})))}function Fn(e,n){const i=n.config.legend,a=e.encode||{},l=Vt(e,i),o=a.legend||{},s=o.name||void 0,r=o.interactive,u=o.style,c={};let f,p,g,m=0;Ft.forEach((t=>e[t]?(c[t]=e[t],m=m||e[t]):0)),m||t("Missing valid scale for legend.");const b=function(e,t){let n=e.type||_t;e.type||1!==function(e){return Ft.reduce(((t,n)=>t+(e[n]?1:0)),0)}(e)||!e.fill&&!e.stroke||(n=h(t)?Ct:y(t)?Dt:_t);return n!==Ct?n:y(t)?Dt:Ct}(e,n.scaleType(m)),x={title:null!=e.title,scales:c,type:b,vgrad:"symbol"!==b&&l.isVertical()},k=le(n.add(_e(null,[x]))),v=le(n.add(Be(p={type:b,scale:n.scaleRef(m),count:n.objectProperty(l("tickCount")),limit:n.property(l("symbolLimit")),values:n.objectProperty(e.values),minstep:n.property(e.tickMinStep),formatType:n.property(e.formatType),formatSpecifier:n.property(e.format)})));return b===Ct?(g=[Gt(e,m,i,a.gradient),Zt(e,i,a.labels,v)],p.count=p.count||n.signalRef(`max(2,2*floor((${me(l.gradientLength())})/100))`)):b===Dt?g=[Jt(e,m,i,a.gradient,v),Zt(e,i,a.labels,v)]:(f=function(e,t){const n=Vt(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,i),g=[en(e,i,a,v,me(f.columns))],p.size=function(e,t,n){const i=me(Pn("size",e,n)),a=me(Pn("strokeWidth",e,n)),l=me(function(e,t,n){return qt("fontSize",e)||function(e,t,n){const i=t.config.style[n];return i&&i[e]}("fontSize",t,n)}(n[1].encode,t,zt));return d(`max(ceil(sqrt(${i})+${a}),${l})`,t)}(e,n,g[0].marks)),g=[Mt({role:T,from:k,encode:{enter:{x:{value:0},y:{value:0}}},marks:g,layout:f,interactive:r})],x.title&&g.push(function(e,t,n,i){const a=Vt(e,t),l={enter:{opacity:Pt},update:{opacity:Tt,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:Pt}};return R(l,{orient:a("titleOrient"),_anchor:a("titleAnchor"),anchor:{signal:rn},angle:{signal:un},align:{signal:sn},baseline:{signal:cn},text:e.title,fill:a("titleColor"),fillOpacity:a("titleOpacity"),font:a("titleFont"),fontSize:a("titleFontSize"),fontStyle:a("titleFontStyle"),fontWeight:a("titleFontWeight"),limit:a("titleLimit"),lineHeight:a("titleLineHeight")},{align:a("titleAlign"),baseline:a("titleBaseline")}),Nt({type:Ht,role:A,style:wt,from:i,encode:l},n)}(e,i,a.title,k)),En(Mt({role:P,from:k,encode:O(Ln(l,e,i),o,Lt),marks:g,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:s,interactive:r,style:u}),n)}function Ln(e,t,n){const i={enter:{},update:{}};return R(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function Pn(e,t,n){return t[e]?`scale("${t[e]}",datum)`:qt(e,n[0].encode)}Wn.fromEntries=function(e,t){const n=t.length,i=t[n-1],a=t[n-2];let l=t[0],o=null,s=1;for(l&&"load"===l.type&&(l=t[1]),e.add(t[0]);s<n;++s)t[s].params.pulse=le(t[s-1]),e.add(t[s]),"aggregate"===t[s].type&&(o=t[s]);return new Wn(e,l,a,i,o)},Wn.prototype={countsRef(e,t,n){const i=this,a=i.counts||(i.counts={}),l=jn(t);let o,s,r;return null!=l&&(e=i.scope,o=a[l]),o?n&&n.field&&_n(e,o.agg.params,n):(r={groupby:e.fieldRef(t,"key"),pulse:le(i.output)},n&&n.field&&_n(e,r,n),s=e.add(we(r)),o=e.add(_e({pulse:le(s)})),o={agg:s,ref:le(o)},null!=l&&(a[l]=o)),o.ref},tuplesRef(){return le(this.values)},extentRef(e,t){return Cn(e,this,"extent","extent",t,!1)},domainRef(e,t){return Cn(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return Cn(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return Cn(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return Cn(e,this,"indata","tupleindex",t,!0,!0)}};const Tn=`item.orient==="${bt}"?-90:item.orient==="${xt}"?90:0`;function Bn(e,t){const n=Vt(e=i(e)?{text:e}:e,t.config.title),a=e.encode||{},l=a.group||{},o=l.name||void 0,r=l.interactive,u=l.style,c=[],d=le(t.add(_e(null,[{}])));return c.push(function(e,t,n,i){const a={value:0},l=e.text,o={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return R(o,{text:l,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Nt({type:Ht,role:H,style:Wt,from:i,encode:o},n)}(e,n,function(e){const t=e.encode;return t&&t.title||s({name:e.name,interactive:e.interactive,style:e.style},t)}(e),d)),e.subtitle&&c.push(function(e,t,n,i){const a={value:0},l=e.subtitle,o={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return R(o,{text:l,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Nt({type:Ht,role:M,style:jt,from:i,encode:o},n)}(e,n,a.subtitle,d)),En(Mt({role:"title",from:d,encode:Un(n,l),marks:c,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:o,interactive:r,style:u}),t)}function Un(e,t){const n={enter:{},update:{}};return R(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:Xt},angle:{signal:Tn},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),O(n,t,Lt)}function An(e,t){const n=[];e.transform&&e.transform.forEach((e=>{n.push(hn(e,t))})),e.on&&e.on.forEach((n=>{Dn(n,t,e.name)})),t.addDataPipeline(e.name,function(e,t,n){const i=[];let l,o,s,r,u,c=null,d=!1,f=!1;e.values?fe(e.values)||pe(e.format)?(i.push(Mn(t,e)),i.push(c=Hn())):i.push(c=Hn({$ingest:e.values,$format:e.format})):e.url?pe(e.url)||pe(e.format)?(i.push(Mn(t,e)),i.push(c=Hn())):i.push(c=Hn({$request:e.url,$format:e.format})):e.source&&(c=l=a(e.source).map((e=>le(t.getData(e).output))),i.push(null));for(o=0,s=n.length;o<s;++o)r=n[o],u=r.metadata,c||u.source||i.push(c=Hn()),i.push(r),u.generates&&(f=!0),u.modifies&&!f&&(d=!0),u.source?c=r:u.changes&&(c=null);l&&(s=l.length-1,i[0]=Ne({derive:d,pulse:s?l:l[0]}),(d||s)&&i.splice(1,0,Hn()));c||i.push(Hn());return i.push(Ke({})),i}(e,t,n))}function Hn(e){const t=_e({},e);return t.metadata={source:!0},t}function Mn(e,t){return Ue({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const Vn=e=>e===kt||e===yt,qn=(e,t,n)=>fe(e)?Jn(e.signal,t,n):e===bt||e===yt?t:n,In=(e,t,n)=>fe(e)?Nn(e.signal,t,n):Vn(e)?t:n,Xn=(e,t,n)=>fe(e)?Gn(e.signal,t,n):Vn(e)?n:t,Yn=(e,t,n)=>fe(e)?Kn(e.signal,t,n):e===yt?{value:t}:{value:n},Nn=(e,t,n)=>Zn(`${e} === '${yt}' || ${e} === '${kt}'`,t,n),Gn=(e,t,n)=>Zn(`${e} !== '${yt}' && ${e} !== '${kt}'`,t,n),Jn=(e,t,n)=>ti(`${e} === '${bt}' || ${e} === '${yt}'`,t,n),Kn=(e,t,n)=>ti(`${e} === '${yt}'`,t,n),Qn=(e,t,n)=>ti(`${e} === '${xt}'`,t,n),Zn=(t,n,i)=>(n=null!=n?$(n):n,i=null!=i?$(i):i,ei(n)&&ei(i)?{signal:`${t} ? (${n=n?n.signal||e(n.value):null}) : (${i=i?i.signal||e(i.value):null})`}:[s({test:t},n)].concat(i||[])),ei=e=>null==e||1===Object.keys(e).length,ti=(e,t,n)=>({signal:`${e} ? (${ni(t)}) : (${ni(n)})`}),ni=t=>fe(t)?t.signal:null==t?null:e(t),ii=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function ai(e,t,n,i){let a;if(t&&l(t,e))return t[e];if(l(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":a="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":a=e[5].toLowerCase()+e.slice(6)}return i[wt][a]}if(e.startsWith("label")){switch(e){case"labelColor":a="fill";break;case"labelFont":case"labelFontSize":a=e[5].toLowerCase()+e.slice(6)}return i[zt][a]}return null}function li(e){const t={};for(const n of e)if(n)for(const e in n)t[e]=1;return Object.keys(t)}function oi(e,t){return{scale:e.scale,range:t}}function si(e,t,n,i,a){const l=Vt(e,t),r=e.orient,u=e.gridScale,c=qn(r,1,-1),d=function(e,t){if(1===t);else if(o(e)){let n=e=s({},e);for(;null!=n.mult;){if(!o(n.mult))return n.mult=fe(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n=n.mult=s({},n.mult)}n.mult=t}else e=fe(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);return e}(e.offset,c);let f,p,g;const m={enter:f={opacity:Pt},update:g={opacity:Tt},exit:p={opacity:Pt}};R(m,{stroke:l("gridColor"),strokeCap:l("gridCap"),strokeDash:l("gridDash"),strokeDashOffset:l("gridDashOffset"),strokeOpacity:l("gridOpacity"),strokeWidth:l("gridWidth")});const h={scale:e.scale,field:Ot,band:a.band,extra:a.extra,offset:a.offset,round:l("tickRound")},y=In(r,{signal:"height"},{signal:"width"}),b=u?{scale:u,range:0,mult:c,offset:d}:{value:0,offset:d},x=u?{scale:u,range:1,mult:c,offset:d}:s(y,{mult:c,offset:d});return f.x=g.x=In(r,h,b),f.y=g.y=Xn(r,h,b),f.x2=g.x2=Xn(r,x),f.y2=g.y2=In(r,x),p.x=In(r,h),p.y=Xn(r,h),Nt({type:At,role:D,key:Ot,from:i,encode:m},n)}function ri(e,t,n,i,a){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+a+")"}}function ui(e,t,n,i,a,l){const o=Vt(e,t),s=e.orient,r=e.scale,u=qn(s,-1,1),c=me(o("labelFlush")),d=me(o("labelFlushOffset")),f=o("labelAlign"),p=o("labelBaseline");let g,m=0===c||!!c;const h=$(a);h.mult=u,h.offset=$(o("labelPadding")||0),h.offset.mult=u;const y={scale:r,field:Ot,band:.5,offset:Yt(l.offset,o("labelOffset"))},b=In(s,m?ri(r,c,'"left"','"right"','"center"'):{value:"center"},((e,t,n)=>fe(e)?Qn(e.signal,t,n):e===xt?{value:t}:{value:n})(s,"left","right")),x=In(s,Yn(s,"bottom","top"),m?ri(r,c,'"top"','"bottom"','"middle"'):{value:"middle"}),k=ri(r,c,`-(${d})`,d,0);m=m&&d;const v={opacity:Pt,x:In(s,y,h),y:Xn(s,y,h)},S={enter:v,update:g={opacity:Tt,text:{field:St},x:v.x,y:v.y,align:b,baseline:x},exit:{opacity:Pt,x:v.x,y:v.y}};R(S,{dx:!f&&m?In(s,k):null,dy:!p&&m?Xn(s,k):null}),R(S,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:f,baseline:p});const O=o("labelBound");let z=o("labelOverlap");return z=z||O?{separation:o("labelSeparation"),method:z,order:"datum.index",bound:O?{scale:r,orient:s,tolerance:O}:null}:void 0,g.align!==b&&(g.align=ii(g.align,b)),g.baseline!==x&&(g.baseline=ii(g.baseline,x)),Nt({type:Ht,role:E,style:zt,key:Ot,from:i,encode:S,overlap:z},n)}function ci(e,t,n,i){const a=Vt(e,t),l=e.orient,o=qn(l,-1,1);let r,u;const c={enter:r={opacity:Pt,anchor:$(a("titleAnchor",null)),align:{signal:Xt}},update:u=s({},r,{opacity:Tt,text:$(e.title)}),exit:{opacity:Pt}},d={signal:`lerp(range("${e.scale}"), ${It(0,1,.5)})`};return u.x=In(l,d),u.y=Xn(l,d),r.angle=In(l,Pt,((e,t)=>0===t?0:fe(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t})(o,90)),r.baseline=In(l,Yn(l,kt,yt),{value:kt}),u.angle=r.angle,u.baseline=r.baseline,R(c,{fill:a("titleColor"),fillOpacity:a("titleOpacity"),font:a("titleFont"),fontSize:a("titleFontSize"),fontStyle:a("titleFontStyle"),fontWeight:a("titleFontWeight"),limit:a("titleLimit"),lineHeight:a("titleLineHeight")},{align:a("titleAlign"),angle:a("titleAngle"),baseline:a("titleBaseline")}),function(e,t,n,i){const a=(e,t)=>null!=e?(n.update[t]=ii($(e),n.update[t]),!1):!z(t,i),l=a(e("titleX"),"x"),o=a(e("titleY"),"y");n.enter.auto=o===l?$(o):In(t,$(o),$(l))}(a,l,c,n),c.update.align=ii(c.update.align,r.align),c.update.angle=ii(c.update.angle,r.angle),c.update.baseline=ii(c.update.baseline,r.baseline),Nt({type:Ht,role:L,style:wt,from:i,encode:c},n)}function di(e,t){const n=function(e,t){var n,i,a,l,o,r,u,c,d=t.config,f=d.style,p=d.axis,g="band"===t.scaleType(e.scale)&&d.axisBand,m=e.orient;if(fe(m)){const e=li([d.axisX,d.axisY]),t=li([d.axisTop,d.axisBottom,d.axisLeft,d.axisRight]);for(a of(n={},e))n[a]=In(m,ai(a,d.axisX,p,f),ai(a,d.axisY,p,f));for(a of(i={},t))i[a]=(l=m.signal,o=ai(a,d.axisTop,p,f),r=ai(a,d.axisBottom,p,f),u=ai(a,d.axisLeft,p,f),c=ai(a,d.axisRight,p,f),{signal:(null!=u?`${l} === '${bt}' ? (${ni(u)}) : `:"")+(null!=r?`${l} === '${kt}' ? (${ni(r)}) : `:"")+(null!=c?`${l} === '${xt}' ? (${ni(c)}) : `:"")+(null!=o?`${l} === '${yt}' ? (${ni(o)}) : `:"")+"(null)"})}else n=m===yt||m===kt?d.axisX:d.axisY,i=d["axis"+m[0].toUpperCase()+m.slice(1)];return n||i||g?s({},p,n,i,g):p}(e,t),i=e.encode||{},a=i.axis||{},l=a.name||void 0,r=a.interactive,u=a.style,c=Vt(e,n),d=function(e){const t=e("tickBand");let n,i,a=e("tickOffset");return t?t.signal?(n={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},i={signal:`(${t.signal}) === 'extent'`},o(a)||(a={signal:`(${t.signal}) === 'extent' ? 0 : ${a}`})):"extent"===t?(n=1,i=!0,a=0):(n=.5,i=!1):(n=e("bandPosition"),i=e("tickExtra")),{extra:i,band:n,offset:a}}(c),f={scale:e.scale,ticks:!!c("ticks"),labels:!!c("labels"),grid:!!c("grid"),domain:!!c("domain"),title:null!=e.title},p=le(t.add(_e({},[f]))),g=le(t.add(We({scale:t.scaleRef(e.scale),extra:t.property(d.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),m=[];let h;return f.grid&&m.push(si(e,n,i.grid,g,d)),f.ticks&&(h=c("tickSize"),m.push(function(e,t,n,i,a,l){const o=Vt(e,t),s=e.orient,r=qn(s,-1,1);let u,c,d;const f={enter:u={opacity:Pt},update:d={opacity:Tt},exit:c={opacity:Pt}};R(f,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const p=$(a);p.mult=r;const g={scale:e.scale,field:Ot,band:l.band,extra:l.extra,offset:l.offset,round:o("tickRound")};return d.y=u.y=In(s,Pt,g),d.y2=u.y2=In(s,p),c.x=In(s,g),d.x=u.x=Xn(s,Pt,g),d.x2=u.x2=Xn(s,p),c.y=Xn(s,g),Nt({type:At,role:F,key:Ot,from:i,encode:f},n)}(e,n,i.ticks,g,h,d))),f.labels&&(h=f.ticks?h:0,m.push(ui(e,n,i.labels,g,h,d))),f.domain&&m.push(function(e,t,n,i){const a=Vt(e,t),l=e.orient;let o,s;const r={enter:o={opacity:Pt},update:s={opacity:Tt},exit:{opacity:Pt}};R(r,{stroke:a("domainColor"),strokeCap:a("domainCap"),strokeDash:a("domainDash"),strokeDashOffset:a("domainDashOffset"),strokeWidth:a("domainWidth"),strokeOpacity:a("domainOpacity")});const u=oi(e,0),c=oi(e,1);return o.x=s.x=In(l,u,Pt),o.x2=s.x2=In(l,c),o.y=s.y=Xn(l,u,Pt),o.y2=s.y2=Xn(l,c),Nt({type:At,role:C,from:i,encode:r},n)}(e,n,i.domain,p)),f.title&&m.push(ci(e,n,i.title,p)),En(Mt({role:_,from:p,encode:O(fi(c,e),a,Lt),marks:m,aria:c("aria"),description:c("description"),zindex:c("zindex"),name:l,interactive:r,style:u}),t)}function fi(e,t){const n={enter:{},update:{}};return R(n,{orient:e("orient"),offset:e("offset")||0,position:ge(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function pi(n,i,l){const o=a(n.signals),s=a(n.scales);return l||o.forEach((e=>te(e,i))),a(n.projections).forEach((e=>function(e,t){const n=t.config.projection||{},i={};for(const n in e)"name"!==n&&(i[n]=ht(e[n],n,t));for(const e in n)null==i[e]&&(i[e]=ht(n[e],e,t));t.addProjection(e.name,i)}(e,i))),s.forEach((n=>function(n,i){const a=n.type||"linear";p(a)||t("Unrecognized scale type: "+e(a)),i.addScale(n.name,{type:a,domain:void 0})}(n,i))),a(n.data).forEach((e=>An(e,i))),s.forEach((e=>it(e,i))),(l||o).forEach((e=>Oe(e,i))),a(n.axes).forEach((e=>di(e,i))),a(n.marks).forEach((e=>En(e,i))),a(n.legends).forEach((e=>Fn(e,i))),n.title&&Bn(n.title,i),i.parseLambdas(),i}function gi(e,t){const n=t.config,i=le(t.root=t.add(ae())),o=function(e,t){const n=n=>ge(e[n],t[n]),i=[mi("background",n("background")),mi("autosize",x(n("autosize"))),mi("padding",v(n("padding"))),mi("width",n("width")||0),mi("height",n("height")||0)],o=i.reduce(((e,t)=>(e[t.name]=t,e)),{}),r={};return a(e.signals).forEach((e=>{l(o,e.name)?e=s(o[e.name],e):i.push(e),r[e.name]=e})),a(t.signals).forEach((e=>{l(r,e.name)||l(o,e.name)||i.push(e)})),i}(e,n);o.forEach((e=>te(e,t))),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const r=t.add(_e()),u=t.add(Ee(J((e=>O({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e))(e.encode),Bt,W,e.style,t,{pulse:le(r)}))),c=t.add(Ze({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:le(u)}));t.operators.pop(),t.pushState(le(u),le(c),null),pi(e,t,o),t.operators.push(c);let d=t.add(je({mark:i,pulse:le(c)}));return d=t.add(Ge({pulse:le(d)})),d=t.add(Ke({pulse:le(d)})),t.addData("root",new Wn(t,r,r,d)),t}function mi(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function hi(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function yi(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function bi(e){return(r(e)?xi:ki)(e)}function xi(t){const n=t.length;let i="[";for(let a=0;a<n;++a){const n=t[a];i+=(a>0?",":"")+(o(n)?n.signal||bi(n):e(n))}return i+"]"}function ki(t){let n,i,a="{",l=0;for(n in t)i=t[n],a+=(++l>1?",":"")+e(n)+":"+(o(i)?i.signal||bi(i):e(i));return a+"}"}function vi(){const e="sans-serif",t="#4c78a8",n="#000",i="#888",a="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:t},area:{fill:t},image:null,line:{stroke:t,strokeWidth:2},path:{stroke:t},rect:{fill:t},rule:{stroke:n},shape:{stroke:t},symbol:{fill:t,size:64},text:{fill:n,font:e,fontSize:11},trail:{fill:t,size:2},style:{"guide-label":{fill:n,font:e,fontSize:10},"guide-title":{fill:n,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:a},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:i,grid:!1,gridWidth:1,gridColor:a,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:i,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:a,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:i,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function $i(e,n,i){return o(e)||t("Input Vega specification must be an object."),gi(e,new hi(n=u(vi(),n,e.config),i)).toRuntime()}hi.prototype=yi.prototype={parse(e){return pi(e,this)},fork(){return new yi(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((t=>{t.$ref=e.id})),e.refs=null),e},proxy(e){const t=e instanceof ne?le(e):e;return this.add(Ye({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){let i,a;e&&(i=e.data||(e.data={}),a=i[t]||(i[t]=[]),a.push(n))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const i in t.index)n(t.index[i],e,"index:"+i)}return this},pushState(e,t,n){this._encode.push(le(this.add(Ke({pulse:e})))),this._parent.push(t),this._lookup.push(n?le(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return n(this._parent)},encode(){return n(this._encode)},lookup(){return n(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(n,a){if(i(n))return oe(n,a);n.signal||t("Unsupported field reference: "+e(n));const l=n.signal;let o=this.field[l];if(!o){const e={name:this.signalRef(l)};a&&(e.as=a),this.field[l]=o=le(this.add(Pe(e)))}return o},compareRef(e){let t=!1;const n=e=>fe(e)?(t=!0,this.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(t=!0,this.exprRef(e.expr)):e,i=a(e.field).map(n),l=a(e.order).map(n);return t?le(this.add(Ce({fields:i,orders:l}))):re(i,l)},keyRef(e,t){let n=!1;const i=this.signals;return e=a(e).map((e=>fe(e)?(n=!0,le(i[e.signal])):e)),n?le(this.add(Te({fields:e,flat:t}))):function(e,t){const n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef(e){if(!e)return e;const t=ue(e.op,e.field),n=e.order||"ascending";return n.signal?le(this.add(Ce({fields:t,orders:this.signalRef(n.signal)}))):re(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},hasOwnSignal(e){return l(this.signals,e)},addSignal(n,i){this.hasOwnSignal(n)&&t("Duplicate signal name: "+e(n));const a=i instanceof ne?i:this.add(ae(i));return this.signals[n]=a},getSignal(n){return this.signals[n]||t("Unrecognized signal name: "+e(n)),this.signals[n]},signalRef(e){return this.signals[e]?le(this.signals[e]):(l(this.lambdas,e)||(this.lambdas[e]=this.add(ae(null))),le(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const n=e[t],i=d(n,this),a=this.lambdas[n];a.params=i.$params,a.update=i.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&o(e)?this.signalRef(e.signal||bi(e)):e},exprRef(e,t){const n={expr:d(e,this)};return t&&(n.expr.$name=t),le(this.add(Fe(n)))},addBinding(n,i){this.bindings||t("Nested signals do not support binding: "+e(n)),this.bindings.push(s({signal:n},i))},addScaleProj(n,i){l(this.scales,n)&&t("Duplicate scale or projection name: "+e(n)),this.scales[n]=this.add(i)},addScale(e,t){this.addScaleProj(e,Je(t))},addProjection(e,t){this.addScaleProj(e,Xe(t))},getScale(n){return this.scales[n]||t("Unrecognized scale name: "+e(n)),this.scales[n]},scaleRef(e){return le(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(n,i){return l(this.data,n)&&t("Duplicate data set name: "+e(n)),this.data[n]=i},getData(n){return this.data[n]||t("Undefined data set name: "+e(n)),this.data[n]},addDataPipeline(n,i){return l(this.data,n)&&t("Duplicate data set name: "+e(n)),this.addData(n,Wn.fromEntries(this,i))}};export{C as AxisDomainRole,D as AxisGridRole,E as AxisLabelRole,_ as AxisRole,F as AxisTickRole,L as AxisTitleRole,Wn as DataScope,W as FrameRole,T as LegendEntryRole,B as LegendLabelRole,P as LegendRole,U as LegendSymbolRole,A as LegendTitleRole,w as MarkRole,hi as Scope,j as ScopeRole,vi as config,$i as parse,te as signal,Oe as signalUpdates,ye as stream};export default null;
//# sourceMappingURL=/sm/4e2a9b2588e711f66cf3dde30cd029fbeb91e4f739916f0ffb51d84e48a6433e.map