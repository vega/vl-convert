/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/vega-selections@5.4.2/build/vega-selection.module.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{bisector as e,union as t,intersection as n}from"/npm/d3-array@3.2.4/+esm";import{field as r,extend as i,array as u,toNumber as f,error as l,peek as s,hasOwnProperty as a,isDate as o,isArray as c,inrange as v}from"/npm/vega-util@1.17.2/+esm";import{Literal as d}from"/npm/vega-expression@5.1.0/+esm";const g=Symbol("vega_selection_getter");function p(e){return e.getter&&e.getter[g]||(e.getter=r(e.field),e.getter[g]=!0),e.getter}const h="intersect",m="union",_="or",y="and",x="_vgsid_",R=r(x),E="index:unit";function O(e,t){for(var n,r,i=t.fields,u=t.values,l=i.length,s=0;s<l;++s)if(n=p(r=i[s])(e),o(n)&&(n=f(n)),o(u[s])&&(u[s]=f(u[s])),c(u[s])&&o(u[s][0])&&(u[s]=u[s].map(f)),"E"===r.type){if(c(u[s])?u[s].indexOf(n)<0:n!==u[s])return!1}else if("R"===r.type){if(!v(n,u[s]))return!1}else if("R-RE"===r.type){if(!v(n,u[s],!0,!1))return!1}else if("R-E"===r.type){if(!v(n,u[s],!1,!1))return!1}else if("R-LE"===r.type&&!v(n,u[s],!1,!0))return!1;return!0}function $(e,t,n){for(var r,i,u,f,l,s=this.context.data[e],a=s?s.values.value:[],o=s?s[E]&&s[E].value:void 0,c=n===h,v=a.length,d=0;d<v;++d)if(r=a[d],o&&c){if(-1===(u=(i=i||{})[f=r.unit]||0))continue;if(l=O(t,r),i[f]=l?-1:++u,l&&1===o.size)return!0;if(!l&&u===o.get(f).count)return!1}else if(c^(l=O(t,r)))return l;return v&&c}const b=e(R),j=b.left,k=b.right;function z(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],u=r?r[E]&&r[E].value:void 0,f=n===h,l=R(t),s=j(i,l);if(s===i.length)return!1;if(R(i[s])!==l)return!1;if(u&&f){if(1===u.size)return!0;if(k(i,l)-s<u.size)return!1}return!0}function D(e,t){return e.map((e=>i(t.fields?{values:t.fields.map((t=>p(t)(e.datum)))}:{[x]:R(e.datum)},t)))}function A(e,t,n,r){for(var i,f,l,s,a,o,c,v,d,g,p,h,E=this.context.data[e],O=E?E.values.value:[],$={},b={},j={},k=O.length,z=0;z<k;++z)if(s=(i=O[z]).unit,f=i.fields,l=i.values,f&&l){for(p=0,h=f.length;p<h;++p)a=f[p],v=(c=$[a.field]||($[a.field]={}))[s]||(c[s]=[]),j[a.field]=d=a.type.charAt(0),g=F[`${d}_union`],c[s]=g(v,u(l[p]));n&&(v=b[s]||(b[s]=[])).push(u(l).reduce(((e,t,n)=>(e[f[n].field]=t,e)),{}))}else a=x,o=R(i),(v=(c=$[a]||($[a]={}))[s]||(c[s]=[])).push(o),n&&(v=b[s]||(b[s]=[])).push({[x]:o});if(t=t||m,$[x]?$[x]=F[`${x}_${t}`](...Object.values($[x])):Object.keys($).forEach((e=>{$[e]=Object.keys($[e]).map((t=>$[e][t])).reduce(((n,r)=>void 0===n?r:F[`${j[e]}_${t}`](n,r)))})),O=Object.keys(b),n&&O.length){$[r?"vlPoint":"vlMulti"]=t===m?{[_]:O.reduce(((e,t)=>(e.push(...b[t]),e)),[])}:{[y]:O.map((e=>({[_]:b[e]})))}}return $}var F={[`${x}_union`]:t,[`${x}_intersect`]:n,E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.indexOf(e)>=0)):t},R_union:function(e,t){var n=f(t[0]),r=f(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=f(t[0]),r=f(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};function L(e,t,n,r){t[0].type!==d&&l("First argument to selection functions must be a string literal.");const i=t[0].value,u="unit",f="@"+u,o=":"+i;(t.length>=2&&s(t).value)!==h||a(r,f)||(r[f]=n.getData(i).indataRef(n,u)),a(r,o)||(r[o]=n.getData(i).tuplesRef())}export{z as selectionIdTest,A as selectionResolve,$ as selectionTest,D as selectionTuples,L as selectionVisitor};export default null;
//# sourceMappingURL=/sm/d72e302e6d39182736678daa27447312d1ab8a7c08cec4279b39f0f7f3cea5e5.map