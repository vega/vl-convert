/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/vega-force@5.1.0/build/vega-force.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Transform as e}from"/npm/vega-dataflow@6.1.0/+esm";import{inherits as a,array as t,isFunction as r,accessorFields as n,hasOwnProperty as o,error as i}from"/npm/vega-util@2.1.0/+esm";import{forceSimulation as f,forceCenter as m,forceCollide as p,forceManyBody as l,forceLink as s,forceX as u,forceY as d}from"/npm/d3-force@3.0.0/+esm";const c={center:m,collide:p,nbody:l,link:s,x:u,y:d},y="forces",h=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],b=["static","iterations"],g=["x","y","vx","vy"];function x(a){e.call(this,null,a)}function k(e,a,r,n){var o,i,f,m,p=t(a.forces);for(o=0,i=h.length;o<i;++o)(f=h[o])!==y&&a.modified(f)&&e[f](a[f]);for(o=0,i=p.length;o<i;++o)m=y+o,(f=r||a.modified(y,o)?M(p[o]):n&&v(p[o],n)?e.force(m):null)&&e.force(m,f);for(i=e.numForces||0;o<i;++o)e.force(y+o,null);return e.numForces=p.length,e}function v(e,a){var t,o;for(t in e)if(r(o=e[t])&&a.modified(n(o)))return 1;return 0}function M(e){var a,t;for(t in o(c,e.force)||i("Unrecognized force: "+e.force),a=c[e.force](),e)r(a[t])&&D(a[t],e[t],e);return a}function D(e,a,t){e(r(a)?e=>a(e,t):a)}x.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30,expr:!0},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:g}]},a(x,e,{transform(e,a){var t,r,n=this.value,o=a.changed(a.ADD_REM),i=e.modified(h),m=e.iterations||300;if(n?(o&&(a.modifies("index"),n.nodes(a.source)),(i||a.changed(a.MOD))&&k(n,e,0,a)):(this.value=n=function(e,a){const t=f(e),r=t.stop,n=t.restart;let o=!1;return t.stopped=()=>o,t.restart=()=>(o=!1,n()),t.stop=()=>(o=!0,r()),k(t,a,!0).on("end",(()=>o=!0))}(a.source,e),n.on("tick",(t=a.dataflow,r=this,()=>t.touch(r).run())),e.static||(o=!0,n.tick()),a.modifies("index")),i||o||e.modified(b)||a.changed()&&e.restart)if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/m)),e.static)for(n.stop();--m>=0;)n.tick();else if(n.stopped()&&n.restart(),!o)return a.StopPropagation;return this.finish(e,a)},finish(e,a){const t=a.dataflow;for(let e,a=this._argops,f=0,m=a.length;f<m;++f)if(e=a[f],e.name===y&&"link"===e.op._argval.force)for(var r,n=e.op._argops,o=0,i=n.length;o<i;++o)if("links"===n[o].name&&(r=n[o].op.source)){t.pulse(r,t.changeset().reflow());break}return a.reflow(e.modified()).modifies(g)}});export{x as force};export default null;
//# sourceMappingURL=/sm/20d94147f616ba155a081c082311b7205526685f0ac2c5d5525aec9e9c6137c5.map