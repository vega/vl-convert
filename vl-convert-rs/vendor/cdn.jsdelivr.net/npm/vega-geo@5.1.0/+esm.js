/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/vega-geo@5.1.0/build/vega-geo.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Transform as e,rederive as t,ingest as n,replace as a}from"/npm/vega-dataflow@6.1.0/+esm";import{inherits as r,identity as i,isArray as o,isFunction as u,isNumber as s,accessorName as l,accessorFields as f,field as d,extend as m,constant as c,toSet as p,error as h,array as y,extent as g,zero as v,one as E}from"/npm/vega-util@2.1.0/+esm";import{max as b,tickStep as x,range as D,sum as z}from"/npm/d3-array@3.2.4/+esm";import{bandwidthNRD as S}from"/npm/vega-statistics@2.0.0/+esm";import{getProjectionPath as R,projectionProperties as O,projection as w}from"/npm/vega-projection@2.1.0/+esm";import{geoGraticule as M}from"/npm/d3-geo@3.1.1/+esm";import{rgb as j}from"/npm/d3-color@3.1.0/+esm";import{canvas as C}from"/npm/vega-canvas@2.0.0/+esm";function $(){}const _=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function U(){var e=1,t=1,n=o;function a(e,t){return t.map((t=>r(e,t)))}function r(a,r){var o=[],u=[];return function(n,a,r){var o,u,s,l,f,d,m=[],c=[];o=u=-1,l=n[0]>=a,_[l<<1].forEach(p);for(;++o<e-1;)s=l,l=n[o+1]>=a,_[s|l<<1].forEach(p);_[l|0].forEach(p);for(;++u<t-1;){for(o=-1,l=n[u*e+e]>=a,f=n[u*e]>=a,_[l<<1|f<<2].forEach(p);++o<e-1;)s=l,l=n[u*e+e+o+1]>=a,d=f,f=n[u*e+o+1]>=a,_[s|l<<1|f<<2|d<<3].forEach(p);_[l|f<<3].forEach(p)}o=-1,f=n[u*e]>=a,_[f<<2].forEach(p);for(;++o<e-1;)d=f,f=n[u*e+o+1]>=a,_[f<<2|d<<3].forEach(p);function p(e){var t,n,a=[e[0][0]+o,e[0][1]+u],s=[e[1][0]+o,e[1][1]+u],l=i(a),f=i(s);(t=c[l])?(n=m[f])?(delete c[t.end],delete m[n.start],t===n?(t.ring.push(s),r(t.ring)):m[t.start]=c[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete c[t.end],t.ring.push(s),c[t.end=f]=t):(t=m[f])?(n=c[l])?(delete m[t.start],delete c[n.end],t===n?(t.ring.push(s),r(t.ring)):m[n.start]=c[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete m[t.start],t.ring.unshift(a),m[t.start=l]=t):m[l]=c[f]={start:l,end:f,ring:[a,s]}}_[f<<3].forEach(p)}(a,r,(e=>{n(e,a,r),function(e){var t=0,n=e.length,a=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];for(;++t<n;)a+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return a}(e)>0?o.push([e]):u.push(e)})),u.forEach((e=>{for(var t,n=0,a=o.length;n<a;++n)if(-1!==A((t=o[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:r,coordinates:o}}function i(t){return 2*t[0]+t[1]*(e+1)*4}function o(n,a,r){n.forEach((n=>{var i,o=n[0],u=n[1],s=0|o,l=0|u,f=a[l*e+s];o>0&&o<e&&s===o&&(i=a[l*e+s-1],n[0]=o+(r-i)/(f-i)-.5),u>0&&u<t&&l===u&&(i=a[(l-1)*e+s],n[1]=u+(r-i)/(f-i)-.5)}))}return a.contour=r,a.size=function(n){if(!arguments.length)return[e,t];var r=Math.floor(n[0]),i=Math.floor(n[1]);return r>=0&&i>=0||h("invalid size"),e=r,t=i,a},a.smooth=function(e){return arguments.length?(n=e?o:$,a):n===o},a}function A(e,t){for(var n,a=-1,r=t.length;++a<r;)if(n=L(e,t[a]))return n;return 0}function L(e,t){for(var n=t[0],a=t[1],r=-1,i=0,o=e.length,u=o-1;i<o;u=i++){var s=e[i],l=s[0],f=s[1],d=e[u],m=d[0],c=d[1];if(N(s,d,t))return 0;f>a!=c>a&&n<(m-l)*(a-f)/(c-f)+l&&(r=-r)}return r}function N(e,t,n){var a,r,i,o;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&(r=e[a=+(e[0]===t[0])],i=n[a],o=t[a],r<=i&&i<=o||o<=i&&i<=r)}function F(e,t,n){return function(a){var r=g(a),i=n?Math.min(r[0],0):r[0],o=r[1],u=o-i,s=t?x(i,o,e):u/(e+1);return D(i+s,o,s)}}function P(t){e.call(this,null,t)}function k(e,t,n,a,r){const i=e.x1||0,o=e.y1||0,u=t*n<0;function s(e){e.forEach(l)}function l(e){u&&e.reverse(),e.forEach(f)}function f(e){e[0]=(e[0]-i)*t+a,e[1]=(e[1]-o)*n+r}return function(e){return e.coordinates.forEach(s),e}}function q(e,t,n){const a=e>=0?e:S(t,n);return Math.round((Math.sqrt(4*a*a+1)-1)/2)}function I(e){return u(e)?e:c(+e)}function G(){var e=e=>e[0],t=e=>e[1],n=E,a=[-1,-1],r=960,i=500,o=2;function u(u,s){const l=q(a[0],u,e)>>o,f=q(a[1],u,t)>>o,d=l?l+2:0,m=f?f+2:0,c=2*d+(r>>o),p=2*m+(i>>o),h=new Float32Array(c*p),y=new Float32Array(c*p);let g=h;u.forEach((a=>{const r=d+(+e(a)>>o),i=m+(+t(a)>>o);r>=0&&r<c&&i>=0&&i<p&&(h[r+i*c]+=+n(a))})),l>0&&f>0?(J(c,p,h,y,l),K(c,p,y,h,f),J(c,p,h,y,l),K(c,p,y,h,f),J(c,p,h,y,l),K(c,p,y,h,f)):l>0?(J(c,p,h,y,l),J(c,p,y,h,l),J(c,p,h,y,l),g=y):f>0&&(K(c,p,h,y,f),K(c,p,y,h,f),K(c,p,h,y,f),g=y);const v=s?Math.pow(2,-2*o):1/z(g);for(let e=0,t=c*p;e<t;++e)g[e]*=v;return{values:g,scale:1<<o,width:c,height:p,x1:d,y1:m,x2:d+(r>>o),y2:m+(i>>o)}}return u.x=function(t){return arguments.length?(e=I(t),u):e},u.y=function(e){return arguments.length?(t=I(e),u):t},u.weight=function(e){return arguments.length?(n=I(e),u):n},u.size=function(e){if(!arguments.length)return[r,i];var t=+e[0],n=+e[1];return t>=0&&n>=0||h("invalid size"),r=t,i=n,u},u.cellSize=function(e){return arguments.length?((e=+e)>=1||h("invalid cell size"),o=Math.floor(Math.log(e)/Math.LN2),u):1<<o},u.bandwidth=function(e){return arguments.length?(1===(e=y(e)).length&&(e=[+e[0],+e[0]]),2!==e.length&&h("invalid bandwidth"),a=e,u):a},u}function J(e,t,n,a,r){const i=1+(r<<1);for(let o=0;o<t;++o)for(let t=0,u=0;t<e+r;++t)t<e&&(u+=n[t+o*e]),t>=r&&(t>=i&&(u-=n[t-i+o*e]),a[t-r+o*e]=u/Math.min(t+1,e-1+i-t,i))}function K(e,t,n,a,r){const i=1+(r<<1);for(let o=0;o<e;++o)for(let u=0,s=0;u<t+r;++u)u<t&&(s+=n[o+u*e]),u>=r&&(u>=i&&(s-=n[o+(u-i)*e]),a[o+(u-r)*e]=s/Math.min(u+1,t-1+i-u,i))}function B(t){e.call(this,null,t)}P.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},r(P,e,{transform(e,a){if(this.value&&!a.changed()&&!e.modified())return a.StopPropagation;var r=a.fork(a.NO_SOURCE|a.NO_FIELDS),l=a.materialize(a.SOURCE).source,f=e.field||i,d=U().smooth(!1!==e.smooth),m=e.thresholds||function(e,t,n){const a=F(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?a:a(e.map((e=>b(t(e).values))))}(l,f,e),c=null===e.as?null:e.as||"contour",p=[];return l.forEach((a=>{const r=f(a),i=d.size([r.width,r.height])(r.values,o(m)?m:m(r.values));!function(e,t,n,a){let r=a.scale||t.scale,i=a.translate||t.translate;u(r)&&(r=r(n,a));u(i)&&(i=i(n,a));if((1===r||null==r)&&!i)return;const o=(s(r)?r:r[0])||1,l=(s(r)?r:r[1])||1,f=i&&i[0]||0,d=i&&i[1]||0;e.forEach(k(t,o,l,f,d))}(i,r,a,e),i.forEach((e=>{p.push(t(a,n(null!=c?{[c]:e}:e)))}))})),this.value&&(r.rem=this.value),this.value=r.source=r.add=p,r}}),B.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const H=["x","y","weight","size","cellSize","bandwidth"];function Q(e,t){return H.forEach((n=>null!=t[n]?e[n](t[n]):0)),e}function T(t){e.call(this,null,t)}r(B,e,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var a,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(e,t){var n,a,r,i,o,u,s=[],l=e=>e(i);if(null==t)s.push(e);else for(n={},a=0,r=e.length;a<r;++a)i=e[a],(u=n[o=t.map(l)])||(n[o]=u=[],u.dims=o,s.push(u)),u.push(i);return s}(t.materialize(t.SOURCE).source,e.groupby),o=(e.groupby||[]).map(l),u=Q(G(),e),s=e.as||"grid";return a=i.map((t=>n(function(e,t){for(let n=0;n<o.length;++n)e[o[n]]=t[n];return e}({[s]:u(t,e.counts)},t.dims)))),this.value&&(r.rem=this.value),this.value=r.source=r.add=a,r}}),T.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},r(T,e,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var a,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),u=U().smooth(!1!==e.smooth),s=e.values,l=e.thresholds||F(e.count||10,e.nice,!!s),f=e.size;return s||(s=t.materialize(t.SOURCE).source,r=k(a=Q(G(),e)(s,!0),a.scale||1,a.scale||1,0,0),f=[a.width,a.height],s=a.values),l=o(l)?l:l(s),s=u.size(f)(s,l),r&&s.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(s||[]).map(n),i}});const V="Feature",W="FeatureCollection";function X(t){e.call(this,null,t)}function Y(t){e.call(this,null,t)}function Z(t){e.call(this,null,t)}function ee(t){e.call(this,null,t)}function te(t){e.call(this,[],t),this.generator=M()}function ne(t){e.call(this,null,t)}function ae(e){if(!u(e))return!1;const t=p(f(e));return t.$x||t.$y||t.$value||t.$max}function re(t){e.call(this,null,t),this.modified(!0)}function ie(e,t,n){u(e[t])&&e[t](n)}X.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},r(X,e,{transform(e,t){var n,a=this._features,r=this._points,o=e.fields,u=o&&o[0],s=o&&o[1],l=e.geojson||!o&&i,d=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(f(l))||u&&t.modified(f(u))||s&&t.modified(f(s)),this.value&&!n||(d=t.SOURCE,this._features=a=[],this._points=r=[]),l&&t.visit(d,(e=>a.push(l(e)))),u&&s&&(t.visit(d,(e=>{var t=u(e),n=s(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&r.push([t,n])})),a=a.concat({type:V,geometry:{type:"MultiPoint",coordinates:r}})),this.value={type:W,features:a}}}),Y.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},r(Y,e,{transform(e,t){var n=t.fork(t.ALL),a=this.value,r=e.field||i,o=e.as||"path",u=n.SOURCE;!a||e.modified()?(this.value=a=R(e.projection),n.materialize().reflow()):u=r===i||t.modified(r.fields)?n.ADD_MOD:n.ADD;const s=function(e,t){const n=e.pointRadius();e.context(null),null!=t&&e.pointRadius(t);return n}(a,e.pointRadius);return n.visit(u,(e=>e[o]=a(r(e)))),a.pointRadius(s),n.modifies(o)}}),Z.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},r(Z,e,{transform(e,t){var n,a=e.projection,r=e.fields[0],i=e.fields[1],o=e.as||["x","y"],u=o[0],s=o[1];function l(e){const t=a([r(e),i(e)]);t?(e[u]=t[0],e[s]=t[1]):(e[u]=void 0,e[s]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(n=t.modified(r.fields)||t.modified(i.fields),t.visit(n?t.ADD_MOD:t.ADD,l)),t.modifies(o)}}),ee.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},r(ee,e,{transform(e,t){var n=t.fork(t.ALL),a=this.value,r=e.as||"shape",i=n.ADD;return a&&!e.modified()||(this.value=a=function(e,t,n){const a=null==n?n=>e(t(n)):a=>{var r=e.pointRadius(),i=e.pointRadius(n)(t(a));return e.pointRadius(r),i};return a.context=t=>(e.context(t),a),a}(R(e.projection),e.field||d("datum"),e.pointRadius),n.materialize().reflow(),i=n.SOURCE),n.visit(i,(e=>e[r]=a)),n.modifies(r)}}),te.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},r(te,e,{transform(e,t){var r,i=this.value,o=this.generator;if(!i.length||e.modified())for(const t in e)u(o[t])&&o[t](e[t]);return r=o(),i.length?t.mod.push(a(i[0],r)):t.add.push(n(r)),i[0]=r,t}}),ne.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},r(ne,e,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,a="shared"===e.resolve,r=e.field||i,o=function(e,t){let n;u(e)?(n=n=>e(n,t),n.dep=ae(e)):e?n=c(e):(n=e=>e.$value/e.$max||0,n.dep=!0);return n}(e.opacity,e),s=function(e,t){let n;u(e)?(n=n=>j(e(n,t)),n.dep=ae(e)):n=c(j(e||"#888"));return n}(e.color,e),l=e.as||"image",f={$x:0,$y:0,$value:0,$max:a?b(n.map((e=>b(r(e).values)))):0};return n.forEach((e=>{const t=r(e),n=m({},e,f);a||(n.$max=b(t.values||[])),e[l]=function(e,t,n,a){const r=e.width,i=e.height,o=e.x1||0,u=e.y1||0,s=e.x2||r,l=e.y2||i,f=e.values,d=f?e=>f[e]:v,m=C(s-o,l-u),c=m.getContext("2d"),p=c.getImageData(0,0,s-o,l-u),h=p.data;for(let e=u,i=0;e<l;++e){t.$y=e-u;for(let u=o,l=e*r;u<s;++u,i+=4){t.$x=u-o,t.$value=d(u+l);const e=n(t);h[i+0]=e.r,h[i+1]=e.g,h[i+2]=e.b,h[i+3]=~~(255*a(t))}}return c.putImageData(p,0,0),m}(t,n,s.dep?s:c(s(n)),o.dep?o:c(o(n)))})),t.reflow(!0).modifies(l)}}),r(re,e,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(e){const t=w((e||"mercator").toLowerCase());t||h("Unrecognized projection type: "+e);return t()}(e.type),O.forEach((t=>{null!=e[t]&&ie(n,t,e[t])}))):O.forEach((t=>{e.modified(t)&&ie(n,t,e[t])})),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&function(e,t){const n=function(e){return e=y(e),1===e.length?e[0]:{type:W,features:e.reduce(((e,t)=>e.concat(function(e){return e.type===W?e.features:y(e).filter((e=>null!=e)).map((e=>e.type===V?e:{type:V,geometry:e}))}(t))),[])}}(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});export{T as contour,X as geojson,Y as geopath,Z as geopoint,ee as geoshape,te as graticule,ne as heatmap,P as isocontour,B as kde2d,re as projection};export default null;
//# sourceMappingURL=/sm/827c6ea131d11610353c0b00c3b6bd7633dbaf42024e741c8225a490d0e56992.map