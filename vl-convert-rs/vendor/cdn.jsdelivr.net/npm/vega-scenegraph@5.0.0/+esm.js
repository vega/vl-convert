/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/vega-scenegraph@5.0.0/build/vega-scenegraph.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{inherits as t,lruCache as e,toSet as n,hasOwnProperty as i,isArray as r,error as s,extend as o,isFunction as a,isNumber as l,isObject as c,truthy as h,array as u,peek as d}from"/npm/vega-util@2.0.0/+esm";import{arc as f,area as p,line as g,symbol as v,curveBasis as y,curveBasisClosed as m,curveBasisOpen as _,curveBundle as x,curveCardinal as k,curveCardinalOpen as b,curveCardinalClosed as w,curveCatmullRom as T,curveCatmullRomClosed as M,curveCatmullRomOpen as z,curveLinear as R,curveLinearClosed as A,curveMonotoneY as C,curveMonotoneX as P,curveNatural as L,curveStep as E,curveStepAfter as S,curveStepBefore as N}from"/npm/d3-shape@3.2.0/+esm";import{path as O}from"/npm/d3-path@3.1.0/+esm";export{path}from"/npm/d3-path@3.1.0/+esm";import{canvas as D,image as I}from"/npm/vega-canvas@2.0.0/+esm";import{loader as q}from"/npm/vega-loader@5.0.0/+esm";import{isDiscrete as $,domainCaption as V}from"/npm/vega-scale@8.0.0/+esm";let B=0;const H="p_";function W(t){return t&&t.gradient}function j(t,e,n){const i=t.gradient;let r=t.id,s="radial"===i?H:"";return r||(r=t.id="gradient_"+B++,"radial"===i?(t.x1=U(t.x1,.5),t.y1=U(t.y1,.5),t.r1=U(t.r1,0),t.x2=U(t.x2,.5),t.y2=U(t.y2,.5),t.r2=U(t.r2,.5),s=H):(t.x1=U(t.x1,0),t.y1=U(t.y1,0),t.x2=U(t.x2,1),t.y2=U(t.y2,0))),e[r]=t,"url("+(n||"")+"#"+s+r+")"}function U(t,e){return null!=t?t:e}function X(t,e){var n,i=[];return n={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:i,stop:function(t,e){return i.push({offset:t,color:e}),n}}}const G={basis:{curve:y},"basis-closed":{curve:m},"basis-open":{curve:_},bundle:{curve:x,tension:"beta",value:.85},cardinal:{curve:k,tension:"tension",value:0},"cardinal-open":{curve:b,tension:"tension",value:0},"cardinal-closed":{curve:w,tension:"tension",value:0},"catmull-rom":{curve:T,tension:"alpha",value:.5},"catmull-rom-closed":{curve:M,tension:"alpha",value:.5},"catmull-rom-open":{curve:z,tension:"alpha",value:.5},linear:{curve:R},"linear-closed":{curve:A},monotone:{horizontal:C,vertical:P},natural:{curve:L},step:{curve:E},"step-after":{curve:S},"step-before":{curve:N}};function Y(t,e,n){var r=i(G,t)&&G[t],s=null;return r&&(s=r.curve||r[e||"vertical"],r.tension&&null!=n&&(s=s[r.tension](n))),s}const J={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},F=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,Q=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,Z=/^((\s+,?\s*)|(,\s*))/,K=/^[01]/;function tt(t){const e=[];return(t.match(F)||[]).forEach((t=>{let n=t[0];const i=n.toLowerCase(),r=J[i],s=function(t,e,n){const i=[];for(let r=0;e&&r<n.length;)for(let s=0;s<e;++s){const e="a"!==t||3!==s&&4!==s?Q:K,o=n.slice(r).match(e);if(null===o)throw Error("Invalid SVG path, incorrect parameter type");r+=o[0].length,i.push(+o[0]);const a=n.slice(r).match(Z);null!==a&&(r+=a[0].length)}return i}(i,r,t.slice(1).trim()),o=s.length;if(o<r||o&&o%r!=0)throw Error("Invalid SVG path, incorrect parameter count");if(e.push([n,...s.slice(0,r)]),o!==r){"m"===i&&(n="M"===n?"L":"l");for(let t=r;t<o;t+=r)e.push([n,...s.slice(t,t+r)])}})),e}const et=Math.PI/180,nt=Math.PI/2,it=2*Math.PI,rt=Math.sqrt(3)/2;var st={},ot={},at=[].join;function lt(t){const e=at.call(t);if(ot[e])return ot[e];var n=t[0],i=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7];const h=c*o,u=-l*a,d=l*o,f=c*a,p=Math.cos(r),g=Math.sin(r),v=Math.cos(s),y=Math.sin(s),m=.5*(s-r),_=Math.sin(.5*m),x=8/3*_*_/Math.sin(m),k=n+p-x*g,b=i+g+x*p,w=n+v,T=i+y,M=w+x*y,z=T-x*v;return ot[e]=[h*k+u*b,d*k+f*b,h*M+u*z,d*M+f*z,h*w+u*T,d*w+f*T]}const ct=["l",0,0,0,0,0,0,0];function ht(t,e,n){const i=ct[0]=t[0];if("a"===i||"A"===i)ct[1]=e*t[1],ct[2]=n*t[2],ct[3]=t[3],ct[4]=t[4],ct[5]=t[5],ct[6]=e*t[6],ct[7]=n*t[7];else if("h"===i||"H"===i)ct[1]=e*t[1];else if("v"===i||"V"===i)ct[1]=n*t[1];else for(var r=1,s=t.length;r<s;++r)ct[r]=(r%2==1?e:n)*t[r];return ct}function ut(t,e,n,i,r,s){var o,a,l,c,h,u=null,d=0,f=0,p=0,g=0,v=0,y=0;null==n&&(n=0),null==i&&(i=0),null==r&&(r=1),null==s&&(s=r),t.beginPath&&t.beginPath();for(var m=0,_=e.length;m<_;++m){switch(o=e[m],1===r&&1===s||(o=ht(o,r,s)),o[0]){case"l":d+=o[1],f+=o[2],t.lineTo(d+n,f+i);break;case"L":d=o[1],f=o[2],t.lineTo(d+n,f+i);break;case"h":d+=o[1],t.lineTo(d+n,f+i);break;case"H":d=o[1],t.lineTo(d+n,f+i);break;case"v":f+=o[1],t.lineTo(d+n,f+i);break;case"V":f=o[1],t.lineTo(d+n,f+i);break;case"m":v=d+=o[1],y=f+=o[2],t.moveTo(d+n,f+i);break;case"M":v=d=o[1],y=f=o[2],t.moveTo(d+n,f+i);break;case"c":a=d+o[5],l=f+o[6],p=d+o[3],g=f+o[4],t.bezierCurveTo(d+o[1]+n,f+o[2]+i,p+n,g+i,a+n,l+i),d=a,f=l;break;case"C":d=o[5],f=o[6],p=o[3],g=o[4],t.bezierCurveTo(o[1]+n,o[2]+i,p+n,g+i,d+n,f+i);break;case"s":a=d+o[3],l=f+o[4],p=2*d-p,g=2*f-g,t.bezierCurveTo(p+n,g+i,d+o[1]+n,f+o[2]+i,a+n,l+i),p=d+o[1],g=f+o[2],d=a,f=l;break;case"S":a=o[3],l=o[4],p=2*d-p,g=2*f-g,t.bezierCurveTo(p+n,g+i,o[1]+n,o[2]+i,a+n,l+i),d=a,f=l,p=o[1],g=o[2];break;case"q":a=d+o[3],l=f+o[4],p=d+o[1],g=f+o[2],t.quadraticCurveTo(p+n,g+i,a+n,l+i),d=a,f=l;break;case"Q":a=o[3],l=o[4],t.quadraticCurveTo(o[1]+n,o[2]+i,a+n,l+i),d=a,f=l,p=o[1],g=o[2];break;case"t":a=d+o[1],l=f+o[2],null===u[0].match(/[QqTt]/)?(p=d,g=f):"t"===u[0]?(p=2*d-c,g=2*f-h):"q"===u[0]&&(p=2*d-p,g=2*f-g),c=p,h=g,t.quadraticCurveTo(p+n,g+i,a+n,l+i),f=l,p=(d=a)+o[1],g=f+o[2];break;case"T":a=o[1],l=o[2],p=2*d-p,g=2*f-g,t.quadraticCurveTo(p+n,g+i,a+n,l+i),d=a,f=l;break;case"a":dt(t,d+n,f+i,[o[1],o[2],o[3],o[4],o[5],o[6]+d+n,o[7]+f+i]),d+=o[6],f+=o[7];break;case"A":dt(t,d+n,f+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]),d=o[6],f=o[7];break;case"z":case"Z":d=v,f=y,t.closePath()}u=o}}function dt(t,e,n,i){const r=function(t,e,n,i,r,s,o,a,l){const c=at.call(arguments);if(st[c])return st[c];const h=o*et,u=Math.sin(h),d=Math.cos(h),f=d*(a-t)*.5+u*(l-e)*.5,p=d*(l-e)*.5-u*(a-t)*.5;let g=f*f/((n=Math.abs(n))*n)+p*p/((i=Math.abs(i))*i);g>1&&(g=Math.sqrt(g),n*=g,i*=g);const v=d/n,y=u/n,m=-u/i,_=d/i,x=v*a+y*l,k=m*a+_*l,b=v*t+y*e,w=m*t+_*e;let T=1/((b-x)*(b-x)+(w-k)*(w-k))-.25;T<0&&(T=0);let M=Math.sqrt(T);s==r&&(M=-M);const z=.5*(x+b)-M*(w-k),R=.5*(k+w)+M*(b-x),A=Math.atan2(k-R,x-z);let C=Math.atan2(w-R,b-z)-A;C<0&&1===s?C+=it:C>0&&0===s&&(C-=it);const P=Math.ceil(Math.abs(C/(nt+.001))),L=[];for(let t=0;t<P;++t){const e=A+t*C/P,r=A+(t+1)*C/P;L[t]=[z,R,e,r,n,i,u,d]}return st[c]=L}(i[5],i[6],i[0],i[1],i[3],i[4],i[2],e,n);for(let e=0;e<r.length;++e){const n=lt(r[e]);t.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}const ft=.5773502691896257,pt={circle:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,it)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/2.5;t.moveTo(-n,-i),t.lineTo(-n,i),t.lineTo(-i,i),t.lineTo(-i,n),t.lineTo(i,n),t.lineTo(i,i),t.lineTo(n,i),t.lineTo(n,-i),t.lineTo(i,-i),t.lineTo(i,-n),t.lineTo(-i,-n),t.lineTo(-i,-i),t.closePath()}},diamond:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),i=-n/2;t.rect(i,i,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/7,r=n/2.5,s=n/8;t.moveTo(-i,n),t.lineTo(i,n),t.lineTo(i,-s),t.lineTo(r,-s),t.lineTo(0,-n),t.lineTo(-r,-s),t.lineTo(-i,-s),t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,i=rt*n,r=i-n*ft,s=n/4;t.moveTo(0,-i-r),t.lineTo(-s,i-r),t.lineTo(s,i-r),t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,i=rt*n,r=i-n*ft;t.moveTo(0,-i-r),t.lineTo(-n,i-r),t.lineTo(n,i-r),t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,i=rt*n;t.moveTo(0,-i),t.lineTo(-n,i),t.lineTo(n,i),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,i=rt*n;t.moveTo(0,i),t.lineTo(-n,-i),t.lineTo(n,-i),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,i=rt*n;t.moveTo(i,0),t.lineTo(-i,-n),t.lineTo(-i,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,i=rt*n;t.moveTo(-i,0),t.lineTo(i,-n),t.lineTo(i,n),t.closePath()}},stroke:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(n,0)}}};function gt(t){return i(pt,t)?pt[t]:function(t){if(!i(vt,t)){const e=tt(t);vt[t]={draw:function(t,n){ut(t,e,0,0,Math.sqrt(n)/2)}}}return vt[t]}(t)}var vt={};const yt=.448084975506;function mt(t){return t.x}function _t(t){return t.y}function xt(t){return t.width}function kt(t){return t.height}function bt(t){return"function"==typeof t?t:()=>+t}function wt(t,e,n){return Math.max(e,Math.min(t,n))}function Tt(){var t=mt,e=_t,n=xt,i=kt,r=bt(0),s=r,o=r,a=r,l=null;function c(c,h,u){var d,f=null!=h?h:+t.call(this,c),p=null!=u?u:+e.call(this,c),g=+n.call(this,c),v=+i.call(this,c),y=Math.min(g,v)/2,m=wt(+r.call(this,c),0,y),_=wt(+s.call(this,c),0,y),x=wt(+o.call(this,c),0,y),k=wt(+a.call(this,c),0,y);if(l||(l=d=O()),m<=0&&_<=0&&x<=0&&k<=0)l.rect(f,p,g,v);else{var b=f+g,w=p+v;l.moveTo(f+m,p),l.lineTo(b-_,p),l.bezierCurveTo(b-yt*_,p,b,p+yt*_,b,p+_),l.lineTo(b,w-k),l.bezierCurveTo(b,w-yt*k,b-yt*k,w,b-k,w),l.lineTo(f+x,w),l.bezierCurveTo(f+yt*x,w,f,w-yt*x,f,w-x),l.lineTo(f,p+m),l.bezierCurveTo(f,p+yt*m,f+yt*m,p,f+m,p),l.closePath()}if(d)return l=null,d+""||null}return c.x=function(e){return arguments.length?(t=bt(e),c):t},c.y=function(t){return arguments.length?(e=bt(t),c):e},c.width=function(t){return arguments.length?(n=bt(t),c):n},c.height=function(t){return arguments.length?(i=bt(t),c):i},c.cornerRadius=function(t,e,n,i){return arguments.length?(r=bt(t),s=null!=e?bt(e):r,a=null!=n?bt(n):r,o=null!=i?bt(i):s,c):r},c.context=function(t){return arguments.length?(l=null==t?null:t,c):l},c}function Mt(){var t,e,n,i,r,s,o,a,l=null;function c(t,e,n){const i=n/2;if(r){var c=o-e,h=t-s;if(c||h){var u=Math.hypot(c,h),d=(c/=u)*a,f=(h/=u)*a,p=Math.atan2(h,c);l.moveTo(s-d,o-f),l.lineTo(t-c*i,e-h*i),l.arc(t,e,i,p-Math.PI,p),l.lineTo(s+d,o+f),l.arc(s,o,a,p,p+Math.PI)}else l.arc(t,e,i,0,it);l.closePath()}else r=1;s=t,o=e,a=i}function h(s){var o,a,h,u=s.length,d=!1;for(null==l&&(l=h=O()),o=0;o<=u;++o)!(o<u&&i(a=s[o],o,s))===d&&(d=!d)&&(r=0),d&&c(+t(a,o,s),+e(a,o,s),+n(a,o,s));if(h)return l=null,h+""||null}return h.x=function(e){return arguments.length?(t=e,h):t},h.y=function(t){return arguments.length?(e=t,h):e},h.size=function(t){return arguments.length?(n=t,h):n},h.defined=function(t){return arguments.length?(i=t,h):i},h.context=function(t){return arguments.length?(l=null==t?null:t,h):l},h}function zt(t,e){return null!=t?t:e}const Rt=t=>t.x||0,At=t=>t.y||0,Ct=t=>!(!1===t.defined),Pt=f().startAngle((t=>t.startAngle||0)).endAngle((t=>t.endAngle||0)).padAngle((t=>t.padAngle||0)).innerRadius((t=>t.innerRadius||0)).outerRadius((t=>t.outerRadius||0)).cornerRadius((t=>t.cornerRadius||0)),Lt=p().x(Rt).y1(At).y0((t=>(t.y||0)+(t.height||0))).defined(Ct),Et=p().y(At).x1(Rt).x0((t=>(t.x||0)+(t.width||0))).defined(Ct),St=g().x(Rt).y(At).defined(Ct),Nt=Tt().x(Rt).y(At).width((t=>t.width||0)).height((t=>t.height||0)).cornerRadius((t=>zt(t.cornerRadiusTopLeft,t.cornerRadius)||0),(t=>zt(t.cornerRadiusTopRight,t.cornerRadius)||0),(t=>zt(t.cornerRadiusBottomRight,t.cornerRadius)||0),(t=>zt(t.cornerRadiusBottomLeft,t.cornerRadius)||0)),Ot=v().type((t=>gt(t.shape||"circle"))).size((t=>zt(t.size,64))),Dt=Mt().x(Rt).y(At).defined(Ct).size((t=>t.size||1));function It(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function qt(t,e,n,i){return Nt.context(t)(e,n,i)}var $t=1;function Vt(t,e,n){var i=e.clip,r=t._defs,s=e.clip_id||(e.clip_id="clip"+$t++),o=r.clipping[s]||(r.clipping[s]={id:s});return a(i)?o.path=i(null):It(n)?o.path=qt(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+s+")"}function Bt(t){this.clear(),t&&this.union(t)}function Ht(t){this.mark=t,this.bounds=this.bounds||new Bt}function Wt(t){Ht.call(this,t),this.items=this.items||[]}Bt.prototype={clone(){return new Bt(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},set(t,e,n,i){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),i<e?(this.y2=e,this.y1=i):(this.y1=e,this.y2=i),this},add(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},expand(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},translate(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},rotate(t,e,n){const i=this.rotatedPoints(t,e,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(t,e,n){var{x1:i,y1:r,x2:s,y2:o}=this,a=Math.cos(t),l=Math.sin(t),c=e-e*a+n*l,h=n-e*l-n*a;return[a*i-l*r+c,l*i+a*r+h,a*i-l*o+c,l*i+a*o+h,a*s-l*r+c,l*s+a*r+h,a*s-l*o+c,l*s+a*o+h]},union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},alignsWith(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},contains(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},t(Wt,Ht);class jt{constructor(t){this._pending=0,this._loader=t||q()}pending(){return this._pending}sanitizeURL(t){const e=this;return Ut(e),e._loader.sanitize(t,{context:"href"}).then((t=>(Xt(e),t))).catch((()=>(Xt(e),null)))}loadImage(t){const e=this,n=I();return Ut(e),e._loader.sanitize(t,{context:"image"}).then((t=>{const r=t.href;if(!r||!n)throw{url:r};const s=new n,o=i(t,"crossOrigin")?t.crossOrigin:"anonymous";return null!=o&&(s.crossOrigin=o),s.onload=()=>Xt(e),s.onerror=()=>Xt(e),s.src=r,s})).catch((t=>(Xt(e),{complete:!1,width:0,height:0,src:t&&t.url||""})))}ready(){const t=this;return new Promise((e=>{!function n(i){t.pending()?setTimeout((()=>{n(!0)}),10):e(i)}(!1)}))}}function Ut(t){t._pending+=1}function Xt(t){t._pending-=1}function Gt(t,e,n){if(e.stroke&&0!==e.opacity&&0!==e.strokeOpacity){const i=null!=e.strokeWidth?+e.strokeWidth:1;t.expand(i+(n?function(t,e){return t.strokeJoin&&"miter"!==t.strokeJoin?0:e}(e,i):0))}return t}const Yt=it-1e-8;let Jt,Ft,Qt,Zt,Kt,te,ee,ne;const ie=(t,e)=>Jt.add(t,e),re=(t,e)=>ie(Ft=t,Qt=e),se=t=>ie(t,Jt.y1),oe=t=>ie(Jt.x1,t),ae=(t,e)=>Kt*t+ee*e,le=(t,e)=>te*t+ne*e,ce=(t,e)=>ie(ae(t,e),le(t,e)),he=(t,e)=>re(ae(t,e),le(t,e));function ue(t,e){return Jt=t,e?(Zt=e*et,Kt=ne=Math.cos(Zt),te=Math.sin(Zt),ee=-te):(Kt=ne=1,Zt=te=ee=0),de}const de={beginPath(){},closePath(){},moveTo:he,lineTo:he,rect(t,e,n,i){Zt?(ce(t+n,e),ce(t+n,e+i),ce(t,e+i),he(t,e)):(ie(t+n,e+i),re(t,e))},quadraticCurveTo(t,e,n,i){const r=ae(t,e),s=le(t,e),o=ae(n,i),a=le(n,i);fe(Ft,r,o,se),fe(Qt,s,a,oe),re(o,a)},bezierCurveTo(t,e,n,i,r,s){const o=ae(t,e),a=le(t,e),l=ae(n,i),c=le(n,i),h=ae(r,s),u=le(r,s);pe(Ft,o,l,h,se),pe(Qt,a,c,u,oe),re(h,u)},arc(t,e,n,i,r,s){if(i+=Zt,r+=Zt,Ft=n*Math.cos(r)+t,Qt=n*Math.sin(r)+e,Math.abs(r-i)>Yt)ie(t-n,e-n),ie(t+n,e+n);else{const o=i=>ie(n*Math.cos(i)+t,n*Math.sin(i)+e);let a,l;if(o(i),o(r),r!==i)if((i%=it)<0&&(i+=it),(r%=it)<0&&(r+=it),r<i&&(s=!s,a=i,i=r,r=a),s)for(r-=it,a=i-i%nt,l=0;l<4&&a>r;++l,a-=nt)o(a);else for(a=i-i%nt+nt,l=0;l<4&&a<r;++l,a+=nt)o(a)}}};function fe(t,e,n,i){const r=(t-e)/(t+n-2*e);0<r&&r<1&&i(t+(e-t)*r)}function pe(t,e,n,i,r){const s=i-t+3*e-3*n,o=t+n-2*e,a=t-e;let l,c=0,h=0;Math.abs(s)>1e-14?(l=o*o+a*s,l>=0&&(l=Math.sqrt(l),c=(-o+l)/s,h=(-o-l)/s)):c=.5*a/o,0<c&&c<1&&r(ge(c,t,e,n,i)),0<h&&h<1&&r(ge(h,t,e,n,i))}function ge(t,e,n,i,r){const s=1-t,o=s*s,a=t*t;return o*s*e+3*o*t*n+3*s*a*i+a*t*r}var ve=(ve=D(1,1))?ve.getContext("2d"):null;const ye=new Bt;function me(t){return function(e,n){if(!ve)return!0;t(ve,e),ye.clear().union(e.bounds).intersect(n).round();const{x1:i,y1:r,x2:s,y2:o}=ye;for(let t=r;t<=o;++t)for(let e=i;e<=s;++e)if(ve.isPointInPath(e,t))return!0;return!1}}function _e(t,e){return e.contains(t.x||0,t.y||0)}function xe(t,e){const n=t.x||0,i=t.y||0,r=t.width||0,s=t.height||0;return e.intersects(ye.set(n,i,n+r,i+s))}function ke(t,e){const n=t.x||0,i=t.y||0;return be(e,n,i,null!=t.x2?t.x2:n,null!=t.y2?t.y2:i)}function be(t,e,n,i,r){const{x1:s,y1:o,x2:a,y2:l}=t,c=i-e,h=r-n;let u,d,f,p,g=0,v=1;for(p=0;p<4;++p){if(0===p&&(u=-c,d=-(s-e)),1===p&&(u=c,d=a-e),2===p&&(u=-h,d=-(o-n)),3===p&&(u=h,d=l-n),Math.abs(u)<1e-10&&d<0)return!1;if(f=d/u,u<0){if(f>v)return!1;f>g&&(g=f)}else if(u>0){if(f<g)return!1;f<v&&(v=f)}}return!0}function we(t,e){t.globalCompositeOperation=e.blend||"source-over"}function Te(t,e){return null==t?e:t}function Me(t,e){const n=e.length;for(let i=0;i<n;++i)t.addColorStop(e[i].offset,e[i].color);return t}function ze(t,e,n){const i=n.width(),r=n.height();let s;if("radial"===e.gradient)s=t.createRadialGradient(n.x1+Te(e.x1,.5)*i,n.y1+Te(e.y1,.5)*r,Math.max(i,r)*Te(e.r1,0),n.x1+Te(e.x2,.5)*i,n.y1+Te(e.y2,.5)*r,Math.max(i,r)*Te(e.r2,.5));else{const o=Te(e.x1,0),a=Te(e.y1,0),l=Te(e.x2,1),c=Te(e.y2,0);if(o!==l&&a!==c&&i!==r){const n=D(Math.ceil(i),Math.ceil(r)),s=n.getContext("2d");return s.scale(i,r),s.fillStyle=Me(s.createLinearGradient(o,a,l,c),e.stops),s.fillRect(0,0,i,r),t.createPattern(n,"no-repeat")}s=t.createLinearGradient(n.x1+o*i,n.y1+a*r,n.x1+l*i,n.y1+c*r)}return Me(s,e.stops)}function Re(t,e,n){return W(n)?ze(t,n,e.bounds):n}function Ae(t,e,n){return(n*=null==e.fillOpacity?1:e.fillOpacity)>0&&(t.globalAlpha=n,t.fillStyle=Re(t,e,e.fill),!0)}var Ce=[];function Pe(t,e,n){var i=null!=(i=e.strokeWidth)?i:1;return!(i<=0)&&((n*=null==e.strokeOpacity?1:e.strokeOpacity)>0&&(t.globalAlpha=n,t.strokeStyle=Re(t,e,e.stroke),t.lineWidth=i,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||Ce),t.lineDashOffset=e.strokeDashOffset||0),!0))}function Le(t,e){return t.zindex-e.zindex||t.index-e.index}function Ee(t){if(!t.zdirty)return t.zitems;var e,n,i,r=t.items,s=[];for(n=0,i=r.length;n<i;++n)(e=r[n]).index=n,e.zindex&&s.push(e);return t.zdirty=!1,t.zitems=s.sort(Le)}function Se(t,e){var n,i,r=t.items;if(!r||!r.length)return;const s=Ee(t);if(s&&s.length){for(n=0,i=r.length;n<i;++n)r[n].zindex||e(r[n]);r=s}for(n=0,i=r.length;n<i;++n)e(r[n])}function Ne(t,e){var n,i,r=t.items;if(!r||!r.length)return null;const s=Ee(t);for(s&&s.length&&(r=s),i=r.length;--i>=0;)if(n=e(r[i]))return n;if(r===s)for(i=(r=t.items).length;--i>=0;)if(!r[i].zindex&&(n=e(r[i])))return n;return null}function Oe(t){return function(e,n,i){Se(n,(n=>{i&&!i.intersects(n.bounds)||Ie(t,e,n,n)}))}}function De(t){return function(e,n,i){!n.items.length||i&&!i.intersects(n.bounds)||Ie(t,e,n.items[0],n.items)}}function Ie(t,e,n,i){var r=null==n.opacity?1:n.opacity;0!==r&&(t(e,i)||(we(e,n),n.fill&&Ae(e,n,r)&&e.fill(),n.stroke&&Pe(e,n,r)&&e.stroke()))}function qe(t){return t=t||h,function(e,n,i,r,s,o){return i*=e.pixelRatio,r*=e.pixelRatio,Ne(n,(n=>{const a=n.bounds;if((!a||a.contains(s,o))&&a)return t(e,n,i,r,s,o)?n:void 0}))}}function $e(t,e){return function(n,i,r,s){var o,a,l=Array.isArray(i)?i[0]:i,c=null==e?l.fill:e,h=l.stroke&&n.isPointInStroke;return h&&(o=l.strokeWidth,a=l.strokeCap,n.lineWidth=null!=o?o:1,n.lineCap=null!=a?a:"butt"),!t(n,i)&&(c&&n.isPointInPath(r,s)||h&&n.isPointInStroke(r,s))}}function Ve(t){return qe($e(t))}function Be(t,e){return"translate("+t+","+e+")"}function He(t){return"rotate("+t+")"}function We(t){return Be(t.x||0,t.y||0)}function je(t,e,n){function i(t,n){var i=n.x||0,r=n.y||0,s=n.angle||0;t.translate(i,r),s&&t.rotate(s*=et),t.beginPath(),e(t,n),s&&t.rotate(-s),t.translate(-i,-r)}return{type:t,tag:"path",nested:!1,attr:function(t,n){t("transform",function(t){return Be(t.x||0,t.y||0)+(t.angle?" "+He(t.angle):"")}(n)),t("d",e(null,n))},bound:function(t,n){return e(ue(t,n.angle),n),Gt(t,n).translate(n.x||0,n.y||0)},draw:Oe(i),pick:Ve(i),isect:n||me(i)}}var Ue=je("arc",(function(t,e){return Pt.context(t)(e)}));function Xe(t,e,n){function i(t,n){t.beginPath(),e(t,n)}const r=$e(i);return{type:t,tag:"path",nested:!0,attr:function(t,n){var i=n.mark.items;i.length&&t("d",e(null,i))},bound:function(t,n){var i=n.items;return 0===i.length?t:(e(ue(t),i),Gt(t,i[0]))},draw:De(i),pick:function(t,e,n,i,s,o){var a=e.items,l=e.bounds;return!a||!a.length||l&&!l.contains(s,o)?null:(n*=t.pixelRatio,i*=t.pixelRatio,r(t,a,n,i)?a[0]:null)},isect:_e,tip:n}}var Ge=Xe("area",(function(t,e){const n=e[0],i=n.interpolate||"linear";return("horizontal"===n.orient?Et:Lt).curve(Y(i,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,i,r="horizontal"===t[0].orient?e[1]:e[0],s="horizontal"===t[0].orient?"y":"x",o=t.length,a=1/0;--o>=0;)!1!==t[o].defined&&(i=Math.abs(t[o][s]-r))<a&&(a=i,n=t[o]);return n}));function Ye(t,e){t.beginPath(),It(e)?qt(t,e,0,0):t.rect(0,0,e.width||0,e.height||0),t.clip()}function Je(t){const e=Te(t.strokeWidth,1);return null!=t.strokeOffset?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function Fe(t,e){const n=Je(e);t("d",qt(null,e,n,n))}function Qe(t,e,n,i){const r=Je(e);t.beginPath(),qt(t,e,(n||0)+r,(i||0)+r)}const Ze=$e(Qe),Ke=$e(Qe,!1),tn=$e(Qe,!0);var en={type:"group",tag:"g",nested:!1,attr:function(t,e){t("transform",We(e))},bound:function(t,e){if(!e.clip&&e.items){const n=e.items,i=n.length;for(let e=0;e<i;++e)t.union(n[e].bounds)}return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),Gt(t,e),t.translate(e.x||0,e.y||0)},draw:function(t,e,n,i){Se(e,(e=>{const r=e.x||0,s=e.y||0,o=e.strokeForeground,a=null==e.opacity?1:e.opacity;(e.stroke||e.fill)&&a&&(Qe(t,e,r,s),we(t,e),e.fill&&Ae(t,e,a)&&t.fill(),e.stroke&&!o&&Pe(t,e,a)&&t.stroke()),t.save(),t.translate(r,s),e.clip&&Ye(t,e),n&&n.translate(-r,-s),Se(e,(e=>{("group"===e.marktype||null==i||i.includes(e.marktype))&&this.draw(t,e,n,i)})),n&&n.translate(r,s),t.restore(),o&&e.stroke&&a&&(Qe(t,e,r,s),we(t,e),Pe(t,e,a)&&t.stroke())}))},pick:function(t,e,n,i,r,s){if(e.bounds&&!e.bounds.contains(r,s)||!e.items)return null;const o=n*t.pixelRatio,a=i*t.pixelRatio;return Ne(e,(l=>{let c,h,u;const d=l.bounds;if(d&&!d.contains(r,s))return;h=l.x||0,u=l.y||0;const f=h+(l.width||0),p=u+(l.height||0),g=l.clip;if(g&&(r<h||r>f||s<u||s>p))return;if(t.save(),t.translate(h,u),h=r-h,u=s-u,g&&It(l)&&!tn(t,l,o,a))return t.restore(),null;const v=l.strokeForeground,y=!1!==e.interactive;return y&&v&&l.stroke&&Ke(t,l,o,a)?(t.restore(),l):(c=Ne(l,(t=>function(t,e,n){return(!1!==t.interactive||"group"===t.marktype)&&t.bounds&&t.bounds.contains(e,n)}(t,h,u)?this.pick(t,n,i,h,u):null)),!c&&y&&(l.fill||!v&&l.stroke)&&Ze(t,l,o,a)&&(c=l),t.restore(),c||null)}))},isect:xe,content:function(t,e,n){t("clip-path",e.clip?Vt(n,e,e):null)},background:function(t,e){t("class","background"),t("aria-hidden",!0),Fe(t,e)},foreground:function(t,e){t("class","foreground"),t("aria-hidden",!0),e.strokeForeground?Fe(t,e):t("d","")}},nn={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function rn(t,e){var n=t.image;return(!n||t.url&&t.url!==n.url)&&(n={complete:!1,width:0,height:0},e.loadImage(t.url).then((e=>{t.image=e,t.image.url=t.url}))),n}function sn(t,e){return null!=t.width?t.width:e&&e.width?!1!==t.aspect&&t.height?t.height*e.width/e.height:e.width:0}function on(t,e){return null!=t.height?t.height:e&&e.height?!1!==t.aspect&&t.width?t.width*e.height/e.width:e.height:0}function an(t,e){return"center"===t?e/2:"right"===t?e:0}function ln(t,e){return"middle"===t?e/2:"bottom"===t?e:0}var cn={type:"image",tag:"image",nested:!1,attr:function(t,e,n){const i=rn(e,n),r=sn(e,i),s=on(e,i),o=(e.x||0)-an(e.align,r),a=(e.y||0)-ln(e.baseline,s);t("href",!i.src&&i.toDataURL?i.toDataURL():i.src||"",nn["xmlns:xlink"],"xlink:href"),t("transform",Be(o,a)),t("width",r),t("height",s),t("preserveAspectRatio",!1===e.aspect?"none":"xMidYMid")},bound:function(t,e){const n=e.image,i=sn(e,n),r=on(e,n),s=(e.x||0)-an(e.align,i),o=(e.y||0)-ln(e.baseline,r);return t.set(s,o,s+i,o+r)},draw:function(t,e,n){Se(e,(e=>{if(n&&!n.intersects(e.bounds))return;const i=rn(e,this);let r=sn(e,i),s=on(e,i);if(0===r||0===s)return;let o,a,l,c,h=(e.x||0)-an(e.align,r),u=(e.y||0)-ln(e.baseline,s);!1!==e.aspect&&(a=i.width/i.height,l=e.width/e.height,a==a&&l==l&&a!==l&&(l<a?(c=r/a,u+=(s-c)/2,s=c):(c=s*a,h+=(r-c)/2,r=c))),(i.complete||i.toDataURL)&&(we(t,e),t.globalAlpha=null!=(o=e.opacity)?o:1,t.imageSmoothingEnabled=!1!==e.smooth,t.drawImage(i,h,u,r,s))}))},pick:qe(),isect:h,get:rn,xOffset:an,yOffset:ln},hn=Xe("line",(function(t,e){const n=e[0],i=n.interpolate||"linear";return St.curve(Y(i,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,i,r=Math.pow(t[0].strokeWidth||1,2),s=t.length;--s>=0;)if(!1!==t[s].defined&&(n=t[s].x-e[0])*n+(i=t[s].y-e[1])*i<r)return t[s];return null}));function un(t,e){var n=e.path;if(null==n)return!0;var i=e.x||0,r=e.y||0,s=e.scaleX||1,o=e.scaleY||1,a=(e.angle||0)*et,l=e.pathCache;l&&l.path===n||((e.pathCache=l=tt(n)).path=n),a&&t.rotate&&t.translate?(t.translate(i,r),t.rotate(a),ut(t,l,0,0,s,o),t.rotate(-a),t.translate(-i,-r)):ut(t,l,i,r,s,o)}var dn={type:"path",tag:"path",nested:!1,attr:function(t,e){var n=e.scaleX||1,i=e.scaleY||1;1===n&&1===i||t("vector-effect","non-scaling-stroke"),t("transform",function(t){return Be(t.x||0,t.y||0)+(t.angle?" "+He(t.angle):"")+(t.scaleX||t.scaleY?" "+(e=t.scaleX||1,n=t.scaleY||1,"scale("+e+","+n+")"):"");var e,n}(e)),t("d",e.path)},bound:function(t,e){return un(ue(t,e.angle),e)?t.set(0,0,0,0):Gt(t,e,!0)},draw:Oe(un),pick:Ve(un),isect:me(un)};function fn(t,e){t.beginPath(),qt(t,e)}var pn={type:"rect",tag:"path",nested:!1,attr:function(t,e){t("d",qt(null,e))},bound:function(t,e){var n,i;return Gt(t.set(n=e.x||0,i=e.y||0,n+e.width||0,i+e.height||0),e)},draw:Oe(fn),pick:Ve(fn),isect:xe};function gn(t,e,n){var i,r,s,o;return!(!e.stroke||!Pe(t,e,n))&&(i=e.x||0,r=e.y||0,s=null!=e.x2?e.x2:i,o=null!=e.y2?e.y2:r,t.beginPath(),t.moveTo(i,r),t.lineTo(s,o),!0)}var vn={type:"rule",tag:"line",nested:!1,attr:function(t,e){t("transform",We(e)),t("x2",null!=e.x2?e.x2-(e.x||0):0),t("y2",null!=e.y2?e.y2-(e.y||0):0)},bound:function(t,e){var n,i;return Gt(t.set(n=e.x||0,i=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:i),e)},draw:function(t,e,n){Se(e,(e=>{if(!n||n.intersects(e.bounds)){var i=null==e.opacity?1:e.opacity;i&&gn(t,e,i)&&(we(t,e),t.stroke())}}))},pick:qe((function(t,e,n,i){return!!t.isPointInStroke&&(gn(t,e,1)&&t.isPointInStroke(n,i))})),isect:ke},yn=je("shape",(function(t,e){return(e.mark.shape||e.shape).context(t)(e)})),mn=je("symbol",(function(t,e){return Ot.context(t)(e)}),_e);const _n=e();var xn={height:zn,measureWidth:Tn,estimateWidth:bn,width:bn,canvas:kn};function kn(t){xn.width=t&&ve?Tn:bn}function bn(t,e){return wn(Pn(t,e),zn(t))}function wn(t,e){return~~(.8*t.length*e)}function Tn(t,e){return zn(t)<=0||!(e=Pn(t,e))?0:Mn(e,En(t))}function Mn(t,e){const n=`(${e}) ${t}`;let i=_n.get(n);return void 0===i&&(ve.font=e,i=ve.measureText(t).width,_n.set(n,i)),i}function zn(t){return null!=t.fontSize?+t.fontSize||0:11}function Rn(t){return null!=t.lineHeight?t.lineHeight:zn(t)+2}function An(t){return e=t.lineBreak&&t.text&&!r(t.text)?t.text.split(t.lineBreak):t.text,r(e)?e.length>1?e:e[0]:e;var e}function Cn(t){const e=An(t);return(r(e)?e.length-1:0)*Rn(t)}function Pn(t,e){const n=null==e?"":(e+"").trim();return t.limit>0&&n.length?function(t,e){var n=+t.limit,i=function(t){if(xn.width===Tn){const e=En(t);return t=>Mn(t,e)}if(xn.width===bn){const e=zn(t);return t=>wn(t,e)}return e=>xn.width(t,e)}(t);if(i(e)<n)return e;var r,s=t.ellipsis||"…",o="rtl"===t.dir,a=0,l=e.length;if(n-=i(s),o){for(;a<l;)r=a+l>>>1,i(e.slice(r))>n?a=r+1:l=r;return s+e.slice(a)}for(;a<l;)r=1+(a+l>>>1),i(e.slice(0,r))<n?a=r:l=r-1;return e.slice(0,a)+s}(t,n):n}function Ln(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function En(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+zn(t)+"px "+Ln(t,e)}function Sn(t){var e=t.baseline,n=zn(t);return Math.round("top"===e?.79*n:"middle"===e?.3*n:"bottom"===e?-.21*n:"line-top"===e?.29*n+.5*Rn(t):"line-bottom"===e?.29*n-.5*Rn(t):0)}kn(!0);const Nn={left:"start",center:"middle",right:"end"},On=new Bt;function Dn(t){var e,n=t.x||0,i=t.y||0,r=t.radius||0;return r&&(e=(t.theta||0)-nt,n+=r*Math.cos(e),i+=r*Math.sin(e)),On.x1=n,On.y1=i,On}function In(t,e,n){var i,s=xn.height(e),o=e.align,a=Dn(e),l=a.x1,c=a.y1,h=e.dx||0,u=(e.dy||0)+Sn(e)-Math.round(.8*s),d=An(e);if(r(d)?(s+=Rn(e)*(d.length-1),i=d.reduce(((t,n)=>Math.max(t,xn.width(e,n))),0)):i=xn.width(e,d),"center"===o?h-=i/2:"right"===o&&(h-=i),t.set(h+=l,u+=c,h+i,u+s),e.angle&&!n)t.rotate(e.angle*et,l,c);else if(2===n)return t.rotatedPoints(e.angle*et,l,c);return t}var qn={type:"text",tag:"text",nested:!1,attr:function(t,e){var n,i=e.dx||0,r=(e.dy||0)+Sn(e),s=Dn(e),o=s.x1,a=s.y1,l=e.angle||0;t("text-anchor",Nn[e.align]||"start"),l?(n=Be(o,a)+" "+He(l),(i||r)&&(n+=" "+Be(i,r))):n=Be(o+i,a+r),t("transform",n)},bound:In,draw:function(t,e,n){Se(e,(e=>{var i,s,o,a,l,c,h,u=null==e.opacity?1:e.opacity;if(!(n&&!n.intersects(e.bounds)||0===u||e.fontSize<=0||null==e.text||0===e.text.length)){if(t.font=En(e),t.textAlign=e.align||"left",s=(i=Dn(e)).x1,o=i.y1,e.angle&&(t.save(),t.translate(s,o),t.rotate(e.angle*et),s=o=0),s+=e.dx||0,o+=(e.dy||0)+Sn(e),c=An(e),we(t,e),r(c))for(l=Rn(e),a=0;a<c.length;++a)h=Pn(e,c[a]),e.fill&&Ae(t,e,u)&&t.fillText(h,s,o),e.stroke&&Pe(t,e,u)&&t.strokeText(h,s,o),o+=l;else h=Pn(e,c),e.fill&&Ae(t,e,u)&&t.fillText(h,s,o),e.stroke&&Pe(t,e,u)&&t.strokeText(h,s,o);e.angle&&t.restore()}}))},pick:qe((function(t,e,n,i,r,s){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var o=Dn(e),a=o.x1,l=o.y1,c=In(On,e,1),h=-e.angle*et,u=Math.cos(h),d=Math.sin(h),f=u*r-d*s+(a-u*a+d*l),p=d*r+u*s+(l-d*a-u*l);return c.contains(f,p)})),isect:function(t,e){const n=In(On,t,2);return be(e,n[0],n[1],n[2],n[3])||be(e,n[0],n[1],n[4],n[5])||be(e,n[4],n[5],n[6],n[7])||be(e,n[2],n[3],n[6],n[7])}},$n=Xe("trail",(function(t,e){return Dt.context(t)(e)}),(function(t,e){for(var n,i,r=t.length;--r>=0;)if(!1!==t[r].defined&&(n=t[r].x-e[0])*n+(i=t[r].y-e[1])*i<(n=t[r].size||1)*n)return t[r];return null})),Vn={arc:Ue,area:Ge,group:en,image:cn,line:hn,path:dn,rect:pn,rule:vn,shape:yn,symbol:mn,text:qn,trail:$n};function Bn(t,e,n){var i=Vn[t.mark.marktype],r=e||i.bound;return i.nested&&(t=t.mark),r(t.bounds||(t.bounds=new Bt),t,n)}var Hn={mark:null};function Wn(t,e,n){var i,r,s,o,a=Vn[t.marktype],l=a.bound,c=t.items,h=c&&c.length;if(a.nested)return h?s=c[0]:(Hn.mark=t,s=Hn),o=Bn(s,l,n),e=e&&e.union(o)||o;if(e=e||t.bounds&&t.bounds.clear()||new Bt,h)for(i=0,r=c.length;i<r;++i)e.union(Bn(c[i],l,n));return t.bounds=e}const jn=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Un(t,e){return JSON.stringify(t,jn,e)}function Xn(t){return Gn("string"==typeof t?JSON.parse(t):t)}function Gn(t){var e,n,i,r=t.marktype,s=t.items;if(s)for(n=0,i=s.length;n<i;++n)e=r?"mark":"group",s[n][e]=t,s[n].zindex&&(s[n][e].zdirty=!0),"group"===(r||e)&&Gn(s[n]);return r&&Wn(t),t}class Yn{constructor(t){arguments.length?this.root=Xn(t):(this.root=Jn({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Wt(this.root)])}toJSON(t){return Un(this.root,t||0)}mark(t,e,n){const i=Jn(t,e=e||this.root.items[0]);return e.items[n]=i,i.zindex&&(i.group.zdirty=!0),i}}function Jn(t,e){const n={bounds:new Bt,clip:!!t.clip,group:e,interactive:!1!==t.interactive,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return null!=t.aria&&(n.aria=t.aria),t.description&&(n.description=t.description),n}function Fn(t,e,n){return!t&&"undefined"!=typeof document&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function Qn(t,e){e=e.toLowerCase();for(var n=t.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===e)return n[i]}function Zn(t,e,n,i){var r,s=t.childNodes[e];return s&&s.tagName.toLowerCase()===n.toLowerCase()||(r=s||null,s=Fn(t.ownerDocument,n,i),t.insertBefore(s,r)),s}function Kn(t,e){for(var n=t.childNodes,i=n.length;i>e;)t.removeChild(n[--i]);return t}function ti(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function ei(t,e){const n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]}class ni{constructor(t,e){this._active=null,this._handlers={},this._loader=t||q(),this._tooltip=e||ii}initialize(t,e,n){return this._el=t,this._obj=n||null,this.origin(e)}element(){return this._el}canvas(){return this._el&&this._el.firstChild}origin(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()}scene(t){return arguments.length?(this._scene=t,this):this._scene}on(){}off(){}_handlerIndex(t,e,n){for(let i=t?t.length:0;--i>=0;)if(t[i].type===e&&(!n||t[i].handler===n))return i;return-1}handlers(t){const e=this._handlers,n=[];if(t)n.push(...e[this.eventName(t)]);else for(const t in e)n.push(...e[t]);return n}eventName(t){const e=t.indexOf(".");return e<0?t:t.slice(0,e)}handleHref(t,e,n){this._loader.sanitize(n,{context:"href"}).then((e=>{const n=new MouseEvent(t.type,t),i=Fn(null,"a");for(const t in e)i.setAttribute(t,e[t]);i.dispatchEvent(n)})).catch((()=>{}))}handleTooltip(t,e,n){if(e&&null!=e.tooltip){e=function(t,e,n,i){var r,s,o=t&&t.mark;if(o&&(r=Vn[o.marktype]).tip){for((s=ei(e,n))[0]-=i[0],s[1]-=i[1];t=t.mark.group;)s[0]-=t.x||0,s[1]-=t.y||0;t=r.tip(o.items,s)}return t}(e,t,this.canvas(),this._origin);const i=n&&e&&e.tooltip||null;this._tooltip.call(this._obj,this,t,e,i)}}getItemBoundingClientRect(t){const e=this.canvas();if(!e)return;const n=e.getBoundingClientRect(),i=this._origin,r=t.bounds,s=r.width(),o=r.height();let a=r.x1+i[0]+n.left,l=r.y1+i[1]+n.top;for(;t.mark&&(t=t.mark.group);)a+=t.x||0,l+=t.y||0;return{x:a,y:l,width:s,height:o,left:a,top:l,right:a+s,bottom:l+o}}}function ii(t,e,n,i){t.element().setAttribute("title",i||"")}class ri{constructor(t){this._el=null,this._bgcolor=null,this._loader=new jt(t)}initialize(t,e,n,i,r){return this._el=t,this.resize(e,n,i,r)}element(){return this._el}canvas(){return this._el&&this._el.firstChild}background(t){return 0===arguments.length?this._bgcolor:(this._bgcolor=t,this)}resize(t,e,n,i){return this._width=t,this._height=e,this._origin=n||[0,0],this._scale=i||1,this}dirty(){}render(t,e){const n=this;return n._call=function(){n._render(t,e)},n._call(),n._call=null,n}_render(){}renderAsync(t,e){const n=this.render(t,e);return this._ready?this._ready.then((()=>n)):Promise.resolve(n)}_load(t,e){var n=this,i=n._loader[t](e);if(!n._ready){const t=n._call;n._ready=n._loader.ready().then((e=>{e&&t(),n._ready=null}))}return i}sanitizeURL(t){return this._load("sanitizeURL",t)}loadImage(t){return this._load("loadImage",t)}}const si="dragenter",oi="dragleave",ai="dragover",li="pointerdown",ci="pointermove",hi="pointerout",ui="pointerover",di="mousedown",fi="mousemove",pi="mouseout",gi="mouseover",vi="click",yi="mousewheel",mi="touchstart",_i="touchmove",xi="touchend",ki=["keydown","keypress","keyup",si,oi,ai,li,"pointerup",ci,hi,ui,di,"mouseup",fi,pi,gi,vi,"dblclick","wheel",yi,mi,_i,xi],bi=ci,wi=pi,Ti=vi;class Mi extends ni{constructor(t,e){super(t,e),this._down=null,this._touch=null,this._first=!0,this._events={},this.events=ki,this.pointermove=Ci([ci,fi],[ui,gi],[hi,pi]),this.dragover=Ci([ai],[si],[oi]),this.pointerout=Pi([hi,pi]),this.dragleave=Pi([oi])}initialize(t,e,n){return this._canvas=t&&Qn(t,"canvas"),[vi,di,li,ci,hi,oi].forEach((t=>Ri(this,t))),super.initialize(t,e,n)}canvas(){return this._canvas}context(){return this._canvas.getContext("2d")}DOMMouseScroll(t){this.fire(yi,t)}pointerdown(t){this._down=this._active,this.fire(li,t)}mousedown(t){this._down=this._active,this.fire(di,t)}click(t){this._down===this._active&&(this.fire(vi,t),this._down=null)}touchstart(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(mi,t,!0)}touchmove(t){this.fire(_i,t,!0)}touchend(t){this.fire(xi,t,!0),this._touch=null}fire(t,e,n){const i=n?this._touch:this._active,r=this._handlers[t];if(e.vegaType=t,t===Ti&&i&&i.href?this.handleHref(e,i,i.href):t!==bi&&t!==wi||this.handleTooltip(e,i,t!==wi),r)for(let t=0,n=r.length;t<n;++t)r[t].handler.call(this._obj,e,i)}on(t,e){const n=this.eventName(t),i=this._handlers;return this._handlerIndex(i[n],t,e)<0&&(Ri(this,t),(i[n]||(i[n]=[])).push({type:t,handler:e})),this}off(t,e){const n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);return r>=0&&i.splice(r,1),this}pickEvent(t){const e=ei(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])}pick(t,e,n,i,r){const s=this.context();return Vn[t.marktype].pick.call(this,s,t,e,n,i,r)}}const zi=t=>t===mi||t===_i||t===xi?[mi,_i,xi]:[t];function Ri(t,e){zi(e).forEach((e=>function(t,e){const n=t.canvas();n&&!t._events[e]&&(t._events[e]=1,n.addEventListener(e,t[e]?n=>t[e](n):n=>t.fire(e,n)))}(t,e)))}function Ai(t,e,n){e.forEach((e=>t.fire(e,n)))}function Ci(t,e,n){return function(i){const r=this._active,s=this.pickEvent(i);s===r||(r&&r.exit||Ai(this,n,i),this._active=s,Ai(this,e,i)),Ai(this,t,i)}}function Pi(t){return function(e){Ai(this,t,e),this._active=null}}function Li(t,e,n,i,r,s){const o="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,a=t.getContext("2d"),l=o?"undefined"!=typeof window&&window.devicePixelRatio||1:r;t.width=e*l,t.height=n*l;for(const t in s)a[t]=s[t];return o&&1!==l&&(t.style.width=e+"px",t.style.height=n+"px"),a.pixelRatio=l,a.setTransform(l,0,0,l,l*i[0],l*i[1]),t}class Ei extends ri{constructor(t){super(t),this._options={},this._redraw=!1,this._dirty=new Bt,this._tempb=new Bt}initialize(t,e,n,i,r,s){return this._options=s||{},this._canvas=this._options.externalContext?null:D(1,1,this._options.type),t&&this._canvas&&(Kn(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),super.initialize(t,e,n,i,r)}resize(t,e,n,i){if(super.resize(t,e,n,i),this._canvas)Li(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const t=this._options.externalContext;t||s("CanvasRenderer is missing a valid canvas or context"),t.scale(this._scale,this._scale),t.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this}canvas(){return this._canvas}context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)}dirty(t){const e=this._tempb.clear().union(t.bounds);let n=t.mark.group;for(;n;)e.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(e)}_render(t,e){const n=this.context(),i=this._origin,r=this._width,s=this._height,o=this._dirty,a=Si(i,r,s);n.save();const l=this._redraw||o.empty()?(this._redraw=!1,a.expand(1)):function(t,e,n){e.expand(1).round(),t.pixelRatio%1&&e.scale(t.pixelRatio).round().scale(1/t.pixelRatio);return e.translate(-n[0]%1,-n[1]%1),t.beginPath(),t.rect(e.x1,e.y1,e.width(),e.height()),t.clip(),e}(n,a.intersect(o),i);return this.clear(-i[0],-i[1],r,s),this.draw(n,t,l,e),n.restore(),o.clear(),this}draw(t,e,n,i){if("group"!==e.marktype&&null!=i&&!i.includes(e.marktype))return;const r=Vn[e.marktype];e.clip&&function(t,e){var n=e.clip;t.save(),a(n)?(t.beginPath(),n(t),t.clip()):Ye(t,e.group)}(t,e),r.draw.call(this,t,e,n,i),e.clip&&t.restore()}clear(t,e,n,i){const r=this._options,s=this.context();"pdf"===r.type||r.externalContext||s.clearRect(t,e,n,i),null!=this._bgcolor&&(s.fillStyle=this._bgcolor,s.fillRect(t,e,n,i))}}const Si=(t,e,n)=>(new Bt).set(0,0,e,n).translate(-t[0],-t[1]);class Ni extends ni{constructor(t,e){super(t,e);const n=this;n._hrefHandler=Oi(n,((t,e)=>{e&&e.href&&n.handleHref(t,e,e.href)})),n._tooltipHandler=Oi(n,((t,e)=>{n.handleTooltip(t,e,t.type!==wi)}))}initialize(t,e,n){let i=this._svg;return i&&(i.removeEventListener(Ti,this._hrefHandler),i.removeEventListener(bi,this._tooltipHandler),i.removeEventListener(wi,this._tooltipHandler)),this._svg=i=t&&Qn(t,"svg"),i&&(i.addEventListener(Ti,this._hrefHandler),i.addEventListener(bi,this._tooltipHandler),i.addEventListener(wi,this._tooltipHandler)),super.initialize(t,e,n)}canvas(){return this._svg}on(t,e){const n=this.eventName(t),i=this._handlers;if(this._handlerIndex(i[n],t,e)<0){const r={type:t,handler:e,listener:Oi(this,e)};(i[n]||(i[n]=[])).push(r),this._svg&&this._svg.addEventListener(n,r.listener)}return this}off(t,e){const n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this}}const Oi=(t,e)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,e.call(t._obj,n,i)},Di="aria-hidden",Ii="aria-label",qi="role",$i="aria-roledescription",Vi="graphics-object",Bi="graphics-symbol",Hi=(t,e,n)=>({[qi]:t,[$i]:e,[Ii]:n||void 0}),Wi=n(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),ji={axis:{desc:"axis",caption:function(t){const e=t.datum,n=t.orient,i=e.title?Ji(t):null,r=t.context,s=r.scales[e.scale].value,o=r.dataflow.locale(),a=s.type;return("left"===n||"right"===n?"Y":"X")+"-axis"+(i?` titled '${i}'`:"")+` for a ${$(a)?"discrete":a} scale`+` with ${V(o,s,t)}`}},legend:{desc:"legend",caption:function(t){const e=t.datum,n=e.title?Ji(t):null,i=`${e.type||""} legend`.trim(),r=e.scales,s=Object.keys(r),o=t.context,a=o.scales[r[s[0]]].value,l=o.dataflow.locale();return c=i,(c.length?c[0].toUpperCase()+c.slice(1):c)+(n?` titled '${n}'`:"")+` for ${function(t){return t=t.map((t=>t+("fill"===t||"stroke"===t?" color":""))),t.length<2?t[0]:t.slice(0,-1).join(", ")+" and "+d(t)}(s)}`+` with ${V(l,a,t)}`;var c}},"title-text":{desc:"title",caption:t=>`Title text '${Yi(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${Yi(t)}'`}},Ui={ariaRole:qi,ariaRoleDescription:$i,description:Ii};function Xi(t,e){const n=!1===e.aria;if(t(Di,n||void 0),n||null==e.description)for(const e in Ui)t(Ui[e],void 0);else{const n=e.mark.marktype;t(Ii,e.description),t(qi,e.ariaRole||("group"===n?Vi:Bi)),t($i,e.ariaRoleDescription||`${n} mark`)}}function Gi(t){return!1===t.aria?{[Di]:!0}:Wi[t.role]?null:ji[t.role]?function(t,e){try{const n=t.items[0],i=e.caption||(()=>"");return Hi(e.role||Bi,e.desc,n.description||i(n))}catch(t){return null}}(t,ji[t.role]):function(t){const e=t.marktype,n="group"===e||"text"===e||t.items.some((t=>null!=t.description&&!1!==t.aria));return Hi(n?Vi:Bi,`${e} mark container`,t.description)}(t)}function Yi(t){return u(t.text).join(" ")}function Ji(t){try{return u(d(t.items).items[0].text).join(" ")}catch(t){return null}}const Fi=t=>(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function Qi(){let t="",e="",n="";const i=[],r=()=>e=n="",s=(t,n)=>{var i;return null!=n&&(e+=` ${t}="${i=n,Fi(i).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}"`),o},o={open(a){(s=>{e&&(t+=`${e}>${n}`,r()),i.push(s)})(a),e="<"+a;for(var l=arguments.length,c=new Array(l>1?l-1:0),h=1;h<l;h++)c[h-1]=arguments[h];for(const t of c)for(const e in t)s(e,t[e]);return o},close(){const s=i.pop();return t+=e?e+(n?`>${n}</${s}>`:"/>"):`</${s}>`,r(),o},attr:s,text:t=>(n+=Fi(t),o),toString:()=>t};return o}const Zi=t=>Ki(Qi(),t)+"";function Ki(t,e){if(t.open(e.tagName),e.hasAttributes()){const n=e.attributes,i=n.length;for(let e=0;e<i;++e)t.attr(n[e].name,n[e].value)}if(e.hasChildNodes()){const n=e.childNodes;for(const e of n)3===e.nodeType?t.text(e.nodeValue):Ki(t,e)}return t.close()}const tr={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},er={blend:"mix-blend-mode"},nr={fill:"none","stroke-miterlimit":10},ir="http://www.w3.org/2000/xmlns/",rr=nn.xmlns;class sr extends ri{constructor(t){super(t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}initialize(t,e,n,i,r){return this._defs={},this._clearDefs(),t&&(this._svg=Zn(t,0,"svg",rr),this._svg.setAttributeNS(ir,"xmlns",rr),this._svg.setAttributeNS(ir,"xmlns:xlink",nn["xmlns:xlink"]),this._svg.setAttribute("version",nn.version),this._svg.setAttribute("class","marks"),Kn(t,1),this._root=Zn(this._svg,0,"g",rr),gr(this._root,nr),Kn(this._svg,1)),this.background(this._bgcolor),super.initialize(t,e,n,i,r)}background(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),super.background(...arguments)}resize(t,e,n,i){return super.resize(t,e,n,i),this._svg&&(gr(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this}canvas(){return this._svg}svg(){const t=this._svg,e=this._bgcolor;if(!t)return null;let n;e&&(t.removeAttribute("style"),n=Zn(t,0,"rect",rr),gr(n,{width:this._width,height:this._height,fill:e}));const i=Zi(t);return e&&(t.removeChild(n),this._svg.style.setProperty("background-color",e)),i}_render(t,e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,t,void 0,e),Kn(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this}dirty(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))}isDirty(t){return this._dirtyAll||!t._svg||!t._svg.ownerSVGElement||t.dirty===this._dirtyID}_dirtyCheck(){this._dirtyAll=!0;const t=this._dirty;if(!t.length||!this._dirtyID)return!0;const e=++this._dirtyID;let n,i,r,s,o,a,l;for(o=0,a=t.length;o<a;++o)n=t[o],i=n.mark,i.marktype!==r&&(r=i.marktype,s=Vn[r]),i.zdirty&&i.dirty!==e&&(this._dirtyAll=!1,or(n,e),i.items.forEach((t=>{t.dirty=e}))),i.zdirty||(n.exit?(s.nested&&i.items.length?(l=i.items[0],l._svg&&this._update(s,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null):(n=s.nested?i.items[0]:n,n._update!==e&&(n._svg&&n._svg.ownerSVGElement?this._update(s,n._svg,n):(this._dirtyAll=!1,or(n,e)),n._update=e)));return!this._dirtyAll}mark(t,e,n,i){if(!this.isDirty(e))return e._svg;const r=this._svg,s=e.marktype,o=Vn[s],a=!1===e.interactive?"none":null,l="g"===o.tag,c=cr(e,t,n,"g",r);if("group"!==s&&null!=i&&!i.includes(s))return Kn(c,0),e._svg;c.setAttribute("class",ti(e));const h=Gi(e);for(const t in h)vr(c,t,h[t]);l||vr(c,"pointer-events",a),vr(c,"clip-path",e.clip?Vt(this,e,e.group):null);let u=null,d=0;const f=t=>{const e=this.isDirty(t),n=cr(t,c,u,o.tag,r);e&&(this._update(o,n,t),l&&function(t,e,n,i){e=e.lastChild.previousSibling;let r,s=0;Se(n,(n=>{r=t.mark(e,n,r,i),++s})),Kn(e,1+s)}(this,n,t,i)),u=n,++d};return o.nested?e.items.length&&f(e.items[0]):Se(e,f),Kn(c,d),c}_update(t,e,n){hr=e,ur=e.__values__,Xi(fr,n),t.attr(fr,n,this);const i=dr[t.type];i&&i.call(this,t,e,n),hr&&this.style(hr,n)}style(t,e){if(null!=e){for(const n in tr){let i="font"===n?Ln(e):e[n];if(i===ur[n])continue;const r=tr[n];null==i?t.removeAttribute(r):(W(i)&&(i=j(i,this._defs.gradient,yr())),t.setAttribute(r,i+"")),ur[n]=i}for(const n in er)pr(t,er[n],e[n])}}defs(){const t=this._svg,e=this._defs;let n=e.el,i=0;for(const r in e.gradient)n||(e.el=n=Zn(t,1,"defs",rr)),i=ar(n,e.gradient[r],i);for(const r in e.clipping)n||(e.el=n=Zn(t,1,"defs",rr)),i=lr(n,e.clipping[r],i);n&&(0===i?(t.removeChild(n),e.el=null):Kn(n,i))}_clearDefs(){const t=this._defs;t.gradient={},t.clipping={}}}function or(t,e){for(;t&&t.dirty!==e;t=t.mark.group){if(t.dirty=e,!t.mark||t.mark.dirty===e)return;t.mark.dirty=e}}function ar(t,e,n){let i,r,s;if("radial"===e.gradient){let i=Zn(t,n++,"pattern",rr);gr(i,{id:H+e.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),i=Zn(i,0,"rect",rr),gr(i,{width:1,height:1,fill:`url(${yr()}#${e.id})`}),gr(t=Zn(t,n++,"radialGradient",rr),{id:e.id,fx:e.x1,fy:e.y1,fr:e.r1,cx:e.x2,cy:e.y2,r:e.r2})}else gr(t=Zn(t,n++,"linearGradient",rr),{id:e.id,x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2});for(i=0,r=e.stops.length;i<r;++i)s=Zn(t,i,"stop",rr),s.setAttribute("offset",e.stops[i].offset),s.setAttribute("stop-color",e.stops[i].color);return Kn(t,i),n}function lr(t,e,n){let i;return(t=Zn(t,n,"clipPath",rr)).setAttribute("id",e.id),e.path?(i=Zn(t,0,"path",rr),i.setAttribute("d",e.path)):(i=Zn(t,0,"rect",rr),gr(i,{x:0,y:0,width:e.width,height:e.height})),Kn(t,1),n+1}function cr(t,e,n,i,r){let s,o=t._svg;if(!o&&(s=e.ownerDocument,o=Fn(s,i,rr),t._svg=o,t.mark&&(o.__data__=t,o.__values__={fill:"default"},"g"===i))){const e=Fn(s,"path",rr);o.appendChild(e),e.__data__=t;const n=Fn(s,"g",rr);o.appendChild(n),n.__data__=t;const i=Fn(s,"path",rr);o.appendChild(i),i.__data__=t,i.__values__={fill:"default"}}return(o.ownerSVGElement!==r||function(t,e){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=e}(o,n))&&e.insertBefore(o,n?n.nextSibling:e.firstChild),o}let hr=null,ur=null;const dr={group(t,e,n){const i=hr=e.childNodes[2];ur=i.__values__,t.foreground(fr,n,this),ur=e.__values__,hr=e.childNodes[1],t.content(fr,n,this);const r=hr=e.childNodes[0];t.background(fr,n,this);const s=!1===n.mark.interactive?"none":null;if(s!==ur.events&&(vr(i,"pointer-events",s),vr(r,"pointer-events",s),ur.events=s),n.strokeForeground&&n.stroke){const t=n.fill;vr(i,"display",null),this.style(r,n),vr(r,"stroke",null),t&&(n.fill=null),ur=i.__values__,this.style(i,n),t&&(n.fill=t),hr=null}else vr(i,"display","none")},image(t,e,n){!1===n.smooth?(pr(e,"image-rendering","optimizeSpeed"),pr(e,"image-rendering","pixelated")):pr(e,"image-rendering",null)},text(t,e,n){const i=An(n);let s,o,a,l;r(i)?(o=i.map((t=>Pn(n,t))),s=o.join("\n"),s!==ur.text&&(Kn(e,0),a=e.ownerDocument,l=Rn(n),o.forEach(((t,i)=>{const r=Fn(a,"tspan",rr);r.__data__=n,r.textContent=t,i&&(r.setAttribute("x",0),r.setAttribute("dy",l)),e.appendChild(r)})),ur.text=s)):(o=Pn(n,i),o!==ur.text&&(e.textContent=o,ur.text=o)),vr(e,"font-family",Ln(n)),vr(e,"font-size",zn(n)+"px"),vr(e,"font-style",n.fontStyle),vr(e,"font-variant",n.fontVariant),vr(e,"font-weight",n.fontWeight)}};function fr(t,e,n){e!==ur[t]&&(n?function(t,e,n,i){null!=n?t.setAttributeNS(i,e,n):t.removeAttributeNS(i,e)}(hr,t,e,n):vr(hr,t,e),ur[t]=e)}function pr(t,e,n){n!==ur[e]&&(null==n?t.style.removeProperty(e):t.style.setProperty(e,n+""),ur[e]=n)}function gr(t,e){for(const n in e)vr(t,n,e[n])}function vr(t,e,n){null!=n?t.setAttribute(e,n):t.removeAttribute(e)}function yr(){let t;return"undefined"==typeof window?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}class mr extends ri{constructor(t){super(t),this._text=null,this._defs={gradient:{},clipping:{}}}svg(){return this._text}_render(t){const e=Qi();e.open("svg",o({},nn,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&e.open("rect",{width:this._width,height:this._height,fill:n}).close(),e.open("g",nr,{transform:"translate("+this._origin+")"}),this.mark(e,t),e.close(),this.defs(e),this._text=e.close()+"",this}mark(t,e){const n=Vn[e.marktype],i=n.tag,s=[Xi,n.attr];t.open("g",{class:ti(e),"clip-path":e.clip?Vt(this,e,e.group):null},Gi(e),{"pointer-events":"g"!==i&&!1===e.interactive?"none":null});const o=o=>{const a=this.href(o);if(a&&t.open("a",a),t.open(i,this.attr(e,o,s,"g"!==i?i:null)),"text"===i){const e=An(o);if(r(e)){const n={x:0,dy:Rn(o)};for(let i=0;i<e.length;++i)t.open("tspan",i?n:null).text(Pn(o,e[i])).close()}else t.text(Pn(o,e))}else if("g"===i){const i=o.strokeForeground,r=o.fill,s=o.stroke;i&&s&&(o.stroke=null),t.open("path",this.attr(e,o,n.background,"bgrect")).close(),t.open("g",this.attr(e,o,n.content)),Se(o,(e=>this.mark(t,e))),t.close(),i&&s?(r&&(o.fill=null),o.stroke=s,t.open("path",this.attr(e,o,n.foreground,"bgrect")).close(),r&&(o.fill=r)):t.open("path",this.attr(e,o,n.foreground,"bgfore")).close()}t.close(),a&&t.close()};return n.nested?e.items&&e.items.length&&o(e.items[0]):Se(e,o),t.close()}href(t){const e=t.href;let n;if(e){if(n=this._hrefs&&this._hrefs[e])return n;this.sanitizeURL(e).then((t=>{t["xlink:href"]=t.href,t.href=null,(this._hrefs||(this._hrefs={}))[e]=t}))}return null}attr(t,e,n,i){const r={},s=(t,e,n,i)=>{r[i||t]=e};return Array.isArray(n)?n.forEach((t=>t(s,e,this))):n(s,e,this),i&&function(t,e,n,i,r){let s;if(null==e)return t;"bgrect"===i&&!1===n.interactive&&(t["pointer-events"]="none");if("bgfore"===i&&(!1===n.interactive&&(t["pointer-events"]="none"),t.display="none",null!==e.fill))return t;"image"===i&&!1===e.smooth&&(s=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]);"text"===i&&(t["font-family"]=Ln(e),t["font-size"]=zn(e)+"px",t["font-style"]=e.fontStyle,t["font-variant"]=e.fontVariant,t["font-weight"]=e.fontWeight);for(const n in tr){let i=e[n];const s=tr[n];("transparent"!==i||"fill"!==s&&"stroke"!==s)&&null!=i&&(W(i)&&(i=j(i,r.gradient,"")),t[s]=i)}for(const t in er){const n=e[t];null!=n&&(s=s||[],s.push(`${er[t]}: ${n};`))}s&&(t.style=s.join(" "))}(r,e,t,i,this._defs),r}defs(t){const e=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(e).length+Object.keys(n).length){t.open("defs");for(const n in e){const i=e[n],r=i.stops;"radial"===i.gradient?(t.open("pattern",{id:H+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),t.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),t.close(),t.open("radialGradient",{id:n,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):t.open("linearGradient",{id:n,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(let e=0;e<r.length;++e)t.open("stop",{offset:r[e].offset,"stop-color":r[e].color}).close();t.close()}for(const e in n){const i=n[e];t.open("clipPath",{id:e}),i.path?t.open("path",{d:i.path}).close():t.open("rect",{x:0,y:0,width:i.width,height:i.height}).close(),t.close()}t.close()}}}const _r={svgMarkTypes:["text"],svgOnTop:!0,debug:!1};function xr(t){_r.svgMarkTypes=t.svgMarkTypes??["text"],_r.svgOnTop=t.svgOnTop??!0,_r.debug=t.debug??!1}class kr extends ri{constructor(t){super(t),this._svgRenderer=new sr(t),this._canvasRenderer=new Ei(t)}initialize(t,e,n,i,r){this._root_el=Zn(t,0,"div");const s=Zn(this._root_el,0,"div"),o=Zn(this._root_el,1,"div");return this._root_el.style.position="relative",_r.debug||(s.style.height="100%",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.height="100%",o.style.width="100%"),this._svgEl=_r.svgOnTop?o:s,this._canvasEl=_r.svgOnTop?s:o,this._svgEl.style.pointerEvents="none",this._canvasRenderer.initialize(this._canvasEl,e,n,i,r),this._svgRenderer.initialize(this._svgEl,e,n,i,r),super.initialize(t,e,n,i,r)}dirty(t){return _r.svgMarkTypes.includes(t.mark.marktype)?this._svgRenderer.dirty(t):this._canvasRenderer.dirty(t),this}_render(t,e){const n=(e??["arc","area","image","line","path","rect","rule","shape","symbol","text","trail"]).filter((t=>!_r.svgMarkTypes.includes(t)));this._svgRenderer.render(t,_r.svgMarkTypes),this._canvasRenderer.render(t,n)}resize(t,e,n,i){return super.resize(t,e,n,i),this._svgRenderer.resize(t,e,n,i),this._canvasRenderer.resize(t,e,n,i),this}background(t){return _r.svgOnTop?this._canvasRenderer.background(t):this._svgRenderer.background(t),this}}class br extends Mi{constructor(t,e){super(t,e)}initialize(t,e,n){const i=Zn(Zn(t,0,"div"),_r.svgOnTop?0:1,"div");return super.initialize(i,e,n)}}const wr="canvas",Tr="hybrid",Mr="none",zr={Canvas:wr,PNG:"png",SVG:"svg",Hybrid:Tr,None:Mr},Rr={};function Ar(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(Rr[t]=e,this):Rr[t]}function Cr(t,e,n){const i=[],r=(new Bt).union(e),o=t.marktype;return o?Pr(t,r,n,i):"group"===o?Lr(t,r,n,i):s("Intersect scene must be mark node or group item.")}function Pr(t,e,n,i){if(function(t,e,n){return t.bounds&&e.intersects(t.bounds)&&("group"===t.marktype||!1!==t.interactive&&(!n||n(t)))}(t,e,n)){const r=t.items,s=t.marktype,o=r.length;let a=0;if("group"===s)for(;a<o;++a)Lr(r[a],e,n,i);else for(const t=Vn[s].isect;a<o;++a){const n=r[a];Er(n,e,t)&&i.push(n)}}return i}function Lr(t,e,n,i){n&&n(t.mark)&&Er(t,e,Vn.group.isect)&&i.push(t);const r=t.items,s=r&&r.length;if(s){const o=t.x||0,a=t.y||0;e.translate(-o,-a);for(let t=0;t<s;++t)Pr(r[t],e,n,i);e.translate(o,a)}return i}function Er(t,e,n){const i=t.bounds;return e.encloses(i)||e.intersects(i)&&n(t,e)}Rr[wr]=Rr.png={renderer:Ei,headless:Ei,handler:Mi},Rr.svg={renderer:sr,headless:mr,handler:Ni},Rr[Tr]={renderer:kr,headless:kr,handler:br},Rr[Mr]={};const Sr=new Bt;function Nr(t){const e=t.clip;if(a(e))e(ue(Sr.clear()));else{if(!e)return;Sr.set(0,0,t.group.width,t.group.height)}t.bounds.intersect(Sr)}function Or(t,e,n){return t===e||("path"===n?Dr(t,e):t instanceof Date&&e instanceof Date?+t==+e:l(t)&&l(e)?Math.abs(t-e)<=1e-9:t&&e&&(c(t)||c(e))?function(t,e){var n,i,r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(r.sort(),s.sort(),i=r.length-1;i>=0;i--)if(r[i]!=s[i])return!1;for(i=r.length-1;i>=0;i--)if(!Or(t[n=r[i]],e[n],n))return!1;return typeof t==typeof e}(t,e):t==e)}function Dr(t,e){return Or(tt(t),tt(e))}function Ir(){$t=1,B=0}export{Bt as Bounds,Mi as CanvasHandler,Ei as CanvasRenderer,X as Gradient,Wt as GroupItem,ni as Handler,br as HybridHandler,kr as HybridRenderer,Ht as Item,Vn as Marks,zr as RenderType,ri as Renderer,jt as ResourceLoader,Ni as SVGHandler,sr as SVGRenderer,mr as SVGStringRenderer,Yn as Scenegraph,Nr as boundClip,ue as boundContext,Bn as boundItem,Wn as boundMark,Gt as boundStroke,Zn as domChild,Kn as domClear,Fn as domCreate,Qn as domFind,En as font,Ln as fontFamily,zn as fontSize,Cr as intersect,be as intersectBoxLine,me as intersectPath,_e as intersectPoint,ke as intersectRule,Rn as lineHeight,Qi as markup,Cn as multiLineOffset,Y as pathCurves,Dr as pathEqual,tt as pathParse,Tt as pathRectangle,ut as pathRender,gt as pathSymbols,Mt as pathTrail,ei as point,Ar as renderModule,Ir as resetSVGDefIds,Or as sceneEqual,Xn as sceneFromJSON,Ne as scenePickVisit,Un as sceneToJSON,Se as sceneVisit,Ee as sceneZOrder,Zi as serializeXML,xr as setHybridRendererOptions,xn as textMetrics};export default null;
//# sourceMappingURL=/sm/1b9245ecb9985bb27d780a706dd24759d22b2367fe11113378cea269cd6bbee4.map