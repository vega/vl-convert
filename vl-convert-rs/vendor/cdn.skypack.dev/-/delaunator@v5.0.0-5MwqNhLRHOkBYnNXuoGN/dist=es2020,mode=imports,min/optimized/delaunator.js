import{orient2d as X}from"/-/robust-predicates@v3.0.1-4p4J15SSeLeNloSXgtZt/dist=es2020,mode=imports,min/optimized/robust-predicates.js";const F=Math.pow(2,-52),q=new Uint32Array(512);class Y{static from(t,i=Q,l=V){const r=t.length,h=new Float64Array(r*2);for(let n=0;n<r;n++){const o=t[n];h[2*n]=i(o),h[2*n+1]=l(o)}return new Y(h)}constructor(t){const i=t.length>>1;if(i>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const l=Math.max(2*i-5,0);this._triangles=new Uint32Array(l*3),this._halfedges=new Int32Array(l*3),this._hashSize=Math.ceil(Math.sqrt(i)),this._hullPrev=new Uint32Array(i),this._hullNext=new Uint32Array(i),this._hullTri=new Uint32Array(i),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(i),this._dists=new Float64Array(i),this.update()}update(){const{coords:t,_hullPrev:i,_hullNext:l,_hullTri:r,_hullHash:h}=this,n=t.length>>1;let o=Infinity,_=Infinity,f=-Infinity,x=-Infinity;for(let s=0;s<n;s++){const c=t[2*s],g=t[2*s+1];c<o&&(o=c),g<_&&(_=g),c>f&&(f=c),g>x&&(x=g),this._ids[s]=s}const m=(o+f)/2,b=(_+x)/2;let d=Infinity,u,y,p;for(let s=0;s<n;s++){const c=C(m,b,t[2*s],t[2*s+1]);c<d&&(u=s,d=c)}const T=t[2*u],U=t[2*u+1];d=Infinity;for(let s=0;s<n;s++){if(s===u)continue;const c=C(T,U,t[2*s],t[2*s+1]);c<d&&c>0&&(y=s,d=c)}let k=t[2*y],L=t[2*y+1],G=Infinity;for(let s=0;s<n;s++){if(s===u||s===y)continue;const c=Z(T,U,k,L,t[2*s],t[2*s+1]);c<G&&(p=s,G=c)}let E=t[2*p],N=t[2*p+1];if(G===Infinity){for(let g=0;g<n;g++)this._dists[g]=t[2*g]-t[0]||t[2*g+1]-t[1];v(this._ids,this._dists,0,n-1);const s=new Uint32Array(n);let c=0;for(let g=0,w=-Infinity;g<n;g++){const A=this._ids[g];this._dists[A]>w&&(s[c++]=A,w=this._dists[A])}this.hull=s.subarray(0,c),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(X(T,U,k,L,E,N)<0){const s=y,c=k,g=L;y=p,k=E,L=N,p=s,E=c,N=g}const D=B(T,U,k,L,E,N);this._cx=D.x,this._cy=D.y;for(let s=0;s<n;s++)this._dists[s]=C(t[2*s],t[2*s+1],D.x,D.y);v(this._ids,this._dists,0,n-1),this._hullStart=u;let P=3;l[u]=i[p]=y,l[y]=i[u]=p,l[p]=i[y]=u,r[u]=0,r[y]=1,r[p]=2,h.fill(-1),h[this._hashKey(T,U)]=u,h[this._hashKey(k,L)]=y,h[this._hashKey(E,N)]=p,this.trianglesLen=0,this._addTriangle(u,y,p,-1,-1,-1);for(let s=0,c,g;s<this._ids.length;s++){const w=this._ids[s],A=t[2*w],M=t[2*w+1];if(s>0&&Math.abs(A-c)<=F&&Math.abs(M-g)<=F)continue;if(c=A,g=M,w===u||w===y||w===p)continue;let I=0;for(let H=0,J=this._hashKey(A,M);H<this._hashSize&&!(I=h[(J+H)%this._hashSize],I!==-1&&I!==l[I]);H++);I=i[I];let a=I,S;for(;S=l[a],X(A,M,t[2*a],t[2*a+1],t[2*S],t[2*S+1])>=0;)if(a=S,a===I){a=-1;break}if(a===-1)continue;let K=this._addTriangle(a,w,l[a],-1,-1,r[a]);r[w]=this._legalize(K+2),r[a]=K,P++;let z=l[a];for(;S=l[z],X(A,M,t[2*z],t[2*z+1],t[2*S],t[2*S+1])<0;)K=this._addTriangle(z,w,S,r[w],-1,r[z]),r[w]=this._legalize(K+2),l[z]=z,P--,z=S;if(a===I)for(;S=i[a],X(A,M,t[2*S],t[2*S+1],t[2*a],t[2*a+1])<0;)K=this._addTriangle(S,w,a,-1,r[a],r[S]),this._legalize(K+2),r[S]=K,l[a]=a,P--,a=S;this._hullStart=i[w]=a,l[a]=i[z]=w,l[w]=z,h[this._hashKey(A,M)]=w,h[this._hashKey(t[2*a],t[2*a+1])]=a}this.hull=new Uint32Array(P);for(let s=0,c=this._hullStart;s<P;s++)this.hull[s]=c,c=l[c];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,i){return Math.floor(O(t-this._cx,i-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:i,_halfedges:l,coords:r}=this;let h=0,n=0;for(;;){const o=l[t],_=t-t%3;if(n=_+(t+2)%3,o===-1){if(h===0)break;t=q[--h];continue}const f=o-o%3,x=_+(t+1)%3,m=f+(o+2)%3,b=i[n],d=i[t],u=i[x],y=i[m],p=R(r[2*b],r[2*b+1],r[2*d],r[2*d+1],r[2*u],r[2*u+1],r[2*y],r[2*y+1]);if(p){i[t]=y,i[o]=b;const T=l[m];if(T===-1){let k=this._hullStart;do{if(this._hullTri[k]===m){this._hullTri[k]=t;break}k=this._hullPrev[k]}while(k!==this._hullStart)}this._link(t,T),this._link(o,l[n]),this._link(n,m);const U=f+(o+1)%3;h<q.length&&(q[h++]=U)}else{if(h===0)break;t=q[--h]}}return n}_link(t,i){this._halfedges[t]=i,i!==-1&&(this._halfedges[i]=t)}_addTriangle(t,i,l,r,h,n){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=i,this._triangles[o+2]=l,this._link(o,r),this._link(o+1,h),this._link(o+2,n),this.trianglesLen+=3,o}}function O(e,t){const i=e/(Math.abs(e)+Math.abs(t));return(t>0?3-i:1+i)/4}function C(e,t,i,l){const r=e-i,h=t-l;return r*r+h*h}function R(e,t,i,l,r,h,n,o){const _=e-n,f=t-o,x=i-n,m=l-o,b=r-n,d=h-o,u=_*_+f*f,y=x*x+m*m,p=b*b+d*d;return _*(m*p-y*d)-f*(x*p-y*b)+u*(x*d-m*b)<0}function Z(e,t,i,l,r,h){const n=i-e,o=l-t,_=r-e,f=h-t,x=n*n+o*o,m=_*_+f*f,b=.5/(n*f-o*_),d=(f*x-o*m)*b,u=(n*m-_*x)*b;return d*d+u*u}function B(e,t,i,l,r,h){const n=i-e,o=l-t,_=r-e,f=h-t,x=n*n+o*o,m=_*_+f*f,b=.5/(n*f-o*_),d=e+(f*x-o*m)*b,u=t+(n*m-_*x)*b;return{x:d,y:u}}function v(e,t,i,l){if(l-i<=20)for(let r=i+1;r<=l;r++){const h=e[r],n=t[h];let o=r-1;for(;o>=i&&t[e[o]]>n;)e[o+1]=e[o--];e[o+1]=h}else{const r=i+l>>1;let h=i+1,n=l;j(e,r,h),t[e[i]]>t[e[l]]&&j(e,i,l),t[e[h]]>t[e[l]]&&j(e,h,l),t[e[i]]>t[e[h]]&&j(e,i,h);const o=e[h],_=t[o];for(;;){do h++;while(t[e[h]]<_);do n--;while(t[e[n]]>_);if(n<h)break;j(e,h,n)}e[i+1]=e[n],e[n]=o,l-h+1>=n-i?(v(e,t,h,l),v(e,t,i,n-1)):(v(e,t,i,n-1),v(e,t,h,l))}}function j(e,t,i){const l=e[t];e[t]=e[i],e[i]=l}function Q(e){return e[0]}function V(e){return e[1]}export default Y;
