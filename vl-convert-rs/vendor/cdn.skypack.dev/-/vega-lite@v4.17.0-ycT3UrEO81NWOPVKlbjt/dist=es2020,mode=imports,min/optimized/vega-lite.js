import{hasOwnProperty as Zt,isNumber as Y,isString as A,writeConfig as Qu,splitAccessPath as en,stringValue as R,toSet as At,isObject as Z,isBoolean as Nn,logger as Ju,Warn as Zu,isArray as j,isFunction as ef,array as V,mergeConfig as Wo,identity as tf}from"/-/vega-util@v1.17.2-LUfkDhormMyfWqy3Ts6U/dist=es2020,mode=imports,min/optimized/vega-util.js";import nf from"/-/clone@v2.1.2-inH2VLNzDGiYU9HUWyZM/dist=es2020,mode=imports,min/optimized/clone.js";import rf from"/-/fast-deep-equal@v3.1.3-ysejKs1WDEDPxUJhgGoP/dist=es2020,mode=imports,min/optimized/fast-deep-equal.js";import Pn from"/-/fast-json-stable-stringify@v2.1.0-HLgsuOtxPikt0pw16nth/dist=es2020,mode=imports,min/optimized/fast-json-stable-stringify.js";import{selector as tn}from"/-/vega-event-selector@v3.0.1-UgiEAWJA4WQL4DTKnV4R/dist=es2020,mode=imports,min/optimized/vega-event-selector.js";import{parse as sf}from"/-/vega-expression@v5.1.0-2VnsdaYPtQ6Pi5w8JxN8/dist=es2020,mode=imports,min/optimized/vega-expression.js";const of="4.17.0";function Er(e){return!!e.or}function $r(e){return!!e.and}function kr(e){return!!e.not}function pi(e,t){if(kr(e))pi(e.not,t);else if($r(e))for(const n of e.and)pi(n,t);else if(Er(e))for(const n of e.or)pi(n,t);else t(e)}function hi(e,t){return kr(e)?{not:hi(e.not,t)}:$r(e)?{and:e.and.map(n=>hi(n,t))}:Er(e)?{or:e.or.map(n=>hi(n,t))}:t(e)}const nn=rf,F=nf;function rn(e,t){const n={};for(const i of t)Zt(e,i)&&(n[i]=e[i]);return n}function fe(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>Pn(e)).join(",")})`};const U=Pn;function I(e){if(Y(e))return e;const t=A(e)?e:Pn(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function Nr(e){return e===!1||e===null}function w(e,t){return e.indexOf(t)>-1}function sn(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function Pr(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function Bo(e,...t){for(const n of t)af(e,n??{});return e}function af(e,t){for(const n of b(t))Qu(e,n,t[n],!0)}function Ce(e,t){const n=[],i={};let r;for(const s of e){if(r=t(s),r in i)continue;i[r]=1,n.push(s)}return n}function cf(e,t){const n=b(e),i=b(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function qo(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Cr(e,t){for(const n of e)if(t.has(n))return!0;return!1}function Fr(e){const t=new Set;for(const n of e){const i=en(n),r=i.map((o,a)=>a===0?o:`[${o}]`),s=r.map((o,a)=>r.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function Ar(e,t){return e===void 0||t===void 0?!0:Cr(Fr(e),Fr(t))}function z(e){return b(e).length===0}const b=Object.keys,Ke=Object.values,Cn=Object.entries;function Fn(e){return e===!0||e===!1}function W(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function on(e,t){return kr(e)?"!("+on(e.not,t)+")":$r(e)?"("+e.and.map(n=>on(n,t)).join(") && (")+")":Er(e)?"("+e.or.map(n=>on(n,t)).join(") || (")+")":t(e)}function mi(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&mi(e[n],t)&&delete e[n],z(e)}function An(e){return e.charAt(0).toUpperCase()+e.substr(1)}function Tr(e,t="datum"){const n=en(e),i=[];for(let r=1;r<=n.length;r++){const s=`[${n.slice(0,r).map(R).join("][")}]`;i.push(`${t}${s}`)}return i.join(" && ")}function Ho(e,t="datum"){return`${t}[${R(en(e).join("."))}]`}function lf(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Qe(e){return`${en(e).map(lf).join("\\.")}`}function Tt(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Ir(e){return`${en(e).join(".")}`}function an(e){return e?en(e).length:0}function X(...e){for(const t of e)if(t!==void 0)return t;return}let Go=42;function Vo(e){const t=++Go;return e?String(e)+t:t}function uf(){Go=42}function Xo(e){return Yo(e)?e:`__${e}`}function Yo(e){return e.indexOf("__")===0}function Tn(e){return e===void 0?void 0:(e%360+360)%360}function bi(e){return Y(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const Ko={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function In(e){return e&&e.condition}const Qo=["domain","grid","labels","ticks","title"],ff={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Jo={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},df=Object.assign(Object.assign({},Jo),{style:1,labelExpr:1,encoding:1});function Zo(e){return!!df[e]}const gf={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},ea=b(gf),pf={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},hf={count:1,min:1,max:1};function Je(e){return!!e&&!!e.argmin}function pt(e){return!!e&&!!e.argmax}function Rr(e){return A(e)&&!!pf[e]}const mf=["count","valid","missing","distinct"];function ta(e){return A(e)&&w(mf,e)}function bf(e){return A(e)&&w(["min","max"],e)}const yf=["count","sum","distinct","valid","missing"],Of=["mean","average","median","q1","q3","min","max"],vf=At(Of);var Rn=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ze="row",et="column",yi="facet",q="x",Q="y",xe="x2",Fe="y2",Ae="radius",tt="radius2",Se="theta",nt="theta2",Te="latitude",Ie="longitude",_e="latitude2",he="longitude2",ce="color",Re="fill",Le="stroke",le="shape",it="size",It="angle",rt="opacity",ht="fillOpacity",mt="strokeOpacity",bt="strokeWidth",yt="strokeDash",Ln="text",zn="order",Mn="detail",Oi="key",Rt="tooltip",vi="href",xi="url",Si="description",xf={x:1,y:1,x2:1,y2:1},na={theta:1,theta2:1,radius:1,radius2:1};function ia(e){return e in na}const Lr={longitude:1,longitude2:1,latitude:1,latitude2:1};function Sf(e){switch(e){case Te:return"y";case _e:return"y2";case Ie:return"x";case he:return"x2"}}function _f(e){return e in Lr}const jf=b(Lr),ra=Object.assign(Object.assign(Object.assign(Object.assign({},xf),na),Lr),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function cn(e){return e===ce||e===Re||e===Le}const sa={row:1,column:1,facet:1},me=b(sa),zr=Object.assign(Object.assign({},ra),sa),wf=b(zr),Ef=Rn(zr,["order","detail","tooltip"]),$f=Rn(Ef,["row","column","facet"]);function kf(e){return!!$f[e]}function oa(e){return!!zr[e]}const Nf=[xe,Fe,_e,he,nt,tt];function aa(e){const t=Lt(e);return t!==e}function Lt(e){switch(e){case xe:return q;case Fe:return Q;case _e:return Te;case he:return Ie;case nt:return Se;case tt:return Ae}return e}function Ot(e){if(ia(e))switch(e){case Se:return"startAngle";case nt:return"endAngle";case Ae:return"outerRadius";case tt:return"innerRadius"}return e}function ze(e){switch(e){case q:return xe;case Q:return Fe;case Te:return _e;case Ie:return he;case Se:return nt;case Ae:return tt}return}function Me(e){switch(e){case q:case xe:return"width";case Q:case Fe:return"height"}return}function Pf(e){switch(e){case q:return"xOffset";case Q:return"yOffset";case xe:return"x2Offset";case Fe:return"y2Offset";case Se:return"thetaOffset";case Ae:return"radiusOffset";case nt:return"theta2Offset";case tt:return"radius2Offset"}return}const Mr=Rn(ra,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),Cf=b(Mr),vt={x:1,y:1},be=b(vt);function De(e){return e in vt}const Dr={theta:1,radius:1},Ff=b(Dr);function _i(e){return e==="width"?q:Q}const ca=Rn(Mr,["text","tooltip","href","url","description","detail","key","order"]),Af=b(ca);function Tf(e){return!!Mr[e]}function If(e){switch(e){case ce:case Re:case Le:case it:case le:case rt:case bt:case yt:return!0;case ht:case mt:case It:return!1}}const la=Object.assign(Object.assign(Object.assign({},vt),Dr),ca),ji=b(la);function xt(e){return!!la[e]}function Rf(e,t){return zf(e)[t]}const ua={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},Lf=Rn(ua,["geoshape"]);function zf(e){switch(e){case ce:case Re:case Le:case Si:case Mn:case Oi:case Rt:case vi:case zn:case rt:case ht:case mt:case bt:case yi:case Ze:case et:return ua;case q:case Q:case Te:case Ie:return Lf;case xe:case Fe:case _e:case he:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case it:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case yt:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case le:return{point:"always",geoshape:"always"};case Ln:return{text:"always"};case It:return{point:"always",square:"always",text:"always"};case xi:return{image:"always"};case Se:return{text:"always",arc:"always"};case Ae:return{text:"always",arc:"always"};case nt:case tt:return{arc:"always"}}}function Ur(e){switch(e){case q:case Q:case Se:case Ae:case it:case It:case bt:case rt:case ht:case mt:case xe:case Fe:case nt:case tt:return;case yi:case Ze:case et:case le:case yt:case Ln:case Rt:case vi:case xi:case Si:return"discrete";case ce:case Re:case Le:return"flexible";case Te:case Ie:case _e:case he:case Mn:case Oi:case zn:return}}function fa(e){return Nn(e)&&(e=Bi(e,void 0)),"bin"+b(e).map(t=>wi(e[t])?W(`_${t}_${Cn(e[t])}`):W(`_${t}_${e[t]}`)).join("")}function B(e){return e===!0||Dn(e)&&!e.binned}function ie(e){return e==="binned"||Dn(e)&&e.binned===!0}function Dn(e){return Z(e)}function wi(e){return e==null?void 0:e.selection}function da(e){switch(e){case Ze:case et:case it:case ce:case Re:case Le:case bt:case rt:case ht:case mt:case le:return 6;case yt:return 4;default:return 10}}function Wr(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Mf='Autosize "fit" only works for single views and layered views.';function ga(e){const t=e=="width"?"Width":"Height";return`${t} "container" only works for single views and layered views.`}function pa(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function ha(e){return e?`Dropping "fit-${e}" because spec has discrete ${Me(e)}.`:'Dropping "fit" because spec has discrete size.'}function Br(e){return`Unknown field for ${e}. Cannot calculate view size.`}function ma(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Df(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Uf(e){return`The "nearest" transform is not supported for ${e} marks.`}function ba(e){return`Selection not supported for ${e} yet.`}function Wf(e){return`Cannot find a selection named "${e}".`}const Bf="Scale bindings are currently only supported for scales with unbinned, continuous domains.",qf="Legend bindings are only supported for selections over an individual field or encoding channel.";function Hf(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const Gf="The same selection must be used to override scale domains in a layered view.",Vf='Interval selections should be initialized using "x" and/or "y" keys.';function Xf(e){return`Unknown repeated value "${e}".`}function ya(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const Yf="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Kf(e){return`Unrecognized parse "${e}".`}function Oa(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const Qf="Attempt to add the same child twice.";function Jf(e){return`Ignoring an invalid transform: ${U(e)}.`}const Zf='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function va(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function ed(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${U(t)} is overridden by a child projection ${U(n)}.`}const td="Arc marks uses theta channel rather than angle, replacing angle with theta.";function nd(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${U(n)}}.`}function xa(e){return`Invalid field type "${e}".`}function id(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function rd(e){return`Invalid aggregation operator "${e}".`}function Sa(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function qr(e,t){return`Dropping ${U(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const sd="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Ei(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function od(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function ad(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function cd(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function Hr(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function ld(e){return`The ${e} for range marks cannot be an expression`}function ud(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function fd(e,t){return`Specified orient "${e}" overridden with "${t}".`}const dd=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function gd(e){return`Cannot use the scale property "${e}" with non-color channel.`}function pd(e){return`Using unaggregated domain with raw field has no effect (${U(e)}).`}function hd(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function md(e){return`Unaggregated domain is currently unsupported for log scale (${U(e)}).`}function bd(e){return`Cannot apply size to non-oriented mark "${e}".`}function yd(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Od(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function _a(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function ja(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function vd(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${U(n)} and ${U(i)}). Using ${U(n)}.`}function xd(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${U(n)} and ${U(i)}). Using the union of the two domains.`}function Sd(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function _d(e){return`Dropping sort property ${U(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const wa="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",jd="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",wd="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Ed="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function $d(e){return`Cannot stack "${e}" if there is already "${e}2".`}function kd(e){return`Cannot stack non-linear scale (${e}).`}function Nd(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function $i(e,t){return`Invalid ${e}: ${U(t)}.`}function Pd(e){return`Dropping day from datetime ${U(e)} as day cannot be combined with other units.`}function Cd(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function Fd(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Ad(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Ea(e){return`1D error band does not support ${e}.`}function $a(e){return`Channel ${e} is required for "binned" bin.`}function Td(e){return`Channel ${e} should not be used with "binned" bin.`}function Id(e){return`Domain for ${e} is required for threshold scale.`}var tv=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},nv=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};const ka=Ju(Zu);let ln=ka;function Rd(e){return ln=e,ln}function Ld(){return ln=ka,ln}function y(...e){ln.warn(...e)}function zd(...e){ln.debug(...e)}function zt(e){if(e&&Z(e)){for(const t of Vr)if(t in e)return!0}return!1}const Na=["january","february","march","april","may","june","july","august","september","october","november","december"],Md=Na.map(e=>e.substr(0,3)),Pa=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Dd=Pa.map(e=>e.substr(0,3));function Ud(e){if(bi(e)&&(e=+e),Y(e))return e>4&&y($i("quarter",e)),e-1;throw new Error($i("quarter",e))}function Wd(e){if(bi(e)&&(e=+e),Y(e))return e-1;{const t=e.toLowerCase(),n=Na.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Md.indexOf(i);if(r!==-1)return r;throw new Error($i("month",e))}}function Bd(e){if(bi(e)&&(e=+e),Y(e))return e%7;{const t=e.toLowerCase(),n=Pa.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Dd.indexOf(i);if(r!==-1)return r;throw new Error($i("day",e))}}function Gr(e,t){const n=[];if(t&&e.day!==void 0&&(b(e).length>1&&(y(Pd(e)),e=F(e),delete e.day)),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Wd(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Ud(e.quarter):e.quarter;n.push(Y(i)?i*3:i+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Bd(e.day):e.day;n.push(Y(i)?i+1:i+"+1")}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function Un(e){const t=Gr(e,!0),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function qd(e){const t=Gr(e,!1),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Hd(e){const t=Gr(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}var Gd=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ca={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Vr=b(Ca);function Vd(e){return!!Ca[e]}function Xr(e){return e.startsWith("utc")}function Xd(e){return e.substr(3)}const Yd={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Yr(e){const t=[];for(const n of Vr)Fa(e,n)&&t.push(n);return t}function Fa(e,t){const n=e.indexOf(t);return n<0||(n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")?!1:!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function Kd(e,t,{end:n}={end:!1}){const i=Tr(t),r=Xr(e)?"utc":"";function s(c){return c==="quarter"?`(${r}quarter(${i})-1)`:`${r}${c}(${i})`}let o;const a={};for(const c of Vr)Fa(e,c)&&(a[c]=s(c),o=c);return n&&(a[o]+="+1"),qd(a)}function Aa(e){if(!e)return;const t=Yr(e);return`timeUnitSpecifier(${Pn(t)}, ${Pn(Yd)})`}function Qd(e,t,n){if(!e)return;const i=Aa(e),r=n||Xr(e);return`${r?"utc":"time"}Format(${t}, ${i})`}function re(e){if(!e)return;let t;return A(e)?t={unit:e}:Z(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),Xr(t.unit)&&(t.utc=!0,t.unit=Xd(t.unit)),t}function Jd(e){const t=re(e),{utc:n}=t,i=Gd(t,["utc"]);return i.unit?(n?"utc":"")+b(i).map(r=>W(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+b(i).map(r=>W(`_${r}_${i[r]}`)).join("")}function E(e){return e&&!!e.signal}function St(e){return!!e.step}function Zd(e){return j(e)?!1:"fields"in e&&!("data"in e)}function eg(e){return j(e)?!1:"fields"in e&&"data"in e}function st(e){return j(e)?!1:"field"in e&&"data"in e}const tg={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},ng=b(tg),ig={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Kr=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function rg(e){return e==null?void 0:e.selection}function Qr(e){return e&&!!e.field&&e.equal!==void 0}function Jr(e){return e&&!!e.field&&e.lt!==void 0}function Zr(e){return e&&!!e.field&&e.lte!==void 0}function es(e){return e&&!!e.field&&e.gt!==void 0}function ts(e){return e&&!!e.field&&e.gte!==void 0}function ns(e){if(e&&e.field){if(j(e.range)&&e.range.length===2)return!0;if(E(e.range))return!0}return!1}function is(e){return e&&!!e.field&&(j(e.oneOf)||j(e.in))}function sg(e){return e&&!!e.field&&e.valid!==void 0}function Ta(e){return is(e)||Qr(e)||ns(e)||Jr(e)||es(e)||Zr(e)||ts(e)}function Ue(e,t){return qi(e,{timeUnit:t,wrapTime:!0})}function og(e,t){return e.map(n=>Ue(n,t))}function Ia(e,t=!0){var n;const{field:i}=e,r=(n=re(e.timeUnit))===null||n===void 0?void 0:n.unit,s=r?"time("+Kd(r,i)+")":v(e,{expr:"datum"});if(Qr(e))return s+"==="+Ue(e.equal,r);if(Jr(e)){const o=e.lt;return`${s}<${Ue(o,r)}`}else if(es(e)){const o=e.gt;return`${s}>${Ue(o,r)}`}else if(Zr(e)){const o=e.lte;return`${s}<=${Ue(o,r)}`}else if(ts(e)){const o=e.gte;return`${s}>=${Ue(o,r)}`}else{if(is(e))return`indexof([${og(e.oneOf,r).join(",")}], ${s}) !== -1`;if(sg(e))return rs(s,e.valid);if(ns(e)){const{range:o}=e,a=E(o)?{signal:`${o.signal}[0]`}:o[0],c=E(o)?{signal:`${o.signal}[1]`}:o[1];if(a!==null&&c!==null&&t)return"inrange("+s+", ["+Ue(a,r)+", "+Ue(c,r)+"])";const l=[];return a!==null&&l.push(`${s} >= ${Ue(a,r)}`),c!==null&&l.push(`${s} <= ${Ue(c,r)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function rs(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function ag(e){var t;return Ta(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=re(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Wn={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Mt=Wn.quantitative,ss=Wn.ordinal,un=Wn.temporal,os=Wn.nominal,fn=Wn.geojson;function cg(e){if(e){e=e.toLowerCase();switch(e){case"q":case Mt:return"quantitative";case"t":case un:return"temporal";case"o":case ss:return"ordinal";case"n":case os:return"nominal";case fn:return"geojson"}}return}var lg=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const K={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},as={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function ug(e,t){const n=as[e],i=as[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const fg={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Ra(e){return fg[e]}const La=["linear","log","pow","sqrt","symlog","time","utc"],dg=At(La),gg=["linear","log","pow","sqrt","symlog"],pg=At(gg);function hg(e){return e in pg}const mg=["quantile","quantize","threshold"],bg=At(mg),yg=La.concat(["quantile","quantize","threshold","sequential","identity"]),Og=At(yg),vg=["ordinal","bin-ordinal","point","band"],xg=At(vg);function ue(e){return e in xg}function ye(e){return e in Og}function je(e){return e in dg}function ki(e){return e in bg}const Sg={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function _g(e){return!A(e)&&!!e.name}function za(e){return e==null?void 0:e.selection}function jg(e){return e&&e.unionWith}const wg={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Eg=lg(wg,["type","domain","range","rangeMax","rangeMin","scheme"]),$g=b(Eg);function cs(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!w(["point","band","identity"],e);case"bins":return!w(["point","band","identity","ordinal"],e);case"round":return je(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return je(e)||w(["point","band"],e);case"paddingOuter":case"align":return w(["point","band"],e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return je(e);case"nice":return je(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return ye(e)&&!w(["log","time","utc","threshold","quantile"],e)}}function Ma(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return cn(e)?void 0:gd(e);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function kg(e,t){return w([ss,os],t)?e===void 0||ue(e):t===un?w([K.TIME,K.UTC,void 0],e):t===Mt?w([K.LOG,K.POW,K.SQRT,K.SYMLOG,K.QUANTILE,K.QUANTIZE,K.THRESHOLD,K.LINEAR,void 0],e):!0}function Ng(e,t){if(!xt(e))return!1;switch(e){case q:case Q:case Se:case Ae:return je(t)||w(["band","point"],t);case it:case bt:case rt:case ht:case mt:case It:return je(t)||ki(t)||w(["band","point","ordinal"],t);case ce:case Re:case Le:return t!=="band";case yt:return t==="ordinal"||ki(t);case le:return t==="ordinal"}}function Bn(e){return e&&!!e.expr}function we(e){const t=b(e||{}),n={};for(const i of t)n[i]=oe(e[i]);return n}const se={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},Da=se.arc,Ni=se.area,Pi=se.bar,Pg=se.image,Ci=se.line,Fi=se.point,Cg=se.rect,Ai=se.rule,Ua=se.text,ls=se.tick,Fg=se.trail,us=se.circle,fs=se.square,Wa=se.geoshape;function _t(e){return w(["line","area","trail"],e)}function Ba(e){return w(["rect","bar","image","arc"],e)}const qa=b(se);function ot(e){return e.type}const iv=At(qa),Ag=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],Tg=["fill","fillOpacity"],Ig=[...Ag,...Tg],Rg={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1},Ha=b(Rg),Lg={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},zg={color:"#4c78a8",invalid:"filter",timeUnitBand:1},Mg={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},Ga=b(Mg),Dg={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Va=5,Ug={binSpacing:1,continuousBandSize:Va,timeUnitBandPosition:.5},Wg={binSpacing:0,continuousBandSize:Va,timeUnitBandPosition:.5},Bg={thickness:1};function qg(e){return ot(e)?e.type:e}function ds(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:s}=e,o=Ya(e);return x(n)&&!ta(n.aggregate)&&r&&je(r.get("type"))&&r.get("zero")===!1?Xa({fieldDef:n,channel:t,markDef:i,ref:o,config:s}):o}function Xa({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){if(_t(n.type))return i;const s=L("invalid",n,r);return s===null?i:[Hg(e,t),i]}function Hg(e,t){const n=gs(e,!0),i=Lt(t),r=i==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function gs(e,t=!0){return rs(A(e)?e:v(e,{expr:"datum"}),!t)}function Gg(e){const{datum:t}=e;return zt(t)?Un(t):`${JSON.stringify(t)}`}function Dt(e,t,n,i){const r={};if(t&&(r.scale=t),wt(e)){const{datum:s}=e;zt(s)?r.signal=Un(s):E(s)?r.signal=s.signal:Bn(s)?r.signal=s.expr:r.value=s}else r.field=v(e,n);if(i){const{offset:s,band:o}=i;s&&(r.offset=s),o&&(r.band=o)}return r}function Ti({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,band:s=.5}){const o=0<s&&s<1?"datum":void 0,a=v(t,{expr:o,suffix:r}),c=n!==void 0?v(n,{expr:o}):v(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const u=s===0?a:c;l.field=u}else{const u=`${s} * ${a} + ${1-s} * ${c}`;l.signal=`scale("${e}", ${u})`}return i&&(l.offset=i),l}function Ya({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l,band:u}){var f;if(t){if(k(t)){if(Oe(t)){u=u??Gn({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:a,config:r,isMidPoint:!0});const{bin:g,timeUnit:p,type:m}=t;if(B(g)||u&&p&&m===un)return a&&a.impute?Dt(t,s,{binSuffix:"mid"},{offset:c}):u?Ti({scaleName:s,fieldOrDatumDef:t,band:u,offset:c}):Dt(t,s,Vn(t,e)?{binSuffix:"range"}:{},{offset:c});if(ie(g)){if(x(n))return Ti({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:u,offset:c});{const h=e===q?xe:Fe;y($a(h))}}}const d=o==null?void 0:o.get("type");return Dt(t,s,ue(d)?{binSuffix:"range"}:{},{offset:c,band:d==="band"?(f=u??t.band)!==null&&f!==void 0?f:.5:void 0})}else if(Ee(t)){const d=t.value,g=c?{offset:c}:{};return Object.assign(Object.assign({},qn(e,d)),g)}}return ef(l)&&(l=l()),l&&Object.assign(Object.assign({},l),c?{offset:c}:{})}function qn(e,t){return w(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:w(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:H(t)}function Ut(e){return e&&e!=="number"&&e!=="time"}function Ka(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const Vg=" \u2013 ";function ps({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){var o,a;if(Ut(n))return hs({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const c=Qa(e,i,r);if(gn(e)){const l=Yg(c,x(e)?(o=re(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,s.timeFormat,Di(e)&&((a=e.scale)===null||a===void 0?void 0:a.type)===K.UTC);return l?{signal:l}:void 0}if(t=ec(jt(e),t,s),x(e)&&B(e.bin)){const l=v(e,{expr:i,binSuffix:"end"});return{signal:Ii(c,l,t,n,s)}}else return t||jt(e)==="quantitative"?{signal:`${tc(c,t)}`}:{signal:`isValid(${c}) ? ${c} : ""+${c}`}}function Qa(e,t,n){return x(e)?n?`${v(e,{expr:t,suffix:"end"})}-${v(e,{expr:t,suffix:"start"})}`:v(e,{expr:t}):Gg(e)}function hs({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){if(o=o??Qa(e,i,r),x(e)&&B(e.bin)){const a=v(e,{expr:i,binSuffix:"end"});return{signal:Ii(o,a,t,n,s)}}return{signal:Ka(n,o,t)}}function Ja(e,t,n,i,r,s){var o;if(Ut(i))return;if(gn(e)){const a=x(e)?(o=re(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return Xg(n,a,r,s)}return ec(t,n,r)}function Za(e,t,n){return e&&(E(e)||e==="number"||e==="time")?e:gn(t)&&n!=="time"&&n!=="utc"?"time":void 0}function ec(e,t,n){return A(t)?t:e===Mt?n.numberFormat:void 0}function Xg(e,t,n,i){return e||(t?{signal:Aa(t)}:i?void 0:n.timeFormat)}function tc(e,t){return`format(${e}, "${t||""}")`}function nc(e,t,n,i){var r;return Ut(n)?Ka(n,e,t):tc(e,(r=A(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function Ii(e,t,n,i,r){const s=nc(e,n,i,r),o=nc(t,n,i,r);return`${rs(e,!1)} ? "null" : ${s} + "${Vg}" + ${o}`}function Yg(e,t,n,i,r){return!t||n?(n=A(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):Qd(t,e,r)}const Ri="min",Kg={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function ic(e){return e in Kg}function rc(e){return!!e&&!!e.encoding}function We(e){return!!e&&(e.op==="count"||!!e.field)}function sc(e){return!!e&&j(e)}function Hn(e){return"row"in e||"column"in e}function ms(e){return!!e&&"header"in e}function Li(e){return"facet"in e}var bs=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Qg(e){return e.selection}function Jg(e){return e&&!A(e)&&"repeat"in e}function oc(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function ys(e){return"sort"in e}function Gn({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:r,config:s,isMidPoint:o}){if(k(t)&&t.band!==void 0)return t.band;if(x(t)){const{timeUnit:a,bin:c}=t;if(a&&!n)return o?Bt("timeUnitBandPosition",i,s):Ba(i.type)?Bt("timeUnitBand",i,s):0;if(B(c))return Ba(i.type)&&!o?1:.5}return(r==null?void 0:r.fieldChannel)===e&&o?.5:void 0}function Os(e,t,n,i,r,s){return B(t.bin)||t.timeUnit&&Oe(t)&&t.type==="temporal"?!!Gn({channel:e,fieldDef:t,fieldDef2:n,stack:i,markDef:r,config:s}):!1}function vs(e){return!!e&&"condition"in e}function zi(e){const t=e&&e.condition;return!!t&&!j(t)&&x(t)}function Mi(e){const t=e&&e.condition;return!!t&&!j(t)&&k(t)}function Zg(e){const t=e&&e.condition;return!!t&&(j(t)||Ee(t))}function x(e){return!!e&&(!!e.field||e.aggregate==="count")}function jt(e){return e&&e.type}function wt(e){return!!e&&"datum"in e}function Be(e){return Oe(e)&&uc(e)||xs(e)}function xs(e){return wt(e)&&Y(e.datum)}function k(e){return x(e)||wt(e)}function Oe(e){return!!e&&("field"in e||e.aggregate==="count")&&"type"in e}function Ee(e){return e&&"value"in e&&"value"in e}function Di(e){return!!e&&("scale"in e||"sort"in e)}function Ss(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function ac(e){return!!e&&"legend"in e}function cc(e){return!!e&&("format"in e||"formatType"in e)}function ep(e){return fe(e,["legend","axis","header","scale"])}function tp(e){return"op"in e}function v(e,t={}){var n,i,r;let s=e.field;const o=t.prefix;let a=t.suffix,c="";if(np(e))s=Xo("count");else{let l;if(!t.nofn)if(tp(e))l=e.op;else{const{bin:u,aggregate:f,timeUnit:d}=e;B(u)?(l=fa(u),a=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?pt(f)?(c=`["${s}"]`,s=`argmax_${f.argmax}`):Je(f)?(c=`["${s}"]`,s=`argmin_${f.argmin}`):l=String(f):d&&(l=Jd(d),a=(!w(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}l&&(s=s?`${l}_${s}`:l)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),t.forAs?Ir(s):t.expr?Ho(s,t.expr)+c:Qe(s)+c}function lc(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return x(e)&&!!e.bin;case"temporal":return!1}throw new Error(xa(e.type))}function uc(e){return!lc(e)}function np(e){return e.aggregate==="count"}function ip(e,t){var n;const{field:i,bin:r,timeUnit:s,aggregate:o}=e;if(o==="count")return t.countTitle;if(B(r))return`${i} (binned)`;if(s){const a=(n=re(s))===null||n===void 0?void 0:n.unit;if(a)return`${i} (${Yr(a).join("-")})`}else if(o)return pt(o)?`${i} for max ${o.argmax}`:Je(o)?`${i} for min ${o.argmin}`:`${An(o)} of ${i}`;return i}function rp(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(pt(t))return`${r} for argmax(${t.argmax})`;if(Je(t))return`${r} for argmin(${t.argmin})`;const s=re(i),o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||B(n)&&"bin";return o?o.toUpperCase()+"("+r+")":r}const fc=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return rp(e);default:return ip(e,t)}};let dc=fc;function gc(e){dc=e}function sp(){gc(fc)}function dn(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,s;const o=(r=_s(e))===null||r===void 0?void 0:r.title;if(!x(e))return o;const a=e,c=i?js(a,t):void 0;return n?X(o,a.title,c):(s=o??a.title)!==null&&s!==void 0?s:c}function _s(e){return Ss(e)&&e.axis?e.axis:ac(e)&&e.legend?e.legend:ms(e)&&e.header?e.header:void 0}function js(e,t){return dc(e,t)}function Ui(e){var t;if(cc(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=_s(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function op(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(ys(e)&&j(e.sort))return"ordinal";const{aggregate:i,bin:r,timeUnit:s}=e;if(s)return"temporal";if(r||i&&!pt(i)&&!Je(i))return"quantitative";if(Di(e)&&((n=e.scale)===null||n===void 0?void 0:n.type))switch(as[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function qe(e){return x(e)?e:zi(e)?e.condition:void 0}function J(e){return k(e)?e:Mi(e)?e.condition:void 0}function pc(e,t,n,i={}){if(A(e)||Y(e)||Nn(e)){const r=A(e)?"string":Y(e)?"number":"boolean";return y(nd(t,r,e)),{value:e}}return k(e)?Wi(e,t,n,i):Mi(e)?Object.assign(Object.assign({},e),{condition:Wi(e.condition,t,n,i)}):e}function Wi(e,t,n,i){if(cc(e)){const{format:r,formatType:s}=e,o=bs(e,["format","formatType"]);if(Ut(s)&&!n.customFormatTypes)return y(va(t)),Wi(o,t,n,i)}else{const r=Ss(e)?"axis":ac(e)?"legend":ms(e)?"header":null;if(r&&e[r]){const s=e[r],{format:o,formatType:a}=s,c=bs(s,["format","formatType"]);if(Ut(a)&&!n.customFormatTypes)return y(va(t)),Wi(Object.assign(Object.assign({},e),{[r]:c}),t,n,i)}}return x(e)?ws(e,t,i):ap(e)}function ap(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Y(n)?"quantitative":A(n)?"nominal":zt(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function ws(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:o}=e,a=Object.assign({},e);if(!n&&i&&!Rr(i)&&!pt(i)&&!Je(i)&&(y(rd(i)),delete a.aggregate),r&&(a.timeUnit=re(r)),o&&(a.field=`${o}`),B(s)&&(a.bin=Bi(s,t)),ie(s)&&!De(t)&&y(Td(t)),Oe(a)){const{type:c}=a,l=cg(c);c!==l&&(a.type=l),c!=="quantitative"&&(ta(i)&&(y(id(c,i)),a.type="quantitative"))}else if(!aa(t)){const c=op(a,t);a.type=c}if(Oe(a)){const{compatible:c,warning:l}=cp(a,t)||{};c===!1&&y(l)}if(ys(a)&&A(a.sort)){const{sort:c}=a;if(ic(c))return Object.assign(Object.assign({},a),{sort:{encoding:c}});const l=c.substr(1);if(c.charAt(0)==="-"&&ic(l))return Object.assign(Object.assign({},a),{sort:{encoding:l,order:"descending"}})}if(ms(a)){const{header:c}=a,{orient:l}=c,u=bs(c,["orient"]);if(l)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},u),{labelOrient:c.labelOrient||l,titleOrient:c.titleOrient||l})})}return a}function Bi(e,t){return Nn(e)?{maxbins:da(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:da(t)}):e}const Wt={compatible:!0};function cp(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Ze:case et:case yi:return uc(e)?{compatible:!1,warning:ad(t)}:Wt;case q:case Q:case ce:case Re:case Le:case Ln:case Mn:case Oi:case Rt:case vi:case xi:case It:case Se:case Ae:case Si:return Wt;case Ie:case he:case Te:case _e:return n!==Mt?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:Wt;case rt:case ht:case mt:case bt:case it:case nt:case tt:case xe:case Fe:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:Wt;case yt:return w(["ordinal","nominal"],e.type)?Wt:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case le:return w(["ordinal","nominal","geojson"],e.type)?Wt:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case zn:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:Wt}}function gn(e){const{formatType:t}=Ui(e);return t==="time"||!t&&lp(e)}function lp(e){return e&&(e.type==="temporal"||x(e)&&!!e.timeUnit)}function qi(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var s;const o=t&&((s=re(t))===null||s===void 0?void 0:s.unit);let a=o||n==="temporal",c;return Bn(e)?c=e.expr:E(e)?c=e.signal:zt(e)?(a=!0,c=Un(e)):(A(e)||Y(e))&&(a&&(c=`datetime(${JSON.stringify(e)})`,Vd(o)&&((Y(e)&&e<1e4||A(e)&&isNaN(Date.parse(e)))&&(c=Un({[o]:e}))))),c?i&&a?`time(${c})`:c:r?void 0:JSON.stringify(e)}function hc(e,t){const{type:n}=e;return t.map(i=>{const r=qi(i,{timeUnit:x(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function Vn(e,t){return B(e.bin)?xt(t)&&w(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}var up=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function mc(e){const{anchor:t,frame:n,offset:i,orient:r,color:s,subtitleColor:o,subtitleFont:a,subtitleFontSize:c,subtitleFontStyle:l,subtitleFontWeight:u,subtitleLineHeight:f,subtitlePadding:d}=e,g=up(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},g),s?{fill:s}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),h=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),a?{subtitleFont:a}:{}),c?{subtitleFontSize:c}:{}),l?{subtitleFontStyle:l}:{}),u?{subtitleFontWeight:u}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{}),S=rn(p,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:p,subtitleMarkConfig:S,nonMark:m,subtitle:h}}function Et(e){return A(e)||j(e)&&A(e[0])}var Es=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function bc(e){const t=j(e.condition)?e.condition.map(yc):yc(e.condition);return Object.assign(Object.assign({},oe(e)),{condition:t})}function oe(e){if(Bn(e)){const{expr:t}=e,n=Es(e,["expr"]);return Object.assign({signal:t},n)}return e}function yc(e){if(Bn(e)){const{expr:t}=e,n=Es(e,["expr"]);return Object.assign({signal:t},n)}return e}function H(e){if(Bn(e)){const{expr:t}=e,n=Es(e,["expr"]);return Object.assign({signal:t},n)}return E(e)?e:e!==void 0?{value:e}:void 0}function Oc(e){return E(e)?e.signal:R(e.value)}function at(e){return E(e)?e.signal:e==null?null:R(e)}function fp(e,t,n){for(const i of n){const r=Bt(i,t.markDef,t.config);r!==void 0&&(e[i]=H(r))}return e}function vc(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function L(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:s&&(!r||r===e)?void 0:Bt(e,t,n,i)}function Bt(e,t,n,{vgChannel:i}={}){return X(i?Hi(e,t,n.style):void 0,Hi(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function Hi(e,t,n){return xc(e,vc(t),n)}function xc(e,t,n){t=V(t);let i;for(const r of t){const s=n[r];s&&s[e]!==void 0&&(i=s[e])}return i}function Sc(e,t){return V(e).reduce((n,i)=>{var r;return n.field.push(v(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function _c(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(nn(r,i))return;n.push(i)}),n}function jc(e,t){return nn(e,t)||!t?e:e?[...V(e),...V(t)].join(", "):t}function wc(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((Et(n)||E(n))&&(Et(i)||E(i)))return{explicit:e.explicit,value:jc(n,i)};if(Et(n)||E(n))return{explicit:e.explicit,value:n};if(Et(i)||E(i))return{explicit:e.explicit,value:i};if(!Et(n)&&!E(n)&&!Et(i)&&!E(i))return{explicit:e.explicit,value:_c(n,i)};throw new Error("It should never reach here")}function ct(e){return"mark"in e}class Gi{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return ct(t)?qg(t.mark)===this.name:!1}}var dp=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function qt(e,t){const n=e&&e[t];return n?j(n)?sn(n,i=>!!i.field):x(n)||zi(n):!1}function $s(e){return sn(wf,t=>{if(qt(e,t)){const n=e[t];if(j(n))return sn(n,i=>!!i.aggregate);{const i=qe(n);return i&&!!i.aggregate}}return!1})}function Ec(e,t){const n=[],i=[],r=[],s=[],o={};return ks(e,(a,c)=>{if(x(a)){const{field:l,aggregate:u,bin:f,timeUnit:d}=a,g=dp(a,["field","aggregate","bin","timeUnit"]);if(u||d||f){const p=_s(a),m=p&&p.title;let h=v(a,{forAs:!0});const S=Object.assign(Object.assign(Object.assign({},m?[]:{title:dn(a,t,{allowDisabling:!0})}),g),{field:h});if(u){let O;if(pt(u)?(O="argmax",h=v({op:"argmax",field:u.argmax},{forAs:!0}),S.field=`${h}.${l}`):Je(u)?(O="argmin",h=v({op:"argmin",field:u.argmin},{forAs:!0}),S.field=`${h}.${l}`):u!=="boxplot"&&u!=="errorbar"&&u!=="errorband"&&(O=u),O){const _={op:O,as:h};l&&(_.field=l),s.push(_)}}else if(n.push(h),Oe(a)&&B(f)){if(i.push({bin:f,field:l,as:h}),n.push(v(a,{binSuffix:"end"})),Vn(a,c)&&n.push(v(a,{binSuffix:"range"})),De(c)){const O={field:h+"_end"};o[c+"2"]=O}S.bin="binned",aa(c)||(S.type=Mt)}else if(d){r.push({timeUnit:d,field:l,as:h});const O=Oe(a)&&a.type!==un&&"time";O&&(c===Ln||c===Rt?S.formatType=O:Tf(c)?S.legend=Object.assign({formatType:O},S.legend):De(c)&&(S.axis=Object.assign({formatType:O},S.axis)))}o[c]=S}else n.push(l),o[c]=e[c]}else o[c]=e[c]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function gp(e,t,n){const i=Rf(t,n);if(i){if(i==="binned"){const r=e[t===xe?q:Q];return!!(x(r)&&x(e[t])&&ie(r.bin))}}else return!1;return!0}function pp(e,t,n,i){return b(e).reduce((r,s)=>{if(!oa(s))return y(od(s)),r;const o=e[s];if(s==="angle"&&t==="arc"&&!e.theta&&(y(td),s=Se),!gp(e,s,t))return y(Ei(s,t)),r;if(s===it&&t==="line"){const a=qe(e[s]);if(a==null?void 0:a.aggregate)return y(sd),r}if(s===ce&&(n?"fill"in e:"stroke"in e))return y(Sa("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if(s===Mn||s===zn&&!j(o)&&!Ee(o)||s===Rt&&j(o))o&&(r[s]=V(o).reduce((a,c)=>(x(c)?a.push(ws(c,s)):y(qr(c,s)),a),[]));else{if(s===Rt&&o===null)r[s]=null;else if(!x(o)&&!wt(o)&&!Ee(o)&&!vs(o)&&!E(o))return y(qr(o,s)),r;r[s]=pc(o,s,i)}return r},{})}function Vi(e,t){const n={};for(const i of b(e)){const r=pc(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function hp(e){const t=[];for(const n of b(e))if(qt(e,n)){const i=e[n],r=V(i);for(const s of r)x(s)?t.push(s):zi(s)&&t.push(s.condition)}return t}function ks(e,t,n){if(!e)return;for(const i of b(e)){const r=e[i];if(j(r))for(const s of r)t.call(n,s,i);else t.call(n,r,i)}}function mp(e,t,n,i){return e?b(e).reduce((r,s)=>{const o=e[s];return j(o)?o.reduce((a,c)=>t.call(i,a,c,s),r):t.call(i,r,o,s)},n):n}function $c(e,t){return b(t).reduce((n,i)=>{switch(i){case q:case Q:case vi:case Si:case xi:case xe:case Fe:case Se:case nt:case Ae:case tt:case Te:case Ie:case _e:case he:case Ln:case le:case It:case Rt:return n;case zn:if(e==="line"||e==="trail")return n;case Mn:case Oi:{const r=t[i];if(j(r)||x(r))for(const s of V(r))s.aggregate||n.push(v(s,{}));return n}case it:if(e==="trail")return n;case ce:case Re:case Le:case rt:case ht:case mt:case yt:case bt:{const r=qe(t[i]);return r&&!r.aggregate&&n.push(v(r,{})),n}}},[])}var kc=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function bp(e){const{tooltip:t}=e,n=kc(e,["tooltip"]);if(!t)return{filteredEncoding:n};let i,r;if(j(t)){for(const s of t)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return j(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function Ns(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:o,titlePrefix:a})=>{const c=i?` of ${Ps(t)}`:"";return{field:o+t.field,type:t.type,title:E(a)?{signal:a+`"${escape(c)}"`}:a+c}}),s=hp(n).map(ep);return{tooltip:[...r,...Ce(s,I)]}}function Ps(e){const{title:t,field:n}=e;return X(t,n)}function Cs(e,t,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:c,positionPrefix:l,endPositionPrefix:u=void 0,extraEncoding:f={}})=>{const d=Ps(n);return Nc(e,a,r,{mark:c,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:l+"_"+n.field,type:n.type},d!==void 0?{title:d}:{}),s!==void 0?{scale:s}:{}),o!==void 0?{axis:o}:{})},A(u)?{[t+"2"]:{field:u+"_"+n.field}}:{}),i),f)})}}function Nc(e,t,n,i){const{clip:r,color:s,opacity:o}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),r?{clip:r}:{}),s?{color:s}:{}),o?{opacity:o}:{}),ot(i.mark)?i.mark:{type:i.mark}),{style:`${a}-${t}`}),Nn(e[t])?{}:e[t])})]:[]}function Pc(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",s=i[r],o=i[r+"2"],a=i[r+"Error"],c=i[r+"Error2"];return{continuousAxisChannelDef:Xi(s,n),continuousAxisChannelDef2:Xi(o,n),continuousAxisChannelDefError:Xi(a,n),continuousAxisChannelDefError2:Xi(c,n),continuousAxis:r}}function Xi(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=kc(e,["aggregate"]);return n!==t&&y(Ad(n,t)),i}else return e}function Cc(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(ot(n)&&n.orient)return n.orient;if(Be(r)){if(Be(s)){const o=x(r)&&r.aggregate,a=x(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return gn(s)&&!gn(r)?"horizontal":"vertical"}return"horizontal"}else{if(Be(s))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}var Yi=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Ki="boxplot",yp=["box","median","outliers","rule","ticks"],Op=new Gi(Ki,Ac);function Fc(e){return Y(e)?"tukey":e}function Ac(e,{config:t}){var n,i;e=Object.assign(Object.assign({},e),{encoding:Vi(e.encoding,t)});const{mark:r,encoding:s,selection:o,projection:a}=e,c=Yi(e,["mark","encoding","selection","projection"]),l=ot(r)?r:{type:r};o&&y(ba("boxplot"));const u=(n=l.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=L("size",l,t),d=Fc(u),{bins:g,timeUnits:p,transform:m,continuousAxisChannelDef:h,continuousAxis:S,groupby:O,aggregate:_,encodingWithoutContinuousAxis:$,ticksOrient:P,boxOrient:T,customTooltipWithoutAggregatedField:N}=vp(e,u,t),{color:C,size:pe}=$,Pe=Yi($,["color","size"]),ci=Ku=>Cs(l,S,h,Ku,t.boxplot),Ye=ci(Pe),Ao=ci($),wr=ci(Object.assign(Object.assign({},Pe),pe?{size:pe}:{})),wn=Ns([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],h,$),li={type:"tick",color:"black",opacity:1,orient:P,invalid:null,aria:!1},Jt=d==="min-max"?wn:Ns([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],h,$),ui=[...Ye({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:Jt}),...Ye({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:Jt}),...Ye({partName:"ticks",mark:li,positionPrefix:"lower_whisker",extraEncoding:Jt}),...Ye({partName:"ticks",mark:li,positionPrefix:"upper_whisker",extraEncoding:Jt})],En=[...d!=="tukey"?ui:[],...Ao({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:T,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:wn}),...wr({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},Z(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:P,aria:!1}),positionPrefix:"mid_box",extraEncoding:wn})];if(d==="min-max")return Object.assign(Object.assign({},c),{transform:((i=c.transform)!==null&&i!==void 0?i:[]).concat(m),layer:En});const $n=`datum["lower_box_${h.field}"]`,kn=`datum["upper_box_${h.field}"]`,fi=`(${kn} - ${$n})`,To=`${$n} - ${u} * ${fi}`,Io=`${kn} + ${u} * ${fi}`,di=`datum["${h.field}"]`,Vu={joinaggregate:Tc(h.field),groupby:O},Ro={transform:[{filter:`(${To} <= ${di}) && (${di} <= ${Io})`},{aggregate:[{op:"min",field:h.field,as:"lower_whisker_"+h.field},{op:"max",field:h.field,as:"upper_whisker_"+h.field},{op:"min",field:"lower_box_"+h.field,as:"lower_box_"+h.field},{op:"max",field:"upper_box_"+h.field,as:"upper_box_"+h.field},..._],groupby:O}],layer:ui},Xu=Yi(Pe,["tooltip"]),{scale:Lo,axis:Yu}=h,zo=Ps(h),Mo=fe(Yu,["title"]),Do=Nc(l,"outliers",t.boxplot,{transform:[{filter:`(${di} < ${To}) || (${di} > ${Io})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[S]:Object.assign(Object.assign(Object.assign({field:h.field,type:h.type},zo!==void 0?{title:zo}:{}),Lo!==void 0?{scale:Lo}:{}),z(Mo)?{}:{axis:Mo})},Xu),C?{color:C}:{}),N?{tooltip:N}:{})})[0];let gi;const Uo=[...g,...p,Vu];return Do?gi={transform:Uo,layer:[Do,Ro]}:(gi=Ro,gi.transform.unshift(...Uo)),Object.assign(Object.assign({},c),{layer:[gi,{transform:m,layer:En}]})}function Tc(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function vp(e,t,n){const i=Cc(e,Ki),{continuousAxisChannelDef:r,continuousAxis:s}=Pc(e,i,Ki),o=r.field,a=Fc(t),c=[...Tc(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],u=e.encoding,f=s,d=u[f],g=Yi(u,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:m}=bp(g),{bins:h,timeUnits:S,aggregate:O,groupby:_,encoding:$}=Ec(m,n),P=i==="vertical"?"horizontal":"vertical",T=i,N=[...h,...S,{aggregate:[...O,...c],groupby:_},...l];return{bins:h,timeUnits:S,transform:N,groupby:_,aggregate:O,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:$,ticksOrient:P,boxOrient:T,customTooltipWithoutAggregatedField:p}}var Ic=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Fs="errorbar",xp=["ticks","rule"],Sp=new Gi(Fs,Rc);function Rc(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Vi(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:c,tooltipEncoding:l}=Lc(e,Fs,t);delete s.size;const u=Cs(a,r,i,s,t.errorbar),f=a.thickness,d=a.size,g=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},f!==void 0?{thickness:f}:{}),d!==void 0?{size:d}:{}),p=[...u({partName:"ticks",mark:g,positionPrefix:"lower",extraEncoding:l}),...u({partName:"ticks",mark:g,positionPrefix:"upper",extraEncoding:l}),...u({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},f!==void 0?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},c),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function _p(e,t){const{encoding:n}=e;if(jp(n))return{orient:Cc(e,t),inputType:"raw"};const i=wp(n),r=Ep(n),s=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,c=n.y2;if(k(a)&&k(c))throw new Error(`${t} cannot have both x2 and y2`);if(k(a)){if(Be(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(k(c)){if(Be(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,c=n.xError2,l=n.yError,u=n.yError2;if(k(c)&&!k(a))throw new Error(`${t} cannot have xError2 without xError`);if(k(u)&&!k(l))throw new Error(`${t} cannot have yError2 without yError`);if(k(a)&&k(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(k(a)){if(Be(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(k(l)){if(Be(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function jp(e){return(k(e.x)||k(e.y))&&!k(e.x2)&&!k(e.y2)&&!k(e.xError)&&!k(e.xError2)&&!k(e.yError)&&!k(e.yError2)}function wp(e){return k(e.x2)||k(e.y2)}function Ep(e){return k(e.xError)||k(e.xError2)||k(e.yError)||k(e.yError2)}function Lc(e,t,n){var i;const{mark:r,encoding:s,selection:o,projection:a}=e,c=Ic(e,["mark","encoding","selection","projection"]),l=ot(r)?r:{type:r};o&&y(ba(t));const{orient:u,inputType:f}=_p(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:g,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:h}=Pc(e,u,t),{errorBarSpecificAggregate:S,postAggregateCalculates:O,tooltipSummary:_,tooltipTitleWithFieldName:$}=$p(l,d,g,p,m,f,t,n),P=s,T=h,N=P[T],C=h==="x"?"x2":"y2",pe=P[C],Pe=h==="x"?"xError":"yError",ci=P[Pe],Ye=h==="x"?"xError2":"yError2",Ao=P[Ye],wr=Ic(P,[typeof T=="symbol"?T:T+"",typeof C=="symbol"?C:C+"",typeof Pe=="symbol"?Pe:Pe+"",typeof Ye=="symbol"?Ye:Ye+""]),{bins:wn,timeUnits:li,aggregate:Jt,groupby:ui,encoding:En}=Ec(wr,n),$n=[...Jt,...S],kn=f!=="raw"?[]:ui,fi=Ns(_,d,En,$);return{transform:[...(i=c.transform)!==null&&i!==void 0?i:[],...wn,...li,...$n.length===0?[]:[{aggregate:$n,groupby:kn}],...O],groupby:kn,continuousAxisChannelDef:d,continuousAxis:h,encodingWithoutContinuousAxis:En,ticksOrient:u==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:c,tooltipEncoding:fi}}function $p(e,t,n,i,r,s,o,a){let c=[],l=[];const u=t.field;let f,d=!1;if(s==="raw"){const g=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,p=e.extent?e.extent:g==="mean"?"stderr":"iqr";if(g==="median"!==(p==="iqr")&&y(Fd(g,p,o)),p==="stderr"||p==="stdev")c=[{op:p,field:u,as:"extent_"+u},{op:g,field:u,as:"center_"+u}],l=[{calculate:`datum["center_${u}"] + datum["extent_${u}"]`,as:"upper_"+u},{calculate:`datum["center_${u}"] - datum["extent_${u}"]`,as:"lower_"+u}],f=[{fieldPrefix:"center_",titlePrefix:An(g)},{fieldPrefix:"upper_",titlePrefix:zc(g,p,"+")},{fieldPrefix:"lower_",titlePrefix:zc(g,p,"-")}],d=!0;else{let m,h,S;p==="ci"?(m="mean",h="ci0",S="ci1"):(m="median",h="q1",S="q3"),c=[{op:h,field:u,as:"lower_"+u},{op:S,field:u,as:"upper_"+u},{op:m,field:u,as:"center_"+u}],f=[{fieldPrefix:"upper_",titlePrefix:dn({field:u,aggregate:S,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:dn({field:u,aggregate:h,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:dn({field:u,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&y(Cd(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:"upper_"+u},{calculate:`datum["${u}"]`,as:"lower_"+u}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:u}],l=[{calculate:`datum["${u}"] + datum["${i.field}"]`,as:"upper_"+u}],r?l.push({calculate:`datum["${u}"] + datum["${r.field}"]`,as:"lower_"+u}):l.push({calculate:`datum["${u}"] - datum["${i.field}"]`,as:"lower_"+u}));for(const g of l)f.push({fieldPrefix:g.as.substring(0,6),titlePrefix:Tt(Tt(g.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:c,tooltipSummary:f,tooltipTitleWithFieldName:d}}function zc(e,t,n){return An(e)+" "+n+" "+t}const As="errorband",kp=["band","borders"],Np=new Gi(As,Mc);function Mc(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Vi(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:c}=Lc(e,As,t),l=o,u=Cs(l,r,i,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},g={type:f?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),g=Object.assign(Object.assign(Object.assign({},g),p),{aria:!1})):l.interpolate?y(Ea("interpolate")):l.tension&&y(Ea("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...u({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c}),...u({partName:"borders",mark:g,positionPrefix:"lower",extraEncoding:c}),...u({partName:"borders",mark:g,positionPrefix:"upper",extraEncoding:c})]})}const Dc={};function Ts(e,t,n){const i=new Gi(e,t);Dc[e]={normalizer:i,parts:n}}function Pp(){return b(Dc)}Ts(Ki,Ac,yp),Ts(Fs,Rc,xp),Ts(As,Mc,kp);const Cp=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],Uc={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},Wc={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Fp=b(Uc),Ap=b(Wc),Tp={header:1,headerRow:1,headerColumn:1,headerFacet:1},Bc=b(Tp),qc=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Ip={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},Rp={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1};var Lp=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Hc(e){const t=[];for(const n of e||[]){const{expr:i,bind:r}=n,s=Lp(n,["expr","bind"]);if(r&&i){const o=Object.assign(Object.assign({},s),{bind:r,init:i});t.push(o)}else{const o=Object.assign(Object.assign(Object.assign({},s),i?{update:i}:{}),r?{bind:r}:{});t.push(o)}}return t}const pn="_vgsid_",zp={single:{on:"click",fields:[pn],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[pn],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Is(e){return!!e&&(e==="legend"||!!e.legend)}function Rs(e){return Is(e)&&Z(e)}function Mp(e){return Qi(e)||zs(e)||Ls(e)}function Ls(e){return"concat"in e}function Qi(e){return"vconcat"in e}function zs(e){return"hconcat"in e}function He(e){return Z(e)&&e.step!==void 0}function Gc(e){return e.view||e.width||e.height}const Vc=20,Dp={align:1,bounds:1,center:1,columns:1,spacing:1},Up=b(Dp);function Wp(e,t,n){var i,r;const s=n[t],o={},{spacing:a,columns:c}=s;a!==void 0&&(o.spacing=a),c!==void 0&&((Li(e)&&!Hn(e.facet)||Ls(e))&&(o.columns=c)),Qi(e)&&(o.columns=1);for(const l of Up)if(e[l]!==void 0)if(l==="spacing"){const u=e[l];o[l]=Y(u)?u:{row:(i=u.row)!==null&&i!==void 0?i:a,column:(r=u.column)!==null&&r!==void 0?r:a}}else o[l]=e[l];return o}var Bp=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Ms(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function Ji(e,t){const n=Xn(e,t);return He(n)?n.step:Ds}function Xn(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return X(i,{step:e.step})}const Ds=20,qp={continuousWidth:200,continuousHeight:200,step:Ds},Hp={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:qp,mark:zg,arc:{},area:{},bar:Ug,circle:{},geoshape:{},image:{},line:{},point:{},rect:Wg,rule:{color:"black"},square:{},text:{color:"black"},tick:Bg,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:Sg,projection:{},legend:Ip,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:zp,style:{},title:{},facet:{spacing:Vc},concat:{spacing:Vc}},lt=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],Xc={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},Yc={blue:lt[0],orange:lt[1],red:lt[2],teal:lt[3],green:lt[4],yellow:lt[5],purple:lt[6],pink:lt[7],brown:lt[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Gp(e={}){return{signals:[{name:"color",value:Z(e)?Object.assign(Object.assign({},Yc),e):Yc}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Vp(e){return{signals:[{name:"fontSize",value:Z(e)?Object.assign(Object.assign({},Xc),e):Xc}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Xp(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function Kc(e){const t=b(e||{}),n={};for(const i of t){const r=e[i];n[i]=In(r)?bc(r):oe(r)}return n}function Yp(e){const t=b(e),n={};for(const i of t)n[i]=Kc(e[i]);return n}const Kp=[...Ga,...ea,...Bc,"background","padding","legend","lineBreak","scale","style","title","view"];function Qc(e={}){const{color:t,font:n,fontSize:i}=e,r=Bp(e,["color","font","fontSize"]),s=Wo({},Hp,n?Xp(n):{},t?Gp(t):{},i?Vp(i):{},r||{}),o=fe(s,Kp);for(const a of["background","lineBreak","padding"])s[a]&&(o[a]=oe(s[a]));for(const a of Ga)s[a]&&(o[a]=we(s[a]));for(const a of ea)s[a]&&(o[a]=Kc(s[a]));for(const a of Bc)s[a]&&(o[a]=we(s[a]));return s.legend&&(o.legend=we(s.legend)),s.scale&&(o.scale=we(s.scale)),s.style&&(o.style=Yp(s.style)),s.title&&(o.title=we(s.title)),s.view&&(o.view=we(s.view)),o}const Qp=["view",...qa],Jp=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Zp=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},Lg);function eh(e){e=F(e);for(const t of Jp)delete e[t];if(e.axis)for(const t in e.axis)In(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Cp)delete e.legend[t];if(e.mark){for(const t of Ha)delete e.mark[t];e.mark.tooltip&&Z(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(Hc(e.params)),delete e.params);for(const t of Qp){for(const i of Ha)delete e[t][i];const n=Zp[t];if(n)for(const i of n)delete e[t][i];nh(e,t)}for(const t of Pp())delete e[t];th(e);for(const t in e)Z(e[t])&&z(e[t])&&delete e[t];return z(e)?void 0:e}function th(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=mc(e.title);z(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),z(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),z(i)?delete e.title:e.title=i}function nh(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},r),e.style[n??t]);z(s)||(e.style[n??t]=s),i||delete e[t]}function Zi(e){return"layer"in e}function ih(e){return"repeat"in e}function rh(e){return!j(e.repeat)&&e.repeat.layer}var sh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class oh{map(t,n){return Li(t)?this.mapFacet(t,n):ih(t)?this.mapRepeat(t,n):zs(t)?this.mapHConcat(t,n):Qi(t)?this.mapVConcat(t,n):Ls(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(Zi(t))return this.mapLayer(t,n);if(ct(t))return this.mapUnit(t,n);throw new Error(Wr(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(i=>this.map(i,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(i=>this.map(i,n))})}mapConcat(t,n){const{concat:i}=t,r=sh(t,["concat"]);return Object.assign(Object.assign({},r),{concat:i.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const ah={zero:1,center:1,normalize:1};function ch(e){return e in ah}const lh=new Set([Da,Pi,Ni,Ai,Fi,us,fs,Ci,Ua,ls]),uh=new Set([Pi,Ni,Da]);function Jc(e,t){var n,i;const r=t==="x"?"y":"radius",s=e[t],o=e[r];if(x(s)&&x(o))if(jt(s)==="quantitative"&&jt(o)==="quantitative"){if(s.stack)return t;if(o.stack)return r;const a=x(s)&&!!s.aggregate,c=x(o)&&!!o.aggregate;if(a!==c)return a?t:r;{const l=(n=s.scale)===null||n===void 0?void 0:n.type,u=(i=o.scale)===null||i===void 0?void 0:i.type;if(l&&l!=="linear")return r;if(u&&u!=="linear")return t}}else{if(jt(s)==="quantitative")return t;if(jt(o)==="quantitative")return r}else{if(jt(s)==="quantitative")return t;if(jt(o)==="quantitative")return r}return}function fh(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function Zc(e,t,n={}){const i=ot(e)?e.type:e;if(!lh.has(i))return null;const r=Jc(t,"x")||Jc(t,"theta");if(!r)return null;const s=t[r],o=x(s)?v(s,{}):void 0;let a=fh(r),c=t[a],l=x(c)?v(c,{}):void 0;l===o&&(l=void 0,c=void 0,a=void 0);const u=Cf.reduce((d,g)=>{if(g!=="tooltip"&&qt(t,g)){const p=t[g];for(const m of V(p)){const h=qe(m);if(h.aggregate)continue;const S=v(h,{});(!S||S!==l)&&d.push({channel:g,fieldDef:h})}}return d},[]);let f;if(s.stack!==void 0?Nn(s.stack)?f=s.stack?"zero":null:f=s.stack:u.length>0&&uh.has(i)&&(f="zero"),!f||!ch(f))return null;if($s(t)&&u.length===0)return null;if(s.scale&&s.scale.type&&s.scale.type!==K.LINEAR){if(n.disallowNonLinearStack)return null;y(kd(s.scale.type))}return k(t[ze(r)])?(s.stack!==void 0&&y($d(r)),null):(x(s)&&s.aggregate&&!w(yf,s.aggregate)&&y(Nd(s.aggregate)),{groupbyChannel:c?a:void 0,groupbyField:l,fieldChannel:r,impute:s.impute===null?!1:_t(i),stackBy:u,offset:f})}var el=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function dh(e){const t=el(e,["point","line"]);return b(t).length>1?t:t.type}function gh(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:fe(e[t],["point","line"])}));return e}function Us(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?Z(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?Z(t.point)?t.point:{}:void 0}function tl(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class ph{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(ct(t)){const{mark:i,encoding:r}=t,s=ot(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!Us(s,n[s.type],r);case"area":return!!Us(s,n[s.type],r)||!!tl(s,n[s.type])}}return!1}run(t,n,i){const{config:r}=n,{selection:s,projection:o,mark:a,encoding:c}=t,l=el(t,["selection","projection","mark","encoding"]),u=Vi(c,r),f=ot(a)?a:{type:a},d=Us(f,r[f.type],u),g=f.type==="area"&&tl(f,r[f.type]),p=[Object.assign(Object.assign({},s?{selection:s}:{}),{mark:dh(Object.assign(Object.assign({},f.type==="area"&&f.opacity===void 0&&f.fillOpacity===void 0?{opacity:.7}:{}),f)),encoding:fe(u,["shape"])})],m=Zc(f,u);let h=u;if(m){const{fieldChannel:S,offset:O}=m;h=Object.assign(Object.assign({},u),{[S]:Object.assign(Object.assign({},u[S]),O?{stack:O}:{})})}return g&&p.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},rn(f,["clip","interpolate","tension","tooltip"])),g),encoding:h})),d&&p.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},rn(f,["clip","tooltip"])),d),encoding:h})),i(Object.assign(Object.assign({},l),{layer:p}),Object.assign(Object.assign({},n),{config:gh(r)}))}}var nl=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class hh{constructor(){this.name="RangeStep"}hasMatchingType(t){var n;if(ct(t)&&t.encoding)for(const i of be){const r=t.encoding[i];if(r&&k(r)&&((n=r==null?void 0:r.scale)===null||n===void 0?void 0:n.rangeStep))return!0}return!1}run(t){var n;const i={};let r=Object.assign({},t.encoding);for(const s of be){const o=Me(s),a=r[s];if(a&&k(a)&&((n=a==null?void 0:a.scale)===null||n===void 0?void 0:n.rangeStep)){const{scale:c}=a,l=nl(a,["scale"]),u=c,f=nl(u,["rangeStep"]);i[o]={step:c.rangeStep},y(dd),r=Object.assign(Object.assign({},r),{[s]:Object.assign(Object.assign({},l),z(f)?{}:{scale:f})})}}return Object.assign(Object.assign(Object.assign({},i),t),{encoding:r})}}var mh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function bh(e,t){return t?Hn(e)?ol(e,t):il(e,t):e}function Ws(e,t){return t?ol(e,t):e}function Bs(e,t,n){const i=t[e];if(Jg(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});y(Xf(i.repeat));return}return t}function il(e,t){if(e=Bs("field",e,t),e===void 0)return;if(e===null)return null;if(ys(e)&&We(e.sort)){const n=Bs("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}function rl(e,t){if(x(e))return il(e,t);{const n=Bs("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function sl(e,t){if(k(e)){const n=rl(e,t);if(n)return n;if(vs(e))return{condition:e.condition}}else{if(Mi(e)){const n=rl(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const i=mh(e,["condition"]);return i}}return e}return}function ol(e,t){const n={};for(const i in e)if(Zt(e,i)){const r=e[i];if(j(r))n[i]=r.map(s=>sl(s,t)).filter(s=>s);else{const s=sl(r,t);s!==void 0&&(n[i]=s)}}return n}class yh{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(ct(t)){const{encoding:n,mark:i}=t;if(i==="line")for(const r of Nf){const s=Lt(r),o=n[s];if(n[r]&&(x(o)&&!ie(o.bin)||wt(o)))return!0}}return!1}run(t,n,i){const{encoding:r}=t;return y(ud(!!r.x2,!!r.y2)),i(Object.assign(Object.assign({},t),{mark:"rule"}),n)}}var $t=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Oh extends oh{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[Op,Sp,Np,new ph,new yh,new hh]}map(t,n){if(ct(t)){const i=qt(t.encoding,Ze),r=qt(t.encoding,et),s=qt(t.encoding,yi);if(i||r||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,s=Ws(t.encoding,n.repeater),o=Object.assign(Object.assign({},t),s?{encoding:s}:{});if(i||r)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const c of this.nonFacetUnitNormalizers)if(c.hasMatchingType(o,n.config))return c.run(o,n,a);return o}mapRepeat(t,n){return rh(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r}=t,s=$t(t,["repeat","spec"]),{row:o,column:a,layer:c}=i,{repeater:l={},repeaterPrefix:u=""}=n;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:c},spec:r}}),n):Object.assign(Object.assign({},s),{layer:c.map(f=>{const d=Object.assign(Object.assign({},l),{layer:f}),g=(r.name||"")+u+`child__layer_${W(f)}`,p=this.mapLayerOrUnit(r,Object.assign(Object.assign({},n),{repeater:d,repeaterPrefix:g}));return p.name=g,p})})}mapNonLayerRepeat(t,n){var i;const{repeat:r,spec:s,data:o}=t,a=$t(t,["repeat","spec","data"]);!j(r)&&t.columns&&(t=fe(t,["columns"]),y(ya("repeat")));const c=[],{repeater:l={},repeaterPrefix:u=""}=n,f=!j(r)&&r.row||[l?l.row:null],d=!j(r)&&r.column||[l?l.column:null],g=j(r)&&r||[l?l.repeat:null];for(const m of g)for(const h of f)for(const S of d){const O={repeat:m,row:h,column:S,layer:l.layer},_=(s.name||"")+u+"child__"+(j(r)?`${W(m)}`:(r.row?`row_${W(h)}`:"")+(r.column?`column_${W(S)}`:"")),$=this.map(s,Object.assign(Object.assign({},n),{repeater:O,repeaterPrefix:_}));$.name=_,c.push(fe($,["data"]))}const p=j(r)?t.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(i=s.data)!==null&&i!==void 0?i:o,align:"all"},a),{columns:p,concat:c})}mapFacet(t,n){const{facet:i}=t;return Hn(i)&&t.columns&&(t=fe(t,["columns"]),y(ya("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:s,parentProjection:o,config:a}=n,c=cl({parentProjection:o,projection:r}),l=al({parentEncoding:s,encoding:Ws(i,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),c?{projection:c}:{}),l?{encoding:l}:{}),{config:a})}mapFacetedUnit(t,n){const i=t.encoding,{row:r,column:s,facet:o}=i,a=$t(i,["row","column","facet"]),{mark:c,width:l,projection:u,height:f,view:d,selection:g,encoding:p}=t,m=$t(t,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:h,layout:S}=this.getFacetMappingAndLayout({row:r,column:s,facet:o},n),O=Ws(a,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},m),S),{facet:h,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),f?{height:f}:{}),d?{view:d}:{}),u?{projection:u}:{}),{mark:c,encoding:O}),g?{selection:g}:{})}),n)}getFacetMappingAndLayout(t,n){var i;const{row:r,column:s,facet:o}=t;if(r||s){o&&y(cd([...r?[Ze]:[],...s?[et]:[]]));const a={},c={};for(const l of[Ze,et]){const u=t[l];if(u){const f=$t(u,["align","center","spacing","columns"]);a[l]=f;for(const d of["align","center","spacing"])u[d]!==void 0&&(c[d]=(i=c[d])!==null&&i!==void 0?i:{},c[d][l]=u[d])}}return{facetMapping:a,layout:c}}else{const{align:a,center:c,spacing:l,columns:u}=o,f=$t(o,["align","center","spacing","columns"]);return{facetMapping:bh(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),c?{center:c}:{}),l?{spacing:l}:{}),u?{columns:u}:{})}}}mapLayer(t,n){var{parentEncoding:i,parentProjection:r}=n,s=$t(n,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,c=$t(t,["encoding","projection"]),l=Object.assign(Object.assign({},s),{parentEncoding:al({parentEncoding:i,encoding:o,layer:!0}),parentProjection:cl({parentProjection:r,projection:a})});return super.mapLayer(c,l)}}function al({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...b(e),...b(t)]);for(const s of r){const o=t[s],a=e[s];if(k(o)){const c=Object.assign(Object.assign({},a),o);i[s]=c}else Mi(o)?i[s]=Object.assign(Object.assign({},o),{condition:Object.assign(Object.assign({},a),o.condition)}):o||o===null?i[s]=o:(n||Ee(a)||E(a)||k(a)||j(a))&&(i[s]=a)}}else i=t;return!i||z(i)?void 0:i}function cl(e){const{parentProjection:t,projection:n}=e;return t&&n&&y(ed({parentProjection:t,projection:n})),n??t}function ll(e,t){t===void 0&&(t=Qc(e.config));const n=xh(e,t),{width:i,height:r}=e,s=Sh(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const vh=new Oh;function xh(e,t={}){return vh.map(e,{config:t})}function ul(e){return A(e)?{type:e}:e??{}}function Sh(e,t,n){let{width:i,height:r}=t;const s=ct(e)||Zi(e),o={};s?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(y(ga("width")),i=void 0),r=="container"&&(y(ga("height")),r=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?ul(n.autosize):{}),ul(e.autosize));return a.type==="fit"&&!s&&(y(Mf),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&y(pa("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&y(pa("height")),nn(a,{type:"pad"})?void 0:a}function _h(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function jh(e){return e?`fit-${_i(e)}`:"fit"}const wh=["background","padding"];function fl(e,t){const n={};for(const i of wh)e&&e[i]!==void 0&&(n[i]=oe(e[i]));return t&&(n.params=e.params),n}class ut{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new ut(F(this.explicit),F(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return X(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,n){n.value!==void 0&&this.set(t,n.value,n.explicit)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,n){n.explicit[t]!==void 0?this.set(t,n.explicit[t],!0):n.implicit[t]!==void 0&&this.set(t,n.implicit[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of b(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function ft(e){return{explicit:!0,value:e}}function de(e){return{explicit:!1,value:e}}function dl(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:er(t,n,i,r)}}function er(e,t,n,i){return e.explicit&&t.explicit&&y(vd(n,i,e.value,t.value)),e}function kt(e,t,n,i,r=er){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:nn(e.value,t.value)?e:r(e,t,n,i)}class Eh extends ut{constructor(t={},n={},i=!1){super(t,n);this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function Yn(e){return"url"in e}function tr(e){return"values"in e}function gl(e){return"name"in e&&!Yn(e)&&!tr(e)&&!Ht(e)}function Ht(e){return e&&(pl(e)||hl(e)||qs(e))}function pl(e){return"sequence"in e}function hl(e){return"sphere"in e}function qs(e){return"graticule"in e}var D;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(D||(D={}));function ml(e){return"filter"in e}function $h(e){return(e==null?void 0:e.stop)!==void 0}function kh(e){return"lookup"in e}function Nh(e){return"data"in e}function Ph(e){return"selection"in e}function Ch(e){return"pivot"in e}function Fh(e){return"density"in e}function Ah(e){return"quantile"in e}function Th(e){return"regression"in e}function Ih(e){return"loess"in e}function Rh(e){return"sample"in e}function Lh(e){return"window"in e}function zh(e){return"joinaggregate"in e}function Mh(e){return"flatten"in e}function Dh(e){return"calculate"in e}function Uh(e){return"bin"in e}function Wh(e){return"impute"in e}function Bh(e){return"timeUnit"in e}function qh(e){return"aggregate"in e}function Hh(e){return"stack"in e}function Gh(e){return"fold"in e}function Vh(e){return e.map(t=>ml(t)?{filter:hi(t.filter,ag)}:t)}function hn(e,t,n,i){const r=vs(t)&&t.condition,s=i(t);if(r){const o=V(r),a=o.map(c=>{const l=i(c),u=Qg(c)?Bl(e,c.selection):ar(e,c.test);return Object.assign({test:u},l)});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function Hs(e,t="text"){const n=e.encoding[t];return hn(e,n,t,i=>nr(i,e.config))}function nr(e,t,n="datum"){if(e){if(Ee(e))return H(e.value);if(k(e)){const{format:i,formatType:r}=Ui(e);return ps({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}return}function bl(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,o=n.tooltip;if(j(o))return{tooltip:Ol({tooltip:o},s,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return hn(e,o,"tooltip",c=>{const l=nr(c,r,a);if(l)return l;if(c===null)return;let u=L("tooltip",i,r);return u===!0&&(u={content:"encoding"}),A(u)?{value:u}:Z(u)?E(u)?u:u.content==="encoding"?Ol(n,s,r,t):{signal:a}:void 0})}}function yl(e,t,n,{reactiveGeom:i}={}){const r={},s=i?"datum.datum":"datum",o=[];function a(l,u){const f=Lt(u),d=Oe(l)?l:Object.assign(Object.assign({},l),{type:e[f].type}),g=d.title||js(d,n),p=V(g).join(", ");let m;if(De(u)){const h=u==="x"?"x2":"y2",S=qe(e[h]);if(ie(d.bin)&&S){const O=v(d,{expr:s}),_=v(S,{expr:s}),{format:$,formatType:P}=Ui(d);m=Ii(O,_,$,P,n),r[h]=!0}else if(t&&t.fieldChannel===u&&t.offset==="normalize"){const{format:O,formatType:_}=Ui(d);m=ps({fieldOrDatumDef:d,format:O,formatType:_,expr:s,config:n,normalizeStack:!0}).signal}}m=m??nr(d,n,s).signal,o.push({channel:u,key:p,value:m})}ks(e,(l,u)=>{x(l)?a(l,u):zi(l)&&a(l.condition,u)});const c={};for(const{channel:l,key:u,value:f}of o)!r[l]&&!c[u]&&(c[u]=f);return c}function Ol(e,t,n,{reactiveGeom:i}={}){const r=yl(e,t,n,{reactiveGeom:i}),s=Cn(r).map(([o,a])=>`"${o}": ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function Xh(e){const{markDef:t,config:n}=e,i=L("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),Yh(e)),Kh(e))}function Yh(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=L("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in ig?{}:{ariaRoleDescription:{value:t}}}function Kh(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return hn(e,s,"description",c=>nr(c,e.config));const o=L("description",n,i);if(o!=null)return{description:H(o)};if(i.aria===!1)return{};const a=yl(t,r,i);return z(a)?void 0:{description:{signal:Cn(a).map(([c,l],u)=>`"${u>0?"; ":""}${c}: " + (${l})`).join(" + ")}}}function ee(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:c}=n;a===void 0&&(c=c??L(e,i,s,{vgChannel:o,ignoreVgConfig:!0}),c!==void 0&&(a=H(c)));const l=r[e];return hn(t,l,o??e,u=>Ya({channel:e,channelDef:u,markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function vl(e,t={filled:void 0}){var n,i,r,s;const{markDef:o,encoding:a,config:c}=e,{type:l}=o,u=(n=t.filled)!==null&&n!==void 0?n:L("filled",o,c),f=w(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,d=(r=(i=L(u===!0?"color":void 0,o,c,{vgChannel:"fill"}))!==null&&i!==void 0?i:c.mark[u===!0&&"color"])!==null&&r!==void 0?r:f,g=(s=L(u===!1?"color":void 0,o,c,{vgChannel:"stroke"}))!==null&&s!==void 0?s:c.mark[u===!1&&"color"],p=u?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:H(d)}:{}),g?{stroke:H(g)}:{});return o.color&&(u?o.fill:o.stroke)&&y(Sa("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),ee("color",e,{vgChannel:p,defaultValue:u?d:g})),ee("fill",e,{defaultValue:a.fill?d:void 0})),ee("stroke",e,{defaultValue:a.stroke?g:void 0}))}function Qh(e){const{encoding:t,mark:n}=e,i=t.order;return!_t(n)&&Ee(i)?hn(e,i,"zindex",r=>H(r.value)):{}}function Kn(e,t){const n=Pf(e),i=t[n];return i||void 0}function te(e,t,{defaultPos:n,vgChannel:i,isMidPoint:r}){const{encoding:s,markDef:o,config:a,stack:c}=t,l=s[e],u=s[ze(e)],f=t.scaleName(e),d=t.getScaleComponent(e),g=Kn(e,o),p=Gs({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),m=!l&&De(e)&&(s.latitude||s.longitude)?{field:t.getName(e)}:Jh({channel:e,channelDef:l,channel2Def:u,markDef:o,config:a,isMidPoint:r,scaleName:f,scale:d,stack:c,offset:g,defaultRef:p});return m?{[i||e]:m}:void 0}function Jh(e){const{channel:t,channelDef:n,isMidPoint:i,scaleName:r,stack:s,offset:o,markDef:a,config:c}=e;if(k(n)&&s&&t===s.fieldChannel){if(x(n)){const l=Gn({channel:t,fieldDef:n,isMidPoint:i,markDef:a,stack:s,config:c});if(l!==void 0)return Ti({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",band:l,offset:o})}return Dt(n,r,{suffix:"end"},{offset:o})}return ds(e)}function Gs({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=e;return()=>{const a=Lt(n),c=Ot(n),l=L(n,s,o,{vgChannel:c});if(l!==void 0)return qn(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const u=r.get("type");if(!w([K.LOG,K.TIME,K.UTC],u)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const u=e[Me(n)];return Object.assign(Object.assign({},u),{mult:.5})}}return}}const Zh={left:"x",center:"xc",right:"x2"},em={top:"y",middle:"yc",bottom:"y2"};function xl(e,t,n,i="middle"){if(e==="radius"||e==="theta")return Ot(e);const r=e==="x"?"align":"baseline",s=L(r,t,n);let o;return E(s)?(y(ld(r)),o=void 0):o=s,e==="x"?Zh[o||(i==="top"?"left":"center")]:em[o||i]}function ir(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?Sl(e,t,{defaultPos:n,defaultPos2:i}):te(e,t,{defaultPos:n})}function Sl(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,o=ze(e),a=Me(e),c=tm(t,i,o),l=c[a]?xl(e,r,s):Ot(e);return Object.assign(Object.assign({},te(e,t,{defaultPos:n,vgChannel:l})),c)}function tm(e,t,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=e,c=Lt(n),l=Me(n),u=Ot(n),f=i[c],d=e.scaleName(c),g=e.getScaleComponent(c),p=n in i||n in s?Kn(n,e.markDef):Kn(c,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude))return{[u]:{field:e.getName(n)}};const m=nm({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:a,scaleName:d,scale:g,stack:o,offset:p,defaultRef:void 0});return m!==void 0?{[u]:m}:rr(n,s)||rr(n,{[n]:Hi(n,s,a.style),[l]:Hi(l,s,a.style)})||rr(n,a[r])||rr(n,a.mark)||{[u]:Gs({model:e,defaultPos:t,channel:n,scaleName:d,scale:g})()}}function nm({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l}){return k(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?Dt(t,s,{suffix:"start"},{offset:c}):ds({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:c,defaultRef:l})}function rr(e,t){const n=Me(e),i=Ot(e);return t[i]!==void 0?{[i]:qn(e,t[i])}:t[e]!==void 0?{[i]:qn(e,t[e])}:t[n]?{[n]:qn(e,t[n])}:void 0}function Nt(e,t,n){var i,r,s,o;const{config:a,encoding:c,markDef:l,stack:u}=e,f=ze(t),d=Me(t),g=c[t],p=c[f],m=e.getScaleComponent(t),h=m?m.get("type"):void 0,S=e.scaleName(t),O=l.orient,_=(r=(i=c[d])!==null&&i!==void 0?i:c.size)!==null&&r!==void 0?r:L("size",l,a,{vgChannel:d}),$=n==="bar"&&(t==="x"?O==="vertical":O==="horizontal");if(x(g)&&(B(g.bin)||ie(g.bin)||g.timeUnit&&!p)&&!_&&!ue(h)){const P=Gn({channel:t,fieldDef:g,stack:u,markDef:l,config:a}),T=(s=e.component.axes[t])===null||s===void 0?void 0:s[0],N=(o=T==null?void 0:T.get("translate"))!==null&&o!==void 0?o:.5;return sm({fieldDef:g,fieldDef2:p,channel:t,markDef:l,scaleName:S,band:P,axisTranslate:N,spacing:De(t)?L("binSpacing",l,a):void 0,reverse:m.get("reverse"),config:a})}else return(k(g)&&ue(h)||$)&&!p?rm(n,g,t,e):Sl(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function im(e,t,n,i,r,s){if(i){const c=i.get("type");if(c==="point"||c==="band"){if(r[e].discreteBandSize!==void 0)return{value:r[e].discreteBandSize};if(c===K.POINT){const l=i.get("range");return St(l)&&Y(l.step)?{value:l.step-2}:{value:Ds-2}}else return{scale:n,band:s}}else return{value:r[e].continuousBandSize}}const o=Ji(r.view,t),a=X(r[e].discreteBandSize,o-2);return a!==void 0?{value:a}:void 0}function rm(e,t,n,i){var r;const{markDef:s,encoding:o,config:a,stack:c}=i,l=s.orient,u=i.scaleName(n),f=i.getScaleComponent(n),d=Me(n),g=ze(n),p=l==="horizontal"&&n==="y"||l==="vertical"&&n==="x",m=L(p?"size":d,s,a,{vgChannel:d});let h;(o.size||m!==void 0)&&(p?h=ee("size",i,{vgChannel:d,defaultValue:m}):y(bd(s.type)));const S=(r=k(t)?Gn({channel:n,fieldDef:t,markDef:s,stack:c,config:a}):void 0)!==null&&r!==void 0?r:1;h=h||{[d]:im(e,d,u,f,a,S)};const O=(f==null?void 0:f.get("type"))!=="band"||!("band"in h[d]),_=xl(n,s,a,O?"middle":"top"),$=Kn(n,s),P=ds({channel:n,channelDef:t,markDef:s,config:a,scaleName:u,scale:f,stack:c,offset:$,defaultRef:Gs({model:i,defaultPos:"mid",channel:n,scaleName:u,scale:f}),band:O?.5:(1-S)/2});if(d)return Object.assign({[_]:P},h);{const T=Ot(g),N=h[d],C=$?Object.assign(Object.assign({},N),{offset:$}):N;return{[_]:P,[T]:j(P)?[P[0],Object.assign(Object.assign({},P[1]),{offset:C})]:Object.assign(Object.assign({},P),{offset:C})}}}function Qn(e,t,n,i,r){if(ia(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(E(n)||E(r)||E(i)){const o=at(n),a=at(r),c=at(i),l=c?`${c} + `:"",u=o?`(${o} ? -1 : 1) * `:"",f=a?`(${a} + ${s})`:s;return{signal:l+u+f}}else return r=r||0,i+(n?-r-s:+r+s)}function sm({fieldDef:e,fieldDef2:t,channel:n,band:i,scaleName:r,markDef:s,spacing:o=0,axisTranslate:a,reverse:c,config:l}){const u=ze(n),f=Ot(n),d=Ot(u),g=Kn(n,s);if(B(e.bin)||e.timeUnit)return{[d]:_l({channel:n,fieldDef:e,scaleName:r,markDef:s,band:(1-i)/2,offset:Qn(u,o,c,a,g),config:l}),[f]:_l({channel:n,fieldDef:e,scaleName:r,markDef:s,band:1-(1-i)/2,offset:Qn(n,o,c,a,g),config:l})};if(ie(e.bin)){const p=Dt(e,r,{},{offset:Qn(u,o,c,a,g)});if(x(t))return{[d]:p,[f]:Dt(t,r,{},{offset:Qn(n,o,c,a,g)})};if(Dn(e.bin)&&e.bin.step)return{[d]:p,[f]:{signal:`scale("${r}", ${v(e,{expr:"datum"})} + ${e.bin.step})`,offset:Qn(n,o,c,a,g)}}}y($a(u));return}function _l({channel:e,fieldDef:t,scaleName:n,markDef:i,band:r,offset:s,config:o}){const a=Ti({scaleName:n,fieldOrDatumDef:t,band:r,offset:s});return Xa({fieldDef:t,channel:e,markDef:i,ref:a,config:o})}const om=new Set(["aria"]);function ve(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?vl(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},am(e.markDef,t)),jl(e,"fill",n)),jl(e,"stroke",i)),ee("opacity",e)),ee("fillOpacity",e)),ee("strokeOpacity",e)),ee("strokeWidth",e)),ee("strokeDash",e)),Qh(e)),bl(e)),Hs(e,"href")),Xh(e))}function jl(e,t,n){const{config:i,mark:r,markDef:s}=e,o=L("invalid",s,i);if(o==="hide"&&n&&!_t(r)){const a=cm(e,{invalid:!0,channels:ji});if(a)return{[t]:[{test:a,value:null},...V(n)]}}return n?{[t]:n}:{}}function am(e,t){return ng.reduce((n,i)=>(!om.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=H(e[i])),n),{})}function cm(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const c=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&ye(c)&&(s[l]=!0)}return s},{}),r=b(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>gs(o,t)).join(` ${s} `)}return}function Vs(e){const{config:t,markDef:n}=e,i=L("invalid",n,t);if(i){const r=lm(e,{channels:be});if(r)return{defined:{signal:r}}}return{}}function lm(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const c=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&ye(c)&&(s[l]=!0)}return s},{}),r=b(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>gs(o,t)).join(` ${s} `)}return}function wl(e,t){return t!==void 0?{[e]:H(t)}:void 0}const Xs="voronoi",El={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(Xs)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if(_t(s))return y(Uf(s)),n;const o={name:e.getName(Xs),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},bl(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,c=!1;return n.forEach((l,u)=>{var f;const d=(f=l.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?a=u:d.indexOf(Xs)>=0&&(c=!0)}),c||n.splice(a+1,0,o),n}};class M{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.indexOf(t)>-1){y(Qf);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const i of this._children)i.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class ae extends M{constructor(t,n,i,r){super(t,n);this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${Vo()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}var $l=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Ge extends M{constructor(t,n){super(t);this.formula=n}clone(){return new Ge(null,F(this.formula))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{const{field:a,timeUnit:c}=s,l=G(n)?n.encoding[ze(o)]:void 0,u=G(n)&&Os(o,s,l,n.stack,n.markDef,n.config);if(c){const f=v(s,{forAs:!0});r[I({as:f,field:a,timeUnit:c})]=Object.assign({as:f,field:a,timeUnit:c},u?{band:!0}:{})}return r},{});return z(i)?null:new Ge(t,i)}static makeFromTransform(t,n){const i=Object.assign({},n),{timeUnit:r}=i,s=$l(i,["timeUnit"]),o=re(r),a=Object.assign(Object.assign({},s),{timeUnit:o});return new Ge(t,{[I(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)(!this.formula[n]||t.formula[n].band)&&(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of Cn(this.formula))t.has(r.as)||(n[i]=r);this.formula=n}producedFields(){return new Set(Ke(this.formula).map(t=>t.as))}dependentFields(){return new Set(Ke(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${I(this.formula)}`}assemble(){const t=[];for(const n of Ke(this.formula)){const{field:i,as:r,timeUnit:s}=n,o=re(s),{unit:a,utc:c}=o,l=$l(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:Qe(i),type:"timeunit"},a?{units:Yr(a)}:{}),c?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return t}}var um=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Jn="_tuple_fields";class fm{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const dm={has:()=>!0,parse:(e,t,n)=>{var i,r,s;const o=t.name,a=(i=t.project)!==null&&i!==void 0?i:t.project=new fm,c={},l={},u=new Set,f=(d,g)=>{const p=g==="visual"?d.channel:d.field;let m=W(`${o}_${p}`);for(let h=1;u.has(m);h++)m=W(`${o}_${p}_${h}`);return u.add(m),{[g]:m}};if(!n.fields&&!n.encodings){const d=e.config.selection[n.type];if(n.init)for(const g of V(n.init))for(const p of b(g))kf(p)?(n.encodings||(n.encodings=[])).push(p):n.type==="interval"?(y(Vf),n.encodings=d.encodings):(n.fields||(n.fields=[])).push(p);else n.encodings=d.encodings,n.fields=d.fields}for(const d of(r=n.fields)!==null&&r!==void 0?r:[]){const g={type:"E",field:d};g.signals=Object.assign({},f(g,"data")),a.items.push(g),a.hasField[d]=g}for(const d of(s=n.encodings)!==null&&s!==void 0?s:[]){const g=e.fieldDef(d);if(g){let p=g.field;if(g.aggregate){y(Df(d,g.aggregate));continue}else if(!p){y(ma(d));continue}if(g.timeUnit){p=e.vgField(d);const m={timeUnit:g.timeUnit,as:p,field:g.field};l[I(m)]=m}if(!c[p]){let m="E";if(t.type==="interval"){const S=e.getScaleComponent(d).get("type");ye(S)&&(m="R")}else g.bin&&(m="R-RE");const h={field:p,channel:d,type:m};h.signals=Object.assign(Object.assign({},f(h,"data")),f(h,"visual")),a.items.push(c[p]=h),a.hasField[p]=a.hasChannel[d]=c[p]}}else y(ma(d))}if(n.init){const d=g=>a.items.map(p=>g[p.channel]!==void 0?g[p.channel]:g[p.field]);if(n.type==="interval")t.init=d(n.init);else{const g=V(n.init);t.init=g.map(d)}}z(l)||(a.timeUnit=new Ge(null,l))},signals:(e,t,n)=>{const i=t.name+Jn,r=n.filter(s=>s.name===i);return r.length>0?n:n.concat({name:i,value:t.project.items.map(s=>{const o=um(s,["signals","hasLegend"]);return o.field=Qe(o.field),o})})}},kl={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!Is(e.bind),parse:(e,t,n,i)=>{i.on||delete t.events,i.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,o=t.init&&t.init[0],a=El.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((c,l)=>{var u,f;const d=W(`${i}_${c.field}`),g=n.filter(p=>p.name===d);g.length||n.unshift(Object.assign(Object.assign({name:d},o?{init:mn(o[l])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${R(c.field)}] : null`}]:[],bind:(f=(u=s[c.field])!==null&&u!==void 0?u:s[c.channel])!==null&&f!==void 0?f:s}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.filter(l=>l.name===i+Ve)[0],o=i+Jn,a=r.items.map(l=>W(`${i}_${l.field}`)),c=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(s.update=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},sr="_toggle",Nl={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+sr,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Ve,i=t.name+sr;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${dt(e)}}, `)+`${i} ? ${n} : null`}},gm={has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=A(n.clear)?tn(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(kl.has(t))for(const i of t.project.items){const r=n.findIndex(s=>s.name===W(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const r of t.project.items){const s=n.findIndex(o=>o.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(s=>s.name===t.name+Ve);i(r,"null"),Nl.has(t)&&(r=n.findIndex(s=>s.name===t.name+sr),i(r,"false"))}return n}},Pt={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!xt(r))continue;const s=e.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!ye(o)){y(Bf);continue}const a={selection:t.name,field:i.field};s.set("selectionExtent",a,!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||Ks(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let s=r.update;if(s.indexOf(Dl)>=0)r.update=`{${i.map(o=>`${R(o.field)}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const a=`${R(o.field)}: ${o.signals.data}`;s.indexOf(a)<0&&(s=`${s.substring(0,s.length-1)}, ${a}}`)}r.update=s}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!Ks(e))for(const i of t.scales){const r=n.filter(s=>s.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function Ys(e,t){const n=R(e.scaleName(t));return`domain(${n})`}function Ks(e){var t;return e.parent&&_n(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:Ks(e.parent.parent))}const Pl={has:e=>{const t=e.resolve==="global"&&e.bind&&Is(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==pn;return t&&!n&&y(qf),t&&n},parse:(e,t,n,i)=>{var r;if(i.on||delete t.events,i.clear||delete t.clear,i.on||i.clear){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const c of t.events)c.filter=V((r=c.filter)!==null&&r!==void 0?r:[]),c.filter.indexOf(a)<0&&c.filter.push(a)}const s=Rs(t.bind)?t.bind.legend:"click",o=A(s)?tn(s,"view"):V(s);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=Rs(t.bind)&&t.bind.legend,s=o=>a=>{const c=F(a);return c.markname=o,c};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${W(o.field)}_legend`,c=`${i}_${a}`,l=n.filter(u=>u.name===c);if(l.length===0){const u=r.merge.map(s(`${a}_symbols`)).concat(r.merge.map(s(`${a}_labels`))).concat(r.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:c},t.init?{}:{value:null}),{on:[{events:u,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${c}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(d=>d.name===i+Ve),o=i+Jn,a=r.items.filter(d=>d.hasLegend).map(d=>W(`${i}_${W(d.field)}_legend`)),c=a.map(d=>`${d} !== null`).join(" && "),l=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const u=n.find(d=>d.name===i+sr),f=Rs(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:f})):u.on[0].events=f),n}};function pm(e,t,n){var i;const r=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;Vt(e,s=>{var o,a;const c=(o=s.project.hasField[r])!==null&&o!==void 0?o:s.project.hasChannel[t];if(c&&Pl.has(s)){const l=(a=n.get("selections"))!==null&&a!==void 0?a:[];l.push(s.name),n.set("selections",l,!1),c.hasLegend=!0}})}const Cl="_translate_anchor",Fl="_translate_delta",hm={has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Pt.has(t),s=i+Cl,{x:o,y:a}=t.project.hasChannel;let c=tn(t.translate,"scope");return r||(c=c.map(l=>(l.between[0].markname=i+Zn,l))),n.push({name:s,value:{},on:[{events:c.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?", extent_x: "+(r?Ys(e,q):`slice(${o.signals.visual})`):"")+(a!==void 0?", extent_y: "+(r?Ys(e,Q):`slice(${a.signals.visual})`):"")+"}"}]},{name:i+Fl,value:{},on:[{events:c,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&Al(e,t,o,"width",n),a!==void 0&&Al(e,t,a,"height",n),n}};function Al(e,t,n,i,r){var s;const o=t.name,a=o+Cl,c=o+Fl,l=n.channel,u=Pt.has(t),f=r.filter($=>$.name===n.signals[u?"data":"visual"])[0],d=e.getSizeSignalRef(i).signal,g=e.getScaleComponent(l),p=g.get("type"),m=u&&l===q?"-":"",h=`${a}.extent_${l}`,S=`${m}${c}.${l} / `+(u?`${d}`:`span(${h})`),O=u?p==="log"?"panLog":p==="pow"?"panPow":"panLinear":"panLinear",_=`${O}(${h}, ${S}`+(u&&p==="pow"?`, ${(s=g.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";f.on.push({events:{signal:c},update:u?_:`clampRange(${_}, 0, ${d})`})}const Tl="_zoom_anchor",Il="_zoom_delta",mm={has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Pt.has(t),s=i+Il,{x:o,y:a}=t.project.hasChannel,c=R(e.scaleName(q)),l=R(e.scaleName(Q));let u=tn(t.zoom,"scope");return r||(u=u.map(f=>(f.markname=i+Zn,f))),n.push({name:i+Tl,on:[{events:u,update:r?"{"+[c?`x: invert(${c}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:u,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&Rl(e,t,o,"width",n),a!==void 0&&Rl(e,t,a,"height",n),n}};function Rl(e,t,n,i,r){var s;const o=t.name,a=n.channel,c=Pt.has(t),l=r.filter(O=>O.name===n.signals[c?"data":"visual"])[0],u=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(a),d=f.get("type"),g=c?Ys(e,a):l.name,p=o+Il,m=`${o}${Tl}.${a}`,h=c?d==="log"?"zoomLog":d==="pow"?"zoomPow":"zoomLinear":"zoomLinear",S=`${h}(${g}, ${m}, ${p}`+(c&&d==="pow"?`, ${(s=f.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";l.on.push({events:{signal:p},update:c?S:`clampRange(${S}, 0, ${u})`})}const bm=[dm,Nl,Pt,Pl,hm,mm,kl,El,gm];function or(e,t){for(const n of bm)n.has(e)&&t(n)}var ym=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function mn(e,t=!0,n=tf){if(j(e)){const i=e.map(r=>mn(r,t,n));return t?`[${i.join(", ")}]`:i}else if(zt(e))return n(t?Un(e):Hd(e));return t?n(JSON.stringify(e)):e}function Om(e,t){return Vt(e,(n,i)=>{const r=n.name;let s=i.modifyExpr(e,n);t.push(...i.signals(e,n)),or(n,o=>{o.signals&&(t=o.signals(e,n,t)),o.modifyExpr&&(s=o.modifyExpr(e,n,s))}),t.push({name:r+Pm,on:[{events:{signal:n.name+Ve},update:`modify(${R(n.name+Gt)}, ${s})`}]})}),Qs(t)}function vm(e,t){if(e.component.selection&&b(e.component.selection).length){const n=R(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:tn("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return Qs(t)}function xm(e,t){let n=!1;if(Vt(e,(i,r)=>{const s=i.name,o=R(s+Gt),a=t.filter(c=>c.name===s);if(a.length===0){const c=i.resolve==="global"?"union":i.resolve,l=i.type==="multi"?", true)":")";t.push({name:i.name,update:`${Dl}(${o}, ${R(c)}${l}`})}n=!0,r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),or(i,c=>{c.topLevelSignals&&(t=c.topLevelSignals(e,i,t))})}),n){const i=t.filter(r=>r.name==="unit");i.length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return Qs(t)}function Sm(e,t){const n=[...t];return Vt(e,i=>{const r={name:i.name+Gt};if(i.init){const o=i.project.items.map(c=>{const l=ym(c,["signals"]);return l}),a=i.init.map(c=>mn(c,!1));r.values=i.type==="interval"?[{unit:dt(e,{escape:!1}),fields:o,values:a}]:a.map(c=>({unit:dt(e,{escape:!1}),fields:o,values:c}))}const s=n.filter(o=>o.name===i.name+Gt);s.length||n.push(r)}),n}function Ll(e,t){return Vt(e,(n,i)=>{t=i.marks?i.marks(e,n,t):t,or(n,r=>{r.marks&&(t=r.marks(e,n,t))})}),t}function _m(e,t){for(const n of e.children)G(n)&&(t=Ll(n,t));return t}function jm(e,t){const n=t.selection,i=e.getSelectionComponent(n,W(n));return{signal:ql(i,t)}}function Qs(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}var wm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Zn="_brush",Js="_scale_trigger",Em={signals:(e,t)=>{const n=t.name,i=n+Jn,r=Pt.has(t),s=[],o=[],a=[];if(t.translate&&!r){const u=`!event.item || event.item.mark.name !== ${R(n+Zn)}`;zl(t,(f,d)=>{var g;const p=V((g=d.between[0].filter)!==null&&g!==void 0?g:d.between[0].filter=[]);return p.indexOf(u)<0&&p.push(u),f})}t.project.items.forEach((u,f)=>{const d=u.channel;if(d!==q&&d!==Q){y("Interval selections only support x and y encoding channels.");return}const g=t.init?t.init[f]:null,p=$m(e,t,u,g),m=u.signals.data,h=u.signals.visual,S=R(e.scaleName(d)),O=e.getScaleComponent(d).get("type"),_=ye(O)?"+":"";s.push(...p),o.push(m),a.push({scaleName:e.scaleName(d),expr:`(!isArray(${m}) || (${_}invert(${S}, ${h})[0] === ${_}${m}[0] && ${_}invert(${S}, ${h})[1] === ${_}${m}[1]))`})}),r||s.push({name:n+Js,value:{},on:[{events:a.map(u=>({scale:u.scaleName})),update:a.map(u=>u.expr).join(" && ")+` ? ${n+Js} : {}`}]});const c=t.init,l=`unit: ${dt(e)}, fields: ${i}, values`;return s.concat(Object.assign(Object.assign({name:n+Ve},c?{init:`{${l}: ${mn(c)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${l}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>{const n=t.name+Ve;return n+", "+(t.resolve==="global"?"true":`{unit: ${dt(e)}}`)},marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,o=r&&r.signals.visual,a=s&&s.signals.visual,c=`data(${R(t.name+Gt)})`;if(Pt.has(t))return n;const l={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const h of b(l))l[h]=[Object.assign({test:`${c}.length && ${c}[0].unit === ${dt(e)}`},l[h]),{value:0}];const u=t.mark,{fill:f,fillOpacity:d,cursor:g}=u,p=wm(u,["fill","fillOpacity","cursor"]),m=b(p).reduce((h,S)=>(h[S]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(O=>O).join(" && "),value:p[S]},{value:null}],h),{});return[{name:i+Zn+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:l}},...n,{name:i+Zn,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},g?{cursor:{value:g}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),m)}}]}};function $m(e,t,n,i){const r=n.channel,s=n.signals.visual,o=n.signals.data,a=Pt.has(t),c=R(e.scaleName(r)),l=e.getScaleComponent(r),u=l?l.get("type"):void 0,f=m=>`scale(${c}, ${m})`,d=e.getSizeSignalRef(r===q?"width":"height").signal,g=`${r}(unit)`,p=zl(t,(m,h)=>[...m,{events:h.between[0],update:`[${g}, ${g}]`},{events:h,update:`[${s}[0], clamp(${g}, 0, ${d})]`}]);return p.push({events:{signal:t.name+Js},update:ye(u)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},i?{init:mn(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:mn(i)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${c}, ${s})`}]})]}function zl(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(y(`${i} is not an ordered event stream for interval selections.`),n),[])}function Ml(e,t){const n=t.name,i=n+Jn,r=t.project,s="(item().isVoronoi ? datum.datum : datum)",o=r.items.map(l=>{const u=e.fieldDef(l.channel);return u&&u.bin?`[${s}[${R(e.vgField(l.channel,{}))}], ${s}[${R(e.vgField(l.channel,{binSuffix:"end"}))}]]`:`${s}[${R(l.field)}]`}).join(", "),a=`unit: ${dt(e)}, fields: ${i}, values`,c=t.events;return[{name:n+Ve,on:c?[{events:c,update:`datum && item().mark.marktype !== 'group' ? {${a}: [${o}]} : null`,force:!0}]:[]}]}const km={signals:Ml,modifyExpr:(e,t)=>{const n=t.name+Ve;return n+", "+(t.resolve==="global"?"null":`{unit: ${dt(e)}}`)}},Nm={signals:Ml,modifyExpr:(e,t)=>{const n=t.name+Ve;return n+", "+(t.resolve==="global"?"true":`{unit: ${dt(e)}}`)}},Gt="_store",Ve="_tuple",Pm="_modify",Dl="vlSelectionResolve",Cm={single:Nm,multi:km,interval:Em};function Vt(e,t){const n=e.component.selection;if(n)for(const i of Ke(n)){const r=t(i,Cm[i.type]);if(r===!0)break}}function Fm(e){let t=e.parent;for(;t&&!Ne(t);)t=t.parent;return t}function dt(e,{escape:t}={escape:!0}){let n=t?R(e.name):e.name;const i=Fm(e);if(i){const{facet:r}=i;for(const s of me)r[s]&&(n+=` + '__facet_${s}_' + (facet[${R(i.vgField(s))}])`)}return n}function Zs(e){let t=!1;return Vt(e,n=>{t=t||n.project.items.some(i=>i.field===pn)}),t}function eo(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...eo(e.object)),t.push(...eo(e.property))),t)}function Ul(e){return e.object.type==="MemberExpression"?Ul(e.object):e.object.name==="datum"}function Wl(e){const t=sf(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&Ul(i)&&n.add(eo(i).slice(1).join("."))}),n}class bn extends M{constructor(t,n,i){super(t);this.model=n,this.filter=i,this.expr=ar(this.model,this.filter,this),this._dependentFields=Wl(this.expr)}clone(){return new bn(null,this.model,F(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}var Am=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Tm(e,t){var n;const i={},r=e.config.selection;for(const s of b(t??{})){const o=F(t[s]),a=r[o.type],c=Am(a,["fields","encodings"]);for(const f in c){if(f==="encodings"&&o.fields||f==="fields"&&o.encodings)continue;f==="mark"&&(o[f]=Object.assign(Object.assign({},c[f]),o[f])),(o[f]===void 0||o[f]===!0)&&(o[f]=(n=c[f])!==null&&n!==void 0?n:o[f])}const l=W(s),u=i[l]=Object.assign(Object.assign({},o),{name:l,events:A(o.on)?tn(o.on,"scope"):F(o.on)});or(u,f=>{f.has(u)&&f.parse&&f.parse(e,u,o,t[s])})}return i}function Bl(e,t,n,i="datum"){const r=[];function s(a){const c=W(a),l=e.getSelectionComponent(c,a),u=R(c+Gt);if(l.project.timeUnit){const f=n??e.component.data.raw,d=l.project.timeUnit.clone();f.parent?d.insertAsParentOf(f):f.parent=d}return l.empty!=="none"&&r.push(u),`vlSelectionTest(${u}, ${i}`+(l.resolve==="global"?")":`, ${R(l.resolve)})`)}const o=on(t,s);return(r.length?"!("+r.map(a=>`length(data(${a}))`).join(" || ")+") || ":"")+`(${o})`}function ql(e,t){const n=t.encoding;let i=t.field;if(!n&&!i)i=e.project.items[0].field,e.project.items.length>1&&y(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${R(i)}.`);else if(n&&!i){const r=e.project.items.filter(s=>s.channel===n);!r.length||r.length>1?(i=e.project.items[0].field,y((r.length?"Multiple ":"No ")+`matching ${R(n)} encoding found for selection ${R(t.selection)}. Using "field": ${R(i)}.`)):i=r[0].field}return`${e.name}[${R(i)}]`}function Im(e,t){Vt(e,n=>{const i=n.name,r=e.getName(`lookup_${i}`);e.component.data.outputNodes[r]=n.materialized=new ae(new bn(t,e,{selection:i}),r,D.Lookup,e.component.data.outputNodeRefCounts)})}function ar(e,t,n){return on(t,i=>A(i)?i:rg(i)?Bl(e,i.selection,n):Ia(i))}var cr=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Rm(e,t){return e?j(e)&&!Et(e)?e.map(n=>js(n,t)).join(", "):e:void 0}function to(e,t,n,i){var r,s,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function ei(e,t,n,i={header:!1}){var r,s;const o=e.combine(),{disable:a,orient:c,scale:l,labelExpr:u,title:f,zindex:d}=o,g=cr(o,["disable","orient","scale","labelExpr","title","zindex"]);if(a)return;for(const p in g){const m=ff[p],h=g[p];if(m&&m!==t&&m!=="both")delete g[p];else if(In(h)){const{condition:S}=h,O=cr(h,["condition"]),_=V(S),$=Ko[p];if($){const{vgProp:P,part:T}=$,N=[..._.map(C=>{const{test:pe}=C,Pe=cr(C,["test"]);return Object.assign({test:ar(null,pe)},Pe)}),O];to(g,T,P,N),delete g[p]}else if($===null){const P={signal:_.map(T=>{const{test:N}=T,C=cr(T,["test"]);return`${ar(null,N)} ? ${Oc(C)} : `}).join("")+Oc(O)};g[p]=P}}else if(E(h)){const S=Ko[p];if(S){const{vgProp:O,part:_}=S;to(g,_,O,h),delete g[p]}}}if(t==="grid"){if(!g.grid)return;if(g.encode){const{grid:p}=g.encode;g.encode=Object.assign({},p?{grid:p}:{}),z(g.encode)&&delete g.encode}return Object.assign(Object.assign({scale:l,orient:c},g),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:X(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(u!==void 0){let m=u;((s=(r=g.encode)===null||r===void 0?void 0:r.labels)===null||s===void 0?void 0:s.update)&&E(g.encode.labels.update.text)&&(m=Tt(u,"datum.label",g.encode.labels.update.text.signal)),to(g,"labels","text",{signal:m})}if(g.labelAlign===null&&delete g.labelAlign,g.encode){for(const m of Qo)e.hasAxisPart(m)||delete g.encode[m];z(g.encode)&&delete g.encode}const p=Rm(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:c,grid:!1},p?{title:p}:{}),g),n.aria===!1?{aria:!1}:{}),{zindex:X(d,0)})}}function Hl(e){const{axes:t}=e.component,n=[];for(const i of be)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function Lm(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>ei(r,"grid",t)),...i.map(r=>ei(r,"grid",t)),...n.map(r=>ei(r,"main",t)),...i.map(r=>ei(r,"main",t))].filter(r=>r)}function Gl(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},c=new Set([...b(o),...b(a)]),l={};for(const u of c.values())l[u]={signal:`${i.signal} === "${s}" ? ${at(o[u])} : ${at(a[u])}`};return l}return t[r]})])}function zm(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:hg(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=E(n)?"axisOrient":"axis"+An(n),a=[...r,...r.map(l=>s+l.substr(4))],c=["axis",o,s];return{vlOnlyAxisConfig:Gl(a,i,e,n),vgAxisConfig:Gl(c,i,e,n),axisConfigStyle:Mm([...c,...a],i)}}function Mm(e,t){var n;const i=[{}];for(const r of e){let s=(n=t[r])===null||n===void 0?void 0:n.style;if(s){s=V(s);for(const o of s)i.push(t.style[o])}}return Object.assign.apply(null,i)}function no(e,t,n,i={}){var r;const s=xc(e,n,t);if(s!==void 0)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const Vl={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return Ja(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return Za(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return x(e)&&ie(e.bin)?!1:(i=t.grid)!==null&&i!==void 0?i:Dm(n,e)},gridScale:({model:e,channel:t})=>Um(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||Yl(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||Xl(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:Bm(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:qm(t.type,n,x(t)&&!!t.timeUnit,x(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var s;const o=e==="x"?"width":e==="y"?"height":void 0,a=o?t.getSizeSignalRef(o):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:Gm({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=Kl(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return _c(r?[oc(r)]:[],x(o)?[oc(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Vm(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:Xm(n,t)}};function Dm(e,t){return!ue(e)&&x(t)&&!B(t==null?void 0:t.bin)}function Um(e,t){const n=t==="x"?"y":"x";return e.getScaleComponent(n)?e.scaleName(n):void 0}function Wm(e,t,n,i,r){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return E(s)?s:Tn(s);{const{configValue:o}=no("labelAngle",i,t==null?void 0:t.style,r);return o!==void 0?Tn(o):n===q&&w([os,ss],e.type)&&!(x(e)&&e.timeUnit)?270:void 0}}function io(e){return`(((${e.signal} % 360) + 360) % 360)`}function Xl(e,t,n,i){if(e!==void 0)if(n==="x"){if(E(e)){const r=io(e),s=E(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(E(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(E(e)){const r=io(e),s=E(t)?`(${t.signal} === "left")`:t==="left",o=i?'"middle"':"null";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${o} : (45 <= ${r} && ${r} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(E(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}return}function Yl(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(E(e)){const o=io(e),a=E(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${r?"("+o+" + 90)":o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${a} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(E(t)){const o=r<e&&e<180+r?"===":"!==",a=`${t.signal} ${o} "${s}"`;return{signal:`${a} ? "left" : "right"`}}return(r<e&&e<180+r)===(t===s)?"left":"right"}function Bm(e,t){return t==="x"&&w(["quantitative","temporal"],e)?!0:void 0}function qm(e,t,n,i){return n&&!Z(i)||e!=="nominal"&&e!=="ordinal"?t==="log"||t==="symlog"?"greedy":!0:void 0}function Hm(e){return e==="x"?"bottom":"left"}function Gm({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!ue(t)&&t!=="log"){if(x(e)){if(B(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&w(["month","hours","day","quarter"],(r=re(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}function Kl(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;return s&&o?jc(s,o):s||(o||(s!==void 0?s:o!==void 0?o:void 0))}function Vm(e,t){const n=e.values;return j(n)?hc(t,n):E(n)?n:void 0}function Xm(e,t){return e==="rect"&&lc(t)?1:0}class yn extends M{constructor(t,n){super(t);this.transform=n,this._dependentFields=Wl(this.transform.calculate)}clone(){return new yn(null,F(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(!Di(i))return;if(sc(i.sort)){const{field:s,timeUnit:o}=i,a=i.sort,c=a.map((l,u)=>`${Ia({field:s,timeUnit:o,equal:l})} ? ${u} : `).join("")+a.length;t=new yn(t,{calculate:c,as:On(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${I(this.transform)}`}}function On(e,t,n){return v(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function lr(e,t){return w(["top","bottom"],t)?"column":w(["left","right"],t)||e==="row"?"row":"column"}function vn(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return X((t||{})[e],r[e],n.header[e])}function ur(e,t,n,i){const r={};for(const s of e){const o=vn(s,t||{},n,i);o!==void 0&&(r[s]=o)}return r}const ro=["row","column"],so=["header","footer"];function Ym(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=ur(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),c=lr(t,a),l=Tn(o);return{name:`${t}-title`,type:"group",role:`${c}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),Jl(l,c)),Ql(c,l,s)),Zl(i,r,t,Fp,Uc))}}function Ql(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=Yl(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function Jl(e,t){const n=Xl(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Km(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of so)if(n[r])for(const s of n[r]){const o=Jm(e,t,r,n,s);o!=null&&i.push(o)}return i}function Qm(e,t){var n;const{sort:i}=e;return We(i)?{field:v(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:j(i)?{field:On(e,t,{expr:"datum"}),order:"ascending"}:{field:v(e,{expr:"datum"}),order:i??"ascending"}}function oo(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:c}=ur(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=ps({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,u=lr(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:c?Tt(Tt(c,"datum.label",l),"datum.value",v(e,{expr:"parent"})):l}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),Jl(s,u)),Ql(u,s,o)),Zl(n,e,t,Ap,Wc))}function Jm(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=ur(["labelOrient"],o.header,a,t);(t==="row"&&!w(["top","bottom"],f)||t==="column"&&!w(["left","right"],f))&&(s=oo(o,t,a))}const c=Ne(e)&&!Hn(e.facet),l=r.axes,u=(l==null?void 0:l.length)>0;if(s||u){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:Qm(o,t)}:{}),u&&c?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),u?{axes:l}:{})}}return null}const Zm={column:{start:0,end:1},row:{start:1,end:0}};function eb(e,t){return Zm[t][e]}function tb(e,t){const n={};for(const i of me){const r=e[i];if(r==null?void 0:r.facetFieldDef){const{titleAnchor:s,titleOrient:o}=ur(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=lr(i,o),c=eb(s,a);c!==void 0&&(n[a]=c)}}return z(n)?void 0:n}function Zl(e,t,n,i,r){const s={};for(const o of i){if(!r[o])continue;const a=vn(o,t==null?void 0:t.header,e,n);a!==void 0&&(s[r[o]]=a)}return s}function ao(e){return[...fr(e,"width"),...fr(e,"height"),...fr(e,"childWidth"),...fr(e,"childHeight")]}function fr(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(ue(o)&&St(a)){const c=e.scaleName(n);if(Ne(e.parent)){const l=e.parent.component.resolve;if(l.scale[n]==="independent")return[eu(c,a)]}return[eu(c,a),{name:r,update:tu(c,s,`domain('${c}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=Ms(e.config.view,s?"width":"height"),c=`isFinite(${o}) ? ${o} : ${a}`;return[{name:r,init:c,on:[{update:c,events:"window:resize"}]}]}else return[{name:r,value:i}]}function eu(e,t){return{name:e+"_step",value:t.step}}function tu(e,t,n){const i=t.get("type"),r=t.get("padding"),s=X(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${at(o)}, ${at(s)}) * ${e}_step`}function nu(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function iu(e,t){return b(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),hn(t,r,i,s=>H(s.value)))},{})}function nb(e,t){if(_n(t)||Ne(t))return"shared";if(jo(t))return De(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function co(e,t){const n=e.scale[t],i=De(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&y(Sd(t)),"independent"):e[i][t]||"shared"}const ib=Object.assign(Object.assign({},Rp),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),ru=b(ib);class rb extends ut{}const su={symbols:sb,gradient:ob,labels:ab,entries:cb};function sb(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){var o,a,c,l,u,f,d,g;if(s!=="symbol")return;const{markDef:p,encoding:m,config:h,mark:S}=n,O=p.filled&&S!=="trail";let _=Object.assign(Object.assign({},fp({},n,Ig)),vl(n,{filled:O}));const $=(o=r.get("symbolOpacity"))!==null&&o!==void 0?o:h.legend.symbolOpacity,P=(a=r.get("symbolFillColor"))!==null&&a!==void 0?a:h.legend.symbolFillColor,T=(c=r.get("symbolStrokeColor"))!==null&&c!==void 0?c:h.legend.symbolStrokeColor,N=$===void 0?(l=ou(m.opacity))!==null&&l!==void 0?l:p.opacity:void 0;if(_.fill){if(i==="fill"||O&&i===ce)delete _.fill;else if(_.fill.field)P?delete _.fill:(_.fill=H((u=h.legend.symbolBaseFillColor)!==null&&u!==void 0?u:"black"),_.fillOpacity=H(N??1));else if(j(_.fill)){const C=(g=(d=lo((f=m.fill)!==null&&f!==void 0?f:m.color))!==null&&d!==void 0?d:p.fill)!==null&&g!==void 0?g:O&&p.color;C&&(_.fill=H(C))}}if(_.stroke){if(i==="stroke"||!O&&i===ce)delete _.stroke;else if(_.stroke.field||T)delete _.stroke;else if(j(_.stroke)){const C=X(lo(m.stroke||m.color),p.stroke,O?p.color:void 0);C&&(_.stroke={value:C})}}if(i!==rt){const C=x(t)&&cu(n,r,t);C?_.opacity=[Object.assign({test:C},H(N??1)),H(h.legend.unselectedOpacity)]:N&&(_.opacity=H(N))}return _=Object.assign(Object.assign({},_),e),z(_)?void 0:_}function ob(e,{model:t,legendType:n,legendCmpt:i}){var r;if(n!=="gradient")return;const{config:s,markDef:o,encoding:a}=t;let c={};const l=(r=i.get("gradientOpacity"))!==null&&r!==void 0?r:s.legend.gradientOpacity,u=l===void 0?ou(a.opacity)||o.opacity:void 0;return u&&(c.opacity=H(u)),c=Object.assign(Object.assign({},c),e),z(c)?void 0:c}function ab(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=x(t)?cu(n,r,t):void 0,c=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:u}=s,f=Ut(u)?hs({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:u,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},c?{opacity:c}:{}),f?{text:f}:{}),e);return z(d)?void 0:d}function cb(e,{legendCmpt:t}){const n=t.get("selections");return(n==null?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function ou(e){return au(e,(t,n)=>Math.max(t,n.value))}function lo(e){return au(e,(t,n)=>X(t,n.value))}function au(e,t){return Zg(e)?V(e.condition).reduce(t,e.value):Ee(e)?e.value:void 0}function cu(e,t,n){const i=t.get("selections");if(!(i==null?void 0:i.length))return;const r=R(n.field);return i.map(s=>{const o=R(W(s)+Gt);return`(!length(data(${o})) || (${s}[${r}] && indexof(${s}[${r}], datum.value) >= 0))`}).join(" || ")}const lu={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return Ja(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return Za(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:hb(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:mb(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:ub(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>dn(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(cn(n)&&je(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>lb(t,e)};function lb(e,t){const n=e.values;return j(n)?hc(t,n):E(n)?n:void 0}function ub(e,t,n,i){var r;if(t!=="shape"){const s=(r=lo(n))!==null&&r!==void 0?r:i;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function fb(e){const{legend:t}=e;return X(t.type,db(e))}function db({channel:e,timeUnit:t,scaleType:n}){if(cn(e)){if(w(["quarter","month","day"],t))return"symbol";if(je(n))return"gradient"}return"symbol"}function gb({legendConfig:e,legendType:t,orient:n,legend:i}){var r,s;return(s=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:pb(n,t)}function pb(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function hb({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:c}=e;return je(r)?n==="horizontal"?i==="top"||i==="bottom"?uu(t,"width",o,s):o:uu(t,"height",c,a):void 0}function uu(e,t,n,i){const r=e.getSizeSignalRef(t).signal;return{signal:`clamp(${r}, ${n}, ${i})`}}function mb(e){return w(["quantile","threshold","log","symlog"],e)?"greedy":void 0}function fu(e){const t=G(e)?bb(e):xb(e);return e.component.legends=t,t}function bb(e){const{encoding:t}=e,n={};for(const i of[ce,...qc]){const r=J(t[i]);if(!r||!e.getScaleComponent(i))continue;if(i===le&&x(r)&&r.type===fn)continue;n[i]=vb(e,i)}return n}function yb(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function Ob(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n==null?void 0:n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function vb(e,t){var n,i,r;let s=e.legend(t);const{markDef:o,encoding:a,config:c}=e,l=c.legend,u=new rb({},yb(e,t));pm(e,t,u);const f=s!==void 0?!s:l.disable;if(u.set("disable",f,s!==void 0),f)return u;s=s||{};const d=e.getScaleComponent(t).get("type"),g=J(a[t]),p=x(g)?(n=re(g.timeUnit))===null||n===void 0?void 0:n.unit:void 0,m=s.orient||c.legend.orient||"right",h=fb({legend:s,channel:t,timeUnit:p,scaleType:d}),S=gb({legend:s,legendType:h,orient:m,legendConfig:l}),O={legend:s,channel:t,model:e,markDef:o,encoding:a,fieldOrDatumDef:g,legendConfig:l,config:c,scaleType:d,orient:m,legendType:h,direction:S};for(const N of ru){if(h==="gradient"&&N.startsWith("symbol")||h==="symbol"&&N.startsWith("gradient"))continue;const C=N in lu?lu[N](O):s[N];if(C!==void 0){const pe=Ob(C,N,s,e.fieldDef(t));(pe||c.legend[N]===void 0)&&u.set(N,C,pe)}}const _=(i=s==null?void 0:s.encoding)!==null&&i!==void 0?i:{},$=u.get("selections"),P={},T={fieldOrDatumDef:g,model:e,channel:t,legendCmpt:u,legendType:h};for(const N of["labels","legend","title","symbols","gradient","entries"]){const C=iu((r=_[N])!==null&&r!==void 0?r:{},e),pe=N in su?su[N](C,T):C;pe!==void 0&&!z(pe)&&(P[N]=Object.assign(Object.assign(Object.assign({},($==null?void 0:$.length)&&x(g)?{name:`${W(g.field)}_legend_${N}`}:{}),($==null?void 0:$.length)?{interactive:!!$}:{}),{update:pe}))}return z(P)||u.set("encode",P,!!(s==null?void 0:s.encoding)),u}function xb(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){fu(i);for(const r of b(i.component.legends))n.legend[r]=co(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=du(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of b(t))for(const r of e.children){if(!r.component.legends[i])continue;n.legend[i]==="shared"&&delete r.component.legends[i]}return t}function du(e,t){var n,i,r,s;if(!e)return t.clone();const o=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let c=!1;for(const l of ru){const u=kt(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,d)=>{switch(l){case"symbolType":return Sb(f,d);case"title":return wc(f,d);case"type":return c=!0,de("symbol")}return er(f,d,l,"legend")});e.setWithExplicit(l,u)}return c&&(((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient)&&mi(e.implicit,["encode","gradient"]),((s=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||s===void 0?void 0:s.gradient)&&mi(e.explicit,["encode","gradient"])),e}function Sb(e,t){return t.value==="circle"?t:e}var _b=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function jb(e,t,n,i){var r,s,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function gu(e){const t=e.component.legends,n={};for(const r of b(t)){const s=e.getScaleComponent(r),o=U(s.get("domains"));if(n[o])for(const a of n[o]){const c=du(a,t[r]);c||n[o].push(t[r])}else n[o]=[t[r].clone()]}const i=Ke(n).flat().map(r=>wb(r,e.config)).filter(r=>r!==void 0);return i}function wb(e,t){var n,i,r;const s=e.combine(),{disable:o,labelExpr:a,selections:c}=s,l=_b(s,["disable","labelExpr","selections"]);if(o)return;if(t.aria===!1&&l.aria==null&&(l.aria=!1),(n=l.encode)===null||n===void 0?void 0:n.symbols){const u=l.encode.symbols.update;u.fill&&u.fill.value!=="transparent"&&!u.stroke&&!l.stroke&&(u.stroke={value:"transparent"});for(const f of qc)l[f]&&delete u[f]}if(l.title||delete l.title,a!==void 0){let u=a;((r=(i=l.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&E(l.encode.labels.update.text)&&(u=Tt(a,"datum.label",l.encode.labels.update.text.signal)),jb(l,"labels","text",{signal:u})}return l}function Eb(e){return _n(e)||jo(e)?$b(e):pu(e)}function $b(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),pu(e))}function pu(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const c=E(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return w(o,c)||o.push(c),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const kb=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class hu extends ut{constructor(t,n,i,r){super(Object.assign({},n),{name:t});this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function mu(e){e.component.projection=G(e)?Nb(e):Fb(e)}function Nb(e){var t;if(e.hasProjection){const n=e.specifiedProjection,i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=i?Pb(e):void 0;return new hu(e.projectionName(!0),Object.assign(Object.assign({},(t=e.config.projection)!==null&&t!==void 0?t:{}),n??{}),r,s)}return}function Pb(e){const t=[],{encoding:n}=e;for(const i of[[Ie,Te],[he,_e]])(J(n[i[0]])||J(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(le)&&e.typedFieldDef(le).type===fn&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(D.Main)),t}function Cb(e,t){const n=Pr(kb,r=>!Zt(e.explicit,r)&&!Zt(t.explicit,r)?!0:!!(Zt(e.explicit,r)&&Zt(t.explicit,r)&&U(e.get(r))===U(t.get(r)))),i=U(e.size)===U(t.size);if(i){if(n)return e;if(U(e.explicit)===U({}))return t;if(U(t.explicit)===U({}))return e}return null}function Fb(e){if(e.children.length===0)return;let t;for(const i of e.children)mu(i);const n=Pr(e.children,i=>{const r=i.component.projection;if(r)if(t){const s=Cb(t,r);return s&&(t=s),!!s}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new hu(i,t.specifiedProjection,t.size,F(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),i),o.merged=!0)}return r}return}var Ab=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Tb(e,t,n,i){var r,s;if(Vn(t,n)){const o=G(e)?(s=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&s!==void 0?s:{}:{},a=v(t,{expr:"datum"}),c=v(t,{expr:"datum",binSuffix:"end"});return{formulaAs:v(t,{binSuffix:"range",forAs:!0}),formula:Ii(a,c,o.format,o.formatType,i)}}return{}}function bu(e,t){return`${fa(e)}_${t}`}function Ib(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function uo(e,t,n){var i;const r=(i=Bi(n,void 0))!==null&&i!==void 0?i:{},s=bu(r,t);return e.getName(`${s}_bins`)}function Rb(e){return"as"in e}function yu(e,t,n){let i,r;Rb(e)?i=A(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[v(e,{forAs:!0}),v(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},Bi(t,void 0)),o=bu(s,e.field),{signal:a,extentSignal:c}=Ib(n,o);if(wi(s.extent)){const u=s.extent,f=u.selection;r=ql(n.getSelectionComponent(W(f),f),u),delete s.extent}const l=Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[i]},a?{signal:a}:{}),c?{extentSignal:c}:{}),r?{span:r}:{});return{key:o,binComponent:l}}class Xe extends M{constructor(t,n){super(t);this.bins=n}clone(){return new Xe(null,F(this.bins))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{if(Oe(s)&&B(s.bin)){const{key:a,binComponent:c}=yu(s,s.bin,n);r[a]=Object.assign(Object.assign(Object.assign({},c),r[a]),Tb(n,s,o,n.config))}return r},{});return z(i)?null:new Xe(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:s}=yu(n,n.bin,i);return new Xe(t,{[r]:s})}merge(t,n){for(const i of b(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=Ce([...this.bins[i].as,...t.bins[i].as],I)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(Ke(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Ke(this.bins).map(t=>t.field))}hash(){return`Bin ${I(this.bins)}`}assemble(){return Ke(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,s=t.bin,{extent:o}=s,a=Ab(s,["extent"]),c=Object.assign(Object.assign(Object.assign({type:"bin",field:Qe(t.field),as:i,signal:t.signal},wi(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(n.push({type:"extent",field:Qe(t.field),signal:t.extentSignal}),c.extent={signal:t.extentSignal}),n.push(c);for(const l of r)for(let u=0;u<2;u++)n.push({type:"formula",expr:v({field:i[u]},{expr:"datum"}),as:l[u]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function Lb(e,t,n,i){const r=G(i)?i.encoding[ze(t)]:void 0;if(Oe(n)&&G(i)&&Os(t,n,r,i.stack,i.markDef,i.config))e.add(v(n,{})),e.add(v(n,{suffix:"end"})),n.bin&&Vn(n,t)&&e.add(v(n,{binSuffix:"range"}));else if(_f(t)){const s=Sf(t);e.add(i.getName(s))}else e.add(v(n));return e}function zb(e,t){var n;for(const i of b(t)){const r=t[i];for(const s of b(r))i in e?e[i][s]=new Set([...(n=e[i][s])!==null&&n!==void 0?n:[],...r[s]]):e[i]={[s]:r[s]}}}class $e extends M{constructor(t,n,i){super(t);this.dimensions=n,this.measures=i}clone(){return new $e(null,new Set(this.dimensions),F(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(o=>{o.aggregate&&(i=!0)});const r={},s=new Set;return i?(n.forEachFieldDef((o,a)=>{var c,l,u,f;const{aggregate:d,field:g}=o;if(d)if(d==="count")r["*"]=(c=r["*"])!==null&&c!==void 0?c:{},r["*"].count=new Set([v(o,{forAs:!0})]);else{if(Je(d)||pt(d)){const p=Je(d)?"argmin":"argmax",m=d[p];r[m]=(l=r[m])!==null&&l!==void 0?l:{},r[m][p]=new Set([v({op:p,field:m},{forAs:!0})])}else r[g]=(u=r[g])!==null&&u!==void 0?u:{},r[g][d]=new Set([v(o,{forAs:!0})]);xt(a)&&n.scaleDomain(a)==="unaggregated"&&(r[g]=(f=r[g])!==null&&f!==void 0?f:{},r[g].min=new Set([v({field:g,aggregate:"min"},{forAs:!0})]),r[g].max=new Set([v({field:g,aggregate:"max"},{forAs:!0})]))}else Lb(s,a,o,n)}),s.size+b(r).length===0?null:new $e(t,s,r)):null}static makeFromTransform(t,n){var i,r,s;const o=new Set,a={};for(const c of n.aggregate){const{op:l,field:u,as:f}=c;l&&(l==="count"?(a["*"]=(i=a["*"])!==null&&i!==void 0?i:{},a["*"].count=new Set([f||v(c,{forAs:!0})])):(a[u]=(r=a[u])!==null&&r!==void 0?r:{},a[u][l]=new Set([f||v(c,{forAs:!0})])))}for(const c of(s=n.groupby)!==null&&s!==void 0?s:[])o.add(c);return o.size+b(a).length===0?null:new $e(t,o,a)}merge(t){return qo(this.dimensions,t.dimensions)?(zb(this.measures,t.measures),!0):(zd("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...b(this.measures)])}producedFields(){const t=new Set;for(const n of b(this.measures))for(const i of b(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${I({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const s of b(this.measures))for(const o of b(this.measures[s]))for(const a of this.measures[s][o])i.push(a),t.push(o),n.push(s==="*"?null:Qe(s));const r={type:"aggregate",groupby:[...this.dimensions].map(Qe),ops:t,fields:n,as:i};return r}}class xn extends M{constructor(t,n,i,r){super(t);this.model=n,this.name=i,this.data=r;for(const s of me){const o=n.facet[s];if(o){const{bin:a,sort:c}=o;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[v(o),...B(a)?[v(o,{binSuffix:"end"})]:[]]},We(c)?{sortField:c}:j(c)?{sortIndexField:On(o,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of me)this[n]&&(t+=` ${n.charAt(0)}:${I(this[n])}`);return t}get fields(){var t;const n=[];for(const i of me)((t=this[i])===null||t===void 0?void 0:t.fields)&&n.push(...this[i].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of me)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of be){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(ue(r)&&St(s)){const o=gr(this.childModel,n),a=xo(o);a?t[n]=a:y(Br(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x"}[t],s=[],o=[],a=[];i&&i[r]&&(n?(s.push(`distinct_${i[r]}`),o.push("max")):(s.push(i[r]),o.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:c,sortIndexField:l}=this[t];if(c){const{op:u=Ri,field:f}=c;s.push(f),o.push(u),a.push(v(c,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var n,i;const{columns:r}=this.model.layout,{layoutHeaders:s}=this.model.component,o=[],a={};for(const u of ro){for(const f of so){const d=(n=s[u]&&s[u][f])!==null&&n!==void 0?n:[];for(const g of d)if(((i=g.axes)===null||i===void 0?void 0:i.length)>0){a[u]=!0;break}}if(a[u]){const f=`length(data("${this.facet.name}"))`,d=u==="row"?r?{signal:`ceil(${f} / ${r})`}:1:r?{signal:`min(${f}, ${r})`}:{signal:f};o.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:d}]})}}const{row:c,column:l}=a;return(c||l)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,n;const i=[];let r=null;const s=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:c}=this;if(o&&a&&(s.x||s.y)){r=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),u=l.map(()=>"distinct");i.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:u}]})}for(const l of[et,Ze])this[l]&&i.push(this.assembleRowColumnHeaderData(l,r,s));if(c){const l=this.assembleFacetHeaderData(s);l&&i.push(...l)}return i}}function Ou(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function Mb(e,t){const n=Tr(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.indexOf("date:")===0){const i=Ou(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.indexOf("utc:")===0){const i=Ou(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return y(Kf(t)),null}function Db(e){const t={};return pi(e.filter,n=>{var i;if(Ta(n)){let r=null;Qr(n)?r=oe(n.equal):Zr(n)?r=oe(n.lte):Jr(n)?r=oe(n.lt):es(n)?r=oe(n.gt):ts(n)?r=oe(n.gte):ns(n)?r=n.range[0]:is(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(zt(r)?t[n.field]="date":Y(r)?t[n.field]="number":A(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function Ub(e){const t={};function n(i){gn(i)?t[i.field]="date":i.type==="quantitative"&&bf(i.aggregate)?t[i.field]="number":an(i.field)>1?i.field in t||(t[i.field]="flatten"):Di(i)&&We(i.sort)&&an(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((G(e)||Ne(e))&&e.forEachFieldDef((i,r)=>{if(Oe(i))n(i);else{const s=Lt(r),o=e.fieldDef(s);n(Object.assign(Object.assign({},i),{type:o.type}))}}),G(e)){const{mark:i,markDef:r,encoding:s}=e;if(_t(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",a=s[o];x(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function Wb(e){const t={};if(G(e)&&e.component.selection)for(const n of b(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&an(r.field)>1&&(t[r.field]="flatten")}return t}class ne extends M{constructor(t,n){super(t);this._parse=n}clone(){return new ne(null,F(this._parse))}hash(){return`Parse ${I(this._parse)}`}static makeExplicit(t,n,i){let r={};const s=n.data;return!Ht(s)&&s&&s.format&&s.format.parse&&(r=s.format.parse),this.makeWithAncestors(t,r,{},i)}static makeWithAncestors(t,n,i,r){for(const a of b(i)){const c=r.getWithExplicit(a);c.value!==void 0&&(c.explicit||c.value===i[a]||c.value==="derived"||i[a]==="flatten"?delete i[a]:y(Oa(a,i[a],c.value)))}for(const a of b(n)){const c=r.get(a);c!==void 0&&(c===n[a]?delete n[a]:y(Oa(a,n[a],c)))}const s=new ut(n,i);r.copyAll(s);const o={};for(const a of b(s.combine())){const c=s.get(a);c!==null&&(o[a]=c)}return b(o).length===0||r.parseNothing?null:new ne(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of b(this._parse)){const i=this._parse[n];an(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(b(this._parse))}dependentFields(){return new Set(b(this._parse))}assembleTransforms(t=!1){return b(this._parse).filter(n=>t?an(n)>1:!0).map(n=>{const i=Mb(n,this._parse[n]);if(!i)return null;const r={type:"formula",expr:i,as:Ir(n)};return r}).filter(n=>n!==null)}}class Ct extends M{clone(){return new Ct(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([pn])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:pn}}}class ti extends M{constructor(t,n){super(t);this.params=n}clone(){return new ti(null,this.params)}dependentFields(){return new Set}producedFields(){return}hash(){return`Graticule ${I(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class ni extends M{constructor(t,n){super(t);this.params=n}clone(){return new ni(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${I(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class Xt extends M{constructor(t){super(null);t=t??{name:"source"};let n;if(Ht(t)||(n=t.format?Object.assign({},fe(t.format,["parse"])):{}),tr(t))this._data={values:t.values};else if(Yn(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];w(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else hl(t)?this._data={values:[{type:"Sphere"}]}:(gl(t)||Ht(t))&&(this._data={});this._generator=Ht(t),t.name&&(this._name=t.name),n&&!z(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){return}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var vu=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},Bb=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},ii;function fo(e){return e instanceof Xt||e instanceof ti||e instanceof ni}class go{constructor(){ii.set(this,void 0),vu(this,ii,!1)}setModified(){vu(this,ii,!0)}get modifiedFlag(){return Bb(this,ii)}}ii=new WeakMap;class Yt extends go{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const n=this.getNodeDepths(t,0,new Map),i=[...n.entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class po extends go{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class qb extends po{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of b(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class Hb extends po{constructor(t){super();this.requiresSelectionId=t&&Zs(t)}run(t){t instanceof Ct&&(this.requiresSelectionId&&(fo(t.parent)||t.parent instanceof $e||t.parent instanceof ne)||(this.setModified(),t.remove()))}}class Gb extends go{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof Ge&&(i=t.producedFields(),Cr(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class Vb extends po{constructor(){super()}run(t){t instanceof ae&&!t.isRequired()&&(this.setModified(),t.remove())}}class Xb extends Yt{run(t){if(fo(t))return;if(t.numChildren()>1)return;for(const n of t.children)if(n instanceof ne)if(t instanceof ne)this.setModified(),t.merge(n);else{if(Ar(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}return}}class Yb extends Yt{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof ne);if(t.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const o of i){const a=o.parse;for(const c of b(a))c in r?r[c]!==a[c]&&s.add(c):r[c]=a[c]}for(const o of s)delete r[o];if(!z(r)){this.setModified();const o=new ne(t,r);for(const a of n){if(a instanceof ne)for(const c of b(r))delete a.parse[c];t.removeChild(a),a.parent=o,a instanceof ne&&b(a.parse).length===0&&a.remove()}}}}}class Kb extends Yt{run(t){t instanceof ae||t.numChildren()>0||t instanceof xn||(t instanceof Xt||(this.setModified(),t.remove()))}}class Qb extends Yt{run(t){const n=t.children.filter(r=>r instanceof Ge),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class Jb extends Yt{run(t){const n=t.children.filter(r=>r instanceof $e),i={};for(const r of n){const s=I(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of b(i)){const s=i[r];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(t.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class Zb extends Yt{constructor(t){super();this.model=t}run(t){const n=!(fo(t)||t instanceof bn||t instanceof ne||t instanceof Ct),i=[],r=[];for(const s of t.children)s instanceof Xe&&(n&&!Ar(t.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof Xe?t.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class ey extends Yt{run(t){const n=[...t.children],i=sn(n,o=>o instanceof ae);if(!i||t.numChildren()<=1)return;const r=[];let s;for(const o of n)if(o instanceof ae){let a=o;for(;a.numChildren()===1;){const[c]=a.children;if(c instanceof ae)a=c;else break}r.push(...a.children),s?(t.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else r.push(o);if(r.length){this.setModified();for(const o of r)o.parent.removeChild(o),o.parent=s}}}class Kt extends M{constructor(t,n){super(t);this.transform=n}clone(){return new Kt(null,F(this.transform))}addDimensions(t){this.transform.groupby=Ce(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:v(t)}hash(){return`JoinAggregateTransform ${I(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},r!==void 0?{groupby:r}:{})}}function ty(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=v(i);return r&&t.push(r),t},[])}function ny(e){return j(e)&&e.every(t=>A(t))&&e.length>1}class gt extends M{constructor(t,n){super(t);this._stack=n}clone(){return new gt(null,F(this._stack))}static makeFromTransform(t,n){const{stack:i,groupby:r,as:s,offset:o="zero"}=n,a=[],c=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),c.push(X(f.order,"ascending"));const l={field:a,order:c};let u;return ny(s)?u=s:A(s)?u=[s,s+"_end"]:u=[n.stack+"_start",n.stack+"_end"],new gt(t,{stackField:i,groupby:r,offset:o,sort:l,facetby:[],as:u})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannel:s,fieldChannel:o,offset:a,impute:c}=i;let l;if(s){const g=r[s];l=qe(g)}const u=ty(n),f=n.encoding.order;let d;return j(f)||x(f)?d=Sc(f):d=u.reduce((g,p)=>(g.field.push(p),g.order.push(o==="y"?"descending":"ascending"),g),{field:[],order:[]}),new gt(t,{dimensionFieldDef:l,stackField:n.vgField(o),facetby:[],stackby:u,sort:d,offset:a,impute:c,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${I(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:i}=this._stack;return t?t.bin?n?[v(t,{binSuffix:"mid"})]:[v(t,{}),v(t,{binSuffix:"end"})]:[v(t)]:i??[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:i,stackField:r,stackby:s,sort:o,offset:a,impute:c,as:l}=this._stack;if(c&&i){const{band:u=.5,bin:f}=i;f&&t.push({type:"formula",expr:`${u}*`+v(i,{expr:"datum"})+`+${1-u}*`+v(i,{expr:"datum",binSuffix:"end"}),as:v(i,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:r,groupby:[...s,...n],key:v(i,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:o,as:l,offset:a}),t}}class Sn extends M{constructor(t,n){super(t);this.transform=n}clone(){return new Sn(null,F(this.transform))}addDimensions(t){this.transform.groupby=Ce(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const i=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(i.add,i),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(r=>i.add(r.field)),this.transform.window.map(r=>r.field).filter(r=>r!==void 0).forEach(i.add,i),i}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:v(t)}hash(){return`WindowTransform ${I(this.transform)}`}assemble(){var t;const n=[],i=[],r=[],s=[];for(const d of this.transform.window)i.push(d.op),r.push(this.getDefaultName(d)),s.push(d.param===void 0?null:d.param),n.push(d.field===void 0?null:d.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&i.every(d=>Rr(d)))return Object.assign({type:"joinaggregate",as:r,ops:i,fields:n},a!==void 0?{groupby:a}:{});const c=[],l=[];if(this.transform.sort!==void 0)for(const d of this.transform.sort)c.push(d.field),l.push((t=d.order)!==null&&t!==void 0?t:"ascending");const u={field:c,order:l},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:r,ops:i,fields:n,sort:u},f!==void 0?{ignorePeers:f}:{}),a!==void 0?{groupby:a}:{}),o!==void 0?{frame:o}:{})}}function iy(e){function t(n){if(!(n instanceof xn)){const i=n.clone();if(i instanceof ae){const r=mo+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof $e||i instanceof gt||i instanceof Sn||i instanceof Kt)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function ho(e){if(e instanceof xn)if(e.numChildren()===1&&!(e.children[0]instanceof ae)){const t=e.children[0];(t instanceof $e||t instanceof gt||t instanceof Sn||t instanceof Kt)&&t.addDimensions(e.fields),t.swapWithParent(),ho(e)}else{const t=e.model.component.data.main;xu(t);const n=iy(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(ho)}function xu(e){if(e instanceof ae&&e.type===D.Main&&e.numChildren()===1){const t=e.children[0];t instanceof xn||(t.swapWithParent(),xu(e))}}const mo="scale_",dr=5;function bo(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!bo(t.children))return!1}return!0}function ke(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function Su(e,t,n){let i=e.sources,r=!1;return r=ke(new Vb,i)||r,r=ke(new Hb(t),i)||r,i=i.filter(s=>s.numChildren()>0),r=ke(new Kb,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=ke(new Xb,i)||r,r=ke(new Zb(t),i)||r,r=ke(new Gb,i)||r,r=ke(new Yb,i)||r,r=ke(new Jb,i)||r,r=ke(new Qb,i)||r,r=ke(new qb,i)||r,r=ke(new ey,i)||r),e.sources=i,r}function ry(e,t){bo(e.sources);let n=0,i=0;for(let r=0;r<dr&&Su(e,t,!0);r++)n++;e.sources.map(ho);for(let r=0;r<dr&&Su(e,t,!1);r++)i++;bo(e.sources),Math.max(n,i)===dr&&y(`Maximum optimization runs(${dr}) reached.`)}class ge{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new ge(()=>t(n))}}var sy=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function _u(e){G(e)?oy(e):ay(e)}function oy(e){const t=e.component.scales;for(const n of b(t)){const i=ly(e,n),r=t[n];if(r.setWithExplicit("domains",i),fy(e,n),e.component.data.isFaceted){let s=e;for(;!Ne(s)&&s.parent;)s=s.parent;const o=s.component.resolve.scale[n];if(o==="shared")for(const a of i.value)st(a)&&(a.data=mo+a.data.replace(mo,""))}}}function ay(e){for(const n of e.children)_u(n);const t=e.component.scales;for(const n of b(t)){let i,r=null;for(const s of e.children){const o=s.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=kt(i,o.getWithExplicit("domains"),"domains","scale",vo);const a=o.get("selectionExtent");r&&a&&r.selection!==a.selection&&y(Gf),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function cy(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:s}=ju(t,n);if(!r){y(s);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=ju(t,n);if(r)return"unaggregated"}return e}function ly(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=cy(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&J(i.x2)?J(i.x)?kt(Ft(n,r,e,"x"),Ft(n,r,e,"x2"),"domain","scale",vo):Ft(n,r,e,"x2"):t==="y"&&J(i.y2)?J(i.y)?kt(Ft(n,r,e,"y"),Ft(n,r,e,"y2"),"domain","scale",vo):Ft(n,r,e,"y2"):Ft(n,r,e,t)}function uy(e,t,n){return e.map(i=>{const r=qi(i,{timeUnit:n,type:t});return{signal:`{data: ${r}}`}})}function yo(e,t,n){var i;const r=(i=re(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?uy(e,t,r):[e]}function Ft(e,t,n,i){const{encoding:r}=n,s=J(r[i]),{type:o}=s,a=s.timeUnit;if(jg(t)){const f=Ft(e,void 0,n,i),d=yo(t.unionWith,o,a);return ft([...f.value,...d])}else{if(E(t))return ft([t]);if(t&&t!=="unaggregated"&&!za(t))return ft(yo(t,o,a))}const c=n.stack;if(c&&i===c.fieldChannel){if(c.offset==="normalize")return de([[0,1]]);const f=n.requestDataName(D.Main);return de([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const l=xt(i)&&x(s)?dy(n,i,e):void 0;if(wt(s)){const f=yo([s.datum],o,a);return de(f)}const u=s;if(t==="unaggregated"){const f=n.requestDataName(D.Main),{field:d}=s;return de([{data:f,field:v({field:d,aggregate:"min"})},{data:f,field:v({field:d,aggregate:"max"})}])}else if(B(u.bin)){if(ue(e))return e==="bin-ordinal"?de([]):de([{data:Fn(l)?n.requestDataName(D.Main):n.requestDataName(D.Raw),field:n.vgField(i,Vn(u,i)?{binSuffix:"range"}:{}),sort:l===!0||!Z(l)?{field:n.vgField(i,{}),op:"min"}:l}]);{const{bin:f}=u;if(B(f)){const d=uo(n,u.field,f);return de([new ge(()=>{const g=n.getSignalName(d);return`[${g}.start, ${g}.stop]`})])}else return de([{data:n.requestDataName(D.Main),field:n.vgField(i,{})}])}}else if(u.timeUnit&&w(["time","utc"],e)&&Os(i,u,G(n)?n.encoding[ze(i)]:void 0,n.stack,n.markDef,n.config)){const f=n.requestDataName(D.Main);return de([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return de(l?[{data:Fn(l)?n.requestDataName(D.Main):n.requestDataName(D.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(D.Main),field:n.vgField(i)}])}function Oo(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n??(t?"sum":Ri)},i?{field:Qe(i)}:{}),r?{order:r}:{})}function fy(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=za(r)&&r,a=Dn(s)&&wi(s.extent)&&s.extent;(o||a)&&i.set("selectionExtent",o??a,!0)}function dy(e,t,n){if(!ue(n))return;const i=e.fieldDef(t),r=i.sort;if(sc(r))return{op:"min",field:On(i,t),order:"ascending"};const{stack:s}=e,o=s?[...s.groupbyField?[s.groupbyField]:[],...s.stackBy.map(a=>a.fieldDef.field)]:void 0;if(We(r)){const a=s&&!w(o,r.field);return Oo(r,a)}else if(rc(r)){const{encoding:a,order:c}=r,l=e.fieldDef(a),{aggregate:u,field:f}=l,d=s&&!w(o,f);if(Je(u)||pt(u))return Oo({field:v(l),order:c},d);if(Rr(u)||!u)return Oo({op:u,field:f,order:c},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(w(["ascending",void 0],r))return!0}return}function ju(e,t){const{aggregate:n,type:i}=e;return n?A(n)&&!vf[n]?{valid:!1,reason:hd(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:md(e)}:{valid:!0}:{valid:!1,reason:pd(e)}}function vo(e,t,n,i){return e.explicit&&t.explicit&&y(xd(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function gy(e){const t=Ce(e.map(o=>{if(st(o)){const a=sy(o,["sort"]);return a}return o}),I),n=Ce(e.map(o=>{if(st(o)){const a=o.sort;return a!==void 0&&!Fn(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}return}).filter(o=>o!==void 0),I);if(t.length===0)return;if(t.length===1){const o=e[0];if(st(o)&&n.length>0){let a=n[0];if(n.length>1)y(wa),a=!0;else if(Z(a)&&"field"in a){const c=a.field;o.field===c&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},o),{sort:a})}return o}const i=Ce(n.map(o=>Fn(o)||!("op"in o)||A(o.op)&&o.op in hf?o:(y(_d(o)),!0)),I);let r;i.length===1?r=i[0]:i.length>1&&(y(wa),r=!0);const s=Ce(e.map(o=>st(o)?o.data:null),o=>o);if(s.length===1&&s[0]!==null){const o=Object.assign({data:s[0],fields:t.map(a=>a.field)},r?{sort:r}:{});return o}return Object.assign({fields:t},r?{sort:r}:{})}function xo(e){if(st(e)&&A(e.field))return e.field;if(Zd(e)){let t;for(const n of e.fields)if(st(n)&&A(n.field)){if(!t)t=n.field;else if(t!==n.field)return y(jd),t}return y(wd),t}else if(eg(e)){y(Ed);const t=e.fields[0];return A(t)?t:void 0}return}function gr(e,t){const n=e.component.scales[t],i=n.get("domains").map(r=>(st(r)&&(r.data=e.lookupDataSource(r.data)),r));return gy(i)}var py=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function wu(e){return _n(e)||jo(e)?e.children.reduce((t,n)=>t.concat(wu(n)),Eu(e)):Eu(e)}function Eu(e){return b(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:c,range:l,reverse:u}=r,f=py(r,["name","type","selectionExtent","domains","range","reverse"]),d=hy(r.range,s,n,e);let g;a&&(g=jm(e,a));const p=gr(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},p?{domain:p}:{}),g?{domainRaw:g}:{}),{range:d}),u!==void 0?{reverse:u}:{}),f)),t},[])}function hy(e,t,n,i){if(De(n)){if(St(e))return{step:{signal:t+"_step"}}}else if(Z(e)&&st(e))return Object.assign(Object.assign({},e),{data:i.lookupDataSource(e.data)});return e}class $u extends ut{constructor(t,n){super({},{name:t});this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:sn(this.get("domains"),t=>j(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const my=["range","scheme"];function ku(e){return e==="x"?"width":e==="y"?"height":void 0}function by(e){const t=e.component.scales;for(const n of ji){const i=t[n];if(!i)continue;const r=yy(n,e);i.setWithExplicit("range",r)}}function Nu(e,t){const n=e.fieldDef(t);if(n&&n.bin&&B(n.bin)){const i=uo(e,n.field,n.bin),r=ku(t),s=e.getName(r);return new ge(()=>{const o=e.getSignalName(i),a=`(${o}.stop - ${o}.start) / ${o}.step`;return`${e.getSignalName(s)} / (${a})`})}return}function yy(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e),s=r.get("type");for(const l of my)if(n[l]!==void 0){const u=cs(s,l),f=Ma(e,l);if(!u)y(_a(s,l,e));else if(f)y(f);else switch(l){case"range":{const d=n.range;if(j(d)){if(De(e))return ft(d.map(g=>{if(g==="width"||g==="height"){const p=t.getName(g),m=t.getSignalName.bind(t);return ge.fromName(m,p)}return g}))}else if(Z(d))return ft({data:t.requestDataName(D.Main),field:d.field,sort:{op:"min",field:t.vgField(e)}});return ft(d)}case"scheme":return ft(Oy(n[l]))}}if(e===q||e===Q){const l=e===q?"width":"height",u=i[l];if(He(u)){if(ue(s))return ft({step:u.step});y(ja(l))}}const{rangeMin:o,rangeMax:a}=n,c=vy(e,t);return(o!==void 0||a!==void 0)&&cs(s,"rangeMin")&&j(c)&&c.length===2?ft([o??c[0],a??c[1]]):de(c)}function Oy(e){return _g(e)?Object.assign({scheme:e.name},fe(e,["name"])):{scheme:e}}function vy(e,t){const{size:n,config:i,mark:r,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=J(s[e]),c=t.getScaleComponent(e),l=c.get("type"),{domain:u,domainMid:f}=t.specifiedScales[e];switch(e){case q:case Q:{if(w(["point","band"],l)){if(e===q&&!n.width){const p=Xn(i.view,"width");if(He(p))return p}else if(e===Q&&!n.height){const p=Xn(i.view,"height");if(He(p))return p}}const d=ku(e),g=t.getName(d);return e===Q&&ye(l)?[ge.fromName(o,g),0]:[0,ge.fromName(o,g)]}case it:{const d=t.component.scales[e].get("zero"),g=Pu(r,d,i),p=_y(r,n,t,i);return ki(l)?Sy(g,p,xy(l,i,u,e)):[g,p]}case Se:return[0,Math.PI*2];case It:return[0,360];case Ae:return[0,new ge(()=>{const d=t.getSignalName("width"),g=t.getSignalName("height");return`min(${d},${g})/2`})];case bt:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case yt:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case le:return"symbol";case ce:case Re:case Le:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case rt:case ht:case mt:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function xy(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&j(n)?n.length+1:(y(Id(i)),3)}}function Sy(e,t,n){const i=()=>{const r=at(t),s=at(e),o=`(${r} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${r} + ${o}, ${o})`};return E(t)?new ge(i):{signal:i()}}function Pu(e,t,n){if(t)return E(t)?{signal:`${t.signal} ? 0 : ${Pu(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Ei("size",e))}const Cu=.95;function _y(e,t,n,i){const r={x:Nu(n,"x"),y:Nu(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=Fu(t,r,i.view);return Y(s)?s-1:new ge(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=Fu(t,r,i.view);return Y(s)?Math.pow(Cu*s,2):new ge(()=>`pow(${Cu} * ${s.signal}, 2)`)}}throw new Error(Ei("size",e))}function Fu(e,t,n){const i=He(e.width)?e.width.step:Ji(n,"width"),r=He(e.height)?e.height.step:Ji(n,"height");return t.x||t.y?new ge(()=>{const s=[t.x?t.x.signal:i,t.y?t.y.signal:r];return`min(${s.join(", ")})`}):Math.min(i,r)}function Au(e,t){G(e)?jy(e,t):Ru(e,t)}function jy(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=e;for(const a of b(n)){const c=o[a],l=n[a],u=e.getScaleComponent(a),f=J(r[a]),d=c[t],g=u.get("type"),p=u.get("padding"),m=u.get("paddingInner"),h=cs(g,t),S=Ma(a,t);if(d!==void 0&&(h?S&&y(S):y(_a(g,t,a))),h&&S===void 0)if(d!==void 0){const O=f.timeUnit,_=f.type;switch(t){case"domainMax":case"domainMin":zt(c[t])||_==="temporal"||O?l.set(t,{signal:qi(c[t],{type:_,timeUnit:O})},!0):l.set(t,c[t],!0);break;default:l.copyKeyFromObject(t,c)}}else{const O=t in Tu?Tu[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:g,scalePadding:p,scalePaddingInner:m,domain:c.domain,markDef:s,config:i}):i.scale[t];O!==void 0&&l.set(t,O,!1)}}}const Tu={bins:({model:e,fieldOrDatumDef:t})=>x(t)?wy(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>Ey(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>$y(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>ky(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>Ny(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:s})=>Py(e,t,n,i.type,r,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=x(e)?e.sort:void 0;return Cy(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>Fy(e,t,n,i,r)};function Iu(e){G(e)?by(e):Ru(e,"range")}function Ru(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?Iu(i):Au(i,t);for(const i of b(n)){let r;for(const s of e.children){const o=s.component.scales[i];if(o){const a=o.getWithExplicit(t);r=kt(r,a,t,"scale",dl((c,l)=>{switch(t){case"range":return c.step&&l.step?c.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function wy(e,t){const n=t.bin;if(B(n)){const i=uo(e,t.field,n);return new ge(()=>e.getSignalName(i))}else if(ie(n)&&Dn(n)&&n.step!==void 0)return{step:n.step};return}function Ey(e,t){return w([ce,Re,Le],e)&&t!=="nominal"?"hcl":void 0}function $y(e,t,n){var i;return((i=qe(n))===null||i===void 0?void 0:i.bin)||w([K.TIME,K.UTC],e)?void 0:t in vt?!0:void 0}function ky(e,t,n,i,r,s){if(e in vt){if(je(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=r;if(o==="bar"&&!(x(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===K.POINT)return n.pointPadding}return}function Ny(e,t,n,i){if(e!==void 0)return;if(t in vt){const{bandPaddingInner:r,barBandPaddingInner:s,rectBandPaddingInner:o}=i;return X(r,n==="bar"?s:o)}return}function Py(e,t,n,i,r,s){if(e!==void 0)return;if(t in vt&&n===K.BAND){const{bandPaddingOuter:o}=s;return X(o,E(r)?{signal:`${r.signal}/2`}:r/2)}return}function Cy(e,t,n,i){return n==="x"&&i.xReverse!==void 0?ye(e)&&t==="descending"?E(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:ye(e)&&t==="descending"?!0:void 0}function Fy(e,t,n,i,r){const s=!!n&&n!=="unaggregated";if(s&&ye(r)){if(j(n)){const o=n[0],a=n[n.length-1];if(o<=0&&a>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!ki(r))return!0;if(!(x(t)&&t.bin)&&w([...be,...Ff],e)){const{orient:o,type:a}=i;return!(w(["bar","area","line","trail"],a)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function Ay(e,t,n,i){const r=Ty(t,n,i),{type:s}=e;return xt(t)?s!==void 0?Ng(t,s)?x(n)&&!kg(s,n.type)?(y(Od(s,r)),r):s:(y(yd(t,s,r)),r):r:null}function Ty(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":if(cn(e)||Ur(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&y(Hr(e,"ordinal")),"ordinal";if(e in vt){if(w(["rect","bar","image","rule"],n))return"band"}else if(n==="arc"&&e in Dr)return"band";return t.band!==void 0||Ss(t)&&((i=t.axis)===null||i===void 0?void 0:i.tickBand)?"band":"point";case"temporal":return cn(e)?"time":Ur(e)==="discrete"?(y(Hr(e,"temporal")),"ordinal"):x(t)&&t.timeUnit&&re(t.timeUnit).utc?"utc":"time";case"quantitative":return cn(e)?x(t)&&B(t.bin)?"bin-ordinal":"linear":Ur(e)==="discrete"?(y(Hr(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(xa(t.type))}function Iy(e,{ignoreRange:t}={}){Lu(e),_u(e);for(const n of $g)Au(e,n);t||Iu(e)}function Lu(e){G(e)?e.component.scales=Ry(e):e.component.scales=zy(e)}function Ry(e){const{encoding:t,mark:n}=e;return ji.reduce((i,r)=>{const s=J(t[r]);if(s&&n===Wa&&r===le&&s.type===fn)return i;let o=s&&s.scale;if(s&&o!==null&&o!==!1){o=o??{};const a=Ay(o,r,s,n);i[r]=new $u(e.scaleName(r+"",!0),{value:a,explicit:o.type===a})}return i},{})}const Ly=dl((e,t)=>Ra(e)-Ra(t));function zy(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const s of e.children){Lu(s);for(const o of b(s.component.scales))if(r.scale[o]=(t=r.scale[o])!==null&&t!==void 0?t:nb(o,e),r.scale[o]==="shared"){const a=i[o],c=s.component.scales[o].getWithExplicit("type");a?ug(a.value,c.value)?i[o]=kt(a,c,"type","scale",Ly):(r.scale[o]="independent",delete i[o]):i[o]=c}}for(const s of b(i)){const o=e.scaleName(s,!0),a=i[s];n[s]=new $u(o,a);for(const c of e.children){const l=c.component.scales[s];l&&(c.renameScale(l.get("name"),o),l.merged=!0)}}return n}var So=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class _o{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function G(e){return(e==null?void 0:e.type)==="unit"}function Ne(e){return(e==null?void 0:e.type)==="facet"}function jo(e){return(e==null?void 0:e.type)==="concat"}function _n(e){return(e==null?void 0:e.type)==="layer"}class wo{constructor(t,n,i,r,s,o,a){var c,l;this.type=n,this.parent=i,this.config=s,this.children=[],this.correctDataNames=u=>(u.from&&u.from.data&&(u.from.data=this.lookupDataSource(u.from.data)),u.from&&u.from.facet&&u.from.facet.data&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u),this.parent=i,this.config=s,this.view=we(a),this.name=(c=t.name)!==null&&c!==void 0?c:r,this.title=Et(t.title)?{text:t.title}:t.title?this.initTitle(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new _o,this.projectionNameMap=i?i.projectionNameMap:new _o,this.signalNameMap=i?i.signalNameMap:new _o,this.data=t.data,this.description=t.description,this.transforms=Vh((l=t.transform)!==null&&l!==void 0?l:[]),this.layout=n==="layer"||n==="unit"?{}:Wp(t,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:Li(t)||i&&i.component.data.isFaceted&&t.data===void 0},layoutSize:new ut,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?F(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}initTitle(t){const n=b(t),i={text:oe(t.text)};for(const r of n)i[r]=oe(t[r]);return i}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){Iy(this)}parseProjection(){mu(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){fu(this)}assembleGroupStyle(){var t,n;return this.type==="unit"||this.type==="layer"?(n=(t=this.view)===null||t===void 0?void 0:t.style)!==null&&n!==void 0?n:"cell":void 0}assembleEncodeFromView(t){const n=So(t,["style"]),i={};for(const r of b(n)){const s=n[r];s!==void 0&&(i[r]=H(s))}return i}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=H(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{}):z(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,i=So(t,["spacing"]),{component:r,config:s}=this,o=tb(r.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),i),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of me)t[i].title&&n.push(Ym(this,i));for(const i of ro)n=n.concat(Km(this,i));return n}assembleAxes(){return Lm(this.component.axes,this.config)}assembleLegends(){return gu(this)}assembleProjections(){return Eb(this)}assembleTitle(){var t,n,i;const r=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=r,o=So(r,["encoding"]),a=Object.assign(Object.assign(Object.assign({},mc(this.config.title).nonMark),o),s?{encode:{update:s}}:{});return a.text?(w(["unit","layer"],this.type)?w(["middle",void 0],a.anchor)&&(a.frame=(n=a.frame)!==null&&n!==void 0?n:"group"):a.anchor=(i=a.anchor)!==null&&i!==void 0?i:"start",z(a)?void 0:a):void 0}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||Ne(this.parent)?wu(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return W((this.name?this.name+"_":"")+t)}getDataName(t){return this.getName(D[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(Ne(this.parent)){const n=nu(t),i=_i(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if(ue(s)&&St(o)){const a=r.get("name"),c=gr(this,i),l=xo(c);if(l){const u=v({aggregate:"distinct",field:l},{expr:"datum"});return{signal:tu(a,r,u)}}else return y(Br(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){return n?this.getName(t):oa(t)&&xt(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(Wf(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(i=>i.hasOrientSignalRef()))}}class zu extends wo{vgField(t,n={}){const i=this.fieldDef(t);return i?v(i,n):void 0}reduceFieldDef(t,n){return mp(this.getMapping(),(i,r,s)=>{const o=qe(r);return o?t(i,o,s):i},n)}forEachFieldDef(t,n){ks(this.getMapping(),(i,r)=>{const s=qe(i);s&&t(s,r)},n)}}var My=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class pr extends M{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=F(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"value",(s=o[1])!==null&&s!==void 0?s:"density"]}clone(){return new pr(null,F(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${I(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,i=My(t,["density"]),r=Object.assign({type:"kde",field:n},i);return r}}class ri extends M{constructor(t,n){super(t);this.filter=n}clone(){return new ri(null,Object.assign({},this.filter))}static make(t,n){const{config:i,mark:r,markDef:s}=n,o=L("invalid",s,i);if(o!=="filter")return null;const a=n.reduceFieldDef((c,l,u)=>{const f=xt(u)&&n.getScaleComponent(u);if(f){const d=f.get("type");ye(d)&&l.aggregate!=="count"&&!_t(r)&&(c[l.field]=l)}return c},{});return b(a).length?new ri(t,a):null}dependentFields(){return new Set(b(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${I(this.filter)}`}assemble(){const t=b(this.filter).reduce((n,i)=>{const r=this.filter[i],s=v(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):r.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class hr extends M{constructor(t,n){super(t);this.transform=n,this.transform=F(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,o)=>{var a;return(a=r[o])!==null&&a!==void 0?a:s})}clone(){return new hr(this.parent,F(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${I(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform,i={type:"flatten",fields:t,as:n};return i}}class mr extends M{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=F(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"key",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new mr(null,F(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${I(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform,i={type:"fold",fields:t,as:n};return i}}class jn extends M{constructor(t,n,i,r){super(t);this.fields=n,this.geojson=i,this.signal=r}clone(){return new jn(null,F(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[Ie,Te],[he,_e]]){const s=r.map(o=>{const a=J(n.encoding[o]);return x(a)?a.field:wt(a)?{expr:`${a.datum}`}:Ee(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new jn(t,s,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(le)){const r=n.typedFieldDef(le);r.type===fn&&(t=new jn(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(A);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${I(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class si extends M{constructor(t,n,i,r){super(t);this.projection=n,this.fields=i,this.as=r}clone(){return new si(null,this.projection,F(this.fields),F(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[Ie,Te],[he,_e]]){const r=i.map(o=>{const a=J(n.encoding[o]);return x(a)?a.field:wt(a)?{expr:`${a.datum}`}:Ee(a)?{expr:`${a.value}`}:void 0}),s=i[0]===he?"2":"";(r[0]||r[1])&&(t=new si(t,n.projectionName(),r,[n.getName("x"+s),n.getName("y"+s)]))}return t}dependentFields(){return new Set(this.fields.filter(A))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${I(this.fields)} ${I(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Qt extends M{constructor(t,n){super(t);this.transform=n}clone(){return new Qt(null,F(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t,s=[n,i,...r?[r]:[]].join(",");return{signal:`sequence(${s})`}}static makeFromTransform(t,n){return new Qt(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,s=i.y;if(x(r)&&x(s)){const o=r.impute?r:s.impute?s:void 0;if(o===void 0)return;const a=r.impute?s:s.impute?r:void 0,{method:c,value:l,frame:u,keyvals:f}=o.impute,d=$c(n.mark,i);return new Qt(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},c?{method:c}:{}),l!==void 0?{value:l}:{}),u?{frame:u}:{}),f!==void 0?{keyvals:f}:{}),d.length?{groupby:d}:{}))}return null}hash(){return`Impute ${I(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:s,value:o,frame:a=[null,null]}=this.transform,c=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},i?{keyvals:$h(i)?this.processSequence(i):i}:{}),{method:"value"}),s?{groupby:s}:{}),{value:!r||r==="value"?o:null});if(r&&r!=="value"){const l=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1},s?{groupby:s}:{}),u={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[c,l,u]}else return[c]}}var Dy=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class br extends M{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=F(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.loess]}clone(){return new br(null,F(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${I(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:i}=t,r=Dy(t,["loess","on"]),s=Object.assign({type:"loess",x:i,y:n},r);return s}}class oi extends M{constructor(t,n,i){super(t);this.transform=n,this.secondary=i}clone(){return new oi(null,F(this.transform),this.secondary)}static make(t,n,i,r){const s=n.component.data.sources,{from:o}=i;let a=null;if(Nh(o)){let c=Wu(o.data,s);c||(c=new Xt(o.data),s.push(c));const l=n.getName(`lookup_${r}`);a=new ae(c,l,D.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(Ph(o)){const c=o.selection;if(i=Object.assign({as:c},i),a=n.getSelectionComponent(W(c),c).materialized,!a)throw new Error(Hf(c))}return new oi(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?V(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${I({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:V(this.transform.as)}:{});else{let n=this.transform.as;A(n)||(y(Zf),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}var Uy=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class yr extends M{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=F(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"prob",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new yr(null,F(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${I(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,i=Uy(t,["quantile"]),r=Object.assign({type:"quantile",field:n},i);return r}}var Wy=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Or extends M{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=F(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.regression]}clone(){return new Or(null,F(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${I(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:i}=t,r=Wy(t,["regression","on"]),s=Object.assign({type:"regression",x:i,y:n},r);return s}}class vr extends M{constructor(t,n){super(t);this.transform=n}clone(){return new vr(null,F(this.transform))}addDimensions(t){var n;this.transform.groupby=Ce(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),i=>i)}producedFields(){return}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${I(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},r!==void 0?{limit:r}:{}),s!==void 0?{op:s}:{}),i!==void 0?{groupby:i}:{})}}class xr extends M{constructor(t,n){super(t);this.transform=n}clone(){return new xr(null,F(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${I(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function Mu(e){let t=0;function n(i,r){var s;if(i instanceof Xt&&(!i.isGenerator&&!Yn(i.data))){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}if(i instanceof ne&&(i.parent instanceof Xt&&!r.source?(r.format=Object.assign(Object.assign({},(s=r.format)!==null&&s!==void 0?s:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof xn){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source;for(const o of i.assemble())e.push(o);return}if((i instanceof ti||i instanceof ni||i instanceof ri||i instanceof bn||i instanceof yn||i instanceof si||i instanceof jn||i instanceof $e||i instanceof oi||i instanceof Sn||i instanceof Kt||i instanceof mr||i instanceof hr||i instanceof pr||i instanceof br||i instanceof yr||i instanceof Or||i instanceof Ct||i instanceof xr||i instanceof vr)&&r.transform.push(i.assemble()),(i instanceof Xe||i instanceof Ge||i instanceof Qt||i instanceof gt)&&r.transform.push(...i.assemble()),i instanceof ae){if(r.source&&r.transform.length===0)i.setSource(r.source);else if(i.parent instanceof ae)i.setSource(r.name);else if(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}}switch(i.numChildren()){case 0:i instanceof ae&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const a of i.children){const c={name:null,source:o,transform:[]};n(a,c)}break}}}return n}function By(e){const t=[],n=Mu(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function qy(e,t){var n,i;const r=[],s=Mu(r);let o=0;for(const c of e.sources){c.hasName()||(c.dataName=`source_${o++}`);const l=c.assemble();s(c,l)}for(const c of r)c.transform.length===0&&delete c.transform;let a=0;for(const[c,l]of r.entries())((n=l.transform)!==null&&n!==void 0?n:[]).length===0&&!l.source&&r.splice(a++,0,r.splice(c,1)[0]);for(const c of r)for(const l of(i=c.transform)!==null&&i!==void 0?i:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const c of r)c.name in t&&(c.values=t[c.name]);return r}function Hy(e){return e==="top"||e==="left"||E(e)?"header":"footer"}function Gy(e){for(const t of me)Vy(e,t);Uu(e,"x"),Uu(e,"y")}function Vy(e,t){var n;const{facet:i,config:r,child:s,component:o}=e;if(e.channelHasField(t)){const a=i[t],c=vn("title",null,r,t);let l=dn(a,r,{allowDisabling:!0,includeDefault:c===void 0||!!c});s.component.layoutHeaders[t].title&&(l=j(l)?l.join(", "):l,l+=" / "+s.component.layoutHeaders[t].title,s.component.layoutHeaders[t].title=null);const u=vn("labelOrient",a,r,t),f=(n=a.header)!==null&&n!==void 0?n:{},d=X(f.labels,r.header.labels,!0),g=w(["bottom","right"],u)?"footer":"header";o.layoutHeaders[t]={title:l,facetFieldDef:a,[g]:t==="facet"?[]:[Du(e,t,d)]}}}function Du(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function Uu(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:s}=e.component;if(s.axis[t]=co(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=r[o];for(const c of i.component.axes[t]){const l=Hy(c.get("orient"));a[l]=(n=a[l])!==null&&n!==void 0?n:[Du(e,o,!1)];const u=ei(c,"main",e.config,{header:!0});u&&a[l][0].axes.push(u),c.mainExtracted=!0}}}}function Xy(e){Eo(e),Sr(e,"width"),Sr(e,"height")}function Yy(e){Eo(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";Sr(e,t),Sr(e,n)}function Eo(e){for(const t of e.children)t.parseLayoutSize()}function Sr(e,t){const n=nu(t),i=_i(n),r=e.component.resolve,s=e.component.layoutSize;let o;for(const a of e.children){const c=a.component.layoutSize.getWithExplicit(n),l=r.scale[i];if(l==="independent"&&c.value==="step"){o=void 0;break}if(o){if(l==="independent"&&o.value!==c.value){o=void 0;break}o=kt(o,c,n,"")}else o=c}if(o){for(const a of e.children)e.renameSignal(a.getName(n),e.getName(t)),a.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,o)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function Ky(e){const{size:t,component:n}=e;for(const i of be){const r=Me(i);if(t[r]){const s=t[r];n.layoutSize.set(r,He(s)?"step":s,!0)}else{const s=Qy(e,r);n.layoutSize.set(r,s,!1)}}}function Qy(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const s=r.get("type"),o=r.get("range");if(ue(s)){const a=Xn(i.view,t);return St(o)||He(a)?"step":a}else return Ms(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return Ms(i.view,t);{const s=Xn(i.view,t);return He(s)?s.step:s}}}var Jy=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function $o(e,t,n){return v(t,Object.assign({suffix:`by_${v(e)}`},n??{}))}class ai extends zu{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve);this.child=Fo(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!Hn(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=b(t),i={};for(const r of n){if(!w([Ze,et],r)){y(Ei(r,"facet"));break}const s=t[r];if(s.field===void 0){y(qr(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(t,n){const{header:i}=t,r=Jy(t,["header"]),s=ws(r,n);return i&&(s.header=we(i)),s}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=_r(this),this.child.parseData()}parseLayoutSize(){Eo(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),Gy(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,i;const r={};for(const s of me)for(const o of so){const a=this.component.layoutHeaders[s],c=a[o],{facetFieldDef:l}=a;if(l){const u=vn("titleOrient",l.header,this.config,s);if(w(["right","bottom"],u)){const f=lr(s,u);r.titleAnchor=(t=r.titleAnchor)!==null&&t!==void 0?t:{},r.titleAnchor[f]="end"}}if(c==null?void 0:c[0]){const u=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(u)&&(r[f]=(n=r[f])!==null&&n!==void 0?n:{},r[f][s]=.5),a.title&&(r.offset=(i=r.offset)!==null&&i!==void 0?i:{},r.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),i?{columns:i}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof ai)return;{const t=this.getName("column_domain");return{signal:`length(data('${t}'))`}}}assembleGroup(t){return this.parent&&this.parent instanceof ai?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:v(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof ai){if(this.child.channelHasField("column")){const r=v(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of be){const s=this.child.component.scales[r];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(ue(o)&&St(a)){const c=gr(this.child,r),l=xo(c);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):y(Br(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),c=[];for(const u of me){const f=this.facet[u];if(f){c.push(v(f));const{bin:d,sort:g}=f;if(B(d)&&c.push(v(f,{binSuffix:"end"})),We(g)){const{field:p,op:m=Ri}=g,h=$o(f,g);i&&r?(s.push(h),o.push("max"),a.push(h)):(s.push(p),o.push(m),a.push(h))}else if(j(g)){const p=On(f,u);s.push(p),o.push("max"),a.push(p)}}}const l=!!i&&!!r;return Object.assign({name:t,data:n,groupby:c},l||s.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),s.length?{fields:s,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:n}=this,i=n[t];return i?We(i.sort)?[$o(i,i.sort,{expr:"datum"})]:j(i.sort)?[On(i,t,{expr:"datum"})]:[v(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i,s=(We(r)?r.order:!j(r)&&r)||"ascending";return[s]}return[]}assembleLabelTitle(){var t;const{facet:n,config:i}=this;if(n.facet)return oo(n.facet,"facet",i);const r={row:["top","bottom"],column:["left","right"]};for(const s of ro)if(n[s]){const o=vn("labelOrient",(t=n[s])===null||t===void 0?void 0:t.header,i,s);if(w(r[s],o))return oo(n[s],s,i)}return}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=By(n),r=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle(),a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},s?{title:s}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:me.map(c=>this.facetSortFields(c)).flat(),order:me.map(c=>this.facetSortOrder(c)).flat()}}),i.length>0?{data:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(vm(this,[])));return[a]}getMapping(){return this.facet}}function Zy(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const s of[n,i])if(We(s.sort)){const{field:o,op:a=Ri}=s.sort;e=r=new Kt(e,{joinaggregate:[{op:a,field:o,as:$o(s,s.sort,{forAs:!0})}],groupby:[v(s)]})}return r}return null}function Wu(e,t){var n,i,r,s;for(const o of t){const a=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const c=(n=e.format)===null||n===void 0?void 0:n.mesh,l=(i=a.format)===null||i===void 0?void 0:i.feature;if(c&&l)continue;const u=(r=e.format)===null||r===void 0?void 0:r.feature;if((u||l)&&u!==l)continue;const f=(s=a.format)===null||s===void 0?void 0:s.mesh;if((c||f)&&c!==f)continue;if(tr(e)&&tr(a)){if(nn(e.values,a.values))return o}else if(Yn(e)&&Yn(a)){if(e.url===a.url)return o}else if(gl(e)&&e.name===o.dataName)return o}return null}function eO(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Xt({values:[]});return t.push(i),i}const n=Wu(e.data,t);if(n)return Ht(e.data)||(n.data.format=Bo({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Xt(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function tO(e,t,n){var i,r;let s=0;for(const o of t.transforms){let a,c;if(Dh(o))c=e=new yn(e,o),a="derived";else if(ml(o)){const l=Db(o);c=e=(i=ne.makeWithAncestors(e,{},l,n))!==null&&i!==void 0?i:e,e=new bn(e,t,o.filter)}else if(Uh(o))c=e=Xe.makeFromTransform(e,o,t),a="number";else if(Bh(o)){a="date";const l=n.getWithExplicit(o.field);l.value===void 0&&(e=new ne(e,{[o.field]:a}),n.set(o.field,a,!1)),c=e=Ge.makeFromTransform(e,o)}else if(qh(o))c=e=$e.makeFromTransform(e,o),a="number",Zs(t)&&(e=new Ct(e));else if(kh(o))c=e=oi.make(e,t,o,s++),a="derived";else if(Lh(o))c=e=new Sn(e,o),a="number";else if(zh(o))c=e=new Kt(e,o),a="number";else if(Hh(o))c=e=gt.makeFromTransform(e,o),a="derived";else if(Gh(o))c=e=new mr(e,o),a="derived";else if(Mh(o))c=e=new hr(e,o),a="derived";else if(Ch(o))c=e=new vr(e,o),a="derived";else if(Rh(o))e=new xr(e,o);else if(Wh(o))c=e=Qt.makeFromTransform(e,o),a="derived";else if(Fh(o))c=e=new pr(e,o),a="derived";else if(Ah(o))c=e=new yr(e,o),a="derived";else if(Th(o))c=e=new Or(e,o),a="derived";else if(Ih(o))c=e=new br(e,o),a="derived";else{y(Jf(o));continue}if(c&&a!==void 0)for(const l of(r=c.producedFields())!==null&&r!==void 0?r:[])n.set(l,a,!1)}return e}function _r(e){var t,n,i,r,s,o,a,c,l,u;let f=eO(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:g}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new Eh,m=e.data;Ht(m)?(pl(m)?f=new ni(f,m.sequence):qs(m)&&(f=new ti(f,m.graticule)),p.parseNothing=!0):((t=m==null?void 0:m.format)===null||t===void 0?void 0:t.parse)===null&&(p.parseNothing=!0),f=(n=ne.makeExplicit(f,e,p))!==null&&n!==void 0?n:f,f=new Ct(f);const h=e.parent&&_n(e.parent);(G(e)||Ne(e))&&(h&&(f=(i=Xe.makeFromEncoding(f,e))!==null&&i!==void 0?i:f)),e.transforms.length>0&&(f=tO(f,e,p));const S=Wb(e),O=Ub(e);f=(r=ne.makeWithAncestors(f,{},Object.assign(Object.assign({},S),O),p))!==null&&r!==void 0?r:f,G(e)&&(f=jn.parseAll(f,e),f=si.parseAll(f,e)),(G(e)||Ne(e))&&(h||(f=(s=Xe.makeFromEncoding(f,e))!==null&&s!==void 0?s:f),f=(o=Ge.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=yn.parseAllForSortIndex(f,e));const _=e.getDataName(D.Raw),$=new ae(f,_,D.Raw,g);if(d[_]=$,f=$,G(e)){const C=$e.makeFromEncoding(f,e);C&&(f=C,Zs(e)&&(f=new Ct(f))),f=(a=Qt.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=(c=gt.makeFromEncoding(f,e))!==null&&c!==void 0?c:f}G(e)&&(f=(l=ri.make(f,e))!==null&&l!==void 0?l:f);const P=e.getDataName(D.Main),T=new ae(f,P,D.Main,g);d[P]=T,f=T,G(e)&&Im(e,T);let N=null;if(Ne(e)){const C=e.getName("facet");f=(u=Zy(f,e.facet))!==null&&u!==void 0?u:f,N=new xn(f,e,C,T.getSource()),d[C]=N}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:g,raw:$,main:T,facetRoot:N,ancestorParse:p})}class nO extends wo{constructor(t,n,i,r){var s,o,a,c;super(t,"concat",n,i,r,t.resolve);(((o=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||o===void 0?void 0:o.x)==="shared"||((c=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||c===void 0?void 0:c.y)==="shared")&&y(Yf),this.children=this.getChildren(t).map((l,u)=>Fo(l,this,this.getName("concat_"+u),void 0,r))}parseData(){this.component.data=_r(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of b(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return Qi(t)?t.vconcat:zs(t)?t.hconcat:t.concat}parseLayoutSize(){Yy(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=ao(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),i?{style:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function iO(e){return e===!1||e===null}const rO=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},Jo),{labelExpr:1,encode:1}),Bu=b(rO);class ko extends ut{constructor(t={},n={},i=!1){super();this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new ko(F(this.explicit),F(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!iO(this.get(t))}hasOrientSignalRef(){return E(this.explicit.orient)}}function sO(e,t,n){var i;const{encoding:r,config:s}=e,o=(i=J(r[t]))!==null&&i!==void 0?i:J(r[ze(t)]),a=e.axis(t)||{},{format:c,formatType:l}=a;return Ut(l)?Object.assign({text:hs({fieldOrDatumDef:o,field:"datum.value",format:c,formatType:l,config:s})},n):n}function oO(e){return be.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[gO(n,e)]),t),{})}const aO={bottom:"top",top:"bottom",left:"right",right:"left"};function cO(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of b(s.component.axes))i.axis[o]=co(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=lO(n[o],s.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const s of be){for(const o of e.children){if(!o.component.axes[s])continue;if(i.axis[s]==="independent"){n[s]=((t=n[s])!==null&&t!==void 0?t:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:c,explicit:l}=a.getWithExplicit("orient");if(E(c))continue;if(r[c]>0&&!l){const u=aO[c];r[c]>r[u]&&a.set("orient",u,!1)}r[c]++}}delete o.component.axes[s]}if(i.axis[s]==="independent"&&n[s]&&n[s].length>1)for(const o of n[s])!!o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function lO(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t[i];if(!!r!==!!s)return;if(r&&s){const o=r.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[i]=uO(r,s)}}}else return t.map(n=>n.clone());return e}function uO(e,t){for(const n of Bu){const i=kt(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return wc(r,s);case"gridScale":return{explicit:r.explicit,value:X(r.value,s.value)}}return er(r,s,n,"axis")});e.setWithExplicit(n,i)}return e}function fO(e,t,n,i,r){if(t==="disable")return n!==void 0;n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(E(n.labelAngle)?n.labelAngle:Tn(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===Kl(i,r))return!0}return e===n[t]}const dO=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function gO(e,t){var n,i,r;let s=t.axis(e);const o=new ko,a=J(t.encoding[e]),{mark:c,config:l}=t,u=(s==null?void 0:s.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=l.axis)===null||i===void 0?void 0:i.orient)||Hm(e),f=t.getScaleComponent(e).get("type"),d=zm(e,f,u,t.config),g=s!==void 0?!s:no("disable",l.style,s==null?void 0:s.style,d).configValue;if(o.set("disable",g,s!==void 0),g)return o;s=s||{};const p=Wm(a,s,e,l.style,d),m={fieldOrDatumDef:a,axis:s,channel:e,model:t,scaleType:f,orient:u,labelAngle:p,mark:c,config:l};for(const O of Bu){const _=O in Vl?Vl[O](m):Zo(O)?s[O]:void 0,$=_!==void 0,P=fO(_,O,s,t,e);if($&&P)o.set(O,_,P);else{const{configValue:T=void 0,configFrom:N=void 0}=Zo(O)&&O!=="values"?no(O,l.style,s.style,d):{},C=T!==void 0;$&&!C?o.set(O,_,P):(!(N==="vgAxisConfig")||dO.has(O)&&C||In(T)||E(T))&&o.set(O,T,!1)}}const h=(r=s.encoding)!==null&&r!==void 0?r:{},S=Qo.reduce((O,_)=>{var $;if(!o.hasAxisPart(_))return O;const P=iu(($=h[_])!==null&&$!==void 0?$:{},t),T=_==="labels"?sO(t,e,P):P;return T!==void 0&&!z(T)&&(O[_]={update:T}),O},{});return z(S)||o.set("encode",S,!!s.encoding||s.labelAngle!==void 0),o}function pO({encoding:e,size:t}){for(const n of be){const i=Me(n);He(t[i])&&(Be(e[n])&&(delete t[i],y(ja(i))))}return t}function hO(e,t,n){const i=we(e),r=L("orient",i,n);if(i.orient=OO(i.type,t,r),r!==void 0&&r!==i.orient&&y(fd(i.orient,r)),i.type==="bar"&&i.orient){const a=L("cornerRadiusEnd",i,n);if(a!==void 0){const c=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:Dg[i.orient];for(const l of c)i[l]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}const s=L("opacity",i,n);s===void 0&&(i.opacity=bO(i.type,t));const o=L("cursor",i,n);return o===void 0&&(i.cursor=mO(i,t,n)),i}function mO(e,t,n){return t.href||e.href||L("href",e,n)?"pointer":e.cursor}function bO(e,t){return w([Fi,ls,us,fs],e)&&!$s(t)?.7:void 0}function yO(e,t,{graticule:n}){if(n)return!1;const i=Bt("filled",e,t),r=e.type;return X(i,r!==Fi&&r!==Ci&&r!==Ai)}function OO(e,t,n){switch(e){case Fi:case us:case fs:case Ua:case Cg:case Pg:return}const{x:i,y:r,x2:s,y2:o}=t;switch(e){case Pi:if(x(i)&&(ie(i.bin)||x(r)&&r.aggregate&&!i.aggregate))return"vertical";if(x(r)&&(ie(r.bin)||x(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(x(i)&&i.type===Mt&&!B(i.bin)||xs(i)))return"horizontal";if(!o&&(x(r)&&r.type===Mt&&!B(r.bin)||xs(r)))return"vertical"}case Ai:if(s&&!(x(i)&&ie(i.bin))&&o&&!(x(r)&&ie(r.bin)))return;case Ni:if(o)return x(r)&&ie(r.bin)?"horizontal":"vertical";if(s)return x(i)&&ie(i.bin)?"vertical":"horizontal";if(e===Ai){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case Ci:case ls:{const a=Be(i),c=Be(r);if(a&&!c)return e!=="tick"?"horizontal":"vertical";if(!a&&c)return e!=="tick"?"vertical":"horizontal";if(a&&c){const l=i,u=r,f=l.type===un,d=u.type===un;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!l.aggregate&&u.aggregate?e!=="tick"?"vertical":"horizontal":l.aggregate&&!u.aggregate?e!=="tick"?"horizontal":"vertical":n||"vertical"}else return n||void 0}}return"vertical"}const vO={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ve(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),te("x",e,{defaultPos:"mid"})),te("y",e,{defaultPos:"mid"})),Nt(e,"radius","arc")),Nt(e,"theta","arc"))},xO={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},ve(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),ir("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),ir("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),Vs(e))},SO={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},ve(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Nt(e,"x","bar")),Nt(e,"y","bar"))},_O={vgMark:"shape",encodeEntry:e=>Object.assign({},ve(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape,i=Object.assign({type:"geoshape",projection:e.projectionName()},n&&x(n)&&n.type===fn?{field:v(n,{expr:"datum"})}:{});return[i]}},jO={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},ve(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),Nt(e,"x","image")),Nt(e,"y","image")),Hs(e,"url"))},wO={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ve(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),te("x",e,{defaultPos:"mid"})),te("y",e,{defaultPos:"mid"})),ee("size",e,{vgChannel:"strokeWidth"})),Vs(e))},EO={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ve(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),te("x",e,{defaultPos:"mid"})),te("y",e,{defaultPos:"mid"})),ee("size",e)),Vs(e))};function No(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ve(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),te("x",e,{defaultPos:"mid"})),te("y",e,{defaultPos:"mid"})),ee("size",e)),ee("angle",e)),$O(e,n,t))}function $O(e,t,n){return n?{shape:{value:n}}:ee("shape",e)}const kO={vgMark:"symbol",encodeEntry:e=>No(e)},NO={vgMark:"symbol",encodeEntry:e=>No(e,"circle")},PO={vgMark:"symbol",encodeEntry:e=>No(e,"square")},CO={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},ve(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Nt(e,"x","rect")),Nt(e,"y","rect"))},FO={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},ve(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ir("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),ir("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),ee("size",e,{vgChannel:"strokeWidth"}))}},AO={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ve(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),te("x",e,{defaultPos:"mid"})),te("y",e,{defaultPos:"mid"})),Hs(e)),ee("size",e,{vgChannel:"fontSize"})),ee("angle",e)),wl("align",TO(e.markDef,n,t))),wl("baseline",IO(e.markDef,n,t))),te("radius",e,{defaultPos:null,isMidPoint:!0})),te("theta",e,{defaultPos:null,isMidPoint:!0}))}};function TO(e,t,n){const i=L("align",e,n);return i===void 0?"center":void 0}function IO(e,t,n){const i=L("baseline",e,n);return i===void 0?"middle":void 0}const RO={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",s=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ve(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),te("x",e,{defaultPos:"mid",vgChannel:"xc"})),te("y",e,{defaultPos:"mid",vgChannel:"yc"})),ee("size",e,{defaultValue:LO(e),vgChannel:r})),{[s]:H(L("thickness",n,t))})}};function LO(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,s=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),a=(t=L("size",i,n,{vgChannel:s}))!==null&&t!==void 0?t:n.tick.bandSize;if(a!==void 0)return a;{const c=o?o.get("range"):void 0;if(c&&St(c)&&Y(c.step))return c.step*3/4;const l=Ji(n.view,s);return l*3/4}}const jr={arc:vO,area:xO,bar:SO,circle:NO,geoshape:_O,image:jO,line:wO,point:kO,rect:CO,rule:FO,square:PO,text:AO,tick:RO,trail:EO};function zO(e){if(w([Ci,Ni,Fg],e.mark)){const t=$c(e.mark,e.encoding);if(t.length>0)return MO(e,t)}else if(w([Pi],e.mark)){const t=Kr.some(n=>L(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return DO(e)}return Po(e)}const qu="faceted_path_";function MO(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:qu+e.requestDataName(D.Main),data:e.requestDataName(D.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:Po(e,{fromPrefix:qu})}]}const Hu="stack_group_";function DO(e){const[t]=Po(e,{fromPrefix:Hu}),n=e.scaleName(e.stack.fieldChannel),i=(u={})=>e.vgField(e.stack.fieldChannel,u),r=(u,f)=>{const d=[i({prefix:"min",suffix:"start",expr:f}),i({prefix:"max",suffix:"start",expr:f}),i({prefix:"min",suffix:"end",expr:f}),i({prefix:"max",suffix:"end",expr:f})];return`${u}(${d.map(g=>`scale('${n}',${g})`).join(",")})`};let s,o;e.stack.fieldChannel==="x"?(s=Object.assign(Object.assign({},rn(t.encode.update,["y","yc","y2","height",...Kr])),{x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},fe(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(s=Object.assign(Object.assign({},rn(t.encode.update,["x","xc","x2","width"])),{y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},fe(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const u of Kr){const f=Bt(u,e.markDef,e.config);t.encode.update[u]?(s[u]=t.encode.update[u],delete t.encode.update[u]):f&&(s[u]=H(f)),f&&(t.encode.update[u]={value:0})}const a=e.fieldDef(e.stack.groupbyChannel),c=v(a)?[v(a)]:[];((a==null?void 0:a.bin)||(a==null?void 0:a.timeUnit))&&c.push(v(a,{binSuffix:"end"}));const l=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return s=l.reduce((u,f)=>{if(t.encode.update[f])return Object.assign(Object.assign({},u),{[f]:t.encode.update[f]});{const d=Bt(f,e.markDef,e.config);return d!==void 0?Object.assign(Object.assign({},u),{[f]:H(d)}):u}},s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(D.Main),name:Hu+e.requestDataName(D.Main),groupby:c,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}function UO(e){const{encoding:t,stack:n,mark:i,markDef:r,config:s}=e,o=t.order;if(!j(o)&&Ee(o)&&Nr(o.value)||!o&&Nr(L("order",r,s)))return;if((j(o)||x(o))&&!n)return Sc(o,{expr:"datum"});if(_t(i)){const a=r.orient==="horizontal"?"y":"x",c=t[a];if(x(c)){const l=c.sort;if(j(l))return{field:v(c,{prefix:a,suffix:"sort_index",expr:"datum"})};if(We(l))return{field:v({aggregate:$s(e.encoding)?l.op:void 0,field:l.field},{expr:"datum"})};if(rc(l)){const u=e.fieldDef(l.encoding);return{field:v(u,{expr:"datum"}),order:l.order}}else return l===null?void 0:{field:v(c,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}return}return}function Po(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=e,o=X(i.clip,WO(e),BO(e)),a=vc(i),c=r.key,l=UO(e),u=qO(e),f=L("aria",i,s),d=jr[n].postEncodingTransform?jr[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:jr[n].vgMark},o?{clip:!0}:{}),a?{style:a}:{}),c?{key:c.field}:{}),l?{sort:l}:{}),u||{}),f===!1?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(D.Main)},encode:{update:jr[n].encodeEntry(e)}}),d?{transform:d}:{})]}function WO(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function BO(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function qO(e){if(!e.component.selection)return null;const t=b(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=b(i.component.selection).length,i=i.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}class Gu extends zu{constructor(t,n,i,r={},s){super(t,"unit",n,i,s,void 0,Gc(t)?t.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const o=ot(t.mark)?Object.assign({},t.mark):{type:t.mark},a=o.type;o.filled===void 0&&(o.filled=yO(o,s,{graticule:t.data&&qs(t.data)}));const c=this.encoding=pp(t.encoding||{},a,o.filled,s);this.markDef=hO(o,c,s),this.size=pO({encoding:c,size:Gc(t)?Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):r}),this.stack=Zc(a,c),this.specifiedScales=this.initScales(a,c),this.specifiedAxes=this.initAxes(c),this.specifiedLegends=this.initLegends(c),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,n=this.mark===Wa,i=t&&jf.some(r=>k(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return ji.reduce((i,r)=>{var s;const o=J(n[r]);return o&&(i[r]=this.initScale((s=o.scale)!==null&&s!==void 0?s:{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=we(t);return j(n)&&(r.domain=n.map(oe)),j(i)&&(r.range=i.map(oe)),r}initAxes(t){return be.reduce((n,i)=>{const r=t[i];if(k(r)||i===q&&k(t.x2)||i===Q&&k(t.y2)){const s=k(r)?r.axis:void 0;n[i]=s&&this.initAxis(Object.assign({},s))}return n},{})}initAxis(t){const n=b(t),i={};for(const r of n){const s=t[r];i[r]=In(s)?bc(s):oe(s)}return i}initLegends(t){return Af.reduce((n,i)=>{const r=J(t[i]);if(r&&If(i)){const s=r.legend;n[i]=s&&we(s)}return n},{})}parseData(){this.component.data=_r(this)}parseLayoutSize(){Ky(this)}parseSelections(){this.component.selection=Tm(this,this.selection)}parseMarkGroup(){this.component.mark=zO(this)}parseAxesAndHeaders(){this.component.axes=oO(this)}assembleSelectionTopLevelSignals(t){return xm(this,t)}assembleSignals(){return[...Hl(this),...Om(this,[])]}assembleSelectionData(t){return Sm(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return ao(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!_n(this.parent))&&(n=Ll(this,n)),n.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return qt(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return qe(n)}typedFieldDef(t){const n=this.fieldDef(t);return Oe(n)?n:null}}class Co extends wo{constructor(t,n,i,r,s){super(t,"layer",n,i,s,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((a,c)=>{if(Zi(a))return new Co(a,this,this.getName("layer_"+c),o,s);if(ct(a))return new Gu(a,this,this.getName("layer_"+c),o,s);throw new Error(Wr(a))})}parseData(){this.component.data=_r(this);for(const t of this.children)t.parseData()}parseLayoutSize(){Xy(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of b(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){cO(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),Hl(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),ao(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t;return}assembleLayout(){return null}assembleMarks(){return _m(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),gu(this))}}function Fo(e,t,n,i,r){if(Li(e))return new ai(e,t,n,r);if(Zi(e))return new Co(e,t,n,i,r);if(ct(e))return new Gu(e,t,n,i,r);if(Mp(e))return new nO(e,t,n,r);throw new Error(Wr(e))}var HO=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function GO(e,t={}){t.logger&&Rd(t.logger),t.fieldTitle&&gc(t.fieldTitle);try{const n=Qc(Wo(t.config,e.config)),i=ll(e,n),r=Fo(i,null,"",void 0,n);r.parse(),ry(r.component.data,r);const s=XO(r,VO(e,i.autosize,n,r),e.datasets,e.usermeta);return{spec:s,normalized:i}}finally{t.logger&&Ld(),t.fieldTitle&&sp()}}function VO(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):A(t)&&(t={type:t}),r&&s&&_h(t.type)){if(r==="step"&&s==="step")y(ha()),t.type="pad";else if(r==="step"||s==="step"){const o=r==="step"?"width":"height";y(ha(_i(o)));const a=o==="width"?"height":"width";t.type=jh(a)}}return Object.assign(Object.assign(Object.assign({},b(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),fl(n,!1)),fl(e,!0))}function XO(e,t,n={},i){const r=e.config?eh(e.config):void 0,s=[].concat(e.assembleSelectionData([]),qy(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),c=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let u=e.assembleLayoutSignals();u=u.filter(g=>(g.name==="width"||g.name==="height")&&g.value!==void 0?(t[g.name]=+g.value,!1):!0);const{params:f}=t,d=HO(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),a?{title:a}:{}),c?{style:c}:{}),l?{encode:{update:l}}:{}),{data:s}),o.length>0?{projections:o}:{}),e.assembleGroup([...u,...e.assembleSelectionTopLevelSignals([]),...Hc(f)])),r?{config:r}:{}),i?{usermeta:i}:{})}export{an as accessPathDepth,Tr as accessPathWithDatum,GO as compile,w as contains,nn as deepEqual,mi as deleteNestedProperty,F as duplicate,Cn as entries,Pr as every,Ar as fieldIntersection,Ho as flatAccessWithDatum,X as getFirstDefined,Cr as hasIntersection,I as hash,Xo as internalField,Fn as isBoolean,z as isEmpty,cf as isEqual,Yo as isInternalField,Nr as isNullOrFalse,bi as isNumeric,b as keys,on as logicalExpr,Bo as mergeDeep,ll as normalize,Tn as normalizeAngle,fe as omit,rn as pick,Fr as prefixGenerator,Ir as removePathFromField,Tt as replaceAll,Qe as replacePathInField,uf as resetIdCounter,qo as setEqual,sn as some,U as stringify,An as titleCase,Ce as unique,Vo as uniqueId,Ke as vals,W as varName,of as version};export default null;
