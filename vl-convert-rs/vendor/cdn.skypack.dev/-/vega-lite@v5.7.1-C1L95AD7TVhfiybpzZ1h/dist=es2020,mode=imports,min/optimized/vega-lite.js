import{hasOwnProperty as on,isNumber as K,isString as P,writeConfig as Nf,splitAccessPath as an,stringValue as A,isObject as D,isBoolean as Un,isArray as j,array as V,logger as Pf,Warn as Tf,isFunction as Af,mergeConfig as na,identity as zf}from"/-/vega-util@v1.17.1-uwuqwLZrXXBeO0DFYRgh/dist=es2020,mode=imports,min/optimized/vega-util.js";import If from"/-/clone@v2.1.2-inH2VLNzDGiYU9HUWyZM/dist=es2020,mode=imports,min/optimized/clone.js";import Rf from"/-/fast-deep-equal@v3.1.3-ysejKs1WDEDPxUJhgGoP/dist=es2020,mode=imports,min/optimized/fast-deep-equal.js";import zr from"/-/fast-json-stable-stringify@v2.1.0-HLgsuOtxPikt0pw16nth/dist=es2020,mode=imports,min/optimized/fast-json-stable-stringify.js";import{isObject as Ir,writeConfig as Lf,isArray as ia,isString as _i}from"/-/vega@v5.24.0-1k4m6TDjSYdmzGt1pFvV/dist=es2020,mode=imports,min/optimized/vega.js";import{parseSelector as cn}from"/-/vega-event-selector@v3.0.1-UgiEAWJA4WQL4DTKnV4R/dist=es2020,mode=imports,min/optimized/vega-event-selector.js";import{parseExpression as Mf}from"/-/vega-expression@v5.0.1-M3HJnXNS0AVPna9ohQFr/dist=es2020,mode=imports,min/optimized/vega-expression.js";const Df="vega-lite",Uf='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',Wf="5.7.1",Bf=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],Hf="https://vega.github.io/vega-lite/",qf="Vega-Lite is a concise high-level language for interactive visualization.",Gf=["vega","chart","visualization"],Vf="build/vega-lite.js",Xf="build/vega-lite.min.js",Yf="build/vega-lite.min.js",Kf="build/src/index",Qf="build/src/index.d.ts",Zf={vl2pdf:"./bin/vl2pdf",vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},Jf=["bin","build","src","vega-lite*","tsconfig.json"],ed={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.mjs","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",jest:"NODE_OPTIONS=--experimental-vm-modules npx jest",test:"yarn jest test/ && yarn lint && yarn schema && yarn jest examples/ && yarn test:runtime","test:cover":"yarn jest --collectCoverage test/","test:inspect":"node --inspect-brk --experimental-vm-modules ./node_modules/.bin/jest --runInBand test","test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"yarn jest --watch test/","watch:test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest --watch test-runtime/ --config test-runtime/jest-config.json",release:"release-it"},td={type:"git",url:"https://github.com/vega/vega-lite.git"},nd="BSD-3-Clause",id={url:"https://github.com/vega/vega-lite/issues"},rd={"@babel/core":"^7.21.0","@babel/preset-env":"^7.20.2","@babel/preset-typescript":"^7.21.0","@release-it/conventional-changelog":"^5.1.1","@rollup/plugin-alias":"^5.0.0","@rollup/plugin-babel":"^6.0.3","@rollup/plugin-commonjs":"^24.0.1","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.1","@rollup/plugin-terser":"^0.4.0","@types/chai":"^4.3.4","@types/d3":"^7.4.0","@types/jest":"^27.4.1","@types/pako":"^2.0.0","@typescript-eslint/eslint-plugin":"^5.52.0","@typescript-eslint/parser":"^5.52.0","ajv-formats":"^2.1.1",ajv:"^8.12.0",chai:"^4.3.7",cheerio:"^1.0.0-rc.12","conventional-changelog-cli":"^2.2.2",d3:"^7.8.2","del-cli":"^5.0.0","eslint-config-prettier":"^8.6.0","eslint-plugin-jest":"^27.2.1","eslint-plugin-prettier":"^4.2.1",eslint:"^8.34.0","highlight.js":"^11.7.0","jest-dev-server":"^6.1.1",jest:"^27.5.1",mkdirp:"^2.1.3",pako:"^2.1.0",prettier:"^2.8.4",puppeteer:"^15.0.0","release-it":"^15.6.0","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3",rollup:"^3.17.2",serve:"^14.2.0",terser:"^5.16.4","ts-jest":"^29.0.5","ts-json-schema-generator":"^1.2.0",typescript:"~4.9.5","vega-cli":"^5.22.1","vega-datasets":"~2.7.0","vega-embed":"^6.21.3","vega-tooltip":"^0.31.0","yaml-front-matter":"^4.1.1"},sd={"@types/clone":"~2.1.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.5.0","vega-event-selector":"~3.0.0","vega-expression":"~5.0.0","vega-util":"~1.17.0",yargs:"~17.7.0"},od={vega:"^5.24.0"},ad={node:">=12"};var cd={name:Df,author:Uf,version:Wf,collaborators:Bf,homepage:Hf,description:qf,keywords:Gf,main:Vf,unpkg:Xf,jsdelivr:Yf,module:Kf,types:Qf,bin:Zf,files:Jf,scripts:ed,repository:td,license:nd,bugs:id,devDependencies:rd,dependencies:sd,peerDependencies:od,engines:ad};function Rr(e){return!!e.or}function Lr(e){return!!e.and}function Mr(e){return!!e.not}function ji(e,t){if(Mr(e))ji(e.not,t);else if(Lr(e))for(const n of e.and)ji(n,t);else if(Rr(e))for(const n of e.or)ji(n,t);else t(e)}function ln(e,t){return Mr(e)?{not:ln(e.not,t)}:Lr(e)?{and:e.and.map(n=>ln(n,t))}:Rr(e)?{or:e.or.map(n=>ln(n,t))}:t(e)}const Me=Rf,C=If;function ra(e){throw new Error(e)}function un(e,t){const n={};for(const i of t)on(e,i)&&(n[i]=e[i]);return n}function fe(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>zr(e)).join(",")})`};const U=zr;function I(e){if(K(e))return e;const t=P(e)?e:zr(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function Dr(e){return e===!1||e===null}function z(e,t){return e.includes(t)}function Rt(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function Ur(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function sa(e,...t){for(const n of t)ld(e,n??{});return e}function ld(e,t){for(const n of v(t))Nf(e,n,t[n],!0)}function De(e,t){const n=[],i={};let r;for(const s of e){if(r=t(s),r in i)continue;i[r]=1,n.push(s)}return n}function ud(e,t){const n=v(e),i=v(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function oa(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Wr(e,t){for(const n of e)if(t.has(n))return!0;return!1}function Br(e){const t=new Set;for(const n of e){const i=an(n),r=i.map((o,a)=>a===0?o:`[${o}]`),s=r.map((o,a)=>r.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function Hr(e,t){return e===void 0||t===void 0?!0:Wr(Br(e),Br(t))}function L(e){return v(e).length===0}const v=Object.keys,ie=Object.values,bt=Object.entries;function Wn(e){return e===!0||e===!1}function q(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Bn(e,t){return Mr(e)?`!(${Bn(e.not,t)})`:Lr(e)?`(${e.and.map(n=>Bn(n,t)).join(") && (")})`:Rr(e)?`(${e.or.map(n=>Bn(n,t)).join(") || (")})`:t(e)}function wi(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&wi(e[n],t)&&delete e[n],L(e)}function Hn(e){return e.charAt(0).toUpperCase()+e.substr(1)}function qr(e,t="datum"){const n=an(e),i=[];for(let r=1;r<=n.length;r++){const s=`[${n.slice(0,r).map(A).join("][")}]`;i.push(`${t}${s}`)}return i.join(" && ")}function aa(e,t="datum"){return`${t}[${A(an(e).join("."))}]`}function fd(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Se(e){return`${an(e).map(fd).join("\\.")}`}function Lt(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Gr(e){return`${an(e).join(".")}`}function fn(e){return e?an(e).length:0}function Q(...e){for(const t of e)if(t!==void 0)return t;return}let ca=42;function la(e){const t=++ca;return e?String(e)+t:t}function dd(){ca=42}function ua(e){return fa(e)?e:`__${e}`}function fa(e){return e.startsWith("__")}function qn(e){return e===void 0?void 0:(e%360+360)%360}function $i(e){return K(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}var Gn=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const tt="row",nt="column",Ei="facet",G="x",J="y",Ee="x2",Ue="y2",yt="xOffset",dn="yOffset",ke="radius",it="radius2",_e="theta",rt="theta2",Ce="latitude",Fe="longitude",Ne="latitude2",je="longitude2",de="color",We="fill",Be="stroke",ge="shape",st="size",Mt="angle",ot="opacity",vt="fillOpacity",Ot="strokeOpacity",xt="strokeWidth",St="strokeDash",Vn="text",Xn="order",Yn="detail",ki="key",Dt="tooltip",Ci="href",Fi="url",Ni="description",gd={x:1,y:1,x2:1,y2:1},da={theta:1,theta2:1,radius:1,radius2:1};function ga(e){return e in da}const Vr={longitude:1,longitude2:1,latitude:1,latitude2:1};function pa(e){switch(e){case Ce:return"y";case Ne:return"y2";case Fe:return"x";case je:return"x2"}}function ma(e){return e in Vr}const pd=v(Vr),Xr=Object.assign(Object.assign(Object.assign(Object.assign({},gd),da),Vr),{xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function gn(e){return e===de||e===We||e===Be}const ha={row:1,column:1,facet:1},we=v(ha),Yr=Object.assign(Object.assign({},Xr),ha),md=v(Yr),hd=Gn(Yr,["order","detail","tooltip"]),bd=Gn(hd,["row","column","facet"]);function yd(e){return!!bd[e]}function ba(e){return!!Yr[e]}const vd=[Ee,Ue,Ne,je,rt,it];function ya(e){const t=Ut(e);return t!==e}function Ut(e){switch(e){case Ee:return G;case Ue:return J;case Ne:return Ce;case je:return Fe;case rt:return _e;case it:return ke}return e}function _t(e){if(ga(e))switch(e){case _e:return"startAngle";case rt:return"endAngle";case ke:return"outerRadius";case it:return"innerRadius"}return e}function He(e){switch(e){case G:return Ee;case J:return Ue;case Ce:return Ne;case Fe:return je;case _e:return rt;case ke:return it}return}function pe(e){switch(e){case G:case Ee:return"width";case J:case Ue:return"height"}return}function Od(e){switch(e){case G:return"xOffset";case J:return"yOffset";case Ee:return"x2Offset";case Ue:return"y2Offset";case _e:return"thetaOffset";case ke:return"radiusOffset";case rt:return"theta2Offset";case it:return"radius2Offset"}return}function va(e){switch(e){case G:return"xOffset";case J:return"yOffset"}return}function Oa(e){switch(e){case"xOffset":return"x";case"yOffset":return"y"}}const xd=v(Xr),Kr=Gn(Xr,["x","y","x2","y2","xOffset","yOffset","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),Sd=v(Kr),Qr={x:1,y:1},qe=v(Qr);function ee(e){return e in Qr}const Zr={theta:1,radius:1},_d=v(Zr);function Pi(e){return e==="width"?G:J}const xa={xOffset:1,yOffset:1};function pn(e){return e in xa}const Sa=Gn(Kr,["text","tooltip","href","url","description","detail","key","order"]),jd=v(Sa);function wd(e){return!!Kr[e]}function $d(e){switch(e){case de:case We:case Be:case st:case ge:case ot:case xt:case St:return!0;case vt:case Ot:case Mt:return!1}}const _a=Object.assign(Object.assign(Object.assign(Object.assign({},Qr),Zr),xa),Sa),Ti=v(_a);function at(e){return!!_a[e]}function Ed(e,t){return Cd(e)[t]}const ja={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},kd=Gn(ja,["geoshape"]);function Cd(e){switch(e){case de:case We:case Be:case Ni:case Yn:case ki:case Dt:case Ci:case Xn:case ot:case vt:case Ot:case xt:case Ei:case tt:case nt:return ja;case G:case J:case yt:case dn:case Ce:case Fe:return kd;case Ee:case Ue:case Ne:case je:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case st:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case St:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case ge:return{point:"always",geoshape:"always"};case Vn:return{text:"always"};case Mt:return{point:"always",square:"always",text:"always"};case Fi:return{image:"always"};case _e:return{text:"always",arc:"always"};case ke:return{text:"always",arc:"always"};case rt:case it:return{arc:"always"}}}function Jr(e){switch(e){case G:case J:case _e:case ke:case yt:case dn:case st:case Mt:case xt:case ot:case vt:case Ot:case Ee:case Ue:case rt:case it:return;case Ei:case tt:case nt:case ge:case St:case Vn:case Dt:case Ci:case Fi:case Ni:return"discrete";case de:case We:case Be:return"flexible";case Ce:case Fe:case Ne:case je:case Yn:case ki:case Xn:return}}const Fd={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Nd={count:1,min:1,max:1};function ct(e){return!!e&&!!e.argmin}function jt(e){return!!e&&!!e.argmax}function es(e){return P(e)&&!!Fd[e]}const Pd=new Set(["count","valid","missing","distinct"]);function wa(e){return P(e)&&Pd.has(e)}function Td(e){return P(e)&&z(["min","max"],e)}const Ad=new Set(["count","sum","distinct","valid","missing"]),zd=new Set(["mean","average","median","q1","q3","min","max"]);function $a(e){return Un(e)&&(e=Zi(e,void 0)),"bin"+v(e).map(t=>Ai(e[t])?q(`_${t}_${bt(e[t])}`):q(`_${t}_${e[t]}`)).join("")}function W(e){return e===!0||Wt(e)&&!e.binned}function re(e){return e==="binned"||Wt(e)&&e.binned===!0}function Wt(e){return D(e)}function Ai(e){return e==null?void 0:e.param}function Ea(e){switch(e){case tt:case nt:case st:case de:case We:case Be:case xt:case ot:case vt:case Ot:case ge:return 6;case St:return 4;default:return 10}}function Kn(e){return!!(e==null?void 0:e.expr)}function me(e){const t=v(e||{}),n={};for(const i of t)n[i]=ye(e[i]);return n}var Id=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ka(e){const{anchor:t,frame:n,offset:i,orient:r,angle:s,limit:o,color:a,subtitleColor:c,subtitleFont:l,subtitleFontSize:u,subtitleFontStyle:f,subtitleFontWeight:d,subtitleLineHeight:g,subtitlePadding:p}=e,m=Id(e,["anchor","frame","offset","orient","angle","limit","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),h=Object.assign(Object.assign({},m),a?{fill:a}:{}),b=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),s!==void 0?{angle:s}:{}),o!==void 0?{limit:o}:{}),y=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},c?{subtitleColor:c}:{}),l?{subtitleFont:l}:{}),u?{subtitleFontSize:u}:{}),f?{subtitleFontStyle:f}:{}),d?{subtitleFontWeight:d}:{}),g?{subtitleLineHeight:g}:{}),p?{subtitlePadding:p}:{}),x=un(e,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:h,subtitleMarkConfig:x,nonMarkTitleProperties:b,subtitle:y}}function wt(e){return P(e)||j(e)&&P(e[0])}function w(e){return!!(e==null?void 0:e.signal)}function $t(e){return!!e.step}function Rd(e){return j(e)?!1:"fields"in e&&!("data"in e)}function Ld(e){return j(e)?!1:"fields"in e&&"data"in e}function lt(e){return j(e)?!1:"field"in e&&"data"in e}const Md={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},Dd=v(Md),Ud={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},ts=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];var ns=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Ca(e){const t=j(e.condition)?e.condition.map(Fa):Fa(e.condition);return Object.assign(Object.assign({},ye(e)),{condition:t})}function ye(e){if(Kn(e)){const{expr:t}=e,n=ns(e,["expr"]);return Object.assign({signal:t},n)}return e}function Fa(e){if(Kn(e)){const{expr:t}=e,n=ns(e,["expr"]);return Object.assign({signal:t},n)}return e}function H(e){if(Kn(e)){const{expr:t}=e,n=ns(e,["expr"]);return Object.assign({signal:t},n)}return w(e)?e:e!==void 0?{value:e}:void 0}function Wd(e){return w(e)?e.signal:A(e)}function Na(e){return w(e)?e.signal:A(e.value)}function ut(e){return w(e)?e.signal:e==null?null:A(e)}function Bd(e,t,n){for(const i of n){const r=Bt(i,t.markDef,t.config);r!==void 0&&(e[i]=H(r))}return e}function Pa(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function R(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:s&&(!r||r===e)?void 0:Bt(e,t,n,i)}function Bt(e,t,n,{vgChannel:i}={}){return Q(i?zi(e,t,n.style):void 0,zi(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function zi(e,t,n){return Ta(e,Pa(t),n)}function Ta(e,t,n){t=V(t);let i;for(const r of t){const s=n[r];s&&s[e]!==void 0&&(i=s[e])}return i}function Aa(e,t){return V(e).reduce((n,i)=>{var r;return n.field.push(_(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function za(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Me(r,i))return;n.push(i)}),n}function Ia(e,t){return Me(e,t)||!t?e:e?[...V(e),...V(t)].join(", "):t}function Ra(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((wt(n)||w(n))&&(wt(i)||w(i)))return{explicit:e.explicit,value:Ia(n,i)};if(wt(n)||w(n))return{explicit:e.explicit,value:n};if(wt(i)||w(i))return{explicit:e.explicit,value:i};if(!wt(n)&&!w(n)&&!wt(i)&&!w(i))return{explicit:e.explicit,value:za(n,i)};throw new Error("It should never reach here")}function is(e){return`Invalid specification ${U(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Hd='Autosize "fit" only works for single views and layered views.';function La(e){const t=e=="width"?"Width":"Height";return`${t} "container" only works for single views and layered views.`}function Ma(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function Da(e){return e?`Dropping "fit-${e}" because spec has discrete ${pe(e)}.`:'Dropping "fit" because spec has discrete size.'}function rs(e){return`Unknown field for ${e}. Cannot calculate view size.`}function Ua(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function qd(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Gd(e){return`The "nearest" transform is not supported for ${e} marks.`}function Wa(e){return`Selection not supported for ${e} yet.`}function Vd(e){return`Cannot find a selection named "${e}".`}const Xd="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Yd="Legend bindings are only supported for selections over an individual field or encoding channel.";function Kd(e){return`Lookups can only be performed on selection parameters. "${e}" is a variable parameter.`}function Qd(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const Zd="The same selection must be used to override scale domains in a layered view.",Jd='Interval selections should be initialized using "x", "y", "longitude", or "latitude" keys.';function eg(e){return`Unknown repeated value "${e}".`}function Ba(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const tg="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function ng(e){return`Unrecognized parse "${e}".`}function Ha(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const ig="Attempt to add the same child twice.";function rg(e){return`Ignoring an invalid transform: ${U(e)}.`}const sg='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function qa(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function og(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${U(t)} is overridden by a child projection ${U(n)}.`}const ag="Arc marks uses theta channel rather than angle, replacing angle with theta.";function cg(e){return`${e}Offset dropped because ${e} is continuous`}function lg(e){return`There is no ${e} encoding. Replacing ${e}Offset encoding as ${e}.`}function ug(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${U(n)}}.`}function Ga(e){return`Invalid field type "${e}".`}function fg(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function dg(e){return`Invalid aggregation operator "${e}".`}function Va(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function gg(e){return`Position range does not support relative band size for ${e}.`}function ss(e,t){return`Dropping ${U(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const pg="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Ii(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function mg(e){return`${e} encoding has no scale, so specified scale is ignored.`}function hg(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function bg(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function yg(e){return`${e} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function vg(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function os(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function Og(e){return`The ${e} for range marks cannot be an expression`}function xg(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function Sg(e,t){return`Specified orient "${e}" overridden with "${t}".`}function _g(e){return`Cannot use the scale property "${e}" with non-color channel.`}function jg(e){return`Cannot use the relative band size with ${e} scale.`}function wg(e){return`Using unaggregated domain with raw field has no effect (${U(e)}).`}function $g(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function Eg(e){return`Unaggregated domain is currently unsupported for log scale (${U(e)}).`}function kg(e){return`Cannot apply size to non-oriented mark "${e}".`}function Cg(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Fg(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function Xa(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function Ya(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function Ng(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${U(n)} and ${U(i)}). Using ${U(n)}.`}function Pg(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${U(n)} and ${U(i)}). Using the union of the two domains.`}function Tg(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Ag(e){return`Dropping sort property ${U(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const Ka="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",zg="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Ig="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Rg="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function Lg(e){return`Cannot stack "${e}" if there is already "${e}2".`}function Mg(e){return`Cannot stack non-linear scale (${e}).`}function Dg(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Ri(e,t){return`Invalid ${e}: ${U(t)}.`}function Ug(e){return`Dropping day from datetime ${U(e)} as day cannot be combined with other units.`}function Wg(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function Bg(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Hg(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Qa(e){return`1D error band does not support ${e}.`}function Za(e){return`Channel ${e} is required for "binned" bin.`}function qg(e){return`Channel ${e} should not be used with "binned" bin.`}function Gg(e){return`Domain for ${e} is required for threshold scale.`}var nx=function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},ix=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)};const Ja=Pf(Tf);let mn=Ja;function Vg(e){return mn=e,mn}function Xg(){return mn=Ja,mn}function O(...e){mn.warn(...e)}function Yg(...e){mn.debug(...e)}function Ht(e){if(e&&D(e)){for(const t of cs)if(t in e)return!0}return!1}const ec=["january","february","march","april","may","june","july","august","september","october","november","december"],Kg=ec.map(e=>e.substr(0,3)),tc=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Qg=tc.map(e=>e.substr(0,3));function Zg(e){if($i(e)&&(e=+e),K(e))return e>4&&O(Ri("quarter",e)),e-1;throw new Error(Ri("quarter",e))}function Jg(e){if($i(e)&&(e=+e),K(e))return e-1;{const t=e.toLowerCase(),n=ec.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Kg.indexOf(i);if(r!==-1)return r;throw new Error(Ri("month",e))}}function ep(e){if($i(e)&&(e=+e),K(e))return e%7;{const t=e.toLowerCase(),n=tc.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Qg.indexOf(i);if(r!==-1)return r;throw new Error(Ri("day",e))}}function as(e,t){const n=[];if(t&&e.day!==void 0&&(v(e).length>1&&(O(Ug(e)),e=C(e),delete e.day)),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Jg(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Zg(e.quarter):e.quarter;n.push(K(i)?i*3:`${i}*3`)}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?ep(e.day):e.day;n.push(K(i)?i+1:`${i}+1`)}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function Qn(e){const t=as(e,!0),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function tp(e){const t=as(e,!1),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function np(e){const t=as(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}var ip=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const nc={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},cs=v(nc);function rp(e){return!!nc[e]}function ls(e){return e.startsWith("utc")}function sp(e){return e.substr(3)}const op={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function us(e){return cs.filter(t=>ic(e,t))}function ic(e,t){const n=e.indexOf(t);return n<0||(n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")?!1:!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function ap(e,t,{end:n}={end:!1}){const i=qr(t),r=ls(e)?"utc":"";function s(c){return c==="quarter"?`(${r}quarter(${i})-1)`:`${r}${c}(${i})`}let o;const a={};for(const c of cs)ic(e,c)&&(a[c]=s(c),o=c);return n&&(a[o]+="+1"),tp(a)}function rc(e){if(!e)return;const t=us(e);return`timeUnitSpecifier(${U(t)}, ${U(op)})`}function cp(e,t,n){if(!e)return;const i=rc(e),r=n||ls(e);return`${r?"utc":"time"}Format(${t}, ${i})`}function se(e){if(!e)return;let t;return P(e)?t={unit:e}:D(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),ls(t.unit)&&(t.utc=!0,t.unit=sp(t.unit)),t}function lp(e){const t=se(e),{utc:n}=t,i=ip(t,["utc"]);return i.unit?(n?"utc":"")+v(i).map(r=>q(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+v(i).map(r=>q(`_${r}_${i[r]}`)).join("")}function up(e){return e==null?void 0:e.param}function fs(e){return!!(e==null?void 0:e.field)&&e.equal!==void 0}function ds(e){return!!(e==null?void 0:e.field)&&e.lt!==void 0}function gs(e){return!!(e==null?void 0:e.field)&&e.lte!==void 0}function ps(e){return!!(e==null?void 0:e.field)&&e.gt!==void 0}function ms(e){return!!(e==null?void 0:e.field)&&e.gte!==void 0}function hs(e){if(e==null?void 0:e.field){if(j(e.range)&&e.range.length===2)return!0;if(w(e.range))return!0}return!1}function bs(e){return!!(e==null?void 0:e.field)&&(j(e.oneOf)||j(e.in))}function fp(e){return!!(e==null?void 0:e.field)&&e.valid!==void 0}function sc(e){return bs(e)||fs(e)||hs(e)||ds(e)||ps(e)||gs(e)||ms(e)}function Ge(e,t){return Ji(e,{timeUnit:t,wrapTime:!0})}function dp(e,t){return e.map(n=>Ge(n,t))}function oc(e,t=!0){var n;const{field:i}=e,r=(n=se(e.timeUnit))===null||n===void 0?void 0:n.unit,s=r?`time(${ap(r,i)})`:_(e,{expr:"datum"});if(fs(e))return`${s}===${Ge(e.equal,r)}`;if(ds(e)){const o=e.lt;return`${s}<${Ge(o,r)}`}else if(ps(e)){const o=e.gt;return`${s}>${Ge(o,r)}`}else if(gs(e)){const o=e.lte;return`${s}<=${Ge(o,r)}`}else if(ms(e)){const o=e.gte;return`${s}>=${Ge(o,r)}`}else{if(bs(e))return`indexof([${dp(e.oneOf,r).join(",")}], ${s}) !== -1`;if(fp(e))return ys(s,e.valid);if(hs(e)){const{range:o}=e,a=w(o)?{signal:`${o.signal}[0]`}:o[0],c=w(o)?{signal:`${o.signal}[1]`}:o[1];if(a!==null&&c!==null&&t)return"inrange("+s+", ["+Ge(a,r)+", "+Ge(c,r)+"])";const l=[];return a!==null&&l.push(`${s} >= ${Ge(a,r)}`),c!==null&&l.push(`${s} <= ${Ge(c,r)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${U(e)}`)}function ys(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function gp(e){var t;return sc(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=se(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Zn={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function pp(e){return e==="quantitative"||e==="temporal"}function ac(e){return e==="ordinal"||e==="nominal"}const qt=Zn.quantitative,vs=Zn.ordinal,hn=Zn.temporal,Os=Zn.nominal,bn=Zn.geojson;function mp(e){if(e){e=e.toLowerCase();switch(e){case"q":case qt:return"quantitative";case"t":case hn:return"temporal";case"o":case vs:return"ordinal";case"n":case Os:return"nominal";case bn:return"geojson"}}return}var hp=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const he={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},xs={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function bp(e,t){const n=xs[e],i=xs[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const yp={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function cc(e){return yp[e]}const lc=new Set(["linear","log","pow","sqrt","symlog"]),uc=new Set([...lc,"time","utc"]);function fc(e){return lc.has(e)}const dc=new Set(["quantile","quantize","threshold"]),vp=new Set([...uc,...dc,"sequential","identity"]),Op=new Set(["ordinal","bin-ordinal","point","band"]);function te(e){return Op.has(e)}function ve(e){return vp.has(e)}function Pe(e){return uc.has(e)}function yn(e){return dc.has(e)}const xp={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4,zero:!0};function Sp(e){return!P(e)&&!!e.name}function gc(e){return e==null?void 0:e.param}function _p(e){return e==null?void 0:e.unionWith}function jp(e){return Ir(e)&&"field"in e}const wp={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},$p=hp(wp,["type","domain","range","rangeMax","rangeMin","scheme"]),Ep=v($p);function Ss(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return Pe(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return Pe(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return Pe(e);case"nice":return Pe(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return ve(e)&&!z(["log","time","utc","threshold","quantile"],e)}}function pc(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return gn(e)?void 0:_g(t);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function kp(e,t){return z([vs,Os],t)?e===void 0||te(e):t===hn?z([he.TIME,he.UTC,void 0],e):t===qt?fc(e)||yn(e)||e===void 0:!0}function Cp(e,t,n=!1){if(!at(e))return!1;switch(e){case G:case J:case yt:case dn:case _e:case ke:return Pe(t)||t==="band"?!0:t==="point"?!n:!1;case st:case xt:case ot:case vt:case Ot:case Mt:return Pe(t)||yn(t)||z(["band","point","ordinal"],t);case de:case We:case Be:return t!=="band";case St:case ge:return t==="ordinal"||yn(t)}}const ce={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},mc=ce.arc,Li=ce.area,Mi=ce.bar,Fp=ce.image,Di=ce.line,Ui=ce.point,Np=ce.rect,Wi=ce.rule,hc=ce.text,_s=ce.tick,Pp=ce.trail,js=ce.circle,ws=ce.square,bc=ce.geoshape;function Et(e){return["line","area","trail"].includes(e)}function yc(e){return["rect","bar","image","arc"].includes(e)}const Tp=new Set(v(ce));function Ve(e){return e.type}const Ap=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],zp=["fill","fillOpacity"],Ip=[...Ap,...zp],Rp={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},vc=v(Rp),Lp={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},Mp={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},Dp={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},Oc=v(Dp);function Gt(e){return e&&e.band!=null}const Up={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},xc=5,Wp={binSpacing:1,continuousBandSize:xc,timeUnitBandPosition:.5},Bp={binSpacing:0,continuousBandSize:xc,timeUnitBandPosition:.5},Hp={thickness:1};function qp(e){return Ve(e)?e.type:e}function $s(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:s}=e,o=ks(e);return S(n)&&!wa(n.aggregate)&&r&&Pe(r.get("type"))?Gp({fieldDef:n,channel:t,markDef:i,ref:o,config:s}):o}function Gp({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){if(Et(n.type))return i;const s=R("invalid",n,r);return s===null?[Vp(e,t),i]:i}function Vp(e,t){const n=Es(e,!0),i=Ut(t),r=i==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function Es(e,t=!0){return ys(P(e)?e:_(e,{expr:"datum"}),!t)}function Xp(e){const{datum:t}=e;return Ht(t)?Qn(t):`${U(t)}`}function Vt(e,t,n,i){const r={};if(t&&(r.scale=t),Ye(e)){const{datum:s}=e;Ht(s)?r.signal=Qn(s):w(s)?r.signal=s.signal:Kn(s)?r.signal=s.expr:r.value=s}else r.field=_(e,n);if(i){const{offset:s,band:o}=i;s&&(r.offset=s),o&&(r.band=o)}return r}function Bi({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,bandPosition:s=.5}){const o=0<s&&s<1?"datum":void 0,a=_(t,{expr:o,suffix:r}),c=n!==void 0?_(n,{expr:o}):_(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const u=s===0?a:c;l.field=u}else{const u=w(s)?`${s.signal} * ${a} + (1-${s.signal}) * ${c}`:`${s} * ${a} + ${1-s} * ${c}`;l.signal=`scale("${e}", ${u})`}return i&&(l.offset=i),l}function ks({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l,bandPosition:u}){var f;if(t){if(F(t)){const d=o==null?void 0:o.get("type");if(le(t)){u??(u=Pc({fieldDef:t,fieldDef2:n,markDef:i,config:r}));const{bin:g,timeUnit:p,type:m}=t;if(W(g)||u&&p&&m===hn)return(a==null?void 0:a.impute)?Vt(t,s,{binSuffix:"mid"},{offset:c}):u&&!te(d)?Bi({scaleName:s,fieldOrDatumDef:t,bandPosition:u,offset:c}):Vt(t,s,ii(t,e)?{binSuffix:"range"}:{},{offset:c});if(re(g)){if(S(n))return Bi({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:u,offset:c});{const h=e===G?Ee:Ue;O(Za(h))}}}return Vt(t,s,te(d)?{binSuffix:"range"}:{},{offset:c,band:d==="band"?(f=u??t.bandPosition)!==null&&f!==void 0?f:.5:void 0})}else if(Ae(t)){const d=t.value,g=c?{offset:c}:{};return Object.assign(Object.assign({},Jn(e,d)),g)}}return Af(l)&&(l=l()),l&&Object.assign(Object.assign({},l),c?{offset:c}:{})}function Jn(e,t){return z(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:z(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:H(t)}function Xt(e){return e&&e!=="number"&&e!=="time"}function Sc(e,t,n){return`${e}(${t}${n?`, ${U(n)}`:""})`}const Yp=" \u2013 ";function Cs({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){var o,a;if(Xt(n))return Te({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const c=_c(e,i,r),l=vn(e);if(t===void 0&&n===void 0&&s.customFormatTypes){if(l==="quantitative"){if(r&&s.normalizedNumberFormatType)return Te({fieldOrDatumDef:e,format:s.normalizedNumberFormat,formatType:s.normalizedNumberFormatType,expr:i,config:s});if(s.numberFormatType)return Te({fieldOrDatumDef:e,format:s.numberFormat,formatType:s.numberFormatType,expr:i,config:s})}if(l==="temporal"&&s.timeFormatType&&S(e)&&e.timeUnit===void 0)return Te({fieldOrDatumDef:e,format:s.timeFormat,formatType:s.timeFormatType,expr:i,config:s})}if(_n(e)){const u=Qp({field:c,timeUnit:S(e)?(o=se(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,format:t,formatType:s.timeFormatType,rawTimeFormat:s.timeFormat,isUTCScale:Yt(e)&&((a=e.scale)===null||a===void 0?void 0:a.type)===he.UTC});return u?{signal:u}:void 0}if(t=Fs({type:l,specifiedFormat:t,config:s,normalizeStack:r}),S(e)&&W(e.bin)){const u=_(e,{expr:i,binSuffix:"end"});return{signal:ei(c,u,t,n,s)}}else return t||vn(e)==="quantitative"?{signal:`${$c(c,t)}`}:{signal:`isValid(${c}) ? ${c} : ""+${c}`}}function _c(e,t,n){return S(e)?n?`${_(e,{expr:t,suffix:"end"})}-${_(e,{expr:t,suffix:"start"})}`:_(e,{expr:t}):Xp(e)}function Te({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){if(o??(o=_c(e,i,r)),o!=="datum.value"&&S(e)&&W(e.bin)){const a=_(e,{expr:i,binSuffix:"end"});return{signal:ei(o,a,t,n,s)}}return{signal:Sc(n,o,t)}}function jc(e,t,n,i,r,s){var o;if(Xt(i))return;if(n===void 0&&i===void 0&&r.customFormatTypes&&vn(e)==="quantitative"){if(r.normalizedNumberFormatType&&On(e)&&e.stack==="normalize")return;if(r.numberFormatType)return}if(On(e)&&e.stack==="normalize"&&r.normalizedNumberFormat)return Fs({type:"quantitative",config:r,normalizeStack:!0});if(_n(e)){const a=S(e)?(o=se(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return a===void 0&&r.customFormatTypes&&r.timeFormatType?void 0:Kp({specifiedFormat:n,timeUnit:a,config:r,omitTimeFormatConfig:s})}return Fs({type:t,specifiedFormat:n,config:r})}function wc(e,t,n){var i;return e&&(w(e)||e==="number"||e==="time")?e:_n(t)&&n!=="time"&&n!=="utc"?S(t)&&((i=se(t==null?void 0:t.timeUnit))===null||i===void 0?void 0:i.utc)?"utc":"time":void 0}function Fs({type:e,specifiedFormat:t,config:n,normalizeStack:i}){return P(t)?t:e===qt?i?n.normalizedNumberFormat:n.numberFormat:void 0}function Kp({specifiedFormat:e,timeUnit:t,config:n,omitTimeFormatConfig:i}){return e||(t?{signal:rc(t)}:i?void 0:n.timeFormat)}function $c(e,t){return`format(${e}, "${t||""}")`}function Ec(e,t,n,i){var r;return Xt(n)?Sc(n,e,t):$c(e,(r=P(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function ei(e,t,n,i,r){if(n===void 0&&i===void 0&&r.customFormatTypes&&r.numberFormatType)return ei(e,t,r.numberFormat,r.numberFormatType,r);const s=Ec(e,n,i,r),o=Ec(t,n,i,r);return`${ys(e,!1)} ? "null" : ${s} + "${Yp}" + ${o}`}function Qp({field:e,timeUnit:t,format:n,formatType:i,rawTimeFormat:r,isUTCScale:s}){return!t||n?!t&&i?`${i}(${e}, '${n}')`:(n=P(n)?n:r,`${s?"utc":"time"}Format(${e}, '${n}')`):cp(t,e,s)}const Hi="min",Zp={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function kc(e){return e in Zp}function Cc(e){return!!(e==null?void 0:e.encoding)}function Xe(e){return e&&(e.op==="count"||!!e.field)}function Fc(e){return e&&j(e)}function ti(e){return"row"in e||"column"in e}function Ns(e){return!!e&&"header"in e}function qi(e){return"facet"in e}var Ps=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Jp(e){return e.param}function em(e){return e&&!P(e)&&"repeat"in e}function Nc(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function Ts(e){return"sort"in e}function Pc({fieldDef:e,fieldDef2:t,markDef:n,config:i}){if(F(e)&&e.bandPosition!==void 0)return e.bandPosition;if(S(e)){const{timeUnit:r,bin:s}=e;if(r&&!t)return yc(n.type)?0:Bt("timeUnitBandPosition",n,i);if(W(s))return .5}return}function Tc({channel:e,fieldDef:t,fieldDef2:n,markDef:i,config:r,scaleType:s,useVlSizeChannel:o}){var a,c,l;const u=pe(e),f=R(o?"size":u,i,r,{vgChannel:u});if(f!==void 0)return f;if(S(t)){const{timeUnit:d,bin:g}=t;if(d&&!n)return{band:Bt("timeUnitBandSize",i,r)};if(W(g)&&!te(s))return{band:1}}return yc(i.type)?s?te(s)?((a=r[i.type])===null||a===void 0?void 0:a.discreteBandSize)||{band:1}:(c=r[i.type])===null||c===void 0?void 0:c.continuousBandSize:(l=r[i.type])===null||l===void 0?void 0:l.discreteBandSize:void 0}function Ac(e,t,n,i){return W(e.bin)||e.timeUnit&&le(e)&&e.type==="temporal"?Pc({fieldDef:e,fieldDef2:t,markDef:n,config:i})!==void 0:!1}function Gi(e){return e&&"condition"in e}function Vi(e){const t=e==null?void 0:e.condition;return!!t&&!j(t)&&S(t)}function ni(e){const t=e==null?void 0:e.condition;return!!t&&!j(t)&&F(t)}function tm(e){const t=e==null?void 0:e.condition;return!!t&&(j(t)||Ae(t))}function S(e){return e&&(!!e.field||e.aggregate==="count")}function vn(e){return e==null?void 0:e.type}function Ye(e){return e&&"datum"in e}function kt(e){return le(e)&&!Yi(e)||Xi(e)}function zc(e){return le(e)&&e.type==="quantitative"&&!e.bin||Xi(e)}function Xi(e){return Ye(e)&&K(e.datum)}function F(e){return S(e)||Ye(e)}function le(e){return e&&("field"in e||e.aggregate==="count")&&"type"in e}function Ae(e){return e&&"value"in e&&"value"in e}function Yt(e){return e&&("scale"in e||"sort"in e)}function On(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function Ic(e){return e&&"legend"in e}function Rc(e){return e&&("format"in e||"formatType"in e)}function nm(e){return fe(e,["legend","axis","header","scale"])}function im(e){return"op"in e}function _(e,t={}){var n,i,r;let s=e.field;const o=t.prefix;let a=t.suffix,c="";if(sm(e))s=ua("count");else{let l;if(!t.nofn)if(im(e))l=e.op;else{const{bin:u,aggregate:f,timeUnit:d}=e;W(u)?(l=$a(u),a=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?jt(f)?(c=`["${s}"]`,s=`argmax_${f.argmax}`):ct(f)?(c=`["${s}"]`,s=`argmin_${f.argmin}`):l=String(f):d&&(l=lp(d),a=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}l&&(s=s?`${l}_${s}`:l)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),t.forAs?Gr(s):t.expr?aa(s,t.expr)+c:Se(s)+c}function Yi(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return S(e)&&!!e.bin;case"temporal":return!1}throw new Error(Ga(e.type))}function rm(e){var t;return Yt(e)&&yn((t=e.scale)===null||t===void 0?void 0:t.type)}function sm(e){return e.aggregate==="count"}function om(e,t){var n;const{field:i,bin:r,timeUnit:s,aggregate:o}=e;if(o==="count")return t.countTitle;if(W(r))return`${i} (binned)`;if(s){const a=(n=se(s))===null||n===void 0?void 0:n.unit;if(a)return`${i} (${us(a).join("-")})`}else if(o)return jt(o)?`${i} for max ${o.argmax}`:ct(o)?`${i} for min ${o.argmin}`:`${Hn(o)} of ${i}`;return i}function am(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(jt(t))return`${r} for argmax(${t.argmax})`;if(ct(t))return`${r} for argmin(${t.argmin})`;const s=se(i),o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||W(n)&&"bin";return o?`${o.toUpperCase()}(${r})`:r}const Lc=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return am(e);default:return om(e,t)}};let Mc=Lc;function Dc(e){Mc=e}function cm(){Dc(Lc)}function xn(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,s;const o=(r=As(e))===null||r===void 0?void 0:r.title;if(!S(e))return o??e.title;const a=e,c=i?zs(a,t):void 0;return n?Q(o,a.title,c):(s=o??a.title)!==null&&s!==void 0?s:c}function As(e){return On(e)&&e.axis?e.axis:Ic(e)&&e.legend?e.legend:Ns(e)&&e.header?e.header:void 0}function zs(e,t){return Mc(e,t)}function Ki(e){var t;if(Rc(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=As(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function lm(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(Ts(e)&&j(e.sort))return"ordinal";const{aggregate:i,bin:r,timeUnit:s}=e;if(s)return"temporal";if(r||i&&!jt(i)&&!ct(i))return"quantitative";if(Yt(e)&&((n=e.scale)===null||n===void 0?void 0:n.type))switch(xs[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Ke(e){return S(e)?e:Vi(e)?e.condition:void 0}function Z(e){return F(e)?e:ni(e)?e.condition:void 0}function Uc(e,t,n,i={}){if(P(e)||K(e)||Un(e)){const r=P(e)?"string":K(e)?"number":"boolean";return O(ug(t,r,e)),{value:e}}return F(e)?Qi(e,t,n,i):ni(e)?Object.assign(Object.assign({},e),{condition:Qi(e.condition,t,n,i)}):e}function Qi(e,t,n,i){if(Rc(e)){const{format:r,formatType:s}=e,o=Ps(e,["format","formatType"]);if(Xt(s)&&!n.customFormatTypes)return O(qa(t)),Qi(o,t,n,i)}else{const r=On(e)?"axis":Ic(e)?"legend":Ns(e)?"header":null;if(r&&e[r]){const s=e[r],{format:o,formatType:a}=s,c=Ps(s,["format","formatType"]);if(Xt(a)&&!n.customFormatTypes)return O(qa(t)),Qi(Object.assign(Object.assign({},e),{[r]:c}),t,n,i)}}return S(e)?Is(e,t,i):um(e)}function um(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=K(n)?"quantitative":P(n)?"nominal":Ht(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function Is(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:o}=e,a=Object.assign({},e);if(!n&&i&&!es(i)&&!jt(i)&&!ct(i)&&(O(dg(i)),delete a.aggregate),r&&(a.timeUnit=se(r)),o&&(a.field=`${o}`),W(s)&&(a.bin=Zi(s,t)),re(s)&&!ee(t)&&O(qg(t)),le(a)){const{type:c}=a,l=mp(c);c!==l&&(a.type=l),c!=="quantitative"&&(wa(i)&&(O(fg(c,i)),a.type="quantitative"))}else if(!ya(t)){const c=lm(a,t);a.type=c}if(le(a)){const{compatible:c,warning:l}=fm(a,t)||{};c===!1&&O(l)}if(Ts(a)&&P(a.sort)){const{sort:c}=a;if(kc(c))return Object.assign(Object.assign({},a),{sort:{encoding:c}});const l=c.substr(1);if(c.charAt(0)==="-"&&kc(l))return Object.assign(Object.assign({},a),{sort:{encoding:l,order:"descending"}})}if(Ns(a)){const{header:c}=a;if(c){const{orient:l}=c,u=Ps(c,["orient"]);if(l)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},u),{labelOrient:c.labelOrient||l,titleOrient:c.titleOrient||l})})}}return a}function Zi(e,t){return Un(e)?{maxbins:Ea(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:Ea(t)}):e}const Sn={compatible:!0};function fm(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case tt:case nt:case Ei:return Yi(e)?Sn:{compatible:!1,warning:bg(t)};case G:case J:case yt:case dn:case de:case We:case Be:case Vn:case Yn:case ki:case Dt:case Ci:case Fi:case Mt:case _e:case ke:case Ni:return Sn;case Fe:case je:case Ce:case Ne:return n!==qt?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:Sn;case ot:case vt:case Ot:case xt:case st:case rt:case it:case Ee:case Ue:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:Sn;case ge:case St:return!Yi(e)&&!rm(e)?{compatible:!1,warning:yg(t)}:Sn;case Xn:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:Sn}}function _n(e){const{formatType:t}=Ki(e);return t==="time"||!t&&dm(e)}function dm(e){return e&&(e.type==="temporal"||S(e)&&!!e.timeUnit)}function Ji(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var s;const o=t&&((s=se(t))===null||s===void 0?void 0:s.unit);let a=o||n==="temporal",c;return Kn(e)?c=e.expr:w(e)?c=e.signal:Ht(e)?(a=!0,c=Qn(e)):(P(e)||K(e))&&(a&&(c=`datetime(${U(e)})`,rp(o)&&((K(e)&&e<1e4||P(e)&&isNaN(Date.parse(e)))&&(c=Qn({[o]:e}))))),c?i&&a?`time(${c})`:c:r?void 0:U(e)}function Wc(e,t){const{type:n}=e;return t.map(i=>{const r=Ji(i,{timeUnit:S(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function ii(e,t){return W(e.bin)?at(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const Bc={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function ri(e){return e==null?void 0:e.condition}const Hc=["domain","grid","labels","ticks","title"],gm={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},qc={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},pm=Object.assign(Object.assign({},qc),{style:1,labelExpr:1,encoding:1});function Gc(e){return!!pm[e]}const mm={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},Vc=v(mm);function ft(e){return"mark"in e}class er{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return ft(t)?qp(t.mark)===this.name:!1}}var hm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Kt(e,t){const n=e&&e[t];return n?j(n)?Rt(n,i=>!!i.field):S(n)||Vi(n):!1}function Xc(e,t){const n=e&&e[t];return n?j(n)?Rt(n,i=>!!i.field):S(n)||Ye(n)||ni(n):!1}function Rs(e,t){if(ee(t)){const n=e[t];if((S(n)||Ye(n))&&ac(n.type)){const i=va(t);return Xc(e,i)}}return!1}function Ls(e){return Rt(md,t=>{if(Kt(e,t)){const n=e[t];if(j(n))return Rt(n,i=>!!i.aggregate);{const i=Ke(n);return i&&!!i.aggregate}}return!1})}function Yc(e,t){const n=[],i=[],r=[],s=[],o={};return Ms(e,(a,c)=>{if(S(a)){const{field:l,aggregate:u,bin:f,timeUnit:d}=a,g=hm(a,["field","aggregate","bin","timeUnit"]);if(u||d||f){const p=As(a),m=p==null?void 0:p.title;let h=_(a,{forAs:!0});const b=Object.assign(Object.assign(Object.assign({},m?[]:{title:xn(a,t,{allowDisabling:!0})}),g),{field:h});if(u){let y;if(jt(u)?(y="argmax",h=_({op:"argmax",field:u.argmax},{forAs:!0}),b.field=`${h}.${l}`):ct(u)?(y="argmin",h=_({op:"argmin",field:u.argmin},{forAs:!0}),b.field=`${h}.${l}`):u!=="boxplot"&&u!=="errorbar"&&u!=="errorband"&&(y=u),y){const x={op:y,as:h};l&&(x.field=l),s.push(x)}}else if(n.push(h),le(a)&&W(f)){if(i.push({bin:f,field:l,as:h}),n.push(_(a,{binSuffix:"end"})),ii(a,c)&&n.push(_(a,{binSuffix:"range"})),ee(c)){const y={field:`${h}_end`};o[`${c}2`]=y}b.bin="binned",ya(c)||(b.type=qt)}else if(d){r.push({timeUnit:d,field:l,as:h});const y=le(a)&&a.type!==hn&&"time";y&&(c===Vn||c===Dt?b.formatType=y:wd(c)?b.legend=Object.assign({formatType:y},b.legend):ee(c)&&(b.axis=Object.assign({formatType:y},b.axis)))}o[c]=b}else n.push(l),o[c]=e[c]}else o[c]=e[c]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function bm(e,t,n){const i=Ed(t,n);if(i){if(i==="binned"){const r=e[t===Ee?G:J];return!!(S(r)&&S(e[t])&&re(r.bin))}}else return!1;return!0}function ym(e,t,n,i){const r={};for(const s of v(e))ba(s)||O(hg(s));for(let s of xd){if(!e[s])continue;const o=e[s];if(pn(s)){const a=Oa(s),c=r[a];if(S(c)){if(pp(c.type)&&S(o)){O(cg(a));continue}}else s=a,O(lg(a))}if(s==="angle"&&t==="arc"&&!e.theta&&(O(ag),s=_e),!bm(e,s,t)){O(Ii(s,t));continue}if(s===st&&t==="line"){const a=Ke(e[s]);if(a==null?void 0:a.aggregate){O(pg);continue}}if(s===de&&(n?"fill"in e:"stroke"in e)){O(Va("encoding",{fill:"fill"in e,stroke:"stroke"in e}));continue}if(s===Yn||s===Xn&&!j(o)&&!Ae(o)||s===Dt&&j(o))o&&(r[s]=V(o).reduce((a,c)=>(S(c)?a.push(Is(c,s)):O(ss(c,s)),a),[]));else{if(s===Dt&&o===null)r[s]=null;else if(!S(o)&&!Ye(o)&&!Ae(o)&&!Gi(o)&&!w(o)){O(ss(o,s));continue}r[s]=Uc(o,s,i)}}return r}function tr(e,t){const n={};for(const i of v(e)){const r=Uc(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function vm(e){const t=[];for(const n of v(e))if(Kt(e,n)){const i=e[n],r=V(i);for(const s of r)S(s)?t.push(s):Vi(s)&&t.push(s.condition)}return t}function Ms(e,t,n){if(!e)return;for(const i of v(e)){const r=e[i];if(j(r))for(const s of r)t.call(n,s,i);else t.call(n,r,i)}}function Om(e,t,n,i){return e?v(e).reduce((r,s)=>{const o=e[s];return j(o)?o.reduce((a,c)=>t.call(i,a,c,s),r):t.call(i,r,o,s)},n):n}function Kc(e,t){return v(t).reduce((n,i)=>{switch(i){case G:case J:case Ci:case Ni:case Fi:case Ee:case Ue:case yt:case dn:case _e:case rt:case ke:case it:case Ce:case Fe:case Ne:case je:case Vn:case ge:case Mt:case Dt:return n;case Xn:if(e==="line"||e==="trail")return n;case Yn:case ki:{const r=t[i];if(j(r)||S(r))for(const s of V(r))s.aggregate||n.push(_(s,{}));return n}case st:if(e==="trail")return n;case de:case We:case Be:case ot:case vt:case Ot:case St:case xt:{const r=Ke(t[i]);return r&&!r.aggregate&&n.push(_(r,{})),n}}},[])}var Qc=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function xm(e){const{tooltip:t}=e,n=Qc(e,["tooltip"]);if(!t)return{filteredEncoding:n};let i,r;if(j(t)){for(const s of t)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return j(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function Ds(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:o,titlePrefix:a})=>{const c=i?` of ${Us(t)}`:"";return{field:o+t.field,type:t.type,title:w(a)?{signal:`${a}"${escape(c)}"`}:a+c}}),s=vm(n).map(nm);return{tooltip:[...r,...De(s,I)]}}function Us(e){const{title:t,field:n}=e;return Q(t,n)}function Ws(e,t,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:c,positionPrefix:l,endPositionPrefix:u=void 0,extraEncoding:f={}})=>{const d=Us(n);return Zc(e,a,r,{mark:c,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:`${l}_${n.field}`,type:n.type},d!==void 0?{title:d}:{}),s!==void 0?{scale:s}:{}),o!==void 0?{axis:o}:{})},P(u)?{[`${t}2`]:{field:`${u}_${n.field}`}}:{}),i),f)})}}function Zc(e,t,n,i){const{clip:r,color:s,opacity:o}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),r?{clip:r}:{}),s?{color:s}:{}),o?{opacity:o}:{}),Ve(i.mark)?i.mark:{type:i.mark}),{style:`${a}-${String(t)}`}),Un(e[t])?{}:e[t])})]:[]}function Jc(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",s=i[r],o=i[`${r}2`],a=i[`${r}Error`],c=i[`${r}Error2`];return{continuousAxisChannelDef:nr(s,n),continuousAxisChannelDef2:nr(o,n),continuousAxisChannelDefError:nr(a,n),continuousAxisChannelDefError2:nr(c,n),continuousAxis:r}}function nr(e,t){if(e==null?void 0:e.aggregate){const{aggregate:n}=e,i=Qc(e,["aggregate"]);return n!==t&&O(Hg(n,t)),i}else return e}function el(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(Ve(n)&&n.orient)return n.orient;if(kt(r)){if(kt(s)){const o=S(r)&&r.aggregate,a=S(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return _n(s)&&!_n(r)?"horizontal":"vertical"}return"horizontal"}else{if(kt(s))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}var ir=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const rr="boxplot",Sm=["box","median","outliers","rule","ticks"],_m=new er(rr,nl);function tl(e){return K(e)?"tukey":e}function nl(e,{config:t}){var n,i;e=Object.assign(Object.assign({},e),{encoding:tr(e.encoding,t)});const{mark:r,encoding:s,params:o,projection:a}=e,c=ir(e,["mark","encoding","params","projection"]),l=Ve(r)?r:{type:r};o&&O(Wa("boxplot"));const u=(n=l.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=R("size",l,t),d=l.invalid,g=tl(u),{bins:p,timeUnits:m,transform:h,continuousAxisChannelDef:b,continuousAxis:y,groupby:x,aggregate:k,encodingWithoutContinuousAxis:$,ticksOrient:N,boxOrient:E,customTooltipWithoutAggregatedField:T}=jm(e,u,t),{color:X,size:xe}=$,yi=ir($,["color","size"]),ht=Ff=>Ws(l,y,b,Ff,t.boxplot),In=ht(yi),Tr=ht($),Ar=ht(Object.assign(Object.assign({},yi),xe?{size:xe}:{})),Rn=Ds([{fieldPrefix:g==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:g==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],b,$),vi={type:"tick",color:"black",opacity:1,orient:N,invalid:d,aria:!1},sn=g==="min-max"?Rn:Ds([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],b,$),Ln=[...In({partName:"rule",mark:{type:"rule",invalid:d,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:sn}),...In({partName:"rule",mark:{type:"rule",invalid:d,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:sn}),...In({partName:"ticks",mark:vi,positionPrefix:"lower_whisker",extraEncoding:sn}),...In({partName:"ticks",mark:vi,positionPrefix:"upper_whisker",extraEncoding:sn})],Mn=[...g!=="tukey"?Ln:[],...Tr({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:E,invalid:d,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:Rn}),...Ar({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:d},D(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:N,aria:!1}),positionPrefix:"mid_box",extraEncoding:Rn})];if(g==="min-max")return Object.assign(Object.assign({},c),{transform:((i=c.transform)!==null&&i!==void 0?i:[]).concat(h),layer:Mn});const Dn=`datum["lower_box_${b.field}"]`,Oi=`datum["upper_box_${b.field}"]`,Vo=`(${Oi} - ${Dn})`,Xo=`${Dn} - ${u} * ${Vo}`,Yo=`${Oi} + ${u} * ${Vo}`,xi=`datum["${b.field}"]`,Ef={joinaggregate:il(b.field),groupby:x},Ko={transform:[{filter:`(${Xo} <= ${xi}) && (${xi} <= ${Yo})`},{aggregate:[{op:"min",field:b.field,as:`lower_whisker_${b.field}`},{op:"max",field:b.field,as:`upper_whisker_${b.field}`},{op:"min",field:`lower_box_${b.field}`,as:`lower_box_${b.field}`},{op:"max",field:`upper_box_${b.field}`,as:`upper_box_${b.field}`},...k],groupby:x}],layer:Ln},kf=ir(yi,["tooltip"]),{scale:Qo,axis:Cf}=b,Zo=Us(b),Jo=fe(Cf,["title"]),ea=Zc(l,"outliers",t.boxplot,{transform:[{filter:`(${xi} < ${Xo}) || (${xi} > ${Yo})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[y]:Object.assign(Object.assign(Object.assign({field:b.field,type:b.type},Zo!==void 0?{title:Zo}:{}),Qo!==void 0?{scale:Qo}:{}),L(Jo)?{}:{axis:Jo})},kf),X?{color:X}:{}),T?{tooltip:T}:{})})[0];let Si;const ta=[...p,...m,Ef];return ea?Si={transform:ta,layer:[ea,Ko]}:(Si=Ko,Si.transform.unshift(...ta)),Object.assign(Object.assign({},c),{layer:[Si,{transform:h,layer:Mn}]})}function il(e){return[{op:"q1",field:e,as:`lower_box_${e}`},{op:"q3",field:e,as:`upper_box_${e}`}]}function jm(e,t,n){const i=el(e,rr),{continuousAxisChannelDef:r,continuousAxis:s}=Jc(e,i,rr),o=r.field,a=tl(t),c=[...il(o),{op:"median",field:o,as:`mid_box_${o}`},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:`iqr_${o}`},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:`upper_whisker_${o}`},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:`lower_whisker_${o}`}],u=e.encoding,f=s,d=u[f],g=ir(u,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:m}=xm(g),{bins:h,timeUnits:b,aggregate:y,groupby:x,encoding:k}=Yc(m,n),$=i==="vertical"?"horizontal":"vertical",N=i,E=[...h,...b,{aggregate:[...y,...c],groupby:x},...l];return{bins:h,timeUnits:b,transform:E,groupby:x,aggregate:y,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:k,ticksOrient:$,boxOrient:N,customTooltipWithoutAggregatedField:p}}var rl=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Bs="errorbar",wm=["ticks","rule"],$m=new er(Bs,sl);function sl(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:tr(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:c,tooltipEncoding:l}=ol(e,Bs,t);delete s.size;const u=Ws(a,r,i,s,t.errorbar),f=a.thickness,d=a.size,g=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},f!==void 0?{thickness:f}:{}),d!==void 0?{size:d}:{}),p=[...u({partName:"ticks",mark:g,positionPrefix:"lower",extraEncoding:l}),...u({partName:"ticks",mark:g,positionPrefix:"upper",extraEncoding:l}),...u({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},f!==void 0?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},c),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function Em(e,t){const{encoding:n}=e;if(km(n))return{orient:el(e,t),inputType:"raw"};const i=Cm(n),r=Fm(n),s=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,c=n.y2;if(F(a)&&F(c))throw new Error(`${t} cannot have both x2 and y2`);if(F(a)){if(kt(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(F(c)){if(kt(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,c=n.xError2,l=n.yError,u=n.yError2;if(F(c)&&!F(a))throw new Error(`${t} cannot have xError2 without xError`);if(F(u)&&!F(l))throw new Error(`${t} cannot have yError2 without yError`);if(F(a)&&F(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(F(a)){if(kt(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(F(l)){if(kt(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function km(e){return(F(e.x)||F(e.y))&&!F(e.x2)&&!F(e.y2)&&!F(e.xError)&&!F(e.xError2)&&!F(e.yError)&&!F(e.yError2)}function Cm(e){return F(e.x2)||F(e.y2)}function Fm(e){return F(e.xError)||F(e.xError2)||F(e.yError)||F(e.yError2)}function ol(e,t,n){var i;const{mark:r,encoding:s,params:o,projection:a}=e,c=rl(e,["mark","encoding","params","projection"]),l=Ve(r)?r:{type:r};o&&O(Wa(t));const{orient:u,inputType:f}=Em(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:g,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:h}=Jc(e,u,t),{errorBarSpecificAggregate:b,postAggregateCalculates:y,tooltipSummary:x,tooltipTitleWithFieldName:k}=Nm(l,d,g,p,m,f,t,n),$=s,N=h,E=$[N],T=h==="x"?"x2":"y2",X=$[T],xe=h==="x"?"xError":"yError",yi=$[xe],ht=h==="x"?"xError2":"yError2",In=$[ht],Tr=rl($,[typeof N=="symbol"?N:N+"",typeof T=="symbol"?T:T+"",typeof xe=="symbol"?xe:xe+"",typeof ht=="symbol"?ht:ht+""]),{bins:Ar,timeUnits:Rn,aggregate:vi,groupby:sn,encoding:Ln}=Yc(Tr,n),Mn=[...vi,...b],Dn=f!=="raw"?[]:sn,Oi=Ds(x,d,Ln,k);return{transform:[...(i=c.transform)!==null&&i!==void 0?i:[],...Ar,...Rn,...Mn.length===0?[]:[{aggregate:Mn,groupby:Dn}],...y],groupby:Dn,continuousAxisChannelDef:d,continuousAxis:h,encodingWithoutContinuousAxis:Ln,ticksOrient:u==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:c,tooltipEncoding:Oi}}function Nm(e,t,n,i,r,s,o,a){let c=[],l=[];const u=t.field;let f,d=!1;if(s==="raw"){const g=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,p=e.extent?e.extent:g==="mean"?"stderr":"iqr";if(g==="median"!==(p==="iqr")&&O(Bg(g,p,o)),p==="stderr"||p==="stdev")c=[{op:p,field:u,as:`extent_${u}`},{op:g,field:u,as:`center_${u}`}],l=[{calculate:`datum["center_${u}"] + datum["extent_${u}"]`,as:`upper_${u}`},{calculate:`datum["center_${u}"] - datum["extent_${u}"]`,as:`lower_${u}`}],f=[{fieldPrefix:"center_",titlePrefix:Hn(g)},{fieldPrefix:"upper_",titlePrefix:al(g,p,"+")},{fieldPrefix:"lower_",titlePrefix:al(g,p,"-")}],d=!0;else{let m,h,b;p==="ci"?(m="mean",h="ci0",b="ci1"):(m="median",h="q1",b="q3"),c=[{op:h,field:u,as:`lower_${u}`},{op:b,field:u,as:`upper_${u}`},{op:m,field:u,as:`center_${u}`}],f=[{fieldPrefix:"upper_",titlePrefix:xn({field:u,aggregate:b,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:xn({field:u,aggregate:h,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:xn({field:u,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&O(Wg(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:`upper_${u}`},{calculate:`datum["${u}"]`,as:`lower_${u}`}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:u}],l=[{calculate:`datum["${u}"] + datum["${i.field}"]`,as:`upper_${u}`}],r?l.push({calculate:`datum["${u}"] + datum["${r.field}"]`,as:`lower_${u}`}):l.push({calculate:`datum["${u}"] - datum["${i.field}"]`,as:`lower_${u}`}));for(const g of l)f.push({fieldPrefix:g.as.substring(0,6),titlePrefix:Lt(Lt(g.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:c,tooltipSummary:f,tooltipTitleWithFieldName:d}}function al(e,t,n){return`${Hn(e)} ${n} ${t}`}const Hs="errorband",Pm=["band","borders"],Tm=new er(Hs,cl);function cl(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:tr(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:c}=ol(e,Hs,t),l=o,u=Ws(l,r,i,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},g={type:f?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),g=Object.assign(Object.assign(Object.assign({},g),p),{aria:!1})):l.interpolate?O(Qa("interpolate")):l.tension&&O(Qa("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...u({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c}),...u({partName:"borders",mark:g,positionPrefix:"lower",extraEncoding:c}),...u({partName:"borders",mark:g,positionPrefix:"upper",extraEncoding:c})]})}const ll={};function qs(e,t,n){const i=new er(e,t);ll[e]={normalizer:i,parts:n}}function Am(){return v(ll)}qs(rr,nl,Sm),qs(Bs,sl,wm),qs(Hs,cl,Pm);const zm=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],ul={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},fl={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Im=v(ul),Rm=v(fl),Lm={header:1,headerRow:1,headerColumn:1,headerFacet:1},dl=v(Lm),gl=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Mm={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},Dm={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},ze="_vgsid_",Um={point:{on:"click",fields:[ze],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Gs(e){return e==="legend"||!!(e==null?void 0:e.legend)}function Vs(e){return Gs(e)&&D(e)}function Xs(e){return!!(e==null?void 0:e.select)}var Wm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function pl(e){const t=[];for(const n of e||[]){if(Xs(n))continue;const{expr:i,bind:r}=n,s=Wm(n,["expr","bind"]);if(r&&i){const o=Object.assign(Object.assign({},s),{bind:r,init:i});t.push(o)}else{const o=Object.assign(Object.assign(Object.assign({},s),i?{update:i}:{}),r?{bind:r}:{});t.push(o)}}return t}function Bm(e){return sr(e)||Ks(e)||Ys(e)}function Ys(e){return"concat"in e}function sr(e){return"vconcat"in e}function Ks(e){return"hconcat"in e}function ml({step:e,offsetIsDiscrete:t}){var n;return t?(n=e.for)!==null&&n!==void 0?n:"offset":"position"}function Qe(e){return D(e)&&e.step!==void 0}function hl(e){return e.view||e.width||e.height}const bl=20,Hm={align:1,bounds:1,center:1,columns:1,spacing:1},qm=v(Hm);function Gm(e,t,n){var i,r;const s=n[t],o={},{spacing:a,columns:c}=s;a!==void 0&&(o.spacing=a),c!==void 0&&((qi(e)&&!ti(e.facet)||Ys(e))&&(o.columns=c)),sr(e)&&(o.columns=1);for(const l of qm)if(e[l]!==void 0)if(l==="spacing"){const u=e[l];o[l]=K(u)?u:{row:(i=u.row)!==null&&i!==void 0?i:a,column:(r=u.column)!==null&&r!==void 0?r:a}}else o[l]=e[l];return o}var Vm=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Qs(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function or(e,t){const n=ar(e,t);return Qe(n)?n.step:yl}function ar(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return Q(i,{step:e.step})}const yl=20,Xm={continuousWidth:200,continuousHeight:200,step:yl},Ym={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:Xm,mark:Mp,arc:{},area:{},bar:Wp,circle:{},geoshape:{},image:{},line:{},point:{},rect:Bp,rule:{color:"black"},square:{},text:{color:"black"},tick:Hp,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:xp,projection:{},legend:Mm,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Um,style:{},title:{},facet:{spacing:bl},concat:{spacing:bl},normalizedNumberFormat:".0%"},dt=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],vl={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},Ol={blue:dt[0],orange:dt[1],red:dt[2],teal:dt[3],green:dt[4],yellow:dt[5],purple:dt[6],pink:dt[7],brown:dt[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Km(e={}){return{signals:[{name:"color",value:D(e)?Object.assign(Object.assign({},Ol),e):Ol}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Qm(e){return{signals:[{name:"fontSize",value:D(e)?Object.assign(Object.assign({},vl),e):vl}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Zm(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function xl(e){const t=v(e||{}),n={};for(const i of t){const r=e[i];n[i]=ri(r)?Ca(r):ye(r)}return n}function Jm(e){const t=v(e),n={};for(const i of t)n[i]=xl(e[i]);return n}const eh=[...Oc,...Vc,...dl,"background","padding","legend","lineBreak","scale","style","title","view"];function Sl(e={}){const{color:t,font:n,fontSize:i,selection:r}=e,s=Vm(e,["color","font","fontSize","selection"]),o=na({},C(Ym),n?Zm(n):{},t?Km(t):{},i?Qm(i):{},s||{});r&&Lf(o,"selection",r,!0);const a=fe(o,eh);for(const c of["background","lineBreak","padding"])o[c]&&(a[c]=ye(o[c]));for(const c of Oc)o[c]&&(a[c]=me(o[c]));for(const c of Vc)o[c]&&(a[c]=xl(o[c]));for(const c of dl)o[c]&&(a[c]=me(o[c]));return o.legend&&(a.legend=me(o.legend)),o.scale&&(a.scale=me(o.scale)),o.style&&(a.style=Jm(o.style)),o.title&&(a.title=me(o.title)),o.view&&(a.view=me(o.view)),a}const th=new Set(["view",...Tp]),nh=["color","fontSize","background","padding","facet","concat","numberFormat","numberFormatType","normalizedNumberFormat","normalizedNumberFormatType","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],ih=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},Lp);function rh(e){e=C(e);for(const t of nh)delete e[t];if(e.axis)for(const t in e.axis)ri(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of zm)delete e.legend[t];if(e.mark){for(const t of vc)delete e.mark[t];e.mark.tooltip&&D(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(pl(e.params)),delete e.params);for(const t of th){for(const i of vc)delete e[t][i];const n=ih[t];if(n)for(const i of n)delete e[t][i];oh(e,t)}for(const t of Am())delete e[t];sh(e);for(const t in e)D(e[t])&&L(e[t])&&delete e[t];return L(e)?void 0:e}function sh(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=ka(e.title);L(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),L(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),L(i)?delete e.title:e.title=i}function oh(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},r),e.style[n??t]);L(s)||(e.style[n??t]=s),i||delete e[t]}function cr(e){return"layer"in e}function ah(e){return"repeat"in e}function ch(e){return!j(e.repeat)&&e.repeat.layer}var lh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Zs{map(t,n){return qi(t)?this.mapFacet(t,n):ah(t)?this.mapRepeat(t,n):Ks(t)?this.mapHConcat(t,n):sr(t)?this.mapVConcat(t,n):Ys(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(cr(t))return this.mapLayer(t,n);if(ft(t))return this.mapUnit(t,n);throw new Error(is(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(i=>this.map(i,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(i=>this.map(i,n))})}mapConcat(t,n){const{concat:i}=t,r=lh(t,["concat"]);return Object.assign(Object.assign({},r),{concat:i.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const uh={zero:1,center:1,normalize:1};function fh(e){return e in uh}const dh=new Set([mc,Mi,Li,Wi,Ui,js,ws,Di,hc,_s]),gh=new Set([Mi,Li,mc]);function jn(e){return S(e)&&vn(e)==="quantitative"&&!e.bin}function _l(e,t,{orient:n,type:i}){var r,s;const o=t==="x"?"y":"radius",a=t==="x",c=e[t],l=e[o];if(S(c)&&S(l))if(jn(c)&&jn(l)){if(c.stack)return t;if(l.stack)return o;const u=S(c)&&!!c.aggregate,f=S(l)&&!!l.aggregate;if(u!==f)return u?t:o;{const d=(r=c.scale)===null||r===void 0?void 0:r.type,g=(s=l.scale)===null||s===void 0?void 0:s.type;if(d&&d!=="linear")return o;if(g&&g!=="linear")return t}if(a&&i==="bar"){if(n==="vertical")return o;if(n==="horizontal")return t}}else{if(jn(c))return t;if(jn(l))return o}else{if(jn(c))return t;if(jn(l))return o}return}function ph(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function jl(e,t){var n,i;const r=Ve(e)?e:{type:e},s=r.type;if(!dh.has(s))return null;const o=_l(t,"x",r)||_l(t,"theta",r);if(!o)return null;const a=t[o],c=S(a)?_(a,{}):void 0,l=ph(o),u=[],f=new Set;if(t[l]){const p=t[l],m=S(p)?_(p,{}):void 0;m&&m!==c&&(u.push(l),f.add(m));const h=l==="x"?"xOffset":"yOffset",b=t[h],y=S(b)?_(b,{}):void 0;y&&y!==c&&(u.push(h),f.add(y))}const d=Sd.reduce((p,m)=>{if(m!=="tooltip"&&Kt(t,m)){const h=t[m];for(const b of V(h)){const y=Ke(b);if(y.aggregate)continue;const x=_(y,{});(!x||!f.has(x))&&p.push({channel:m,fieldDef:y})}}return p},[]);let g;return a.stack!==void 0?Un(a.stack)?g=a.stack?"zero":null:g=a.stack:gh.has(s)&&(g="zero"),!g||!fh(g)||Ls(t)&&d.length===0?null:((n=a==null?void 0:a.scale)===null||n===void 0?void 0:n.type)&&((i=a==null?void 0:a.scale)===null||i===void 0?void 0:i.type)!==he.LINEAR?(O(Mg(a.scale.type)),null):F(t[He(o)])?(a.stack!==void 0&&O(Lg(o)),null):(S(a)&&a.aggregate&&!Ad.has(a.aggregate)&&O(Dg(a.aggregate)),{groupbyChannels:u,groupbyFields:f,fieldChannel:o,impute:a.impute===null?!1:Et(s),stackBy:d,offset:g})}var wl=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function mh(e){const t=wl(e,["point","line"]);return v(t).length>1?t:t.type}function hh(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:fe(e[t],["point","line"])}));return e}function Js(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?D(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?D(t.point)?t.point:{}:void 0}function $l(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class bh{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(ft(t)){const{mark:i,encoding:r}=t,s=Ve(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!Js(s,n[s.type],r);case"area":return!!Js(s,n[s.type],r)||!!$l(s,n[s.type])}}return!1}run(t,n,i){const{config:r}=n,{params:s,projection:o,mark:a,name:c,encoding:l}=t,u=wl(t,["params","projection","mark","name","encoding"]),f=tr(l,r),d=Ve(a)?a:{type:a},g=Js(d,r[d.type],f),p=d.type==="area"&&$l(d,r[d.type]),m=[Object.assign(Object.assign({name:c},s?{params:s}:{}),{mark:mh(Object.assign(Object.assign({},d.type==="area"&&d.opacity===void 0&&d.fillOpacity===void 0?{opacity:.7}:{}),d)),encoding:fe(f,["shape"])})],h=jl(d,f);let b=f;if(h){const{fieldChannel:y,offset:x}=h;b=Object.assign(Object.assign({},f),{[y]:Object.assign(Object.assign({},f[y]),x?{stack:x}:{})})}return b=fe(b,["y2","x2"]),p&&m.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},un(d,["clip","interpolate","tension","tooltip"])),p),encoding:b})),g&&m.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},un(d,["clip","tooltip"])),g),encoding:b})),i(Object.assign(Object.assign({},u),{layer:m}),Object.assign(Object.assign({},n),{config:hh(r)}))}}var yh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function vh(e,t){return t?ti(e)?Fl(e,t):El(e,t):e}function eo(e,t){return t?Fl(e,t):e}function to(e,t,n){const i=t[e];if(em(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});O(eg(i.repeat));return}return t}function El(e,t){if(e=to("field",e,t),e===void 0)return;if(e===null)return null;if(Ts(e)&&Xe(e.sort)){const n=to("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}function kl(e,t){if(S(e))return El(e,t);{const n=to("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function Cl(e,t){if(F(e)){const n=kl(e,t);if(n)return n;if(Gi(e))return{condition:e.condition}}else{if(ni(e)){const n=kl(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const i=yh(e,["condition"]);return i}}return e}return}function Fl(e,t){const n={};for(const i in e)if(on(e,i)){const r=e[i];if(j(r))n[i]=r.map(s=>Cl(s,t)).filter(s=>s);else{const s=Cl(r,t);s!==void 0&&(n[i]=s)}}return n}class Oh{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(ft(t)){const{encoding:n,mark:i}=t;if(i==="line"||Ve(i)&&i.type==="line")for(const r of vd){const s=Ut(r),o=n[s];if(n[r]&&(S(o)&&!re(o.bin)||Ye(o)))return!0}}return!1}run(t,n,i){const{encoding:r,mark:s}=t;return O(xg(!!r.x2,!!r.y2)),i(Object.assign(Object.assign({},t),{mark:D(s)?Object.assign(Object.assign({},s),{type:"rule"}):"rule"}),n)}}var Ct=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class xh extends Zs{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[_m,$m,Tm,new bh,new Oh]}map(t,n){if(ft(t)){const i=Kt(t.encoding,tt),r=Kt(t.encoding,nt),s=Kt(t.encoding,Ei);if(i||r||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,s=eo(t.encoding,n.repeater),o=Object.assign(Object.assign(Object.assign({},t),t.name?{name:[n.repeaterPrefix,t.name].filter(c=>c).join("_")}:{}),s?{encoding:s}:{});if(i||r)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const c of this.nonFacetUnitNormalizers)if(c.hasMatchingType(o,n.config))return c.run(o,n,a);return o}mapRepeat(t,n){return ch(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r}=t,s=Ct(t,["repeat","spec"]),{row:o,column:a,layer:c}=i,{repeater:l={},repeaterPrefix:u=""}=n;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:c},spec:r}}),n):Object.assign(Object.assign({},s),{layer:c.map(f=>{const d=Object.assign(Object.assign({},l),{layer:f}),g=`${(r.name?`${r.name}_`:"")+u}child__layer_${q(f)}`,p=this.mapLayerOrUnit(r,Object.assign(Object.assign({},n),{repeater:d,repeaterPrefix:g}));return p.name=g,p})})}mapNonLayerRepeat(t,n){var i;const{repeat:r,spec:s,data:o}=t,a=Ct(t,["repeat","spec","data"]);!j(r)&&t.columns&&(t=fe(t,["columns"]),O(Ba("repeat")));const c=[],{repeater:l={},repeaterPrefix:u=""}=n,f=!j(r)&&r.row||[l?l.row:null],d=!j(r)&&r.column||[l?l.column:null],g=j(r)&&r||[l?l.repeat:null];for(const m of g)for(const h of f)for(const b of d){const y={repeat:m,row:h,column:b,layer:l.layer},x=(s.name?`${s.name}_`:"")+u+"child__"+(j(r)?`${q(m)}`:(r.row?`row_${q(h)}`:"")+(r.column?`column_${q(b)}`:"")),k=this.map(s,Object.assign(Object.assign({},n),{repeater:y,repeaterPrefix:x}));k.name=x,c.push(fe(k,["data"]))}const p=j(r)?t.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(i=s.data)!==null&&i!==void 0?i:o,align:"all"},a),{columns:p,concat:c})}mapFacet(t,n){const{facet:i}=t;return ti(i)&&t.columns&&(t=fe(t,["columns"]),O(Ba("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:s,parentProjection:o,config:a}=n,c=Pl({parentProjection:o,projection:r}),l=Nl({parentEncoding:s,encoding:eo(i,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),c?{projection:c}:{}),l?{encoding:l}:{}),{config:a})}mapFacetedUnit(t,n){const i=t.encoding,{row:r,column:s,facet:o}=i,a=Ct(i,["row","column","facet"]),{mark:c,width:l,projection:u,height:f,view:d,params:g,encoding:p}=t,m=Ct(t,["mark","width","projection","height","view","params","encoding"]),{facetMapping:h,layout:b}=this.getFacetMappingAndLayout({row:r,column:s,facet:o},n),y=eo(a,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},m),b),{facet:h,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),f?{height:f}:{}),d?{view:d}:{}),u?{projection:u}:{}),{mark:c,encoding:y}),g?{params:g}:{})}),n)}getFacetMappingAndLayout(t,n){var i;const{row:r,column:s,facet:o}=t;if(r||s){o&&O(vg([...r?[tt]:[],...s?[nt]:[]]));const a={},c={};for(const l of[tt,nt]){const u=t[l];if(u){const f=Ct(u,["align","center","spacing","columns"]);a[l]=f;for(const d of["align","center","spacing"])u[d]!==void 0&&((i=c[d])!==null&&i!==void 0||(c[d]={}),c[d][l]=u[d])}}return{facetMapping:a,layout:c}}else{const{align:a,center:c,spacing:l,columns:u}=o,f=Ct(o,["align","center","spacing","columns"]);return{facetMapping:vh(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),c?{center:c}:{}),l?{spacing:l}:{}),u?{columns:u}:{})}}}mapLayer(t,n){var{parentEncoding:i,parentProjection:r}=n,s=Ct(n,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,c=Ct(t,["encoding","projection"]),l=Object.assign(Object.assign({},s),{parentEncoding:Nl({parentEncoding:i,encoding:o,layer:!0}),parentProjection:Pl({parentProjection:r,projection:a})});return super.mapLayer(Object.assign(Object.assign({},c),t.name?{name:[l.repeaterPrefix,t.name].filter(u=>u).join("_")}:{}),l)}}function Nl({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...v(e),...v(t)]);for(const s of r){const o=t[s],a=e[s];if(F(o)){const c=Object.assign(Object.assign({},a),o);i[s]=c}else ni(o)?i[s]=Object.assign(Object.assign({},o),{condition:Object.assign(Object.assign({},a),o.condition)}):o||o===null?i[s]=o:(n||Ae(a)||w(a)||F(a)||j(a))&&(i[s]=a)}}else i=t;return!i||L(i)?void 0:i}function Pl(e){const{parentProjection:t,projection:n}=e;return t&&n&&O(og({parentProjection:t,projection:n})),n??t}function no(e){return"filter"in e}function Sh(e){return(e==null?void 0:e.stop)!==void 0}function Tl(e){return"lookup"in e}function _h(e){return"data"in e}function jh(e){return"param"in e}function wh(e){return"pivot"in e}function $h(e){return"density"in e}function Eh(e){return"quantile"in e}function kh(e){return"regression"in e}function Ch(e){return"loess"in e}function Fh(e){return"sample"in e}function Nh(e){return"window"in e}function Ph(e){return"joinaggregate"in e}function Th(e){return"flatten"in e}function Ah(e){return"calculate"in e}function Al(e){return"bin"in e}function zh(e){return"impute"in e}function Ih(e){return"timeUnit"in e}function Rh(e){return"aggregate"in e}function Lh(e){return"stack"in e}function Mh(e){return"fold"in e}function Dh(e){return e.map(t=>no(t)?{filter:ln(t.filter,gp)}:t)}var Ft=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Uh extends Zs{map(t,n){var i,r;return(i=n.emptySelections)!==null&&i!==void 0||(n.emptySelections={}),(r=n.selectionPredicates)!==null&&r!==void 0||(n.selectionPredicates={}),t=zl(t,n),super.map(t,n)}mapLayerOrUnit(t,n){if(t=zl(t,n),t.encoding){const i={};for(const[r,s]of bt(t.encoding))i[r]=Il(s,n);t=Object.assign(Object.assign({},t),{encoding:i})}return super.mapLayerOrUnit(t,n)}mapUnit(t,n){const i=t,{selection:r}=i,s=Ft(i,["selection"]);return r?Object.assign(Object.assign({},s),{params:bt(r).map(([o,a])=>{var c;const l=a,{init:u,bind:f,empty:d}=l,g=Ft(l,["init","bind","empty"]);g.type==="single"?(g.type="point",g.toggle=!1):g.type==="multi"&&(g.type="point"),n.emptySelections[o]=d!=="none";for(const p of ie((c=n.selectionPredicates[o])!==null&&c!==void 0?c:{}))p.empty=d!=="none";return{name:o,value:u,select:g,bind:f}})}):t}}function zl(e,t){const{transform:n}=e,i=Ft(e,["transform"]);if(n){const r=n.map(s=>{if(no(s))return{filter:io(s,t)};if(Al(s)&&Wt(s.bin))return Object.assign(Object.assign({},s),{bin:Rl(s.bin)});if(Tl(s)){const o=s.from,{selection:a}=o,c=Ft(o,["selection"]);return a?Object.assign(Object.assign({},s),{from:Object.assign({param:a},c)}):s}return s});return Object.assign(Object.assign({},i),{transform:r})}return e}function Il(e,t){var n,i;const r=C(e);if(S(r)&&Wt(r.bin)&&(r.bin=Rl(r.bin)),Yt(r)&&((i=(n=r.scale)===null||n===void 0?void 0:n.domain)===null||i===void 0?void 0:i.selection)){const s=r.scale.domain,{selection:o}=s,a=Ft(s,["selection"]);r.scale.domain=Object.assign(Object.assign({},a),o?{param:o}:{})}if(Gi(r))if(ia(r.condition))r.condition=r.condition.map(s=>{const{selection:o,param:a,test:c}=s,l=Ft(s,["selection","param","test"]);return a?s:Object.assign(Object.assign({},l),{test:io(s,t)})});else{const s=Il(r.condition,t),{selection:o,param:a,test:c}=s,l=Ft(s,["selection","param","test"]);r.condition=a?r.condition:Object.assign(Object.assign({},l),{test:io(r.condition,t)})}return r}function Rl(e){const t=e.extent;if(t==null?void 0:t.selection){const{selection:n}=t,i=Ft(t,["selection"]);return Object.assign(Object.assign({},e),{extent:Object.assign(Object.assign({},i),{param:n})})}return e}function io(e,t){const n=i=>ln(i,r=>{var s,o,a;const c=(s=t.emptySelections[r])!==null&&s!==void 0?s:!0,l={param:r,empty:c};return(o=(a=t.selectionPredicates)[r])!==null&&o!==void 0||(a[r]=[]),t.selectionPredicates[r].push(l),l});return e.selection?n(e.selection):ln(e.test||e.filter,i=>i.selection?n(i.selection):i)}class ro extends Zs{map(t,n){var i;const r=(i=n.selections)!==null&&i!==void 0?i:[];if(t.params&&!ft(t)){const s=[];for(const o of t.params)Xs(o)?r.push(o):s.push(o);t.params=s}return n.selections=r,super.map(t,n)}mapUnit(t,n){var i;const r=n.selections;if(!r||!r.length)return t;const s=((i=n.path)!==null&&i!==void 0?i:[]).concat(t.name),o=[];for(const a of r)if(!a.views||!a.views.length)o.push(a);else for(const c of a.views)(_i(c)&&(c===t.name||s.includes(c))||ia(c)&&c.map(l=>s.indexOf(l)).every((l,u,f)=>l!==-1&&(u===0||l>f[u-1])))&&o.push(a);return o.length&&(t.params=o),t}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=ro.prototype[e];ro.prototype[e]=function(n,i){return t.call(this,n,Wh(n,i))}}function Wh(e,t){var n;return e.name?Object.assign(Object.assign({},t),{path:((n=t.path)!==null&&n!==void 0?n:[]).concat(e.name)}):t}function Ll(e,t){t===void 0&&(t=Sl(e.config));const n=Gh(e,t),{width:i,height:r}=e,s=Vh(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const Bh=new xh,Hh=new Uh,qh=new ro;function Gh(e,t={}){const n={config:t};return qh.map(Bh.map(Hh.map(e,n),n),n)}function Ml(e){return P(e)?{type:e}:e??{}}function Vh(e,t,n){let{width:i,height:r}=t;const s=ft(e)||cr(e),o={};s?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(O(La("width")),i=void 0),r=="container"&&(O(La("height")),r=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?Ml(n.autosize):{}),Ml(e.autosize));return a.type==="fit"&&!s&&(O(Hd),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&O(Ma("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&O(Ma("height")),Me(a,{type:"pad"})?void 0:a}function Xh(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function Yh(e){return e?`fit-${Pi(e)}`:"fit"}const Kh=["background","padding"];function Dl(e,t){const n={};for(const i of Kh)e&&e[i]!==void 0&&(n[i]=ye(e[i]));return t&&(n.params=e.params),n}class gt{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new gt(C(this.explicit),C(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return Q(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,{value:n,explicit:i}){n!==void 0&&this.set(t,n,i)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,{explicit:n,implicit:i}){n[t]!==void 0?this.set(t,n[t],!0):i[t]!==void 0&&this.set(t,i[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of v(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function Ze(e){return{explicit:!0,value:e}}function Oe(e){return{explicit:!1,value:e}}function Ul(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:lr(t,n,i,r)}}function lr(e,t,n,i){return e.explicit&&t.explicit&&O(Ng(n,i,e.value,t.value)),e}function Nt(e,t,n,i,r=lr){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Me(e.value,t.value)?e:r(e,t,n,i)}class Qh extends gt{constructor(t={},n={},i=!1){super(t,n);this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function wn(e){return"url"in e}function si(e){return"values"in e}function Wl(e){return"name"in e&&!wn(e)&&!si(e)&&!Pt(e)}function Pt(e){return e&&(Bl(e)||Hl(e)||so(e))}function Bl(e){return"sequence"in e}function Hl(e){return"sphere"in e}function so(e){return"graticule"in e}var B;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(B||(B={}));var Zh=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ql(e){const t=Zh(e,["signals","hasLegend","index"]);return t.field=Se(t.field),t}function Qt(e,t=!0,n=zf){if(j(e)){const i=e.map(r=>Qt(r,t,n));return t?`[${i.join(", ")}]`:i}else if(Ht(e))return n(t?Qn(e):np(e));return t?n(U(e)):e}function Jh(e,t){var n;for(const i of ie((n=e.component.selection)!==null&&n!==void 0?n:{})){const r=i.name;let s=`${r}${At}, ${i.resolve==="global"?"true":`{unit: ${Jt(e)}}`}`;for(const o of pr){if(!o.defined(i))continue;o.signals&&(t=o.signals(e,i,t)),o.modifyExpr&&(s=o.modifyExpr(e,i,s))}t.push({name:r+Pb,on:[{events:{signal:i.name+At},update:`modify(${A(i.name+Zt)}, ${s})`}]})}return oo(t)}function eb(e,t){if(e.component.selection&&v(e.component.selection).length){const n=A(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:cn("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return oo(t)}function tb(e,t){var n;let i=!1;for(const r of ie((n=e.component.selection)!==null&&n!==void 0?n:{})){const s=r.name,o=A(s+Zt),a=t.filter(c=>c.name===s);if(a.length===0){const c=r.resolve==="global"?"union":r.resolve,l=r.type==="point"?", true, true)":")";t.push({name:r.name,update:`${mu}(${o}, ${A(c)}${l}`})}i=!0;for(const c of pr)c.defined(r)&&c.topLevelSignals&&(t=c.topLevelSignals(e,r,t))}if(i){const r=t.filter(s=>s.name==="unit");r.length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return oo(t)}function nb(e,t){var n;const i=[...t],r=Jt(e,{escape:!1});for(const s of ie((n=e.component.selection)!==null&&n!==void 0?n:{})){const o={name:s.name+Zt};if(s.project.hasSelectionId&&(o.transform=[{type:"collect",sort:{field:ze}}]),s.init){const c=s.project.items.map(ql);o.values=s.project.hasSelectionId?s.init.map(l=>({unit:r,[ze]:Qt(l,!1)[0]})):s.init.map(l=>({unit:r,fields:c,values:Qt(l,!1)}))}const a=i.filter(c=>c.name===s.name+Zt);a.length||i.push(o)}return i}function Gl(e,t){var n;for(const i of ie((n=e.component.selection)!==null&&n!==void 0?n:{}))for(const r of pr)r.defined(i)&&r.marks&&(t=r.marks(e,i,t));return t}function ib(e,t){for(const n of e.children)Y(n)&&(t=Gl(n,t));return t}function rb(e,t,n,i){const r=Ou(e,t.param,t);return{signal:ve(n.get("type"))&&j(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function oo(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}class M{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.includes(t)){O(ig);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this);const i=t.parent.removeChild(t);this._parent=n,n.addChild(this,i),t.parent=this}}class ue extends M{clone(){const t=new this.constructor;return t.debugName=`clone_${this.debugName}`,t._source=this._source,t._name=`clone_${this._name}`,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}constructor(t,n,i,r){super(t,n);this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${la()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}var Vl=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Je extends M{clone(){return new Je(null,C(this.formula))}constructor(t,n){super(t);this.formula=n}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s)=>{const{field:o,timeUnit:a}=s;if(a){const c=_(s,{forAs:!0});r[I({as:c,field:o,timeUnit:a})]={as:c,field:o,timeUnit:a}}return r},{});return L(i)?null:new Je(t,i)}static makeFromTransform(t,n){const i=Object.assign({},n),{timeUnit:r}=i,s=Vl(i,["timeUnit"]),o=se(r),a=Object.assign(Object.assign({},s),{timeUnit:o});return new Je(t,{[I(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)this.formula[n]||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of bt(this.formula))t.has(r.as)||(n[i]=r);this.formula=n}producedFields(){return new Set(ie(this.formula).map(t=>t.as))}dependentFields(){return new Set(ie(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${I(this.formula)}`}assemble(){const t=[];for(const n of ie(this.formula)){const{field:i,as:r,timeUnit:s}=n,o=se(s),{unit:a,utc:c}=o,l=Vl(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:Se(i),type:"timeunit"},a?{units:us(a)}:{}),c?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return t}}const oi="_tuple_fields";class sb{constructor(...t){this.items=t,this.hasChannel={},this.hasField={},this.hasSelectionId=!1}}const ob={defined:()=>!0,parse:(e,t,n)=>{var i;const r=t.name,s=(i=t.project)!==null&&i!==void 0?i:t.project=new sb,o={},a={},c=new Set,l=(m,h)=>{const b=h==="visual"?m.channel:m.field;let y=q(`${r}_${b}`);for(let x=1;c.has(y);x++)y=q(`${r}_${b}_${x}`);return c.add(y),{[h]:y}},u=t.type,f=e.config.selection[u],d=n.value!==void 0?V(n.value):null;let{fields:g,encodings:p}=D(n.select)?n.select:{};if(!g&&!p&&d)for(const m of d){if(!D(m))continue;for(const h of v(m))yd(h)?(p||(p=[])).push(h):u==="interval"?(O(Jd),p=f.encodings):(g??(g=[])).push(h)}!g&&!p&&(p=f.encodings,"fields"in f&&(g=f.fields));for(const m of p??[]){const h=e.fieldDef(m);if(h){let b=h.field;if(h.aggregate){O(qd(m,h.aggregate));continue}else if(!b){O(Ua(m));continue}if(h.timeUnit){b=e.vgField(m);const y={timeUnit:h.timeUnit,as:b,field:h.field};a[I(y)]=y}if(!o[b]){const y=u==="interval"&&at(m)&&ve(e.getScaleComponent(m).get("type"))?"R":h.bin?"R-RE":"E",x={field:b,channel:m,type:y,index:s.items.length};x.signals=Object.assign(Object.assign({},l(x,"data")),l(x,"visual")),s.items.push(o[b]=x),s.hasField[b]=o[b],s.hasSelectionId=s.hasSelectionId||b===ze,ma(m)?(x.geoChannel=m,x.channel=pa(m),s.hasChannel[x.channel]=o[b]):s.hasChannel[m]=o[b]}}else O(Ua(m))}for(const m of g??[]){if(s.hasField[m])continue;const h={type:"E",field:m,index:s.items.length};h.signals=Object.assign({},l(h,"data")),s.items.push(h),s.hasField[m]=h,s.hasSelectionId=s.hasSelectionId||m===ze}d&&(t.init=d.map(m=>s.items.map(h=>D(m)?m[h.geoChannel||h.channel]!==void 0?m[h.geoChannel||h.channel]:m[h.field]:m))),L(a)||(s.timeUnit=new Je(null,a))},signals:(e,t,n)=>{const i=t.name+oi,r=n.filter(s=>s.name===i);return r.length>0||t.project.hasSelectionId?n:n.concat({name:i,value:t.project.items.map(ql)})}},pt={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!at(r))continue;const s=e.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!ve(o)){O(Xd);continue}s.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||co(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let s=r.update;if(s.indexOf(mu)>=0)r.update=`{${i.map(o=>`${A(Se(o.field))}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const a=`${A(Se(o.field))}: ${o.signals.data}`;s.includes(a)||(s=`${s.substring(0,s.length-1)}, ${a}}`)}r.update=s}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!co(e))for(const i of t.scales){const r=n.filter(s=>s.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function ao(e,t){const n=A(e.scaleName(t));return`domain(${n})`}function co(e){var t;return e.parent&&An(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:co(e.parent.parent))}var ab=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const $n="_brush",Xl="_scale_trigger",ai="geo_interval_init_tick",Yl="_init",cb="_center",lb={defined:e=>e.type==="interval",parse:(e,t,n)=>{var i,r;if(e.hasProjection){const s=Object.assign({},Ir(n.select)?n.select:{});s.fields=[ze],s.encodings||(s.encodings=n.value?v(n.value):[Fe,Ce]),n.select=Object.assign({type:"interval"},s)}if(t.translate&&!pt.defined(t)){const s=`!event.item || event.item.mark.name !== ${A(t.name+$n)}`;for(const o of t.events){if(!o.between){O(`${o} is not an ordered event stream for interval selections.`);continue}const a=V((i=(r=o.between[0]).filter)!==null&&i!==void 0?i:r.filter=[]);a.indexOf(s)<0&&a.push(s)}}},signals:(e,t,n)=>{const i=t.name,r=i+At,s=ie(t.project.hasChannel).filter(a=>a.channel===G||a.channel===J),o=t.init?t.init[0]:null;if(n.push(...s.reduce((a,c)=>a.concat(ub(e,t,c,o&&o[c.index])),[])),e.hasProjection){const a=A(e.projectionName()),c=e.projectionName()+cb,{x:l,y:u}=t.project.hasChannel,f=l&&l.signals.visual,d=u&&u.signals.visual,g=l?o&&o[l.index]:`${c}[0]`,p=u?o&&o[u.index]:`${c}[1]`,m=$=>e.getSizeSignalRef($).signal,h=`[[${f?f+"[0]":"0"}, ${d?d+"[0]":"0"}],[${f?f+"[1]":m("width")}, ${d?d+"[1]":m("height")}]]`;if(o&&(n.unshift({name:i+Yl,init:`[scale(${a}, [${l?g[0]:g}, ${u?p[0]:p}]), scale(${a}, [${l?g[1]:g}, ${u?p[1]:p}])]`}),!l||!u)){const $=n.find(N=>N.name===c);$||n.unshift({name:c,update:`invert(${a}, [${m("width")}/2, ${m("height")}/2])`})}const b=`intersect(${h}, {markname: ${A(e.getName("marks"))}}, unit.mark)`,y=`{unit: ${Jt(e)}}`,x=`vlSelectionTuples(${b}, ${y})`,k=s.map($=>$.signals.visual);return n.concat({name:r,on:[{events:[...k.length?[{signal:k.join(" || ")}]:[],...o?[{signal:ai}]:[]],update:x}]})}else{if(!pt.defined(t)){const l=i+Xl,u=s.map(f=>{const d=f.channel,{data:g,visual:p}=f.signals,m=A(e.scaleName(d)),h=e.getScaleComponent(d).get("type"),b=ve(h)?"+":"";return`(!isArray(${g}) || (${b}invert(${m}, ${p})[0] === ${b}${g}[0] && ${b}invert(${m}, ${p})[1] === ${b}${g}[1]))`});u.length&&n.push({name:l,value:{},on:[{events:s.map(f=>({scale:e.scaleName(f.channel)})),update:u.join(" && ")+` ? ${l} : {}`}]})}const a=s.map(l=>l.signals.data),c=`unit: ${Jt(e)}, fields: ${i+oi}, values`;return n.concat(Object.assign(Object.assign({name:r},o?{init:`{${c}: ${Qt(o)}}`}:{}),a.length?{on:[{events:[{signal:a.join(" || ")}],update:`${a.join(" && ")} ? {${c}: [${a}]} : null`}]}:{}))}},topLevelSignals:(e,t,n)=>{if(Y(e)&&e.hasProjection&&t.init){const i=n.filter(r=>r.name===ai);i.length||n.unshift({name:ai,value:null,on:[{events:"timer{1}",update:`${ai} === null ? {} : ${ai}`}]})}return n},marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,o=r==null?void 0:r.signals.visual,a=s==null?void 0:s.signals.visual,c=`data(${A(t.name+Zt)})`;if(pt.defined(t)||!r&&!s)return n;const l={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const h of v(l))l[h]=[Object.assign({test:`${c}.length && ${c}[0].unit === ${Jt(e)}`},l[h]),{value:0}];const u=t.mark,{fill:f,fillOpacity:d,cursor:g}=u,p=ab(u,["fill","fillOpacity","cursor"]),m=v(p).reduce((h,b)=>(h[b]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(y=>y).join(" && "),value:p[b]},{value:null}],h),{});return[{name:`${i+$n}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:l}},...n,{name:i+$n,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},g?{cursor:{value:g}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),m)}}]}};function ub(e,t,n,i){const r=!e.hasProjection,s=n.channel,o=n.signals.visual,a=A(r?e.scaleName(s):e.projectionName()),c=d=>`scale(${a}, ${d})`,l=e.getSizeSignalRef(s===G?"width":"height").signal,u=`${s}(unit)`,f=t.events.reduce((d,g)=>[...d,{events:g.between[0],update:`[${u}, ${u}]`},{events:g,update:`[${o}[0], clamp(${u}, 0, ${l})]`}],[]);if(r){const d=n.signals.data,g=pt.defined(t),p=e.getScaleComponent(s),m=p?p.get("type"):void 0,h=i?{init:Qt(i,!0,c)}:{value:[]};return f.push({events:{signal:t.name+Xl},update:ve(m)?`[${c(`${d}[0]`)}, ${c(`${d}[1]`)}]`:"[0, 0]"}),g?[{name:d,on:[]}]:[Object.assign(Object.assign({name:o},h),{on:f}),Object.assign(Object.assign({name:d},i?{init:Qt(i)}:{}),{on:[{events:{signal:o},update:`${o}[0] === ${o}[1] ? null : invert(${a}, ${o})`}]})]}else{const d=s===G?0:1,g=t.name+Yl,p=i?{init:`[${g}[0][${d}], ${g}[1][${d}]]`}:{value:[]};return[Object.assign(Object.assign({name:o},p),{on:f})]}}const fb={defined:e=>e.type==="point",signals:(e,t,n)=>{var i;const r=t.name,s=r+oi,o=t.project,a="(item().isVoronoi ? datum.datum : datum)",c=ie((i=e.component.selection)!==null&&i!==void 0?i:{}).reduce((d,g)=>g.type==="interval"?d.concat(g.name+$n):d,[]).map(d=>`indexof(item().mark.name, '${d}') < 0`).join(" && "),l=`datum && item().mark.marktype !== 'group' && indexof(item().mark.role, 'legend') < 0${c?` && ${c}`:""}`;let u=`unit: ${Jt(e)}, `;if(t.project.hasSelectionId)u+=`${ze}: ${a}[${A(ze)}]`;else{const d=o.items.map(g=>{const p=e.fieldDef(g.channel);return(p==null?void 0:p.bin)?`[${a}[${A(e.vgField(g.channel,{}))}], ${a}[${A(e.vgField(g.channel,{binSuffix:"end"}))}]]`:`${a}[${A(g.field)}]`}).join(", ");u+=`fields: ${s}, values: [${d}]`}const f=t.events;return n.concat([{name:r+At,on:f?[{events:f,update:`${l} ? {${u}} : null`,force:!0}]:[]}])}};function En(e,t,n,i){const r=Gi(t)&&t.condition,s=i(t);if(r){const o=V(r),a=o.map(c=>{const l=i(c);if(Jp(c)){const{param:u,empty:f}=c,d=vu(e,{param:u,empty:f});return Object.assign({test:d},l)}else{const u=mr(e,c.test);return Object.assign({test:u},l)}});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function lo(e,t="text"){const n=e.encoding[t];return En(e,n,t,i=>ur(i,e.config))}function ur(e,t,n="datum"){if(e){if(Ae(e))return H(e.value);if(F(e)){const{format:i,formatType:r}=Ki(e);return Cs({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}return}function Kl(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,o=n.tooltip;if(j(o))return{tooltip:Zl({tooltip:o},s,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return En(e,o,"tooltip",c=>{const l=ur(c,r,a);if(l)return l;if(c===null)return;let u=R("tooltip",i,r);return u===!0&&(u={content:"encoding"}),P(u)?{value:u}:D(u)?w(u)?u:u.content==="encoding"?Zl(n,s,r,t):{signal:a}:void 0})}}function Ql(e,t,n,{reactiveGeom:i}={}){const r={},s=i?"datum.datum":"datum",o=[];function a(l,u){const f=Ut(u),d=le(l)?l:Object.assign(Object.assign({},l),{type:e[f].type}),g=d.title||zs(d,n),p=V(g).join(", ");let m;if(ee(u)){const h=u==="x"?"x2":"y2",b=Ke(e[h]);if(re(d.bin)&&b){const y=_(d,{expr:s}),x=_(b,{expr:s}),{format:k,formatType:$}=Ki(d);m=ei(y,x,k,$,n),r[h]=!0}}if((ee(u)||u===_e||u===ke)&&t&&t.fieldChannel===u&&t.offset==="normalize"){const{format:h,formatType:b}=Ki(d);m=Cs({fieldOrDatumDef:d,format:h,formatType:b,expr:s,config:n,normalizeStack:!0}).signal}m??(m=ur(d,n,s).signal),o.push({channel:u,key:p,value:m})}Ms(e,(l,u)=>{S(l)?a(l,u):Vi(l)&&a(l.condition,u)});const c={};for(const{channel:l,key:u,value:f}of o)!r[l]&&!c[u]&&(c[u]=f);return c}function Zl(e,t,n,{reactiveGeom:i}={}){const r=Ql(e,t,n,{reactiveGeom:i}),s=bt(r).map(([o,a])=>`"${o}": ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function db(e){const{markDef:t,config:n}=e,i=R("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),gb(e)),pb(e))}function gb(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=R("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in Ud?{}:{ariaRoleDescription:{value:t}}}function pb(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return En(e,s,"description",c=>ur(c,e.config));const o=R("description",n,i);if(o!=null)return{description:H(o)};if(i.aria===!1)return{};const a=Ql(t,r,i);return L(a)?void 0:{description:{signal:bt(a).map(([c,l],u)=>`"${u>0?"; ":""}${c}: " + (${l})`).join(" + ")}}}function ne(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:c}=n;a===void 0&&(c??(c=R(e,i,s,{vgChannel:o,ignoreVgConfig:!0})),c!==void 0&&(a=H(c)));const l=r[e];return En(t,l,o??e,u=>ks({channel:e,channelDef:u,markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function Jl(e,t={filled:void 0}){var n,i,r,s;const{markDef:o,encoding:a,config:c}=e,{type:l}=o,u=(n=t.filled)!==null&&n!==void 0?n:R("filled",o,c),f=z(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,d=(r=(i=R(u===!0?"color":void 0,o,c,{vgChannel:"fill"}))!==null&&i!==void 0?i:c.mark[u===!0&&"color"])!==null&&r!==void 0?r:f,g=(s=R(u===!1?"color":void 0,o,c,{vgChannel:"stroke"}))!==null&&s!==void 0?s:c.mark[u===!1&&"color"],p=u?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:H(d)}:{}),g?{stroke:H(g)}:{});return o.color&&(u?o.fill:o.stroke)&&O(Va("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),ne("color",e,{vgChannel:p,defaultValue:u?d:g})),ne("fill",e,{defaultValue:a.fill?d:void 0})),ne("stroke",e,{defaultValue:a.stroke?g:void 0}))}function mb(e){const{encoding:t,mark:n}=e,i=t.order;return!Et(n)&&Ae(i)?En(e,i,"zindex",r=>H(r.value)):{}}function ci({channel:e,markDef:t,encoding:n={},model:i,bandPosition:r}){const s=`${e}Offset`,o=t[s],a=n[s];if((s==="xOffset"||s==="yOffset")&&a){const l=ks({channel:s,channelDef:a,markDef:t,config:i==null?void 0:i.config,scaleName:i.scaleName(s),scale:i.getScaleComponent(s),stack:null,defaultRef:H(o),bandPosition:r});return{offsetType:"encoding",offset:l}}const c=t[s];return c?{offsetType:"visual",offset:c}:{}}function oe(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:s,config:o,stack:a}=t,c=r[e],l=r[He(e)],u=t.scaleName(e),f=t.getScaleComponent(e),{offset:d,offsetType:g}=ci({channel:e,markDef:s,encoding:r,model:t,bandPosition:.5}),p=uo({model:t,defaultPos:n,channel:e,scaleName:u,scale:f}),m=!c&&ee(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:hb({channel:e,channelDef:c,channel2Def:l,markDef:s,config:o,scaleName:u,scale:f,stack:a,offset:d,defaultRef:p,bandPosition:g==="encoding"?0:void 0});return m?{[i||e]:m}:void 0}function hb(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:s,markDef:o}=e;if(F(n)&&r&&t===r.fieldChannel){if(S(n)){let a=n.bandPosition;if(a===void 0&&o.type==="text"&&(t==="radius"||t==="theta")&&(a=.5),a!==void 0)return Bi({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:a,offset:s})}return Vt(n,i,{suffix:"end"},{offset:s})}return $s(e)}function uo({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=e;return()=>{const a=Ut(n),c=_t(n),l=R(n,s,o,{vgChannel:c});if(l!==void 0)return Jn(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const u=r.get("type");if(!z([he.LOG,he.TIME,he.UTC],u)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const u=e[pe(n)];return Object.assign(Object.assign({},u),{mult:.5})}}return}}const bb={left:"x",center:"xc",right:"x2"},yb={top:"y",middle:"yc",bottom:"y2"};function eu(e,t,n,i="middle"){if(e==="radius"||e==="theta")return _t(e);const r=e==="x"?"align":"baseline",s=R(r,t,n);let o;return w(s)?(O(Og(r)),o=void 0):o=s,e==="x"?bb[o||(i==="top"?"left":"center")]:yb[o||i]}function fr(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?tu(e,t,{defaultPos:n,defaultPos2:i}):oe(e,t,{defaultPos:n})}function tu(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,o=He(e),a=pe(e),c=vb(t,i,o),l=c[a]?eu(e,r,s):_t(e);return Object.assign(Object.assign({},oe(e,t,{defaultPos:n,vgChannel:l})),c)}function vb(e,t,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=e,c=Ut(n),l=pe(n),u=_t(n),f=i[c],d=e.scaleName(c),g=e.getScaleComponent(c),{offset:p}=n in i||n in s?ci({channel:n,markDef:s,encoding:i,model:e}):ci({channel:c,markDef:s,encoding:i,model:e});if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const h=pe(n),b=e.markDef[h];return b!=null?{[h]:{value:b}}:{[u]:{field:e.getName(n)}}}const m=Ob({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:a,scaleName:d,scale:g,stack:o,offset:p,defaultRef:void 0});return m!==void 0?{[u]:m}:dr(n,s)||dr(n,{[n]:zi(n,s,a.style),[l]:zi(l,s,a.style)})||dr(n,a[r])||dr(n,a.mark)||{[u]:uo({model:e,defaultPos:t,channel:n,scaleName:d,scale:g})()}}function Ob({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l}){return F(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?Vt(t,s,{suffix:"start"},{offset:c}):$s({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:c,defaultRef:l})}function dr(e,t){const n=pe(e),i=_t(e);if(t[i]!==void 0)return{[i]:Jn(e,t[i])};if(t[e]!==void 0)return{[i]:Jn(e,t[e])};if(t[n]){const r=t[n];if(Gt(r))O(gg(n));else return{[n]:Jn(e,r)}}return}function Tt(e,t){var n,i;const{config:r,encoding:s,markDef:o}=e,a=o.type,c=He(t),l=pe(t),u=s[t],f=s[c],d=e.getScaleComponent(t),g=d?d.get("type"):void 0,p=o.orient,m=(i=(n=s[l])!==null&&n!==void 0?n:s.size)!==null&&i!==void 0?i:R("size",o,r,{vgChannel:l}),h=a==="bar"&&(t==="x"?p==="vertical":p==="horizontal");return S(u)&&(W(u.bin)||re(u.bin)||u.timeUnit&&!f)&&!(m&&!Gt(m))&&!te(g)?_b({fieldDef:u,fieldDef2:f,channel:t,model:e}):(F(u)&&te(g)||h)&&!f?Sb(u,t,e):tu(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function xb(e,t,n,i,r){if(Gt(r))if(n){const o=n.get("type");if(o==="band"){let a=`bandwidth('${t}')`;return r.band!==1&&(a=`${r.band} * ${a}`),{signal:`max(0.25, ${a})`}}else r.band!==1&&(O(jg(o)),r=void 0)}else return{mult:r.band,field:{group:e}};else{if(w(r))return r;if(r)return{value:r}}if(n){const o=n.get("range");if($t(o)&&K(o.step))return{value:o.step-2}}const s=or(i.view,e);return{value:s-2}}function Sb(e,t,n){const{markDef:i,encoding:r,config:s,stack:o}=n,a=i.orient,c=n.scaleName(t),l=n.getScaleComponent(t),u=pe(t),f=He(t),d=Od(t),g=n.scaleName(d),p=a==="horizontal"&&t==="y"||a==="vertical"&&t==="x";let m;(r.size||i.size)&&(p?m=ne("size",n,{vgChannel:u,defaultRef:H(i.size)}):O(kg(i.type)));const h=!!m,b=Tc({channel:t,fieldDef:e,markDef:i,config:s,scaleType:l==null?void 0:l.get("type"),useVlSizeChannel:p});m=m||{[u]:xb(u,g||c,l,s,b)};const y=(l==null?void 0:l.get("type"))==="band"&&Gt(b)&&!h?"top":"middle",x=eu(t,i,s,y),k=x==="xc"||x==="yc",{offset:$,offsetType:N}=ci({channel:t,markDef:i,encoding:r,model:n,bandPosition:k?.5:0}),E=$s({channel:t,channelDef:e,markDef:i,config:s,scaleName:c,scale:l,stack:o,offset:$,defaultRef:uo({model:n,defaultPos:"mid",channel:t,scaleName:c,scale:l}),bandPosition:k?N==="encoding"?0:.5:w(b)?{signal:`(1-${b})/2`}:Gt(b)?(1-b.band)/2:0});if(u)return Object.assign({[x]:E},m);{const T=_t(f),X=m[u],xe=$?Object.assign(Object.assign({},X),{offset:$}):X;return{[x]:E,[T]:j(E)?[E[0],Object.assign(Object.assign({},E[1]),{offset:xe})]:Object.assign(Object.assign({},E),{offset:xe})}}}function li(e,t,n,i,r){if(ga(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(w(n)||w(r)||w(i)){const o=ut(n),a=ut(r),c=ut(i),l=c?`${c} + `:"",u=o?`(${o} ? -1 : 1) * `:"",f=a?`(${a} + ${s})`:s;return{signal:l+u+f}}else return r=r||0,i+(n?-r-s:+r+s)}function _b({fieldDef:e,fieldDef2:t,channel:n,model:i}){var r,s,o;const{config:a,markDef:c,encoding:l}=i,u=i.getScaleComponent(n),f=i.scaleName(n),d=u?u.get("type"):void 0,g=u.get("reverse"),p=Tc({channel:n,fieldDef:e,markDef:c,config:a,scaleType:d}),m=(r=i.component.axes[n])===null||r===void 0?void 0:r[0],h=(s=m==null?void 0:m.get("translate"))!==null&&s!==void 0?s:.5,b=ee(n)&&((o=R("binSpacing",c,a))!==null&&o!==void 0)?o:0,y=He(n),x=_t(n),k=_t(y),{offset:$}=ci({channel:n,markDef:c,encoding:l,model:i,bandPosition:0}),N=w(p)?{signal:`(1-${p.signal})/2`}:Gt(p)?(1-p.band)/2:.5;if(W(e.bin)||e.timeUnit)return{[k]:nu({fieldDef:e,scaleName:f,bandPosition:N,offset:li(y,b,g,h,$)}),[x]:nu({fieldDef:e,scaleName:f,bandPosition:w(N)?{signal:`1-${N.signal}`}:1-N,offset:li(n,b,g,h,$)})};if(re(e.bin)){const E=Vt(e,f,{},{offset:li(y,b,g,h,$)});if(S(t))return{[k]:E,[x]:Vt(t,f,{},{offset:li(n,b,g,h,$)})};if(Wt(e.bin)&&e.bin.step)return{[k]:E,[x]:{signal:`scale("${f}", ${_(e,{expr:"datum"})} + ${e.bin.step})`,offset:li(n,b,g,h,$)}}}O(Za(y));return}function nu({fieldDef:e,scaleName:t,bandPosition:n,offset:i}){return Bi({scaleName:t,fieldOrDatumDef:e,bandPosition:n,offset:i})}const jb=new Set(["aria","width","height"]);function $e(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?Jl(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},wb(e.markDef,t)),iu(e,"fill",n)),iu(e,"stroke",i)),ne("opacity",e)),ne("fillOpacity",e)),ne("strokeOpacity",e)),ne("strokeWidth",e)),ne("strokeDash",e)),mb(e)),Kl(e)),lo(e,"href")),db(e))}function iu(e,t,n){const{config:i,mark:r,markDef:s}=e,o=R("invalid",s,i);if(o==="hide"&&n&&!Et(r)){const a=$b(e,{invalid:!0,channels:Ti});if(a)return{[t]:[{test:a,value:null},...V(n)]}}return n?{[t]:n}:{}}function wb(e,t){return Dd.reduce((n,i)=>(!jb.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=H(e[i])),n),{})}function $b(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const c=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&ve(c)&&(s[l]=!0)}return s},{}),r=v(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>Es(o,t)).join(` ${s} `)}return}function fo(e){const{config:t,markDef:n}=e,i=R("invalid",n,t);if(i){const r=Eb(e,{channels:qe});if(r)return{defined:{signal:r}}}return{}}function Eb(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{var a;const c=e.getScaleComponent(o);if(c){const l=c.get("type"),u=e.vgField(o,{expr:"datum",binSuffix:((a=e.stack)===null||a===void 0?void 0:a.impute)?"mid":void 0});u&&ve(l)&&(s[u]=!0)}return s},{}),r=v(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>Es(o,t)).join(` ${s} `)}return}function ru(e,t){return t!==void 0?{[e]:H(t)}:void 0}const go="voronoi",su={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(go)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if(Et(s))return O(Gd(s)),n;const o={name:e.getName(go),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},Kl(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,c=!1;return n.forEach((l,u)=>{var f;const d=(f=l.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?a=u:d.indexOf(go)>=0&&(c=!0)}),c||n.splice(a+1,0,o),n}},ou={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!Gs(e.bind),parse:(e,t,n)=>hu(t,n),topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,o=t.init&&t.init[0],a=su.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((c,l)=>{var u,f;const d=q(`${i}_${c.field}`),g=n.filter(p=>p.name===d);g.length||n.unshift(Object.assign(Object.assign({name:d},o?{init:Qt(o[l])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${A(c.field)}] : null`}]:[],bind:(f=(u=s[c.field])!==null&&u!==void 0?u:s[c.channel])!==null&&f!==void 0?f:s}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.filter(l=>l.name===i+At)[0],o=i+oi,a=r.items.map(l=>q(`${i}_${l.field}`)),c=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(s.update=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},gr="_toggle",au={defined:e=>e.type==="point"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+gr,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+At,i=t.name+gr;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${Jt(e)}}, `)+`${i} ? ${n} : null`}},kb={defined:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t)=>{t.clear&&(t.clear=P(t.clear)?cn(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if(ou.defined(t))for(const i of t.project.items){const r=n.findIndex(s=>s.name===q(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const r of t.project.items){const s=n.findIndex(o=>o.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(s=>s.name===t.name+At);i(r,"null"),au.defined(t)&&(r=n.findIndex(s=>s.name===t.name+gr),i(r,"false"))}return n}},cu={defined:e=>{const t=e.resolve==="global"&&e.bind&&Gs(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==ze;return t&&!n&&O(Yd),t&&n},parse:(e,t,n)=>{var i;const r=C(n);if(r.select=P(r.select)?{type:r.select,toggle:t.toggle}:Object.assign(Object.assign({},r.select),{toggle:t.toggle}),hu(t,r),Ir(n.select)&&(n.select.on||n.select.clear)){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const c of t.events)c.filter=V((i=c.filter)!==null&&i!==void 0?i:[]),c.filter.includes(a)||c.filter.push(a)}const s=Vs(t.bind)?t.bind.legend:"click",o=P(s)?cn(s,"view"):V(s);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=Vs(t.bind)&&t.bind.legend,s=o=>a=>{const c=C(a);return c.markname=o,c};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${q(o.field)}_legend`,c=`${i}_${a}`,l=n.filter(u=>u.name===c);if(l.length===0){const u=r.merge.map(s(`${a}_symbols`)).concat(r.merge.map(s(`${a}_labels`))).concat(r.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:c},t.init?{}:{value:null}),{on:[{events:u,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${c}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(d=>d.name===i+At),o=i+oi,a=r.items.filter(d=>d.hasLegend).map(d=>q(`${i}_${q(d.field)}_legend`)),c=a.map(d=>`${d} !== null`).join(" && "),l=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const u=n.find(d=>d.name===i+gr),f=Vs(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:f})):u.on[0].events=f),n}};function Cb(e,t,n){var i,r,s,o;const a=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;for(const c of ie((r=e.component.selection)!==null&&r!==void 0?r:{})){const l=(s=c.project.hasField[a])!==null&&s!==void 0?s:c.project.hasChannel[t];if(l&&cu.defined(c)){const u=(o=n.get("selections"))!==null&&o!==void 0?o:[];u.push(c.name),n.set("selections",u,!1),l.hasLegend=!0}}}const lu="_translate_anchor",uu="_translate_delta",Fb={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=pt.defined(t),s=i+lu,{x:o,y:a}=t.project.hasChannel;let c=cn(t.translate,"scope");return r||(c=c.map(l=>(l.between[0].markname=i+$n,l))),n.push({name:s,value:{},on:[{events:c.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?`, extent_x: ${r?ao(e,G):`slice(${o.signals.visual})`}`:"")+(a!==void 0?`, extent_y: ${r?ao(e,J):`slice(${a.signals.visual})`}`:"")+"}"}]},{name:i+uu,value:{},on:[{events:c,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&fu(e,t,o,"width",n),a!==void 0&&fu(e,t,a,"height",n),n}};function fu(e,t,n,i,r){var s,o;const a=t.name,c=a+lu,l=a+uu,u=n.channel,f=pt.defined(t),d=r.filter(E=>E.name===n.signals[f?"data":"visual"])[0],g=e.getSizeSignalRef(i).signal,p=e.getScaleComponent(u),m=p&&p.get("type"),h=p&&p.get("reverse"),b=f?u===G?h?"":"-":h?"-":"":"",y=`${c}.extent_${u}`,x=`${b}${l}.${u} / ${f?`${g}`:`span(${y})`}`,k=!f||!p?"panLinear":m==="log"?"panLog":m==="symlog"?"panSymlog":m==="pow"?"panPow":"panLinear",$=f?m==="pow"?`, ${(s=p.get("exponent"))!==null&&s!==void 0?s:1}`:m==="symlog"?`, ${(o=p.get("constant"))!==null&&o!==void 0?o:1}`:"":"",N=`${k}(${y}, ${x}${$})`;d.on.push({events:{signal:l},update:f?N:`clampRange(${N}, 0, ${g})`})}const du="_zoom_anchor",gu="_zoom_delta",Nb={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=pt.defined(t),s=i+gu,{x:o,y:a}=t.project.hasChannel,c=A(e.scaleName(G)),l=A(e.scaleName(J));let u=cn(t.zoom,"scope");return r||(u=u.map(f=>(f.markname=i+$n,f))),n.push({name:i+du,on:[{events:u,update:r?"{"+[c?`x: invert(${c}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:u,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&pu(e,t,o,"width",n),a!==void 0&&pu(e,t,a,"height",n),n}};function pu(e,t,n,i,r){var s,o;const a=t.name,c=n.channel,l=pt.defined(t),u=r.filter(k=>k.name===n.signals[l?"data":"visual"])[0],f=e.getSizeSignalRef(i).signal,d=e.getScaleComponent(c),g=d&&d.get("type"),p=l?ao(e,c):u.name,m=a+gu,h=`${a}${du}.${c}`,b=!l||!d?"zoomLinear":g==="log"?"zoomLog":g==="symlog"?"zoomSymlog":g==="pow"?"zoomPow":"zoomLinear",y=l?g==="pow"?`, ${(s=d.get("exponent"))!==null&&s!==void 0?s:1}`:g==="symlog"?`, ${(o=d.get("constant"))!==null&&o!==void 0?o:1}`:"":"",x=`${b}(${p}, ${h}, ${m}${y})`;u.on.push({events:{signal:m},update:l?x:`clampRange(${x}, 0, ${f})`})}const Zt="_store",At="_tuple",Pb="_modify",mu="vlSelectionResolve",pr=[fb,lb,ob,au,ou,pt,cu,kb,Fb,Nb,su];function Tb(e){let t=e.parent;for(;t&&!Le(t);)t=t.parent;return t}function Jt(e,{escape:t}={escape:!0}){let n=t?A(e.name):e.name;const i=Tb(e);if(i){const{facet:r}=i;for(const s of we)r[s]&&(n+=` + '__facet_${s}_' + (facet[${A(i.vgField(s))}])`)}return n}function po(e){var t;return ie((t=e.component.selection)!==null&&t!==void 0?t:{}).reduce((n,i)=>n||i.project.hasSelectionId,!1)}function hu(e,t){(_i(t.select)||!t.select.on)&&delete e.events,(_i(t.select)||!t.select.clear)&&delete e.clear,(_i(t.select)||!t.select.toggle)&&delete e.toggle}function mo(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...mo(e.object)),t.push(...mo(e.property))),t)}function bu(e){return e.object.type==="MemberExpression"?bu(e.object):e.object.name==="datum"}function yu(e){const t=Mf(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&bu(i)&&n.add(mo(i).slice(1).join("."))}),n}class kn extends M{clone(){return new kn(null,this.model,C(this.filter))}constructor(t,n,i){super(t);this.model=n,this.filter=i,this.expr=mr(this.model,this.filter,this),this._dependentFields=yu(this.expr)}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function Ab(e,t){var n;const i={},r=e.config.selection;if(!t||!t.length)return i;for(const s of t){const o=q(s.name),a=s.select,c=P(a)?a:a.type,l=D(a)?C(a):{type:c},u=r[c];for(const g in u){if(g==="fields"||g==="encodings")continue;g==="mark"&&(l[g]=Object.assign(Object.assign({},u[g]),l[g])),(l[g]===void 0||l[g]===!0)&&(l[g]=C((n=u[g])!==null&&n!==void 0?n:l[g]))}const f=i[o]=Object.assign(Object.assign({},l),{name:o,type:c,init:s.value,bind:s.bind,events:P(l.on)?cn(l.on,"scope"):V(C(l.on))}),d=C(s);for(const g of pr)g.defined(f)&&g.parse&&g.parse(e,f,d)}return i}function vu(e,t,n,i="datum"){const r=P(t)?t:t.param,s=q(r),o=A(s+Zt);let a;try{a=e.getSelectionComponent(s,r)}catch(d){return`!!${s}`}if(a.project.timeUnit){const d=n??e.component.data.raw,g=a.project.timeUnit.clone();d.parent?g.insertAsParentOf(d):d.parent=g}const c=a.project.hasSelectionId?"vlSelectionIdTest(":"vlSelectionTest(",l=a.resolve==="global"?")":`, ${A(a.resolve)})`,u=`${c}${o}, ${i}${l}`,f=`length(data(${o}))`;return t.empty===!1?`${f} && ${u}`:`!${f} || ${u}`}function Ou(e,t,n){const i=q(t),r=n.encoding;let s=n.field,o;try{o=e.getSelectionComponent(i,t)}catch(a){return i}if(!r&&!s)s=o.project.items[0].field,o.project.items.length>1&&O(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${A(s)}.`);else if(r&&!s){const a=o.project.items.filter(c=>c.channel===r);!a.length||a.length>1?(s=o.project.items[0].field,O((a.length?"Multiple ":"No ")+`matching ${A(r)} encoding found for selection ${A(n.param)}. Using "field": ${A(s)}.`)):s=a[0].field}return`${o.name}[${A(Se(s))}]`}function zb(e,t){var n;for(const[i,r]of bt((n=e.component.selection)!==null&&n!==void 0?n:{})){const s=e.getName(`lookup_${i}`);e.component.data.outputNodes[s]=r.materialized=new ue(new kn(t,e,{param:i}),s,B.Lookup,e.component.data.outputNodeRefCounts)}}function mr(e,t,n){return Bn(t,i=>P(i)?i:up(i)?vu(e,i,n):oc(i))}var hr=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Ib(e,t){return e?j(e)&&!wt(e)?e.map(n=>zs(n,t)).join(", "):e:void 0}function ho(e,t,n,i){var r,s,o,a,c;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(s=(a=e.encode)[t])!==null&&s!==void 0||(a[t]={}),(o=(c=e.encode[t]).update)!==null&&o!==void 0||(c.update={}),e.encode[t].update[n]=i}function ui(e,t,n,i={header:!1}){var r,s;const o=e.combine(),{disable:a,orient:c,scale:l,labelExpr:u,title:f,zindex:d}=o,g=hr(o,["disable","orient","scale","labelExpr","title","zindex"]);if(a)return;for(const p in g){const m=gm[p],h=g[p];if(m&&m!==t&&m!=="both")delete g[p];else if(ri(h)){const{condition:b}=h,y=hr(h,["condition"]),x=V(b),k=Bc[p];if(k){const{vgProp:$,part:N}=k,E=[...x.map(T=>{const{test:X}=T,xe=hr(T,["test"]);return Object.assign({test:mr(null,X)},xe)}),y];ho(g,N,$,E),delete g[p]}else if(k===null){const $={signal:x.map(N=>{const{test:E}=N,T=hr(N,["test"]);return`${mr(null,E)} ? ${Na(T)} : `}).join("")+Na(y)};g[p]=$}}else if(w(h)){const b=Bc[p];if(b){const{vgProp:y,part:x}=b;ho(g,x,y,h),delete g[p]}}z(["labelAlign","labelBaseline"],p)&&g[p]===null&&delete g[p]}if(t==="grid"){if(!g.grid)return;if(g.encode){const{grid:p}=g.encode;g.encode=Object.assign({},p?{grid:p}:{}),L(g.encode)&&delete g.encode}return Object.assign(Object.assign({scale:l,orient:c},g),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:Q(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(u!==void 0){let m=u;((s=(r=g.encode)===null||r===void 0?void 0:r.labels)===null||s===void 0?void 0:s.update)&&w(g.encode.labels.update.text)&&(m=Lt(u,"datum.label",g.encode.labels.update.text.signal)),ho(g,"labels","text",{signal:m})}if(g.labelAlign===null&&delete g.labelAlign,g.encode){for(const m of Hc)e.hasAxisPart(m)||delete g.encode[m];L(g.encode)&&delete g.encode}const p=Ib(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:c,grid:!1},p?{title:p}:{}),g),n.aria===!1?{aria:!1}:{}),{zindex:Q(d,0)})}}function xu(e){const{axes:t}=e.component,n=[];for(const i of qe)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function Rb(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>ui(r,"grid",t)),...i.map(r=>ui(r,"grid",t)),...n.map(r=>ui(r,"main",t)),...i.map(r=>ui(r,"main",t))].filter(r=>r)}function Su(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},c=new Set([...v(o),...v(a)]),l={};for(const u of c.values())l[u]={signal:`${i.signal} === "${s}" ? ${ut(o[u])} : ${ut(a[u])}`};return l}return t[r]})])}function Lb(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:fc(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=w(n)?"axisOrient":`axis${Hn(n)}`,a=[...r,...r.map(l=>s+l.substr(4))],c=["axis",o,s];return{vlOnlyAxisConfig:Su(a,i,e,n),vgAxisConfig:Su(c,i,e,n),axisConfigStyle:Mb([...c,...a],i)}}function Mb(e,t){var n;const i=[{}];for(const r of e){let s=(n=t[r])===null||n===void 0?void 0:n.style;if(s){s=V(s);for(const o of s)i.push(t.style[o])}}return Object.assign.apply(null,i)}function bo(e,t,n,i={}){var r;const s=Ta(e,n,t);if(s!==void 0)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const _u={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return jc(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return wc(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return(i=t.grid)!==null&&i!==void 0?i:Db(n,e)},gridScale:({model:e,channel:t})=>Ub(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||wu(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||ju(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:Bb(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:Hb(t.type,n,S(t)&&!!t.timeUnit,S(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var s;const o=e==="x"?"width":e==="y"?"height":void 0,a=o?t.getSizeSignalRef(o):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:Gb({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=$u(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return za(r?[Nc(r)]:[],S(o)?[Nc(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Vb(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:Xb(n,t)}};function Db(e,t){return!te(e)&&S(t)&&!W(t==null?void 0:t.bin)&&!re(t==null?void 0:t.bin)}function Ub(e,t){const n=t==="x"?"y":"x";return e.getScaleComponent(n)?e.scaleName(n):void 0}function Wb(e,t,n,i,r){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return w(s)?s:qn(s);{const{configValue:o}=bo("labelAngle",i,t==null?void 0:t.style,r);return o!==void 0?qn(o):n===G&&z([Os,vs],e.type)&&!(S(e)&&e.timeUnit)?270:void 0}}function yo(e){return`(((${e.signal} % 360) + 360) % 360)`}function ju(e,t,n,i){if(e!==void 0)if(n==="x"){if(w(e)){const r=yo(e),s=w(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(w(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(w(e)){const r=yo(e),s=w(t)?`(${t.signal} === "left")`:t==="left",o=i?'"middle"':"null";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${o} : (45 <= ${r} && ${r} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(w(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}return}function wu(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(w(e)){const o=yo(e),a=w(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${r?`(${o} + 90)`:o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${a} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(w(t)){const o=r<e&&e<180+r?"===":"!==",a=`${t.signal} ${o} "${s}"`;return{signal:`${a} ? "left" : "right"`}}return(r<e&&e<180+r)===(t===s)?"left":"right"}function Bb(e,t){return t==="x"&&z(["quantitative","temporal"],e)?!0:void 0}function Hb(e,t,n,i){return n&&!D(i)||e!=="nominal"&&e!=="ordinal"?t==="log"||t==="symlog"?"greedy":!0:void 0}function qb(e){return e==="x"?"bottom":"left"}function Gb({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!te(t)&&t!=="log"){if(S(e)){if(W(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&z(["month","hours","day","quarter"],(r=se(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}function $u(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;return s&&o?Ia(s,o):s||(o||(s!==void 0?s:o!==void 0?o:void 0))}function Vb(e,t){const n=e.values;return j(n)?Wc(t,n):w(n)?n:void 0}function Xb(e,t){return e==="rect"&&Yi(t)?1:0}class Cn extends M{clone(){return new Cn(null,C(this.transform))}constructor(t,n){super(t);this.transform=n,this._dependentFields=yu(this.transform.calculate)}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(!Yt(i))return;if(Fc(i.sort)){const{field:s,timeUnit:o}=i,a=i.sort,c=a.map((l,u)=>`${oc({field:s,timeUnit:o,equal:l})} ? ${u} : `).join("")+a.length;t=new Cn(t,{calculate:c,as:Fn(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${I(this.transform)}`}}function Fn(e,t,n){return _(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function br(e,t){return z(["top","bottom"],t)?"column":z(["left","right"],t)||e==="row"?"row":"column"}function Nn(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return Q((t||{})[e],r[e],n.header[e])}function yr(e,t,n,i){const r={};for(const s of e){const o=Nn(s,t||{},n,i);o!==void 0&&(r[s]=o)}return r}const vo=["row","column"],Oo=["header","footer"];function Yb(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=yr(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),c=br(t,a),l=qn(o);return{name:`${t}-title`,type:"group",role:`${c}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),ku(l,c)),Eu(c,l,s)),Cu(i,r,t,Im,ul))}}function Eu(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=wu(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function ku(e,t){const n=ju(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Kb(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of Oo)if(n[r])for(const s of n[r]){const o=Zb(e,t,r,n,s);o!=null&&i.push(o)}return i}function Qb(e,t){var n;const{sort:i}=e;return Xe(i)?{field:_(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:j(i)?{field:Fn(e,t,{expr:"datum"}),order:"ascending"}:{field:_(e,{expr:"datum"}),order:i??"ascending"}}function xo(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:c}=yr(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=Cs({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,u=br(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:c?Lt(Lt(c,"datum.label",l),"datum.value",_(e,{expr:"parent"})):l}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),ku(s,u)),Eu(u,s,o)),Cu(n,e,t,Rm,fl))}function Zb(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=yr(["labelOrient"],o.header,a,t);(t==="row"&&!z(["top","bottom"],f)||t==="column"&&!z(["left","right"],f))&&(s=xo(o,t,a))}const c=Le(e)&&!ti(e.facet),l=r.axes,u=(l==null?void 0:l.length)>0;if(s||u){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(`${t}_domain`)},sort:Qb(o,t)}:{}),u&&c?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),u?{axes:l}:{})}}return null}const Jb={column:{start:0,end:1},row:{start:1,end:0}};function ey(e,t){return Jb[t][e]}function ty(e,t){const n={};for(const i of we){const r=e[i];if(r==null?void 0:r.facetFieldDef){const{titleAnchor:s,titleOrient:o}=yr(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=br(i,o),c=ey(s,a);c!==void 0&&(n[a]=c)}}return L(n)?void 0:n}function Cu(e,t,n,i,r){const s={};for(const o of i){if(!r[o])continue;const a=Nn(o,t==null?void 0:t.header,e,n);a!==void 0&&(s[r[o]]=a)}return s}function So(e){return[...vr(e,"width"),...vr(e,"height"),...vr(e,"childWidth"),...vr(e,"childHeight")]}function vr(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(te(o)&&$t(a)){const c=e.scaleName(n);if(Le(e.parent)){const l=e.parent.component.resolve;if(l.scale[n]==="independent")return[Fu(c,a)]}return[Fu(c,a),{name:r,update:Nu(c,s,`domain('${c}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=Qs(e.config.view,s?"width":"height"),c=`isFinite(${o}) ? ${o} : ${a}`;return[{name:r,init:c,on:[{update:c,events:"window:resize"}]}]}else return[{name:r,value:i}]}function Fu(e,t){const n=`${e}_step`;return w(t.step)?{name:n,update:t.step.signal}:{name:n,value:t.step}}function Nu(e,t,n){const i=t.get("type"),r=t.get("padding"),s=Q(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${ut(o)}, ${ut(s)}) * ${e}_step`}function Pu(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function Tu(e,t){return v(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),En(t,r,i,s=>H(s.value)))},{})}function Au(e,t){if(Le(t))return e==="theta"?"independent":"shared";if(An(t))return"shared";if(Lo(t))return ee(e)||e==="theta"||e==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function _o(e,t){const n=e.scale[t],i=ee(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&O(Tg(t)),"independent"):e[i][t]||"shared"}const ny=Object.assign(Object.assign({},Dm),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),zu=v(ny);class iy extends gt{}const Iu={symbols:ry,gradient:sy,labels:oy,entries:ay};function ry(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){var o,a,c,l,u,f,d,g;if(s!=="symbol")return;const{markDef:p,encoding:m,config:h,mark:b}=n,y=p.filled&&b!=="trail";let x=Object.assign(Object.assign({},Bd({},n,Ip)),Jl(n,{filled:y}));const k=(o=r.get("symbolOpacity"))!==null&&o!==void 0?o:h.legend.symbolOpacity,$=(a=r.get("symbolFillColor"))!==null&&a!==void 0?a:h.legend.symbolFillColor,N=(c=r.get("symbolStrokeColor"))!==null&&c!==void 0?c:h.legend.symbolStrokeColor,E=k===void 0?(l=Ru(m.opacity))!==null&&l!==void 0?l:p.opacity:void 0;if(x.fill){if(i==="fill"||y&&i===de)delete x.fill;else if(x.fill.field)$?delete x.fill:(x.fill=H((u=h.legend.symbolBaseFillColor)!==null&&u!==void 0?u:"black"),x.fillOpacity=H(E??1));else if(j(x.fill)){const T=(g=(d=jo((f=m.fill)!==null&&f!==void 0?f:m.color))!==null&&d!==void 0?d:p.fill)!==null&&g!==void 0?g:y&&p.color;T&&(x.fill=H(T))}}if(x.stroke){if(i==="stroke"||!y&&i===de)delete x.stroke;else if(x.stroke.field||N)delete x.stroke;else if(j(x.stroke)){const T=Q(jo(m.stroke||m.color),p.stroke,y?p.color:void 0);T&&(x.stroke={value:T})}}if(i!==ot){const T=S(t)&&Mu(n,r,t);T?x.opacity=[Object.assign({test:T},H(E??1)),H(h.legend.unselectedOpacity)]:E&&(x.opacity=H(E))}return x=Object.assign(Object.assign({},x),e),L(x)?void 0:x}function sy(e,{model:t,legendType:n,legendCmpt:i}){var r;if(n!=="gradient")return;const{config:s,markDef:o,encoding:a}=t;let c={};const l=(r=i.get("gradientOpacity"))!==null&&r!==void 0?r:s.legend.gradientOpacity,u=l===void 0?Ru(a.opacity)||o.opacity:void 0;return u&&(c.opacity=H(u)),c=Object.assign(Object.assign({},c),e),L(c)?void 0:c}function oy(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=S(t)?Mu(n,r,t):void 0,c=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:u}=s;let f;Xt(u)?f=Te({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:u,config:o}):l===void 0&&u===void 0&&o.customFormatTypes&&(t.type==="quantitative"&&o.numberFormatType?f=Te({fieldOrDatumDef:t,field:"datum.value",format:o.numberFormat,formatType:o.numberFormatType,config:o}):t.type==="temporal"&&o.timeFormatType&&S(t)&&t.timeUnit===void 0&&(f=Te({fieldOrDatumDef:t,field:"datum.value",format:o.timeFormat,formatType:o.timeFormatType,config:o})));const d=Object.assign(Object.assign(Object.assign({},c?{opacity:c}:{}),f?{text:f}:{}),e);return L(d)?void 0:d}function ay(e,{legendCmpt:t}){const n=t.get("selections");return(n==null?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function Ru(e){return Lu(e,(t,n)=>Math.max(t,n.value))}function jo(e){return Lu(e,(t,n)=>Q(t,n.value))}function Lu(e,t){return tm(e)?V(e.condition).reduce(t,e.value):Ae(e)?e.value:void 0}function Mu(e,t,n){const i=t.get("selections");if(!(i==null?void 0:i.length))return;const r=A(n.field);return i.map(s=>{const o=A(q(s)+Zt);return`(!length(data(${o})) || (${s}[${r}] && indexof(${s}[${r}], datum.value) >= 0))`}).join(" || ")}const Du={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return jc(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return wc(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:py(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:my(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:ly(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>xn(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(gn(n)&&Pe(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>cy(t,e)};function cy(e,t){const n=e.values;return j(n)?Wc(t,n):w(n)?n:void 0}function ly(e,t,n,i){var r;if(t!=="shape"){const s=(r=jo(n))!==null&&r!==void 0?r:i;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function uy(e){const{legend:t}=e;return Q(t.type,fy(e))}function fy({channel:e,timeUnit:t,scaleType:n}){if(gn(e)){if(z(["quarter","month","day"],t))return"symbol";if(Pe(n))return"gradient"}return"symbol"}function dy({legendConfig:e,legendType:t,orient:n,legend:i}){var r,s;return(s=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:gy(n,t)}function gy(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function py({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:c}=e;return Pe(r)?n==="horizontal"?i==="top"||i==="bottom"?Uu(t,"width",o,s):o:Uu(t,"height",c,a):void 0}function Uu(e,t,n,i){const r=e.getSizeSignalRef(t).signal;return{signal:`clamp(${r}, ${n}, ${i})`}}function my(e){return z(["quantile","threshold","log","symlog"],e)?"greedy":void 0}function Wu(e){const t=Y(e)?hy(e):Oy(e);return e.component.legends=t,t}function hy(e){const{encoding:t}=e,n={};for(const i of[de,...gl]){const r=Z(t[i]);if(!r||!e.getScaleComponent(i))continue;if(i===ge&&S(r)&&r.type===bn)continue;n[i]=vy(e,i)}return n}function by(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function yy(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n==null?void 0:n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function vy(e,t){var n,i,r;let s=e.legend(t);const{markDef:o,encoding:a,config:c}=e,l=c.legend,u=new iy({},by(e,t));Cb(e,t,u);const f=s!==void 0?!s:l.disable;if(u.set("disable",f,s!==void 0),f)return u;s=s||{};const d=e.getScaleComponent(t).get("type"),g=Z(a[t]),p=S(g)?(n=se(g.timeUnit))===null||n===void 0?void 0:n.unit:void 0,m=s.orient||c.legend.orient||"right",h=uy({legend:s,channel:t,timeUnit:p,scaleType:d}),b=dy({legend:s,legendType:h,orient:m,legendConfig:l}),y={legend:s,channel:t,model:e,markDef:o,encoding:a,fieldOrDatumDef:g,legendConfig:l,config:c,scaleType:d,orient:m,legendType:h,direction:b};for(const E of zu){if(h==="gradient"&&E.startsWith("symbol")||h==="symbol"&&E.startsWith("gradient"))continue;const T=E in Du?Du[E](y):s[E];if(T!==void 0){const X=yy(T,E,s,e.fieldDef(t));(X||c.legend[E]===void 0)&&u.set(E,T,X)}}const x=(i=s==null?void 0:s.encoding)!==null&&i!==void 0?i:{},k=u.get("selections"),$={},N={fieldOrDatumDef:g,model:e,channel:t,legendCmpt:u,legendType:h};for(const E of["labels","legend","title","symbols","gradient","entries"]){const T=Tu((r=x[E])!==null&&r!==void 0?r:{},e),X=E in Iu?Iu[E](T,N):T;X!==void 0&&!L(X)&&($[E]=Object.assign(Object.assign(Object.assign({},(k==null?void 0:k.length)&&S(g)?{name:`${q(g.field)}_legend_${E}`}:{}),(k==null?void 0:k.length)?{interactive:!!k}:{}),{update:X}))}return L($)||u.set("encode",$,!!(s==null?void 0:s.encoding)),u}function Oy(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){Wu(i);for(const r of v(i.component.legends))n.legend[r]=_o(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=Bu(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of v(t))for(const r of e.children){if(!r.component.legends[i])continue;n.legend[i]==="shared"&&delete r.component.legends[i]}return t}function Bu(e,t){var n,i,r,s;if(!e)return t.clone();const o=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let c=!1;for(const l of zu){const u=Nt(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,d)=>{switch(l){case"symbolType":return xy(f,d);case"title":return Ra(f,d);case"type":return c=!0,Oe("symbol")}return lr(f,d,l,"legend")});e.setWithExplicit(l,u)}return c&&(((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient)&&wi(e.implicit,["encode","gradient"]),((s=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||s===void 0?void 0:s.gradient)&&wi(e.explicit,["encode","gradient"])),e}function xy(e,t){return t.value==="circle"?t:e}var Sy=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function _y(e,t,n,i){var r,s,o,a,c;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(s=(a=e.encode)[t])!==null&&s!==void 0||(a[t]={}),(o=(c=e.encode[t]).update)!==null&&o!==void 0||(c.update={}),e.encode[t].update[n]=i}function Hu(e){const t=e.component.legends,n={};for(const r of v(t)){const s=e.getScaleComponent(r),o=U(s.get("domains"));if(n[o])for(const a of n[o]){const c=Bu(a,t[r]);c||n[o].push(t[r])}else n[o]=[t[r].clone()]}const i=ie(n).flat().map(r=>jy(r,e.config)).filter(r=>r!==void 0);return i}function jy(e,t){var n,i,r;const s=e.combine(),{disable:o,labelExpr:a,selections:c}=s,l=Sy(s,["disable","labelExpr","selections"]);if(o)return;if(t.aria===!1&&l.aria==null&&(l.aria=!1),(n=l.encode)===null||n===void 0?void 0:n.symbols){const u=l.encode.symbols.update;u.fill&&u.fill.value!=="transparent"&&!u.stroke&&!l.stroke&&(u.stroke={value:"transparent"});for(const f of gl)l[f]&&delete u[f]}if(l.title||delete l.title,a!==void 0){let u=a;((r=(i=l.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&w(l.encode.labels.update.text)&&(u=Lt(a,"datum.label",l.encode.labels.update.text.signal)),_y(l,"labels","text",{signal:u})}return l}function wy(e){return An(e)||Lo(e)?$y(e):qu(e)}function $y(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),qu(e))}function qu(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const c=w(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return z(o,c)||o.push(c),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const Ey=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Gu extends gt{constructor(t,n,i,r){super(Object.assign({},n),{name:t});this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function Vu(e){e.component.projection=Y(e)?ky(e):Ny(e)}function ky(e){var t;if(e.hasProjection){const n=me(e.specifiedProjection),i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=i?Cy(e):void 0,o=new Gu(e.projectionName(!0),Object.assign(Object.assign({},(t=me(e.config.projection))!==null&&t!==void 0?t:{}),n??{}),r,s);return o.get("type")||o.set("type","equalEarth",!1),o}return}function Cy(e){const t=[],{encoding:n}=e;for(const i of[[Fe,Ce],[je,Ne]])(Z(n[i[0]])||Z(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(ge)&&e.typedFieldDef(ge).type===bn&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(B.Main)),t}function Fy(e,t){const n=Ur(Ey,r=>!on(e.explicit,r)&&!on(t.explicit,r)?!0:!!(on(e.explicit,r)&&on(t.explicit,r)&&Me(e.get(r),t.get(r)))),i=Me(e.size,t.size);if(i){if(n)return e;if(Me(e.explicit,{}))return t;if(Me(t.explicit,{}))return e}return null}function Ny(e){if(e.children.length===0)return;let t;for(const i of e.children)Vu(i);const n=Ur(e.children,i=>{const r=i.component.projection;if(r)if(t){const s=Fy(t,r);return s&&(t=s),!!s}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new Gu(i,t.specifiedProjection,t.size,C(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),i),o.merged=!0)}return r}return}var Py=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Ty(e,t,n,i){var r,s;if(ii(t,n)){const o=Y(e)?(s=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&s!==void 0?s:{}:{},a=_(t,{expr:"datum"}),c=_(t,{expr:"datum",binSuffix:"end"});return{formulaAs:_(t,{binSuffix:"range",forAs:!0}),formula:ei(a,c,o.format,o.formatType,i)}}return{}}function Xu(e,t){return`${$a(e)}_${t}`}function Ay(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function wo(e,t,n){var i;const r=(i=Zi(n,void 0))!==null&&i!==void 0?i:{},s=Xu(r,t);return e.getName(`${s}_bins`)}function zy(e){return"as"in e}function Yu(e,t,n){let i,r;zy(e)?i=P(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[_(e,{forAs:!0}),_(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},Zi(t,void 0)),o=Xu(s,e.field),{signal:a,extentSignal:c}=Ay(n,o);if(Ai(s.extent)){const u=s.extent;r=Ou(n,u.param,u),delete s.extent}const l=Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[i]},a?{signal:a}:{}),c?{extentSignal:c}:{}),r?{span:r}:{});return{key:o,binComponent:l}}class et extends M{clone(){return new et(null,C(this.bins))}constructor(t,n){super(t);this.bins=n}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{if(le(s)&&W(s.bin)){const{key:a,binComponent:c}=Yu(s,s.bin,n);r[a]=Object.assign(Object.assign(Object.assign({},c),r[a]),Ty(n,s,o,n.config))}return r},{});return L(i)?null:new et(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:s}=Yu(n,n.bin,i);return new et(t,{[r]:s})}merge(t,n){for(const i of v(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=De([...this.bins[i].as,...t.bins[i].as],I)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(ie(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(ie(this.bins).map(t=>t.field))}hash(){return`Bin ${I(this.bins)}`}assemble(){return ie(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,s=t.bin,{extent:o}=s,a=Py(s,["extent"]),c=Object.assign(Object.assign(Object.assign({type:"bin",field:Se(t.field),as:i,signal:t.signal},Ai(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(n.push({type:"extent",field:Se(t.field),signal:t.extentSignal}),c.extent={signal:t.extentSignal}),n.push(c);for(const l of r)for(let u=0;u<2;u++)n.push({type:"formula",expr:_({field:i[u]},{expr:"datum"}),as:l[u]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function Iy(e,t,n,i){var r;const s=Y(i)?i.encoding[He(t)]:void 0;if(le(n)&&Y(i)&&Ac(n,s,i.markDef,i.config))e.add(_(n,{})),e.add(_(n,{suffix:"end"})),n.bin&&ii(n,t)&&e.add(_(n,{binSuffix:"range"}));else if(ma(t)){const o=pa(t);e.add(i.getName(o))}else e.add(_(n));return Yt(n)&&jp((r=n.scale)===null||r===void 0?void 0:r.range)&&e.add(n.scale.range.field),e}function Ry(e,t){var n;for(const i of v(t)){const r=t[i];for(const s of v(r))i in e?e[i][s]=new Set([...(n=e[i][s])!==null&&n!==void 0?n:[],...r[s]]):e[i]={[s]:r[s]}}}class Ie extends M{clone(){return new Ie(null,new Set(this.dimensions),C(this.measures))}constructor(t,n,i){super(t);this.dimensions=n,this.measures=i}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(o=>{o.aggregate&&(i=!0)});const r={},s=new Set;return i?(n.forEachFieldDef((o,a)=>{var c,l,u,f;const{aggregate:d,field:g}=o;if(d)if(d==="count")(c=r["*"])!==null&&c!==void 0||(r["*"]={}),r["*"].count=new Set([_(o,{forAs:!0})]);else{if(ct(d)||jt(d)){const p=ct(d)?"argmin":"argmax",m=d[p];(l=r[m])!==null&&l!==void 0||(r[m]={}),r[m][p]=new Set([_({op:p,field:m},{forAs:!0})])}else(u=r[g])!==null&&u!==void 0||(r[g]={}),r[g][d]=new Set([_(o,{forAs:!0})]);at(a)&&n.scaleDomain(a)==="unaggregated"&&((f=r[g])!==null&&f!==void 0||(r[g]={}),r[g].min=new Set([_({field:g,aggregate:"min"},{forAs:!0})]),r[g].max=new Set([_({field:g,aggregate:"max"},{forAs:!0})]))}else Iy(s,a,o,n)}),s.size+v(r).length===0?null:new Ie(t,s,r)):null}static makeFromTransform(t,n){var i,r,s;const o=new Set,a={};for(const c of n.aggregate){const{op:l,field:u,as:f}=c;l&&(l==="count"?((i=a["*"])!==null&&i!==void 0||(a["*"]={}),a["*"].count=new Set([f||_(c,{forAs:!0})])):((r=a[u])!==null&&r!==void 0||(a[u]={}),a[u][l]=new Set([f||_(c,{forAs:!0})])))}for(const c of(s=n.groupby)!==null&&s!==void 0?s:[])o.add(c);return o.size+v(a).length===0?null:new Ie(t,o,a)}merge(t){return oa(this.dimensions,t.dimensions)?(Ry(this.measures,t.measures),!0):(Yg("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...v(this.measures)])}producedFields(){const t=new Set;for(const n of v(this.measures))for(const i of v(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${I({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const s of v(this.measures))for(const o of v(this.measures[s]))for(const a of this.measures[s][o])i.push(a),t.push(o),n.push(s==="*"?null:Se(s));const r={type:"aggregate",groupby:[...this.dimensions].map(Se),ops:t,fields:n,as:i};return r}}class Pn extends M{constructor(t,n,i,r){super(t);this.model=n,this.name=i,this.data=r;for(const s of we){const o=n.facet[s];if(o){const{bin:a,sort:c}=o;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[_(o),...W(a)?[_(o,{binSuffix:"end"})]:[]]},Xe(c)?{sortField:c}:j(c)?{sortIndexField:Fn(o,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of we)this[n]&&(t+=` ${n.charAt(0)}:${I(this[n])}`);return t}get fields(){var t;const n=[];for(const i of we)((t=this[i])===null||t===void 0?void 0:t.fields)&&n.push(...this[i].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of we)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of qe){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(te(r)&&$t(s)){const o=xr(this.childModel,n),a=zo(o);a?t[n]=a:O(rs(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x",facet:void 0}[t],s=[],o=[],a=[];r&&i&&i[r]&&(n?(s.push(`distinct_${i[r]}`),o.push("max")):(s.push(i[r]),o.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:c,sortIndexField:l}=this[t];if(c){const{op:u=Hi,field:f}=c;s.push(f),o.push(u),a.push(_(c,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var n,i;const{columns:r}=this.model.layout,{layoutHeaders:s}=this.model.component,o=[],a={};for(const u of vo){for(const f of Oo){const d=(n=s[u]&&s[u][f])!==null&&n!==void 0?n:[];for(const g of d)if(((i=g.axes)===null||i===void 0?void 0:i.length)>0){a[u]=!0;break}}if(a[u]){const f=`length(data("${this.facet.name}"))`,d=u==="row"?r?{signal:`ceil(${f} / ${r})`}:1:r?{signal:`min(${f}, ${r})`}:{signal:f};o.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:d}]})}}const{row:c,column:l}=a;return(c||l)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,n;const i=[];let r=null;const s=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:c}=this;if(o&&a&&(s.x||s.y)){r=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),u=l.map(()=>"distinct");i.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:u}]})}for(const l of[nt,tt])this[l]&&i.push(this.assembleRowColumnHeaderData(l,r,s));if(c){const l=this.assembleFacetHeaderData(s);l&&i.push(...l)}return i}}function Ku(e){return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function Ly(e,t){const n=qr(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.startsWith("date:")){const i=Ku(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.startsWith("utc:")){const i=Ku(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return O(ng(t)),null}function My(e){const t={};return ji(e.filter,n=>{var i;if(sc(n)){let r=null;fs(n)?r=ye(n.equal):gs(n)?r=ye(n.lte):ds(n)?r=ye(n.lt):ps(n)?r=ye(n.gt):ms(n)?r=ye(n.gte):hs(n)?r=n.range[0]:bs(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(Ht(r)?t[n.field]="date":K(r)?t[n.field]="number":P(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function Dy(e){const t={};function n(i){_n(i)?t[i.field]="date":i.type==="quantitative"&&Td(i.aggregate)?t[i.field]="number":fn(i.field)>1?i.field in t||(t[i.field]="flatten"):Yt(i)&&Xe(i.sort)&&fn(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((Y(e)||Le(e))&&e.forEachFieldDef((i,r)=>{if(le(i))n(i);else{const s=Ut(r),o=e.fieldDef(s);n(Object.assign(Object.assign({},i),{type:o.type}))}}),Y(e)){const{mark:i,markDef:r,encoding:s}=e;if(Et(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",a=s[o];S(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function Uy(e){const t={};if(Y(e)&&e.component.selection)for(const n of v(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&fn(r.field)>1&&(t[r.field]="flatten")}return t}class ae extends M{clone(){return new ae(null,C(this._parse))}constructor(t,n){super(t);this._parse=n}hash(){return`Parse ${I(this._parse)}`}static makeExplicit(t,n,i){var r;let s={};const o=n.data;return!Pt(o)&&((r=o==null?void 0:o.format)===null||r===void 0?void 0:r.parse)&&(s=o.format.parse),this.makeWithAncestors(t,s,{},i)}static makeWithAncestors(t,n,i,r){for(const a of v(i)){const c=r.getWithExplicit(a);c.value!==void 0&&(c.explicit||c.value===i[a]||c.value==="derived"||i[a]==="flatten"?delete i[a]:O(Ha(a,i[a],c.value)))}for(const a of v(n)){const c=r.get(a);c!==void 0&&(c===n[a]?delete n[a]:O(Ha(a,n[a],c)))}const s=new gt(n,i);r.copyAll(s);const o={};for(const a of v(s.combine())){const c=s.get(a);c!==null&&(o[a]=c)}return v(o).length===0||r.parseNothing?null:new ae(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of v(this._parse)){const i=this._parse[n];fn(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(v(this._parse))}dependentFields(){return new Set(v(this._parse))}assembleTransforms(t=!1){return v(this._parse).filter(n=>t?fn(n)>1:!0).map(n=>{const i=Ly(n,this._parse[n]);if(!i)return null;const r={type:"formula",expr:i,as:Gr(n)};return r}).filter(n=>n!==null)}}class zt extends M{clone(){return new zt(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([ze])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:ze}}}class fi extends M{clone(){return new fi(null,this.params)}constructor(t,n){super(t);this.params=n}dependentFields(){return new Set}producedFields(){return}hash(){return`Graticule ${I(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class di extends M{clone(){return new di(null,this.params)}constructor(t,n){super(t);this.params=n}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${I(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class en extends M{constructor(t){super(null);t??(t={name:"source"});let n;if(Pt(t)||(n=t.format?Object.assign({},fe(t.format,["parse"])):{}),si(t))this._data={values:t.values};else if(wn(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];z(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else Hl(t)?this._data={values:[{type:"Sphere"}]}:(Wl(t)||Pt(t))&&(this._data={});this._generator=Pt(t),t.name&&(this._name=t.name),n&&!L(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){return}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var Qu=function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},Wy=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},gi;function $o(e){return e instanceof en||e instanceof fi||e instanceof di}class Eo{constructor(){gi.set(this,void 0),Qu(this,gi,!1,"f")}setModified(){Qu(this,gi,!0,"f")}get modifiedFlag(){return Wy(this,gi,"f")}}gi=new WeakMap;class tn extends Eo{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const n=this.getNodeDepths(t,0,new Map),i=[...n.entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class ko extends Eo{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class By extends ko{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of v(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class Hy extends ko{constructor(t){super();this.requiresSelectionId=t&&po(t)}run(t){t instanceof zt&&(this.requiresSelectionId&&($o(t.parent)||t.parent instanceof Ie||t.parent instanceof ae)||(this.setModified(),t.remove()))}}class qy extends Eo{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof Je&&(i=t.producedFields(),Wr(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class Gy extends ko{constructor(){super()}run(t){t instanceof ue&&!t.isRequired()&&(this.setModified(),t.remove())}}class Vy extends tn{run(t){if($o(t))return;if(t.numChildren()>1)return;for(const n of t.children)if(n instanceof ae)if(t instanceof ae)this.setModified(),t.merge(n);else{if(Hr(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}return}}class Xy extends tn{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof ae);if(t.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const o of i){const a=o.parse;for(const c of v(a))c in r?r[c]!==a[c]&&s.add(c):r[c]=a[c]}for(const o of s)delete r[o];if(!L(r)){this.setModified();const o=new ae(t,r);for(const a of n){if(a instanceof ae)for(const c of v(r))delete a.parse[c];t.removeChild(a),a.parent=o,a instanceof ae&&v(a.parse).length===0&&a.remove()}}}}}class Yy extends tn{run(t){t instanceof ue||t.numChildren()>0||t instanceof Pn||(t instanceof en||(this.setModified(),t.remove()))}}class Ky extends tn{run(t){const n=t.children.filter(r=>r instanceof Je),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class Qy extends tn{run(t){const n=t.children.filter(r=>r instanceof Ie),i={};for(const r of n){const s=I(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of v(i)){const s=i[r];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(t.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class Zy extends tn{constructor(t){super();this.model=t}run(t){const n=!($o(t)||t instanceof kn||t instanceof ae||t instanceof zt),i=[],r=[];for(const s of t.children)s instanceof et&&(n&&!Hr(t.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof et?t.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class Jy extends tn{run(t){const n=[...t.children],i=Rt(n,o=>o instanceof ue);if(!i||t.numChildren()<=1)return;const r=[];let s;for(const o of n)if(o instanceof ue){let a=o;for(;a.numChildren()===1;){const[c]=a.children;if(c instanceof ue)a=c;else break}r.push(...a.children),s?(t.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else r.push(o);if(r.length){this.setModified();for(const o of r)o.parent.removeChild(o),o.parent=s}}}class nn extends M{clone(){return new nn(null,C(this.transform))}constructor(t,n){super(t);this.transform=n}addDimensions(t){this.transform.groupby=De(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:_(t)}hash(){return`JoinAggregateTransform ${I(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},r!==void 0?{groupby:r}:{})}}function ev(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=_(i);return r&&t.push(r),t},[])}function tv(e){return j(e)&&e.every(t=>P(t))&&e.length>1}class mt extends M{clone(){return new mt(null,C(this._stack))}constructor(t,n){super(t);this._stack=n}static makeFromTransform(t,n){const{stack:i,groupby:r,as:s,offset:o="zero"}=n,a=[],c=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),c.push(Q(f.order,"ascending"));const l={field:a,order:c};let u;return tv(s)?u=s:P(s)?u=[s,`${s}_end`]:u=[`${n.stack}_start`,`${n.stack}_end`],new mt(t,{dimensionFieldDefs:[],stackField:i,groupby:r,offset:o,sort:l,facetby:[],as:u})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannels:s,fieldChannel:o,offset:a,impute:c}=i,l=s.map(g=>{const p=r[g];return Ke(p)}).filter(g=>!!g),u=ev(n),f=n.encoding.order;let d;return j(f)||S(f)?d=Aa(f):d=u.reduce((g,p)=>(g.field.push(p),g.order.push(o==="y"?"descending":"ascending"),g),{field:[],order:[]}),new mt(t,{dimensionFieldDefs:l,stackField:n.vgField(o),facetby:[],stackby:u,sort:d,offset:a,impute:c,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${I(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:t,impute:n,groupby:i}=this._stack;return t.length>0?t.map(r=>r.bin?n?[_(r,{binSuffix:"mid"})]:[_(r,{}),_(r,{binSuffix:"end"})]:[_(r)]).flat():i??[]}assemble(){const t=[],{facetby:n,dimensionFieldDefs:i,stackField:r,stackby:s,sort:o,offset:a,impute:c,as:l}=this._stack;if(c)for(const u of i){const{bandPosition:f=.5,bin:d}=u;if(d){const g=_(u,{expr:"datum"}),p=_(u,{expr:"datum",binSuffix:"end"});t.push({type:"formula",expr:`${f}*${g}+${1-f}*${p}`,as:_(u,{binSuffix:"mid",forAs:!0})})}t.push({type:"impute",field:r,groupby:[...s,...n],key:_(u,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:o,as:l,offset:a}),t}}class Tn extends M{clone(){return new Tn(null,C(this.transform))}constructor(t,n){super(t);this.transform=n}addDimensions(t){this.transform.groupby=De(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const i=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(i.add,i),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(r=>i.add(r.field)),this.transform.window.map(r=>r.field).filter(r=>r!==void 0).forEach(i.add,i),i}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:_(t)}hash(){return`WindowTransform ${I(this.transform)}`}assemble(){var t;const n=[],i=[],r=[],s=[];for(const d of this.transform.window)i.push(d.op),r.push(this.getDefaultName(d)),s.push(d.param===void 0?null:d.param),n.push(d.field===void 0?null:d.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&i.every(d=>es(d)))return Object.assign({type:"joinaggregate",as:r,ops:i,fields:n},a!==void 0?{groupby:a}:{});const c=[],l=[];if(this.transform.sort!==void 0)for(const d of this.transform.sort)c.push(d.field),l.push((t=d.order)!==null&&t!==void 0?t:"ascending");const u={field:c,order:l},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:r,ops:i,fields:n,sort:u},f!==void 0?{ignorePeers:f}:{}),a!==void 0?{groupby:a}:{}),o!==void 0?{frame:o}:{})}}function nv(e){function t(n){if(!(n instanceof Pn)){const i=n.clone();if(i instanceof ue){const r=Fo+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof Ie||i instanceof mt||i instanceof Tn||i instanceof nn)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function Co(e){if(e instanceof Pn)if(e.numChildren()===1&&!(e.children[0]instanceof ue)){const t=e.children[0];(t instanceof Ie||t instanceof mt||t instanceof Tn||t instanceof nn)&&t.addDimensions(e.fields),t.swapWithParent(),Co(e)}else{const t=e.model.component.data.main;Zu(t);const n=nv(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(Co)}function Zu(e){if(e instanceof ue&&e.type===B.Main&&e.numChildren()===1){const t=e.children[0];t instanceof Pn||(t.swapWithParent(),Zu(e))}}const Fo="scale_",Or=5;function No(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!No(t.children))return!1}return!0}function Re(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function Ju(e,t,n){let i=e.sources,r=!1;return r=Re(new Gy,i)||r,r=Re(new Hy(t),i)||r,i=i.filter(s=>s.numChildren()>0),r=Re(new Yy,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=Re(new Vy,i)||r,r=Re(new Zy(t),i)||r,r=Re(new qy,i)||r,r=Re(new Xy,i)||r,r=Re(new Qy,i)||r,r=Re(new Ky,i)||r,r=Re(new By,i)||r,r=Re(new Jy,i)||r),e.sources=i,r}function iv(e,t){No(e.sources);let n=0,i=0;for(let r=0;r<Or&&Ju(e,t,!0);r++)n++;e.sources.map(Co);for(let r=0;r<Or&&Ju(e,t,!1);r++)i++;No(e.sources),Math.max(n,i)===Or&&O(`Maximum optimization runs(${Or}) reached.`)}class be{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new be(()=>t(n))}}var rv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ef(e){Y(e)?sv(e):ov(e)}function sv(e){const t=e.component.scales;for(const n of v(t)){const i=cv(e,n),r=t[n];if(r.setWithExplicit("domains",i),uv(e,n),e.component.data.isFaceted){let s=e;for(;!Le(s)&&s.parent;)s=s.parent;const o=s.component.resolve.scale[n];if(o==="shared")for(const a of i.value)lt(a)&&(a.data=Fo+a.data.replace(Fo,""))}}}function ov(e){for(const n of e.children)ef(n);const t=e.component.scales;for(const n of v(t)){let i,r=null;for(const s of e.children){const o=s.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=Nt(i,o.getWithExplicit("domains"),"domains","scale",Ao);const a=o.get("selectionExtent");r&&a&&r.param!==a.param&&O(Zd),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function av(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:s}=tf(t,n);if(!r){O(s);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=tf(t,n);if(r)return"unaggregated"}return e}function cv(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=av(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&Z(i.x2)?Z(i.x)?Nt(It(n,r,e,"x"),It(n,r,e,"x2"),"domain","scale",Ao):It(n,r,e,"x2"):t==="y"&&Z(i.y2)?Z(i.y)?Nt(It(n,r,e,"y"),It(n,r,e,"y2"),"domain","scale",Ao):It(n,r,e,"y2"):It(n,r,e,t)}function lv(e,t,n){return e.map(i=>{const r=Ji(i,{timeUnit:n,type:t});return{signal:`{data: ${r}}`}})}function Po(e,t,n){var i;const r=(i=se(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?lv(e,t,r):[e]}function It(e,t,n,i){const{encoding:r}=n,s=Z(r[i]),{type:o}=s,a=s.timeUnit;if(_p(t)){const f=It(e,void 0,n,i),d=Po(t.unionWith,o,a);return Ze([...d,...f.value])}else{if(w(t))return Ze([t]);if(t&&t!=="unaggregated"&&!gc(t))return Ze(Po(t,o,a))}const c=n.stack;if(c&&i===c.fieldChannel){if(c.offset==="normalize")return Oe([[0,1]]);const f=n.requestDataName(B.Main);return Oe([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const l=at(i)&&S(s)?fv(n,i,e):void 0;if(Ye(s)){const f=Po([s.datum],o,a);return Oe(f)}const u=s;if(t==="unaggregated"){const f=n.requestDataName(B.Main),{field:d}=s;return Oe([{data:f,field:_({field:d,aggregate:"min"})},{data:f,field:_({field:d,aggregate:"max"})}])}else if(W(u.bin)){if(te(e))return e==="bin-ordinal"?Oe([]):Oe([{data:Wn(l)?n.requestDataName(B.Main):n.requestDataName(B.Raw),field:n.vgField(i,ii(u,i)?{binSuffix:"range"}:{}),sort:l===!0||!D(l)?{field:n.vgField(i,{}),op:"min"}:l}]);{const{bin:f}=u;if(W(f)){const d=wo(n,u.field,f);return Oe([new be(()=>{const g=n.getSignalName(d);return`[${g}.start, ${g}.stop]`})])}else return Oe([{data:n.requestDataName(B.Main),field:n.vgField(i,{})}])}}else if(u.timeUnit&&z(["time","utc"],e)&&Ac(u,Y(n)?n.encoding[He(i)]:void 0,n.markDef,n.config)){const f=n.requestDataName(B.Main);return Oe([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return Oe(l?[{data:Wn(l)?n.requestDataName(B.Main):n.requestDataName(B.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(B.Main),field:n.vgField(i)}])}function To(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n??(t?"sum":Hi)},i?{field:Se(i)}:{}),r?{order:r}:{})}function uv(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=gc(r)&&r,a=Wt(s)&&Ai(s.extent)&&s.extent;(o||a)&&i.set("selectionExtent",o??a,!0)}function fv(e,t,n){if(!te(n))return;const i=e.fieldDef(t),r=i.sort;if(Fc(r))return{op:"min",field:Fn(i,t),order:"ascending"};const{stack:s}=e,o=s?new Set([...s.groupbyFields,...s.stackBy.map(a=>a.fieldDef.field)]):void 0;if(Xe(r)){const a=s&&!o.has(r.field);return To(r,a)}else if(Cc(r)){const{encoding:a,order:c}=r,l=e.fieldDef(a),{aggregate:u,field:f}=l,d=s&&!o.has(f);if(ct(u)||jt(u))return To({field:_(l),order:c},d);if(es(u)||!u)return To({op:u,field:f,order:c},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(z(["ascending",void 0],r))return!0}return}function tf(e,t){const{aggregate:n,type:i}=e;return n?P(n)&&!zd.has(n)?{valid:!1,reason:$g(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:Eg(e)}:{valid:!0}:{valid:!1,reason:wg(e)}}function Ao(e,t,n,i){return e.explicit&&t.explicit&&O(Pg(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function dv(e){const t=De(e.map(o=>{if(lt(o)){const a=rv(o,["sort"]);return a}return o}),I),n=De(e.map(o=>{if(lt(o)){const a=o.sort;return a!==void 0&&!Wn(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}return}).filter(o=>o!==void 0),I);if(t.length===0)return;if(t.length===1){const o=e[0];if(lt(o)&&n.length>0){let a=n[0];if(n.length>1){O(Ka);const c=n.filter(l=>D(l)&&"op"in l&&l.op!=="min");n.every(l=>D(l)&&"op"in l)&&c.length===1?a=c[0]:a=!0}else if(D(a)&&"field"in a){const c=a.field;o.field===c&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},o),{sort:a})}return o}const i=De(n.map(o=>Wn(o)||!("op"in o)||P(o.op)&&o.op in Nd?o:(O(Ag(o)),!0)),I);let r;i.length===1?r=i[0]:i.length>1&&(O(Ka),r=!0);const s=De(e.map(o=>lt(o)?o.data:null),o=>o);if(s.length===1&&s[0]!==null){const o=Object.assign({data:s[0],fields:t.map(a=>a.field)},r?{sort:r}:{});return o}return Object.assign({fields:t},r?{sort:r}:{})}function zo(e){if(lt(e)&&P(e.field))return e.field;if(Rd(e)){let t;for(const n of e.fields)if(lt(n)&&P(n.field)){if(!t)t=n.field;else if(t!==n.field)return O(zg),t}return O(Ig),t}else if(Ld(e)){O(Rg);const t=e.fields[0];return P(t)?t:void 0}return}function xr(e,t){const n=e.component.scales[t],i=n.get("domains").map(r=>(lt(r)&&(r.data=e.lookupDataSource(r.data)),r));return dv(i)}var gv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function nf(e){return An(e)||Lo(e)?e.children.reduce((t,n)=>t.concat(nf(n)),rf(e)):rf(e)}function rf(e){return v(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:c,range:l,reverse:u}=r,f=gv(r,["name","type","selectionExtent","domains","range","reverse"]),d=pv(r.range,s,n,e),g=xr(e,n),p=a?rb(e,a,i,g):null;return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},g?{domain:g}:{}),p?{domainRaw:p}:{}),{range:d}),u!==void 0?{reverse:u}:{}),f)),t},[])}function pv(e,t,n,i){if(ee(n)){if($t(e))return{step:{signal:`${t}_step`}}}else if(D(e)&&lt(e))return Object.assign(Object.assign({},e),{data:i.lookupDataSource(e.data)});return e}class sf extends gt{constructor(t,n){super({},{name:t});this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:Rt(this.get("domains"),t=>j(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const mv=["range","scheme"];function hv(e){const t=e.component.scales;for(const n of Ti){const i=t[n];if(!i)continue;const r=bv(n,e);i.setWithExplicit("range",r)}}function of(e,t){const n=e.fieldDef(t);if(n==null?void 0:n.bin){const{bin:i,field:r}=n,s=pe(t),o=e.getName(s);if(D(i)&&i.binned&&i.step!==void 0)return new be(()=>{const a=e.scaleName(t),c=`(domain("${a}")[1] - domain("${a}")[0]) / ${i.step}`;return`${e.getSignalName(o)} / (${c})`});if(W(i)){const a=wo(e,r,i);return new be(()=>{const c=e.getSignalName(a),l=`(${c}.stop - ${c}.start) / ${c}.step`;return`${e.getSignalName(o)} / (${l})`})}}return}function bv(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e),s=r.get("type");for(const f of mv)if(n[f]!==void 0){const d=Ss(s,f),g=pc(e,f);if(!d)O(Xa(s,f,e));else if(g)O(g);else switch(f){case"range":{const p=n.range;if(j(p)){if(ee(e))return Ze(p.map(m=>{if(m==="width"||m==="height"){const h=t.getName(m),b=t.getSignalName.bind(t);return be.fromName(b,h)}return m}))}else if(D(p))return Ze({data:t.requestDataName(B.Main),field:p.field,sort:{op:"min",field:t.vgField(e)}});return Ze(p)}case"scheme":return Ze(yv(n[f]))}}const o=e===G||e==="xOffset"?"width":"height",a=i[o];if(Qe(a)){if(ee(e))if(te(s)){const f=af(a,t,e);if(f)return Ze({step:f})}else O(Ya(o));else if(pn(e)){const f=e===yt?"x":"y",d=t.getScaleComponent(f),g=d.get("type");if(g==="band"){const p=cf(a,s);if(p)return Ze(p)}}}const{rangeMin:c,rangeMax:l}=n,u=vv(e,t);return(c!==void 0||l!==void 0)&&Ss(s,"rangeMin")&&j(u)&&u.length===2?Ze([c??u[0],l??u[1]]):Oe(u)}function yv(e){return Sp(e)?Object.assign({scheme:e.name},fe(e,["name"])):{scheme:e}}function vv(e,t){const{size:n,config:i,mark:r,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=Z(s[e]),c=t.getScaleComponent(e),l=c.get("type"),{domain:u,domainMid:f}=t.specifiedScales[e];switch(e){case G:case J:{if(z(["point","band"],l)){const p=lf(e,n,i.view);if(Qe(p)){const m=af(p,t,e);return{step:m}}}const d=pe(e),g=t.getName(d);return e===J&&ve(l)?[be.fromName(o,g),0]:[0,be.fromName(o,g)]}case yt:case dn:return Ov(e,t,l);case st:{const d=t.component.scales[e].get("zero"),g=uf(r,d,i),p=_v(r,n,t,i);return yn(l)?Sv(g,p,xv(l,i,u,e)):[g,p]}case _e:return[0,Math.PI*2];case Mt:return[0,360];case ke:return[0,new be(()=>{const d=t.getSignalName("width"),g=t.getSignalName("height");return`min(${d},${g})/2`})];case xt:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case St:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case ge:return"symbol";case de:case We:case Be:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case ot:case vt:case Ot:return[i.scale.minOpacity,i.scale.maxOpacity]}}function af(e,t,n){var i,r,s,o,a;const{encoding:c}=t,l=t.getScaleComponent(n),u=va(n),f=c[u],d=ml({step:e,offsetIsDiscrete:F(f)&&ac(f.type)});if(d==="offset"&&Xc(c,u)){const g=t.getScaleComponent(u),p=t.scaleName(u);let m=`domain('${p}').length`;if(g.get("type")==="band"){const b=(r=(i=g.get("paddingInner"))!==null&&i!==void 0?i:g.get("padding"))!==null&&r!==void 0?r:0,y=(o=(s=g.get("paddingOuter"))!==null&&s!==void 0?s:g.get("padding"))!==null&&o!==void 0?o:0;m=`bandspace(${m}, ${b}, ${y})`}const h=(a=l.get("paddingInner"))!==null&&a!==void 0?a:l.get("padding");return{signal:`${e.step} * ${m} / (1-${Wd(h)})`}}else return e.step}function cf(e,t){const n=ml({step:e,offsetIsDiscrete:te(t)});return n==="offset"?{step:e.step}:void 0}function Ov(e,t,n){const i=e===yt?"x":"y",r=t.getScaleComponent(i),s=r.get("type"),o=t.scaleName(i);if(s==="band"){const a=lf(i,t.size,t.config.view);if(Qe(a)){const c=cf(a,n);if(c)return c}return[0,{signal:`bandwidth('${o}')`}]}else return ra(`Cannot use ${e} scale if ${i} scale is not discrete.`)}function lf(e,t,n){const i=e===G?"width":"height",r=t[i];return r||ar(n,i)}function xv(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&j(n)?n.length+1:(O(Gg(i)),3)}}function Sv(e,t,n){const i=()=>{const r=ut(t),s=ut(e),o=`(${r} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${r} + ${o}, ${o})`};return w(t)?new be(i):{signal:i()}}function uf(e,t,n){if(t)return w(t)?{signal:`${t.signal} ? 0 : ${uf(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Ii("size",e))}const ff=.95;function _v(e,t,n,i){const r={x:of(n,"x"),y:of(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=df(t,r,i.view);return K(s)?s-1:new be(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=df(t,r,i.view);return K(s)?Math.pow(ff*s,2):new be(()=>`pow(${ff} * ${s.signal}, 2)`)}}throw new Error(Ii("size",e))}function df(e,t,n){const i=Qe(e.width)?e.width.step:or(n,"width"),r=Qe(e.height)?e.height.step:or(n,"height");return t.x||t.y?new be(()=>{const s=[t.x?t.x.signal:i,t.y?t.y.signal:r];return`min(${s.join(", ")})`}):Math.min(i,r)}function gf(e,t){Y(e)?jv(e,t):hf(e,t)}function jv(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=e;for(const a of v(n)){const c=o[a],l=n[a],u=e.getScaleComponent(a),f=Z(r[a]),d=c[t],g=u.get("type"),p=u.get("padding"),m=u.get("paddingInner"),h=Ss(g,t),b=pc(a,t);if(d!==void 0&&(h?b&&O(b):O(Xa(g,t,a))),h&&b===void 0)if(d!==void 0){const y=f.timeUnit,x=f.type;switch(t){case"domainMax":case"domainMin":Ht(c[t])||x==="temporal"||y?l.set(t,{signal:Ji(c[t],{type:x,timeUnit:y})},!0):l.set(t,c[t],!0);break;default:l.copyKeyFromObject(t,c)}}else{const y=t in pf?pf[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:g,scalePadding:p,scalePaddingInner:m,domain:c.domain,domainMin:c.domainMin,domainMax:c.domainMax,markDef:s,config:i,hasNestedOffsetScale:Rs(r,a),hasSecondaryRangeChannel:!!r[He(a)]}):i.scale[t];y!==void 0&&l.set(t,y,!1)}}}const pf={bins:({model:e,fieldOrDatumDef:t})=>S(t)?wv(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>$v(e,t.type),nice:({scaleType:e,channel:t,domain:n,domainMin:i,domainMax:r,fieldOrDatumDef:s})=>Ev(e,t,n,i,r,s),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>kv(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,scaleType:i,config:r,hasNestedOffsetScale:s})=>Cv(e,t,n.type,i,r.scale,s),paddingOuter:({scalePadding:e,channel:t,scaleType:n,scalePaddingInner:i,config:r,hasNestedOffsetScale:s})=>Fv(e,t,n,i,r.scale,s),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=S(e)?e.sort:void 0;return Nv(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r,config:s,hasSecondaryRangeChannel:o})=>Pv(e,t,n,i,r,s.scale,o)};function mf(e){Y(e)?hv(e):hf(e,"range")}function hf(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?mf(i):gf(i,t);for(const i of v(n)){let r;for(const s of e.children){const o=s.component.scales[i];if(o){const a=o.getWithExplicit(t);r=Nt(r,a,t,"scale",Ul((c,l)=>{switch(t){case"range":return c.step&&l.step?c.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function wv(e,t){const n=t.bin;if(W(n)){const i=wo(e,t.field,n);return new be(()=>e.getSignalName(i))}else if(re(n)&&Wt(n)&&n.step!==void 0)return{step:n.step};return}function $v(e,t){return z([de,We,Be],e)&&t!=="nominal"?"hcl":void 0}function Ev(e,t,n,i,r,s){var o;return((o=Ke(s))===null||o===void 0?void 0:o.bin)||j(n)||r!=null||i!=null||z([he.TIME,he.UTC],e)?void 0:ee(t)?!0:void 0}function kv(e,t,n,i,r,s){if(ee(e)){if(Pe(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=r;if(o==="bar"&&!(S(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===he.POINT)return n.pointPadding}return}function Cv(e,t,n,i,r,s=!1){if(e!==void 0)return;if(ee(t)){const{bandPaddingInner:o,barBandPaddingInner:a,rectBandPaddingInner:c,bandWithNestedOffsetPaddingInner:l}=r;return s?l:Q(o,n==="bar"?a:c)}else if(pn(t)&&i===he.BAND)return r.offsetBandPaddingInner;return}function Fv(e,t,n,i,r,s=!1){if(e!==void 0)return;if(ee(t)){const{bandPaddingOuter:o,bandWithNestedOffsetPaddingOuter:a}=r;if(s)return a;if(n===he.BAND)return Q(o,w(i)?{signal:`${i.signal}/2`}:i/2)}else if(pn(t)){if(n===he.POINT)return .5;if(n===he.BAND)return r.offsetBandPaddingOuter}return}function Nv(e,t,n,i){return n==="x"&&i.xReverse!==void 0?ve(e)&&t==="descending"?w(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:ve(e)&&t==="descending"?!0:void 0}function Pv(e,t,n,i,r,s,o){const a=!!n&&n!=="unaggregated";if(a&&ve(r)){if(j(n)){const c=n[0],l=n[n.length-1];if(c<=0&&l>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!yn(r))return!0;if(!(S(t)&&t.bin)&&z([...qe,..._d],e)){const{orient:c,type:l}=i;return z(["bar","area","line","trail"],l)&&(c==="horizontal"&&e==="y"||c==="vertical"&&e==="x")?!1:z(["bar","area"],l)&&!o?!0:s==null?void 0:s.zero}return!1}function Tv(e,t,n,i,r=!1){const s=Av(t,n,i,r),{type:o}=e;return at(t)?o!==void 0?Cp(t,o)?S(n)&&!kp(o,n.type)?(O(Fg(o,s)),s):o:(O(Cg(t,o,s)),s):s:null}function Av(e,t,n,i){var r;switch(t.type){case"nominal":case"ordinal":{if(gn(e)||Jr(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&O(os(e,"ordinal")),"ordinal";if(ee(e)||pn(e)){if(z(["rect","bar","image","rule"],n.type))return"band";if(i)return"band"}else if(n.type==="arc"&&e in Zr)return"band";const s=n[pe(e)];return Gt(s)||On(t)&&((r=t.axis)===null||r===void 0?void 0:r.tickBand)?"band":"point"}case"temporal":return gn(e)?"time":Jr(e)==="discrete"?(O(os(e,"temporal")),"ordinal"):S(t)&&t.timeUnit&&se(t.timeUnit).utc?"utc":"time";case"quantitative":return gn(e)?S(t)&&W(t.bin)?"bin-ordinal":"linear":Jr(e)==="discrete"?(O(os(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(Ga(t.type))}function zv(e,{ignoreRange:t}={}){bf(e),ef(e);for(const n of Ep)gf(e,n);t||mf(e)}function bf(e){Y(e)?e.component.scales=Iv(e):e.component.scales=Lv(e)}function Iv(e){const{encoding:t,mark:n,markDef:i}=e,r={};for(const s of Ti){const o=Z(t[s]);if(o&&n===bc&&s===ge&&o.type===bn)continue;let a=o&&o.scale;if(pn(s)){const c=Oa(s);if(!Rs(t,c)){a&&O(mg(s));continue}}if(o&&a!==null&&a!==!1){a??(a={});const c=Rs(t,s),l=Tv(a,s,o,i,c);r[s]=new sf(e.scaleName(`${s}`,!0),{value:l,explicit:a.type===l})}}return r}const Rv=Ul((e,t)=>cc(e)-cc(t));function Lv(e){var t,n;const i=e.component.scales={},r={},s=e.component.resolve;for(const o of e.children){bf(o);for(const a of v(o.component.scales))if((t=(n=s.scale)[a])!==null&&t!==void 0||(n[a]=Au(a,e)),s.scale[a]==="shared"){const c=r[a],l=o.component.scales[a].getWithExplicit("type");c?bp(c.value,l.value)?r[a]=Nt(c,l,"type","scale",Rv):(s.scale[a]="independent",delete r[a]):r[a]=l}}for(const o of v(r)){const a=e.scaleName(o,!0),c=r[o];i[o]=new sf(a,c);for(const l of e.children){const u=l.component.scales[o];u&&(l.renameScale(u.get("name"),a),u.merged=!0)}}return i}var Io=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Ro{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function Y(e){return(e==null?void 0:e.type)==="unit"}function Le(e){return(e==null?void 0:e.type)==="facet"}function Lo(e){return(e==null?void 0:e.type)==="concat"}function An(e){return(e==null?void 0:e.type)==="layer"}class Mo{constructor(t,n,i,r,s,o,a){var c,l;this.type=n,this.parent=i,this.config=s,this.correctDataNames=u=>{var f,d,g;return((f=u.from)===null||f===void 0?void 0:f.data)&&(u.from.data=this.lookupDataSource(u.from.data)),((g=(d=u.from)===null||d===void 0?void 0:d.facet)===null||g===void 0?void 0:g.data)&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u},this.parent=i,this.config=s,this.view=me(a),this.name=(c=t.name)!==null&&c!==void 0?c:r,this.title=wt(t.title)?{text:t.title}:t.title?me(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new Ro,this.projectionNameMap=i?i.projectionNameMap:new Ro,this.signalNameMap=i?i.signalNameMap:new Ro,this.data=t.data,this.description=t.description,this.transforms=Dh((l=t.transform)!==null&&l!==void 0?l:[]),this.layout=n==="layer"||n==="unit"?{}:Gm(t,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:qi(t)||(i==null?void 0:i.component.data.isFaceted)&&t.data===void 0},layoutSize:new gt,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?C(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){zv(this)}parseProjection(){Vu(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Wu(this)}assembleEncodeFromView(t){const n=Io(t,["style"]),i={};for(const r of v(n)){const s=n[r];s!==void 0&&(i[r]=H(s))}return i}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=H(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{}):L(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,i=Io(t,["spacing"]),{component:r,config:s}=this,o=ty(r.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),i),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of we)t[i].title&&n.push(Yb(this,i));for(const i of vo)n=n.concat(Kb(this,i));return n}assembleAxes(){return Rb(this.component.axes,this.config)}assembleLegends(){return Hu(this)}assembleProjections(){return wy(this)}assembleTitle(){var t,n,i;const r=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=r,o=Io(r,["encoding"]),a=Object.assign(Object.assign(Object.assign({},ka(this.config.title).nonMarkTitleProperties),o),s?{encode:{update:s}}:{});return a.text?(z(["unit","layer"],this.type)?z(["middle",void 0],a.anchor)&&((n=a.frame)!==null&&n!==void 0||(a.frame="group")):(i=a.anchor)!==null&&i!==void 0||(a.anchor="start"),L(a)?void 0:a):void 0}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||Le(this.parent)?nf(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return q((this.name?`${this.name}_`:"")+t)}getDataName(t){return this.getName(B[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(Le(this.parent)){const n=Pu(t),i=Pi(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if(te(s)&&$t(o)){const a=r.get("name"),c=xr(this,i),l=zo(c);if(l){const u=_({aggregate:"distinct",field:l},{expr:"datum"});return{signal:Nu(a,r,u)}}else return O(rs(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){return n?this.getName(t):ba(t)&&at(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(Vd(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(i=>i.hasOrientSignalRef()))}}class yf extends Mo{vgField(t,n={}){const i=this.fieldDef(t);return i?_(i,n):void 0}reduceFieldDef(t,n){return Om(this.getMapping(),(i,r,s)=>{const o=Ke(r);return o?t(i,o,s):i},n)}forEachFieldDef(t,n){Ms(this.getMapping(),(i,r)=>{const s=Ke(i);s&&t(s,r)},n)}}var Mv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Sr extends M{clone(){return new Sr(null,C(this.transform))}constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=C(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"value",(s=o[1])!==null&&s!==void 0?s:"density"],n.groupby&&n.minsteps==null&&n.maxsteps==null&&n.steps==null&&(this.transform.steps=200)}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${I(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,i=Mv(t,["density"]),r=Object.assign({type:"kde",field:n},i);return r}}class pi extends M{clone(){return new pi(null,Object.assign({},this.filter))}constructor(t,n){super(t);this.filter=n}static make(t,n){const{config:i,mark:r,markDef:s}=n,o=R("invalid",s,i);if(o!=="filter")return null;const a=n.reduceFieldDef((c,l,u)=>{const f=at(u)&&n.getScaleComponent(u);if(f){const d=f.get("type");ve(d)&&l.aggregate!=="count"&&!Et(r)&&(c[l.field]=l)}return c},{});return v(a).length?new pi(t,a):null}dependentFields(){return new Set(v(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${I(this.filter)}`}assemble(){const t=v(this.filter).reduce((n,i)=>{const r=this.filter[i],s=_(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):r.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class _r extends M{clone(){return new _r(this.parent,C(this.transform))}constructor(t,n){super(t);this.transform=n,this.transform=C(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,o)=>{var a;return(a=r[o])!==null&&a!==void 0?a:s})}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${I(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform,i={type:"flatten",fields:t,as:n};return i}}class jr extends M{clone(){return new jr(null,C(this.transform))}constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=C(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"key",(s=o[1])!==null&&s!==void 0?s:"value"]}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${I(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform,i={type:"fold",fields:t,as:n};return i}}class zn extends M{clone(){return new zn(null,C(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[Fe,Ce],[je,Ne]]){const s=r.map(o=>{const a=Z(n.encoding[o]);return S(a)?a.field:Ye(a)?{expr:`${a.datum}`}:Ae(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new zn(t,s,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(ge)){const r=n.typedFieldDef(ge);r.type===bn&&(t=new zn(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}constructor(t,n,i,r){super(t);this.fields=n,this.geojson=i,this.signal=r}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(P);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${I(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})]}}class mi extends M{clone(){return new mi(null,this.projection,C(this.fields),C(this.as))}constructor(t,n,i,r){super(t);this.projection=n,this.fields=i,this.as=r}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[Fe,Ce],[je,Ne]]){const r=i.map(o=>{const a=Z(n.encoding[o]);return S(a)?a.field:Ye(a)?{expr:`${a.datum}`}:Ae(a)?{expr:`${a.value}`}:void 0}),s=i[0]===je?"2":"";(r[0]||r[1])&&(t=new mi(t,n.projectionName(),r,[n.getName(`x${s}`),n.getName(`y${s}`)]))}return t}dependentFields(){return new Set(this.fields.filter(P))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${I(this.fields)} ${I(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class rn extends M{clone(){return new rn(null,C(this.transform))}constructor(t,n){super(t);this.transform=n}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t,s=[n,i,...r?[r]:[]].join(",");return{signal:`sequence(${s})`}}static makeFromTransform(t,n){return new rn(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,s=i.y;if(S(r)&&S(s)){const o=r.impute?r:s.impute?s:void 0;if(o===void 0)return;const a=r.impute?s:s.impute?r:void 0,{method:c,value:l,frame:u,keyvals:f}=o.impute,d=Kc(n.mark,i);return new rn(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},c?{method:c}:{}),l!==void 0?{value:l}:{}),u?{frame:u}:{}),f!==void 0?{keyvals:f}:{}),d.length?{groupby:d}:{}))}return null}hash(){return`Impute ${I(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:s,value:o,frame:a=[null,null]}=this.transform,c=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},i?{keyvals:Sh(i)?this.processSequence(i):i}:{}),{method:"value"}),s?{groupby:s}:{}),{value:!r||r==="value"?o:null});if(r&&r!=="value"){const l=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1},s?{groupby:s}:{}),u={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[c,l,u]}else return[c]}}var Dv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class wr extends M{clone(){return new wr(null,C(this.transform))}constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=C(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.loess]}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${I(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:i}=t,r=Dv(t,["loess","on"]),s=Object.assign({type:"loess",x:i,y:n},r);return s}}class hi extends M{clone(){return new hi(null,C(this.transform),this.secondary)}constructor(t,n,i){super(t);this.transform=n,this.secondary=i}static make(t,n,i,r){const s=n.component.data.sources,{from:o}=i;let a=null;if(_h(o)){let c=Sf(o.data,s);c||(c=new en(o.data),s.push(c));const l=n.getName(`lookup_${r}`);a=new ue(c,l,B.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(jh(o)){const c=o.param;i=Object.assign({as:c},i);let l;try{l=n.getSelectionComponent(q(c),c)}catch(u){throw new Error(Kd(c))}if(a=l.materialized,!a)throw new Error(Qd(c))}return new hi(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?V(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${I({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:V(this.transform.as)}:{});else{let n=this.transform.as;P(n)||(O(sg),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}var Uv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class $r extends M{clone(){return new $r(null,C(this.transform))}constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=C(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"prob",(s=o[1])!==null&&s!==void 0?s:"value"]}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${I(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,i=Uv(t,["quantile"]),r=Object.assign({type:"quantile",field:n},i);return r}}var Wv=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Er extends M{clone(){return new Er(null,C(this.transform))}constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=C(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.regression]}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${I(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:i}=t,r=Wv(t,["regression","on"]),s=Object.assign({type:"regression",x:i,y:n},r);return s}}class kr extends M{clone(){return new kr(null,C(this.transform))}constructor(t,n){super(t);this.transform=n}addDimensions(t){var n;this.transform.groupby=De(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),i=>i)}producedFields(){return}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${I(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},r!==void 0?{limit:r}:{}),s!==void 0?{op:s}:{}),i!==void 0?{groupby:i}:{})}}class Cr extends M{clone(){return new Cr(null,C(this.transform))}constructor(t,n){super(t);this.transform=n}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${I(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function vf(e){let t=0;function n(i,r){var s;if(i instanceof en&&(!i.isGenerator&&!wn(i.data))){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}if(i instanceof ae&&(i.parent instanceof en&&!r.source?(r.format=Object.assign(Object.assign({},(s=r.format)!==null&&s!==void 0?s:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Pn){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,e.push(...i.assemble());return}if((i instanceof fi||i instanceof di||i instanceof pi||i instanceof kn||i instanceof Cn||i instanceof mi||i instanceof Ie||i instanceof hi||i instanceof Tn||i instanceof nn||i instanceof jr||i instanceof _r||i instanceof Sr||i instanceof wr||i instanceof $r||i instanceof Er||i instanceof zt||i instanceof Cr||i instanceof kr)&&r.transform.push(i.assemble()),(i instanceof et||i instanceof Je||i instanceof rn||i instanceof mt||i instanceof zn)&&r.transform.push(...i.assemble()),i instanceof ue){if(r.source&&r.transform.length===0)i.setSource(r.source);else if(i.parent instanceof ue)i.setSource(r.name);else if(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}}switch(i.numChildren()){case 0:i instanceof ue&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const a of i.children){const c={name:null,source:o,transform:[]};n(a,c)}break}}}return n}function Bv(e){const t=[],n=vf(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function Hv(e,t){var n,i;const r=[],s=vf(r);let o=0;for(const c of e.sources){c.hasName()||(c.dataName=`source_${o++}`);const l=c.assemble();s(c,l)}for(const c of r)c.transform.length===0&&delete c.transform;let a=0;for(const[c,l]of r.entries())((n=l.transform)!==null&&n!==void 0?n:[]).length===0&&!l.source&&r.splice(a++,0,r.splice(c,1)[0]);for(const c of r)for(const l of(i=c.transform)!==null&&i!==void 0?i:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const c of r)c.name in t&&(c.values=t[c.name]);return r}function qv(e){return e==="top"||e==="left"||w(e)?"header":"footer"}function Gv(e){for(const t of we)Vv(e,t);xf(e,"x"),xf(e,"y")}function Vv(e,t){var n;const{facet:i,config:r,child:s,component:o}=e;if(e.channelHasField(t)){const a=i[t],c=Nn("title",null,r,t);let l=xn(a,r,{allowDisabling:!0,includeDefault:c===void 0||!!c});s.component.layoutHeaders[t].title&&(l=j(l)?l.join(", "):l,l+=` / ${s.component.layoutHeaders[t].title}`,s.component.layoutHeaders[t].title=null);const u=Nn("labelOrient",a.header,r,t),f=a.header!==null?Q((n=a.header)===null||n===void 0?void 0:n.labels,r.header.labels,!0):!1,d=z(["bottom","right"],u)?"footer":"header";o.layoutHeaders[t]={title:a.header!==null?l:null,facetFieldDef:a,[d]:t==="facet"?[]:[Of(e,t,f)]}}}function Of(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function xf(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:s}=e.component;if(s.axis[t]=_o(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=r[o];for(const c of i.component.axes[t]){const l=qv(c.get("orient"));(n=a[l])!==null&&n!==void 0||(a[l]=[Of(e,o,!1)]);const u=ui(c,"main",e.config,{header:!0});u&&a[l][0].axes.push(u),c.mainExtracted=!0}}}}function Xv(e){Do(e),Fr(e,"width"),Fr(e,"height")}function Yv(e){Do(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";Fr(e,t),Fr(e,n)}function Do(e){for(const t of e.children)t.parseLayoutSize()}function Fr(e,t){var n;const i=Pu(t),r=Pi(i),s=e.component.resolve,o=e.component.layoutSize;let a;for(const c of e.children){const l=c.component.layoutSize.getWithExplicit(i),u=(n=s.scale[r])!==null&&n!==void 0?n:Au(r,e);if(u==="independent"&&l.value==="step"){a=void 0;break}if(a){if(u==="independent"&&a.value!==l.value){a=void 0;break}a=Nt(a,l,i,"")}else a=l}if(a){for(const c of e.children)e.renameSignal(c.getName(i),e.getName(t)),c.component.layoutSize.set(i,"merged",!1);o.setWithExplicit(t,a)}else o.setWithExplicit(t,{explicit:!1,value:void 0})}function Kv(e){const{size:t,component:n}=e;for(const i of qe){const r=pe(i);if(t[r]){const s=t[r];n.layoutSize.set(r,Qe(s)?"step":s,!0)}else{const s=Qv(e,r);n.layoutSize.set(r,s,!1)}}}function Qv(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const s=r.get("type"),o=r.get("range");if(te(s)){const a=ar(i.view,t);return $t(o)||Qe(a)?"step":a}else return Qs(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return Qs(i.view,t);{const s=ar(i.view,t);return Qe(s)?s.step:s}}}function Uo(e,t,n){return _(t,Object.assign({suffix:`by_${_(e)}`},n??{}))}class bi extends yf{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve);this.child=Go(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!ti(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=v(t),i={};for(const r of n){if(![tt,nt].includes(r)){O(Ii(r,"facet"));break}const s=t[r];if(s.field===void 0){O(ss(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(t,n){const i=Is(t,n);return i.header?i.header=me(i.header):i.header===null&&(i.header=null),i}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=Nr(this),this.child.parseData()}parseLayoutSize(){Do(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),Gv(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,i;const r={};for(const s of we)for(const o of Oo){const a=this.component.layoutHeaders[s],c=a[o],{facetFieldDef:l}=a;if(l){const u=Nn("titleOrient",l.header,this.config,s);if(["right","bottom"].includes(u)){const f=br(s,u);(t=r.titleAnchor)!==null&&t!==void 0||(r.titleAnchor={}),r.titleAnchor[f]="end"}}if(c==null?void 0:c[0]){const u=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(u)&&((n=r[f])!==null&&n!==void 0||(r[f]={}),r[f][s]=.5),a.title&&((i=r.offset)!==null&&i!==void 0||(r.offset={}),r.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),i?{columns:i}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof bi)return;{const t=this.getName("column_domain");return{signal:`length(data('${t}'))`}}}assembleGroupStyle(){return}assembleGroup(t){return this.parent&&this.parent instanceof bi?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:_(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof bi){if(this.child.channelHasField("column")){const r=_(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of qe){const s=this.child.component.scales[r];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(te(o)&&$t(a)){const c=xr(this.child,r),l=zo(c);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):O(rs(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),c=[];for(const u of we){const f=this.facet[u];if(f){c.push(_(f));const{bin:d,sort:g}=f;if(W(d)&&c.push(_(f,{binSuffix:"end"})),Xe(g)){const{field:p,op:m=Hi}=g,h=Uo(f,g);i&&r?(s.push(h),o.push("max"),a.push(h)):(s.push(p),o.push(m),a.push(h))}else if(j(g)){const p=Fn(f,u);s.push(p),o.push("max"),a.push(p)}}}const l=!!i&&!!r;return Object.assign({name:t,data:n,groupby:c},l||s.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),s.length?{fields:s,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:n}=this,i=n[t];return i?Xe(i.sort)?[Uo(i,i.sort,{expr:"datum"})]:j(i.sort)?[Fn(i,t,{expr:"datum"})]:[_(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i,s=(Xe(r)?r.order:!j(r)&&r)||"ascending";return[s]}return[]}assembleLabelTitle(){var t;const{facet:n,config:i}=this;if(n.facet)return xo(n.facet,"facet",i);const r={row:["top","bottom"],column:["left","right"]};for(const s of vo)if(n[s]){const o=Nn("labelOrient",(t=n[s])===null||t===void 0?void 0:t.header,i,s);if(r[s].includes(o))return xo(n[s],s,i)}return}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=Bv(n),r=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle(),a=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},s?{title:s}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:we.map(c=>this.facetSortFields(c)).flat(),order:we.map(c=>this.facetSortOrder(c)).flat()}}),i.length>0?{data:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(eb(this,[])));return[a]}getMapping(){return this.facet}}function Zv(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const s of[n,i])if(Xe(s.sort)){const{field:o,op:a=Hi}=s.sort;e=r=new nn(e,{joinaggregate:[{op:a,field:o,as:Uo(s,s.sort,{forAs:!0})}],groupby:[_(s)]})}return r}return null}function Sf(e,t){var n,i,r,s;for(const o of t){const a=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const c=(n=e.format)===null||n===void 0?void 0:n.mesh,l=(i=a.format)===null||i===void 0?void 0:i.feature;if(c&&l)continue;const u=(r=e.format)===null||r===void 0?void 0:r.feature;if((u||l)&&u!==l)continue;const f=(s=a.format)===null||s===void 0?void 0:s.mesh;if((c||f)&&c!==f)continue;if(si(e)&&si(a)){if(Me(e.values,a.values))return o}else if(wn(e)&&wn(a)){if(e.url===a.url)return o}else if(Wl(e)&&e.name===o.dataName)return o}return null}function Jv(e,t){if(e.data||!e.parent){if(e.data===null){const i=new en({values:[]});return t.push(i),i}const n=Sf(e.data,t);if(n)return Pt(e.data)||(n.data.format=sa({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new en(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function eO(e,t,n){var i,r;let s=0;for(const o of t.transforms){let a,c;if(Ah(o))c=e=new Cn(e,o),a="derived";else if(no(o)){const l=My(o);c=e=(i=ae.makeWithAncestors(e,{},l,n))!==null&&i!==void 0?i:e,e=new kn(e,t,o.filter)}else if(Al(o))c=e=et.makeFromTransform(e,o,t),a="number";else if(Ih(o)){a="date";const l=n.getWithExplicit(o.field);l.value===void 0&&(e=new ae(e,{[o.field]:a}),n.set(o.field,a,!1)),c=e=Je.makeFromTransform(e,o)}else if(Rh(o))c=e=Ie.makeFromTransform(e,o),a="number",po(t)&&(e=new zt(e));else if(Tl(o))c=e=hi.make(e,t,o,s++),a="derived";else if(Nh(o))c=e=new Tn(e,o),a="number";else if(Ph(o))c=e=new nn(e,o),a="number";else if(Lh(o))c=e=mt.makeFromTransform(e,o),a="derived";else if(Mh(o))c=e=new jr(e,o),a="derived";else if(Th(o))c=e=new _r(e,o),a="derived";else if(wh(o))c=e=new kr(e,o),a="derived";else if(Fh(o))e=new Cr(e,o);else if(zh(o))c=e=rn.makeFromTransform(e,o),a="derived";else if($h(o))c=e=new Sr(e,o),a="derived";else if(Eh(o))c=e=new $r(e,o),a="derived";else if(kh(o))c=e=new Er(e,o),a="derived";else if(Ch(o))c=e=new wr(e,o),a="derived";else{O(rg(o));continue}if(c&&a!==void 0)for(const l of(r=c.producedFields())!==null&&r!==void 0?r:[])n.set(l,a,!1)}return e}function Nr(e){var t,n,i,r,s,o,a,c,l,u;let f=Jv(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:g}=e.component.data,p=e.data,m=p&&(Pt(p)||wn(p)||si(p)),h=!m&&e.parent?e.parent.component.data.ancestorParse.clone():new Qh;Pt(p)?(Bl(p)?f=new di(f,p.sequence):so(p)&&(f=new fi(f,p.graticule)),h.parseNothing=!0):((t=p==null?void 0:p.format)===null||t===void 0?void 0:t.parse)===null&&(h.parseNothing=!0),f=(n=ae.makeExplicit(f,e,h))!==null&&n!==void 0?n:f,f=new zt(f);const b=e.parent&&An(e.parent);(Y(e)||Le(e))&&(b&&(f=(i=et.makeFromEncoding(f,e))!==null&&i!==void 0?i:f)),e.transforms.length>0&&(f=eO(f,e,h));const y=Uy(e),x=Dy(e);f=(r=ae.makeWithAncestors(f,{},Object.assign(Object.assign({},y),x),h))!==null&&r!==void 0?r:f,Y(e)&&(f=zn.parseAll(f,e),f=mi.parseAll(f,e)),(Y(e)||Le(e))&&(b||(f=(s=et.makeFromEncoding(f,e))!==null&&s!==void 0?s:f),f=(o=Je.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=Cn.parseAllForSortIndex(f,e));const k=e.getDataName(B.Raw),$=new ue(f,k,B.Raw,g);if(d[k]=$,f=$,Y(e)){const X=Ie.makeFromEncoding(f,e);X&&(f=X,po(e)&&(f=new zt(f))),f=(a=rn.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=(c=mt.makeFromEncoding(f,e))!==null&&c!==void 0?c:f}Y(e)&&(f=(l=pi.make(f,e))!==null&&l!==void 0?l:f);const N=e.getDataName(B.Main),E=new ue(f,N,B.Main,g);d[N]=E,f=E,Y(e)&&zb(e,E);let T=null;if(Le(e)){const X=e.getName("facet");f=(u=Zv(f,e.facet))!==null&&u!==void 0?u:f,T=new Pn(f,e,X,E.getSource()),d[X]=T}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:g,raw:$,main:E,facetRoot:T,ancestorParse:h})}class tO extends Mo{constructor(t,n,i,r){var s,o,a,c;super(t,"concat",n,i,r,t.resolve);(((o=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||o===void 0?void 0:o.x)==="shared"||((c=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||c===void 0?void 0:c.y)==="shared")&&O(tg),this.children=this.getChildren(t).map((l,u)=>Go(l,this,this.getName(`concat_${u}`),void 0,r))}parseData(){this.component.data=Nr(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of v(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return sr(t)?t.vconcat:Ks(t)?t.hconcat:t.concat}parseLayoutSize(){Yv(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=So(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),i?{style:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup())})}assembleGroupStyle(){return}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function nO(e){return e===!1||e===null}const iO=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},qc),{labelExpr:1,encode:1}),_f=v(iO);class Wo extends gt{constructor(t={},n={},i=!1){super();this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new Wo(C(this.explicit),C(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!nO(this.get(t))}hasOrientSignalRef(){return w(this.explicit.orient)}}function rO(e,t,n){var i;const{encoding:r,config:s}=e,o=(i=Z(r[t]))!==null&&i!==void 0?i:Z(r[He(t)]),a=e.axis(t)||{},{format:c,formatType:l}=a;if(Xt(l))return Object.assign({text:Te({fieldOrDatumDef:o,field:"datum.value",format:c,formatType:l,config:s})},n);if(c===void 0&&l===void 0&&s.customFormatTypes){if(vn(o)==="quantitative"){if(On(o)&&o.stack==="normalize"&&s.normalizedNumberFormatType)return Object.assign({text:Te({fieldOrDatumDef:o,field:"datum.value",format:s.normalizedNumberFormat,formatType:s.normalizedNumberFormatType,config:s})},n);if(s.numberFormatType)return Object.assign({text:Te({fieldOrDatumDef:o,field:"datum.value",format:s.numberFormat,formatType:s.numberFormatType,config:s})},n)}if(vn(o)==="temporal"&&s.timeFormatType&&S(o)&&!o.timeUnit)return Object.assign({text:Te({fieldOrDatumDef:o,field:"datum.value",format:s.timeFormat,formatType:s.timeFormatType,config:s})},n)}return n}function sO(e){return qe.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[dO(n,e)]),t),{})}const oO={bottom:"top",top:"bottom",left:"right",right:"left"};function aO(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of v(s.component.axes))i.axis[o]=_o(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=cO(n[o],s.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const s of qe){for(const o of e.children){if(!o.component.axes[s])continue;if(i.axis[s]==="independent"){n[s]=((t=n[s])!==null&&t!==void 0?t:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:c,explicit:l}=a.getWithExplicit("orient");if(w(c))continue;if(r[c]>0&&!l){const u=oO[c];r[c]>r[u]&&a.set("orient",u,!1)}r[c]++}}delete o.component.axes[s]}if(i.axis[s]==="independent"&&n[s]&&n[s].length>1)for(const o of n[s])!!o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function cO(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t[i];if(!!r!==!!s)return;if(r&&s){const o=r.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[i]=lO(r,s)}}}else return t.map(n=>n.clone());return e}function lO(e,t){for(const n of _f){const i=Nt(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return Ra(r,s);case"gridScale":return{explicit:r.explicit,value:Q(r.value,s.value)}}return lr(r,s,n,"axis")});e.setWithExplicit(n,i)}return e}function uO(e,t,n,i,r){if(t==="disable")return n!==void 0;n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(w(n.labelAngle)?n.labelAngle:qn(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===$u(i,r))return!0}return e===n[t]}const fO=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function dO(e,t){var n,i,r;let s=t.axis(e);const o=new Wo,a=Z(t.encoding[e]),{mark:c,config:l}=t,u=(s==null?void 0:s.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=l.axis)===null||i===void 0?void 0:i.orient)||qb(e),f=t.getScaleComponent(e).get("type"),d=Lb(e,f,u,t.config),g=s!==void 0?!s:bo("disable",l.style,s==null?void 0:s.style,d).configValue;if(o.set("disable",g,s!==void 0),g)return o;s=s||{};const p=Wb(a,s,e,l.style,d),m={fieldOrDatumDef:a,axis:s,channel:e,model:t,scaleType:f,orient:u,labelAngle:p,mark:c,config:l};for(const y of _f){const x=y in _u?_u[y](m):Gc(y)?s[y]:void 0,k=x!==void 0,$=uO(x,y,s,t,e);if(k&&$)o.set(y,x,$);else{const{configValue:N=void 0,configFrom:E=void 0}=Gc(y)&&y!=="values"?bo(y,l.style,s.style,d):{},T=N!==void 0;k&&!T?o.set(y,x,$):(!(E==="vgAxisConfig")||fO.has(y)&&T||ri(N)||w(N))&&o.set(y,N,!1)}}const h=(r=s.encoding)!==null&&r!==void 0?r:{},b=Hc.reduce((y,x)=>{var k;if(!o.hasAxisPart(x))return y;const $=Tu((k=h[x])!==null&&k!==void 0?k:{},t),N=x==="labels"?rO(t,e,$):$;return N!==void 0&&!L(N)&&(y[x]={update:N}),y},{});return L(b)||o.set("encode",b,!!s.encoding||s.labelAngle!==void 0),o}function gO({encoding:e,size:t}){for(const n of qe){const i=pe(n);Qe(t[i])&&(kt(e[n])&&(delete t[i],O(Ya(i))))}return t}function pO(e,t,n){const i=me(e),r=R("orient",i,n);if(i.orient=yO(i.type,t,r),r!==void 0&&r!==i.orient&&O(Sg(i.orient,r)),i.type==="bar"&&i.orient){const a=R("cornerRadiusEnd",i,n);if(a!==void 0){const c=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:Up[i.orient];for(const l of c)i[l]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}const s=R("opacity",i,n);s===void 0&&(i.opacity=hO(i.type,t));const o=R("cursor",i,n);return o===void 0&&(i.cursor=mO(i,t,n)),i}function mO(e,t,n){return t.href||e.href||R("href",e,n)?"pointer":e.cursor}function hO(e,t){return z([Ui,_s,js,ws],e)&&!Ls(t)?.7:void 0}function bO(e,t,{graticule:n}){if(n)return!1;const i=Bt("filled",e,t),r=e.type;return Q(i,r!==Ui&&r!==Di&&r!==Wi)}function yO(e,t,n){switch(e){case Ui:case js:case ws:case hc:case Np:case Fp:return}const{x:i,y:r,x2:s,y2:o}=t;switch(e){case Mi:if(S(i)&&(re(i.bin)||S(r)&&r.aggregate&&!i.aggregate))return"vertical";if(S(r)&&(re(r.bin)||S(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s)return(S(i)&&i.type===qt&&!W(i.bin)||Xi(i))&&(S(r)&&re(r.bin))?"horizontal":"vertical";if(!o)return(S(r)&&r.type===qt&&!W(r.bin)||Xi(r))&&(S(i)&&re(i.bin))?"vertical":"horizontal"}case Wi:if(s&&!(S(i)&&re(i.bin))&&o&&!(S(r)&&re(r.bin)))return;case Li:if(o)return S(r)&&re(r.bin)?"horizontal":"vertical";if(s)return S(i)&&re(i.bin)?"vertical":"horizontal";if(e===Wi){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case Di:case _s:{const a=zc(i),c=zc(r);if(n)return n;if(a&&!c)return e!=="tick"?"horizontal":"vertical";if(!a&&c)return e!=="tick"?"vertical":"horizontal";if(a&&c)return"vertical";{const l=le(i)&&i.type===hn,u=le(r)&&r.type===hn;if(l&&!u)return"vertical";if(!l&&u)return"horizontal"}return}}return"vertical"}const vO={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),oe("x",e,{defaultPos:"mid"})),oe("y",e,{defaultPos:"mid"})),Tt(e,"radius")),Tt(e,"theta"))},OO={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),fr("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),fr("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),fo(e))},xO={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Tt(e,"x")),Tt(e,"y"))},SO={vgMark:"shape",encodeEntry:e=>Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape,i=Object.assign({type:"geoshape",projection:e.projectionName()},n&&S(n)&&n.type===bn?{field:_(n,{expr:"datum"})}:{});return[i]}},_O={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),Tt(e,"x")),Tt(e,"y")),lo(e,"url"))},jO={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),oe("x",e,{defaultPos:"mid"})),oe("y",e,{defaultPos:"mid"})),ne("size",e,{vgChannel:"strokeWidth"})),fo(e))},wO={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),oe("x",e,{defaultPos:"mid"})),oe("y",e,{defaultPos:"mid"})),ne("size",e)),fo(e))};function Bo(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),oe("x",e,{defaultPos:"mid"})),oe("y",e,{defaultPos:"mid"})),ne("size",e)),ne("angle",e)),$O(e,n,t))}function $O(e,t,n){return n?{shape:{value:n}}:ne("shape",e)}const EO={vgMark:"symbol",encodeEntry:e=>Bo(e)},kO={vgMark:"symbol",encodeEntry:e=>Bo(e,"circle")},CO={vgMark:"symbol",encodeEntry:e=>Bo(e,"square")},FO={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Tt(e,"x")),Tt(e,"y"))},NO={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),fr("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),fr("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),ne("size",e,{vgChannel:"strokeWidth"}))}},PO={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),oe("x",e,{defaultPos:"mid"})),oe("y",e,{defaultPos:"mid"})),lo(e)),ne("size",e,{vgChannel:"fontSize"})),ne("angle",e)),ru("align",TO(e.markDef,n,t))),ru("baseline",AO(e.markDef,n,t))),oe("radius",e,{defaultPos:null})),oe("theta",e,{defaultPos:null}))}};function TO(e,t,n){const i=R("align",e,n);return i===void 0?"center":void 0}function AO(e,t,n){const i=R("baseline",e,n);return i===void 0?"middle":void 0}const zO={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",s=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$e(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),oe("x",e,{defaultPos:"mid",vgChannel:"xc"})),oe("y",e,{defaultPos:"mid",vgChannel:"yc"})),ne("size",e,{defaultValue:IO(e),vgChannel:r})),{[s]:H(R("thickness",n,t))})}};function IO(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,s=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),a=(t=R("size",i,n,{vgChannel:s}))!==null&&t!==void 0?t:n.tick.bandSize;if(a!==void 0)return a;{const c=o?o.get("range"):void 0;if(c&&$t(c)&&K(c.step))return c.step*3/4;const l=or(n.view,s);return l*3/4}}const Pr={arc:vO,area:OO,bar:xO,circle:kO,geoshape:SO,image:_O,line:jO,point:EO,rect:FO,rule:NO,square:CO,text:PO,tick:zO,trail:wO};function RO(e){if(z([Di,Li,Pp],e.mark)){const t=Kc(e.mark,e.encoding);if(t.length>0)return LO(e,t)}else if(e.mark===Mi){const t=ts.some(n=>R(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return MO(e)}return Ho(e)}const jf="faceted_path_";function LO(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:jf+e.requestDataName(B.Main),data:e.requestDataName(B.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:Ho(e,{fromPrefix:jf})}]}const wf="stack_group_";function MO(e){var t;const[n]=Ho(e,{fromPrefix:wf}),i=e.scaleName(e.stack.fieldChannel),r=(u={})=>e.vgField(e.stack.fieldChannel,u),s=(u,f)=>{const d=[r({prefix:"min",suffix:"start",expr:f}),r({prefix:"max",suffix:"start",expr:f}),r({prefix:"min",suffix:"end",expr:f}),r({prefix:"max",suffix:"end",expr:f})];return`${u}(${d.map(g=>`scale('${i}',${g})`).join(",")})`};let o,a;e.stack.fieldChannel==="x"?(o=Object.assign(Object.assign({},un(n.encode.update,["y","yc","y2","height",...ts])),{x:{signal:s("min","datum")},x2:{signal:s("max","datum")},clip:{value:!0}}),a={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},n.encode.update=Object.assign(Object.assign({},fe(n.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},un(n.encode.update,["x","xc","x2","width"])),{y:{signal:s("min","datum")},y2:{signal:s("max","datum")},clip:{value:!0}}),a={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},n.encode.update=Object.assign(Object.assign({},fe(n.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const u of ts){const f=Bt(u,e.markDef,e.config);n.encode.update[u]?(o[u]=n.encode.update[u],delete n.encode.update[u]):f&&(o[u]=H(f)),f&&(n.encode.update[u]={value:0})}const c=[];if(((t=e.stack.groupbyChannels)===null||t===void 0?void 0:t.length)>0)for(const u of e.stack.groupbyChannels){const f=e.fieldDef(u),d=_(f);d&&c.push(d),((f==null?void 0:f.bin)||(f==null?void 0:f.timeUnit))&&c.push(_(f,{binSuffix:"end"}))}const l=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return o=l.reduce((u,f)=>{if(n.encode.update[f])return Object.assign(Object.assign({},u),{[f]:n.encode.update[f]});{const d=Bt(f,e.markDef,e.config);return d!==void 0?Object.assign(Object.assign({},u),{[f]:H(d)}):u}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(B.Main),name:wf+e.requestDataName(B.Main),groupby:c,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:a},marks:[n]}]}]}function DO(e){var t;const{encoding:n,stack:i,mark:r,markDef:s,config:o}=e,a=n.order;if(!j(a)&&Ae(a)&&Dr(a.value)||!a&&Dr(R("order",s,o)))return;if((j(a)||S(a))&&!i)return Aa(a,{expr:"datum"});if(Et(r)){const c=s.orient==="horizontal"?"y":"x",l=n[c];if(S(l)){const u=l.sort;if(j(u))return{field:_(l,{prefix:c,suffix:"sort_index",expr:"datum"})};if(Xe(u))return{field:_({aggregate:Ls(e.encoding)?u.op:void 0,field:u.field},{expr:"datum"})};if(Cc(u)){const f=e.fieldDef(u.encoding);return{field:_(f,{expr:"datum"}),order:u.order}}else return u===null?void 0:{field:_(l,{binSuffix:((t=e.stack)===null||t===void 0?void 0:t.impute)?"mid":void 0,expr:"datum"})}}return}return}function Ho(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=e,o=Q(i.clip,UO(e),WO(e)),a=Pa(i),c=r.key,l=DO(e),u=BO(e),f=R("aria",i,s),d=Pr[n].postEncodingTransform?Pr[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:Pr[n].vgMark},o?{clip:!0}:{}),a?{style:a}:{}),c?{key:c.field}:{}),l?{sort:l}:{}),u||{}),f===!1?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(B.Main)},encode:{update:Pr[n].encodeEntry(e)}}),d?{transform:d}:{})]}function UO(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return(t==null?void 0:t.get("selectionExtent"))||(n==null?void 0:n.get("selectionExtent"))?!0:void 0}function WO(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function BO(e){if(!e.component.selection)return null;const t=v(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=v(i.component.selection).length,i=i.parent;return n?{interactive:t>0||e.mark==="geoshape"||!!e.encoding.tooltip}:null}class $f extends yf{constructor(t,n,i,r={},s){var o;super(t,"unit",n,i,s,void 0,hl(t)?t.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const a=Ve(t.mark)?Object.assign({},t.mark):{type:t.mark},c=a.type;a.filled===void 0&&(a.filled=bO(a,s,{graticule:t.data&&so(t.data)}));const l=this.encoding=ym(t.encoding||{},c,a.filled,s);this.markDef=pO(a,l,s),this.size=gO({encoding:l,size:hl(t)?Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):r}),this.stack=jl(this.markDef,l),this.specifiedScales=this.initScales(c,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegends(l),this.specifiedProjection=t.projection,this.selection=((o=t.params)!==null&&o!==void 0?o:[]).filter(u=>Xs(u))}get hasProjection(){const{encoding:t}=this,n=this.mark===bc,i=t&&pd.some(r=>F(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return Ti.reduce((i,r)=>{var s;const o=Z(n[r]);return o&&(i[r]=this.initScale((s=o.scale)!==null&&s!==void 0?s:{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=me(t);return j(n)&&(r.domain=n.map(ye)),j(i)&&(r.range=i.map(ye)),r}initAxes(t){return qe.reduce((n,i)=>{const r=t[i];if(F(r)||i===G&&F(t.x2)||i===J&&F(t.y2)){const s=F(r)?r.axis:void 0;n[i]=s&&this.initAxis(Object.assign({},s))}return n},{})}initAxis(t){const n=v(t),i={};for(const r of n){const s=t[r];i[r]=ri(s)?Ca(s):ye(s)}return i}initLegends(t){return jd.reduce((n,i)=>{const r=Z(t[i]);if(r&&$d(i)){const s=r.legend;n[i]=s&&me(s)}return n},{})}parseData(){this.component.data=Nr(this)}parseLayoutSize(){Kv(this)}parseSelections(){this.component.selection=Ab(this,this.selection)}parseMarkGroup(){this.component.mark=RO(this)}parseAxesAndHeaders(){this.component.axes=sO(this)}assembleSelectionTopLevelSignals(t){return tb(this,t)}assembleSignals(){return[...xu(this),...Jh(this,[])]}assembleSelectionData(t){return nb(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return So(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!An(this.parent))&&(n=Gl(this,n)),n.map(this.correctDataNames)}assembleGroupStyle(){const{style:t}=this.view||{};return t!==void 0?t:this.encoding.x||this.encoding.y?"cell":"view"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Kt(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return Ke(n)}typedFieldDef(t){const n=this.fieldDef(t);return le(n)?n:null}}class qo extends Mo{constructor(t,n,i,r,s){super(t,"layer",n,i,s,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((a,c)=>{if(cr(a))return new qo(a,this,this.getName(`layer_${c}`),o,s);if(ft(a))return new $f(a,this,this.getName(`layer_${c}`),o,s);throw new Error(is(a))})}parseData(){this.component.data=Nr(this);for(const t of this.children)t.parseData()}parseLayoutSize(){Xv(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of v(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){aO(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),xu(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),So(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleGroupStyle(){const t=new Set;for(const i of this.children)for(const r of V(i.assembleGroupStyle()))t.add(r);const n=Array.from(t);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t;return}assembleLayout(){return null}assembleMarks(){return ib(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),Hu(this))}}function Go(e,t,n,i,r){if(qi(e))return new bi(e,t,n,r);if(cr(e))return new qo(e,t,n,i,r);if(ft(e))return new $f(e,t,n,i,r);if(Bm(e))return new tO(e,t,n,r);throw new Error(is(e))}var HO=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function qO(e,t={}){t.logger&&Vg(t.logger),t.fieldTitle&&Dc(t.fieldTitle);try{const n=Sl(na(t.config,e.config)),i=Ll(e,n),r=Go(i,null,"",void 0,n);r.parse(),iv(r.component.data,r);const s=VO(r,GO(e,i.autosize,n,r),e.datasets,e.usermeta);return{spec:s,normalized:i}}finally{t.logger&&Xg(),t.fieldTitle&&cm()}}function GO(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):P(t)&&(t={type:t}),r&&s&&Xh(t.type)){if(r==="step"&&s==="step")O(Da()),t.type="pad";else if(r==="step"||s==="step"){const o=r==="step"?"width":"height";O(Da(Pi(o)));const a=o==="width"?"height":"width";t.type=Yh(a)}}return Object.assign(Object.assign(Object.assign({},v(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),Dl(n,!1)),Dl(e,!0))}function VO(e,t,n={},i){const r=e.config?rh(e.config):void 0,s=[].concat(e.assembleSelectionData([]),Hv(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),c=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let u=e.assembleLayoutSignals();u=u.filter(g=>(g.name==="width"||g.name==="height")&&g.value!==void 0?(t[g.name]=+g.value,!1):!0);const{params:f}=t,d=HO(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),a?{title:a}:{}),c?{style:c}:{}),l?{encode:{update:l}}:{}),{data:s}),o.length>0?{projections:o}:{}),e.assembleGroup([...u,...e.assembleSelectionTopLevelSignals([]),...pl(f)])),r?{config:r}:{}),i?{usermeta:i}:{})}const XO=cd.version;export{fn as accessPathDepth,qr as accessPathWithDatum,qO as compile,z as contains,Me as deepEqual,wi as deleteNestedProperty,C as duplicate,bt as entries,Ur as every,Hr as fieldIntersection,aa as flatAccessWithDatum,Q as getFirstDefined,Wr as hasIntersection,I as hash,ua as internalField,Wn as isBoolean,L as isEmpty,ud as isEqual,fa as isInternalField,Dr as isNullOrFalse,$i as isNumeric,v as keys,Bn as logicalExpr,sa as mergeDeep,ra as never,Ll as normalize,qn as normalizeAngle,fe as omit,un as pick,Br as prefixGenerator,Gr as removePathFromField,Lt as replaceAll,Se as replacePathInField,dd as resetIdCounter,oa as setEqual,Rt as some,U as stringify,Hn as titleCase,De as unique,la as uniqueId,ie as vals,q as varName,XO as version};export default null;
