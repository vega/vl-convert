import{canvas as F}from"/-/vega-canvas@v1.2.7-hCEcvULuKIOqBVGX1Tn8/dist=es2020,mode=imports,min/optimized/vega-canvas.js";import{Transform as A}from"/-/vega-dataflow@v5.7.6-WDoszrJUyhTwz7sPwzda/dist=es2020,mode=imports,min/optimized/vega-dataflow.js";import{inherits as H,error as J,isFunction as P,constant as K,extent as Y}from"/-/vega-util@v1.17.2-LUfkDhormMyfWqy3Ts6U/dist=es2020,mode=imports,min/optimized/vega-util.js";import{scale as Z}from"/-/vega-scale@v7.4.1-M0T9Gn9zHGGuV6XhZsTO/dist=es2020,mode=imports,min/optimized/vega-scale.js";import{random as $}from"/-/vega-statistics@v1.9.0-Qw8CjSQVQOg2M6VMgsme/dist=es2020,mode=imports,min/optimized/vega-statistics.js";var E=Math.PI/180,D=1<<11>>5,q=1<<11;function _(){var e=[256,256],t,o,m,s,x,a,h,p=Q,v=[],f=Math.random,i={};i.layout=function(){for(var r=l(F()),n=at((e[0]>>5)*e[1]),u=null,b=v.length,z=-1,S=[],w=v.map(c=>({text:t(c),font:o(c),style:s(c),weight:x(c),rotate:a(c),size:~~(m(c)+1e-14),padding:h(c),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:c})).sort((c,d)=>d.size-c.size);++z<b;){var y=w[z];y.x=e[0]*(f()+.5)>>1,y.y=e[1]*(f()+.5)>>1,tt(r,y,w,z),y.hasText&&g(n,y,u)&&(S.push(y),u?rt(u,y):u=[{x:y.x+y.x0,y:y.y+y.y0},{x:y.x+y.x1,y:y.y+y.y1}],y.x-=e[0]>>1,y.y-=e[1]>>1)}return S};function l(r){r.width=r.height=1;var n=Math.sqrt(r.getContext("2d").getImageData(0,0,1,1).data.length>>2);r.width=(D<<5)/n,r.height=q/n;var u=r.getContext("2d");return u.fillStyle=u.strokeStyle="red",u.textAlign="center",{context:u,ratio:n}}function g(r,n,u){for(var b=n.x,z=n.y,S=Math.hypot(e[0],e[1]),w=p(e),y=f()<.5?1:-1,c=-y,d,T,W;(d=w(c+=y))&&!(T=~~d[0],W=~~d[1],Math.min(Math.abs(T),Math.abs(W))>=S);){if(n.x=b+T,n.y=z+W,n.x+n.x0<0||n.y+n.y0<0||n.x+n.x1>e[0]||n.y+n.y1>e[1])continue;if((!u||!et(n,r,e[0]))&&(!u||nt(n,u))){for(var C=n.sprite,R=n.width>>5,I=e[0]>>5,N=n.x-(R<<4),V=N&127,B=32-V,L=n.y1-n.y0,j=(n.y+n.y0)*I+(N>>5),O,U=0;U<L;U++){O=0;for(var k=0;k<=R;k++)r[j+k]|=O<<B|(k<R?(O=C[U*R+k])>>>V:0);j+=I}return n.sprite=null,!0}}return!1}return i.words=function(r){return arguments.length?(v=r,i):v},i.size=function(r){return arguments.length?(e=[+r[0],+r[1]],i):e},i.font=function(r){return arguments.length?(o=M(r),i):o},i.fontStyle=function(r){return arguments.length?(s=M(r),i):s},i.fontWeight=function(r){return arguments.length?(x=M(r),i):x},i.rotate=function(r){return arguments.length?(a=M(r),i):a},i.text=function(r){return arguments.length?(t=M(r),i):t},i.spiral=function(r){return arguments.length?(p=ot[r]||r,i):p},i.fontSize=function(r){return arguments.length?(m=M(r),i):m},i.padding=function(r){return arguments.length?(h=M(r),i):h},i.random=function(r){return arguments.length?(f=r,i):f},i}function tt(e,t,o,m){if(t.sprite)return;var s=e.context,x=e.ratio;s.clearRect(0,0,(D<<5)/x,q/x);var a=0,h=0,p=0,v=o.length,f,i,l,g,r;for(--m;++m<v;){if(t=o[m],s.save(),s.font=t.style+" "+t.weight+" "+~~((t.size+1)/x)+"px "+t.font,f=s.measureText(t.text+"m").width*x,l=t.size<<1,t.rotate){var n=Math.sin(t.rotate*E),u=Math.cos(t.rotate*E),b=f*u,z=f*n,S=l*u,w=l*n;f=Math.max(Math.abs(b+w),Math.abs(b-w))+31>>5<<5,l=~~Math.max(Math.abs(z+S),Math.abs(z-S))}else f=f+31>>5<<5;if(l>p&&(p=l),a+f>=D<<5&&(a=0,h+=p,p=0),h+l>=q)break;s.translate((a+(f>>1))/x,(h+(l>>1))/x),t.rotate&&s.rotate(t.rotate*E),s.fillText(t.text,0,0),t.padding&&(s.lineWidth=2*t.padding,s.strokeText(t.text,0,0)),s.restore(),t.width=f,t.height=l,t.xoff=a,t.yoff=h,t.x1=f>>1,t.y1=l>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,a+=f}for(var y=s.getImageData(0,0,(D<<5)/x,q/x).data,c=[];--m>=0;){if(t=o[m],!t.hasText)continue;for(f=t.width,i=f>>5,l=t.y1-t.y0,g=0;g<l*i;g++)c[g]=0;if(a=t.xoff,a==null)return;h=t.yoff;var d=0,T=-1;for(r=0;r<l;r++){for(g=0;g<f;g++){var W=i*r+(g>>5),C=y[(h+r)*(D<<5)+(a+g)<<2]?1<<31-g%32:0;c[W]|=C,d|=C}d?T=r:(t.y0++,l--,r--,h++)}t.y1=t.y0+T,t.sprite=c.slice(0,(t.y1-t.y0)*i)}}function et(e,t,o){o>>=5;for(var m=e.sprite,s=e.width>>5,x=e.x-(s<<4),a=x&127,h=32-a,p=e.y1-e.y0,v=(e.y+e.y0)*o+(x>>5),f,i=0;i<p;i++){f=0;for(var l=0;l<=s;l++)if((f<<h|(l<s?(f=m[i*s+l])>>>a:0))&t[v+l])return!0;v+=o}return!1}function rt(e,t){var o=e[0],m=e[1];t.x+t.x0<o.x&&(o.x=t.x+t.x0),t.y+t.y0<o.y&&(o.y=t.y+t.y0),t.x+t.x1>m.x&&(m.x=t.x+t.x1),t.y+t.y1>m.y&&(m.y=t.y+t.y1)}function nt(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function Q(e){var t=e[0]/e[1];return function(o){return[t*(o*=.1)*Math.cos(o),o*Math.sin(o)]}}function it(e){var t=4,o=t*e[0]/e[1],m=0,s=0;return function(x){var a=x<0?-1:1;switch(Math.sqrt(1+4*a*x)-a&3){case 0:m+=o;break;case 1:s+=t;break;case 2:m-=o;break;default:s-=t;break}return[m,s]}}function at(e){for(var t=[],o=-1;++o<e;)t[o]=0;return t}function M(e){return typeof e=="function"?e:function(){return e}}var ot={archimedean:Q,rectangular:it};const X=["x","y","font","fontSize","fontStyle","fontWeight","angle"],st=["text","font","rotate","fontSize","fontStyle","fontWeight"];function G(e){A.call(this,_(),e)}G.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:X}]},H(G,A,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&J("Wordcloud size dimensions must be non-zero.");function o(r){const n=e[r];return P(n)&&t.modified(n.fields)}const m=e.modified();if(!(m||t.changed(t.ADD_REM)||st.some(o)))return;const s=t.materialize(t.SOURCE).source,x=this.value,a=e.as||X;let h=e.fontSize||14,p;if(P(h)?p=e.fontSizeRange:h=K(h),p){const r=h,n=Z("sqrt")().domain(Y(s,r)).range(p);h=u=>n(r(u))}s.forEach(r=>{r[a[0]]=NaN,r[a[1]]=NaN,r[a[3]]=0});const v=x.words(s).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(h).random($).layout(),f=x.size(),i=f[0]>>1,l=f[1]>>1,g=v.length;for(let r=0,n,u;r<g;++r)n=v[r],u=n.datum,u[a[0]]=n.x+i,u[a[1]]=n.y+l,u[a[2]]=n.font,u[a[3]]=n.size,u[a[4]]=n.style,u[a[5]]=n.weight,u[a[6]]=n.rotate;return t.reflow(m).modifies(a)}});export{G as wordcloud};export default null;
