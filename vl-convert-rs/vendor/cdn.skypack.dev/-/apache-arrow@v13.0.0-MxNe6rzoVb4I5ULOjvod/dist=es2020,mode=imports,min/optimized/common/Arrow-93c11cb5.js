import{MetadataVersion as j,DateUnit as Ct,UnionMode as vt,IntervalUnit as Pe,TimeUnit as Ft,Precision as ze,MessageHeader as b,BufferType as Es}from"../apache-arrow/enum.js";import{c as js,t as T,d as ks,j as J,e as Ee,f as je,g as ke,h as Ce,a as _e,k as dt,i as Nt,p as be,l as W,n as Cs,m as w,o as $e,q as pe,r as $s,V as ht,s as Je,u as ye,B as We,v as Js,w as Ws,x as Ys,y as Hs,z as Ks,A as Gs,C as Zs,E as Qs,F as qs,G as Xs,H as ti}from"./vector-2228b801.js";import{P as Y,D,I as $t,c as Jt,G as Wt,S as Yt,L as Ye,B as He,k as Ke,l as Ge,N as Ht,O as Ze,M as Qe,m as qe,A as Xe,H as ts,T as es,u as ss,n as is,z as rs,F as ns}from"./type-9c6ae821.js";import{_ as me,R as Rt,$ as we,T as Lt,a0 as ei,a1 as si}from"./recordbatch-48e3a12e.js";import{Visitor as xt}from"../apache-arrow/visitor.js";import{Schema as k,Field as S}from"../apache-arrow/schema.js";import"./builder-7443288c.js";import{__asyncGenerator as Bt,__await as p,__awaiter as u,__asyncValues as Kt,__asyncDelegator as ii}from"/-/tslib@v2.6.2-OVagwiLDRFa7T0n3eDR1/dist=es2020,mode=imports,min/optimized/tslib.js";import{SIZE_PREFIX_LENGTH as y,Builder as os,ByteBuffer as Gt}from"/-/flatbuffers@v23.5.26-F0caiJ5Z6Iv5k5mKA9CZ/dist=es2020,mode=imports,min/optimized/flatbuffers.js";var L={fromIterable(i){return Zt(ri(i))},fromAsyncIterable(i){return Zt(ni(i))},fromDOMStream(i){return Zt(oi(i))},fromNodeStream(i){return Zt(ci(i))},toDOMStream(i,t){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(i,t){throw new Error('"toNodeStream" not available in this environment')}};const Zt=i=>(i.next(),i);function*ri(i){let t,e=!1,s=[],r,n,o,a=0;function c(){return n==="peek"?J(s,o)[0]:([r,s,a]=J(s,o),r)}({cmd:n,size:o}=yield null);const d=ks(i)[Symbol.iterator]();try{do if({done:t,value:r}=Number.isNaN(o-a)?d.next():d.next(o-a),!t&&r.byteLength>0&&(s.push(r),a+=r.byteLength),t||o<=a)do({cmd:n,size:o}=yield c());while(o<a);while(!t)}catch(h){(e=!0)&&typeof d.throw=="function"&&d.throw(h)}finally{e===!1&&typeof d.return=="function"&&d.return(null)}return null}function ni(i){return Bt(this,arguments,function*(){let e,s=!1,r=[],n,o,a,c=0;function d(){return o==="peek"?J(r,a)[0]:([n,r,c]=J(r,a),n)}({cmd:o,size:a}=yield yield p(null));const h=js(i)[Symbol.asyncIterator]();try{do if({done:e,value:n}=Number.isNaN(a-c)?yield p(h.next()):yield p(h.next(a-c)),!e&&n.byteLength>0&&(r.push(n),c+=n.byteLength),e||a<=c)do({cmd:o,size:a}=yield yield p(d()));while(a<c);while(!e)}catch(_){(s=!0)&&typeof h.throw=="function"&&(yield p(h.throw(_)))}finally{s===!1&&typeof h.return=="function"&&(yield p(h.return(new Uint8Array(0))))}return yield p(null)})}function oi(i){return Bt(this,arguments,function*(){let e=!1,s=!1,r=[],n,o,a,c=0;function d(){return o==="peek"?J(r,a)[0]:([n,r,c]=J(r,a),n)}({cmd:o,size:a}=yield yield p(null));const h=new ai(i);try{do if({done:e,value:n}=Number.isNaN(a-c)?yield p(h.read()):yield p(h.read(a-c)),!e&&n.byteLength>0&&(r.push(T(n)),c+=n.byteLength),e||a<=c)do({cmd:o,size:a}=yield yield p(d()));while(a<c);while(!e)}catch(_){(s=!0)&&(yield p(h.cancel(_)))}finally{s===!1?yield p(h.cancel()):i.locked&&h.releaseLock()}return yield p(null)})}class ai{constructor(t){this.source=t,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(t){return u(this,void 0,void 0,function*(){const{reader:e,source:s}=this;e&&(yield e.cancel(t).catch(()=>{})),s&&s.locked&&this.releaseLock()})}read(t){return u(this,void 0,void 0,function*(){if(t===0)return{done:this.reader==null,value:new Uint8Array(0)};const e=yield this.reader.read();return!e.done&&(e.value=T(e)),e})}}const ge=(i,t)=>{const e=r=>s([t,r]);let s;return[t,e,new Promise(r=>(s=r)&&i.once(t,e))]};function ci(i){return Bt(this,arguments,function*(){const e=[];let s="error",r=!1,n=null,o,a,c=0,d=[],h;function _(){return o==="peek"?J(d,a)[0]:([h,d,c]=J(d,a),h)}if({cmd:o,size:a}=yield yield p(null),i.isTTY)return yield yield p(new Uint8Array(0)),yield p(null);try{e[0]=ge(i,"end"),e[1]=ge(i,"error");do{if(e[2]=ge(i,"readable"),[s,n]=yield p(Promise.race(e.map(nt=>nt[2]))),s==="error")break;if((r=s==="end")||(Number.isFinite(a-c)?(h=T(i.read(a-c)),h.byteLength<a-c&&(h=T(i.read()))):h=T(i.read()),h.byteLength>0&&(d.push(h),c+=h.byteLength)),r||a<=c)do({cmd:o,size:a}=yield yield p(_()));while(a<c)}while(!r)}finally{yield p(U(e,s==="error"?n:null))}return yield p(null);function U(nt,ot){return h=d=null,new Promise((Ts,Ps)=>{for(const[gt,zs]of nt)i.off(gt,zs);try{const gt=i.destroy;gt&&gt.call(i,ot),ot=void 0}catch(gt){ot=gt||ot}finally{ot!=null?Ps(ot):Ts()}})}})}class ve{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(t,e,s,r){return t.prep(8,24),t.writeInt64(BigInt(r??0)),t.pad(4),t.writeInt32(s),t.writeInt64(BigInt(e??0)),t.offset()}}class v{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsKeyValue(t,e){return(e||new v).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKeyValue(t,e){return t.setPosition(t.position()+y),(e||new v).__init(t.readInt32(t.position())+t.position(),t)}key(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}value(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startKeyValue(t){t.startObject(2)}static addKey(t,e){t.addFieldOffset(0,e,0)}static addValue(t,e){t.addFieldOffset(1,e,0)}static endKeyValue(t){const e=t.endObject();return e}static createKeyValue(t,e,s){return v.startKeyValue(t),v.addKey(t,e),v.addValue(t,s),v.endKeyValue(t)}}var It;(function(i){i[i.V1=0]="V1",i[i.V2=1]="V2",i[i.V3=2]="V3",i[i.V4=3]="V4",i[i.V5=4]="V5"})(It||(It={}));var St;(function(i){i[i.Little=0]="Little",i[i.Big=1]="Big"})(St||(St={}));var Qt;(function(i){i[i.DenseArray=0]="DenseArray"})(Qt||(Qt={}));class x{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInt(t,e){return(e||new x).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInt(t,e){return t.setPosition(t.position()+y),(e||new x).__init(t.readInt32(t.position())+t.position(),t)}bitWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}isSigned(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startInt(t){t.startObject(2)}static addBitWidth(t,e){t.addFieldInt32(0,e,0)}static addIsSigned(t,e){t.addFieldInt8(1,+e,0)}static endInt(t){const e=t.endObject();return e}static createInt(t,e,s){return x.startInt(t),x.addBitWidth(t,e),x.addIsSigned(t,s),x.endInt(t)}}class it{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryEncoding(t,e){return(e||new it).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryEncoding(t,e){return t.setPosition(t.position()+y),(e||new it).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}indexType(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new x).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isOrdered(){const t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}dictionaryKind(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt16(this.bb_pos+t):Qt.DenseArray}static startDictionaryEncoding(t){t.startObject(4)}static addId(t,e){t.addFieldInt64(0,e,BigInt("0"))}static addIndexType(t,e){t.addFieldOffset(1,e,0)}static addIsOrdered(t,e){t.addFieldInt8(2,+e,0)}static addDictionaryKind(t,e){t.addFieldInt16(3,e,Qt.DenseArray)}static endDictionaryEncoding(t){const e=t.endObject();return e}}class ut{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBinary(t,e){return(e||new ut).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,e){return t.setPosition(t.position()+y),(e||new ut).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(t){t.startObject(0)}static endBinary(t){const e=t.endObject();return e}static createBinary(t){return ut.startBinary(t),ut.endBinary(t)}}class ft{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBool(t,e){return(e||new ft).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,e){return t.setPosition(t.position()+y),(e||new ft).__init(t.readInt32(t.position())+t.position(),t)}static startBool(t){t.startObject(0)}static endBool(t){const e=t.endObject();return e}static createBool(t){return ft.startBool(t),ft.endBool(t)}}var qt;(function(i){i[i.DAY=0]="DAY",i[i.MILLISECOND=1]="MILLISECOND"})(qt||(qt={}));class H{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDate(t,e){return(e||new H).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,e){return t.setPosition(t.position()+y),(e||new H).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):qt.MILLISECOND}static startDate(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,qt.MILLISECOND)}static endDate(t){const e=t.endObject();return e}static createDate(t,e){return H.startDate(t),H.addUnit(t,e),H.endDate(t)}}class N{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDecimal(t,e){return(e||new N).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,e){return t.setPosition(t.position()+y),(e||new N).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}scale(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}bitWidth(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):128}static startDecimal(t){t.startObject(3)}static addPrecision(t,e){t.addFieldInt32(0,e,0)}static addScale(t,e){t.addFieldInt32(1,e,0)}static addBitWidth(t,e){t.addFieldInt32(2,e,128)}static endDecimal(t){const e=t.endObject();return e}static createDecimal(t,e,s,r){return N.startDecimal(t),N.addPrecision(t,e),N.addScale(t,s),N.addBitWidth(t,r),N.endDecimal(t)}}var At;(function(i){i[i.SECOND=0]="SECOND",i[i.MILLISECOND=1]="MILLISECOND",i[i.MICROSECOND=2]="MICROSECOND",i[i.NANOSECOND=3]="NANOSECOND"})(At||(At={}));class K{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeBinary(t,e){return(e||new K).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,e){return t.setPosition(t.position()+y),(e||new K).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeBinary(t){t.startObject(1)}static addByteWidth(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeBinary(t){const e=t.endObject();return e}static createFixedSizeBinary(t,e){return K.startFixedSizeBinary(t),K.addByteWidth(t,e),K.endFixedSizeBinary(t)}}class G{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeList(t,e){return(e||new G).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,e){return t.setPosition(t.position()+y),(e||new G).__init(t.readInt32(t.position())+t.position(),t)}listSize(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeList(t){t.startObject(1)}static addListSize(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeList(t){const e=t.endObject();return e}static createFixedSizeList(t,e){return G.startFixedSizeList(t),G.addListSize(t,e),G.endFixedSizeList(t)}}var Xt;(function(i){i[i.HALF=0]="HALF",i[i.SINGLE=1]="SINGLE",i[i.DOUBLE=2]="DOUBLE"})(Xt||(Xt={}));class Z{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFloatingPoint(t,e){return(e||new Z).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFloatingPoint(t,e){return t.setPosition(t.position()+y),(e||new Z).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Xt.HALF}static startFloatingPoint(t){t.startObject(1)}static addPrecision(t,e){t.addFieldInt16(0,e,Xt.HALF)}static endFloatingPoint(t){const e=t.endObject();return e}static createFloatingPoint(t,e){return Z.startFloatingPoint(t),Z.addPrecision(t,e),Z.endFloatingPoint(t)}}var te;(function(i){i[i.YEAR_MONTH=0]="YEAR_MONTH",i[i.DAY_TIME=1]="DAY_TIME",i[i.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(te||(te={}));class Q{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInterval(t,e){return(e||new Q).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInterval(t,e){return t.setPosition(t.position()+y),(e||new Q).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):te.YEAR_MONTH}static startInterval(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,te.YEAR_MONTH)}static endInterval(t){const e=t.endObject();return e}static createInterval(t,e){return Q.startInterval(t),Q.addUnit(t,e),Q.endInterval(t)}}class lt{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsList(t,e){return(e||new lt).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,e){return t.setPosition(t.position()+y),(e||new lt).__init(t.readInt32(t.position())+t.position(),t)}static startList(t){t.startObject(0)}static endList(t){const e=t.endObject();return e}static createList(t){return lt.startList(t),lt.endList(t)}}class q{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMap(t,e){return(e||new q).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,e){return t.setPosition(t.position()+y),(e||new q).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){const t=this.bb.__offset(this.bb_pos,4);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startMap(t){t.startObject(1)}static addKeysSorted(t,e){t.addFieldInt8(0,+e,0)}static endMap(t){const e=t.endObject();return e}static createMap(t,e){return q.startMap(t),q.addKeysSorted(t,e),q.endMap(t)}}class _t{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsNull(t,e){return(e||new _t).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,e){return t.setPosition(t.position()+y),(e||new _t).__init(t.readInt32(t.position())+t.position(),t)}static startNull(t){t.startObject(0)}static endNull(t){const e=t.endObject();return e}static createNull(t){return _t.startNull(t),_t.endNull(t)}}class bt{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsStruct_(t,e){return(e||new bt).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsStruct_(t,e){return t.setPosition(t.position()+y),(e||new bt).__init(t.readInt32(t.position())+t.position(),t)}static startStruct_(t){t.startObject(0)}static endStruct_(t){const e=t.endObject();return e}static createStruct_(t){return bt.startStruct_(t),bt.endStruct_(t)}}class P{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTime(t,e){return(e||new P).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTime(t,e){return t.setPosition(t.position()+y),(e||new P).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):At.MILLISECOND}bitWidth(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):32}static startTime(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,At.MILLISECOND)}static addBitWidth(t,e){t.addFieldInt32(1,e,32)}static endTime(t){const e=t.endObject();return e}static createTime(t,e,s){return P.startTime(t),P.addUnit(t,e),P.addBitWidth(t,s),P.endTime(t)}}class z{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTimestamp(t,e){return(e||new z).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTimestamp(t,e){return t.setPosition(t.position()+y),(e||new z).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):At.SECOND}timezone(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startTimestamp(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,At.SECOND)}static addTimezone(t,e){t.addFieldOffset(1,e,0)}static endTimestamp(t){const e=t.endObject();return e}static createTimestamp(t,e,s){return z.startTimestamp(t),z.addUnit(t,e),z.addTimezone(t,s),z.endTimestamp(t)}}var ee;(function(i){i[i.Sparse=0]="Sparse",i[i.Dense=1]="Dense"})(ee||(ee={}));class R{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUnion(t,e){return(e||new R).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUnion(t,e){return t.setPosition(t.position()+y),(e||new R).__init(t.readInt32(t.position())+t.position(),t)}mode(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):ee.Sparse}typeIds(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+t*4):0}typeIdsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}typeIdsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startUnion(t){t.startObject(2)}static addMode(t,e){t.addFieldInt16(0,e,ee.Sparse)}static addTypeIds(t,e){t.addFieldOffset(1,e,0)}static createTypeIdsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startTypeIdsVector(t,e){t.startVector(4,e,4)}static endUnion(t){const e=t.endObject();return e}static createUnion(t,e,s){return R.startUnion(t),R.addMode(t,e),R.addTypeIds(t,s),R.endUnion(t)}}class pt{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUtf8(t,e){return(e||new pt).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,e){return t.setPosition(t.position()+y),(e||new pt).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(t){t.startObject(0)}static endUtf8(t){const e=t.endObject();return e}static createUtf8(t){return pt.startUtf8(t),pt.endUtf8(t)}}var f;(function(i){i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.FloatingPoint=3]="FloatingPoint",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct_=13]="Struct_",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Duration=18]="Duration",i[i.LargeBinary=19]="LargeBinary",i[i.LargeUtf8=20]="LargeUtf8",i[i.LargeList=21]="LargeList",i[i.RunEndEncoded=22]="RunEndEncoded"})(f||(f={}));class A{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsField(t,e){return(e||new A).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,e){return t.setPosition(t.position()+y),(e||new A).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}nullable(){const t=this.bb.__offset(this.bb_pos,6);return t?!!this.bb.readInt8(this.bb_pos+t):!1}typeType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):f.NONE}type(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__union(t,this.bb_pos+e):null}dictionary(t){const e=this.bb.__offset(this.bb_pos,12);return e?(t||new it).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}children(t,e){const s=this.bb.__offset(this.bb_pos,14);return s?(e||new A).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+t*4),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const s=this.bb.__offset(this.bb_pos,16);return s?(e||new v).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}static startField(t){t.startObject(7)}static addName(t,e){t.addFieldOffset(0,e,0)}static addNullable(t,e){t.addFieldInt8(1,+e,0)}static addTypeType(t,e){t.addFieldInt8(2,e,f.NONE)}static addType(t,e){t.addFieldOffset(3,e,0)}static addDictionary(t,e){t.addFieldOffset(4,e,0)}static addChildren(t,e){t.addFieldOffset(5,e,0)}static createChildrenVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startChildrenVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(6,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endField(t){const e=t.endObject();return e}}class B{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSchema(t,e){return(e||new B).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,e){return t.setPosition(t.position()+y),(e||new B).__init(t.readInt32(t.position())+t.position(),t)}endianness(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):St.Little}fields(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?(e||new A).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+t*4),this.bb):null}fieldsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new v).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}features(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb.__vector(this.bb_pos+e)+t*8):BigInt(0)}featuresLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSchema(t){t.startObject(4)}static addEndianness(t,e){t.addFieldInt16(0,e,St.Little)}static addFields(t,e){t.addFieldOffset(1,e,0)}static createFieldsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startFieldsVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(2,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static addFeatures(t,e){t.addFieldOffset(3,e,0)}static createFeaturesVector(t,e){t.startVector(8,e.length,8);for(let s=e.length-1;s>=0;s--)t.addInt64(e[s]);return t.endVector()}static startFeaturesVector(t,e){t.startVector(8,e,8)}static endSchema(t){const e=t.endObject();return e}static finishSchemaBuffer(t,e){t.finish(e)}static finishSizePrefixedSchemaBuffer(t,e){t.finish(e,void 0,!0)}static createSchema(t,e,s,r,n){return B.startSchema(t),B.addEndianness(t,e),B.addFields(t,s),B.addCustomMetadata(t,r),B.addFeatures(t,n),B.endSchema(t)}}class M{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFooter(t,e){return(e||new M).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFooter(t,e){return t.setPosition(t.position()+y),(e||new M).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):It.V1}schema(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new B).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}dictionaries(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new ve).__init(this.bb.__vector(this.bb_pos+s)+t*24,this.bb):null}dictionariesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}recordBatches(t,e){const s=this.bb.__offset(this.bb_pos,10);return s?(e||new ve).__init(this.bb.__vector(this.bb_pos+s)+t*24,this.bb):null}recordBatchesLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const s=this.bb.__offset(this.bb_pos,12);return s?(e||new v).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFooter(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,It.V1)}static addSchema(t,e){t.addFieldOffset(1,e,0)}static addDictionaries(t,e){t.addFieldOffset(2,e,0)}static startDictionariesVector(t,e){t.startVector(24,e,8)}static addRecordBatches(t,e){t.addFieldOffset(3,e,0)}static startRecordBatchesVector(t,e){t.startVector(24,e,8)}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endFooter(t){const e=t.endObject();return e}static finishFooterBuffer(t,e){t.finish(e)}static finishSizePrefixedFooterBuffer(t,e){t.finish(e,void 0,!0)}}var di=os,hi=Gt;class Mt{static decode(t){t=new hi(T(t));const e=M.getRootAsFooter(t),s=k.decode(e.schema());return new ui(s,e)}static encode(t){const e=new di,s=k.encode(e,t.schema);M.startRecordBatchesVector(e,t.numRecordBatches);for(const o of[...t.recordBatches()].slice().reverse())X.encode(e,o);const r=e.endVector();M.startDictionariesVector(e,t.numDictionaries);for(const o of[...t.dictionaryBatches()].slice().reverse())X.encode(e,o);const n=e.endVector();return M.startFooter(e),M.addSchema(e,s),M.addVersion(e,j.V4),M.addRecordBatches(e,r),M.addDictionaries(e,n),M.finishFooterBuffer(e,M.endFooter(e)),e.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(t,e=j.V4,s,r){this.schema=t,this.version=e,s&&(this._recordBatches=s),r&&(this._dictionaryBatches=r)}*recordBatches(){for(let t,e=-1,s=this.numRecordBatches;++e<s;)(t=this.getRecordBatch(e))&&(yield t)}*dictionaryBatches(){for(let t,e=-1,s=this.numDictionaries;++e<s;)(t=this.getDictionaryBatch(e))&&(yield t)}getRecordBatch(t){return t>=0&&t<this.numRecordBatches&&this._recordBatches[t]||null}getDictionaryBatch(t){return t>=0&&t<this.numDictionaries&&this._dictionaryBatches[t]||null}}class ui extends Mt{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(t,e){super(t,e.version());this._footer=e}getRecordBatch(t){if(t>=0&&t<this.numRecordBatches){const e=this._footer.recordBatches(t);if(e)return X.decode(e)}return null}getDictionaryBatch(t){if(t>=0&&t<this.numDictionaries){const e=this._footer.dictionaries(t);if(e)return X.decode(e)}return null}}class X{static decode(t){return new X(t.metaDataLength(),t.bodyLength(),t.offset())}static encode(t,e){const{metaDataLength:s}=e,r=BigInt(e.offset),n=BigInt(e.bodyLength);return ve.createBlock(t,r,s,n)}constructor(t,e,s){this.metaDataLength=t,this.offset=Y(s),this.bodyLength=Y(e)}}const m=Object.freeze({done:!0,value:void 0});class as{constructor(t){this._json=t}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class Be{tee(){return this._getDOMStream().tee()}pipe(t,e){return this._getNodeStream().pipe(t,e)}pipeTo(t,e){return this._getDOMStream().pipeTo(t,e)}pipeThrough(t,e){return this._getDOMStream().pipeThrough(t,e)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class fi extends Be{constructor(){super();this._values=[],this.resolvers=[],this._closedPromise=new Promise(t=>this._closedPromiseResolve=t)}get closed(){return this._closedPromise}cancel(t){return u(this,void 0,void 0,function*(){yield this.return(t)})}write(t){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(t):this.resolvers.shift().resolve({done:!1,value:t}))}abort(t){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:t}:this.resolvers.shift().reject({done:!0,value:t}))}close(){if(this._closedPromiseResolve){const{resolvers:t}=this;for(;t.length>0;)t.shift().resolve(m);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(t){return L.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,t)}toNodeStream(t){return L.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,t)}throw(t){return u(this,void 0,void 0,function*(){return yield this.abort(t),m})}return(t){return u(this,void 0,void 0,function*(){return yield this.close(),m})}read(t){return u(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return u(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(...t){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((e,s)=>{this.resolvers.push({resolve:e,reject:s})}):Promise.resolve(m)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class Vt extends fi{write(t){if((t=T(t)).byteLength>0)return super.write(t)}toString(t=!1){return t?Ee(this.toUint8Array(!0)):this.toUint8Array(!1).then(Ee)}toUint8Array(t=!1){return t?J(this._values)[0]:(()=>u(this,void 0,void 0,function*(){var e,s,r,n;const o=[];let a=0;try{for(var c=!0,d=Kt(this),h;h=yield d.next(),e=h.done,!e;c=!0){n=h.value,c=!1;const _=n;o.push(_),a+=_.byteLength}}catch(_){s={error:_}}finally{try{!c&&!e&&(r=d.return)&&(yield r.call(d))}finally{if(s)throw s.error}}return J(o,a)[0]}))()}}class Ut{constructor(t){t&&(this.source=new li(L.fromIterable(t)))}[Symbol.iterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class yt{constructor(t){t instanceof yt?this.source=t.source:t instanceof Vt?this.source=new mt(L.fromAsyncIterable(t)):je(t)?this.source=new mt(L.fromNodeStream(t)):ke(t)?this.source=new mt(L.fromDOMStream(t)):Ce(t)?this.source=new mt(L.fromDOMStream(t.body)):_e(t)?this.source=new mt(L.fromIterable(t)):dt(t)?this.source=new mt(L.fromAsyncIterable(t)):Nt(t)&&(this.source=new mt(L.fromAsyncIterable(t)))}[Symbol.asyncIterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}get closed(){return this.source.closed}cancel(t){return this.source.cancel(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class li{constructor(t){this.source=t}cancel(t){this.return(t)}peek(t){return this.next(t,"peek").value}read(t){return this.next(t,"read").value}next(t,e="read"){return this.source.next({cmd:e,size:t})}throw(t){return Object.create(this.source.throw&&this.source.throw(t)||m)}return(t){return Object.create(this.source.return&&this.source.return(t)||m)}}class mt{constructor(t){this.source=t,this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}cancel(t){return u(this,void 0,void 0,function*(){yield this.return(t)})}get closed(){return this._closedPromise}read(t){return u(this,void 0,void 0,function*(){return(yield this.next(t,"read")).value})}peek(t){return u(this,void 0,void 0,function*(){return(yield this.next(t,"peek")).value})}next(t,e="read"){return u(this,void 0,void 0,function*(){return yield this.source.next({cmd:e,size:t})})}throw(t){return u(this,void 0,void 0,function*(){const e=this.source.throw&&(yield this.source.throw(t))||m;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)})}return(t){return u(this,void 0,void 0,function*(){const e=this.source.return&&(yield this.source.return(t))||m;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)})}}class cs extends Ut{constructor(t,e){super();this.position=0,this.buffer=T(t),this.size=e===void 0?this.buffer.byteLength:e}readInt32(t){const{buffer:e,byteOffset:s}=this.readAt(t,4);return new DataView(e,s).getInt32(0,!0)}seek(t){return this.position=Math.min(t,this.size),t<this.size}read(t){const{buffer:e,size:s,position:r}=this;return e&&r<s?(typeof t!="number"&&(t=Number.POSITIVE_INFINITY),this.position=Math.min(s,r+Math.min(s-r,t)),e.subarray(r,this.position)):null}readAt(t,e){const s=this.buffer,r=Math.min(this.size,t+e);return s?s.subarray(t,r):new Uint8Array(e)}close(){this.buffer&&(this.buffer=null)}throw(t){return this.close(),{done:!0,value:t}}return(t){return this.close(),{done:!0,value:t}}}class se extends yt{constructor(t,e){super();this.position=0,this._handle=t,typeof e=="number"?this.size=e:this._pending=(()=>u(this,void 0,void 0,function*(){this.size=(yield t.stat()).size,delete this._pending}))()}readInt32(t){return u(this,void 0,void 0,function*(){const{buffer:e,byteOffset:s}=yield this.readAt(t,4);return new DataView(e,s).getInt32(0,!0)})}seek(t){return u(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(t,this.size),t<this.size})}read(t){return u(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:e,size:s,position:r}=this;if(e&&r<s){typeof t!="number"&&(t=Number.POSITIVE_INFINITY);let n=r,o=0,a=0;const c=Math.min(s,n+Math.min(s-n,t)),d=new Uint8Array(Math.max(0,(this.position=c)-n));for(;(n+=a)<c&&(o+=a)<d.byteLength;)({bytesRead:a}=yield e.read(d,o,d.byteLength-o,n));return d}return null})}readAt(t,e){return u(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:s,size:r}=this;if(s&&t+e<r){const n=Math.min(r,t+e),o=new Uint8Array(n-t);return(yield s.read(o,0,e,t)).buffer}return new Uint8Array(e)})}close(){return u(this,void 0,void 0,function*(){const t=this._handle;this._handle=null,t&&(yield t.close())})}throw(t){return u(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}return(t){return u(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:t}})}}const _i=1<<16;function Ot(i){return i<0&&(i=4294967295+i+1),`0x${i.toString(16)}`}const Dt=8,Ie=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class Se{constructor(t){this.buffer=t}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(t){const e=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),s=new Uint32Array([t.buffer[1]>>>16,t.buffer[1]&65535,t.buffer[0]>>>16,t.buffer[0]&65535]);let r=e[3]*s[3];this.buffer[0]=r&65535;let n=r>>>16;return r=e[2]*s[3],n+=r,r=e[3]*s[2]>>>0,n+=r,this.buffer[0]+=n<<16,this.buffer[1]=n>>>0<r?_i:0,this.buffer[1]+=n>>>16,this.buffer[1]+=e[1]*s[3]+e[2]*s[2]+e[3]*s[1],this.buffer[1]+=e[0]*s[3]+e[1]*s[2]+e[2]*s[1]+e[3]*s[0]<<16,this}_plus(t){const e=this.buffer[0]+t.buffer[0]>>>0;this.buffer[1]+=t.buffer[1],e<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=e}lessThan(t){return this.buffer[1]<t.buffer[1]||this.buffer[1]===t.buffer[1]&&this.buffer[0]<t.buffer[0]}equals(t){return this.buffer[1]===t.buffer[1]&&this.buffer[0]==t.buffer[0]}greaterThan(t){return t.lessThan(this)}hex(){return`${Ot(this.buffer[1])} ${Ot(this.buffer[0])}`}}class l extends Se{times(t){return this._times(t),this}plus(t){return this._plus(t),this}static from(t,e=new Uint32Array(2)){return l.fromString(typeof t=="string"?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return l.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const s=t.length,r=new l(e);for(let n=0;n<s;){const o=Dt<s-n?Dt:s-n,a=new l(new Uint32Array([Number.parseInt(t.slice(n,n+o),10),0])),c=new l(new Uint32Array([Ie[o],0]));r.times(c),r.plus(a),n+=o}return r}static convertArray(t){const e=new Uint32Array(t.length*2);for(let s=-1,r=t.length;++s<r;)l.from(t[s],new Uint32Array(e.buffer,e.byteOffset+2*s*4,2));return e}static multiply(t,e){const s=new l(new Uint32Array(t.buffer));return s.times(e)}static add(t,e){const s=new l(new Uint32Array(t.buffer));return s.plus(e)}}class F extends Se{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(t){return this._times(t),this}plus(t){return this._plus(t),this}lessThan(t){const e=this.buffer[1]<<0,s=t.buffer[1]<<0;return e<s||e===s&&this.buffer[0]<t.buffer[0]}static from(t,e=new Uint32Array(2)){return F.fromString(typeof t=="string"?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return F.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const s=t.startsWith("-"),r=t.length,n=new F(e);for(let o=s?1:0;o<r;){const a=Dt<r-o?Dt:r-o,c=new F(new Uint32Array([Number.parseInt(t.slice(o,o+a),10),0])),d=new F(new Uint32Array([Ie[a],0]));n.times(d),n.plus(c),o+=a}return s?n.negate():n}static convertArray(t){const e=new Uint32Array(t.length*2);for(let s=-1,r=t.length;++s<r;)F.from(t[s],new Uint32Array(e.buffer,e.byteOffset+2*s*4,2));return e}static multiply(t,e){const s=new F(new Uint32Array(t.buffer));return s.times(e)}static add(t,e){const s=new F(new Uint32Array(t.buffer));return s.plus(e)}}class C{constructor(t){this.buffer=t}high(){return new F(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new F(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(t){const e=new l(new Uint32Array([this.buffer[3],0])),s=new l(new Uint32Array([this.buffer[2],0])),r=new l(new Uint32Array([this.buffer[1],0])),n=new l(new Uint32Array([this.buffer[0],0])),o=new l(new Uint32Array([t.buffer[3],0])),a=new l(new Uint32Array([t.buffer[2],0])),c=new l(new Uint32Array([t.buffer[1],0])),d=new l(new Uint32Array([t.buffer[0],0]));let h=l.multiply(n,d);this.buffer[0]=h.low();const _=new l(new Uint32Array([h.high(),0]));h=l.multiply(r,d),_.plus(h),h=l.multiply(n,c),_.plus(h),this.buffer[1]=_.low(),this.buffer[3]=_.lessThan(h)?1:0,this.buffer[2]=_.high();const U=new l(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2));return U.plus(l.multiply(s,d)).plus(l.multiply(r,c)).plus(l.multiply(n,a)),this.buffer[3]+=l.multiply(e,d).plus(l.multiply(s,c)).plus(l.multiply(r,a)).plus(l.multiply(n,o)).low(),this}plus(t){const e=new Uint32Array(4);return e[3]=this.buffer[3]+t.buffer[3]>>>0,e[2]=this.buffer[2]+t.buffer[2]>>>0,e[1]=this.buffer[1]+t.buffer[1]>>>0,e[0]=this.buffer[0]+t.buffer[0]>>>0,e[0]<this.buffer[0]>>>0&&++e[1],e[1]<this.buffer[1]>>>0&&++e[2],e[2]<this.buffer[2]>>>0&&++e[3],this.buffer[3]=e[3],this.buffer[2]=e[2],this.buffer[1]=e[1],this.buffer[0]=e[0],this}hex(){return`${Ot(this.buffer[3])} ${Ot(this.buffer[2])} ${Ot(this.buffer[1])} ${Ot(this.buffer[0])}`}static multiply(t,e){const s=new C(new Uint32Array(t.buffer));return s.times(e)}static add(t,e){const s=new C(new Uint32Array(t.buffer));return s.plus(e)}static from(t,e=new Uint32Array(4)){return C.fromString(typeof t=="string"?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(4)){return C.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(4)){const s=t.startsWith("-"),r=t.length,n=new C(e);for(let o=s?1:0;o<r;){const a=Dt<r-o?Dt:r-o,c=new C(new Uint32Array([Number.parseInt(t.slice(o,o+a),10),0,0,0])),d=new C(new Uint32Array([Ie[a],0,0,0]));n.times(d),n.plus(c),o+=a}return s?n.negate():n}static convertArray(t){const e=new Uint32Array(t.length*4);for(let s=-1,r=t.length;++s<r;)C.from(t[s],new Uint32Array(e.buffer,e.byteOffset+4*4*s,4));return e}}var bi=Object.freeze({__proto__:null,BaseInt64:Se,Uint64:l,Int64:F,Int128:C});class ds extends xt{constructor(t,e,s,r){super();this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=t,this.nodes=e,this.buffers=s,this.dictionaries=r}visit(t){return super.visit(t instanceof S?t.type:t)}visitNull(t,{length:e}=this.nextFieldNode()){return w({type:t,length:e})}visitBool(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),data:this.readData(t)})}visitInt(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),data:this.readData(t)})}visitFloat(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),data:this.readData(t)})}visitUtf8(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitBinary(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitFixedSizeBinary(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),data:this.readData(t)})}visitDate(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),data:this.readData(t)})}visitTimestamp(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),data:this.readData(t)})}visitTime(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),data:this.readData(t)})}visitDecimal(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),data:this.readData(t)})}visitList(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}visitStruct(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),children:this.visitMany(t.children)})}visitUnion(t){return t.mode===vt.Sparse?this.visitSparseUnion(t):this.visitDenseUnion(t)}visitDenseUnion(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),typeIds:this.readTypeIds(t),valueOffsets:this.readOffsets(t),children:this.visitMany(t.children)})}visitSparseUnion(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),typeIds:this.readTypeIds(t),children:this.visitMany(t.children)})}visitDictionary(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),data:this.readData(t.indices),dictionary:this.readDictionary(t)})}visitInterval(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),data:this.readData(t)})}visitFixedSizeList(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),child:this.visit(t.children[0])})}visitMap(t,{length:e,nullCount:s}=this.nextFieldNode()){return w({type:t,length:e,nullCount:s,nullBitmap:this.readNullBitmap(t,s),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(t,e,s=this.nextBufferRange()){return e>0&&this.readData(t,s)||new Uint8Array(0)}readOffsets(t,e){return this.readData(t,e)}readTypeIds(t,e){return this.readData(t,e)}readData(t,{length:e,offset:s}=this.nextBufferRange()){return this.bytes.subarray(s,s+e)}readDictionary(t){return this.dictionaries.get(t.id)}}class pi extends ds{constructor(t,e,s,r){super(new Uint8Array(0),e,s,r);this.sources=t}readNullBitmap(t,e,{offset:s}=this.nextBufferRange()){return e<=0?new Uint8Array(0):be(this.sources[s])}readOffsets(t,{offset:e}=this.nextBufferRange()){return W(Uint8Array,W(Int32Array,this.sources[e]))}readTypeIds(t,{offset:e}=this.nextBufferRange()){return W(Uint8Array,W(t.ArrayType,this.sources[e]))}readData(t,{offset:e}=this.nextBufferRange()){const{sources:s}=this;return D.isTimestamp(t)?W(Uint8Array,F.convertArray(s[e])):(D.isInt(t)||D.isTime(t))&&t.bitWidth===64?W(Uint8Array,F.convertArray(s[e])):D.isDate(t)&&t.unit===Ct.MILLISECOND?W(Uint8Array,F.convertArray(s[e])):D.isDecimal(t)?W(Uint8Array,C.convertArray(s[e])):D.isBinary(t)||D.isFixedSizeBinary(t)?yi(s[e]):D.isBool(t)?be(s[e]):D.isUtf8(t)?Cs(s[e].join("")):W(Uint8Array,W(t.ArrayType,s[e].map(r=>+r)))}}function yi(i){const t=i.join(""),e=new Uint8Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s>>1]=Number.parseInt(t.slice(s,s+2),16);return e}var ie;(function(i){i[i.BUFFER=0]="BUFFER"})(ie||(ie={}));var re;(function(i){i[i.LZ4_FRAME=0]="LZ4_FRAME",i[i.ZSTD=1]="ZSTD"})(re||(re={}));class at{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBodyCompression(t,e){return(e||new at).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBodyCompression(t,e){return t.setPosition(t.position()+y),(e||new at).__init(t.readInt32(t.position())+t.position(),t)}codec(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):re.LZ4_FRAME}method(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt8(this.bb_pos+t):ie.BUFFER}static startBodyCompression(t){t.startObject(2)}static addCodec(t,e){t.addFieldInt8(0,e,re.LZ4_FRAME)}static addMethod(t,e){t.addFieldInt8(1,e,ie.BUFFER)}static endBodyCompression(t){const e=t.endObject();return e}static createBodyCompression(t,e,s){return at.startBodyCompression(t),at.addCodec(t,e),at.addMethod(t,s),at.endBodyCompression(t)}}class hs{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(t,e,s){return t.prep(8,16),t.writeInt64(BigInt(s??0)),t.writeInt64(BigInt(e??0)),t.offset()}}class us{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(t,e,s){return t.prep(8,16),t.writeInt64(BigInt(s??0)),t.writeInt64(BigInt(e??0)),t.offset()}}class E{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsRecordBatch(t,e){return(e||new E).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,e){return t.setPosition(t.position()+y),(e||new E).__init(t.readInt32(t.position())+t.position(),t)}length(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}nodes(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?(e||new us).__init(this.bb.__vector(this.bb_pos+s)+t*16,this.bb):null}nodesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}buffers(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new hs).__init(this.bb.__vector(this.bb_pos+s)+t*16,this.bb):null}buffersLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}compression(t){const e=this.bb.__offset(this.bb_pos,10);return e?(t||new at).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}static startRecordBatch(t){t.startObject(4)}static addLength(t,e){t.addFieldInt64(0,e,BigInt("0"))}static addNodes(t,e){t.addFieldOffset(1,e,0)}static startNodesVector(t,e){t.startVector(16,e,8)}static addBuffers(t,e){t.addFieldOffset(2,e,0)}static startBuffersVector(t,e){t.startVector(16,e,8)}static addCompression(t,e){t.addFieldOffset(3,e,0)}static endRecordBatch(t){const e=t.endObject();return e}}class rt{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryBatch(t,e){return(e||new rt).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,e){return t.setPosition(t.position()+y),(e||new rt).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}data(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new E).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isDelta(){const t=this.bb.__offset(this.bb_pos,8);return t?!!this.bb.readInt8(this.bb_pos+t):!1}static startDictionaryBatch(t){t.startObject(3)}static addId(t,e){t.addFieldInt64(0,e,BigInt("0"))}static addData(t,e){t.addFieldOffset(1,e,0)}static addIsDelta(t,e){t.addFieldInt8(2,+e,0)}static endDictionaryBatch(t){const e=t.endObject();return e}}var Tt;(function(i){i[i.NONE=0]="NONE",i[i.Schema=1]="Schema",i[i.DictionaryBatch=2]="DictionaryBatch",i[i.RecordBatch=3]="RecordBatch",i[i.Tensor=4]="Tensor",i[i.SparseTensor=5]="SparseTensor"})(Tt||(Tt={}));class I{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMessage(t,e){return(e||new I).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,e){return t.setPosition(t.position()+y),(e||new I).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):It.V1}headerType(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):Tt.NONE}header(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__union(t,this.bb_pos+e):null}bodyLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb_pos+t):BigInt("0")}customMetadata(t,e){const s=this.bb.__offset(this.bb_pos,12);return s?(e||new v).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+t*4),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMessage(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,It.V1)}static addHeaderType(t,e){t.addFieldInt8(1,e,Tt.NONE)}static addHeader(t,e){t.addFieldOffset(2,e,0)}static addBodyLength(t,e){t.addFieldInt64(3,e,BigInt("0"))}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endMessage(t){const e=t.endObject();return e}static finishMessageBuffer(t,e){t.finish(e)}static finishSizePrefixedMessageBuffer(t,e){t.finish(e,void 0,!0)}static createMessage(t,e,s,r,n,o){return I.startMessage(t),I.addVersion(t,e),I.addHeaderType(t,s),I.addHeader(t,r),I.addBodyLength(t,n),I.addCustomMetadata(t,o),I.endMessage(t)}}class mi extends xt{visit(t,e){return t==null||e==null?void 0:super.visit(t,e)}visitNull(t,e){return _t.startNull(e),_t.endNull(e)}visitInt(t,e){return x.startInt(e),x.addBitWidth(e,t.bitWidth),x.addIsSigned(e,t.isSigned),x.endInt(e)}visitFloat(t,e){return Z.startFloatingPoint(e),Z.addPrecision(e,t.precision),Z.endFloatingPoint(e)}visitBinary(t,e){return ut.startBinary(e),ut.endBinary(e)}visitBool(t,e){return ft.startBool(e),ft.endBool(e)}visitUtf8(t,e){return pt.startUtf8(e),pt.endUtf8(e)}visitDecimal(t,e){return N.startDecimal(e),N.addScale(e,t.scale),N.addPrecision(e,t.precision),N.addBitWidth(e,t.bitWidth),N.endDecimal(e)}visitDate(t,e){return H.startDate(e),H.addUnit(e,t.unit),H.endDate(e)}visitTime(t,e){return P.startTime(e),P.addUnit(e,t.unit),P.addBitWidth(e,t.bitWidth),P.endTime(e)}visitTimestamp(t,e){const s=t.timezone&&e.createString(t.timezone)||void 0;return z.startTimestamp(e),z.addUnit(e,t.unit),s!==void 0&&z.addTimezone(e,s),z.endTimestamp(e)}visitInterval(t,e){return Q.startInterval(e),Q.addUnit(e,t.unit),Q.endInterval(e)}visitList(t,e){return lt.startList(e),lt.endList(e)}visitStruct(t,e){return bt.startStruct_(e),bt.endStruct_(e)}visitUnion(t,e){R.startTypeIdsVector(e,t.typeIds.length);const s=R.createTypeIdsVector(e,t.typeIds);return R.startUnion(e),R.addMode(e,t.mode),R.addTypeIds(e,s),R.endUnion(e)}visitDictionary(t,e){const s=this.visit(t.indices,e);return it.startDictionaryEncoding(e),it.addId(e,BigInt(t.id)),it.addIsOrdered(e,t.isOrdered),s!==void 0&&it.addIndexType(e,s),it.endDictionaryEncoding(e)}visitFixedSizeBinary(t,e){return K.startFixedSizeBinary(e),K.addByteWidth(e,t.byteWidth),K.endFixedSizeBinary(e)}visitFixedSizeList(t,e){return G.startFixedSizeList(e),G.addListSize(e,t.listSize),G.endFixedSizeList(e)}visitMap(t,e){return q.startMap(e),q.addKeysSorted(e,t.keysSorted),q.endMap(e)}}const Ae=new mi;function wi(i,t=new Map){return new k(vi(i,t),ne(i.customMetadata),t)}function fs(i){return new V(i.count,_s(i.columns),bs(i.columns))}function gi(i){return new tt(fs(i.data),i.id,i.isDelta)}function vi(i,t){return(i.fields||[]).filter(Boolean).map(e=>S.fromJSON(e,t))}function ls(i,t){return(i.children||[]).filter(Boolean).map(e=>S.fromJSON(e,t))}function _s(i){return(i||[]).reduce((t,e)=>[...t,new wt(e.count,Bi(e.VALIDITY)),..._s(e.children)],[])}function bs(i,t=[]){for(let e=-1,s=(i||[]).length;++e<s;){const r=i[e];r.VALIDITY&&t.push(new et(t.length,r.VALIDITY.length)),r.TYPE&&t.push(new et(t.length,r.TYPE.length)),r.OFFSET&&t.push(new et(t.length,r.OFFSET.length)),r.DATA&&t.push(new et(t.length,r.DATA.length)),t=bs(r.children,t)}return t}function Bi(i){return(i||[]).reduce((t,e)=>t+ +(e===0),0)}function Ii(i,t){let e,s,r,n,o,a;return!t||!(n=i.dictionary)?(o=ys(i,ls(i,t)),r=new S(i.name,o,i.nullable,ne(i.customMetadata))):t.has(e=n.id)?(s=(s=n.indexType)?ps(s):new Jt,a=new Wt(t.get(e),s,e,n.isOrdered),r=new S(i.name,a,i.nullable,ne(i.customMetadata))):(s=(s=n.indexType)?ps(s):new Jt,t.set(e,o=ys(i,ls(i,t))),a=new Wt(o,s,e,n.isOrdered),r=new S(i.name,a,i.nullable,ne(i.customMetadata))),r||null}function ne(i){return new Map(Object.entries(i||{}))}function ps(i){return new $t(i.isSigned,i.bitWidth)}function ys(i,t){const e=i.type.name;switch(e){case"NONE":return new Ht;case"null":return new Ht;case"binary":return new Ge;case"utf8":return new Ke;case"bool":return new He;case"list":return new Ye((t||[])[0]);case"struct":return new Yt(t||[]);case"struct_":return new Yt(t||[])}switch(e){case"int":{const s=i.type;return new $t(s.isSigned,s.bitWidth)}case"floatingpoint":{const s=i.type;return new ns(ze[s.precision])}case"decimal":{const s=i.type;return new rs(s.scale,s.precision,s.bitWidth)}case"date":{const s=i.type;return new is(Ct[s.unit])}case"time":{const s=i.type;return new ss(Ft[s.unit],s.bitWidth)}case"timestamp":{const s=i.type;return new es(Ft[s.unit],s.timezone)}case"interval":{const s=i.type;return new ts(Pe[s.unit])}case"union":{const s=i.type;return new Xe(vt[s.mode],s.typeIds||[],t||[])}case"fixedsizebinary":{const s=i.type;return new qe(s.byteWidth)}case"fixedsizelist":{const s=i.type;return new Qe(s.listSize,(t||[])[0])}case"map":{const s=i.type;return new Ze((t||[])[0],s.keysSorted)}}throw new Error(`Unrecognized type: "${e}"`)}var Si=os,Ai=Gt;class O{static fromJSON(t,e){const s=new O(0,j.V4,e);return s._createHeader=Oi(t,e),s}static decode(t){t=new Ai(T(t));const e=I.getRootAsMessage(t),s=e.bodyLength(),r=e.version(),n=e.headerType(),o=new O(s,r,n);return o._createHeader=Di(e,n),o}static encode(t){const e=new Si;let s=-1;return t.isSchema()?s=k.encode(e,t.header()):t.isRecordBatch()?s=V.encode(e,t.header()):t.isDictionaryBatch()&&(s=tt.encode(e,t.header())),I.startMessage(e),I.addVersion(e,j.V4),I.addHeader(e,s),I.addHeaderType(e,t.headerType),I.addBodyLength(e,BigInt(t.bodyLength)),I.finishMessageBuffer(e,I.endMessage(e)),e.asUint8Array()}static from(t,e=0){if(t instanceof k)return new O(0,j.V4,b.Schema,t);if(t instanceof V)return new O(e,j.V4,b.RecordBatch,t);if(t instanceof tt)return new O(e,j.V4,b.DictionaryBatch,t);throw new Error(`Unrecognized Message header: ${t}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===b.Schema}isRecordBatch(){return this.headerType===b.RecordBatch}isDictionaryBatch(){return this.headerType===b.DictionaryBatch}constructor(t,e,s,r){this._version=e,this._headerType=s,this.body=new Uint8Array(0),r&&(this._createHeader=()=>r),this._bodyLength=Y(t)}}class V{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(t,e,s){this._nodes=e,this._buffers=s,this._length=Y(t)}}class tt{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(t,e,s=!1){this._data=t,this._isDelta=s,this._id=Y(e)}}class et{constructor(t,e){this.offset=Y(t),this.length=Y(e)}}class wt{constructor(t,e){this.length=Y(t),this.nullCount=Y(e)}}function Oi(i,t){return()=>{switch(t){case b.Schema:return k.fromJSON(i);case b.RecordBatch:return V.fromJSON(i);case b.DictionaryBatch:return tt.fromJSON(i)}throw new Error(`Unrecognized Message type: { name: ${b[t]}, type: ${t} }`)}}function Di(i,t){return()=>{switch(t){case b.Schema:return k.decode(i.header(new B));case b.RecordBatch:return V.decode(i.header(new E),i.version());case b.DictionaryBatch:return tt.decode(i.header(new rt),i.version())}throw new Error(`Unrecognized Message type: { name: ${b[t]}, type: ${t} }`)}}S.encode=zi,S.decode=Ti,S.fromJSON=Ii,k.encode=Pi,k.decode=Fi,k.fromJSON=wi,V.encode=Ei,V.decode=Ni,V.fromJSON=fs,tt.encode=ji,tt.decode=Ri,tt.fromJSON=gi,wt.encode=ki,wt.decode=xi,et.encode=Ci,et.decode=Li;function Fi(i,t=new Map){const e=Ui(i,t);return new k(e,oe(i),t)}function Ni(i,t=j.V4){if(i.compression()!==null)throw new Error("Record batch compression not implemented");return new V(i.length(),Mi(i),Vi(i,t))}function Ri(i,t=j.V4){return new tt(V.decode(i.data(),t),i.id(),i.isDelta())}function Li(i){return new et(i.offset(),i.length())}function xi(i){return new wt(i.length(),i.nullCount())}function Mi(i){const t=[];for(let e,s=-1,r=-1,n=i.nodesLength();++s<n;)(e=i.nodes(s))&&(t[++r]=wt.decode(e));return t}function Vi(i,t){const e=[];for(let s,r=-1,n=-1,o=i.buffersLength();++r<o;)(s=i.buffers(r))&&(t<j.V4&&(s.bb_pos+=8*(r+1)),e[++n]=et.decode(s));return e}function Ui(i,t){const e=[];for(let s,r=-1,n=-1,o=i.fieldsLength();++r<o;)(s=i.fields(r))&&(e[++n]=S.decode(s,t));return e}function ms(i,t){const e=[];for(let s,r=-1,n=-1,o=i.childrenLength();++r<o;)(s=i.children(r))&&(e[++n]=S.decode(s,t));return e}function Ti(i,t){let e,s,r,n,o,a;return!t||!(a=i.dictionary())?(r=gs(i,ms(i,t)),s=new S(i.name(),r,i.nullable(),oe(i))):t.has(e=Y(a.id()))?(n=(n=a.indexType())?ws(n):new Jt,o=new Wt(t.get(e),n,e,a.isOrdered()),s=new S(i.name(),o,i.nullable(),oe(i))):(n=(n=a.indexType())?ws(n):new Jt,t.set(e,r=gs(i,ms(i,t))),o=new Wt(r,n,e,a.isOrdered()),s=new S(i.name(),o,i.nullable(),oe(i))),s||null}function oe(i){const t=new Map;if(i)for(let e,s,r=-1,n=Math.trunc(i.customMetadataLength());++r<n;)(e=i.customMetadata(r))&&(s=e.key())!=null&&t.set(s,e.value());return t}function ws(i){return new $t(i.isSigned(),i.bitWidth())}function gs(i,t){const e=i.typeType();switch(e){case f.NONE:return new Ht;case f.Null:return new Ht;case f.Binary:return new Ge;case f.Utf8:return new Ke;case f.Bool:return new He;case f.List:return new Ye((t||[])[0]);case f.Struct_:return new Yt(t||[])}switch(e){case f.Int:{const s=i.type(new x);return new $t(s.isSigned(),s.bitWidth())}case f.FloatingPoint:{const s=i.type(new Z);return new ns(s.precision())}case f.Decimal:{const s=i.type(new N);return new rs(s.scale(),s.precision(),s.bitWidth())}case f.Date:{const s=i.type(new H);return new is(s.unit())}case f.Time:{const s=i.type(new P);return new ss(s.unit(),s.bitWidth())}case f.Timestamp:{const s=i.type(new z);return new es(s.unit(),s.timezone())}case f.Interval:{const s=i.type(new Q);return new ts(s.unit())}case f.Union:{const s=i.type(new R);return new Xe(s.mode(),s.typeIdsArray()||[],t||[])}case f.FixedSizeBinary:{const s=i.type(new K);return new qe(s.byteWidth())}case f.FixedSizeList:{const s=i.type(new G);return new Qe(s.listSize(),(t||[])[0])}case f.Map:{const s=i.type(new q);return new Ze((t||[])[0],s.keysSorted())}}throw new Error(`Unrecognized type: "${f[e]}" (${e})`)}function Pi(i,t){const e=t.fields.map(n=>S.encode(i,n));B.startFieldsVector(i,e.length);const s=B.createFieldsVector(i,e),r=t.metadata&&t.metadata.size>0?B.createCustomMetadataVector(i,[...t.metadata].map(([n,o])=>{const a=i.createString(`${n}`),c=i.createString(`${o}`);return v.startKeyValue(i),v.addKey(i,a),v.addValue(i,c),v.endKeyValue(i)})):-1;return B.startSchema(i),B.addFields(i,s),B.addEndianness(i,$i?St.Little:St.Big),r!==-1&&B.addCustomMetadata(i,r),B.endSchema(i)}function zi(i,t){let e=-1,s=-1,r=-1;const n=t.type;let o=t.typeId;D.isDictionary(n)?(o=n.dictionary.typeId,r=Ae.visit(n,i),s=Ae.visit(n.dictionary,i)):s=Ae.visit(n,i);const a=(n.children||[]).map(h=>S.encode(i,h)),c=A.createChildrenVector(i,a),d=t.metadata&&t.metadata.size>0?A.createCustomMetadataVector(i,[...t.metadata].map(([h,_])=>{const U=i.createString(`${h}`),nt=i.createString(`${_}`);return v.startKeyValue(i),v.addKey(i,U),v.addValue(i,nt),v.endKeyValue(i)})):-1;return t.name&&(e=i.createString(t.name)),A.startField(i),A.addType(i,s),A.addTypeType(i,o),A.addChildren(i,c),A.addNullable(i,!!t.nullable),e!==-1&&A.addName(i,e),r!==-1&&A.addDictionary(i,r),d!==-1&&A.addCustomMetadata(i,d),A.endField(i)}function Ei(i,t){const e=t.nodes||[],s=t.buffers||[];E.startNodesVector(i,e.length);for(const o of e.slice().reverse())wt.encode(i,o);const r=i.endVector();E.startBuffersVector(i,s.length);for(const o of s.slice().reverse())et.encode(i,o);const n=i.endVector();return E.startRecordBatch(i),E.addLength(i,BigInt(t.length)),E.addNodes(i,r),E.addBuffers(i,n),E.endRecordBatch(i)}function ji(i,t){const e=V.encode(i,t.data);return rt.startDictionaryBatch(i),rt.addId(i,BigInt(t.id)),rt.addIsDelta(i,t.isDelta),rt.addData(i,e),rt.endDictionaryBatch(i)}function ki(i,t){return us.createFieldNode(i,BigInt(t.length),BigInt(t.nullCount))}function Ci(i,t){return hs.createBuffer(i,BigInt(t.offset),BigInt(t.length))}const $i=(()=>{const i=new ArrayBuffer(2);return new DataView(i).setInt16(0,256,!0),new Int16Array(i)[0]===256})(),Oe=i=>`Expected ${b[i]} Message in stream, but was null or length 0.`,De=i=>`Header pointer of flatbuffer-encoded ${b[i]} Message is null or length 0.`,vs=(i,t)=>`Expected to read ${i} metadata bytes, but only read ${t}.`,Bs=(i,t)=>`Expected to read ${i} bytes for message body, but only read ${t}.`;class Fe{constructor(t){this.source=t instanceof Ut?t:new Ut(t)}[Symbol.iterator](){return this}next(){let t;return(t=this.readMetadataLength()).done||(t.value===-1&&(t=this.readMetadataLength()).done||(t=this.readMetadata(t.value)).done)?m:t}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}readMessage(t){let e;if((e=this.next()).done)return null;if(t!=null&&e.value.headerType!==t)throw new Error(Oe(t));return e.value}readMessageBody(t){if(t<=0)return new Uint8Array(0);const e=T(this.source.read(t));if(e.byteLength<t)throw new Error(Bs(t,e.byteLength));return e.byteOffset%8===0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()}readSchema(t=!1){const e=b.Schema,s=this.readMessage(e),r=s==null?void 0:s.header();if(t&&!r)throw new Error(De(e));return r}readMetadataLength(){const t=this.source.read(ae),e=t&&new Gt(t),s=(e==null?void 0:e.readInt32(0))||0;return{done:s===0,value:s}}readMetadata(t){const e=this.source.read(t);if(!e)return m;if(e.byteLength<t)throw new Error(vs(t,e.byteLength));return{done:!1,value:O.decode(e)}}}class Is{constructor(t,e){this.source=t instanceof yt?t:$e(t)?new se(t,e):new yt(t)}[Symbol.asyncIterator](){return this}next(){return u(this,void 0,void 0,function*(){let t;return(t=yield this.readMetadataLength()).done||(t.value===-1&&(t=yield this.readMetadataLength()).done||(t=yield this.readMetadata(t.value)).done)?m:t})}throw(t){return u(this,void 0,void 0,function*(){return yield this.source.throw(t)})}return(t){return u(this,void 0,void 0,function*(){return yield this.source.return(t)})}readMessage(t){return u(this,void 0,void 0,function*(){let e;if((e=yield this.next()).done)return null;if(t!=null&&e.value.headerType!==t)throw new Error(Oe(t));return e.value})}readMessageBody(t){return u(this,void 0,void 0,function*(){if(t<=0)return new Uint8Array(0);const e=T(yield this.source.read(t));if(e.byteLength<t)throw new Error(Bs(t,e.byteLength));return e.byteOffset%8===0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()})}readSchema(t=!1){return u(this,void 0,void 0,function*(){const e=b.Schema,s=yield this.readMessage(e),r=s==null?void 0:s.header();if(t&&!r)throw new Error(De(e));return r})}readMetadataLength(){return u(this,void 0,void 0,function*(){const t=yield this.source.read(ae),e=t&&new Gt(t),s=(e==null?void 0:e.readInt32(0))||0;return{done:s===0,value:s}})}readMetadata(t){return u(this,void 0,void 0,function*(){const e=yield this.source.read(t);if(!e)return m;if(e.byteLength<t)throw new Error(vs(t,e.byteLength));return{done:!1,value:O.decode(e)}})}}class Ss extends Fe{constructor(t){super(new Uint8Array(0));this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=t instanceof as?t:new as(t)}next(){const{_json:t}=this;if(!this._schema){this._schema=!0;const e=O.fromJSON(t.schema,b.Schema);return{done:!1,value:e}}if(this._dictionaryIndex<t.dictionaries.length){const e=t.dictionaries[this._dictionaryIndex++];this._body=e.data.columns;const s=O.fromJSON(e,b.DictionaryBatch);return{done:!1,value:s}}if(this._batchIndex<t.batches.length){const e=t.batches[this._batchIndex++];this._body=e.columns;const s=O.fromJSON(e,b.RecordBatch);return{done:!1,value:s}}return this._body=[],m}readMessageBody(t){return e(this._body);function e(s){return(s||[]).reduce((r,n)=>[...r,...n.VALIDITY&&[n.VALIDITY]||[],...n.TYPE&&[n.TYPE]||[],...n.OFFSET&&[n.OFFSET]||[],...n.DATA&&[n.DATA]||[],...e(n.children)],[])}}readMessage(t){let e;if((e=this.next()).done)return null;if(t!=null&&e.value.headerType!==t)throw new Error(Oe(t));return e.value}readSchema(){const t=b.Schema,e=this.readMessage(t),s=e==null?void 0:e.header();if(!e||!s)throw new Error(De(t));return s}}const ae=4,Ne="ARROW1",Pt=new Uint8Array(Ne.length);for(let i=0;i<Ne.length;i+=1)Pt[i]=Ne.codePointAt(i);function Re(i,t=0){for(let e=-1,s=Pt.length;++e<s;)if(Pt[e]!==i[t+e])return!1;return!0}const zt=Pt.length,As=zt+ae,Ji=zt*2+ae;class st extends Be{constructor(t){super();this._impl=t}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(t){return this._impl.throw(t)}return(t){return this._impl.return(t)}cancel(){return this._impl.cancel()}reset(t){return this._impl.reset(t),this._DOMStream=void 0,this._nodeStream=void 0,this}open(t){const e=this._impl.open(t);return dt(e)?e.then(()=>this):this}readRecordBatch(t){return this._impl.isFile()?this._impl.readRecordBatch(t):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return L.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return L.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,e){throw new Error('"throughDOM" not available in this environment')}static from(t){return t instanceof st?t:pe(t)?Hi(t):$e(t)?Zi(t):dt(t)?(()=>u(this,void 0,void 0,function*(){return yield st.from(yield t)}))():Ce(t)||ke(t)||je(t)||Nt(t)?Gi(new yt(t)):Ki(new Ut(t))}static readAll(t){return t instanceof st?t.isSync()?Rs(t):Ls(t):pe(t)||ArrayBuffer.isView(t)||_e(t)||$s(t)?Rs(t):Ls(t)}}class Et extends st{constructor(t){super(t);this._impl=t}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return Bt(this,arguments,function*(){yield p(yield*ii(Kt(this[Symbol.iterator]())))})}}class jt extends st{constructor(t){super(t);this._impl=t}readAll(){var t,e,s,r;return u(this,void 0,void 0,function*(){const n=new Array;try{for(var o=!0,a=Kt(this),c;c=yield a.next(),t=c.done,!t;o=!0){r=c.value,o=!1;const d=r;n.push(d)}}catch(d){e={error:d}}finally{try{!o&&!t&&(s=a.return)&&(yield s.call(a))}finally{if(e)throw e.error}}return n})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class Le extends Et{constructor(t){super(t);this._impl=t}}class Os extends jt{constructor(t){super(t);this._impl=t}}class Ds{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(t=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=t}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(t){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=t,this.dictionaries=new Map,this}_loadRecordBatch(t,e){const s=this._loadVectors(t,e,this.schema.fields),r=w({type:new Yt(this.schema.fields),length:t.length,children:s});return new Rt(this.schema,r)}_loadDictionaryBatch(t,e){const{id:s,isDelta:r}=t,{dictionaries:n,schema:o}=this,a=n.get(s);if(r||!a){const c=o.dictionaries.get(s),d=this._loadVectors(t.data,e,[c]);return(a&&r?a.concat(new ht(d)):new ht(d)).memoize()}return a.memoize()}_loadVectors(t,e,s){return new ds(e,t.nodes,t.buffers,this.dictionaries).visitMany(s)}}class ce extends Ds{constructor(t,e){super(e);this._reader=pe(t)?new Ss(this._handle=t):new Fe(this._handle=t)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(t){return this.closed||(this.autoDestroy=Ns(this,t),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(t):m}return(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(t):m}next(){if(this.closed)return m;let t;const{_reader:e}=this;for(;t=this._readNextMessageAndValidate();)if(t.isSchema())this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;const s=t.header(),r=e.readMessageBody(t.bodyLength),n=this._loadRecordBatch(s,r);return{done:!1,value:n}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;const s=t.header(),r=e.readMessageBody(t.bodyLength),n=this._loadDictionaryBatch(s,r);this.dictionaries.set(s.id,n)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new me(this.schema)}):this.return()}_readNextMessageAndValidate(t){return this._reader.readMessage(t)}}class de extends Ds{constructor(t,e){super(e);this._reader=new Is(this._handle=t)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return u(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(t){return u(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=Ns(this,t),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(t){return u(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(t):m})}return(t){return u(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(t):m})}next(){return u(this,void 0,void 0,function*(){if(this.closed)return m;let t;const{_reader:e}=this;for(;t=yield this._readNextMessageAndValidate();)if(t.isSchema())yield this.reset(t.header());else if(t.isRecordBatch()){this._recordBatchIndex++;const s=t.header(),r=yield e.readMessageBody(t.bodyLength),n=this._loadRecordBatch(s,r);return{done:!1,value:n}}else if(t.isDictionaryBatch()){this._dictionaryIndex++;const s=t.header(),r=yield e.readMessageBody(t.bodyLength),n=this._loadDictionaryBatch(s,r);this.dictionaries.set(s.id,n)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new me(this.schema)}):yield this.return()})}_readNextMessageAndValidate(t){return u(this,void 0,void 0,function*(){return yield this._reader.readMessage(t)})}}class Fs extends ce{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,e){super(t instanceof cs?t:new cs(t),e)}isSync(){return!0}isFile(){return!0}open(t){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const e of this._footer.dictionaryBatches())e&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(t)}readRecordBatch(t){var e;if(this.closed)return null;this._footer||this.open();const s=(e=this._footer)===null||e===void 0?void 0:e.getRecordBatch(t);if(s&&this._handle.seek(s.offset)){const r=this._reader.readMessage(b.RecordBatch);if(r==null?void 0:r.isRecordBatch()){const n=r.header(),o=this._reader.readMessageBody(r.bodyLength),a=this._loadRecordBatch(n,o);return a}}return null}_readDictionaryBatch(t){var e;const s=(e=this._footer)===null||e===void 0?void 0:e.getDictionaryBatch(t);if(s&&this._handle.seek(s.offset)){const r=this._reader.readMessage(b.DictionaryBatch);if(r==null?void 0:r.isDictionaryBatch()){const n=r.header(),o=this._reader.readMessageBody(r.bodyLength),a=this._loadDictionaryBatch(n,o);this.dictionaries.set(n.id,a)}}}_readFooter(){const{_handle:t}=this,e=t.size-As,s=t.readInt32(e),r=t.readAt(e-s,s);return Mt.decode(r)}_readNextMessageAndValidate(t){var e;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const s=(e=this._footer)===null||e===void 0?void 0:e.getRecordBatch(this._recordBatchIndex);if(s&&this._handle.seek(s.offset))return this._reader.readMessage(t)}return null}}class Wi extends de{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(t,...e){const s=typeof e[0]!="number"?e.shift():void 0,r=e[0]instanceof Map?e.shift():void 0;super(t instanceof se?t:new se(t,s),r)}isFile(){return!0}isAsync(){return!0}open(t){const e=Object.create(null,{open:{get:()=>super.open}});return u(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const s of this._footer.dictionaryBatches())s&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield e.open.call(this,t)})}readRecordBatch(t){var e;return u(this,void 0,void 0,function*(){if(this.closed)return null;this._footer||(yield this.open());const s=(e=this._footer)===null||e===void 0?void 0:e.getRecordBatch(t);if(s&&(yield this._handle.seek(s.offset))){const r=yield this._reader.readMessage(b.RecordBatch);if(r==null?void 0:r.isRecordBatch()){const n=r.header(),o=yield this._reader.readMessageBody(r.bodyLength),a=this._loadRecordBatch(n,o);return a}}return null})}_readDictionaryBatch(t){var e;return u(this,void 0,void 0,function*(){const s=(e=this._footer)===null||e===void 0?void 0:e.getDictionaryBatch(t);if(s&&(yield this._handle.seek(s.offset))){const r=yield this._reader.readMessage(b.DictionaryBatch);if(r==null?void 0:r.isDictionaryBatch()){const n=r.header(),o=yield this._reader.readMessageBody(r.bodyLength),a=this._loadDictionaryBatch(n,o);this.dictionaries.set(n.id,a)}}})}_readFooter(){return u(this,void 0,void 0,function*(){const{_handle:t}=this;t._pending&&(yield t._pending);const e=t.size-As,s=yield t.readInt32(e),r=yield t.readAt(e-s,s);return Mt.decode(r)})}_readNextMessageAndValidate(t){return u(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const e=this._footer.getRecordBatch(this._recordBatchIndex);if(e&&(yield this._handle.seek(e.offset)))return yield this._reader.readMessage(t)}return null})}}class Yi extends ce{constructor(t,e){super(t,e)}_loadVectors(t,e,s){return new pi(e,t.nodes,t.buffers,this.dictionaries).visitMany(s)}}function Ns(i,t){return t&&typeof t.autoDestroy=="boolean"?t.autoDestroy:i.autoDestroy}function*Rs(i){const t=st.from(i);try{if(!t.open({autoDestroy:!1}).closed)do yield t;while(!t.reset().open().closed)}finally{t.cancel()}}function Ls(i){return Bt(this,arguments,function*(){const e=yield p(st.from(i));try{if(!(yield p(e.open({autoDestroy:!1}))).closed)do yield yield p(e);while(!(yield p(e.reset().open())).closed)}finally{yield p(e.cancel())}})}function Hi(i){return new Et(new Yi(i))}function Ki(i){const t=i.peek(zt+7&~7);return t&&t.byteLength>=4?Re(t)?new Le(new Fs(i.read())):new Et(new ce(i)):new Et(new ce(function*(){}()))}function Gi(i){return u(this,void 0,void 0,function*(){const t=yield i.peek(zt+7&~7);return t&&t.byteLength>=4?Re(t)?new Le(new Fs(yield i.read())):new jt(new de(i)):new jt(new de(function(){return Bt(this,arguments,function*(){})}()))})}function Zi(i){return u(this,void 0,void 0,function*(){const{size:t}=yield i.stat(),e=new se(i,t);return t>=Ji&&Re(yield e.readAt(0,zt+7&~7))?new Os(new Wi(e)):new jt(new de(e))})}class g extends xt{static assemble(...t){const e=r=>r.flatMap(n=>Array.isArray(n)?e(n):n instanceof Rt?n.data.children:n.data),s=new g;return s.visitMany(e(t)),s}constructor(){super();this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(t){if(t instanceof ht)return this.visitMany(t.data),this;const{type:e}=t;if(!D.isDictionary(e)){const{length:s,nullCount:r}=t;if(s>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");D.isNull(e)||$.call(this,r<=0?new Uint8Array(0):Je(t.offset,s,t.nullBitmap)),this.nodes.push(new wt(s,r))}return super.visit(t)}visitNull(t){return this}visitDictionary(t){return this.visit(t.clone(t.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}}function $(i){const t=i.byteLength+7&~7;return this.buffers.push(i),this.bufferRegions.push(new et(this._byteLength,t)),this._byteLength+=t,this}function Qi(i){const{type:t,length:e,typeIds:s,valueOffsets:r}=i;if($.call(this,s),t.mode===vt.Sparse)return Me.call(this,i);if(t.mode===vt.Dense){if(i.offset<=0)return $.call(this,r),Me.call(this,i);{const n=s.reduce((h,_)=>Math.max(h,_),s[0]),o=new Int32Array(n+1),a=new Int32Array(n+1).fill(-1),c=new Int32Array(e),d=ye(-r[0],e,r);for(let h,_,U=-1;++U<e;)(_=a[h=s[U]])===-1&&(_=a[h]=d[h]),c[U]=d[U]-_,++o[h];$.call(this,c);for(let h,_=-1,U=t.children.length;++_<U;)if(h=i.children[_]){const nt=t.typeIds[_],ot=Math.min(e,o[nt]);this.visit(h.slice(a[nt],ot))}}}return this}function qi(i){let t;return i.nullCount>=i.length?$.call(this,new Uint8Array(0)):(t=i.values)instanceof Uint8Array?$.call(this,Je(i.offset,i.length,t)):$.call(this,be(i.values))}function ct(i){return $.call(this,i.values.subarray(0,i.length*i.stride))}function xs(i){const{length:t,values:e,valueOffsets:s}=i,r=s[0],n=s[t],o=Math.min(n-r,e.byteLength-r);return $.call(this,ye(-s[0],t,s)),$.call(this,e.subarray(r,r+o)),this}function xe(i){const{length:t,valueOffsets:e}=i;return e&&$.call(this,ye(e[0],t,e)),this.visit(i.children[0])}function Me(i){return this.visitMany(i.type.children.map((t,e)=>i.children[e]).filter(Boolean))[0]}g.prototype.visitBool=qi,g.prototype.visitInt=ct,g.prototype.visitFloat=ct,g.prototype.visitUtf8=xs,g.prototype.visitBinary=xs,g.prototype.visitFixedSizeBinary=ct,g.prototype.visitDate=ct,g.prototype.visitTimestamp=ct,g.prototype.visitTime=ct,g.prototype.visitDecimal=ct,g.prototype.visitList=xe,g.prototype.visitStruct=Me,g.prototype.visitUnion=Qi,g.prototype.visitInterval=ct,g.prototype.visitFixedSizeList=xe,g.prototype.visitMap=xe;class Xi extends xt{visit(t){return t==null?void 0:super.visit(t)}visitNull({typeId:t}){return{name:f[t].toLowerCase()}}visitInt({typeId:t,bitWidth:e,isSigned:s}){return{name:f[t].toLowerCase(),bitWidth:e,isSigned:s}}visitFloat({typeId:t,precision:e}){return{name:f[t].toLowerCase(),precision:ze[e]}}visitBinary({typeId:t}){return{name:f[t].toLowerCase()}}visitBool({typeId:t}){return{name:f[t].toLowerCase()}}visitUtf8({typeId:t}){return{name:f[t].toLowerCase()}}visitDecimal({typeId:t,scale:e,precision:s,bitWidth:r}){return{name:f[t].toLowerCase(),scale:e,precision:s,bitWidth:r}}visitDate({typeId:t,unit:e}){return{name:f[t].toLowerCase(),unit:Ct[e]}}visitTime({typeId:t,unit:e,bitWidth:s}){return{name:f[t].toLowerCase(),unit:Ft[e],bitWidth:s}}visitTimestamp({typeId:t,timezone:e,unit:s}){return{name:f[t].toLowerCase(),unit:Ft[s],timezone:e}}visitInterval({typeId:t,unit:e}){return{name:f[t].toLowerCase(),unit:Pe[e]}}visitList({typeId:t}){return{name:f[t].toLowerCase()}}visitStruct({typeId:t}){return{name:f[t].toLowerCase()}}visitUnion({typeId:t,mode:e,typeIds:s}){return{name:f[t].toLowerCase(),mode:vt[e],typeIds:[...s]}}visitDictionary(t){return this.visit(t.dictionary)}visitFixedSizeBinary({typeId:t,byteWidth:e}){return{name:f[t].toLowerCase(),byteWidth:e}}visitFixedSizeList({typeId:t,listSize:e}){return{name:f[t].toLowerCase(),listSize:e}}visitMap({typeId:t,keysSorted:e}){return{name:f[t].toLowerCase(),keysSorted:e}}}class he extends xt{static assemble(...t){const e=new he;return t.map(({schema:s,data:r})=>e.visitMany(s.fields,r.children))}visit({name:t},e){const{length:s}=e,{offset:r,nullCount:n,nullBitmap:o}=e,a=D.isDictionary(e.type)?e.type.indices:e.type,c=Object.assign([],e.buffers,{[Es.VALIDITY]:void 0});return Object.assign({name:t,count:s,VALIDITY:D.isNull(a)?void 0:n<=0?Array.from({length:s},()=>1):[...new We(o,r,s,null,Js)]},super.visit(e.clone(a,r,s,0,c)))}visitNull(){return{}}visitBool({values:t,offset:e,length:s}){return{DATA:[...new We(t,e,s,null,Ws)]}}visitInt(t){return{DATA:t.type.bitWidth<64?[...t.values]:[...kt(t.values,2)]}}visitFloat(t){return{DATA:[...t.values]}}visitUtf8(t){return{DATA:[...new ht([t])],OFFSET:[...t.valueOffsets]}}visitBinary(t){return{DATA:[...Ms(new ht([t]))],OFFSET:[...t.valueOffsets]}}visitFixedSizeBinary(t){return{DATA:[...Ms(new ht([t]))]}}visitDate(t){return{DATA:t.type.unit===Ct.DAY?[...t.values]:[...kt(t.values,2)]}}visitTimestamp(t){return{DATA:[...kt(t.values,2)]}}visitTime(t){return{DATA:t.type.unit<Ft.MICROSECOND?[...t.values]:[...kt(t.values,2)]}}visitDecimal(t){return{DATA:[...kt(t.values,4)]}}visitList(t){return{OFFSET:[...t.valueOffsets],children:this.visitMany(t.type.children,t.children)}}visitStruct(t){return{children:this.visitMany(t.type.children,t.children)}}visitUnion(t){return{TYPE:[...t.typeIds],OFFSET:t.type.mode===vt.Dense?[...t.valueOffsets]:void 0,children:this.visitMany(t.type.children,t.children)}}visitInterval(t){return{DATA:[...t.values]}}visitFixedSizeList(t){return{children:this.visitMany(t.type.children,t.children)}}visitMap(t){return{OFFSET:[...t.valueOffsets],children:this.visitMany(t.type.children,t.children)}}}function*Ms(i){for(const t of i)yield t.reduce((e,s)=>`${e}${("0"+(s&255).toString(16)).slice(-2)}`,"").toUpperCase()}function*kt(i,t){const e=new Uint32Array(i.buffer);for(let s=-1,r=e.length/t;++s<r;)yield`${Ys.new(e.subarray((s+0)*t,(s+1)*t),!1)}`}class ue extends Be{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,e){throw new Error('"throughDOM" not available in this environment')}constructor(t){super();this._position=0,this._started=!1,this._sink=new Vt,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._dictionaryDeltaOffsets=new Map,Gs(t)||(t={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy=typeof t.autoDestroy=="boolean"?t.autoDestroy:!0,this._writeLegacyIpcFormat=typeof t.writeLegacyIpcFormat=="boolean"?t.writeLegacyIpcFormat:!1}toString(t=!1){return this._sink.toString(t)}toUint8Array(t=!1){return this._sink.toUint8Array(t)}writeAll(t){return dt(t)?t.then(e=>this.writeAll(e)):Nt(t)?Te(this,t):Ue(this,t)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(t){return this._sink.toDOMStream(t)}toNodeStream(t){return this._sink.toNodeStream(t)}close(){return this.reset()._sink.close()}abort(t){return this.reset()._sink.abort(t)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(t=this._sink,e=null){return t===this._sink||t instanceof Vt?this._sink=t:(this._sink=new Vt,t&&Hs(t)?this.toDOMStream({type:"bytes"}).pipeTo(t):t&&Ks(t)&&this.toNodeStream({objectMode:!1}).pipe(t)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._dictionaryDeltaOffsets=new Map,(!e||!we(e,this._schema))&&(e==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=e,this._writeSchema(e))),this}write(t){let e=null;if(this._sink){if(t==null)return this.finish()&&void 0;if(t instanceof Lt&&!(e=t.schema))return this.finish()&&void 0;if(t instanceof Rt&&!(e=t.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(e&&!we(e,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,e)}t instanceof Rt?t instanceof me||this._writeRecordBatch(t):t instanceof Lt?this.writeAll(t.batches):_e(t)&&this.writeAll(t)}_writeMessage(t,e=8){const s=e-1,r=O.encode(t),n=r.byteLength,o=this._writeLegacyIpcFormat?4:8,a=n+o+s&~s,c=a-n-o;return t.headerType===b.RecordBatch?this._recordBatchBlocks.push(new X(a,t.bodyLength,this._position)):t.headerType===b.DictionaryBatch&&this._dictionaryBlocks.push(new X(a,t.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(a-o)),n>0&&this._write(r),this._writePadding(c)}_write(t){if(this._started){const e=T(t);e&&e.byteLength>0&&(this._sink.write(e),this._position+=e.byteLength)}return this}_writeSchema(t){return this._writeMessage(O.from(t))}_writeFooter(t){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(Pt)}_writePadding(t){return t>0?this._write(new Uint8Array(t)):this}_writeRecordBatch(t){const{byteLength:e,nodes:s,bufferRegions:r,buffers:n}=g.assemble(t),o=new V(t.numRows,s,r),a=O.from(o,e);return this._writeDictionaries(t)._writeMessage(a)._writeBodyBuffers(n)}_writeDictionaryBatch(t,e,s=!1){this._dictionaryDeltaOffsets.set(e,t.length+(this._dictionaryDeltaOffsets.get(e)||0));const{byteLength:r,nodes:n,bufferRegions:o,buffers:a}=g.assemble(new ht([t])),c=new V(t.length,n,o),d=new tt(c,e,s),h=O.from(d,r);return this._writeMessage(h)._writeBodyBuffers(a)}_writeBodyBuffers(t){let e,s,r;for(let n=-1,o=t.length;++n<o;)(e=t[n])&&(s=e.byteLength)>0&&(this._write(e),(r=(s+7&~7)-s)>0&&this._writePadding(r));return this}_writeDictionaries(t){for(let[e,s]of t.dictionaries){let r=this._dictionaryDeltaOffsets.get(e)||0;if(r===0||(s=s==null?void 0:s.slice(r)).length>0)for(const n of s.data)this._writeDictionaryBatch(n,e,r>0),r+=n.length}return this}}class fe extends ue{static writeAll(t,e){const s=new fe(e);return dt(t)?t.then(r=>s.writeAll(r)):Nt(t)?Te(s,t):Ue(s,t)}}class le extends ue{static writeAll(t){const e=new le;return dt(t)?t.then(s=>e.writeAll(s)):Nt(t)?Te(e,t):Ue(e,t)}constructor(){super();this._autoDestroy=!0}_writeSchema(t){return this._writeMagic()._writePadding(2)}_writeFooter(t){const e=Mt.encode(new Mt(t,j.V4,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(t)._write(e)._write(Int32Array.of(e.byteLength))._writeMagic()}}class Ve extends ue{static writeAll(t){return new Ve().writeAll(t)}constructor(){super();this._autoDestroy=!0,this._recordBatches=[],this._dictionaries=[]}_writeMessage(){return this}_writeFooter(t){return this}_writeSchema(t){return this._write(`{
  "schema": ${JSON.stringify({fields:t.fields.map(e=>Vs(e))},null,2)}`)}_writeDictionaries(t){return t.dictionaries.size>0&&this._dictionaries.push(t),this}_writeDictionaryBatch(t,e,s=!1){return this._dictionaryDeltaOffsets.set(e,t.length+(this._dictionaryDeltaOffsets.get(e)||0)),this._write(this._dictionaryBlocks.length===0?"    ":`,
    `),this._write(`${tr(t,e,s)}`),this._dictionaryBlocks.push(new X(0,0,0)),this}_writeRecordBatch(t){return this._writeDictionaries(t),this._recordBatches.push(t),this}close(){if(this._dictionaries.length>0){this._write(`,
  "dictionaries": [
`);for(const t of this._dictionaries)super._writeDictionaries(t);this._write(`
  ]`)}if(this._recordBatches.length>0){for(let t=-1,e=this._recordBatches.length;++t<e;)this._write(t===0?`,
  "batches": [
    `:`,
    `),this._write(`${er(this._recordBatches[t])}`),this._recordBatchBlocks.push(new X(0,0,0));this._write(`
  ]`)}return this._schema&&this._write(`
}`),this._dictionaries=[],this._recordBatches=[],super.close()}}function Ue(i,t){let e=t;t instanceof Lt&&(e=t.batches,i.reset(void 0,t.schema));for(const s of e)i.write(s);return i.finish()}function Te(i,t){var e,s,r,n,o,a,c;return u(this,void 0,void 0,function*(){try{for(e=!0,s=Kt(t);r=yield s.next(),n=r.done,!n;e=!0){c=r.value,e=!1;const d=c;i.write(d)}}catch(d){o={error:d}}finally{try{!e&&!n&&(a=s.return)&&(yield a.call(s))}finally{if(o)throw o.error}}return i.finish()})}function Vs({name:i,type:t,nullable:e}){const s=new Xi;return{name:i,nullable:e,type:s.visit(t),children:(t.children||[]).map(r=>Vs(r)),dictionary:D.isDictionary(t)?{id:t.id,isOrdered:t.isOrdered,indexType:s.visit(t.indices)}:void 0}}function tr(i,t,e=!1){const[s]=he.assemble(new Rt({[t]:i}));return JSON.stringify({id:t,isDelta:e,data:{count:i.length,columns:s}},null,2)}function er(i){const[t]=he.assemble(i);return JSON.stringify({count:i.numRows,columns:t},null,2)}function Us(i){const t=st.from(i);return dt(t)?t.then(e=>Us(e)):t.isAsync()?t.readAll().then(e=>new Lt(e)):new Lt(t.readAll())}function sr(i,t="stream"){return(t==="stream"?fe:le).writeAll(i).toUint8Array(!0)}const ir=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Zs),bi),Qs),qs),Xs),ti),{compareSchemas:we,compareFields:ei,compareTypes:si});export{Vt as A,Ut as B,Ss as J,Tt as M,st as R,yt as a,Le as b,Et as c,ue as d,le as e,fe as f,Os as g,jt as h,Ve as i,sr as j,Fe as k,Is as l,O as m,L as s,Us as t,ir as u};export default null;
