import{I as y,J as v,V as B,m as V,M as m,K as T}from"./vector-2228b801.js";import{Q as w}from"./type-9c6ae821.js";function M(n){if(!n||n.length<=0)return function(i){return!0};let t="";const e=n.filter(s=>s===s);return e.length>0&&(t=`
    switch (x) {${e.map(s=>`
        case ${I(s)}:`).join("")}
            return false;
    }`),n.length!==e.length&&(t=`if (x !== x) return false;
${t}`),new Function("x",`${t}
return true;`)}function I(n){return typeof n!="bigint"?y(n):`${y(n)}n`}const c=(n,t)=>(Math.ceil(n)*t+63&~63||64)/t,N=(n,t=0)=>n.length>=t?n.subarray(0,t):v(new n.constructor(t),n,0);class p{constructor(t,e=1){this.buffer=t,this.stride=e,this.BYTES_PER_ELEMENT=t.BYTES_PER_ELEMENT,this.ArrayType=t.constructor,this._resize(this.length=Math.ceil(t.length/e))}get byteLength(){return Math.ceil(this.length*this.stride)*this.BYTES_PER_ELEMENT}get reservedLength(){return this.buffer.length/this.stride}get reservedByteLength(){return this.buffer.byteLength}set(t,e){return this}append(t){return this.set(this.length,t)}reserve(t){if(t>0){this.length+=t;const e=this.stride,s=this.length*e,i=this.buffer.length;s>=i&&this._resize(i===0?c(s*1,this.BYTES_PER_ELEMENT):c(s*2,this.BYTES_PER_ELEMENT))}return this}flush(t=this.length){t=c(t*this.stride,this.BYTES_PER_ELEMENT);const e=N(this.buffer,t);return this.clear(),e}clear(){return this.length=0,this._resize(0),this}_resize(t){return this.buffer=v(new this.ArrayType(t),this.buffer)}}p.prototype.offset=0;class f extends p{last(){return this.get(this.length-1)}get(t){return this.buffer[t]}set(t,e){return this.reserve(t-this.length+1),this.buffer[t*this.stride]=e,this}}class E extends f{constructor(t=new Uint8Array(0)){super(t,1/8);this.numValid=0}get numInvalid(){return this.length-this.numValid}get(t){return this.buffer[t>>3]>>t%8&1}set(t,e){const{buffer:s}=this.reserve(t-this.length+1),i=t>>3,h=t%8,r=s[i]>>h&1;return e?r===0&&(s[i]|=1<<h,++this.numValid):r===1&&(s[i]&=~(1<<h),--this.numValid),this}clear(){return this.numValid=0,super.clear()}}class b extends f{constructor(t=new Int32Array(1)){super(t,1)}append(t){return this.set(this.length-1,t)}set(t,e){const s=this.length-1,i=this.reserve(t-s+1).buffer;return s<t++&&i.fill(i[s],s,t),i[t]=i[t-1]+e,this}flush(t=this.length-1){return t>this.length&&this.set(t-1,0),super.flush(t+1)}}class l{static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t){throw new Error('"throughDOM" not available in this environment')}constructor({type:t,nullValues:e}){this.length=0,this.finished=!1,this.type=t,this.children=[],this.nullValues=e,this.stride=w(t),this._nulls=new E,e&&e.length>0&&(this._isValid=M(e))}toVector(){return new B([this.flush()])}get ArrayType(){return this.type.ArrayType}get nullCount(){return this._nulls.numInvalid}get numChildren(){return this.children.length}get byteLength(){let t=0;const{_offsets:e,_values:s,_nulls:i,_typeIds:h,children:r}=this;return e&&(t+=e.byteLength),s&&(t+=s.byteLength),i&&(t+=i.byteLength),h&&(t+=h.byteLength),r.reduce((a,d)=>a+d.byteLength,t)}get reservedLength(){return this._nulls.reservedLength}get reservedByteLength(){let t=0;return this._offsets&&(t+=this._offsets.reservedByteLength),this._values&&(t+=this._values.reservedByteLength),this._nulls&&(t+=this._nulls.reservedByteLength),this._typeIds&&(t+=this._typeIds.reservedByteLength),this.children.reduce((e,s)=>e+s.reservedByteLength,t)}get valueOffsets(){return this._offsets?this._offsets.buffer:null}get values(){return this._values?this._values.buffer:null}get nullBitmap(){return this._nulls?this._nulls.buffer:null}get typeIds(){return this._typeIds?this._typeIds.buffer:null}append(t){return this.set(this.length,t)}isValid(t){return this._isValid(t)}set(t,e){return this.setValid(t,this.isValid(e))&&this.setValue(t,e),this}setValue(t,e){this._setValue(this,t,e)}setValid(t,e){return this.length=this._nulls.set(t,+e).length,e}addChild(t,e=`${this.numChildren}`){throw new Error(`Cannot append children to non-nested type "${this.type}"`)}getChildAt(t){return this.children[t]||null}flush(){let t,e,s,i;const{type:h,length:r,nullCount:a,_typeIds:d,_offsets:u,_values:o,_nulls:g}=this;(e=d==null?void 0:d.flush(r))?i=u==null?void 0:u.flush(r):(i=u==null?void 0:u.flush(r))?t=o==null?void 0:o.flush(u.last()):t=o==null?void 0:o.flush(r),a>0&&(s=g==null?void 0:g.flush(r));const _=this.children.map(L=>L.flush());return this.clear(),V({type:h,length:r,nullCount:a,children:_,child:_[0],data:t,typeIds:e,nullBitmap:s,valueOffsets:i})}finish(){this.finished=!0;for(const t of this.children)t.finish();return this}clear(){var t,e,s,i;this.length=0,(t=this._nulls)===null||t===void 0||t.clear(),(e=this._values)===null||e===void 0||e.clear(),(s=this._offsets)===null||s===void 0||s.clear(),(i=this._typeIds)===null||i===void 0||i.clear();for(const h of this.children)h.clear();return this}}l.prototype.length=1,l.prototype.stride=1,l.prototype.children=null,l.prototype.finished=!1,l.prototype.nullValues=null,l.prototype._isValid=()=>!0;class A extends l{constructor(t){super(t);this._values=new f(new this.ArrayType(0),this.stride)}setValue(t,e){const s=this._values;return s.reserve(t-s.length+1),super.setValue(t,e)}}class C extends l{constructor(t){super(t);this._pendingLength=0,this._offsets=new b}setValue(t,e){const s=this._pending||(this._pending=new Map),i=s.get(t);i&&(this._pendingLength-=i.length),this._pendingLength+=e instanceof m?e[T].length:e.length,s.set(t,e)}setValid(t,e){return super.setValid(t,e)?!0:((this._pending||(this._pending=new Map)).set(t,void 0),!1)}clear(){return this._pendingLength=0,this._pending=void 0,super.clear()}flush(){return this._flush(),super.flush()}finish(){return this._flush(),super.finish()}_flush(){const t=this._pending,e=this._pendingLength;return this._pendingLength=0,this._pending=void 0,t&&t.size>0&&this._flushPending(t,e),this}}export{l as B,f as D,A as F,b as O,C as V,p as a,E as b};export default null;
