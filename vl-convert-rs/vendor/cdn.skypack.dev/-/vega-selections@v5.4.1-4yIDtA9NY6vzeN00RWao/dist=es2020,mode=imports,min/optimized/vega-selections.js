import{bisector as F,union as M,intersection as C}from"/-/d3-array@v3.2.2-mREp9VYvdluM4XTkemzD/dist=es2020,mode=imports,min/optimized/d3-array.js";import{field as N,extend as S,array as k,toNumber as _,error as q,peek as B,hasOwnProperty as X,isDate as A,isArray as H,inrange as P}from"/-/vega-util@v1.17.1-uwuqwLZrXXBeO0DFYRgh/dist=es2020,mode=imports,min/optimized/vega-util.js";import{Literal as J}from"/-/vega-expression@v5.0.1-M3HJnXNS0AVPna9ohQFr/dist=es2020,mode=imports,min/optimized/vega-expression.js";const $="intersect",L="union",Q="vlMulti",Z="vlPoint",V="or",K="and",p="_vgsid_",x=N(p),W="E",b="R",ee="R-E",te="R-LE",ie="R-RE",I="index:unit";function G(n,t){for(var i=t.fields,e=t.values,u=i.length,r=0,f,s;r<u;++r)if(s=i[r],s.getter=N.getter||N(s.field),f=s.getter(n),A(f)&&(f=_(f)),A(e[r])&&(e[r]=_(e[r])),A(e[r][0])&&(e[r]=e[r].map(_)),s.type===W){if(H(e[r])?e[r].indexOf(f)<0:f!==e[r])return!1}else if(s.type===b){if(!P(f,e[r]))return!1}else if(s.type===ie){if(!P(f,e[r],!0,!1))return!1}else if(s.type===ee){if(!P(f,e[r],!1,!1))return!1}else if(s.type===te&&!P(f,e[r],!1,!0))return!1;return!0}function ne(n,t,i){for(var e=this.context.data[n],u=e?e.values.value:[],r=e?e[I]&&e[I].value:void 0,f=i===$,s=u.length,d=0,c,m,h,o,l;d<s;++d)if(c=u[d],r&&f){if(m=m||{},h=m[o=c.unit]||0,h===-1)continue;if(l=G(t,c),m[o]=l?-1:++h,l&&r.size===1)return!0;if(!l&&h===r.get(o).count)return!1}else if(l=G(t,c),f^l)return l;return s&&f}const U=F(x),re=U.left,fe=U.right;function se(n,t,i){const e=this.context.data[n],u=e?e.values.value:[],r=e?e[I]&&e[I].value:void 0,f=i===$,s=x(t),d=re(u,s);if(d===u.length)return!1;if(x(u[d])!==s)return!1;if(r&&f){if(r.size===1)return!0;if(fe(u,s)-d<r.size)return!1}return!0}function ue(n,t){return n.map(i=>S(t.fields?{values:t.fields.map(e=>(e.getter||(e.getter=N(e.field)))(i.datum))}:{[p]:x(i.datum)},t))}function le(n,t,i,e){for(var u=this.context.data[n],r=u?u.values.value:[],f={},s={},d={},c,m,h,o,l,O,E,g,z,D,w=r.length,T=0,R,Y;T<w;++T)if(c=r[T],o=c.unit,m=c.fields,h=c.values,m&&h){for(R=0,Y=m.length;R<Y;++R)l=m[R],E=f[l.field]||(f[l.field]={}),g=E[o]||(E[o]=[]),d[l.field]=z=l.type.charAt(0),D=j[`${z}_union`],E[o]=D(g,k(h[R]));i&&(g=s[o]||(s[o]=[]),g.push(k(h).reduce((v,a,y)=>(v[m[y].field]=a,v),{})))}else l=p,O=x(c),E=f[l]||(f[l]={}),g=E[o]||(E[o]=[]),g.push(O),i&&(g=s[o]||(s[o]=[]),g.push({[p]:O}));if(t=t||L,f[p]?f[p]=j[`${p}_${t}`](...Object.values(f[p])):Object.keys(f).forEach(v=>{f[v]=Object.keys(f[v]).map(a=>f[v][a]).reduce((a,y)=>a===void 0?y:j[`${d[v]}_${t}`](a,y))}),r=Object.keys(s),i&&r.length){const v=e?Z:Q;f[v]=t===L?{[V]:r.reduce((a,y)=>(a.push(...s[y]),a),[])}:{[K]:r.map(a=>({[V]:s[a]}))}}return f}var j={[`${p}_union`]:M,[`${p}_intersect`]:C,E_union:function(n,t){if(!n.length)return t;for(var i=0,e=t.length;i<e;++i)n.indexOf(t[i])<0&&n.push(t[i]);return n},E_intersect:function(n,t){return n.length?n.filter(i=>t.indexOf(i)>=0):t},R_union:function(n,t){var i=_(t[0]),e=_(t[1]);return i>e&&(i=t[1],e=t[0]),n.length?(n[0]>i&&(n[0]=i),n[1]<e&&(n[1]=e),n):[i,e]},R_intersect:function(n,t){var i=_(t[0]),e=_(t[1]);return i>e&&(i=t[1],e=t[0]),n.length?e<n[0]||n[1]<i?[]:(n[0]<i&&(n[0]=i),n[1]>e&&(n[1]=e),n):[i,e]}};const oe=":",de="@";function ae(n,t,i,e){t[0].type!==J&&q("First argument to selection functions must be a string literal.");const u=t[0].value,r=t.length>=2&&B(t).value,f="unit",s=de+f,d=oe+u;r===$&&!X(e,s)&&(e[s]=i.getData(u).indataRef(i,f)),X(e,d)||(e[d]=i.getData(u).tuplesRef())}export{se as selectionIdTest,le as selectionResolve,ne as selectionTest,ue as selectionTuples,ae as selectionVisitor};export default null;
