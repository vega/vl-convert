import{Transform as p}from"/-/vega-dataflow@v5.7.6-WDoszrJUyhTwz7sPwzda/dist=es2020,mode=imports,min/optimized/vega-dataflow.js";import{inherits as k,array as v,isFunction as d,accessorFields as x,hasOwnProperty as F,error as M}from"/-/vega-util@v1.17.2-LUfkDhormMyfWqy3Ts6U/dist=es2020,mode=imports,min/optimized/vega-util.js";import{forceSimulation as w,forceCenter as D,forceCollide as z,forceManyBody as j,forceLink as P,forceX as T,forceY as U}from"/-/d3-force@v3.0.0-cshj62qMoyIGNIXoil9u/dist=es2020,mode=imports,min/optimized/d3-force.js";const y={center:D,collide:z,nbody:j,link:P,x:T,y:U},s="forces",u=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],C=["static","iterations"],h=["x","y","vx","vy"];function l(e){p.call(this,null,e)}l.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30,expr:!0},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:h}]},k(l,p,{transform(e,t){var r=this.value,n=t.changed(t.ADD_REM),o=e.modified(u),a=e.iterations||300;if(r?(n&&(t.modifies("index"),r.nodes(t.source)),(o||t.changed(t.MOD))&&g(r,e,0,t)):(this.value=r=q(t.source,e),r.on("tick",O(t.dataflow,this)),e.static||(n=!0,r.tick()),t.modifies("index")),o||n||e.modified(C)||t.changed()&&e.restart){if(r.alpha(Math.max(r.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(r.alphaMin(),1/a)),e.static)for(r.stop();--a>=0;)r.tick();else if(r.stopped()&&r.restart(),!n)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const r=t.dataflow;for(let i=this._argops,m=0,b=i.length,c;m<b;++m){if(c=i[m],c.name!==s||c.op._argval.force!=="link")continue;for(var n=c.op._argops,o=0,a=n.length,f;o<a;++o)if(n[o].name==="links"&&(f=n[o].op.source)){r.pulse(f,r.changeset().reflow());break}}return t.reflow(e.modified()).modifies(h)}});function O(e,t){return()=>e.touch(t).run()}function q(e,t){const r=w(e),n=r.stop,o=r.restart;let a=!1;return r.stopped=()=>a,r.restart=()=>(a=!1,o()),r.stop=()=>(a=!0,n()),g(r,t,!0).on("end",()=>a=!0)}function g(e,t,r,n){var o=v(t.forces),a,f,i,m;for(a=0,f=u.length;a<f;++a)i=u[a],i!==s&&t.modified(i)&&e[i](t[i]);for(a=0,f=o.length;a<f;++a)m=s+a,i=r||t.modified(s,a)?L(o[a]):n&&I(o[a],n)?e.force(m):null,i&&e.force(m,i);for(f=e.numForces||0;a<f;++a)e.force(s+a,null);return e.numForces=o.length,e}function I(e,t){var r,n;for(r in e)if(d(n=e[r])&&t.modified(x(n)))return 1;return 0}function L(e){var t,r;F(y,e.force)||M("Unrecognized force: "+e.force),t=y[e.force]();for(r in e)d(t[r])&&S(t[r],e[r],e);return t}function S(e,t,r){e(d(t)?n=>t(n,r):t)}export{l as force};export default null;
