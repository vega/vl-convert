import{Transform as h,ingest as k,tupleid as me,stableCompare as N}from"/-/vega-dataflow@v5.7.5-asKYS4gpPLMPf64pSozt/dist=es2020,mode=imports,min/optimized/vega-dataflow.js";import{tickCount as C,tickFormat as ce,validTicks as ue,tickValues as he,SymbolLegend as L,labelFormat as ge,labelValues as pe,GradientLegend as ve,scaleFraction as Me,labelFraction as ye,scale as Se,isContinuous as U,Sequential as z,Linear as R,Time as ke,UTC as De,Pow as F,Sqrt as T,Ordinal as Y,scaleImplicit as be,Log as xe,Symlog as we,isLogarithmic as ze,BinOrdinal as j,bandSpace as Ae,isInterpolating as X,interpolateRange as Ce,quantizeInterpolator as Le,interpolateColors as G,interpolate as Re,Band as Oe,Point as $,scheme as Pe,Threshold as Ee,Quantile as Ie,Quantize as Ne,Diverging as Ue}from"/-/vega-scale@v7.3.0-RE8rHwByiw8oUoAe4pNs/dist=es2020,mode=imports,min/optimized/vega-scale.js";import{inherits as y,isArray as A,error as x,falsy as D,isFunction as b,constant as Fe,peek as w,fastmap as q,one as B,toSet as Te,isString as Ye,zoomLog as je,zoomPow as Q,zoomSymlog as Xe,zoomLinear as Ge,stringValue as $e}from"/-/vega-util@v1.17.2-LUfkDhormMyfWqy3Ts6U/dist=es2020,mode=imports,min/optimized/vega-util.js";import{sum as qe,range as V}from"/-/d3-array@v3.2.3-YYAnwYSQZgGML08QhecQ/dist=es2020,mode=imports,min/optimized/d3-array.js";import{interpolateRound as Be,interpolate as Qe}from"/-/d3-interpolate@v3.0.1-i9AsUdFHwyaukRBWNe8d/dist=es2020,mode=imports,min/optimized/d3-interpolate.js";function H(e){h.call(this,null,e)}y(H,h,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),a=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,o=e.scale,l=e.count==null?e.values?e.values.length:10:e.count,r=C(o,l,e.minstep),s=e.format||ce(n,o,r,e.formatSpecifier,e.formatType,!!e.values),d=e.values?ue(o,e.values,r):he(o,r);return i&&(a.rem=i),i=d.map((f,m)=>k({index:m/(d.length-1||1),value:f,label:s(f)})),e.extra&&i.length&&i.push(k({index:-1,extra:{value:i[0].value},label:""})),a.source=i,a.add=i,this.value=i,a}});function Z(e){h.call(this,null,e)}function Ve(){return k({})}function He(e){const t=q().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}y(Z,h,{transform(e,t){var n=t.dataflow,a=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||Ve,o=e.key||me,l=this.value;return A(a.encode)&&(a.encode=null),l&&(e.modified("key")||t.modified(o))&&x("DataJoin does not support modified key function or fields."),l||(t=t.addAll(),this.value=l=He(o)),t.visit(t.ADD,r=>{const s=o(r);let d=l.get(s);d?d.exit?(l.empty--,a.add.push(d)):a.mod.push(d):(d=i(r),l.set(s,d),a.add.push(d)),d.datum=r,d.exit=!1}),t.visit(t.MOD,r=>{const s=o(r),d=l.get(s);d&&(d.datum=r,a.mod.push(d))}),t.visit(t.REM,r=>{const s=o(r),d=l.get(s);r===d.datum&&!d.exit&&(a.rem.push(d),d.exit=!0,++l.empty)}),t.changed(t.ADD_MOD)&&a.modifies("datum"),(t.clean()||e.clean&&l.empty>n.cleanThreshold)&&n.runAfter(l.clean),a}});function K(e){h.call(this,null,e)}y(K,h,{transform(e,t){var n=t.fork(t.ADD_REM),a=e.mod||!1,i=e.encoders,o=t.encode;if(A(o))if(n.changed()||o.every(m=>i[m]))o=o[0],n.encode=null;else return t.StopPropagation;var l=o==="enter",r=i.update||D,s=i.enter||D,d=i.exit||D,f=(o&&!l?i[o]:r)||D;if(t.changed(t.ADD)&&(t.visit(t.ADD,m=>{s(m,e),r(m,e)}),n.modifies(s.output),n.modifies(r.output),f!==D&&f!==r&&(t.visit(t.ADD,m=>{f(m,e)}),n.modifies(f.output))),t.changed(t.REM)&&d!==D&&(t.visit(t.REM,m=>{d(m,e)}),n.modifies(d.output)),l||f!==D){const m=t.MOD|(e.modified()?t.REFLOW:0);l?(t.visit(m,c=>{const g=s(c,e)||a;(f(c,e)||g)&&n.mod.push(c)}),n.mod.length&&n.modifies(s.output)):t.visit(m,c=>{(f(c,e)||a)&&n.mod.push(c)}),n.mod.length&&n.modifies(f.output)}return n.changed()?n:t.StopPropagation}});function W(e){h.call(this,[],e)}y(W,h,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),a=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,o=e.type||L,l=e.scale,r=+e.limit,s=C(l,e.count==null?5:e.count,e.minstep),d=!!e.values||o===L,f=e.format||ge(n,l,s,o,e.formatSpecifier,e.formatType,d),m=e.values||pe(l,s),c,g,u,M,S;return i&&(a.rem=i),o===L?(r&&m.length>r?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),i=m.slice(0,r-1),S=!0):i=m,b(u=e.size)?(!e.values&&l(i[0])===0&&(i=i.slice(1)),M=i.reduce((p,v)=>Math.max(p,u(v,e)),0)):u=Fe(M=u||8),i=i.map((p,v)=>k({index:v,label:f(p,v,i),value:p,offset:M,size:u(p,e)})),S&&(S=m[i.length],i.push(k({index:i.length,label:`\u2026${m.length-i.length} entries`,value:S,offset:M,size:u(S,e)})))):o===ve?(c=l.domain(),g=Me(l,c[0],w(c)),m.length<3&&!e.values&&c[0]!==w(c)&&(m=[c[0],w(c)]),i=m.map((p,v)=>k({index:v,label:f(p,v,m),value:p,perc:g(p)}))):(u=m.length-1,g=ye(l),i=m.map((p,v)=>k({index:v,label:f(p,v,m),value:p,perc:v?g(p):0,perc2:v===u?1:g(m[v+1])}))),a.source=i,a.add=i,this.value=i,a}});const Ze=e=>e.source.x,Ke=e=>e.source.y,We=e=>e.target.x,Je=e=>e.target.y;function O(e){h.call(this,{},e)}O.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},y(O,h,{transform(e,t){var n=e.sourceX||Ze,a=e.sourceY||Ke,i=e.targetX||We,o=e.targetY||Je,l=e.as||"path",r=e.orient||"vertical",s=e.shape||"line",d=te.get(s+"-"+r)||te.get(s);return d||x("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,f=>{f[l]=d(n(f),a(f),i(f),o(f))}),t.reflow(e.modified()).modifies(l)}});const J=(e,t,n,a)=>"M"+e+","+t+"L"+n+","+a,_e=(e,t,n,a)=>J(t*Math.cos(e),t*Math.sin(e),a*Math.cos(n),a*Math.sin(n)),_=(e,t,n,a)=>{var i=n-e,o=a-t,l=Math.hypot(i,o)/2,r=180*Math.atan2(o,i)/Math.PI;return"M"+e+","+t+"A"+l+","+l+" "+r+" 0 1 "+n+","+a},et=(e,t,n,a)=>_(t*Math.cos(e),t*Math.sin(e),a*Math.cos(n),a*Math.sin(n)),ee=(e,t,n,a)=>{const i=n-e,o=a-t,l=.2*(i+o),r=.2*(o-i);return"M"+e+","+t+"C"+(e+l)+","+(t+r)+" "+(n+r)+","+(a-l)+" "+n+","+a},tt=(e,t,n,a)=>ee(t*Math.cos(e),t*Math.sin(e),a*Math.cos(n),a*Math.sin(n)),nt=(e,t,n,a)=>"M"+e+","+t+"V"+a+"H"+n,it=(e,t,n,a)=>"M"+e+","+t+"H"+n+"V"+a,at=(e,t,n,a)=>{const i=Math.cos(e),o=Math.sin(e),l=Math.cos(n),r=Math.sin(n),s=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*i+","+t*o+"A"+t+","+t+" 0 0,"+(s?1:0)+" "+t*l+","+t*r+"L"+a*l+","+a*r},ot=(e,t,n,a)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+a+" "+n+","+a},rt=(e,t,n,a)=>{const i=(t+a)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+a},lt=(e,t,n,a)=>{const i=Math.cos(e),o=Math.sin(e),l=Math.cos(n),r=Math.sin(n),s=(t+a)/2;return"M"+t*i+","+t*o+"C"+s*i+","+s*o+" "+s*l+","+s*r+" "+a*l+","+a*r},te=q({line:J,"line-radial":_e,arc:_,"arc-radial":et,curve:ee,"curve-radial":tt,"orthogonal-horizontal":nt,"orthogonal-vertical":it,"orthogonal-radial":at,"diagonal-horizontal":ot,"diagonal-vertical":rt,"diagonal-radial":lt});function P(e){h.call(this,null,e)}P.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},y(P,h,{transform(e,t){var n=e.as||["startAngle","endAngle"],a=n[0],i=n[1],o=e.field||B,l=e.startAngle||0,r=e.endAngle!=null?e.endAngle:2*Math.PI,s=t.source,d=s.map(o),f=d.length,m=l,c=(r-l)/qe(d),g=V(f),u,M,S;for(e.sort&&g.sort((p,v)=>d[p]-d[v]),u=0;u<f;++u)S=d[g[u]],M=s[g[u]],M[a]=m,M[i]=m+=S*c;return this.value=d,t.reflow(e.modified()).modifies(n)}});const st=5;function dt(e){const t=e.type;return!e.bins&&(t===R||t===F||t===T)}function ne(e){return U(e)&&e!==z}const ft=Te(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function ie(e){h.call(this,null,e),this.modified(!0)}y(ie,h,{transform(e,t){var n=t.dataflow,a=this.value,i=mt(e);(!a||i!==a.type)&&(this.value=a=Se(i)());for(i in e)if(!ft[i]){if(i==="padding"&&ne(a.type))continue;b(a[i])?a[i](e[i]):n.warn("Unsupported scale property: "+i)}return vt(a,e,pt(a,e,ut(a,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function mt(e){var t=e.type,n="",a;return t===z?z+"-"+R:(ct(e)&&(a=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=a===2?z+"-":a===3?Ue+"-":""),(n+t||R).toLowerCase())}function ct(e){const t=e.type;return U(t)&&t!==ke&&t!==De&&(e.scheme||e.range&&e.range.length&&e.range.every(Ye))}function ut(e,t,n){const a=ht(e,t.domainRaw,n);if(a>-1)return a;var i=t.domain,o=e.type,l=t.zero||t.zero===void 0&&dt(e),r,s;if(!i)return 0;if(ne(o)&&t.padding&&i[0]!==w(i)&&(i=gt(o,i,t.range,t.padding,t.exponent,t.constant)),(l||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(r=(i=i.slice()).length-1||1,l&&(i[0]>0&&(i[0]=0),i[r]<0&&(i[r]=0)),t.domainMin!=null&&(i[0]=t.domainMin),t.domainMax!=null&&(i[r]=t.domainMax),t.domainMid!=null)){s=t.domainMid;const d=s>i[r]?r+1:s<i[0]?0:r;d!==r&&n.warn("Scale domainMid exceeds domain min or max.",s),i.splice(d,0,s)}return e.domain(ae(o,i,n)),o===Y&&e.unknown(t.domainImplicit?be:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&C(e,t.nice)||null),i.length}function ht(e,t,n){return t?(e.domain(ae(e.type,t,n)),t.length):-1}function gt(e,t,n,a,i,o){var l=Math.abs(w(n)-n[0]),r=l/(l-2*a),s=e===xe?je(t,null,r):e===T?Q(t,null,r,.5):e===F?Q(t,null,r,i||1):e===we?Xe(t,null,r,o||1):Ge(t,null,r);return t=t.slice(),t[0]=s[0],t[t.length-1]=s[1],t}function ae(e,t,n){if(ze(e)){var a=Math.abs(t.reduce((i,o)=>i+(o<0?-1:o>0?1:0),0));a!==t.length&&n.warn("Log scale domain includes zero: "+$e(t))}return t}function pt(e,t,n){let a=t.bins;if(a&&!A(a)){const i=e.domain(),o=i[0],l=w(i),r=a.step;let s=a.start==null?o:a.start,d=a.stop==null?l:a.stop;r||x("Scale bins parameter missing step property."),s<o&&(s=r*Math.ceil(o/r)),d>l&&(d=r*Math.floor(l/r)),a=V(s,d+r/2,r)}return a?e.bins=a:e.bins&&delete e.bins,e.type===j&&(a?!t.domain&&!t.domainRaw&&(e.domain(a),n=a.length):e.bins=e.domain()),n}function vt(e,t,n){var a=e.type,i=t.round||!1,o=t.range;if(t.rangeStep!=null)o=Mt(a,t,n);else if(t.scheme&&(o=yt(a,t,n),b(o))){if(e.interpolator)return e.interpolator(o);x(`Scale type ${a} does not support interpolating color schemes.`)}if(o&&X(a))return e.interpolator(G(E(o,t.reverse),t.interpolate,t.interpolateGamma));o&&t.interpolate&&e.interpolate?e.interpolate(Re(t.interpolate,t.interpolateGamma)):b(e.round)?e.round(i):b(e.rangeRound)&&e.interpolate(i?Be:Qe),o&&e.range(E(o,t.reverse))}function Mt(e,t,n){e!==Oe&&e!==$&&x("Only band and point scales support rangeStep.");var a=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,i=e===$?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*Ae(n,i,a)]}function yt(e,t,n){var a=t.schemeExtent,i,o;return A(t.scheme)?o=G(t.scheme,t.interpolate,t.interpolateGamma):(i=t.scheme.toLowerCase(),o=Pe(i),o||x(`Unrecognized scheme name: ${t.scheme}`)),n=e===Ee?n+1:e===j?n-1:e===Ie||e===Ne?+t.schemeCount||st:n,X(e)?oe(o,a,t.reverse):b(o)?Le(oe(o,a),n):e===Y?o:o.slice(0,n)}function oe(e,t,n){return b(e)&&(t||n)?Ce(e,E(t||[0,1],n)):e}function E(e,t){return t?e.slice().reverse():e}function re(e){h.call(this,null,e)}y(re,h,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(N(e.sort)),this.modified(n),t}});const le="zero",se="center",de="normalize",fe=["y0","y1"];function I(e){h.call(this,null,e)}I.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:le,values:[le,se,de]},{name:"as",type:"string",array:!0,length:2,default:fe}]},y(I,h,{transform(e,t){var n=e.as||fe,a=n[0],i=n[1],o=N(e.sort),l=e.field||B,r=e.offset===se?St:e.offset===de?kt:Dt,s,d,f,m;for(s=bt(t.source,e.groupby,o,l),d=0,f=s.length,m=s.max;d<f;++d)r(s[d],m,l,a,i);return t.reflow(e.modified()).modifies(n)}});function St(e,t,n,a,i){for(var o=(t-e.sum)/2,l=e.length,r=0,s;r<l;++r)s=e[r],s[a]=o,s[i]=o+=Math.abs(n(s))}function kt(e,t,n,a,i){for(var o=1/e.sum,l=0,r=e.length,s=0,d=0,f;s<r;++s)f=e[s],f[a]=l,f[i]=l=o*(d+=Math.abs(n(f)))}function Dt(e,t,n,a,i){for(var o=0,l=0,r=e.length,s=0,d,f;s<r;++s)f=e[s],d=+n(f),d<0?(f[a]=l,f[i]=l+=d):(f[a]=o,f[i]=o+=d)}function bt(e,t,n,a){var i=[],o=M=>M(f),l,r,s,d,f,m,c,g,u;if(t==null)i.push(e.slice());else for(l={},r=0,s=e.length;r<s;++r)f=e[r],m=t.map(o),c=l[m],c||(l[m]=c=[],i.push(c)),c.push(f);for(m=0,u=0,d=i.length;m<d;++m){for(c=i[m],r=0,g=0,s=c.length;r<s;++r)g+=Math.abs(a(c[r]));c.sum=g,g>u&&(u=g),n&&c.sort(n)}return i.max=u,i}export{H as axisticks,Z as datajoin,K as encode,W as legendentries,O as linkpath,P as pie,ie as scale,re as sortitems,I as stack};export default null;
