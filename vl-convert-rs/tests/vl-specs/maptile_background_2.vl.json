{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.16.3.json",
  "config": {
    "view": {
      "continuousHeight": 300,
      "continuousWidth": 300
    }
  },
  "datasets": {
    "data-41846c5d1f09921bbee866b76adaa11d": [
      {
        "CONTINENT": "Africa",
        "geometry": {
          "coordinates": [
            [
              [
                29.339997592900346,
                -4.4999834122940925
              ],
              [
                29.519986606572928,
                -5.419978936386315
              ],
              [
                29.419992710088167,
                -5.939998874539434
              ],
              [
                29.620032179490014,
                -6.520015150583426
              ],
              [
                30.199996779101696,
                -7.079980970898163
              ],
              [
                30.74001549655179,
                -8.340007419470915
              ],
              [
                30.740009731422095,
                -8.34000593035372
              ],
              [
                30.346086053190817,
                -8.238256524288218
              ],
              [
                29.00291222506047,
                -8.407031752153472
              ],
              [
                28.734866570762502,
                -8.526559340044578
              ],
              [
                28.449871046672826,
                -9.164918308146085
              ],
              [
                28.67368167492893,
                -9.605924981324932
              ],
              [
                28.49606977714177,
                -10.789883721564046
              ],
              [
                28.372253045370428,
                -11.793646742401393
              ],
              [
                28.642417433392353,
                -11.971568698782315
              ],
              [
                29.34154788586909,
                -12.360743910372413
              ],
              [
                29.61600141777123,
                -12.178894545137311
              ],
              [
                29.69961388521949,
                -13.257226657771831
              ],
              [
                28.934285922976837,
                -13.248958428605135
              ],
              [
                28.523561639121027,
                -12.698604424696683
              ],
              [
                28.155108676879987,
                -12.272480564017897
              ],
              [
                27.388798862423783,
                -12.132747491100666
              ],
              [
                27.164419793412463,
                -11.608748467661075
              ],
              [
                26.553087599399618,
                -11.924439792532127
              ],
              [
                25.752309604604733,
                -11.784965101776358
              ],
              [
                25.418118116973204,
                -11.330935967659961
              ],
              [
                24.78316979340295,
                -11.238693536018964
              ],
              [
                24.31451622894795,
                -11.26282642989927
              ],
              [
                24.25715538910399,
                -10.951992689663657
              ],
              [
                23.912215203555718,
                -10.926826267137514
              ],
              [
                23.45679080576744,
                -10.867863457892483
              ],
              [
                22.83734541188474,
                -11.01762175867433
              ],
              [
                22.402798292742375,
                -10.993075453335692
              ],
              [
                22.155268182064308,
                -11.084801120653772
              ],
              [
                22.208753289486395,
                -9.894796237836509
              ],
              [
                21.875181919042348,
                -9.523707777548566
              ],
              [
                21.8018013851879,
                -8.90870655684298
              ],
              [
                21.949130893652043,
                -8.305900974158277
              ],
              [
                21.74645592620331,
                -7.920084730667149
              ],
              [
                21.7281107927397,
                -7.290872491081302
              ],
              [
                20.5147481625265,
                -7.2996058081386295
              ],
              [
                20.6018229509383,
                -6.939317722199682
              ],
              [
                20.091621534920648,
                -6.943090101756994
              ],
              [
                20.037723016040218,
                -7.116361179231646
              ],
              [
                19.41750247567316,
                -7.155428562044299
              ],
              [
                19.16661339689611,
                -7.738183688999754
              ],
              [
                19.01675174324967,
                -7.988245944860132
              ],
              [
                18.464175652752687,
                -7.847014255406443
              ],
              [
                18.13422163256905,
                -7.987677504104923
              ],
              [
                17.472970004962235,
                -8.0685511206417
              ],
              [
                17.08999596524717,
                -7.545688978712526
              ],
              [
                16.8601908708452,
                -7.2222978654299865
              ],
              [
                16.573179965896145,
                -6.6226445451150875
              ],
              [
                16.326528354567046,
                -5.877470391466268
              ],
              [
                13.375597364971895,
                -5.8642412247995495
              ],
              [
                13.024869419006961,
                -5.984388929878158
              ],
              [
                12.735171339578699,
                -5.965682061388499
              ],
              [
                12.32243167486351,
                -6.10009246177966
              ],
              [
                12.182336866920252,
                -5.789930515163839
              ],
              [
                12.436688266660868,
                -5.6843038875592455
              ],
              [
                12.468004184629736,
                -5.248361504745005
              ],
              [
                12.63161176926579,
                -4.991271254092936
              ],
              [
                12.995517205465177,
                -4.781103203961884
              ],
              [
                13.258240187237048,
                -4.882957452009165
              ],
              [
                13.600234816144678,
                -4.50013844159097
              ],
              [
                14.144956088933299,
                -4.510008640158716
              ],
              [
                14.209034864975223,
                -4.793092136253598
              ],
              [
                14.582603794013181,
                -4.97023894615014
              ],
              [
                15.170991652088444,
                -4.343507175314301
              ],
              [
                15.753540073314753,
                -3.8551648901560966
              ],
              [
                16.0062895036543,
                -3.535132744972529
              ],
              [
                15.972803175529151,
                -2.7123922664536124
              ],
              [
                16.407091912510054,
                -1.7409270157986825
              ],
              [
                16.865306837642123,
                -1.2258163387132868
              ],
              [
                17.523716261472856,
                -0.743830254726987
              ],
              [
                17.638644646889986,
                -0.4248316381892465
              ],
              [
                17.66355268725468,
                -0.05808399821381727
              ],
              [
                17.826540154703252,
                0.28892324462610475
              ],
              [
                17.774191928791566,
                0.8556586775710854
              ],
              [
                17.898835483479587,
                1.7418319767282782
              ],
              [
                18.094275750407434,
                2.365721543788055
              ],
              [
                18.393792351971143,
                2.90044342692822
              ],
              [
                18.45306521980993,
                3.5043858911233485
              ],
              [
                18.54298221199778,
                4.201785183118318
              ],
              [
                18.93231245288476,
                4.709506130385975
              ],
              [
                19.46778364429315,
                5.03152781821278
              ],
              [
                20.290679152108936,
                4.691677761245288
              ],
              [
                20.927591180106276,
                4.322785549329737
              ],
              [
                21.659122755630023,
                4.22434194581372
              ],
              [
                22.405123732195538,
                4.029160061047321
              ],
              [
                22.70412356943629,
                4.633050848810157
              ],
              [
                22.841479526468106,
                4.710126247573484
              ],
              [
                23.29721398285014,
                4.609693101414223
              ],
              [
                24.410531040146253,
                5.10878408448913
              ],
              [
                24.805028924262416,
                4.89724660890235
              ],
              [
                25.12883344900328,
                4.92724477784779
              ],
              [
                25.278798455514305,
                5.170408229997192
              ],
              [
                25.650455356557472,
                5.256087754737123
              ],
              [
                26.402760857862543,
                5.1508745385908705
              ],
              [
                27.04406538260471,
                5.127852688004836
              ],
              [
                27.37422610851749,
                5.233944403500061
              ],
              [
                27.97997724784281,
                4.408413397637375
              ],
              [
                28.428993768026913,
                4.287154649264494
              ],
              [
                28.696677687298802,
                4.455077215996937
              ],
              [
                29.1590784034465,
                4.389267279473231
              ],
              [
                29.71599531425602,
                4.600804755060153
              ],
              [
                29.953500197069474,
                4.173699042167684
              ],
              [
                30.833852421715427,
                3.5091716042224625
              ],
              [
                30.83385989759381,
                3.509165961110341
              ],
              [
                30.77334679538004,
                2.339883327642127
              ],
              [
                31.174149204235817,
                2.204465236821264
              ],
              [
                30.85267011894806,
                1.8493964705438088
              ],
              [
                30.46850752129029,
                1.5838054467797065
              ],
              [
                30.086153598762706,
                1.0623127303062887
              ],
              [
                29.875778842902434,
                0.5973798689763612
              ],
              [
                29.819503208136638,
                -0.2053101538133717
              ],
              [
                29.58783776217217,
                -0.587405694179381
              ],
              [
                29.579466180140884,
                -1.3413131648856265
              ],
              [
                29.291886834436614,
                -1.6200558406679872
              ],
              [
                29.254834832483343,
                -2.2151099585089113
              ],
              [
                29.117478875451553,
                -2.2922111954883846
              ],
              [
                29.024926385216787,
                -2.8392579077301576
              ],
              [
                29.276383904749053,
                -3.293907159034063
              ],
              [
                29.339997592900346,
                -4.4999834122940925
              ]
            ]
          ],
          "type": "Polygon"
        },
        "type": "Feature"
      },
      {
        "CONTINENT": "Africa",
        "geometry": {
          "coordinates": [
            [
              [
                41.58513,
                -1.6832500000000001
              ],
              [
                40.993,
                -0.85829
              ],
              [
                40.98105,
                2.7845199999999997
              ],
              [
                41.85508309264397,
                3.918911920483727
              ],
              [
                42.128609999999995,
                4.23413
              ],
              [
                42.76967,
                4.25259
              ],
              [
                43.66086999999999,
                4.957550000000083
              ],
              [
                44.96360000000001,
                5.00162
              ],
              [
                47.78942,
                8.003
              ],
              [
                48.48673587422695,
                8.837626247589995
              ],
              [
                48.93812951029645,
                9.451748968946617
              ],
              [
                48.93823286316103,
                9.973500067581512
              ],
              [
                48.938491245322496,
                10.982327378783467
              ],
              [
                48.94200524271835,
                11.394266058798138
              ],
              [
                48.94820475850974,
                11.410617281697963
              ],
              [
                48.94820475850985,
                11.41061728169797
              ],
              [
                49.26776,
                11.43033
              ],
              [
                49.72862,
                11.5789
              ],
              [
                50.25878000000001,
                11.67957
              ],
              [
                50.73202,
                12.021900000000002
              ],
              [
                51.1112,
                12.024640000000002
              ],
              [
                51.13387,
                11.74815
              ],
              [
                51.04153,
                11.16651
              ],
              [
                51.04531,
                10.6409
              ],
              [
                50.834179999999996,
                10.279720000000001
              ],
              [
                50.55239,
                9.19874
              ],
              [
                50.07092,
                8.08173
              ],
              [
                49.45270000000001,
                6.80466
              ],
              [
                48.594550000000005,
                5.339110000000001
              ],
              [
                47.740790000000004,
                4.2194
              ],
              [
                46.56476,
                2.85529
              ],
              [
                45.563990000000004,
                2.04576
              ],
              [
                44.068149999999996,
                1.0528300000000002
              ],
              [
                43.13597,
                0.2922
              ],
              [
                42.04157000000001,
                -0.9191600000000001
              ],
              [
                41.81095,
                -1.4464700000000001
              ],
              [
                41.58513,
                -1.6832500000000001
              ]
            ]
          ],
          "type": "Polygon"
        },
        "type": "Feature"
      }
    ],
    "empty": [
      {}
    ]
  },
  "height": 400,
  "layer": [
    {
      "data": {
        "name": "tile_list",
        "sequence": {
          "as": "a",
          "start": 0,
          "stop": 20
        }
      },
      "encoding": {
        "url": {
          "field": "url",
          "type": "nominal"
        },
        "x": {
          "field": "x",
          "scale": null,
          "type": "quantitative"
        },
        "y": {
          "field": "y",
          "scale": null,
          "type": "quantitative"
        }
      },
      "mark": {
        "clip": true,
        "height": {
          "expr": "tile_size + 1"
        },
        "type": "image",
        "width": {
          "expr": "tile_size + 1"
        }
      },
      "transform": [
        {
          "as": "b",
          "calculate": "sequence(0, 20)"
        },
        {
          "flatten": [
            "b"
          ]
        },
        {
          "as": "url",
          "calculate": "'https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/' + zoom_ceil + '/' + (datum.b + djj_floor) + '/' + ((datum.a + dii_floor + max_one_side_tiles_count) % max_one_side_tiles_count) + ''"
        },
        {
          "as": "x",
          "calculate": "datum.a * tile_size + dx + (tile_size / 2)"
        },
        {
          "as": "y",
          "calculate": "datum.b * tile_size + dy + (tile_size / 2)"
        },
        {
          "filter": "datum.x < (width + tile_size / 2) && datum.y < (height + tile_size / 2)"
        },
        {
          "filter": "((datum.a + dii_floor + max_one_side_tiles_count) % max_one_side_tiles_count) >= 0 && (datum.b + djj_floor) >= 0 && ((datum.a + dii_floor + max_one_side_tiles_count) % max_one_side_tiles_count) <= (max_one_side_tiles_count - 1) && (datum.b + djj_floor) <= (max_one_side_tiles_count - 1)"
        }
      ]
    },
    {
      "data": {
        "name": "data-41846c5d1f09921bbee866b76adaa11d"
      },
      "mark": {
        "fillOpacity": 0.1,
        "stroke": "green",
        "strokeWidth": 2,
        "type": "geoshape"
      },
      "projection": {
        "type": "mercator"
      }
    },
    {
      "data": {
        "name": "empty"
      },
      "encoding": {
        "x": {
          "value": 0
        },
        "y": {
          "value": {
            "expr": "height"
          }
        }
      },
      "mark": {
        "align": "left",
        "dx": 3,
        "dy": -8,
        "text": "Tiles (C) Esri -- Esri, DeLorme, NAVTEQ",
        "type": "text"
      }
    }
  ],
  "params": [
    {
      "name": "base_tile_size",
      "value": 256
    },
    {
      "expr": "geoScale('projection')",
      "name": "pr_scale"
    },
    {
      "expr": "log((2 * PI * pr_scale) / base_tile_size) / log(2)",
      "name": "zoom_level"
    },
    {
      "expr": "ceil(zoom_level)",
      "name": "zoom_ceil"
    },
    {
      "expr": "pow(2, zoom_ceil)",
      "name": "max_one_side_tiles_count"
    },
    {
      "expr": "base_tile_size * pow(2, zoom_level - zoom_ceil)",
      "name": "tile_size"
    },
    {
      "expr": "invert('projection', [0, 0])",
      "name": "base_point"
    },
    {
      "expr": "(base_point[0] + 180) / 360 * max_one_side_tiles_count",
      "name": "dii"
    },
    {
      "expr": "floor(dii)",
      "name": "dii_floor"
    },
    {
      "expr": "(dii_floor - dii) * tile_size",
      "name": "dx"
    },
    {
      "expr": "(1 - log(tan(base_point[1] * PI / 180) + 1 / cos(base_point[1] * PI / 180)) / PI) / 2 * max_one_side_tiles_count",
      "name": "djj"
    },
    {
      "expr": "floor(djj)",
      "name": "djj_floor"
    },
    {
      "expr": "round((djj_floor - djj) * tile_size)",
      "name": "dy"
    }
  ],
  "width": 600
}
